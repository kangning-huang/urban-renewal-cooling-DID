function A8(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const l=Object.getOwnPropertyDescriptor(n,i);l&&Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();function Fh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var L2={exports:{}},i0={};var HM;function E8(){if(HM)return i0;HM=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(n,i,l){var c=null;if(l!==void 0&&(c=""+l),i.key!==void 0&&(c=""+i.key),"key"in i){l={};for(var s in i)s!=="key"&&(l[s]=i[s])}else l=i;return i=l.ref,{$$typeof:t,type:n,key:c,ref:i!==void 0?i:null,props:l}}return i0.Fragment=e,i0.jsx=r,i0.jsxs=r,i0}var qM;function P8(){return qM||(qM=1,L2.exports=E8()),L2.exports}var se=P8(),N2={exports:{}},Lr={};var XM;function C8(){if(XM)return Lr;XM=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),E=Symbol.for("react.activity"),O=Symbol.iterator;function N(ye){return ye===null||typeof ye!="object"?null:(ye=O&&ye[O]||ye["@@iterator"],typeof ye=="function"?ye:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,j={};function Y(ye,Be,lt){this.props=ye,this.context=Be,this.refs=j,this.updater=lt||V}Y.prototype.isReactComponent={},Y.prototype.setState=function(ye,Be){if(typeof ye!="object"&&typeof ye!="function"&&ye!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ye,Be,"setState")},Y.prototype.forceUpdate=function(ye){this.updater.enqueueForceUpdate(this,ye,"forceUpdate")};function ce(){}ce.prototype=Y.prototype;function re(ye,Be,lt){this.props=ye,this.context=Be,this.refs=j,this.updater=lt||V}var ue=re.prototype=new ce;ue.constructor=re,W(ue,Y.prototype),ue.isPureReactComponent=!0;var me=Array.isArray;function ge(){}var Ce={H:null,A:null,T:null,S:null},We=Object.prototype.hasOwnProperty;function Xe(ye,Be,lt){var Tt=lt.ref;return{$$typeof:t,type:ye,key:Be,ref:Tt!==void 0?Tt:null,props:lt}}function Et(ye,Be){return Xe(ye.type,Be,ye.props)}function gt(ye){return typeof ye=="object"&&ye!==null&&ye.$$typeof===t}function Ye(ye){var Be={"=":"=0",":":"=2"};return"$"+ye.replace(/[=:]/g,function(lt){return Be[lt]})}var jt=/\/+/g;function St(ye,Be){return typeof ye=="object"&&ye!==null&&ye.key!=null?Ye(""+ye.key):Be.toString(36)}function Zt(ye){switch(ye.status){case"fulfilled":return ye.value;case"rejected":throw ye.reason;default:switch(typeof ye.status=="string"?ye.then(ge,ge):(ye.status="pending",ye.then(function(Be){ye.status==="pending"&&(ye.status="fulfilled",ye.value=Be)},function(Be){ye.status==="pending"&&(ye.status="rejected",ye.reason=Be)})),ye.status){case"fulfilled":return ye.value;case"rejected":throw ye.reason}}throw ye}function fe(ye,Be,lt,Tt,zt){var Xt=typeof ye;(Xt==="undefined"||Xt==="boolean")&&(ye=null);var Wt=!1;if(ye===null)Wt=!0;else switch(Xt){case"bigint":case"string":case"number":Wt=!0;break;case"object":switch(ye.$$typeof){case t:case e:Wt=!0;break;case w:return Wt=ye._init,fe(Wt(ye._payload),Be,lt,Tt,zt)}}if(Wt)return zt=zt(ye),Wt=Tt===""?"."+St(ye,0):Tt,me(zt)?(lt="",Wt!=null&&(lt=Wt.replace(jt,"$&/")+"/"),fe(zt,Be,lt,"",function(Yt){return Yt})):zt!=null&&(gt(zt)&&(zt=Et(zt,lt+(zt.key==null||ye&&ye.key===zt.key?"":(""+zt.key).replace(jt,"$&/")+"/")+Wt)),Be.push(zt)),1;Wt=0;var nr=Tt===""?".":Tt+":";if(me(ye))for(var _t=0;_t<ye.length;_t++)Tt=ye[_t],Xt=nr+St(Tt,_t),Wt+=fe(Tt,Be,lt,Xt,zt);else if(_t=N(ye),typeof _t=="function")for(ye=_t.call(ye),_t=0;!(Tt=ye.next()).done;)Tt=Tt.value,Xt=nr+St(Tt,_t++),Wt+=fe(Tt,Be,lt,Xt,zt);else if(Xt==="object"){if(typeof ye.then=="function")return fe(Zt(ye),Be,lt,Tt,zt);throw Be=String(ye),Error("Objects are not valid as a React child (found: "+(Be==="[object Object]"?"object with keys {"+Object.keys(ye).join(", ")+"}":Be)+"). If you meant to render a collection of children, use an array instead.")}return Wt}function Me(ye,Be,lt){if(ye==null)return ye;var Tt=[],zt=0;return fe(ye,Tt,"","",function(Xt){return Be.call(lt,Xt,zt++)}),Tt}function Ee(ye){if(ye._status===-1){var Be=ye._result;Be=Be(),Be.then(function(lt){(ye._status===0||ye._status===-1)&&(ye._status=1,ye._result=lt)},function(lt){(ye._status===0||ye._status===-1)&&(ye._status=2,ye._result=lt)}),ye._status===-1&&(ye._status=0,ye._result=Be)}if(ye._status===1)return ye._result.default;throw ye._result}var Ue=typeof reportError=="function"?reportError:function(ye){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Be=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ye=="object"&&ye!==null&&typeof ye.message=="string"?String(ye.message):String(ye),error:ye});if(!window.dispatchEvent(Be))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ye);return}console.error(ye)},st={map:Me,forEach:function(ye,Be,lt){Me(ye,function(){Be.apply(this,arguments)},lt)},count:function(ye){var Be=0;return Me(ye,function(){Be++}),Be},toArray:function(ye){return Me(ye,function(Be){return Be})||[]},only:function(ye){if(!gt(ye))throw Error("React.Children.only expected to receive a single React element child.");return ye}};return Lr.Activity=E,Lr.Children=st,Lr.Component=Y,Lr.Fragment=r,Lr.Profiler=i,Lr.PureComponent=re,Lr.StrictMode=n,Lr.Suspense=m,Lr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ce,Lr.__COMPILER_RUNTIME={__proto__:null,c:function(ye){return Ce.H.useMemoCache(ye)}},Lr.cache=function(ye){return function(){return ye.apply(null,arguments)}},Lr.cacheSignal=function(){return null},Lr.cloneElement=function(ye,Be,lt){if(ye==null)throw Error("The argument must be a React element, but you passed "+ye+".");var Tt=W({},ye.props),zt=ye.key;if(Be!=null)for(Xt in Be.key!==void 0&&(zt=""+Be.key),Be)!We.call(Be,Xt)||Xt==="key"||Xt==="__self"||Xt==="__source"||Xt==="ref"&&Be.ref===void 0||(Tt[Xt]=Be[Xt]);var Xt=arguments.length-2;if(Xt===1)Tt.children=lt;else if(1<Xt){for(var Wt=Array(Xt),nr=0;nr<Xt;nr++)Wt[nr]=arguments[nr+2];Tt.children=Wt}return Xe(ye.type,zt,Tt)},Lr.createContext=function(ye){return ye={$$typeof:c,_currentValue:ye,_currentValue2:ye,_threadCount:0,Provider:null,Consumer:null},ye.Provider=ye,ye.Consumer={$$typeof:l,_context:ye},ye},Lr.createElement=function(ye,Be,lt){var Tt,zt={},Xt=null;if(Be!=null)for(Tt in Be.key!==void 0&&(Xt=""+Be.key),Be)We.call(Be,Tt)&&Tt!=="key"&&Tt!=="__self"&&Tt!=="__source"&&(zt[Tt]=Be[Tt]);var Wt=arguments.length-2;if(Wt===1)zt.children=lt;else if(1<Wt){for(var nr=Array(Wt),_t=0;_t<Wt;_t++)nr[_t]=arguments[_t+2];zt.children=nr}if(ye&&ye.defaultProps)for(Tt in Wt=ye.defaultProps,Wt)zt[Tt]===void 0&&(zt[Tt]=Wt[Tt]);return Xe(ye,Xt,zt)},Lr.createRef=function(){return{current:null}},Lr.forwardRef=function(ye){return{$$typeof:s,render:ye}},Lr.isValidElement=gt,Lr.lazy=function(ye){return{$$typeof:w,_payload:{_status:-1,_result:ye},_init:Ee}},Lr.memo=function(ye,Be){return{$$typeof:b,type:ye,compare:Be===void 0?null:Be}},Lr.startTransition=function(ye){var Be=Ce.T,lt={};Ce.T=lt;try{var Tt=ye(),zt=Ce.S;zt!==null&&zt(lt,Tt),typeof Tt=="object"&&Tt!==null&&typeof Tt.then=="function"&&Tt.then(ge,Ue)}catch(Xt){Ue(Xt)}finally{Be!==null&&lt.types!==null&&(Be.types=lt.types),Ce.T=Be}},Lr.unstable_useCacheRefresh=function(){return Ce.H.useCacheRefresh()},Lr.use=function(ye){return Ce.H.use(ye)},Lr.useActionState=function(ye,Be,lt){return Ce.H.useActionState(ye,Be,lt)},Lr.useCallback=function(ye,Be){return Ce.H.useCallback(ye,Be)},Lr.useContext=function(ye){return Ce.H.useContext(ye)},Lr.useDebugValue=function(){},Lr.useDeferredValue=function(ye,Be){return Ce.H.useDeferredValue(ye,Be)},Lr.useEffect=function(ye,Be){return Ce.H.useEffect(ye,Be)},Lr.useEffectEvent=function(ye){return Ce.H.useEffectEvent(ye)},Lr.useId=function(){return Ce.H.useId()},Lr.useImperativeHandle=function(ye,Be,lt){return Ce.H.useImperativeHandle(ye,Be,lt)},Lr.useInsertionEffect=function(ye,Be){return Ce.H.useInsertionEffect(ye,Be)},Lr.useLayoutEffect=function(ye,Be){return Ce.H.useLayoutEffect(ye,Be)},Lr.useMemo=function(ye,Be){return Ce.H.useMemo(ye,Be)},Lr.useOptimistic=function(ye,Be){return Ce.H.useOptimistic(ye,Be)},Lr.useReducer=function(ye,Be,lt){return Ce.H.useReducer(ye,Be,lt)},Lr.useRef=function(ye){return Ce.H.useRef(ye)},Lr.useState=function(ye){return Ce.H.useState(ye)},Lr.useSyncExternalStore=function(ye,Be,lt){return Ce.H.useSyncExternalStore(ye,Be,lt)},Lr.useTransition=function(){return Ce.H.useTransition()},Lr.version="19.2.4",Lr}var GM;function Hy(){return GM||(GM=1,N2.exports=C8()),N2.exports}var ee=Hy();const M8=Fh(ee),I8=A8({__proto__:null,default:M8},[ee]);var z2={exports:{}},s0={},B2={exports:{}},F2={};var ZM;function R8(){return ZM||(ZM=1,(function(t){function e(fe,Me){var Ee=fe.length;fe.push(Me);e:for(;0<Ee;){var Ue=Ee-1>>>1,st=fe[Ue];if(0<i(st,Me))fe[Ue]=Me,fe[Ee]=st,Ee=Ue;else break e}}function r(fe){return fe.length===0?null:fe[0]}function n(fe){if(fe.length===0)return null;var Me=fe[0],Ee=fe.pop();if(Ee!==Me){fe[0]=Ee;e:for(var Ue=0,st=fe.length,ye=st>>>1;Ue<ye;){var Be=2*(Ue+1)-1,lt=fe[Be],Tt=Be+1,zt=fe[Tt];if(0>i(lt,Ee))Tt<st&&0>i(zt,lt)?(fe[Ue]=zt,fe[Tt]=Ee,Ue=Tt):(fe[Ue]=lt,fe[Be]=Ee,Ue=Be);else if(Tt<st&&0>i(zt,Ee))fe[Ue]=zt,fe[Tt]=Ee,Ue=Tt;else break e}}return Me}function i(fe,Me){var Ee=fe.sortIndex-Me.sortIndex;return Ee!==0?Ee:fe.id-Me.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,s=c.now();t.unstable_now=function(){return c.now()-s}}var m=[],b=[],w=1,E=null,O=3,N=!1,V=!1,W=!1,j=!1,Y=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;function ue(fe){for(var Me=r(b);Me!==null;){if(Me.callback===null)n(b);else if(Me.startTime<=fe)n(b),Me.sortIndex=Me.expirationTime,e(m,Me);else break;Me=r(b)}}function me(fe){if(W=!1,ue(fe),!V)if(r(m)!==null)V=!0,ge||(ge=!0,Ye());else{var Me=r(b);Me!==null&&Zt(me,Me.startTime-fe)}}var ge=!1,Ce=-1,We=5,Xe=-1;function Et(){return j?!0:!(t.unstable_now()-Xe<We)}function gt(){if(j=!1,ge){var fe=t.unstable_now();Xe=fe;var Me=!0;try{e:{V=!1,W&&(W=!1,ce(Ce),Ce=-1),N=!0;var Ee=O;try{t:{for(ue(fe),E=r(m);E!==null&&!(E.expirationTime>fe&&Et());){var Ue=E.callback;if(typeof Ue=="function"){E.callback=null,O=E.priorityLevel;var st=Ue(E.expirationTime<=fe);if(fe=t.unstable_now(),typeof st=="function"){E.callback=st,ue(fe),Me=!0;break t}E===r(m)&&n(m),ue(fe)}else n(m);E=r(m)}if(E!==null)Me=!0;else{var ye=r(b);ye!==null&&Zt(me,ye.startTime-fe),Me=!1}}break e}finally{E=null,O=Ee,N=!1}Me=void 0}}finally{Me?Ye():ge=!1}}}var Ye;if(typeof re=="function")Ye=function(){re(gt)};else if(typeof MessageChannel<"u"){var jt=new MessageChannel,St=jt.port2;jt.port1.onmessage=gt,Ye=function(){St.postMessage(null)}}else Ye=function(){Y(gt,0)};function Zt(fe,Me){Ce=Y(function(){fe(t.unstable_now())},Me)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(fe){fe.callback=null},t.unstable_forceFrameRate=function(fe){0>fe||125<fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):We=0<fe?Math.floor(1e3/fe):5},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_next=function(fe){switch(O){case 1:case 2:case 3:var Me=3;break;default:Me=O}var Ee=O;O=Me;try{return fe()}finally{O=Ee}},t.unstable_requestPaint=function(){j=!0},t.unstable_runWithPriority=function(fe,Me){switch(fe){case 1:case 2:case 3:case 4:case 5:break;default:fe=3}var Ee=O;O=fe;try{return Me()}finally{O=Ee}},t.unstable_scheduleCallback=function(fe,Me,Ee){var Ue=t.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?Ue+Ee:Ue):Ee=Ue,fe){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=Ee+st,fe={id:w++,callback:Me,priorityLevel:fe,startTime:Ee,expirationTime:st,sortIndex:-1},Ee>Ue?(fe.sortIndex=Ee,e(b,fe),r(m)===null&&fe===r(b)&&(W?(ce(Ce),Ce=-1):W=!0,Zt(me,Ee-Ue))):(fe.sortIndex=st,e(m,fe),V||N||(V=!0,ge||(ge=!0,Ye()))),fe},t.unstable_shouldYield=Et,t.unstable_wrapCallback=function(fe){var Me=O;return function(){var Ee=O;O=Me;try{return fe.apply(this,arguments)}finally{O=Ee}}}})(F2)),F2}var YM;function O8(){return YM||(YM=1,B2.exports=R8()),B2.exports}var j2={exports:{}},Va={};var KM;function D8(){if(KM)return Va;KM=1;var t=Hy();function e(m){var b="https://react.dev/errors/"+m;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)b+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+m+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var n={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(m,b,w){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:E==null?null:""+E,children:m,containerInfo:b,implementation:w}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(m,b){if(m==="font")return"";if(typeof b=="string")return b==="use-credentials"?b:""}return Va.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Va.createPortal=function(m,b){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11)throw Error(e(299));return l(m,b,null,w)},Va.flushSync=function(m){var b=c.T,w=n.p;try{if(c.T=null,n.p=2,m)return m()}finally{c.T=b,n.p=w,n.d.f()}},Va.preconnect=function(m,b){typeof m=="string"&&(b?(b=b.crossOrigin,b=typeof b=="string"?b==="use-credentials"?b:"":void 0):b=null,n.d.C(m,b))},Va.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},Va.preinit=function(m,b){if(typeof m=="string"&&b&&typeof b.as=="string"){var w=b.as,E=s(w,b.crossOrigin),O=typeof b.integrity=="string"?b.integrity:void 0,N=typeof b.fetchPriority=="string"?b.fetchPriority:void 0;w==="style"?n.d.S(m,typeof b.precedence=="string"?b.precedence:void 0,{crossOrigin:E,integrity:O,fetchPriority:N}):w==="script"&&n.d.X(m,{crossOrigin:E,integrity:O,fetchPriority:N,nonce:typeof b.nonce=="string"?b.nonce:void 0})}},Va.preinitModule=function(m,b){if(typeof m=="string")if(typeof b=="object"&&b!==null){if(b.as==null||b.as==="script"){var w=s(b.as,b.crossOrigin);n.d.M(m,{crossOrigin:w,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0})}}else b==null&&n.d.M(m)},Va.preload=function(m,b){if(typeof m=="string"&&typeof b=="object"&&b!==null&&typeof b.as=="string"){var w=b.as,E=s(w,b.crossOrigin);n.d.L(m,w,{crossOrigin:E,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0,type:typeof b.type=="string"?b.type:void 0,fetchPriority:typeof b.fetchPriority=="string"?b.fetchPriority:void 0,referrerPolicy:typeof b.referrerPolicy=="string"?b.referrerPolicy:void 0,imageSrcSet:typeof b.imageSrcSet=="string"?b.imageSrcSet:void 0,imageSizes:typeof b.imageSizes=="string"?b.imageSizes:void 0,media:typeof b.media=="string"?b.media:void 0})}},Va.preloadModule=function(m,b){if(typeof m=="string")if(b){var w=s(b.as,b.crossOrigin);n.d.m(m,{as:typeof b.as=="string"&&b.as!=="script"?b.as:void 0,crossOrigin:w,integrity:typeof b.integrity=="string"?b.integrity:void 0})}else n.d.m(m)},Va.requestFormReset=function(m){n.d.r(m)},Va.unstable_batchedUpdates=function(m,b){return m(b)},Va.useFormState=function(m,b,w){return c.H.useFormState(m,b,w)},Va.useFormStatus=function(){return c.H.useHostTransitionStatus()},Va.version="19.2.4",Va}var QM;function C4(){if(QM)return j2.exports;QM=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),j2.exports=D8(),j2.exports}var JM;function k8(){if(JM)return s0;JM=1;var t=O8(),e=Hy(),r=C4();function n(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)p+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function l(f){var p=f,v=f;if(f.alternate)for(;p.return;)p=p.return;else{f=p;do p=f,(p.flags&4098)!==0&&(v=p.return),f=p.return;while(f)}return p.tag===3?v:null}function c(f){if(f.tag===13){var p=f.memoizedState;if(p===null&&(f=f.alternate,f!==null&&(p=f.memoizedState)),p!==null)return p.dehydrated}return null}function s(f){if(f.tag===31){var p=f.memoizedState;if(p===null&&(f=f.alternate,f!==null&&(p=f.memoizedState)),p!==null)return p.dehydrated}return null}function m(f){if(l(f)!==f)throw Error(n(188))}function b(f){var p=f.alternate;if(!p){if(p=l(f),p===null)throw Error(n(188));return p!==f?null:f}for(var v=f,P=p;;){var k=v.return;if(k===null)break;var B=k.alternate;if(B===null){if(P=k.return,P!==null){v=P;continue}break}if(k.child===B.child){for(B=k.child;B;){if(B===v)return m(k),f;if(B===P)return m(k),p;B=B.sibling}throw Error(n(188))}if(v.return!==P.return)v=k,P=B;else{for(var K=!1,pe=k.child;pe;){if(pe===v){K=!0,v=k,P=B;break}if(pe===P){K=!0,P=k,v=B;break}pe=pe.sibling}if(!K){for(pe=B.child;pe;){if(pe===v){K=!0,v=B,P=k;break}if(pe===P){K=!0,P=B,v=k;break}pe=pe.sibling}if(!K)throw Error(n(189))}}if(v.alternate!==P)throw Error(n(190))}if(v.tag!==3)throw Error(n(188));return v.stateNode.current===v?f:p}function w(f){var p=f.tag;if(p===5||p===26||p===27||p===6)return f;for(f=f.child;f!==null;){if(p=w(f),p!==null)return p;f=f.sibling}return null}var E=Object.assign,O=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),V=Symbol.for("react.portal"),W=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),Y=Symbol.for("react.profiler"),ce=Symbol.for("react.consumer"),re=Symbol.for("react.context"),ue=Symbol.for("react.forward_ref"),me=Symbol.for("react.suspense"),ge=Symbol.for("react.suspense_list"),Ce=Symbol.for("react.memo"),We=Symbol.for("react.lazy"),Xe=Symbol.for("react.activity"),Et=Symbol.for("react.memo_cache_sentinel"),gt=Symbol.iterator;function Ye(f){return f===null||typeof f!="object"?null:(f=gt&&f[gt]||f["@@iterator"],typeof f=="function"?f:null)}var jt=Symbol.for("react.client.reference");function St(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===jt?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case W:return"Fragment";case Y:return"Profiler";case j:return"StrictMode";case me:return"Suspense";case ge:return"SuspenseList";case Xe:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case V:return"Portal";case re:return f.displayName||"Context";case ce:return(f._context.displayName||"Context")+".Consumer";case ue:var p=f.render;return f=f.displayName,f||(f=p.displayName||p.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ce:return p=f.displayName||null,p!==null?p:St(f.type)||"Memo";case We:p=f._payload,f=f._init;try{return St(f(p))}catch{}}return null}var Zt=Array.isArray,fe=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Me=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ee={pending:!1,data:null,method:null,action:null},Ue=[],st=-1;function ye(f){return{current:f}}function Be(f){0>st||(f.current=Ue[st],Ue[st]=null,st--)}function lt(f,p){st++,Ue[st]=f.current,f.current=p}var Tt=ye(null),zt=ye(null),Xt=ye(null),Wt=ye(null);function nr(f,p){switch(lt(Xt,p),lt(zt,f),lt(Tt,null),p.nodeType){case 9:case 11:f=(f=p.documentElement)&&(f=f.namespaceURI)?dh(f):0;break;default:if(f=p.tagName,p=p.namespaceURI)p=dh(p),f=jv(p,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}Be(Tt),lt(Tt,f)}function _t(){Be(Tt),Be(zt),Be(Xt)}function Yt(f){f.memoizedState!==null&&lt(Wt,f);var p=Tt.current,v=jv(p,f.type);p!==v&&(lt(zt,f),lt(Tt,v))}function Tr(f){zt.current===f&&(Be(Tt),Be(zt)),Wt.current===f&&(Be(Wt),Og._currentValue=Ee)}var Rt,$n;function _r(f){if(Rt===void 0)try{throw Error()}catch(v){var p=v.stack.trim().match(/\n( *(at )?)/);Rt=p&&p[1]||"",$n=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Rt+f+$n}var sr=!1;function ur(f,p){if(!f||sr)return"";sr=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var P={DetermineComponentFrameRoot:function(){try{if(p){var Dt=function(){throw Error()};if(Object.defineProperty(Dt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Dt,[])}catch(yt){var dt=yt}Reflect.construct(f,[],Dt)}else{try{Dt.call()}catch(yt){dt=yt}f.call(Dt.prototype)}}else{try{throw Error()}catch(yt){dt=yt}(Dt=f())&&typeof Dt.catch=="function"&&Dt.catch(function(){})}}catch(yt){if(yt&&dt&&typeof yt.stack=="string")return[yt.stack,dt.stack]}return[null,null]}};P.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(P.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(P.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=P.DetermineComponentFrameRoot(),K=B[0],pe=B[1];if(K&&pe){var je=K.split(`
`),ft=pe.split(`
`);for(k=P=0;P<je.length&&!je[P].includes("DetermineComponentFrameRoot");)P++;for(;k<ft.length&&!ft[k].includes("DetermineComponentFrameRoot");)k++;if(P===je.length||k===ft.length)for(P=je.length-1,k=ft.length-1;1<=P&&0<=k&&je[P]!==ft[k];)k--;for(;1<=P&&0<=k;P--,k--)if(je[P]!==ft[k]){if(P!==1||k!==1)do if(P--,k--,0>k||je[P]!==ft[k]){var At=`
`+je[P].replace(" at new "," at ");return f.displayName&&At.includes("<anonymous>")&&(At=At.replace("<anonymous>",f.displayName)),At}while(1<=P&&0<=k);break}}}finally{sr=!1,Error.prepareStackTrace=v}return(v=f?f.displayName||f.name:"")?_r(v):""}function Yr(f,p){switch(f.tag){case 26:case 27:case 5:return _r(f.type);case 16:return _r("Lazy");case 13:return f.child!==p&&p!==null?_r("Suspense Fallback"):_r("Suspense");case 19:return _r("SuspenseList");case 0:case 15:return ur(f.type,!1);case 11:return ur(f.type.render,!1);case 1:return ur(f.type,!0);case 31:return _r("Activity");default:return""}}function qs(f){try{var p="",v=null;do p+=Yr(f,v),v=f,f=f.return;while(f);return p}catch(P){return`
Error generating stack: `+P.message+`
`+P.stack}}var Rl=Object.prototype.hasOwnProperty,Zo=t.unstable_scheduleCallback,yo=t.unstable_cancelCallback,Za=t.unstable_shouldYield,Du=t.unstable_requestPaint,vi=t.unstable_now,Xs=t.unstable_getCurrentPriorityLevel,ku=t.unstable_ImmediatePriority,Yo=t.unstable_UserBlockingPriority,Ko=t.unstable_NormalPriority,Vh=t.unstable_LowPriority,Ol=t.unstable_IdlePriority,He=t.log,J=t.unstable_setDisableYieldValue,ie=null,oe=null;function Pe(f){if(typeof He=="function"&&J(f),oe&&typeof oe.setStrictMode=="function")try{oe.setStrictMode(ie,f)}catch{}}var Ne=Math.clz32?Math.clz32:qe,tt=Math.log,Je=Math.LN2;function qe(f){return f>>>=0,f===0?32:31-(tt(f)/Je|0)|0}var et=256,Ct=262144,mt=4194304;function Le(f){var p=f&42;if(p!==0)return p;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return f&261888;case 262144:case 524288:case 1048576:case 2097152:return f&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function Qt(f,p,v){var P=f.pendingLanes;if(P===0)return 0;var k=0,B=f.suspendedLanes,K=f.pingedLanes;f=f.warmLanes;var pe=P&134217727;return pe!==0?(P=pe&~B,P!==0?k=Le(P):(K&=pe,K!==0?k=Le(K):v||(v=pe&~f,v!==0&&(k=Le(v))))):(pe=P&~B,pe!==0?k=Le(pe):K!==0?k=Le(K):v||(v=P&~f,v!==0&&(k=Le(v)))),k===0?0:p!==0&&p!==k&&(p&B)===0&&(B=k&-k,v=p&-p,B>=v||B===32&&(v&4194048)!==0)?p:k}function yr(f,p){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&p)===0}function or(f,p){switch(f){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fr(){var f=mt;return mt<<=1,(mt&62914560)===0&&(mt=4194304),f}function dr(f){for(var p=[],v=0;31>v;v++)p.push(f);return p}function vr(f,p){f.pendingLanes|=p,p!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function En(f,p,v,P,k,B){var K=f.pendingLanes;f.pendingLanes=v,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=v,f.entangledLanes&=v,f.errorRecoveryDisabledLanes&=v,f.shellSuspendCounter=0;var pe=f.entanglements,je=f.expirationTimes,ft=f.hiddenUpdates;for(v=K&~v;0<v;){var At=31-Ne(v),Dt=1<<At;pe[At]=0,je[At]=-1;var dt=ft[At];if(dt!==null)for(ft[At]=null,At=0;At<dt.length;At++){var yt=dt[At];yt!==null&&(yt.lane&=-536870913)}v&=~Dt}P!==0&&Wn(f,P,0),B!==0&&k===0&&f.tag!==0&&(f.suspendedLanes|=B&~(K&~p))}function Wn(f,p,v){f.pendingLanes|=p,f.suspendedLanes&=~p;var P=31-Ne(p);f.entangledLanes|=p,f.entanglements[P]=f.entanglements[P]|1073741824|v&261930}function Nn(f,p){var v=f.entangledLanes|=p;for(f=f.entanglements;v;){var P=31-Ne(v),k=1<<P;k&p|f[P]&p&&(f[P]|=p),v&=~k}}function Vi(f,p){var v=p&-p;return v=(v&42)!==0?1:Pn(v),(v&(f.suspendedLanes|p))!==0?0:v}function Pn(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function Ot(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function Hr(){var f=Me.p;return f!==0?f:(f=window.event,f===void 0?32:Dx(f.type))}function vn(f,p){var v=Me.p;try{return Me.p=f,p()}finally{Me.p=v}}var Ts=Math.random().toString(36).slice(2),en="__reactFiber$"+Ts,Nt="__reactProps$"+Ts,hr="__reactContainer$"+Ts,Sr="__reactEvents$"+Ts,Gs="__reactListeners$"+Ts,dd="__reactHandles$"+Ts,vo="__reactResources$"+Ts,Ar="__reactMarker$"+Ts;function Pc(f){delete f[en],delete f[Nt],delete f[Sr],delete f[Gs],delete f[dd]}function bo(f){var p=f[en];if(p)return p;for(var v=f.parentNode;v;){if(p=v[hr]||v[en]){if(v=p.alternate,p.child!==null||v!==null&&v.child!==null)for(f=N_(f);f!==null;){if(v=f[en])return v;f=N_(f)}return p}f=v,v=f.parentNode}return null}function Qo(f){if(f=f[en]||f[hr]){var p=f.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return f}return null}function xo(f){var p=f.tag;if(p===5||p===26||p===27||p===6)return f.stateNode;throw Error(n(33))}function wo(f){var p=f[vo];return p||(p=f[vo]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function Hn(f){f[Ar]=!0}var Lu=new Set,Xi={};function Fr(f,p){Jo(f,p),Jo(f+"Capture",p)}function Jo(f,p){for(Xi[f]=p,f=0;f<p.length;f++)Lu.add(p[f])}var Nu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),zu={},Dl={};function Ya(f){return Rl.call(Dl,f)?!0:Rl.call(zu,f)?!1:Nu.test(f)?Dl[f]=!0:(zu[f]=!0,!1)}function $h(f,p,v){if(Ya(p))if(v===null)f.removeAttribute(p);else{switch(typeof v){case"undefined":case"function":case"symbol":f.removeAttribute(p);return;case"boolean":var P=p.toLowerCase().slice(0,5);if(P!=="data-"&&P!=="aria-"){f.removeAttribute(p);return}}f.setAttribute(p,""+v)}}function To(f,p,v){if(v===null)f.removeAttribute(p);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(p);return}f.setAttribute(p,""+v)}}function Ta(f,p,v,P){if(P===null)f.removeAttribute(v);else{switch(typeof P){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(v);return}f.setAttributeNS(p,v,""+P)}}function qr(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Op(f){var p=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Rm(f,p,v){var P=Object.getOwnPropertyDescriptor(f.constructor.prototype,p);if(!f.hasOwnProperty(p)&&typeof P<"u"&&typeof P.get=="function"&&typeof P.set=="function"){var k=P.get,B=P.set;return Object.defineProperty(f,p,{configurable:!0,get:function(){return k.call(this)},set:function(K){v=""+K,B.call(this,K)}}),Object.defineProperty(f,p,{enumerable:P.enumerable}),{getValue:function(){return v},setValue:function(K){v=""+K},stopTracking:function(){f._valueTracker=null,delete f[p]}}}}function Cc(f){if(!f._valueTracker){var p=Op(f)?"checked":"value";f._valueTracker=Rm(f,p,""+f[p])}}function Dp(f){if(!f)return!1;var p=f._valueTracker;if(!p)return!0;var v=p.getValue(),P="";return f&&(P=Op(f)?f.checked?"true":"false":f.value),f=P,f!==v?(p.setValue(f),!0):!1}function Wh(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var Om=/[\n"\\]/g;function ss(f){return f.replace(Om,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function Hh(f,p,v,P,k,B,K,pe){f.name="",K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?f.type=K:f.removeAttribute("type"),p!=null?K==="number"?(p===0&&f.value===""||f.value!=p)&&(f.value=""+qr(p)):f.value!==""+qr(p)&&(f.value=""+qr(p)):K!=="submit"&&K!=="reset"||f.removeAttribute("value"),p!=null?qh(f,K,qr(p)):v!=null?qh(f,K,qr(v)):P!=null&&f.removeAttribute("value"),k==null&&B!=null&&(f.defaultChecked=!!B),k!=null&&(f.checked=k&&typeof k!="function"&&typeof k!="symbol"),pe!=null&&typeof pe!="function"&&typeof pe!="symbol"&&typeof pe!="boolean"?f.name=""+qr(pe):f.removeAttribute("name")}function pd(f,p,v,P,k,B,K,pe){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(f.type=B),p!=null||v!=null){if(!(B!=="submit"&&B!=="reset"||p!=null)){Cc(f);return}v=v!=null?""+qr(v):"",p=p!=null?""+qr(p):v,pe||p===f.value||(f.value=p),f.defaultValue=p}P=P??k,P=typeof P!="function"&&typeof P!="symbol"&&!!P,f.checked=pe?f.checked:!!P,f.defaultChecked=!!P,K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"&&(f.name=K),Cc(f)}function qh(f,p,v){p==="number"&&Wh(f.ownerDocument)===f||f.defaultValue===""+v||(f.defaultValue=""+v)}function kl(f,p,v,P){if(f=f.options,p){p={};for(var k=0;k<v.length;k++)p["$"+v[k]]=!0;for(v=0;v<f.length;v++)k=p.hasOwnProperty("$"+f[v].value),f[v].selected!==k&&(f[v].selected=k),k&&P&&(f[v].defaultSelected=!0)}else{for(v=""+qr(v),p=null,k=0;k<f.length;k++){if(f[k].value===v){f[k].selected=!0,P&&(f[k].defaultSelected=!0);return}p!==null||f[k].disabled||(p=f[k])}p!==null&&(p.selected=!0)}}function Dm(f,p,v){if(p!=null&&(p=""+qr(p),p!==f.value&&(f.value=p),v==null)){f.defaultValue!==p&&(f.defaultValue=p);return}f.defaultValue=v!=null?""+qr(v):""}function Bu(f,p,v,P){if(p==null){if(P!=null){if(v!=null)throw Error(n(92));if(Zt(P)){if(1<P.length)throw Error(n(93));P=P[0]}v=P}v==null&&(v=""),p=v}v=qr(p),f.defaultValue=v,P=f.textContent,P===v&&P!==""&&P!==null&&(f.value=P),Cc(f)}function el(f,p){if(p){var v=f.firstChild;if(v&&v===f.lastChild&&v.nodeType===3){v.nodeValue=p;return}}f.textContent=p}var km=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Mc(f,p,v){var P=p.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?P?f.setProperty(p,""):p==="float"?f.cssFloat="":f[p]="":P?f.setProperty(p,v):typeof v!="number"||v===0||km.has(p)?p==="float"?f.cssFloat=v:f[p]=(""+v).trim():f[p]=v+"px"}function gd(f,p,v){if(p!=null&&typeof p!="object")throw Error(n(62));if(f=f.style,v!=null){for(var P in v)!v.hasOwnProperty(P)||p!=null&&p.hasOwnProperty(P)||(P.indexOf("--")===0?f.setProperty(P,""):P==="float"?f.cssFloat="":f[P]="");for(var k in p)P=p[k],p.hasOwnProperty(k)&&v[k]!==P&&Mc(f,k,P)}else for(var B in p)p.hasOwnProperty(B)&&Mc(f,B,p[B])}function Ic(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ll=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Fu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cr(f){return Fu.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}function Ka(){}var kp=null;function Xh(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var bi=null,oi=null;function Cn(f){var p=Qo(f);if(p&&(f=p.stateNode)){var v=f[Nt]||null;e:switch(f=p.stateNode,p.type){case"input":if(Hh(f,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),p=v.name,v.type==="radio"&&p!=null){for(v=f;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+ss(""+p)+'"][type="radio"]'),p=0;p<v.length;p++){var P=v[p];if(P!==f&&P.form===f.form){var k=P[Nt]||null;if(!k)throw Error(n(90));Hh(P,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(p=0;p<v.length;p++)P=v[p],P.form===f.form&&Dp(P)}break e;case"textarea":Dm(f,v.value,v.defaultValue);break e;case"select":p=v.value,p!=null&&kl(f,!!v.multiple,p,!1)}}}var pr=!1;function un(f,p,v){if(pr)return f(p,v);pr=!0;try{var P=f(p);return P}finally{if(pr=!1,(bi!==null||oi!==null)&&(mg(),bi&&(p=bi,f=oi,oi=bi=null,Cn(p),f)))for(p=0;p<f.length;p++)Cn(f[p])}}function Sa(f,p){var v=f.stateNode;if(v===null)return null;var P=v[Nt]||null;if(P===null)return null;v=P[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(f=f.type,P=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!P;break e;default:f=!1}if(f)return null;if(v&&typeof v!="function")throw Error(n(231,p,typeof v));return v}var qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),as=!1;if(qn)try{var xi={};Object.defineProperty(xi,"passive",{get:function(){as=!0}}),window.addEventListener("test",xi,xi),window.removeEventListener("test",xi,xi)}catch{as=!1}var Zs=null,So=null,Mn=null;function Nl(){if(Mn)return Mn;var f,p=So,v=p.length,P,k="value"in Zs?Zs.value:Zs.textContent,B=k.length;for(f=0;f<v&&p[f]===k[f];f++);var K=v-f;for(P=1;P<=K&&p[v-P]===k[B-P];P++);return Mn=k.slice(f,1<P?1-P:void 0)}function Ys(f){var p=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&p===13&&(f=13)):f=p,f===10&&(f=13),32<=f||f===13?f:0}function Rc(){return!0}function os(){return!1}function di(f){function p(v,P,k,B,K){this._reactName=v,this._targetInst=k,this.type=P,this.nativeEvent=B,this.target=K,this.currentTarget=null;for(var pe in f)f.hasOwnProperty(pe)&&(v=f[pe],this[pe]=v?v(B):B[pe]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?Rc:os,this.isPropagationStopped=os,this}return E(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Rc)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Rc)},persist:function(){},isPersistent:Rc}),p}var ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gh=di(ls),Oc=E({},ls,{view:0,detail:0}),Dc=di(Oc),sn,zl,kr,Er=E({},Oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kh,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==kr&&(kr&&f.type==="mousemove"?(sn=f.screenX-kr.screenX,zl=f.screenY-kr.screenY):zl=sn=0,kr=f),sn)},movementY:function(f){return"movementY"in f?f.movementY:zl}}),kc=di(Er),jr=E({},Er,{dataTransfer:0}),Zh=di(jr),Aa=E({},Oc,{relatedTarget:0}),Bl=di(Aa),Fl=E({},ls,{animationName:0,elapsedTime:0,pseudoElement:0}),Lm=di(Fl),Yh=E({},ls,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Lp=di(Yh),iv=E({},ls,{data:0}),Np=di(iv),cs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ao={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},In={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lc(f){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(f):(f=In[f])?!!p[f]:!1}function Kh(){return Lc}var Qh=E({},Oc,{key:function(f){if(f.key){var p=cs[f.key]||f.key;if(p!=="Unidentified")return p}return f.type==="keypress"?(f=Ys(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Ao[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kh,charCode:function(f){return f.type==="keypress"?Ys(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Ys(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Xn=di(Qh),Nm=E({},Er,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),md=di(Nm),zm=E({},Oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kh}),sv=di(zm),ju=E({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),_d=di(ju),Uu=E({},Er,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),zp=di(Uu),Jh=E({},ls,{newState:0,oldState:0}),Vu=di(Jh),$u=[9,13,27,32],ei=qn&&"CompositionEvent"in window,Wu=null;qn&&"documentMode"in document&&(Wu=document.documentMode);var Hu=qn&&"TextEvent"in window&&!Wu,qu=qn&&(!ei||Wu&&8<Wu&&11>=Wu),jl=" ",Bm=!1;function ef(f,p){switch(f){case"keyup":return $u.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fm(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Qa=!1;function yd(f,p){switch(f){case"compositionend":return Fm(p);case"keypress":return p.which!==32?null:(Bm=!0,jl);case"textInput":return f=p.data,f===jl&&Bm?null:f;default:return null}}function jm(f,p){if(Qa)return f==="compositionend"||!ei&&ef(f,p)?(f=Nl(),Mn=So=Zs=null,Qa=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return qu&&p.locale!=="ko"?null:p.data;default:return null}}var Um={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vd(f){var p=f&&f.nodeName&&f.nodeName.toLowerCase();return p==="input"?!!Um[f.type]:p==="textarea"}function bd(f,p,v,P){bi?oi?oi.push(P):oi=[P]:bi=P,p=bg(p,"onChange"),0<p.length&&(v=new Gh("onChange","change",null,v,P),f.push({event:v,listeners:p}))}var Nc=null,Xu=null;function Vm(f){yx(f,0)}function tf(f){var p=xo(f);if(Dp(p))return f}function Ul(f,p){if(f==="change")return p}var Bp=!1;if(qn){var rf;if(qn){var Vl="oninput"in document;if(!Vl){var Fp=document.createElement("div");Fp.setAttribute("oninput","return;"),Vl=typeof Fp.oninput=="function"}rf=Vl}else rf=!1;Bp=rf&&(!document.documentMode||9<document.documentMode)}function nf(){Nc&&(Nc.detachEvent("onpropertychange",$m),Xu=Nc=null)}function $m(f){if(f.propertyName==="value"&&tf(Xu)){var p=[];bd(p,Xu,f,Xh(f)),un(Vm,p)}}function av(f,p,v){f==="focusin"?(nf(),Nc=p,Xu=v,Nc.attachEvent("onpropertychange",$m)):f==="focusout"&&nf()}function Wm(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return tf(Xu)}function sf(f,p){if(f==="click")return tf(p)}function Hm(f,p){if(f==="input"||f==="change")return tf(p)}function jp(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var Ss=typeof Object.is=="function"?Object.is:jp;function $l(f,p){if(Ss(f,p))return!0;if(typeof f!="object"||f===null||typeof p!="object"||p===null)return!1;var v=Object.keys(f),P=Object.keys(p);if(v.length!==P.length)return!1;for(P=0;P<v.length;P++){var k=v[P];if(!Rl.call(p,k)||!Ss(f[k],p[k]))return!1}return!0}function Ea(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function af(f,p){var v=Ea(f);f=0;for(var P;v;){if(v.nodeType===3){if(P=f+v.textContent.length,f<=p&&P>=p)return{node:v,offset:p-f};f=P}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Ea(v)}}function xd(f,p){return f&&p?f===p?!0:f&&f.nodeType===3?!1:p&&p.nodeType===3?xd(f,p.parentNode):"contains"in f?f.contains(p):f.compareDocumentPosition?!!(f.compareDocumentPosition(p)&16):!1:!1}function wd(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var p=Wh(f.document);p instanceof f.HTMLIFrameElement;){try{var v=typeof p.contentWindow.location.href=="string"}catch{v=!1}if(v)f=p.contentWindow;else break;p=Wh(f.document)}return p}function of(f){var p=f&&f.nodeName&&f.nodeName.toLowerCase();return p&&(p==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||p==="textarea"||f.contentEditable==="true")}var Td=qn&&"documentMode"in document&&11>=document.documentMode,Pa=null,lf=null,cf=null,Sd=!1;function qm(f,p,v){var P=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Sd||Pa==null||Pa!==Wh(P)||(P=Pa,"selectionStart"in P&&of(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),cf&&$l(cf,P)||(cf=P,P=bg(lf,"onSelect"),0<P.length&&(p=new Gh("onSelect","select",null,p,v),f.push({event:p,listeners:P}),p.target=Pa)))}function zc(f,p){var v={};return v[f.toLowerCase()]=p.toLowerCase(),v["Webkit"+f]="webkit"+p,v["Moz"+f]="moz"+p,v}var Bc={animationend:zc("Animation","AnimationEnd"),animationiteration:zc("Animation","AnimationIteration"),animationstart:zc("Animation","AnimationStart"),transitionrun:zc("Transition","TransitionRun"),transitionstart:zc("Transition","TransitionStart"),transitioncancel:zc("Transition","TransitionCancel"),transitionend:zc("Transition","TransitionEnd")},Up={},Xr={};qn&&(Xr=document.createElement("div").style,"AnimationEvent"in window||(delete Bc.animationend.animation,delete Bc.animationiteration.animation,delete Bc.animationstart.animation),"TransitionEvent"in window||delete Bc.transitionend.transition);function Eo(f){if(Up[f])return Up[f];if(!Bc[f])return f;var p=Bc[f],v;for(v in p)if(p.hasOwnProperty(v)&&v in Xr)return Up[f]=p[v];return f}var uf=Eo("animationend"),hf=Eo("animationiteration"),Ad=Eo("animationstart"),Fc=Eo("transitionrun"),ff=Eo("transitionstart"),Gu=Eo("transitioncancel"),Ks=Eo("transitionend"),Vp=new Map,Ed="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ed.push("scrollEnd");function Qs(f,p){Vp.set(f,p),Fr(p,[f])}var Po=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)},us=[],tl=0,jc=0;function Uc(){for(var f=tl,p=jc=tl=0;p<f;){var v=us[p];us[p++]=null;var P=us[p];us[p++]=null;var k=us[p];us[p++]=null;var B=us[p];if(us[p++]=null,P!==null&&k!==null){var K=P.pending;K===null?k.next=k:(k.next=K.next,K.next=k),P.pending=k}B!==0&&$p(v,k,B)}}function df(f,p,v,P){us[tl++]=f,us[tl++]=p,us[tl++]=v,us[tl++]=P,jc|=P,f.lanes|=P,f=f.alternate,f!==null&&(f.lanes|=P)}function Wl(f,p,v,P){return df(f,p,v,P),Zu(f)}function Ca(f,p){return df(f,null,null,p),Zu(f)}function $p(f,p,v){f.lanes|=v;var P=f.alternate;P!==null&&(P.lanes|=v);for(var k=!1,B=f.return;B!==null;)B.childLanes|=v,P=B.alternate,P!==null&&(P.childLanes|=v),B.tag===22&&(f=B.stateNode,f===null||f._visibility&1||(k=!0)),f=B,B=B.return;return f.tag===3?(B=f.stateNode,k&&p!==null&&(k=31-Ne(v),f=B.hiddenUpdates,P=f[k],P===null?f[k]=[p]:P.push(p),p.lane=v|536870912),B):null}function Zu(f){if(50<gg)throw gg=0,Sv=null,Error(n(185));for(var p=f.return;p!==null;)f=p,p=f.return;return f.tag===3?f.stateNode:null}var Pr={};function Pd(f,p,v,P){this.tag=f,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Js(f,p,v,P){return new Pd(f,p,v,P)}function Cd(f){return f=f.prototype,!(!f||!f.isReactComponent)}function ea(f,p){var v=f.alternate;return v===null?(v=Js(f.tag,p,f.key,f.mode),v.elementType=f.elementType,v.type=f.type,v.stateNode=f.stateNode,v.alternate=f,f.alternate=v):(v.pendingProps=p,v.type=f.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=f.flags&65011712,v.childLanes=f.childLanes,v.lanes=f.lanes,v.child=f.child,v.memoizedProps=f.memoizedProps,v.memoizedState=f.memoizedState,v.updateQueue=f.updateQueue,p=f.dependencies,v.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},v.sibling=f.sibling,v.index=f.index,v.ref=f.ref,v.refCleanup=f.refCleanup,v}function Xm(f,p){f.flags&=65011714;var v=f.alternate;return v===null?(f.childLanes=0,f.lanes=p,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=v.childLanes,f.lanes=v.lanes,f.child=v.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=v.memoizedProps,f.memoizedState=v.memoizedState,f.updateQueue=v.updateQueue,f.type=v.type,p=v.dependencies,f.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),f}function Md(f,p,v,P,k,B){var K=0;if(P=f,typeof f=="function")Cd(f)&&(K=1);else if(typeof f=="string")K=V_(f,v,Tt.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case Xe:return f=Js(31,v,p,k),f.elementType=Xe,f.lanes=B,f;case W:return Hl(v.children,k,B,p);case j:K=8,k|=24;break;case Y:return f=Js(12,v,p,k|2),f.elementType=Y,f.lanes=B,f;case me:return f=Js(13,v,p,k),f.elementType=me,f.lanes=B,f;case ge:return f=Js(19,v,p,k),f.elementType=ge,f.lanes=B,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case re:K=10;break e;case ce:K=9;break e;case ue:K=11;break e;case Ce:K=14;break e;case We:K=16,P=null;break e}K=29,v=Error(n(130,f===null?"null":typeof f,"")),P=null}return p=Js(K,v,p,k),p.elementType=f,p.type=P,p.lanes=B,p}function Hl(f,p,v,P){return f=Js(7,f,P,p),f.lanes=v,f}function Wp(f,p,v){return f=Js(6,f,null,p),f.lanes=v,f}function Id(f){var p=Js(18,null,null,0);return p.stateNode=f,p}function ql(f,p,v){return p=Js(4,f.children!==null?f.children:[],f.key,p),p.lanes=v,p.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},p}var Yu=new WeakMap;function hs(f,p){if(typeof f=="object"&&f!==null){var v=Yu.get(f);return v!==void 0?v:(p={value:f,source:p,stack:qs(p)},Yu.set(f,p),p)}return{value:f,source:p,stack:qs(p)}}var Xl=[],Gl=0,Vc=null,Zl=0,wi=[],Ei=0,Co=null,Mo=1,As="";function rl(f,p){Xl[Gl++]=Zl,Xl[Gl++]=Vc,Vc=f,Zl=p}function Hp(f,p,v){wi[Ei++]=Mo,wi[Ei++]=As,wi[Ei++]=Co,Co=f;var P=Mo;f=As;var k=32-Ne(P)-1;P&=~(1<<k),v+=1;var B=32-Ne(p)+k;if(30<B){var K=k-k%5;B=(P&(1<<K)-1).toString(32),P>>=K,k-=K,Mo=1<<32-Ne(p)+k|v<<k|P,As=B+f}else Mo=1<<B|v<<k|P,As=f}function $c(f){f.return!==null&&(rl(f,1),Hp(f,1,0))}function Ku(f){for(;f===Vc;)Vc=Xl[--Gl],Xl[Gl]=null,Zl=Xl[--Gl],Xl[Gl]=null;for(;f===Co;)Co=wi[--Ei],wi[Ei]=null,As=wi[--Ei],wi[Ei]=null,Mo=wi[--Ei],wi[Ei]=null}function qp(f,p){wi[Ei++]=Mo,wi[Ei++]=As,wi[Ei++]=Co,Mo=p.id,As=p.overflow,Co=f}var Pi=null,hn=null,zr=!1,nl=null,ta=!1,zn=Error(n(519));function Es(f){var p=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw il(hs(p,f)),zn}function Ps(f){var p=f.stateNode,v=f.type,P=f.memoizedProps;switch(p[en]=f,p[Nt]=P,v){case"dialog":$r("cancel",p),$r("close",p);break;case"iframe":case"object":case"embed":$r("load",p);break;case"video":case"audio":for(v=0;v<fh.length;v++)$r(fh[v],p);break;case"source":$r("error",p);break;case"img":case"image":case"link":$r("error",p),$r("load",p);break;case"details":$r("toggle",p);break;case"input":$r("invalid",p),pd(p,P.value,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name,!0);break;case"select":$r("invalid",p);break;case"textarea":$r("invalid",p),Bu(p,P.value,P.defaultValue,P.children)}v=P.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||p.textContent===""+v||P.suppressHydrationWarning===!0||Bv(p.textContent,v)?(P.popover!=null&&($r("beforetoggle",p),$r("toggle",p)),P.onScroll!=null&&$r("scroll",p),P.onScrollEnd!=null&&$r("scrollend",p),P.onClick!=null&&(p.onclick=Ka),p=!0):p=!1,p||Es(f,!0)}function pf(f){for(Pi=f.return;Pi;)switch(Pi.tag){case 5:case 31:case 13:ta=!1;return;case 27:case 3:ta=!0;return;default:Pi=Pi.return}}function Io(f){if(f!==Pi)return!1;if(!zr)return pf(f),zr=!0,!1;var p=f.tag,v;if((v=p!==3&&p!==27)&&((v=p===5)&&(v=f.type,v=!(v!=="form"&&v!=="button")||D_(f.type,f.memoizedProps)),v=!v),v&&hn&&Es(f),pf(f),p===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(n(317));hn=Ki(f)}else if(p===31){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(n(317));hn=Ki(f)}else p===27?(p=hn,gh(f.type)?(f=ua,ua=null,hn=f):hn=p):hn=Pi?uo(f.stateNode.nextSibling):null;return!0}function Ro(){hn=Pi=null,zr=!1}function Oo(){var f=nl;return f!==null&&(Ba===null?Ba=f:Ba.push.apply(Ba,f),nl=null),f}function il(f){nl===null?nl=[f]:nl.push(f)}var sl=ye(null),Ma=null,Do=null;function al(f,p,v){lt(sl,p._currentValue),p._currentValue=v}function ko(f){f._currentValue=sl.current,Be(sl)}function Rd(f,p,v){for(;f!==null;){var P=f.alternate;if((f.childLanes&p)!==p?(f.childLanes|=p,P!==null&&(P.childLanes|=p)):P!==null&&(P.childLanes&p)!==p&&(P.childLanes|=p),f===v)break;f=f.return}}function Od(f,p,v,P){var k=f.child;for(k!==null&&(k.return=f);k!==null;){var B=k.dependencies;if(B!==null){var K=k.child;B=B.firstContext;e:for(;B!==null;){var pe=B;B=k;for(var je=0;je<p.length;je++)if(pe.context===p[je]){B.lanes|=v,pe=B.alternate,pe!==null&&(pe.lanes|=v),Rd(B.return,v,f),P||(K=null);break e}B=pe.next}}else if(k.tag===18){if(K=k.return,K===null)throw Error(n(341));K.lanes|=v,B=K.alternate,B!==null&&(B.lanes|=v),Rd(K,v,f),K=null}else K=k.child;if(K!==null)K.return=k;else for(K=k;K!==null;){if(K===f){K=null;break}if(k=K.sibling,k!==null){k.return=K.return,K=k;break}K=K.return}k=K}}function ra(f,p,v,P){f=null;for(var k=p,B=!1;k!==null;){if(!B){if((k.flags&524288)!==0)B=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var K=k.alternate;if(K===null)throw Error(n(387));if(K=K.memoizedProps,K!==null){var pe=k.type;Ss(k.pendingProps.value,K.value)||(f!==null?f.push(pe):f=[pe])}}else if(k===Wt.current){if(K=k.alternate,K===null)throw Error(n(387));K.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(f!==null?f.push(Og):f=[Og])}k=k.return}f!==null&&Od(p,f,v,P),p.flags|=262144}function Qu(f){for(f=f.firstContext;f!==null;){if(!Ss(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function ol(f){Ma=f,Do=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function li(f){return Dd(Ma,f)}function gf(f,p){return Ma===null&&ol(f),Dd(f,p)}function Dd(f,p){var v=p._currentValue;if(p={context:p,memoizedValue:v,next:null},Do===null){if(f===null)throw Error(n(308));Do=p,f.dependencies={lanes:0,firstContext:p},f.flags|=524288}else Do=Do.next=p;return v}var Xp=typeof AbortController<"u"?AbortController:function(){var f=[],p=this.signal={aborted:!1,addEventListener:function(v,P){f.push(P)}};this.abort=function(){p.aborted=!0,f.forEach(function(v){return v()})}},Gm=t.unstable_scheduleCallback,Gp=t.unstable_NormalPriority,ti={$$typeof:re,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Lo(){return{controller:new Xp,data:new Map,refCount:0}}function Ju(f){f.refCount--,f.refCount===0&&Gm(Gp,function(){f.controller.abort()})}var Gi=null,na=0,Wc=0,Zi=null;function ov(f,p){if(Gi===null){var v=Gi=[];na=0,Wc=Dv(),Zi={status:"pending",value:void 0,then:function(P){v.push(P)}}}return na++,p.then(eh,eh),p}function eh(){if(--na===0&&Gi!==null){Zi!==null&&(Zi.status="fulfilled");var f=Gi;Gi=null,Wc=0,Zi=null;for(var p=0;p<f.length;p++)(0,f[p])()}}function mf(f,p){var v=[],P={status:"pending",value:null,reason:null,then:function(k){v.push(k)}};return f.then(function(){P.status="fulfilled",P.value=p;for(var k=0;k<v.length;k++)(0,v[k])(p)},function(k){for(P.status="rejected",P.reason=k,k=0;k<v.length;k++)(0,v[k])(void 0)}),P}var Ti=fe.S;fe.S=function(f,p){tx=vi(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&ov(f,p),Ti!==null&&Ti(f,p)};var Ja=ye(null);function kd(){var f=Ja.current;return f!==null?f:Dn.pooledCache}function Ld(f,p){p===null?lt(Ja,Ja.current):lt(Ja,p.pool)}function Zm(){var f=kd();return f===null?null:{parent:ti._currentValue,pool:f}}var eo=Error(n(460)),Yl=Error(n(474)),Cs=Error(n(542)),Ht={then:function(){}};function _f(f){return f=f.status,f==="fulfilled"||f==="rejected"}function Nd(f,p,v){switch(v=f[v],v===void 0?f.push(p):v!==p&&(p.then(Ka,Ka),p=v),p.status){case"fulfilled":return p.value;case"rejected":throw f=p.reason,zd(f),f;default:if(typeof p.status=="string")p.then(Ka,Ka);else{if(f=Dn,f!==null&&100<f.shellSuspendCounter)throw Error(n(482));f=p,f.status="pending",f.then(function(P){if(p.status==="pending"){var k=p;k.status="fulfilled",k.value=P}},function(P){if(p.status==="pending"){var k=p;k.status="rejected",k.reason=P}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw f=p.reason,zd(f),f}throw to=p,eo}}function Ia(f){try{var p=f._init;return p(f._payload)}catch(v){throw v!==null&&typeof v=="object"&&typeof v.then=="function"?(to=v,eo):v}}var to=null;function th(){if(to===null)throw Error(n(459));var f=to;return to=null,f}function zd(f){if(f===eo||f===Cs)throw Error(n(483))}var No=null,Hc=0;function yf(f){var p=Hc;return Hc+=1,No===null&&(No=[]),Nd(No,f,p)}function zo(f,p){p=p.props.ref,f.ref=p!==void 0?p:null}function Bd(f,p){throw p.$$typeof===O?Error(n(525)):(f=Object.prototype.toString.call(p),Error(n(31,f==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":f)))}function vf(f){function p(Qe,$e){if(f){var ht=Qe.deletions;ht===null?(Qe.deletions=[$e],Qe.flags|=16):ht.push($e)}}function v(Qe,$e){if(!f)return null;for(;$e!==null;)p(Qe,$e),$e=$e.sibling;return null}function P(Qe){for(var $e=new Map;Qe!==null;)Qe.key!==null?$e.set(Qe.key,Qe):$e.set(Qe.index,Qe),Qe=Qe.sibling;return $e}function k(Qe,$e){return Qe=ea(Qe,$e),Qe.index=0,Qe.sibling=null,Qe}function B(Qe,$e,ht){return Qe.index=ht,f?(ht=Qe.alternate,ht!==null?(ht=ht.index,ht<$e?(Qe.flags|=67108866,$e):ht):(Qe.flags|=67108866,$e)):(Qe.flags|=1048576,$e)}function K(Qe){return f&&Qe.alternate===null&&(Qe.flags|=67108866),Qe}function pe(Qe,$e,ht,Mt){return $e===null||$e.tag!==6?($e=Wp(ht,Qe.mode,Mt),$e.return=Qe,$e):($e=k($e,ht),$e.return=Qe,$e)}function je(Qe,$e,ht,Mt){var gr=ht.type;return gr===W?At(Qe,$e,ht.props.children,Mt,ht.key):$e!==null&&($e.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===We&&Ia(gr)===$e.type)?($e=k($e,ht.props),zo($e,ht),$e.return=Qe,$e):($e=Md(ht.type,ht.key,ht.props,null,Qe.mode,Mt),zo($e,ht),$e.return=Qe,$e)}function ft(Qe,$e,ht,Mt){return $e===null||$e.tag!==4||$e.stateNode.containerInfo!==ht.containerInfo||$e.stateNode.implementation!==ht.implementation?($e=ql(ht,Qe.mode,Mt),$e.return=Qe,$e):($e=k($e,ht.children||[]),$e.return=Qe,$e)}function At(Qe,$e,ht,Mt,gr){return $e===null||$e.tag!==7?($e=Hl(ht,Qe.mode,Mt,gr),$e.return=Qe,$e):($e=k($e,ht),$e.return=Qe,$e)}function Dt(Qe,$e,ht){if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return $e=Wp(""+$e,Qe.mode,ht),$e.return=Qe,$e;if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case N:return ht=Md($e.type,$e.key,$e.props,null,Qe.mode,ht),zo(ht,$e),ht.return=Qe,ht;case V:return $e=ql($e,Qe.mode,ht),$e.return=Qe,$e;case We:return $e=Ia($e),Dt(Qe,$e,ht)}if(Zt($e)||Ye($e))return $e=Hl($e,Qe.mode,ht,null),$e.return=Qe,$e;if(typeof $e.then=="function")return Dt(Qe,yf($e),ht);if($e.$$typeof===re)return Dt(Qe,gf(Qe,$e),ht);Bd(Qe,$e)}return null}function dt(Qe,$e,ht,Mt){var gr=$e!==null?$e.key:null;if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return gr!==null?null:pe(Qe,$e,""+ht,Mt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case N:return ht.key===gr?je(Qe,$e,ht,Mt):null;case V:return ht.key===gr?ft(Qe,$e,ht,Mt):null;case We:return ht=Ia(ht),dt(Qe,$e,ht,Mt)}if(Zt(ht)||Ye(ht))return gr!==null?null:At(Qe,$e,ht,Mt,null);if(typeof ht.then=="function")return dt(Qe,$e,yf(ht),Mt);if(ht.$$typeof===re)return dt(Qe,$e,gf(Qe,ht),Mt);Bd(Qe,ht)}return null}function yt(Qe,$e,ht,Mt,gr){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return Qe=Qe.get(ht)||null,pe($e,Qe,""+Mt,gr);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case N:return Qe=Qe.get(Mt.key===null?ht:Mt.key)||null,je($e,Qe,Mt,gr);case V:return Qe=Qe.get(Mt.key===null?ht:Mt.key)||null,ft($e,Qe,Mt,gr);case We:return Mt=Ia(Mt),yt(Qe,$e,ht,Mt,gr)}if(Zt(Mt)||Ye(Mt))return Qe=Qe.get(ht)||null,At($e,Qe,Mt,gr,null);if(typeof Mt.then=="function")return yt(Qe,$e,ht,yf(Mt),gr);if(Mt.$$typeof===re)return yt(Qe,$e,ht,gf($e,Mt),gr);Bd($e,Mt)}return null}function rr(Qe,$e,ht,Mt){for(var gr=null,ln=null,lr=$e,Ir=$e=0,br=null;lr!==null&&Ir<ht.length;Ir++){lr.index>Ir?(br=lr,lr=null):br=lr.sibling;var Jr=dt(Qe,lr,ht[Ir],Mt);if(Jr===null){lr===null&&(lr=br);break}f&&lr&&Jr.alternate===null&&p(Qe,lr),$e=B(Jr,$e,Ir),ln===null?gr=Jr:ln.sibling=Jr,ln=Jr,lr=br}if(Ir===ht.length)return v(Qe,lr),zr&&rl(Qe,Ir),gr;if(lr===null){for(;Ir<ht.length;Ir++)lr=Dt(Qe,ht[Ir],Mt),lr!==null&&($e=B(lr,$e,Ir),ln===null?gr=lr:ln.sibling=lr,ln=lr);return zr&&rl(Qe,Ir),gr}for(lr=P(lr);Ir<ht.length;Ir++)br=yt(lr,Qe,Ir,ht[Ir],Mt),br!==null&&(f&&br.alternate!==null&&lr.delete(br.key===null?Ir:br.key),$e=B(br,$e,Ir),ln===null?gr=br:ln.sibling=br,ln=br);return f&&lr.forEach(function(pu){return p(Qe,pu)}),zr&&rl(Qe,Ir),gr}function wr(Qe,$e,ht,Mt){if(ht==null)throw Error(n(151));for(var gr=null,ln=null,lr=$e,Ir=$e=0,br=null,Jr=ht.next();lr!==null&&!Jr.done;Ir++,Jr=ht.next()){lr.index>Ir?(br=lr,lr=null):br=lr.sibling;var pu=dt(Qe,lr,Jr.value,Mt);if(pu===null){lr===null&&(lr=br);break}f&&lr&&pu.alternate===null&&p(Qe,lr),$e=B(pu,$e,Ir),ln===null?gr=pu:ln.sibling=pu,ln=pu,lr=br}if(Jr.done)return v(Qe,lr),zr&&rl(Qe,Ir),gr;if(lr===null){for(;!Jr.done;Ir++,Jr=ht.next())Jr=Dt(Qe,Jr.value,Mt),Jr!==null&&($e=B(Jr,$e,Ir),ln===null?gr=Jr:ln.sibling=Jr,ln=Jr);return zr&&rl(Qe,Ir),gr}for(lr=P(lr);!Jr.done;Ir++,Jr=ht.next())Jr=yt(lr,Qe,Ir,Jr.value,Mt),Jr!==null&&(f&&Jr.alternate!==null&&lr.delete(Jr.key===null?Ir:Jr.key),$e=B(Jr,$e,Ir),ln===null?gr=Jr:ln.sibling=Jr,ln=Jr);return f&&lr.forEach(function(jx){return p(Qe,jx)}),zr&&rl(Qe,Ir),gr}function mn(Qe,$e,ht,Mt){if(typeof ht=="object"&&ht!==null&&ht.type===W&&ht.key===null&&(ht=ht.props.children),typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case N:e:{for(var gr=ht.key;$e!==null;){if($e.key===gr){if(gr=ht.type,gr===W){if($e.tag===7){v(Qe,$e.sibling),Mt=k($e,ht.props.children),Mt.return=Qe,Qe=Mt;break e}}else if($e.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===We&&Ia(gr)===$e.type){v(Qe,$e.sibling),Mt=k($e,ht.props),zo(Mt,ht),Mt.return=Qe,Qe=Mt;break e}v(Qe,$e);break}else p(Qe,$e);$e=$e.sibling}ht.type===W?(Mt=Hl(ht.props.children,Qe.mode,Mt,ht.key),Mt.return=Qe,Qe=Mt):(Mt=Md(ht.type,ht.key,ht.props,null,Qe.mode,Mt),zo(Mt,ht),Mt.return=Qe,Qe=Mt)}return K(Qe);case V:e:{for(gr=ht.key;$e!==null;){if($e.key===gr)if($e.tag===4&&$e.stateNode.containerInfo===ht.containerInfo&&$e.stateNode.implementation===ht.implementation){v(Qe,$e.sibling),Mt=k($e,ht.children||[]),Mt.return=Qe,Qe=Mt;break e}else{v(Qe,$e);break}else p(Qe,$e);$e=$e.sibling}Mt=ql(ht,Qe.mode,Mt),Mt.return=Qe,Qe=Mt}return K(Qe);case We:return ht=Ia(ht),mn(Qe,$e,ht,Mt)}if(Zt(ht))return rr(Qe,$e,ht,Mt);if(Ye(ht)){if(gr=Ye(ht),typeof gr!="function")throw Error(n(150));return ht=gr.call(ht),wr(Qe,$e,ht,Mt)}if(typeof ht.then=="function")return mn(Qe,$e,yf(ht),Mt);if(ht.$$typeof===re)return mn(Qe,$e,gf(Qe,ht),Mt);Bd(Qe,ht)}return typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint"?(ht=""+ht,$e!==null&&$e.tag===6?(v(Qe,$e.sibling),Mt=k($e,ht),Mt.return=Qe,Qe=Mt):(v(Qe,$e),Mt=Wp(ht,Qe.mode,Mt),Mt.return=Qe,Qe=Mt),K(Qe)):v(Qe,$e)}return function(Qe,$e,ht,Mt){try{Hc=0;var gr=mn(Qe,$e,ht,Mt);return No=null,gr}catch(lr){if(lr===eo||lr===Cs)throw lr;var ln=Js(29,lr,null,Qe.mode);return ln.lanes=Mt,ln.return=Qe,ln}}}var Bo=vf(!0),Zp=vf(!1),Fo=!1;function Fd(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bf(f,p){f=f.updateQueue,p.updateQueue===f&&(p.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function jo(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function ll(f,p,v){var P=f.updateQueue;if(P===null)return null;if(P=P.shared,(pn&2)!==0){var k=P.pending;return k===null?p.next=p:(p.next=k.next,k.next=p),P.pending=p,p=Zu(f),$p(f,null,v),p}return df(f,P,p,v),Zu(f)}function Ra(f,p,v){if(p=p.updateQueue,p!==null&&(p=p.shared,(v&4194048)!==0)){var P=p.lanes;P&=f.pendingLanes,v|=P,p.lanes=v,Nn(f,v)}}function tn(f,p){var v=f.updateQueue,P=f.alternate;if(P!==null&&(P=P.updateQueue,v===P)){var k=null,B=null;if(v=v.firstBaseUpdate,v!==null){do{var K={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};B===null?k=B=K:B=B.next=K,v=v.next}while(v!==null);B===null?k=B=p:B=B.next=p}else k=B=p;v={baseState:P.baseState,firstBaseUpdate:k,lastBaseUpdate:B,shared:P.shared,callbacks:P.callbacks},f.updateQueue=v;return}f=v.lastBaseUpdate,f===null?v.firstBaseUpdate=p:f.next=p,v.lastBaseUpdate=p}var Yp=!1;function cl(){if(Yp){var f=Zi;if(f!==null)throw f}}function Kl(f,p,v,P){Yp=!1;var k=f.updateQueue;Fo=!1;var B=k.firstBaseUpdate,K=k.lastBaseUpdate,pe=k.shared.pending;if(pe!==null){k.shared.pending=null;var je=pe,ft=je.next;je.next=null,K===null?B=ft:K.next=ft,K=je;var At=f.alternate;At!==null&&(At=At.updateQueue,pe=At.lastBaseUpdate,pe!==K&&(pe===null?At.firstBaseUpdate=ft:pe.next=ft,At.lastBaseUpdate=je))}if(B!==null){var Dt=k.baseState;K=0,At=ft=je=null,pe=B;do{var dt=pe.lane&-536870913,yt=dt!==pe.lane;if(yt?(Vr&dt)===dt:(P&dt)===dt){dt!==0&&dt===Wc&&(Yp=!0),At!==null&&(At=At.next={lane:0,tag:pe.tag,payload:pe.payload,callback:null,next:null});e:{var rr=f,wr=pe;dt=p;var mn=v;switch(wr.tag){case 1:if(rr=wr.payload,typeof rr=="function"){Dt=rr.call(mn,Dt,dt);break e}Dt=rr;break e;case 3:rr.flags=rr.flags&-65537|128;case 0:if(rr=wr.payload,dt=typeof rr=="function"?rr.call(mn,Dt,dt):rr,dt==null)break e;Dt=E({},Dt,dt);break e;case 2:Fo=!0}}dt=pe.callback,dt!==null&&(f.flags|=64,yt&&(f.flags|=8192),yt=k.callbacks,yt===null?k.callbacks=[dt]:yt.push(dt))}else yt={lane:dt,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null},At===null?(ft=At=yt,je=Dt):At=At.next=yt,K|=dt;if(pe=pe.next,pe===null){if(pe=k.shared.pending,pe===null)break;yt=pe,pe=yt.next,yt.next=null,k.lastBaseUpdate=yt,k.shared.pending=null}}while(!0);At===null&&(je=Dt),k.baseState=je,k.firstBaseUpdate=ft,k.lastBaseUpdate=At,B===null&&(k.shared.lanes=0),su|=K,f.lanes=K,f.memoizedState=Dt}}function xf(f,p){if(typeof f!="function")throw Error(n(191,f));f.call(p)}function jd(f,p){var v=f.callbacks;if(v!==null)for(f.callbacks=null,f=0;f<v.length;f++)xf(v[f],p)}var qc=ye(null),wf=ye(0);function Kp(f,p){f=iu,lt(wf,f),lt(qc,p),iu=f|p.baseLanes}function ia(){lt(wf,iu),lt(qc,qc.current)}function Xc(){iu=wf.current,Be(qc),Be(wf)}var qt=ye(null),er=null;function Oa(f){var p=f.alternate;lt(Gn,Gn.current&1),lt(qt,f),er===null&&(p===null||qc.current!==null||p.memoizedState!==null)&&(er=f)}function rh(f){lt(Gn,Gn.current),lt(qt,f),er===null&&(er=f)}function Tf(f){f.tag===22?(lt(Gn,Gn.current),lt(qt,f),er===null&&(er=f)):ri()}function ri(){lt(Gn,Gn.current),lt(qt,qt.current)}function Bn(f){Be(qt),er===f&&(er=null),Be(Gn)}var Gn=ye(0);function Sf(f){for(var p=f;p!==null;){if(p.tag===13){var v=p.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||Os(v)||jn(v)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===f)break;for(;p.sibling===null;){if(p.return===null||p.return===f)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var ul=0,Dr=null,Kr=null,Rr=null,Rn=!1,Da=!1,ro=!1,Gc=0,Zc=0,hl=null,Qp=0;function wn(){throw Error(n(321))}function no(f,p){if(p===null)return!1;for(var v=0;v<p.length&&v<f.length;v++)if(!Ss(f[v],p[v]))return!1;return!0}function nh(f,p,v,P,k,B){return ul=B,Dr=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,fe.H=f===null||f.memoizedState===null?dn:ci,ro=!1,B=v(P,k),ro=!1,Da&&(B=Af(p,v,P,k)),ih(f),B}function ih(f){fe.H=rn;var p=Kr!==null&&Kr.next!==null;if(ul=0,Rr=Kr=Dr=null,Rn=!1,Zc=0,hl=null,p)throw Error(n(300));f===null||Ii||(f=f.dependencies,f!==null&&Qu(f)&&(Ii=!0))}function Af(f,p,v,P){Dr=f;var k=0;do{if(Da&&(hl=null),Zc=0,Da=!1,25<=k)throw Error(n(301));if(k+=1,Rr=Kr=null,f.updateQueue!=null){var B=f.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}fe.H=pi,B=p(v,P)}while(Da);return B}function Ef(){var f=fe.H,p=f.useState()[0];return p=typeof p.then=="function"?Yc(p):p,f=f.useState()[0],(Kr!==null?Kr.memoizedState:null)!==f&&(Dr.flags|=1024),p}function Pf(){var f=Gc!==0;return Gc=0,f}function Ql(f,p,v){p.updateQueue=f.updateQueue,p.flags&=-2053,f.lanes&=~v}function fl(f){if(Rn){for(f=f.memoizedState;f!==null;){var p=f.queue;p!==null&&(p.pending=null),f=f.next}Rn=!1}ul=0,Rr=Kr=Dr=null,Da=!1,Zc=Gc=0,hl=null}function $i(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rr===null?Dr.memoizedState=Rr=f:Rr=Rr.next=f,Rr}function On(){if(Kr===null){var f=Dr.alternate;f=f!==null?f.memoizedState:null}else f=Kr.next;var p=Rr===null?Dr.memoizedState:Rr.next;if(p!==null)Rr=p,Kr=f;else{if(f===null)throw Dr.alternate===null?Error(n(467)):Error(n(310));Kr=f,f={memoizedState:Kr.memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},Rr===null?Dr.memoizedState=Rr=f:Rr=Rr.next=f}return Rr}function Uo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yc(f){var p=Zc;return Zc+=1,hl===null&&(hl=[]),f=Nd(hl,f,p),p=Dr,(Rr===null?p.memoizedState:Rr.next)===null&&(p=p.alternate,fe.H=p===null||p.memoizedState===null?dn:ci),f}function Kc(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return Yc(f);if(f.$$typeof===re)return li(f)}throw Error(n(438,String(f)))}function sh(f){var p=null,v=Dr.updateQueue;if(v!==null&&(p=v.memoCache),p==null){var P=Dr.alternate;P!==null&&(P=P.updateQueue,P!==null&&(P=P.memoCache,P!=null&&(p={data:P.data.map(function(k){return k.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),v===null&&(v=Uo(),Dr.updateQueue=v),v.memoCache=p,v=p.data[p.index],v===void 0)for(v=p.data[p.index]=Array(f),P=0;P<f;P++)v[P]=Et;return p.index++,v}function io(f,p){return typeof p=="function"?p(f):p}function A(f){var p=On();return o(p,Kr,f)}function o(f,p,v){var P=f.queue;if(P===null)throw Error(n(311));P.lastRenderedReducer=v;var k=f.baseQueue,B=P.pending;if(B!==null){if(k!==null){var K=k.next;k.next=B.next,B.next=K}p.baseQueue=k=B,P.pending=null}if(B=f.baseState,k===null)f.memoizedState=B;else{p=k.next;var pe=K=null,je=null,ft=p,At=!1;do{var Dt=ft.lane&-536870913;if(Dt!==ft.lane?(Vr&Dt)===Dt:(ul&Dt)===Dt){var dt=ft.revertLane;if(dt===0)je!==null&&(je=je.next={lane:0,revertLane:0,gesture:null,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null}),Dt===Wc&&(At=!0);else if((ul&dt)===dt){ft=ft.next,dt===Wc&&(At=!0);continue}else Dt={lane:0,revertLane:ft.revertLane,gesture:null,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null},je===null?(pe=je=Dt,K=B):je=je.next=Dt,Dr.lanes|=dt,su|=dt;Dt=ft.action,ro&&v(B,Dt),B=ft.hasEagerState?ft.eagerState:v(B,Dt)}else dt={lane:Dt,revertLane:ft.revertLane,gesture:ft.gesture,action:ft.action,hasEagerState:ft.hasEagerState,eagerState:ft.eagerState,next:null},je===null?(pe=je=dt,K=B):je=je.next=dt,Dr.lanes|=Dt,su|=Dt;ft=ft.next}while(ft!==null&&ft!==p);if(je===null?K=B:je.next=pe,!Ss(B,f.memoizedState)&&(Ii=!0,At&&(v=Zi,v!==null)))throw v;f.memoizedState=B,f.baseState=K,f.baseQueue=je,P.lastRenderedState=B}return k===null&&(P.lanes=0),[f.memoizedState,P.dispatch]}function d(f){var p=On(),v=p.queue;if(v===null)throw Error(n(311));v.lastRenderedReducer=f;var P=v.dispatch,k=v.pending,B=p.memoizedState;if(k!==null){v.pending=null;var K=k=k.next;do B=f(B,K.action),K=K.next;while(K!==k);Ss(B,p.memoizedState)||(Ii=!0),p.memoizedState=B,p.baseQueue===null&&(p.baseState=B),v.lastRenderedState=B}return[B,P]}function _(f,p,v){var P=Dr,k=On(),B=zr;if(B){if(v===void 0)throw Error(n(407));v=v()}else v=p();var K=!Ss((Kr||k).memoizedState,v);if(K&&(k.memoizedState=v,Ii=!0),k=k.queue,ot(I.bind(null,P,k,f),[f]),k.getSnapshot!==p||K||Rr!==null&&Rr.memoizedState.tag&1){if(P.flags|=2048,Re(9,{destroy:void 0},C.bind(null,P,k,v,p),null),Dn===null)throw Error(n(349));B||(ul&127)!==0||x(P,p,v)}return v}function x(f,p,v){f.flags|=16384,f={getSnapshot:p,value:v},p=Dr.updateQueue,p===null?(p=Uo(),Dr.updateQueue=p,p.stores=[f]):(v=p.stores,v===null?p.stores=[f]:v.push(f))}function C(f,p,v,P){p.value=v,p.getSnapshot=P,D(p)&&z(f)}function I(f,p,v){return v(function(){D(p)&&z(f)})}function D(f){var p=f.getSnapshot;f=f.value;try{var v=p();return!Ss(f,v)}catch{return!0}}function z(f){var p=Ca(f,2);p!==null&&ja(p,f,2)}function $(f){var p=$i();if(typeof f=="function"){var v=f;if(f=v(),ro){Pe(!0);try{v()}finally{Pe(!1)}}}return p.memoizedState=p.baseState=f,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:f},p}function H(f,p,v,P){return f.baseState=v,o(f,Kr,typeof P=="function"?P:io)}function Z(f,p,v,P,k){if(sa(f))throw Error(n(485));if(f=p.action,f!==null){var B={payload:k,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(K){B.listeners.push(K)}};fe.T!==null?v(!0):B.isTransition=!1,P(B),v=p.pending,v===null?(B.next=p.pending=B,G(p,B)):(B.next=v.next,p.pending=v.next=B)}}function G(f,p){var v=p.action,P=p.payload,k=f.state;if(p.isTransition){var B=fe.T,K={};fe.T=K;try{var pe=v(k,P),je=fe.S;je!==null&&je(K,pe),ne(f,p,pe)}catch(ft){_e(f,p,ft)}finally{B!==null&&K.types!==null&&(B.types=K.types),fe.T=B}}else try{B=v(k,P),ne(f,p,B)}catch(ft){_e(f,p,ft)}}function ne(f,p,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(P){le(f,p,P)},function(P){return _e(f,p,P)}):le(f,p,v)}function le(f,p,v){p.status="fulfilled",p.value=v,xe(p),f.state=v,p=f.pending,p!==null&&(v=p.next,v===p?f.pending=null:(v=v.next,p.next=v,G(f,v)))}function _e(f,p,v){var P=f.pending;if(f.pending=null,P!==null){P=P.next;do p.status="rejected",p.reason=v,xe(p),p=p.next;while(p!==P)}f.action=null}function xe(f){f=f.listeners;for(var p=0;p<f.length;p++)(0,f[p])()}function be(f,p){return p}function Ae(f,p){if(zr){var v=Dn.formState;if(v!==null){e:{var P=Dr;if(zr){if(hn){t:{for(var k=hn,B=ta;k.nodeType!==8;){if(!B){k=null;break t}if(k=uo(k.nextSibling),k===null){k=null;break t}}B=k.data,k=B==="F!"||B==="F"?k:null}if(k){hn=uo(k.nextSibling),P=k.data==="F!";break e}}Es(P)}P=!1}P&&(p=v[0])}}return v=$i(),v.memoizedState=v.baseState=p,P={pending:null,lanes:0,dispatch:null,lastRenderedReducer:be,lastRenderedState:p},v.queue=P,v=ah.bind(null,Dr,P),P.dispatch=v,P=$(!1),B=Is.bind(null,Dr,!1,P.queue),P=$i(),k={state:p,dispatch:null,action:f,pending:null},P.queue=k,v=Z.bind(null,Dr,k,B,v),k.dispatch=v,P.memoizedState=f,[p,v,!1]}function ke(f){var p=On();return Se(p,Kr,f)}function Se(f,p,v){if(p=o(f,p,be)[0],f=A(io)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var P=Yc(p)}catch(K){throw K===eo?Cs:K}else P=p;p=On();var k=p.queue,B=k.dispatch;return v!==p.memoizedState&&(Dr.flags|=2048,Re(9,{destroy:void 0},De.bind(null,k,v),null)),[P,B,f]}function De(f,p){f.action=p}function ze(f){var p=On(),v=Kr;if(v!==null)return Se(p,v,f);On(),p=p.memoizedState,v=On();var P=v.queue.dispatch;return v.memoizedState=f,[p,P,!1]}function Re(f,p,v,P){return f={tag:f,create:v,deps:P,inst:p,next:null},p=Dr.updateQueue,p===null&&(p=Uo(),Dr.updateQueue=p),v=p.lastEffect,v===null?p.lastEffect=f.next=f:(P=v.next,v.next=f,f.next=P,p.lastEffect=f),f}function Ve(){return On().memoizedState}function ct(f,p,v,P){var k=$i();Dr.flags|=f,k.memoizedState=Re(1|p,{destroy:void 0},v,P===void 0?null:P)}function nt(f,p,v,P){var k=On();P=P===void 0?null:P;var B=k.memoizedState.inst;Kr!==null&&P!==null&&no(P,Kr.memoizedState.deps)?k.memoizedState=Re(p,B,v,P):(Dr.flags|=f,k.memoizedState=Re(1|p,B,v,P))}function at(f,p){ct(8390656,8,f,p)}function ot(f,p){nt(2048,8,f,p)}function Ft(f){Dr.flags|=4;var p=Dr.updateQueue;if(p===null)p=Uo(),Dr.updateQueue=p,p.events=[f];else{var v=p.events;v===null?p.events=[f]:v.push(f)}}function Ut(f){var p=On().memoizedState;return Ft({ref:p,nextImpl:f}),function(){if((pn&2)!==0)throw Error(n(440));return p.impl.apply(void 0,arguments)}}function Pt(f,p){return nt(4,2,f,p)}function $t(f,p){return nt(4,4,f,p)}function xr(f,p){if(typeof p=="function"){f=f();var v=p(f);return function(){typeof v=="function"?v():p(null)}}if(p!=null)return f=f(),p.current=f,function(){p.current=null}}function Qr(f,p,v){v=v!=null?v.concat([f]):null,nt(4,4,xr.bind(null,p,f),v)}function _n(){}function fn(f,p){var v=On();p=p===void 0?null:p;var P=v.memoizedState;return p!==null&&no(p,P[1])?P[0]:(v.memoizedState=[f,p],f)}function Tn(f,p){var v=On();p=p===void 0?null:p;var P=v.memoizedState;if(p!==null&&no(p,P[1]))return P[0];if(P=f(),ro){Pe(!0);try{f()}finally{Pe(!1)}}return v.memoizedState=[P,p],P}function an(f,p,v){return v===void 0||(ul&1073741824)!==0&&(Vr&261930)===0?f.memoizedState=p:(f.memoizedState=v,f=nx(),Dr.lanes|=f,su|=f,v)}function Fn(f,p,v,P){return Ss(v,p)?v:qc.current!==null?(f=an(f,v,P),Ss(f,p)||(Ii=!0),f):(ul&42)===0||(ul&1073741824)!==0&&(Vr&261930)===0?(Ii=!0,f.memoizedState=v):(f=nx(),Dr.lanes|=f,su|=f,p)}function Sn(f,p,v,P,k){var B=Me.p;Me.p=B!==0&&8>B?B:8;var K=fe.T,pe={};fe.T=pe,Is(f,!1,p,v);try{var je=k(),ft=fe.S;if(ft!==null&&ft(pe,je),je!==null&&typeof je=="object"&&typeof je.then=="function"){var At=mf(je,P);ao(f,p,At,Fa(f))}else ao(f,p,P,Fa(f))}catch(Dt){ao(f,p,{then:function(){},status:"rejected",reason:Dt},Fa())}finally{Me.p=B,K!==null&&pe.types!==null&&(K.types=pe.types),fe.T=K}}function Ci(){}function Zn(f,p,v,P){if(f.tag!==5)throw Error(n(476));var k=Yn(f).queue;Sn(f,k,p,Ee,v===null?Ci:function(){return Mi(f),v(P)})}function Yn(f){var p=f.memoizedState;if(p!==null)return p;p={memoizedState:Ee,baseState:Ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:Ee},next:null};var v={};return p.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:v},next:null},f.memoizedState=p,f=f.alternate,f!==null&&(f.memoizedState=p),p}function Mi(f){var p=Yn(f);p.next===null&&(p=f.alternate.memoizedState),ao(f,p.next.queue,{},Fa())}function Vo(){return li(Og)}function $o(){return On().memoizedState}function so(){return On().memoizedState}function Ms(f){for(var p=f.return;p!==null;){switch(p.tag){case 24:case 3:var v=Fa();f=jo(v);var P=ll(p,f,v);P!==null&&(ja(P,p,v),Ra(P,p,v)),p={cache:Lo()},f.payload=p;return}p=p.return}}function Qc(f,p,v){var P=Fa();v={lane:P,revertLane:0,gesture:null,action:v,hasEagerState:!1,eagerState:null,next:null},sa(f)?ka(p,v):(v=Wl(f,p,v,P),v!==null&&(ja(v,f,P),La(v,p,P)))}function ah(f,p,v){var P=Fa();ao(f,p,v,P)}function ao(f,p,v,P){var k={lane:P,revertLane:0,gesture:null,action:v,hasEagerState:!1,eagerState:null,next:null};if(sa(f))ka(p,k);else{var B=f.alternate;if(f.lanes===0&&(B===null||B.lanes===0)&&(B=p.lastRenderedReducer,B!==null))try{var K=p.lastRenderedState,pe=B(K,v);if(k.hasEagerState=!0,k.eagerState=pe,Ss(pe,K))return df(f,p,k,0),Dn===null&&Uc(),!1}catch{}if(v=Wl(f,p,k,P),v!==null)return ja(v,f,P),La(v,p,P),!0}return!1}function Is(f,p,v,P){if(P={lane:2,revertLane:Dv(),gesture:null,action:P,hasEagerState:!1,eagerState:null,next:null},sa(f)){if(p)throw Error(n(479))}else p=Wl(f,v,P,2),p!==null&&ja(p,f,2)}function sa(f){var p=f.alternate;return f===Dr||p!==null&&p===Dr}function ka(f,p){Da=Rn=!0;var v=f.pending;v===null?p.next=p:(p.next=v.next,v.next=p),f.pending=p}function La(f,p,v){if((v&4194048)!==0){var P=p.lanes;P&=f.pendingLanes,v|=P,p.lanes=v,Nn(f,v)}}var rn={readContext:li,use:Kc,useCallback:wn,useContext:wn,useEffect:wn,useImperativeHandle:wn,useLayoutEffect:wn,useInsertionEffect:wn,useMemo:wn,useReducer:wn,useRef:wn,useState:wn,useDebugValue:wn,useDeferredValue:wn,useTransition:wn,useSyncExternalStore:wn,useId:wn,useHostTransitionStatus:wn,useFormState:wn,useActionState:wn,useOptimistic:wn,useMemoCache:wn,useCacheRefresh:wn};rn.useEffectEvent=wn;var dn={readContext:li,use:Kc,useCallback:function(f,p){return $i().memoizedState=[f,p===void 0?null:p],f},useContext:li,useEffect:at,useImperativeHandle:function(f,p,v){v=v!=null?v.concat([f]):null,ct(4194308,4,xr.bind(null,p,f),v)},useLayoutEffect:function(f,p){return ct(4194308,4,f,p)},useInsertionEffect:function(f,p){ct(4,2,f,p)},useMemo:function(f,p){var v=$i();p=p===void 0?null:p;var P=f();if(ro){Pe(!0);try{f()}finally{Pe(!1)}}return v.memoizedState=[P,p],P},useReducer:function(f,p,v){var P=$i();if(v!==void 0){var k=v(p);if(ro){Pe(!0);try{v(p)}finally{Pe(!1)}}}else k=p;return P.memoizedState=P.baseState=k,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:k},P.queue=f,f=f.dispatch=Qc.bind(null,Dr,f),[P.memoizedState,f]},useRef:function(f){var p=$i();return f={current:f},p.memoizedState=f},useState:function(f){f=$(f);var p=f.queue,v=ah.bind(null,Dr,p);return p.dispatch=v,[f.memoizedState,v]},useDebugValue:_n,useDeferredValue:function(f,p){var v=$i();return an(v,f,p)},useTransition:function(){var f=$(!1);return f=Sn.bind(null,Dr,f.queue,!0,!1),$i().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,p,v){var P=Dr,k=$i();if(zr){if(v===void 0)throw Error(n(407));v=v()}else{if(v=p(),Dn===null)throw Error(n(349));(Vr&127)!==0||x(P,p,v)}k.memoizedState=v;var B={value:v,getSnapshot:p};return k.queue=B,at(I.bind(null,P,B,f),[f]),P.flags|=2048,Re(9,{destroy:void 0},C.bind(null,P,B,v,p),null),v},useId:function(){var f=$i(),p=Dn.identifierPrefix;if(zr){var v=As,P=Mo;v=(P&~(1<<32-Ne(P)-1)).toString(32)+v,p="_"+p+"R_"+v,v=Gc++,0<v&&(p+="H"+v.toString(32)),p+="_"}else v=Qp++,p="_"+p+"r_"+v.toString(32)+"_";return f.memoizedState=p},useHostTransitionStatus:Vo,useFormState:Ae,useActionState:Ae,useOptimistic:function(f){var p=$i();p.memoizedState=p.baseState=f;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=v,p=Is.bind(null,Dr,!0,v),v.dispatch=p,[f,p]},useMemoCache:sh,useCacheRefresh:function(){return $i().memoizedState=Ms.bind(null,Dr)},useEffectEvent:function(f){var p=$i(),v={impl:f};return p.memoizedState=v,function(){if((pn&2)!==0)throw Error(n(440));return v.impl.apply(void 0,arguments)}}},ci={readContext:li,use:Kc,useCallback:fn,useContext:li,useEffect:ot,useImperativeHandle:Qr,useInsertionEffect:Pt,useLayoutEffect:$t,useMemo:Tn,useReducer:A,useRef:Ve,useState:function(){return A(io)},useDebugValue:_n,useDeferredValue:function(f,p){var v=On();return Fn(v,Kr.memoizedState,f,p)},useTransition:function(){var f=A(io)[0],p=On().memoizedState;return[typeof f=="boolean"?f:Yc(f),p]},useSyncExternalStore:_,useId:$o,useHostTransitionStatus:Vo,useFormState:ke,useActionState:ke,useOptimistic:function(f,p){var v=On();return H(v,Kr,f,p)},useMemoCache:sh,useCacheRefresh:so};ci.useEffectEvent=Ut;var pi={readContext:li,use:Kc,useCallback:fn,useContext:li,useEffect:ot,useImperativeHandle:Qr,useInsertionEffect:Pt,useLayoutEffect:$t,useMemo:Tn,useReducer:d,useRef:Ve,useState:function(){return d(io)},useDebugValue:_n,useDeferredValue:function(f,p){var v=On();return Kr===null?an(v,f,p):Fn(v,Kr.memoizedState,f,p)},useTransition:function(){var f=d(io)[0],p=On().memoizedState;return[typeof f=="boolean"?f:Yc(f),p]},useSyncExternalStore:_,useId:$o,useHostTransitionStatus:Vo,useFormState:ze,useActionState:ze,useOptimistic:function(f,p){var v=On();return Kr!==null?H(v,Kr,f,p):(v.baseState=f,[f,v.queue.dispatch])},useMemoCache:sh,useCacheRefresh:so};pi.useEffectEvent=Ut;function Ud(f,p,v,P){p=f.memoizedState,v=v(P,p),v=v==null?p:E({},p,v),f.memoizedState=v,f.lanes===0&&(f.updateQueue.baseState=v)}var Vd={enqueueSetState:function(f,p,v){f=f._reactInternals;var P=Fa(),k=jo(P);k.payload=p,v!=null&&(k.callback=v),p=ll(f,k,P),p!==null&&(ja(p,f,P),Ra(p,f,P))},enqueueReplaceState:function(f,p,v){f=f._reactInternals;var P=Fa(),k=jo(P);k.tag=1,k.payload=p,v!=null&&(k.callback=v),p=ll(f,k,P),p!==null&&(ja(p,f,P),Ra(p,f,P))},enqueueForceUpdate:function(f,p){f=f._reactInternals;var v=Fa(),P=jo(v);P.tag=2,p!=null&&(P.callback=p),p=ll(f,P,v),p!==null&&(ja(p,f,v),Ra(p,f,v))}};function Jl(f,p,v,P,k,B,K){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(P,B,K):p.prototype&&p.prototype.isPureReactComponent?!$l(v,P)||!$l(k,B):!0}function Ym(f,p,v,P){f=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(v,P),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(v,P),p.state!==f&&Vd.enqueueReplaceState(p,p.state,null)}function ec(f,p){var v=p;if("ref"in p){v={};for(var P in p)P!=="ref"&&(v[P]=p[P])}if(f=f.defaultProps){v===p&&(v=E({},v));for(var k in f)v[k]===void 0&&(v[k]=f[k])}return v}function $d(f){Po(f)}function dl(f){console.error(f)}function pl(f){Po(f)}function oo(f,p){try{var v=f.onUncaughtError;v(p.value,{componentStack:p.stack})}catch(P){setTimeout(function(){throw P})}}function Wd(f,p,v){try{var P=f.onCaughtError;P(v.value,{componentStack:v.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function Cf(f,p,v){return v=jo(v),v.tag=3,v.payload={element:null},v.callback=function(){oo(f,p)},v}function Mf(f){return f=jo(f),f.tag=3,f}function If(f,p,v,P){var k=v.type.getDerivedStateFromError;if(typeof k=="function"){var B=P.value;f.payload=function(){return k(B)},f.callback=function(){Wd(p,v,P)}}var K=v.stateNode;K!==null&&typeof K.componentDidCatch=="function"&&(f.callback=function(){Wd(p,v,P),typeof k!="function"&&(au===null?au=new Set([this]):au.add(this));var pe=P.stack;this.componentDidCatch(P.value,{componentStack:pe!==null?pe:""})})}function Km(f,p,v,P,k){if(v.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){if(p=v.alternate,p!==null&&ra(p,v,k,!0),v=qt.current,v!==null){switch(v.tag){case 31:case 13:return er===null?_g():v.alternate===null&&ui===0&&(ui=3),v.flags&=-257,v.flags|=65536,v.lanes=k,P===Ht?v.flags|=16384:(p=v.updateQueue,p===null?v.updateQueue=new Set([P]):p.add(P),w_(f,P,k)),!1;case 22:return v.flags|=65536,P===Ht?v.flags|=16384:(p=v.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([P])},v.updateQueue=p):(v=p.retryQueue,v===null?p.retryQueue=new Set([P]):v.add(P)),w_(f,P,k)),!1}throw Error(n(435,v.tag))}return w_(f,P,k),_g(),!1}if(zr)return p=qt.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=k,P!==zn&&(f=Error(n(422),{cause:P}),il(hs(f,v)))):(P!==zn&&(p=Error(n(423),{cause:P}),il(hs(p,v))),f=f.current.alternate,f.flags|=65536,k&=-k,f.lanes|=k,P=hs(P,v),k=Cf(f.stateNode,P,k),tn(f,k),ui!==4&&(ui=2)),!1;var B=Error(n(520),{cause:P});if(B=hs(B,v),dg===null?dg=[B]:dg.push(B),ui!==4&&(ui=2),p===null)return!0;P=hs(P,v),v=p;do{switch(v.tag){case 3:return v.flags|=65536,f=k&-k,v.lanes|=f,f=Cf(v.stateNode,P,f),tn(v,f),!1;case 1:if(p=v.type,B=v.stateNode,(v.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(au===null||!au.has(B))))return v.flags|=65536,k&=-k,v.lanes|=k,k=Mf(k),If(k,f,v,P),tn(v,k),!1}v=v.return}while(v!==null);return!1}var Qm=Error(n(461)),Ii=!1;function Wi(f,p,v,P){p.child=f===null?Zp(p,null,v,P):Bo(p,f.child,v,P)}function jb(f,p,v,P,k){v=v.render;var B=p.ref;if("ref"in P){var K={};for(var pe in P)pe!=="ref"&&(K[pe]=P[pe])}else K=P;return ol(p),P=nh(f,p,v,K,B,k),pe=Pf(),f!==null&&!Ii?(Ql(f,p,k),rc(f,p,k)):(zr&&pe&&$c(p),p.flags|=1,Wi(f,p,P,k),p.child)}function Jm(f,p,v,P,k){if(f===null){var B=v.type;return typeof B=="function"&&!Cd(B)&&B.defaultProps===void 0&&v.compare===null?(p.tag=15,p.type=B,lv(f,p,B,P,k)):(f=Md(v.type,null,P,p,p.mode,k),f.ref=p.ref,f.return=p,p.child=f)}if(B=f.child,!tg(f,k)){var K=B.memoizedProps;if(v=v.compare,v=v!==null?v:$l,v(K,P)&&f.ref===p.ref)return rc(f,p,k)}return p.flags|=1,f=ea(B,P),f.ref=p.ref,f.return=p,p.child=f}function lv(f,p,v,P,k){if(f!==null){var B=f.memoizedProps;if($l(B,P)&&f.ref===p.ref)if(Ii=!1,p.pendingProps=P=B,tg(f,k))(f.flags&131072)!==0&&(Ii=!0);else return p.lanes=f.lanes,rc(f,p,k)}return uv(f,p,v,P,k)}function cv(f,p,v,P){var k=P.children,B=f!==null?f.memoizedState:null;if(f===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),P.mode==="hidden"){if((p.flags&128)!==0){if(B=B!==null?B.baseLanes|v:v,f!==null){for(P=p.child=f.child,k=0;P!==null;)k=k|P.lanes|P.childLanes,P=P.sibling;P=k&~B}else P=0,p.child=null;return Ub(f,p,B,v,P)}if((v&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},f!==null&&Ld(p,B!==null?B.cachePool:null),B!==null?Kp(p,B):ia(),Tf(p);else return P=p.lanes=536870912,Ub(f,p,B!==null?B.baseLanes|v:v,v,P)}else B!==null?(Ld(p,B.cachePool),Kp(p,B),ri(),p.memoizedState=null):(f!==null&&Ld(p,null),ia(),ri());return Wi(f,p,k,v),p.child}function tc(f,p){return f!==null&&f.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function Ub(f,p,v,P,k){var B=kd();return B=B===null?null:{parent:ti._currentValue,pool:B},p.memoizedState={baseLanes:v,cachePool:B},f!==null&&Ld(p,null),ia(),Tf(p),f!==null&&ra(f,p,P,!0),p.childLanes=k,null}function Jc(f,p){return p=i_({mode:p.mode,children:p.children},f.mode),p.ref=f.ref,f.child=p,p.return=f,p}function Jp(f,p,v){return Bo(p,f.child,null,v),f=Jc(p,p.pendingProps),f.flags|=2,Bn(p),p.memoizedState=null,f}function e_(f,p,v){var P=p.pendingProps,k=(p.flags&128)!==0;if(p.flags&=-129,f===null){if(zr){if(P.mode==="hidden")return f=Jc(p,P),p.lanes=536870912,tc(null,f);if(rh(p),(f=hn)?(f=mh(f,ta),f=f!==null&&f.data==="&"?f:null,f!==null&&(p.memoizedState={dehydrated:f,treeContext:Co!==null?{id:Mo,overflow:As}:null,retryLane:536870912,hydrationErrors:null},v=Id(f),v.return=p,p.child=v,Pi=p,hn=null)):f=null,f===null)throw Es(p);return p.lanes=536870912,null}return Jc(p,P)}var B=f.memoizedState;if(B!==null){var K=B.dehydrated;if(rh(p),k)if(p.flags&256)p.flags&=-257,p=Jp(f,p,v);else if(p.memoizedState!==null)p.child=f.child,p.flags|=128,p=null;else throw Error(n(558));else if(Ii||ra(f,p,v,!1),k=(v&f.childLanes)!==0,Ii||k){if(P=Dn,P!==null&&(K=Vi(P,v),K!==0&&K!==B.retryLane))throw B.retryLane=K,Ca(f,K),ja(P,f,K),Qm;_g(),p=Jp(f,p,v)}else f=B.treeContext,hn=uo(K.nextSibling),Pi=p,zr=!0,nl=null,ta=!1,f!==null&&qp(p,f),p=Jc(p,P),p.flags|=4096;return p}return f=ea(f.child,{mode:P.mode,children:P.children}),f.ref=p.ref,p.child=f,f.return=p,f}function t_(f,p){var v=p.ref;if(v===null)f!==null&&f.ref!==null&&(p.flags|=4194816);else{if(typeof v!="function"&&typeof v!="object")throw Error(n(284));(f===null||f.ref!==v)&&(p.flags|=4194816)}}function uv(f,p,v,P,k){return ol(p),v=nh(f,p,v,P,void 0,k),P=Pf(),f!==null&&!Ii?(Ql(f,p,k),rc(f,p,k)):(zr&&P&&$c(p),p.flags|=1,Wi(f,p,v,k),p.child)}function Vb(f,p,v,P,k,B){return ol(p),p.updateQueue=null,v=Af(p,P,v,k),ih(f),P=Pf(),f!==null&&!Ii?(Ql(f,p,B),rc(f,p,B)):(zr&&P&&$c(p),p.flags|=1,Wi(f,p,v,B),p.child)}function $b(f,p,v,P,k){if(ol(p),p.stateNode===null){var B=Pr,K=v.contextType;typeof K=="object"&&K!==null&&(B=li(K)),B=new v(P,B),p.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=Vd,p.stateNode=B,B._reactInternals=p,B=p.stateNode,B.props=P,B.state=p.memoizedState,B.refs={},Fd(p),K=v.contextType,B.context=typeof K=="object"&&K!==null?li(K):Pr,B.state=p.memoizedState,K=v.getDerivedStateFromProps,typeof K=="function"&&(Ud(p,v,K,P),B.state=p.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(K=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),K!==B.state&&Vd.enqueueReplaceState(B,B.state,null),Kl(p,P,B,k),cl(),B.state=p.memoizedState),typeof B.componentDidMount=="function"&&(p.flags|=4194308),P=!0}else if(f===null){B=p.stateNode;var pe=p.memoizedProps,je=ec(v,pe);B.props=je;var ft=B.context,At=v.contextType;K=Pr,typeof At=="object"&&At!==null&&(K=li(At));var Dt=v.getDerivedStateFromProps;At=typeof Dt=="function"||typeof B.getSnapshotBeforeUpdate=="function",pe=p.pendingProps!==pe,At||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(pe||ft!==K)&&Ym(p,B,P,K),Fo=!1;var dt=p.memoizedState;B.state=dt,Kl(p,P,B,k),cl(),ft=p.memoizedState,pe||dt!==ft||Fo?(typeof Dt=="function"&&(Ud(p,v,Dt,P),ft=p.memoizedState),(je=Fo||Jl(p,v,je,P,dt,ft,K))?(At||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(p.flags|=4194308)):(typeof B.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=P,p.memoizedState=ft),B.props=P,B.state=ft,B.context=K,P=je):(typeof B.componentDidMount=="function"&&(p.flags|=4194308),P=!1)}else{B=p.stateNode,bf(f,p),K=p.memoizedProps,At=ec(v,K),B.props=At,Dt=p.pendingProps,dt=B.context,ft=v.contextType,je=Pr,typeof ft=="object"&&ft!==null&&(je=li(ft)),pe=v.getDerivedStateFromProps,(ft=typeof pe=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(K!==Dt||dt!==je)&&Ym(p,B,P,je),Fo=!1,dt=p.memoizedState,B.state=dt,Kl(p,P,B,k),cl();var yt=p.memoizedState;K!==Dt||dt!==yt||Fo||f!==null&&f.dependencies!==null&&Qu(f.dependencies)?(typeof pe=="function"&&(Ud(p,v,pe,P),yt=p.memoizedState),(At=Fo||Jl(p,v,At,P,dt,yt,je)||f!==null&&f.dependencies!==null&&Qu(f.dependencies))?(ft||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(P,yt,je),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(P,yt,je)),typeof B.componentDidUpdate=="function"&&(p.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof B.componentDidUpdate!="function"||K===f.memoizedProps&&dt===f.memoizedState||(p.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||K===f.memoizedProps&&dt===f.memoizedState||(p.flags|=1024),p.memoizedProps=P,p.memoizedState=yt),B.props=P,B.state=yt,B.context=je,P=At):(typeof B.componentDidUpdate!="function"||K===f.memoizedProps&&dt===f.memoizedState||(p.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||K===f.memoizedProps&&dt===f.memoizedState||(p.flags|=1024),P=!1)}return B=P,t_(f,p),P=(p.flags&128)!==0,B||P?(B=p.stateNode,v=P&&typeof v.getDerivedStateFromError!="function"?null:B.render(),p.flags|=1,f!==null&&P?(p.child=Bo(p,f.child,null,k),p.child=Bo(p,null,v,k)):Wi(f,p,v,k),p.memoizedState=B.state,f=p.child):f=rc(f,p,k),f}function Wb(f,p,v,P){return Ro(),p.flags|=256,Wi(f,p,v,P),p.child}var r_={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function eg(f){return{baseLanes:f,cachePool:Zm()}}function n_(f,p,v){return f=f!==null?f.childLanes&~v:0,p&&(f|=fs),f}function hv(f,p,v){var P=p.pendingProps,k=!1,B=(p.flags&128)!==0,K;if((K=B)||(K=f!==null&&f.memoizedState===null?!1:(Gn.current&2)!==0),K&&(k=!0,p.flags&=-129),K=(p.flags&32)!==0,p.flags&=-33,f===null){if(zr){if(k?Oa(p):ri(),(f=hn)?(f=mh(f,ta),f=f!==null&&f.data!=="&"?f:null,f!==null&&(p.memoizedState={dehydrated:f,treeContext:Co!==null?{id:Mo,overflow:As}:null,retryLane:536870912,hydrationErrors:null},v=Id(f),v.return=p,p.child=v,Pi=p,hn=null)):f=null,f===null)throw Es(p);return jn(f)?p.lanes=32:p.lanes=536870912,null}var pe=P.children;return P=P.fallback,k?(ri(),k=p.mode,pe=i_({mode:"hidden",children:pe},k),P=Hl(P,k,v,null),pe.return=p,P.return=p,pe.sibling=P,p.child=pe,P=p.child,P.memoizedState=eg(v),P.childLanes=n_(f,K,v),p.memoizedState=r_,tc(null,P)):(Oa(p),fv(p,pe))}var je=f.memoizedState;if(je!==null&&(pe=je.dehydrated,pe!==null)){if(B)p.flags&256?(Oa(p),p.flags&=-257,p=s_(f,p,v)):p.memoizedState!==null?(ri(),p.child=f.child,p.flags|=128,p=null):(ri(),pe=P.fallback,k=p.mode,P=i_({mode:"visible",children:P.children},k),pe=Hl(pe,k,v,null),pe.flags|=2,P.return=p,pe.return=p,P.sibling=pe,p.child=P,Bo(p,f.child,null,v),P=p.child,P.memoizedState=eg(v),P.childLanes=n_(f,K,v),p.memoizedState=r_,p=tc(null,P));else if(Oa(p),jn(pe)){if(K=pe.nextSibling&&pe.nextSibling.dataset,K)var ft=K.dgst;K=ft,P=Error(n(419)),P.stack="",P.digest=K,il({value:P,source:null,stack:null}),p=s_(f,p,v)}else if(Ii||ra(f,p,v,!1),K=(v&f.childLanes)!==0,Ii||K){if(K=Dn,K!==null&&(P=Vi(K,v),P!==0&&P!==je.retryLane))throw je.retryLane=P,Ca(f,P),ja(K,f,P),Qm;Os(pe)||_g(),p=s_(f,p,v)}else Os(pe)?(p.flags|=192,p.child=f.child,p=null):(f=je.treeContext,hn=uo(pe.nextSibling),Pi=p,zr=!0,nl=null,ta=!1,f!==null&&qp(p,f),p=fv(p,P.children),p.flags|=4096);return p}return k?(ri(),pe=P.fallback,k=p.mode,je=f.child,ft=je.sibling,P=ea(je,{mode:"hidden",children:P.children}),P.subtreeFlags=je.subtreeFlags&65011712,ft!==null?pe=ea(ft,pe):(pe=Hl(pe,k,v,null),pe.flags|=2),pe.return=p,P.return=p,P.sibling=pe,p.child=P,tc(null,P),P=p.child,pe=f.child.memoizedState,pe===null?pe=eg(v):(k=pe.cachePool,k!==null?(je=ti._currentValue,k=k.parent!==je?{parent:je,pool:je}:k):k=Zm(),pe={baseLanes:pe.baseLanes|v,cachePool:k}),P.memoizedState=pe,P.childLanes=n_(f,K,v),p.memoizedState=r_,tc(f.child,P)):(Oa(p),v=f.child,f=v.sibling,v=ea(v,{mode:"visible",children:P.children}),v.return=p,v.sibling=null,f!==null&&(K=p.deletions,K===null?(p.deletions=[f],p.flags|=16):K.push(f)),p.child=v,p.memoizedState=null,v)}function fv(f,p){return p=i_({mode:"visible",children:p},f.mode),p.return=f,f.child=p}function i_(f,p){return f=Js(22,f,null,p),f.lanes=0,f}function s_(f,p,v){return Bo(p,f.child,null,v),f=fv(p,p.pendingProps.children),f.flags|=2,p.memoizedState=null,f}function dv(f,p,v){f.lanes|=p;var P=f.alternate;P!==null&&(P.lanes|=p),Rd(f.return,p,v)}function pv(f,p,v,P,k,B){var K=f.memoizedState;K===null?f.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:P,tail:v,tailMode:k,treeForkCount:B}:(K.isBackwards=p,K.rendering=null,K.renderingStartTime=0,K.last=P,K.tail=v,K.tailMode=k,K.treeForkCount=B)}function a_(f,p,v){var P=p.pendingProps,k=P.revealOrder,B=P.tail;P=P.children;var K=Gn.current,pe=(K&2)!==0;if(pe?(K=K&1|2,p.flags|=128):K&=1,lt(Gn,K),Wi(f,p,P,v),P=zr?Zl:0,!pe&&f!==null&&(f.flags&128)!==0)e:for(f=p.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&dv(f,v,p);else if(f.tag===19)dv(f,v,p);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===p)break e;for(;f.sibling===null;){if(f.return===null||f.return===p)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}switch(k){case"forwards":for(v=p.child,k=null;v!==null;)f=v.alternate,f!==null&&Sf(f)===null&&(k=v),v=v.sibling;v=k,v===null?(k=p.child,p.child=null):(k=v.sibling,v.sibling=null),pv(p,!1,k,v,B,P);break;case"backwards":case"unstable_legacy-backwards":for(v=null,k=p.child,p.child=null;k!==null;){if(f=k.alternate,f!==null&&Sf(f)===null){p.child=k;break}f=k.sibling,k.sibling=v,v=k,k=f}pv(p,!0,v,null,B,P);break;case"together":pv(p,!1,null,null,void 0,P);break;default:p.memoizedState=null}return p.child}function rc(f,p,v){if(f!==null&&(p.dependencies=f.dependencies),su|=p.lanes,(v&p.childLanes)===0)if(f!==null){if(ra(f,p,v,!1),(v&p.childLanes)===0)return null}else return null;if(f!==null&&p.child!==f.child)throw Error(n(153));if(p.child!==null){for(f=p.child,v=ea(f,f.pendingProps),p.child=v,v.return=p;f.sibling!==null;)f=f.sibling,v=v.sibling=ea(f,f.pendingProps),v.return=p;v.sibling=null}return p.child}function tg(f,p){return(f.lanes&p)!==0?!0:(f=f.dependencies,!!(f!==null&&Qu(f)))}function rg(f,p,v){switch(p.tag){case 3:nr(p,p.stateNode.containerInfo),al(p,ti,f.memoizedState.cache),Ro();break;case 27:case 5:Yt(p);break;case 4:nr(p,p.stateNode.containerInfo);break;case 10:al(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,rh(p),null;break;case 13:var P=p.memoizedState;if(P!==null)return P.dehydrated!==null?(Oa(p),p.flags|=128,null):(v&p.child.childLanes)!==0?hv(f,p,v):(Oa(p),f=rc(f,p,v),f!==null?f.sibling:null);Oa(p);break;case 19:var k=(f.flags&128)!==0;if(P=(v&p.childLanes)!==0,P||(ra(f,p,v,!1),P=(v&p.childLanes)!==0),k){if(P)return a_(f,p,v);p.flags|=128}if(k=p.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),lt(Gn,Gn.current),P)break;return null;case 22:return p.lanes=0,cv(f,p,v,p.pendingProps);case 24:al(p,ti,f.memoizedState.cache)}return rc(f,p,v)}function Rs(f,p,v){if(f!==null)if(f.memoizedProps!==p.pendingProps)Ii=!0;else{if(!tg(f,v)&&(p.flags&128)===0)return Ii=!1,rg(f,p,v);Ii=(f.flags&131072)!==0}else Ii=!1,zr&&(p.flags&1048576)!==0&&Hp(p,Zl,p.index);switch(p.lanes=0,p.tag){case 16:e:{var P=p.pendingProps;if(f=Ia(p.elementType),p.type=f,typeof f=="function")Cd(f)?(P=ec(f,P),p.tag=1,p=$b(null,p,f,P,v)):(p.tag=0,p=uv(null,p,f,P,v));else{if(f!=null){var k=f.$$typeof;if(k===ue){p.tag=11,p=jb(null,p,f,P,v);break e}else if(k===Ce){p.tag=14,p=Jm(null,p,f,P,v);break e}}throw p=St(f)||f,Error(n(306,p,""))}}return p;case 0:return uv(f,p,p.type,p.pendingProps,v);case 1:return P=p.type,k=ec(P,p.pendingProps),$b(f,p,P,k,v);case 3:e:{if(nr(p,p.stateNode.containerInfo),f===null)throw Error(n(387));P=p.pendingProps;var B=p.memoizedState;k=B.element,bf(f,p),Kl(p,P,null,v);var K=p.memoizedState;if(P=K.cache,al(p,ti,P),P!==B.cache&&Od(p,[ti],v,!0),cl(),P=K.element,B.isDehydrated)if(B={element:P,isDehydrated:!1,cache:K.cache},p.updateQueue.baseState=B,p.memoizedState=B,p.flags&256){p=Wb(f,p,P,v);break e}else if(P!==k){k=hs(Error(n(424)),p),il(k),p=Wb(f,p,P,v);break e}else for(f=p.stateNode.containerInfo,f.nodeType===9?f=f.body:f=f.nodeName==="HTML"?f.ownerDocument.body:f,hn=uo(f.firstChild),Pi=p,zr=!0,nl=null,ta=!0,v=Zp(p,null,P,v),p.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Ro(),P===k){p=rc(f,p,v);break e}Wi(f,p,P,v)}p=p.child}return p;case 26:return t_(f,p),f===null?(v=qv(p.type,null,p.pendingProps,null))?p.memoizedState=v:zr||(v=p.type,f=p.pendingProps,P=Tg(Xt.current).createElement(v),P[en]=p,P[Nt]=f,qi(P,v,f),Hn(P),p.stateNode=P):p.memoizedState=qv(p.type,f.memoizedProps,p.pendingProps,f.memoizedState),null;case 27:return Yt(p),f===null&&zr&&(P=p.stateNode=Sx(p.type,p.pendingProps,Xt.current),Pi=p,ta=!0,k=hn,gh(p.type)?(ua=k,hn=uo(P.firstChild)):hn=k),Wi(f,p,p.pendingProps.children,v),t_(f,p),f===null&&(p.flags|=4194304),p.child;case 5:return f===null&&zr&&((k=P=hn)&&(P=Yi(P,p.type,p.pendingProps,ta),P!==null?(p.stateNode=P,Pi=p,hn=uo(P.firstChild),ta=!1,k=!0):k=!1),k||Es(p)),Yt(p),k=p.type,B=p.pendingProps,K=f!==null?f.memoizedProps:null,P=B.children,D_(k,B)?P=null:K!==null&&D_(k,K)&&(p.flags|=32),p.memoizedState!==null&&(k=nh(f,p,Ef,null,null,v),Og._currentValue=k),t_(f,p),Wi(f,p,P,v),p.child;case 6:return f===null&&zr&&((f=v=hn)&&(v=yl(v,p.pendingProps,ta),v!==null?(p.stateNode=v,Pi=p,hn=null,f=!0):f=!1),f||Es(p)),null;case 13:return hv(f,p,v);case 4:return nr(p,p.stateNode.containerInfo),P=p.pendingProps,f===null?p.child=Bo(p,null,P,v):Wi(f,p,P,v),p.child;case 11:return jb(f,p,p.type,p.pendingProps,v);case 7:return Wi(f,p,p.pendingProps,v),p.child;case 8:return Wi(f,p,p.pendingProps.children,v),p.child;case 12:return Wi(f,p,p.pendingProps.children,v),p.child;case 10:return P=p.pendingProps,al(p,p.type,P.value),Wi(f,p,P.children,v),p.child;case 9:return k=p.type._context,P=p.pendingProps.children,ol(p),k=li(k),P=P(k),p.flags|=1,Wi(f,p,P,v),p.child;case 14:return Jm(f,p,p.type,p.pendingProps,v);case 15:return lv(f,p,p.type,p.pendingProps,v);case 19:return a_(f,p,v);case 31:return e_(f,p,v);case 22:return cv(f,p,v,p.pendingProps);case 24:return ol(p),P=li(ti),f===null?(k=kd(),k===null&&(k=Dn,B=Lo(),k.pooledCache=B,B.refCount++,B!==null&&(k.pooledCacheLanes|=v),k=B),p.memoizedState={parent:P,cache:k},Fd(p),al(p,ti,k)):((f.lanes&v)!==0&&(bf(f,p),Kl(p,null,null,v),cl()),k=f.memoizedState,B=p.memoizedState,k.parent!==P?(k={parent:P,cache:P},p.memoizedState=k,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=k),al(p,ti,P)):(P=B.cache,al(p,ti,P),P!==k.cache&&Od(p,[ti],v,!0))),Wi(f,p,p.pendingProps.children,v),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function nc(f){f.flags|=4}function ng(f,p,v,P,k){if((p=(f.mode&32)!==0)&&(p=!1),p){if(f.flags|=16777216,(k&335544128)===k)if(f.stateNode.complete)f.flags|=8192;else if(Ev())f.flags|=8192;else throw to=Ht,Yl}else f.flags&=-16777217}function Hb(f,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!$_(p))if(Ev())f.flags|=8192;else throw to=Ht,Yl}function ig(f,p){p!==null&&(f.flags|=4),f.flags&16384&&(p=f.tag!==22?fr():536870912,f.lanes|=p,Lf|=p)}function sg(f,p){if(!zr)switch(f.tailMode){case"hidden":p=f.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?f.tail=null:v.sibling=null;break;case"collapsed":v=f.tail;for(var P=null;v!==null;)v.alternate!==null&&(P=v),v=v.sibling;P===null?p||f.tail===null?f.tail=null:f.tail.sibling=null:P.sibling=null}}function Kn(f){var p=f.alternate!==null&&f.alternate.child===f.child,v=0,P=0;if(p)for(var k=f.child;k!==null;)v|=k.lanes|k.childLanes,P|=k.subtreeFlags&65011712,P|=k.flags&65011712,k.return=f,k=k.sibling;else for(k=f.child;k!==null;)v|=k.lanes|k.childLanes,P|=k.subtreeFlags,P|=k.flags,k.return=f,k=k.sibling;return f.subtreeFlags|=P,f.childLanes=v,p}function qb(f,p,v){var P=p.pendingProps;switch(Ku(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kn(p),null;case 1:return Kn(p),null;case 3:return v=p.stateNode,P=null,f!==null&&(P=f.memoizedState.cache),p.memoizedState.cache!==P&&(p.flags|=2048),ko(ti),_t(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(f===null||f.child===null)&&(Io(p)?nc(p):f===null||f.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Oo())),Kn(p),null;case 26:var k=p.type,B=p.memoizedState;return f===null?(nc(p),B!==null?(Kn(p),Hb(p,B)):(Kn(p),ng(p,k,null,P,v))):B?B!==f.memoizedState?(nc(p),Kn(p),Hb(p,B)):(Kn(p),p.flags&=-16777217):(f=f.memoizedProps,f!==P&&nc(p),Kn(p),ng(p,k,f,P,v)),null;case 27:if(Tr(p),v=Xt.current,k=p.type,f!==null&&p.stateNode!=null)f.memoizedProps!==P&&nc(p);else{if(!P){if(p.stateNode===null)throw Error(n(166));return Kn(p),null}f=Tt.current,Io(p)?Ps(p):(f=Sx(k,P,v),p.stateNode=f,nc(p))}return Kn(p),null;case 5:if(Tr(p),k=p.type,f!==null&&p.stateNode!=null)f.memoizedProps!==P&&nc(p);else{if(!P){if(p.stateNode===null)throw Error(n(166));return Kn(p),null}if(B=Tt.current,Io(p))Ps(p);else{var K=Tg(Xt.current);switch(B){case 1:B=K.createElementNS("http://www.w3.org/2000/svg",k);break;case 2:B=K.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;default:switch(k){case"svg":B=K.createElementNS("http://www.w3.org/2000/svg",k);break;case"math":B=K.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;case"script":B=K.createElement("div"),B.innerHTML="<script><\/script>",B=B.removeChild(B.firstChild);break;case"select":B=typeof P.is=="string"?K.createElement("select",{is:P.is}):K.createElement("select"),P.multiple?B.multiple=!0:P.size&&(B.size=P.size);break;default:B=typeof P.is=="string"?K.createElement(k,{is:P.is}):K.createElement(k)}}B[en]=p,B[Nt]=P;e:for(K=p.child;K!==null;){if(K.tag===5||K.tag===6)B.appendChild(K.stateNode);else if(K.tag!==4&&K.tag!==27&&K.child!==null){K.child.return=K,K=K.child;continue}if(K===p)break e;for(;K.sibling===null;){if(K.return===null||K.return===p)break e;K=K.return}K.sibling.return=K.return,K=K.sibling}p.stateNode=B;e:switch(qi(B,k,P),k){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}P&&nc(p)}}return Kn(p),ng(p,p.type,f===null?null:f.memoizedProps,p.pendingProps,v),null;case 6:if(f&&p.stateNode!=null)f.memoizedProps!==P&&nc(p);else{if(typeof P!="string"&&p.stateNode===null)throw Error(n(166));if(f=Xt.current,Io(p)){if(f=p.stateNode,v=p.memoizedProps,P=null,k=Pi,k!==null)switch(k.tag){case 27:case 5:P=k.memoizedProps}f[en]=p,f=!!(f.nodeValue===v||P!==null&&P.suppressHydrationWarning===!0||Bv(f.nodeValue,v)),f||Es(p,!0)}else f=Tg(f).createTextNode(P),f[en]=p,p.stateNode=f}return Kn(p),null;case 31:if(v=p.memoizedState,f===null||f.memoizedState!==null){if(P=Io(p),v!==null){if(f===null){if(!P)throw Error(n(318));if(f=p.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(n(557));f[en]=p}else Ro(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Kn(p),f=!1}else v=Oo(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=v),f=!0;if(!f)return p.flags&256?(Bn(p),p):(Bn(p),null);if((p.flags&128)!==0)throw Error(n(558))}return Kn(p),null;case 13:if(P=p.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(k=Io(p),P!==null&&P.dehydrated!==null){if(f===null){if(!k)throw Error(n(318));if(k=p.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(n(317));k[en]=p}else Ro(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Kn(p),k=!1}else k=Oo(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=k),k=!0;if(!k)return p.flags&256?(Bn(p),p):(Bn(p),null)}return Bn(p),(p.flags&128)!==0?(p.lanes=v,p):(v=P!==null,f=f!==null&&f.memoizedState!==null,v&&(P=p.child,k=null,P.alternate!==null&&P.alternate.memoizedState!==null&&P.alternate.memoizedState.cachePool!==null&&(k=P.alternate.memoizedState.cachePool.pool),B=null,P.memoizedState!==null&&P.memoizedState.cachePool!==null&&(B=P.memoizedState.cachePool.pool),B!==k&&(P.flags|=2048)),v!==f&&v&&(p.child.flags|=8192),ig(p,p.updateQueue),Kn(p),null);case 4:return _t(),f===null&&Nv(p.stateNode.containerInfo),Kn(p),null;case 10:return ko(p.type),Kn(p),null;case 19:if(Be(Gn),P=p.memoizedState,P===null)return Kn(p),null;if(k=(p.flags&128)!==0,B=P.rendering,B===null)if(k)sg(P,!1);else{if(ui!==0||f!==null&&(f.flags&128)!==0)for(f=p.child;f!==null;){if(B=Sf(f),B!==null){for(p.flags|=128,sg(P,!1),f=B.updateQueue,p.updateQueue=f,ig(p,f),p.subtreeFlags=0,f=v,v=p.child;v!==null;)Xm(v,f),v=v.sibling;return lt(Gn,Gn.current&1|2),zr&&rl(p,P.treeForkCount),p.child}f=f.sibling}P.tail!==null&&vi()>pg&&(p.flags|=128,k=!0,sg(P,!1),p.lanes=4194304)}else{if(!k)if(f=Sf(B),f!==null){if(p.flags|=128,k=!0,f=f.updateQueue,p.updateQueue=f,ig(p,f),sg(P,!0),P.tail===null&&P.tailMode==="hidden"&&!B.alternate&&!zr)return Kn(p),null}else 2*vi()-P.renderingStartTime>pg&&v!==536870912&&(p.flags|=128,k=!0,sg(P,!1),p.lanes=4194304);P.isBackwards?(B.sibling=p.child,p.child=B):(f=P.last,f!==null?f.sibling=B:p.child=B,P.last=B)}return P.tail!==null?(f=P.tail,P.rendering=f,P.tail=f.sibling,P.renderingStartTime=vi(),f.sibling=null,v=Gn.current,lt(Gn,k?v&1|2:v&1),zr&&rl(p,P.treeForkCount),f):(Kn(p),null);case 22:case 23:return Bn(p),Xc(),P=p.memoizedState!==null,f!==null?f.memoizedState!==null!==P&&(p.flags|=8192):P&&(p.flags|=8192),P?(v&536870912)!==0&&(p.flags&128)===0&&(Kn(p),p.subtreeFlags&6&&(p.flags|=8192)):Kn(p),v=p.updateQueue,v!==null&&ig(p,v.retryQueue),v=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),P=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(P=p.memoizedState.cachePool.pool),P!==v&&(p.flags|=2048),f!==null&&Be(Ja),null;case 24:return v=null,f!==null&&(v=f.memoizedState.cache),p.memoizedState.cache!==v&&(p.flags|=2048),ko(ti),Kn(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function _2(f,p){switch(Ku(p),p.tag){case 1:return f=p.flags,f&65536?(p.flags=f&-65537|128,p):null;case 3:return ko(ti),_t(),f=p.flags,(f&65536)!==0&&(f&128)===0?(p.flags=f&-65537|128,p):null;case 26:case 27:case 5:return Tr(p),null;case 31:if(p.memoizedState!==null){if(Bn(p),p.alternate===null)throw Error(n(340));Ro()}return f=p.flags,f&65536?(p.flags=f&-65537|128,p):null;case 13:if(Bn(p),f=p.memoizedState,f!==null&&f.dehydrated!==null){if(p.alternate===null)throw Error(n(340));Ro()}return f=p.flags,f&65536?(p.flags=f&-65537|128,p):null;case 19:return Be(Gn),null;case 4:return _t(),null;case 10:return ko(p.type),null;case 22:case 23:return Bn(p),Xc(),f!==null&&Be(Ja),f=p.flags,f&65536?(p.flags=f&-65537|128,p):null;case 24:return ko(ti),null;case 25:return null;default:return null}}function o_(f,p){switch(Ku(p),p.tag){case 3:ko(ti),_t();break;case 26:case 27:case 5:Tr(p);break;case 4:_t();break;case 31:p.memoizedState!==null&&Bn(p);break;case 13:Bn(p);break;case 19:Be(Gn);break;case 10:ko(p.type);break;case 22:case 23:Bn(p),Xc(),f!==null&&Be(Ja);break;case 24:ko(ti)}}function Hd(f,p){try{var v=p.updateQueue,P=v!==null?v.lastEffect:null;if(P!==null){var k=P.next;v=k;do{if((v.tag&f)===f){P=void 0;var B=v.create,K=v.inst;P=B(),K.destroy=P}v=v.next}while(v!==k)}}catch(pe){gn(p,p.return,pe)}}function eu(f,p,v){try{var P=p.updateQueue,k=P!==null?P.lastEffect:null;if(k!==null){var B=k.next;P=B;do{if((P.tag&f)===f){var K=P.inst,pe=K.destroy;if(pe!==void 0){K.destroy=void 0,k=p;var je=v,ft=pe;try{ft()}catch(At){gn(k,je,At)}}}P=P.next}while(P!==B)}}catch(At){gn(p,p.return,At)}}function Xb(f){var p=f.updateQueue;if(p!==null){var v=f.stateNode;try{jd(p,v)}catch(P){gn(f,f.return,P)}}}function Gb(f,p,v){v.props=ec(f.type,f.memoizedProps),v.state=f.memoizedState;try{v.componentWillUnmount()}catch(P){gn(f,p,P)}}function ag(f,p){try{var v=f.ref;if(v!==null){switch(f.tag){case 26:case 27:case 5:var P=f.stateNode;break;case 30:P=f.stateNode;break;default:P=f.stateNode}typeof v=="function"?f.refCleanup=v(P):v.current=P}}catch(k){gn(f,p,k)}}function lo(f,p){var v=f.ref,P=f.refCleanup;if(v!==null)if(typeof P=="function")try{P()}catch(k){gn(f,p,k)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(k){gn(f,p,k)}else v.current=null}function l_(f){var p=f.type,v=f.memoizedProps,P=f.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":v.autoFocus&&P.focus();break e;case"img":v.src?P.src=v.src:v.srcSet&&(P.srcset=v.srcSet)}}catch(k){gn(f,f.return,k)}}function c_(f,p,v){try{var P=f.stateNode;wx(P,f.type,v,p),P[Nt]=p}catch(k){gn(f,f.return,k)}}function oh(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&gh(f.type)||f.tag===4}function Rf(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||oh(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&gh(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function gv(f,p,v){var P=f.tag;if(P===5||P===6)f=f.stateNode,p?(v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v).insertBefore(f,p):(p=v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v,p.appendChild(f),v=v._reactRootContainer,v!=null||p.onclick!==null||(p.onclick=Ka));else if(P!==4&&(P===27&&gh(f.type)&&(v=f.stateNode,p=null),f=f.child,f!==null))for(gv(f,p,v),f=f.sibling;f!==null;)gv(f,p,v),f=f.sibling}function u_(f,p,v){var P=f.tag;if(P===5||P===6)f=f.stateNode,p?v.insertBefore(f,p):v.appendChild(f);else if(P!==4&&(P===27&&gh(f.type)&&(v=f.stateNode),f=f.child,f!==null))for(u_(f,p,v),f=f.sibling;f!==null;)u_(f,p,v),f=f.sibling}function Zb(f){var p=f.stateNode,v=f.memoizedProps;try{for(var P=f.type,k=p.attributes;k.length;)p.removeAttributeNode(k[0]);qi(p,P,v),p[en]=f,p[Nt]=v}catch(B){gn(f,f.return,B)}}var tu=!1,Ri=!1,mv=!1,Yb=typeof WeakSet=="function"?WeakSet:Set,Oi=null;function y2(f,p){if(f=f.containerInfo,wg=yh,f=wd(f),of(f)){if("selectionStart"in f)var v={start:f.selectionStart,end:f.selectionEnd};else e:{v=(v=f.ownerDocument)&&v.defaultView||window;var P=v.getSelection&&v.getSelection();if(P&&P.rangeCount!==0){v=P.anchorNode;var k=P.anchorOffset,B=P.focusNode;P=P.focusOffset;try{v.nodeType,B.nodeType}catch{v=null;break e}var K=0,pe=-1,je=-1,ft=0,At=0,Dt=f,dt=null;t:for(;;){for(var yt;Dt!==v||k!==0&&Dt.nodeType!==3||(pe=K+k),Dt!==B||P!==0&&Dt.nodeType!==3||(je=K+P),Dt.nodeType===3&&(K+=Dt.nodeValue.length),(yt=Dt.firstChild)!==null;)dt=Dt,Dt=yt;for(;;){if(Dt===f)break t;if(dt===v&&++ft===k&&(pe=K),dt===B&&++At===P&&(je=K),(yt=Dt.nextSibling)!==null)break;Dt=dt,dt=Dt.parentNode}Dt=yt}v=pe===-1||je===-1?null:{start:pe,end:je}}else v=null}v=v||{start:0,end:0}}else v=null;for(Fv={focusedElem:f,selectionRange:v},yh=!1,Oi=p;Oi!==null;)if(p=Oi,f=p.child,(p.subtreeFlags&1028)!==0&&f!==null)f.return=p,Oi=f;else for(;Oi!==null;){switch(p=Oi,B=p.alternate,f=p.flags,p.tag){case 0:if((f&4)!==0&&(f=p.updateQueue,f=f!==null?f.events:null,f!==null))for(v=0;v<f.length;v++)k=f[v],k.ref.impl=k.nextImpl;break;case 11:case 15:break;case 1:if((f&1024)!==0&&B!==null){f=void 0,v=p,k=B.memoizedProps,B=B.memoizedState,P=v.stateNode;try{var rr=ec(v.type,k);f=P.getSnapshotBeforeUpdate(rr,B),P.__reactInternalSnapshotBeforeUpdate=f}catch(wr){gn(v,v.return,wr)}}break;case 3:if((f&1024)!==0){if(f=p.stateNode.containerInfo,v=f.nodeType,v===9)ac(f);else if(v===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":ac(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(n(163))}if(f=p.sibling,f!==null){f.return=p.return,Oi=f;break}Oi=p.return}}function _v(f,p,v){var P=v.flags;switch(v.tag){case 0:case 11:case 15:za(f,v),P&4&&Hd(5,v);break;case 1:if(za(f,v),P&4)if(f=v.stateNode,p===null)try{f.componentDidMount()}catch(K){gn(v,v.return,K)}else{var k=ec(v.type,p.memoizedProps);p=p.memoizedState;try{f.componentDidUpdate(k,p,f.__reactInternalSnapshotBeforeUpdate)}catch(K){gn(v,v.return,K)}}P&64&&Xb(v),P&512&&ag(v,v.return);break;case 3:if(za(f,v),P&64&&(f=v.updateQueue,f!==null)){if(p=null,v.child!==null)switch(v.child.tag){case 27:case 5:p=v.child.stateNode;break;case 1:p=v.child.stateNode}try{jd(f,p)}catch(K){gn(v,v.return,K)}}break;case 27:p===null&&P&4&&Zb(v);case 26:case 5:za(f,v),p===null&&P&4&&l_(v),P&512&&ag(v,v.return);break;case 12:za(f,v);break;case 31:za(f,v),P&4&&og(f,v);break;case 13:za(f,v),P&4&&lg(f,v),P&64&&(f=v.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(v=Cv.bind(null,v),ki(f,v))));break;case 22:if(P=v.memoizedState!==null||tu,!P){p=p!==null&&p.memoizedState!==null||Ri,k=tu;var B=Ri;tu=P,(Ri=p)&&!B?ru(f,v,(v.subtreeFlags&8772)!==0):za(f,v),tu=k,Ri=B}break;case 30:break;default:za(f,v)}}function qd(f){var p=f.alternate;p!==null&&(f.alternate=null,qd(p)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(p=f.stateNode,p!==null&&Pc(p)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var ni=null,Gr=!1;function Na(f,p,v){for(v=v.child;v!==null;)yv(f,p,v),v=v.sibling}function yv(f,p,v){if(oe&&typeof oe.onCommitFiberUnmount=="function")try{oe.onCommitFiberUnmount(ie,v)}catch{}switch(v.tag){case 26:Ri||lo(v,p),Na(f,p,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:Ri||lo(v,p);var P=ni,k=Gr;gh(v.type)&&(ni=v.stateNode,Gr=!1),Na(f,p,v),Sg(v.stateNode),ni=P,Gr=k;break;case 5:Ri||lo(v,p);case 6:if(P=ni,k=Gr,ni=null,Na(f,p,v),ni=P,Gr=k,ni!==null)if(Gr)try{(ni.nodeType===9?ni.body:ni.nodeName==="HTML"?ni.ownerDocument.body:ni).removeChild(v.stateNode)}catch(B){gn(v,p,B)}else try{ni.removeChild(v.stateNode)}catch(B){gn(v,p,B)}break;case 18:ni!==null&&(Gr?(f=ni,Tx(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,v.stateNode),lp(f)):Tx(ni,v.stateNode));break;case 4:P=ni,k=Gr,ni=v.stateNode.containerInfo,Gr=!0,Na(f,p,v),ni=P,Gr=k;break;case 0:case 11:case 14:case 15:eu(2,v,p),Ri||eu(4,v,p),Na(f,p,v);break;case 1:Ri||(lo(v,p),P=v.stateNode,typeof P.componentWillUnmount=="function"&&Gb(v,p,P)),Na(f,p,v);break;case 21:Na(f,p,v);break;case 22:Ri=(P=Ri)||v.memoizedState!==null,Na(f,p,v),Ri=P;break;default:Na(f,p,v)}}function og(f,p){if(p.memoizedState===null&&(f=p.alternate,f!==null&&(f=f.memoizedState,f!==null))){f=f.dehydrated;try{lp(f)}catch(v){gn(p,p.return,v)}}}function lg(f,p){if(p.memoizedState===null&&(f=p.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{lp(f)}catch(v){gn(p,p.return,v)}}function cg(f){switch(f.tag){case 31:case 13:case 19:var p=f.stateNode;return p===null&&(p=f.stateNode=new Yb),p;case 22:return f=f.stateNode,p=f._retryCache,p===null&&(p=f._retryCache=new Yb),p;default:throw Error(n(435,f.tag))}}function ug(f,p){var v=cg(f);p.forEach(function(P){if(!v.has(P)){v.add(P);var k=x2.bind(null,f,P);P.then(k,k)}})}function aa(f,p){var v=p.deletions;if(v!==null)for(var P=0;P<v.length;P++){var k=v[P],B=f,K=p,pe=K;e:for(;pe!==null;){switch(pe.tag){case 27:if(gh(pe.type)){ni=pe.stateNode,Gr=!1;break e}break;case 5:ni=pe.stateNode,Gr=!1;break e;case 3:case 4:ni=pe.stateNode.containerInfo,Gr=!0;break e}pe=pe.return}if(ni===null)throw Error(n(160));yv(B,K,k),ni=null,Gr=!1,B=k.alternate,B!==null&&(B.return=null),k.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)h_(p,f),p=p.sibling}var oa=null;function h_(f,p){var v=f.alternate,P=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:aa(p,f),Hi(f),P&4&&(eu(3,f,f.return),Hd(3,f),eu(5,f,f.return));break;case 1:aa(p,f),Hi(f),P&512&&(Ri||v===null||lo(v,v.return)),P&64&&tu&&(f=f.updateQueue,f!==null&&(P=f.callbacks,P!==null&&(v=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=v===null?P:v.concat(P))));break;case 26:var k=oa;if(aa(p,f),Hi(f),P&512&&(Ri||v===null||lo(v,v.return)),P&4){var B=v!==null?v.memoizedState:null;if(P=f.memoizedState,v===null)if(P===null)if(f.stateNode===null){e:{P=f.type,v=f.memoizedProps,k=k.ownerDocument||k;t:switch(P){case"title":B=k.getElementsByTagName("title")[0],(!B||B[Ar]||B[en]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=k.createElement(P),k.head.insertBefore(B,k.querySelector("head > title"))),qi(B,P,v),B[en]=f,Hn(B),P=B;break e;case"link":var K=Eg("link","href",k).get(P+(v.href||""));if(K){for(var pe=0;pe<K.length;pe++)if(B=K[pe],B.getAttribute("href")===(v.href==null||v.href===""?null:v.href)&&B.getAttribute("rel")===(v.rel==null?null:v.rel)&&B.getAttribute("title")===(v.title==null?null:v.title)&&B.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){K.splice(pe,1);break t}}B=k.createElement(P),qi(B,P,v),k.head.appendChild(B);break;case"meta":if(K=Eg("meta","content",k).get(P+(v.content||""))){for(pe=0;pe<K.length;pe++)if(B=K[pe],B.getAttribute("content")===(v.content==null?null:""+v.content)&&B.getAttribute("name")===(v.name==null?null:v.name)&&B.getAttribute("property")===(v.property==null?null:v.property)&&B.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&B.getAttribute("charset")===(v.charSet==null?null:v.charSet)){K.splice(pe,1);break t}}B=k.createElement(P),qi(B,P,v),k.head.appendChild(B);break;default:throw Error(n(468,P))}B[en]=f,Hn(B),P=B}f.stateNode=P}else Pg(k,f.type,f.stateNode);else f.stateNode=jf(k,P,f.memoizedProps);else B!==P?(B===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):B.count--,P===null?Pg(k,f.type,f.stateNode):jf(k,P,f.memoizedProps)):P===null&&f.stateNode!==null&&c_(f,f.memoizedProps,v.memoizedProps)}break;case 27:aa(p,f),Hi(f),P&512&&(Ri||v===null||lo(v,v.return)),v!==null&&P&4&&c_(f,f.memoizedProps,v.memoizedProps);break;case 5:if(aa(p,f),Hi(f),P&512&&(Ri||v===null||lo(v,v.return)),f.flags&32){k=f.stateNode;try{el(k,"")}catch(rr){gn(f,f.return,rr)}}P&4&&f.stateNode!=null&&(k=f.memoizedProps,c_(f,k,v!==null?v.memoizedProps:k)),P&1024&&(mv=!0);break;case 6:if(aa(p,f),Hi(f),P&4){if(f.stateNode===null)throw Error(n(162));P=f.memoizedProps,v=f.stateNode;try{v.nodeValue=P}catch(rr){gn(f,f.return,rr)}}break;case 3:if(Ag=null,k=oa,oa=cu(p.containerInfo),aa(p,f),oa=k,Hi(f),P&4&&v!==null&&v.memoizedState.isDehydrated)try{lp(p.containerInfo)}catch(rr){gn(f,f.return,rr)}mv&&(mv=!1,hg(f));break;case 4:P=oa,oa=cu(f.stateNode.containerInfo),aa(p,f),Hi(f),oa=P;break;case 12:aa(p,f),Hi(f);break;case 31:aa(p,f),Hi(f),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,ug(f,P)));break;case 13:aa(p,f),Hi(f),f.child.flags&8192&&f.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(p_=vi()),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,ug(f,P)));break;case 22:k=f.memoizedState!==null;var je=v!==null&&v.memoizedState!==null,ft=tu,At=Ri;if(tu=ft||k,Ri=At||je,aa(p,f),Ri=At,tu=ft,Hi(f),P&8192)e:for(p=f.stateNode,p._visibility=k?p._visibility&-2:p._visibility|1,k&&(v===null||je||tu||Ri||gl(f)),v=null,p=f;;){if(p.tag===5||p.tag===26){if(v===null){je=v=p;try{if(B=je.stateNode,k)K=B.style,typeof K.setProperty=="function"?K.setProperty("display","none","important"):K.display="none";else{pe=je.stateNode;var Dt=je.memoizedProps.style,dt=Dt!=null&&Dt.hasOwnProperty("display")?Dt.display:null;pe.style.display=dt==null||typeof dt=="boolean"?"":(""+dt).trim()}}catch(rr){gn(je,je.return,rr)}}}else if(p.tag===6){if(v===null){je=p;try{je.stateNode.nodeValue=k?"":je.memoizedProps}catch(rr){gn(je,je.return,rr)}}}else if(p.tag===18){if(v===null){je=p;try{var yt=je.stateNode;k?nn(yt,!0):nn(je.stateNode,!1)}catch(rr){gn(je,je.return,rr)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===f)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===f)break e;for(;p.sibling===null;){if(p.return===null||p.return===f)break e;v===p&&(v=null),p=p.return}v===p&&(v=null),p.sibling.return=p.return,p=p.sibling}P&4&&(P=f.updateQueue,P!==null&&(v=P.retryQueue,v!==null&&(P.retryQueue=null,ug(f,v))));break;case 19:aa(p,f),Hi(f),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,ug(f,P)));break;case 30:break;case 21:break;default:aa(p,f),Hi(f)}}function Hi(f){var p=f.flags;if(p&2){try{for(var v,P=f.return;P!==null;){if(oh(P)){v=P;break}P=P.return}if(v==null)throw Error(n(160));switch(v.tag){case 27:var k=v.stateNode,B=Rf(f);u_(f,B,k);break;case 5:var K=v.stateNode;v.flags&32&&(el(K,""),v.flags&=-33);var pe=Rf(f);u_(f,pe,K);break;case 3:case 4:var je=v.stateNode.containerInfo,ft=Rf(f);gv(f,ft,je);break;default:throw Error(n(161))}}catch(At){gn(f,f.return,At)}f.flags&=-3}p&4096&&(f.flags&=-4097)}function hg(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var p=f;hg(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),f=f.sibling}}function za(f,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)_v(f,p.alternate,p),p=p.sibling}function gl(f){for(f=f.child;f!==null;){var p=f;switch(p.tag){case 0:case 11:case 14:case 15:eu(4,p,p.return),gl(p);break;case 1:lo(p,p.return);var v=p.stateNode;typeof v.componentWillUnmount=="function"&&Gb(p,p.return,v),gl(p);break;case 27:Sg(p.stateNode);case 26:case 5:lo(p,p.return),gl(p);break;case 22:p.memoizedState===null&&gl(p);break;case 30:gl(p);break;default:gl(p)}f=f.sibling}}function ru(f,p,v){for(v=v&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var P=p.alternate,k=f,B=p,K=B.flags;switch(B.tag){case 0:case 11:case 15:ru(k,B,v),Hd(4,B);break;case 1:if(ru(k,B,v),P=B,k=P.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(ft){gn(P,P.return,ft)}if(P=B,k=P.updateQueue,k!==null){var pe=P.stateNode;try{var je=k.shared.hiddenCallbacks;if(je!==null)for(k.shared.hiddenCallbacks=null,k=0;k<je.length;k++)xf(je[k],pe)}catch(ft){gn(P,P.return,ft)}}v&&K&64&&Xb(B),ag(B,B.return);break;case 27:Zb(B);case 26:case 5:ru(k,B,v),v&&P===null&&K&4&&l_(B),ag(B,B.return);break;case 12:ru(k,B,v);break;case 31:ru(k,B,v),v&&K&4&&og(k,B);break;case 13:ru(k,B,v),v&&K&4&&lg(k,B);break;case 22:B.memoizedState===null&&ru(k,B,v),ag(B,B.return);break;case 30:break;default:ru(k,B,v)}p=p.sibling}}function f_(f,p){var v=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),f=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(f=p.memoizedState.cachePool.pool),f!==v&&(f!=null&&f.refCount++,v!=null&&Ju(v))}function nu(f,p){f=null,p.alternate!==null&&(f=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==f&&(p.refCount++,f!=null&&Ju(f))}function ml(f,p,v,P){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)vv(f,p,v,P),p=p.sibling}function vv(f,p,v,P){var k=p.flags;switch(p.tag){case 0:case 11:case 15:ml(f,p,v,P),k&2048&&Hd(9,p);break;case 1:ml(f,p,v,P);break;case 3:ml(f,p,v,P),k&2048&&(f=null,p.alternate!==null&&(f=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==f&&(p.refCount++,f!=null&&Ju(f)));break;case 12:if(k&2048){ml(f,p,v,P),f=p.stateNode;try{var B=p.memoizedProps,K=B.id,pe=B.onPostCommit;typeof pe=="function"&&pe(K,p.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(je){gn(p,p.return,je)}}else ml(f,p,v,P);break;case 31:ml(f,p,v,P);break;case 13:ml(f,p,v,P);break;case 23:break;case 22:B=p.stateNode,K=p.alternate,p.memoizedState!==null?B._visibility&2?ml(f,p,v,P):Of(f,p):B._visibility&2?ml(f,p,v,P):(B._visibility|=2,ic(f,p,v,P,(p.subtreeFlags&10256)!==0||!1)),k&2048&&f_(K,p);break;case 24:ml(f,p,v,P),k&2048&&nu(p.alternate,p);break;default:ml(f,p,v,P)}}function ic(f,p,v,P,k){for(k=k&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var B=f,K=p,pe=v,je=P,ft=K.flags;switch(K.tag){case 0:case 11:case 15:ic(B,K,pe,je,k),Hd(8,K);break;case 23:break;case 22:var At=K.stateNode;K.memoizedState!==null?At._visibility&2?ic(B,K,pe,je,k):Of(B,K):(At._visibility|=2,ic(B,K,pe,je,k)),k&&ft&2048&&f_(K.alternate,K);break;case 24:ic(B,K,pe,je,k),k&&ft&2048&&nu(K.alternate,K);break;default:ic(B,K,pe,je,k)}p=p.sibling}}function Of(f,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var v=f,P=p,k=P.flags;switch(P.tag){case 22:Of(v,P),k&2048&&f_(P.alternate,P);break;case 24:Of(v,P),k&2048&&nu(P.alternate,P);break;default:Of(v,P)}p=p.sibling}}var Xd=8192;function Df(f,p,v){if(f.subtreeFlags&Xd)for(f=f.child;f!==null;)Kb(f,p,v),f=f.sibling}function Kb(f,p,v){switch(f.tag){case 26:Df(f,p,v),f.flags&Xd&&f.memoizedState!==null&&Zv(v,oa,f.memoizedState,f.memoizedProps);break;case 5:Df(f,p,v);break;case 3:case 4:var P=oa;oa=cu(f.stateNode.containerInfo),Df(f,p,v),oa=P;break;case 22:f.memoizedState===null&&(P=f.alternate,P!==null&&P.memoizedState!==null?(P=Xd,Xd=16777216,Df(f,p,v),Xd=P):Df(f,p,v));break;default:Df(f,p,v)}}function Qb(f){var p=f.alternate;if(p!==null&&(f=p.child,f!==null)){p.child=null;do p=f.sibling,f.sibling=null,f=p;while(f!==null)}}function fg(f){var p=f.deletions;if((f.flags&16)!==0){if(p!==null)for(var v=0;v<p.length;v++){var P=p[v];Oi=P,Gd(P,f)}Qb(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)Jb(f),f=f.sibling}function Jb(f){switch(f.tag){case 0:case 11:case 15:fg(f),f.flags&2048&&eu(9,f,f.return);break;case 3:fg(f);break;case 12:fg(f);break;case 22:var p=f.stateNode;f.memoizedState!==null&&p._visibility&2&&(f.return===null||f.return.tag!==13)?(p._visibility&=-3,d_(f)):fg(f);break;default:fg(f)}}function d_(f){var p=f.deletions;if((f.flags&16)!==0){if(p!==null)for(var v=0;v<p.length;v++){var P=p[v];Oi=P,Gd(P,f)}Qb(f)}for(f=f.child;f!==null;){switch(p=f,p.tag){case 0:case 11:case 15:eu(8,p,p.return),d_(p);break;case 22:v=p.stateNode,v._visibility&2&&(v._visibility&=-3,d_(p));break;default:d_(p)}f=f.sibling}}function Gd(f,p){for(;Oi!==null;){var v=Oi;switch(v.tag){case 0:case 11:case 15:eu(8,v,p);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var P=v.memoizedState.cachePool.pool;P!=null&&P.refCount++}break;case 24:Ju(v.memoizedState.cache)}if(P=v.child,P!==null)P.return=v,Oi=P;else e:for(v=f;Oi!==null;){P=Oi;var k=P.sibling,B=P.return;if(qd(P),P===v){Oi=null;break e}if(k!==null){k.return=B,Oi=k;break e}Oi=B}}}var v2={getCacheForType:function(f){var p=li(ti),v=p.data.get(f);return v===void 0&&(v=f(),p.data.set(f,v)),v},cacheSignal:function(){return li(ti).controller.signal}},ex=typeof WeakMap=="function"?WeakMap:Map,pn=0,Dn=null,Ur=null,Vr=0,bn=0,la=null,Wo=!1,lh=!1,bv=!1,iu=0,ui=0,su=0,kf=0,xv=0,fs=0,Lf=0,dg=null,Ba=null,wv=!1,p_=0,tx=0,pg=1/0,Zd=null,au=null,Di=0,ou=null,Yd=null,Ho=0,Tv=0,g_=null,rx=null,gg=0,Sv=null;function Fa(){return(pn&2)!==0&&Vr!==0?Vr&-Vr:fe.T!==null?Dv():Hr()}function nx(){if(fs===0)if((Vr&536870912)===0||zr){var f=Ct;Ct<<=1,(Ct&3932160)===0&&(Ct=262144),fs=f}else fs=536870912;return f=qt.current,f!==null&&(f.flags|=32),fs}function ja(f,p,v){(f===Dn&&(bn===2||bn===9)||f.cancelPendingCommit!==null)&&(Qd(f,0),ch(f,Vr,fs,!1)),vr(f,v),((pn&2)===0||f!==Dn)&&(f===Dn&&((pn&2)===0&&(kf|=v),ui===4&&ch(f,Vr,fs,!1)),_l(f))}function Si(f,p,v){if((pn&6)!==0)throw Error(n(327));var P=!v&&(p&127)===0&&(p&f.expiredLanes)===0||yr(f,p),k=P?Jd(f,p):y_(f,p,!0),B=P;do{if(k===0){lh&&!P&&ch(f,p,0,!1);break}else{if(v=f.current.alternate,B&&!b2(v)){k=y_(f,p,!1),B=!1;continue}if(k===2){if(B=p,f.errorRecoveryDisabledLanes&B)var K=0;else K=f.pendingLanes&-536870913,K=K!==0?K:K&536870912?536870912:0;if(K!==0){p=K;e:{var pe=f;k=dg;var je=pe.current.memoizedState.isDehydrated;if(je&&(Qd(pe,K).flags|=256),K=y_(pe,K,!1),K!==2){if(bv&&!je){pe.errorRecoveryDisabledLanes|=B,kf|=B,k=4;break e}B=Ba,Ba=k,B!==null&&(Ba===null?Ba=B:Ba.push.apply(Ba,B))}k=K}if(B=!1,k!==2)continue}}if(k===1){Qd(f,0),ch(f,p,0,!0);break}e:{switch(P=f,B=k,B){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:ch(P,p,fs,!Wo);break e;case 2:Ba=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(k=p_+300-vi(),10<k)){if(ch(P,p,fs,!Wo),Qt(P,0,!0)!==0)break e;Ho=p,P.timeoutHandle=L_(Kd.bind(null,P,v,Ba,Zd,wv,p,fs,kf,Lf,Wo,B,"Throttled",-0,0),k);break e}Kd(P,v,Ba,Zd,wv,p,fs,kf,Lf,Wo,B,null,-0,0)}}break}while(!0);_l(f)}function Kd(f,p,v,P,k,B,K,pe,je,ft,At,Dt,dt,yt){if(f.timeoutHandle=-1,Dt=p.subtreeFlags,Dt&8192||(Dt&16785408)===16785408){Dt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ka},Kb(p,B,Dt);var rr=(B&62914560)===B?p_-vi():(B&4194048)===B?tx-vi():0;if(rr=Px(Dt,rr),rr!==null){Ho=B,f.cancelPendingCommit=rr(lx.bind(null,f,p,B,v,P,k,K,pe,je,At,Dt,null,dt,yt)),ch(f,B,K,!ft);return}}lx(f,p,B,v,P,k,K,pe,je)}function b2(f){for(var p=f;;){var v=p.tag;if((v===0||v===11||v===15)&&p.flags&16384&&(v=p.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var P=0;P<v.length;P++){var k=v[P],B=k.getSnapshot;k=k.value;try{if(!Ss(B(),k))return!1}catch{return!1}}if(v=p.child,p.subtreeFlags&16384&&v!==null)v.return=p,p=v;else{if(p===f)break;for(;p.sibling===null;){if(p.return===null||p.return===f)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function ch(f,p,v,P){p&=~xv,p&=~kf,f.suspendedLanes|=p,f.pingedLanes&=~p,P&&(f.warmLanes|=p),P=f.expirationTimes;for(var k=p;0<k;){var B=31-Ne(k),K=1<<B;P[B]=-1,k&=~K}v!==0&&Wn(f,v,p)}function mg(){return(pn&6)===0?(co(0),!1):!0}function m_(){if(Ur!==null){if(bn===0)var f=Ur.return;else f=Ur,Do=Ma=null,fl(f),No=null,Hc=0,f=Ur;for(;f!==null;)o_(f.alternate,f),f=f.return;Ur=null}}function Qd(f,p){var v=f.timeoutHandle;v!==-1&&(f.timeoutHandle=-1,Uv(v)),v=f.cancelPendingCommit,v!==null&&(f.cancelPendingCommit=null,v()),Ho=0,m_(),Dn=f,Ur=v=ea(f.current,null),Vr=p,bn=0,la=null,Wo=!1,lh=yr(f,p),bv=!1,Lf=fs=xv=kf=su=ui=0,Ba=dg=null,wv=!1,(p&8)!==0&&(p|=p&32);var P=f.entangledLanes;if(P!==0)for(f=f.entanglements,P&=p;0<P;){var k=31-Ne(P),B=1<<k;p|=f[k],P&=~B}return iu=p,Uc(),v}function Av(f,p){Dr=null,fe.H=rn,p===eo||p===Cs?(p=th(),bn=3):p===Yl?(p=th(),bn=4):bn=p===Qm?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,la=p,Ur===null&&(ui=1,oo(f,hs(p,f.current)))}function Ev(){var f=qt.current;return f===null?!0:(Vr&4194048)===Vr?er===null:(Vr&62914560)===Vr||(Vr&536870912)!==0?f===er:!1}function Nf(){var f=fe.H;return fe.H=rn,f===null?rn:f}function __(){var f=fe.A;return fe.A=v2,f}function _g(){ui=4,Wo||(Vr&4194048)!==Vr&&qt.current!==null||(lh=!0),(su&134217727)===0&&(kf&134217727)===0||Dn===null||ch(Dn,Vr,fs,!1)}function y_(f,p,v){var P=pn;pn|=2;var k=Nf(),B=__();(Dn!==f||Vr!==p)&&(Zd=null,Qd(f,p)),p=!1;var K=ui;e:do try{if(bn!==0&&Ur!==null){var pe=Ur,je=la;switch(bn){case 8:m_(),K=6;break e;case 3:case 2:case 9:case 6:qt.current===null&&(p=!0);var ft=bn;if(bn=0,la=null,ep(f,pe,je,ft),v&&lh){K=0;break e}break;default:ft=bn,bn=0,la=null,ep(f,pe,je,ft)}}v_(),K=ui;break}catch(At){Av(f,At)}while(!0);return p&&f.shellSuspendCounter++,Do=Ma=null,pn=P,fe.H=k,fe.A=B,Ur===null&&(Dn=null,Vr=0,Uc()),K}function v_(){for(;Ur!==null;)sx(Ur)}function Jd(f,p){var v=pn;pn|=2;var P=Nf(),k=__();Dn!==f||Vr!==p?(Zd=null,pg=vi()+500,Qd(f,p)):lh=yr(f,p);e:do try{if(bn!==0&&Ur!==null){p=Ur;var B=la;t:switch(bn){case 1:bn=0,la=null,ep(f,p,B,1);break;case 2:case 9:if(_f(B)){bn=0,la=null,ax(p);break}p=function(){bn!==2&&bn!==9||Dn!==f||(bn=7),_l(f)},B.then(p,p);break e;case 3:bn=7;break e;case 4:bn=5;break e;case 7:_f(B)?(bn=0,la=null,ax(p)):(bn=0,la=null,ep(f,p,B,7));break;case 5:var K=null;switch(Ur.tag){case 26:K=Ur.memoizedState;case 5:case 27:var pe=Ur;if(K?$_(K):pe.stateNode.complete){bn=0,la=null;var je=pe.sibling;if(je!==null)Ur=je;else{var ft=pe.return;ft!==null?(Ur=ft,b_(ft)):Ur=null}break t}}bn=0,la=null,ep(f,p,B,5);break;case 6:bn=0,la=null,ep(f,p,B,6);break;case 8:m_(),ui=6;break e;default:throw Error(n(462))}}ix();break}catch(At){Av(f,At)}while(!0);return Do=Ma=null,fe.H=P,fe.A=k,pn=v,Ur!==null?0:(Dn=null,Vr=0,Uc(),ui)}function ix(){for(;Ur!==null&&!Za();)sx(Ur)}function sx(f){var p=Rs(f.alternate,f,iu);f.memoizedProps=f.pendingProps,p===null?b_(f):Ur=p}function ax(f){var p=f,v=p.alternate;switch(p.tag){case 15:case 0:p=Vb(v,p,p.pendingProps,p.type,void 0,Vr);break;case 11:p=Vb(v,p,p.pendingProps,p.type.render,p.ref,Vr);break;case 5:fl(p);default:o_(v,p),p=Ur=Xm(p,iu),p=Rs(v,p,iu)}f.memoizedProps=f.pendingProps,p===null?b_(f):Ur=p}function ep(f,p,v,P){Do=Ma=null,fl(p),No=null,Hc=0;var k=p.return;try{if(Km(f,k,p,v,Vr)){ui=1,oo(f,hs(v,f.current)),Ur=null;return}}catch(B){if(k!==null)throw Ur=k,B;ui=1,oo(f,hs(v,f.current)),Ur=null;return}p.flags&32768?(zr||P===1?f=!0:lh||(Vr&536870912)!==0?f=!1:(Wo=f=!0,(P===2||P===9||P===3||P===6)&&(P=qt.current,P!==null&&P.tag===13&&(P.flags|=16384))),ox(p,f)):b_(p)}function b_(f){var p=f;do{if((p.flags&32768)!==0){ox(p,Wo);return}f=p.return;var v=qb(p.alternate,p,iu);if(v!==null){Ur=v;return}if(p=p.sibling,p!==null){Ur=p;return}Ur=p=f}while(p!==null);ui===0&&(ui=5)}function ox(f,p){do{var v=_2(f.alternate,f);if(v!==null){v.flags&=32767,Ur=v;return}if(v=f.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!p&&(f=f.sibling,f!==null)){Ur=f;return}Ur=f=v}while(f!==null);ui=6,Ur=null}function lx(f,p,v,P,k,B,K,pe,je){f.cancelPendingCommit=null;do x_();while(Di!==0);if((pn&6)!==0)throw Error(n(327));if(p!==null){if(p===f.current)throw Error(n(177));if(B=p.lanes|p.childLanes,B|=jc,En(f,v,B,K,pe,je),f===Dn&&(Ur=Dn=null,Vr=0),Yd=p,ou=f,Ho=v,Tv=B,g_=k,rx=P,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,px(Ko,function(){return dx(),null})):(f.callbackNode=null,f.callbackPriority=0),P=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||P){P=fe.T,fe.T=null,k=Me.p,Me.p=2,K=pn,pn|=4;try{y2(f,p,v)}finally{pn=K,Me.p=k,fe.T=P}}Di=1,cx(),ux(),hx()}}function cx(){if(Di===1){Di=0;var f=ou,p=Yd,v=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||v){v=fe.T,fe.T=null;var P=Me.p;Me.p=2;var k=pn;pn|=4;try{h_(p,f);var B=Fv,K=wd(f.containerInfo),pe=B.focusedElem,je=B.selectionRange;if(K!==pe&&pe&&pe.ownerDocument&&xd(pe.ownerDocument.documentElement,pe)){if(je!==null&&of(pe)){var ft=je.start,At=je.end;if(At===void 0&&(At=ft),"selectionStart"in pe)pe.selectionStart=ft,pe.selectionEnd=Math.min(At,pe.value.length);else{var Dt=pe.ownerDocument||document,dt=Dt&&Dt.defaultView||window;if(dt.getSelection){var yt=dt.getSelection(),rr=pe.textContent.length,wr=Math.min(je.start,rr),mn=je.end===void 0?wr:Math.min(je.end,rr);!yt.extend&&wr>mn&&(K=mn,mn=wr,wr=K);var Qe=af(pe,wr),$e=af(pe,mn);if(Qe&&$e&&(yt.rangeCount!==1||yt.anchorNode!==Qe.node||yt.anchorOffset!==Qe.offset||yt.focusNode!==$e.node||yt.focusOffset!==$e.offset)){var ht=Dt.createRange();ht.setStart(Qe.node,Qe.offset),yt.removeAllRanges(),wr>mn?(yt.addRange(ht),yt.extend($e.node,$e.offset)):(ht.setEnd($e.node,$e.offset),yt.addRange(ht))}}}}for(Dt=[],yt=pe;yt=yt.parentNode;)yt.nodeType===1&&Dt.push({element:yt,left:yt.scrollLeft,top:yt.scrollTop});for(typeof pe.focus=="function"&&pe.focus(),pe=0;pe<Dt.length;pe++){var Mt=Dt[pe];Mt.element.scrollLeft=Mt.left,Mt.element.scrollTop=Mt.top}}yh=!!wg,Fv=wg=null}finally{pn=k,Me.p=P,fe.T=v}}f.current=p,Di=2}}function ux(){if(Di===2){Di=0;var f=ou,p=Yd,v=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||v){v=fe.T,fe.T=null;var P=Me.p;Me.p=2;var k=pn;pn|=4;try{_v(f,p.alternate,p)}finally{pn=k,Me.p=P,fe.T=v}}Di=3}}function hx(){if(Di===4||Di===3){Di=0,Du();var f=ou,p=Yd,v=Ho,P=rx;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Di=5:(Di=0,Yd=ou=null,fx(f,f.pendingLanes));var k=f.pendingLanes;if(k===0&&(au=null),Ot(v),p=p.stateNode,oe&&typeof oe.onCommitFiberRoot=="function")try{oe.onCommitFiberRoot(ie,p,void 0,(p.current.flags&128)===128)}catch{}if(P!==null){p=fe.T,k=Me.p,Me.p=2,fe.T=null;try{for(var B=f.onRecoverableError,K=0;K<P.length;K++){var pe=P[K];B(pe.value,{componentStack:pe.stack})}}finally{fe.T=p,Me.p=k}}(Ho&3)!==0&&x_(),_l(f),k=f.pendingLanes,(v&261930)!==0&&(k&42)!==0?f===Sv?gg++:(gg=0,Sv=f):gg=0,co(0)}}function fx(f,p){(f.pooledCacheLanes&=p)===0&&(p=f.pooledCache,p!=null&&(f.pooledCache=null,Ju(p)))}function x_(){return cx(),ux(),hx(),dx()}function dx(){if(Di!==5)return!1;var f=ou,p=Tv;Tv=0;var v=Ot(Ho),P=fe.T,k=Me.p;try{Me.p=32>v?32:v,fe.T=null,v=g_,g_=null;var B=ou,K=Ho;if(Di=0,Yd=ou=null,Ho=0,(pn&6)!==0)throw Error(n(331));var pe=pn;if(pn|=4,Jb(B.current),vv(B,B.current,K,v),pn=pe,co(0,!1),oe&&typeof oe.onPostCommitFiberRoot=="function")try{oe.onPostCommitFiberRoot(ie,B)}catch{}return!0}finally{Me.p=k,fe.T=P,fx(f,p)}}function Pv(f,p,v){p=hs(v,p),p=Cf(f.stateNode,p,2),f=ll(f,p,2),f!==null&&(vr(f,2),_l(f))}function gn(f,p,v){if(f.tag===3)Pv(f,f,v);else for(;p!==null;){if(p.tag===3){Pv(p,f,v);break}else if(p.tag===1){var P=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(au===null||!au.has(P))){f=hs(v,f),v=Mf(2),P=ll(p,v,2),P!==null&&(If(v,P,p,f),vr(P,2),_l(P));break}}p=p.return}}function w_(f,p,v){var P=f.pingCache;if(P===null){P=f.pingCache=new ex;var k=new Set;P.set(p,k)}else k=P.get(p),k===void 0&&(k=new Set,P.set(p,k));k.has(v)||(bv=!0,k.add(v),f=uh.bind(null,f,p,v),p.then(f,f))}function uh(f,p,v){var P=f.pingCache;P!==null&&P.delete(p),f.pingedLanes|=f.suspendedLanes&v,f.warmLanes&=~v,Dn===f&&(Vr&v)===v&&(ui===4||ui===3&&(Vr&62914560)===Vr&&300>vi()-p_?(pn&2)===0&&Qd(f,0):xv|=v,Lf===Vr&&(Lf=0)),_l(f)}function yg(f,p){p===0&&(p=fr()),f=Ca(f,p),f!==null&&(vr(f,p),_l(f))}function Cv(f){var p=f.memoizedState,v=0;p!==null&&(v=p.retryLane),yg(f,v)}function x2(f,p){var v=0;switch(f.tag){case 31:case 13:var P=f.stateNode,k=f.memoizedState;k!==null&&(v=k.retryLane);break;case 19:P=f.stateNode;break;case 22:P=f.stateNode._retryCache;break;default:throw Error(n(314))}P!==null&&P.delete(p),yg(f,v)}function px(f,p){return Zo(f,p)}var T_=null,tp=null,Mv=!1,S_=!1,Iv=!1,lu=0;function _l(f){f!==tp&&f.next===null&&(tp===null?T_=tp=f:tp=tp.next=f),S_=!0,Mv||(Mv=!0,Ov())}function co(f,p){if(!Iv&&S_){Iv=!0;do for(var v=!1,P=T_;P!==null;){if(f!==0){var k=P.pendingLanes;if(k===0)var B=0;else{var K=P.suspendedLanes,pe=P.pingedLanes;B=(1<<31-Ne(42|f)+1)-1,B&=k&~(K&~pe),B=B&201326741?B&201326741|1:B?B|2:0}B!==0&&(v=!0,vg(P,B))}else B=Vr,B=Qt(P,P===Dn?B:0,P.cancelPendingCommit!==null||P.timeoutHandle!==-1),(B&3)===0||yr(P,B)||(v=!0,vg(P,B));P=P.next}while(v);Iv=!1}}function hh(){Rv()}function Rv(){S_=Mv=!1;var f=0;lu!==0&&k_()&&(f=lu);for(var p=vi(),v=null,P=T_;P!==null;){var k=P.next,B=A_(P,p);B===0?(P.next=null,v===null?T_=k:v.next=k,k===null&&(tp=v)):(v=P,(f!==0||(B&3)!==0)&&(S_=!0)),P=k}Di!==0&&Di!==5||co(f),lu!==0&&(lu=0)}function A_(f,p){for(var v=f.suspendedLanes,P=f.pingedLanes,k=f.expirationTimes,B=f.pendingLanes&-62914561;0<B;){var K=31-Ne(B),pe=1<<K,je=k[K];je===-1?((pe&v)===0||(pe&P)!==0)&&(k[K]=or(pe,p)):je<=p&&(f.expiredLanes|=pe),B&=~pe}if(p=Dn,v=Vr,v=Qt(f,f===p?v:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),P=f.callbackNode,v===0||f===p&&(bn===2||bn===9)||f.cancelPendingCommit!==null)return P!==null&&P!==null&&yo(P),f.callbackNode=null,f.callbackPriority=0;if((v&3)===0||yr(f,v)){if(p=v&-v,p===f.callbackPriority)return p;switch(P!==null&&yo(P),Ot(v)){case 2:case 8:v=Yo;break;case 32:v=Ko;break;case 268435456:v=Ol;break;default:v=Ko}return P=gx.bind(null,f),v=Zo(v,P),f.callbackPriority=p,f.callbackNode=v,p}return P!==null&&P!==null&&yo(P),f.callbackPriority=2,f.callbackNode=null,2}function gx(f,p){if(Di!==0&&Di!==5)return f.callbackNode=null,f.callbackPriority=0,null;var v=f.callbackNode;if(x_()&&f.callbackNode!==v)return null;var P=Vr;return P=Qt(f,f===Dn?P:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),P===0?null:(Si(f,P,p),A_(f,vi()),f.callbackNode!=null&&f.callbackNode===v?gx.bind(null,f):null)}function vg(f,p){if(x_())return null;Si(f,p,!0)}function Ov(){$v(function(){(pn&6)!==0?Zo(ku,hh):Rv()})}function Dv(){if(lu===0){var f=Wc;f===0&&(f=et,et<<=1,(et&261888)===0&&(et=256)),lu=f}return lu}function E_(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:Cr(""+f)}function P_(f,p){var v=p.ownerDocument.createElement("input");return v.name=p.name,v.value=p.value,f.id&&v.setAttribute("form",f.id),p.parentNode.insertBefore(v,p),f=new FormData(f),v.parentNode.removeChild(v),f}function rp(f,p,v,P,k){if(p==="submit"&&v&&v.stateNode===k){var B=E_((k[Nt]||null).action),K=P.submitter;K&&(p=(p=K[Nt]||null)?E_(p.formAction):K.getAttribute("formAction"),p!==null&&(B=p,K=null));var pe=new Gh("action","action",null,P,k);f.push({event:pe,listeners:[{instance:null,listener:function(){if(P.defaultPrevented){if(lu!==0){var je=K?P_(k,K):new FormData(k);Zn(v,{pending:!0,data:je,method:k.method,action:B},null,je)}}else typeof B=="function"&&(pe.preventDefault(),je=K?P_(k,K):new FormData(k),Zn(v,{pending:!0,data:je,method:k.method,action:B},B,je))},currentTarget:k}]})}}for(var C_=0;C_<Ed.length;C_++){var M_=Ed[C_],kv=M_.toLowerCase(),mx=M_[0].toUpperCase()+M_.slice(1);Qs(kv,"on"+mx)}Qs(uf,"onAnimationEnd"),Qs(hf,"onAnimationIteration"),Qs(Ad,"onAnimationStart"),Qs("dblclick","onDoubleClick"),Qs("focusin","onFocus"),Qs("focusout","onBlur"),Qs(Fc,"onTransitionRun"),Qs(ff,"onTransitionStart"),Qs(Gu,"onTransitionCancel"),Qs(Ks,"onTransitionEnd"),Jo("onMouseEnter",["mouseout","mouseover"]),Jo("onMouseLeave",["mouseout","mouseover"]),Jo("onPointerEnter",["pointerout","pointerover"]),Jo("onPointerLeave",["pointerout","pointerover"]),Fr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_x=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fh));function yx(f,p){p=(p&4)!==0;for(var v=0;v<f.length;v++){var P=f[v],k=P.event;P=P.listeners;e:{var B=void 0;if(p)for(var K=P.length-1;0<=K;K--){var pe=P[K],je=pe.instance,ft=pe.currentTarget;if(pe=pe.listener,je!==B&&k.isPropagationStopped())break e;B=pe,k.currentTarget=ft;try{B(k)}catch(At){Po(At)}k.currentTarget=null,B=je}else for(K=0;K<P.length;K++){if(pe=P[K],je=pe.instance,ft=pe.currentTarget,pe=pe.listener,je!==B&&k.isPropagationStopped())break e;B=pe,k.currentTarget=ft;try{B(k)}catch(At){Po(At)}k.currentTarget=null,B=je}}}}function $r(f,p){var v=p[Sr];v===void 0&&(v=p[Sr]=new Set);var P=f+"__bubble";v.has(P)||(R_(p,f,2,!1),v.add(P))}function Lv(f,p,v){var P=0;p&&(P|=4),R_(v,f,P,p)}var I_="_reactListening"+Math.random().toString(36).slice(2);function Nv(f){if(!f[I_]){f[I_]=!0,Lu.forEach(function(v){v!=="selectionchange"&&(_x.has(v)||Lv(v,!1,f),Lv(v,!0,f))});var p=f.nodeType===9?f:f.ownerDocument;p===null||p[I_]||(p[I_]=!0,Lv("selectionchange",!1,p))}}function R_(f,p,v,P){switch(Dx(p)){case 2:var k=w2;break;case 8:k=Jv;break;default:k=Dg}v=k.bind(null,p,v,f),k=void 0,!as||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(k=!0),P?k!==void 0?f.addEventListener(p,v,{capture:!0,passive:k}):f.addEventListener(p,v,!0):k!==void 0?f.addEventListener(p,v,{passive:k}):f.addEventListener(p,v,!1)}function sc(f,p,v,P,k){var B=P;if((p&1)===0&&(p&2)===0&&P!==null)e:for(;;){if(P===null)return;var K=P.tag;if(K===3||K===4){var pe=P.stateNode.containerInfo;if(pe===k)break;if(K===4)for(K=P.return;K!==null;){var je=K.tag;if((je===3||je===4)&&K.stateNode.containerInfo===k)return;K=K.return}for(;pe!==null;){if(K=bo(pe),K===null)return;if(je=K.tag,je===5||je===6||je===26||je===27){P=B=K;continue e}pe=pe.parentNode}}P=P.return}un(function(){var ft=B,At=Xh(v),Dt=[];e:{var dt=Vp.get(f);if(dt!==void 0){var yt=Gh,rr=f;switch(f){case"keypress":if(Ys(v)===0)break e;case"keydown":case"keyup":yt=Xn;break;case"focusin":rr="focus",yt=Bl;break;case"focusout":rr="blur",yt=Bl;break;case"beforeblur":case"afterblur":yt=Bl;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=Zh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=sv;break;case uf:case hf:case Ad:yt=Lm;break;case Ks:yt=_d;break;case"scroll":case"scrollend":yt=Dc;break;case"wheel":yt=zp;break;case"copy":case"cut":case"paste":yt=Lp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=md;break;case"toggle":case"beforetoggle":yt=Vu}var wr=(p&4)!==0,mn=!wr&&(f==="scroll"||f==="scrollend"),Qe=wr?dt!==null?dt+"Capture":null:dt;wr=[];for(var $e=ft,ht;$e!==null;){var Mt=$e;if(ht=Mt.stateNode,Mt=Mt.tag,Mt!==5&&Mt!==26&&Mt!==27||ht===null||Qe===null||(Mt=Sa($e,Qe),Mt!=null&&wr.push(np($e,Mt,ht))),mn)break;$e=$e.return}0<wr.length&&(dt=new yt(dt,rr,null,v,At),Dt.push({event:dt,listeners:wr}))}}if((p&7)===0){e:{if(dt=f==="mouseover"||f==="pointerover",yt=f==="mouseout"||f==="pointerout",dt&&v!==kp&&(rr=v.relatedTarget||v.fromElement)&&(bo(rr)||rr[hr]))break e;if((yt||dt)&&(dt=At.window===At?At:(dt=At.ownerDocument)?dt.defaultView||dt.parentWindow:window,yt?(rr=v.relatedTarget||v.toElement,yt=ft,rr=rr?bo(rr):null,rr!==null&&(mn=l(rr),wr=rr.tag,rr!==mn||wr!==5&&wr!==27&&wr!==6)&&(rr=null)):(yt=null,rr=ft),yt!==rr)){if(wr=kc,Mt="onMouseLeave",Qe="onMouseEnter",$e="mouse",(f==="pointerout"||f==="pointerover")&&(wr=md,Mt="onPointerLeave",Qe="onPointerEnter",$e="pointer"),mn=yt==null?dt:xo(yt),ht=rr==null?dt:xo(rr),dt=new wr(Mt,$e+"leave",yt,v,At),dt.target=mn,dt.relatedTarget=ht,Mt=null,bo(At)===ft&&(wr=new wr(Qe,$e+"enter",rr,v,At),wr.target=ht,wr.relatedTarget=mn,Mt=wr),mn=Mt,yt&&rr)t:{for(wr=vx,Qe=yt,$e=rr,ht=0,Mt=Qe;Mt;Mt=wr(Mt))ht++;Mt=0;for(var gr=$e;gr;gr=wr(gr))Mt++;for(;0<ht-Mt;)Qe=wr(Qe),ht--;for(;0<Mt-ht;)$e=wr($e),Mt--;for(;ht--;){if(Qe===$e||$e!==null&&Qe===$e.alternate){wr=Qe;break t}Qe=wr(Qe),$e=wr($e)}wr=null}else wr=null;yt!==null&&zv(Dt,dt,yt,wr,!1),rr!==null&&mn!==null&&zv(Dt,mn,rr,wr,!0)}}e:{if(dt=ft?xo(ft):window,yt=dt.nodeName&&dt.nodeName.toLowerCase(),yt==="select"||yt==="input"&&dt.type==="file")var ln=Ul;else if(vd(dt))if(Bp)ln=Hm;else{ln=Wm;var lr=av}else yt=dt.nodeName,!yt||yt.toLowerCase()!=="input"||dt.type!=="checkbox"&&dt.type!=="radio"?ft&&Ic(ft.elementType)&&(ln=Ul):ln=sf;if(ln&&(ln=ln(f,ft))){bd(Dt,ln,v,At);break e}lr&&lr(f,dt,ft),f==="focusout"&&ft&&dt.type==="number"&&ft.memoizedProps.value!=null&&qh(dt,"number",dt.value)}switch(lr=ft?xo(ft):window,f){case"focusin":(vd(lr)||lr.contentEditable==="true")&&(Pa=lr,lf=ft,cf=null);break;case"focusout":cf=lf=Pa=null;break;case"mousedown":Sd=!0;break;case"contextmenu":case"mouseup":case"dragend":Sd=!1,qm(Dt,v,At);break;case"selectionchange":if(Td)break;case"keydown":case"keyup":qm(Dt,v,At)}var Ir;if(ei)e:{switch(f){case"compositionstart":var br="onCompositionStart";break e;case"compositionend":br="onCompositionEnd";break e;case"compositionupdate":br="onCompositionUpdate";break e}br=void 0}else Qa?ef(f,v)&&(br="onCompositionEnd"):f==="keydown"&&v.keyCode===229&&(br="onCompositionStart");br&&(qu&&v.locale!=="ko"&&(Qa||br!=="onCompositionStart"?br==="onCompositionEnd"&&Qa&&(Ir=Nl()):(Zs=At,So="value"in Zs?Zs.value:Zs.textContent,Qa=!0)),lr=bg(ft,br),0<lr.length&&(br=new Np(br,f,null,v,At),Dt.push({event:br,listeners:lr}),Ir?br.data=Ir:(Ir=Fm(v),Ir!==null&&(br.data=Ir)))),(Ir=Hu?yd(f,v):jm(f,v))&&(br=bg(ft,"onBeforeInput"),0<br.length&&(lr=new Np("onBeforeInput","beforeinput",null,v,At),Dt.push({event:lr,listeners:br}),lr.data=Ir)),rp(Dt,f,ft,v,At)}yx(Dt,p)})}function np(f,p,v){return{instance:f,listener:p,currentTarget:v}}function bg(f,p){for(var v=p+"Capture",P=[];f!==null;){var k=f,B=k.stateNode;if(k=k.tag,k!==5&&k!==26&&k!==27||B===null||(k=Sa(f,v),k!=null&&P.unshift(np(f,k,B)),k=Sa(f,p),k!=null&&P.push(np(f,k,B))),f.tag===3)return P;f=f.return}return[]}function vx(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function zv(f,p,v,P,k){for(var B=p._reactName,K=[];v!==null&&v!==P;){var pe=v,je=pe.alternate,ft=pe.stateNode;if(pe=pe.tag,je!==null&&je===P)break;pe!==5&&pe!==26&&pe!==27||ft===null||(je=ft,k?(ft=Sa(v,B),ft!=null&&K.unshift(np(v,ft,je))):k||(ft=Sa(v,B),ft!=null&&K.push(np(v,ft,je)))),v=v.return}K.length!==0&&f.push({event:p,listeners:K})}var bx=/\r\n?/g,xx=/\u0000|\uFFFD/g;function xg(f){return(typeof f=="string"?f:""+f).replace(bx,`
`).replace(xx,"")}function Bv(f,p){return p=xg(p),xg(f)===p}function on(f,p,v,P,k,B){switch(v){case"children":typeof P=="string"?p==="body"||p==="textarea"&&P===""||el(f,P):(typeof P=="number"||typeof P=="bigint")&&p!=="body"&&el(f,""+P);break;case"className":To(f,"class",P);break;case"tabIndex":To(f,"tabindex",P);break;case"dir":case"role":case"viewBox":case"width":case"height":To(f,v,P);break;case"style":gd(f,P,B);break;case"data":if(p!=="object"){To(f,"data",P);break}case"src":case"href":if(P===""&&(p!=="a"||v!=="href")){f.removeAttribute(v);break}if(P==null||typeof P=="function"||typeof P=="symbol"||typeof P=="boolean"){f.removeAttribute(v);break}P=Cr(""+P),f.setAttribute(v,P);break;case"action":case"formAction":if(typeof P=="function"){f.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(v==="formAction"?(p!=="input"&&on(f,p,"name",k.name,k,null),on(f,p,"formEncType",k.formEncType,k,null),on(f,p,"formMethod",k.formMethod,k,null),on(f,p,"formTarget",k.formTarget,k,null)):(on(f,p,"encType",k.encType,k,null),on(f,p,"method",k.method,k,null),on(f,p,"target",k.target,k,null)));if(P==null||typeof P=="symbol"||typeof P=="boolean"){f.removeAttribute(v);break}P=Cr(""+P),f.setAttribute(v,P);break;case"onClick":P!=null&&(f.onclick=Ka);break;case"onScroll":P!=null&&$r("scroll",f);break;case"onScrollEnd":P!=null&&$r("scrollend",f);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(n(61));if(v=P.__html,v!=null){if(k.children!=null)throw Error(n(60));f.innerHTML=v}}break;case"multiple":f.multiple=P&&typeof P!="function"&&typeof P!="symbol";break;case"muted":f.muted=P&&typeof P!="function"&&typeof P!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(P==null||typeof P=="function"||typeof P=="boolean"||typeof P=="symbol"){f.removeAttribute("xlink:href");break}v=Cr(""+P),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":P!=null&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(v,""+P):f.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":P&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(v,""):f.removeAttribute(v);break;case"capture":case"download":P===!0?f.setAttribute(v,""):P!==!1&&P!=null&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(v,P):f.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":P!=null&&typeof P!="function"&&typeof P!="symbol"&&!isNaN(P)&&1<=P?f.setAttribute(v,P):f.removeAttribute(v);break;case"rowSpan":case"start":P==null||typeof P=="function"||typeof P=="symbol"||isNaN(P)?f.removeAttribute(v):f.setAttribute(v,P);break;case"popover":$r("beforetoggle",f),$r("toggle",f),$h(f,"popover",P);break;case"xlinkActuate":Ta(f,"http://www.w3.org/1999/xlink","xlink:actuate",P);break;case"xlinkArcrole":Ta(f,"http://www.w3.org/1999/xlink","xlink:arcrole",P);break;case"xlinkRole":Ta(f,"http://www.w3.org/1999/xlink","xlink:role",P);break;case"xlinkShow":Ta(f,"http://www.w3.org/1999/xlink","xlink:show",P);break;case"xlinkTitle":Ta(f,"http://www.w3.org/1999/xlink","xlink:title",P);break;case"xlinkType":Ta(f,"http://www.w3.org/1999/xlink","xlink:type",P);break;case"xmlBase":Ta(f,"http://www.w3.org/XML/1998/namespace","xml:base",P);break;case"xmlLang":Ta(f,"http://www.w3.org/XML/1998/namespace","xml:lang",P);break;case"xmlSpace":Ta(f,"http://www.w3.org/XML/1998/namespace","xml:space",P);break;case"is":$h(f,"is",P);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=Ll.get(v)||v,$h(f,v,P))}}function O_(f,p,v,P,k,B){switch(v){case"style":gd(f,P,B);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(n(61));if(v=P.__html,v!=null){if(k.children!=null)throw Error(n(60));f.innerHTML=v}}break;case"children":typeof P=="string"?el(f,P):(typeof P=="number"||typeof P=="bigint")&&el(f,""+P);break;case"onScroll":P!=null&&$r("scroll",f);break;case"onScrollEnd":P!=null&&$r("scrollend",f);break;case"onClick":P!=null&&(f.onclick=Ka);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xi.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(k=v.endsWith("Capture"),p=v.slice(2,k?v.length-7:void 0),B=f[Nt]||null,B=B!=null?B[v]:null,typeof B=="function"&&f.removeEventListener(p,B,k),typeof P=="function")){typeof B!="function"&&B!==null&&(v in f?f[v]=null:f.hasAttribute(v)&&f.removeAttribute(v)),f.addEventListener(p,P,k);break e}v in f?f[v]=P:P===!0?f.setAttribute(v,""):$h(f,v,P)}}}function qi(f,p,v){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$r("error",f),$r("load",f);var P=!1,k=!1,B;for(B in v)if(v.hasOwnProperty(B)){var K=v[B];if(K!=null)switch(B){case"src":P=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:on(f,p,B,K,v,null)}}k&&on(f,p,"srcSet",v.srcSet,v,null),P&&on(f,p,"src",v.src,v,null);return;case"input":$r("invalid",f);var pe=B=K=k=null,je=null,ft=null;for(P in v)if(v.hasOwnProperty(P)){var At=v[P];if(At!=null)switch(P){case"name":k=At;break;case"type":K=At;break;case"checked":je=At;break;case"defaultChecked":ft=At;break;case"value":B=At;break;case"defaultValue":pe=At;break;case"children":case"dangerouslySetInnerHTML":if(At!=null)throw Error(n(137,p));break;default:on(f,p,P,At,v,null)}}pd(f,B,pe,je,ft,K,k,!1);return;case"select":$r("invalid",f),P=K=B=null;for(k in v)if(v.hasOwnProperty(k)&&(pe=v[k],pe!=null))switch(k){case"value":B=pe;break;case"defaultValue":K=pe;break;case"multiple":P=pe;default:on(f,p,k,pe,v,null)}p=B,v=K,f.multiple=!!P,p!=null?kl(f,!!P,p,!1):v!=null&&kl(f,!!P,v,!0);return;case"textarea":$r("invalid",f),B=k=P=null;for(K in v)if(v.hasOwnProperty(K)&&(pe=v[K],pe!=null))switch(K){case"value":P=pe;break;case"defaultValue":k=pe;break;case"children":B=pe;break;case"dangerouslySetInnerHTML":if(pe!=null)throw Error(n(91));break;default:on(f,p,K,pe,v,null)}Bu(f,P,k,B);return;case"option":for(je in v)v.hasOwnProperty(je)&&(P=v[je],P!=null)&&(je==="selected"?f.selected=P&&typeof P!="function"&&typeof P!="symbol":on(f,p,je,P,v,null));return;case"dialog":$r("beforetoggle",f),$r("toggle",f),$r("cancel",f),$r("close",f);break;case"iframe":case"object":$r("load",f);break;case"video":case"audio":for(P=0;P<fh.length;P++)$r(fh[P],f);break;case"image":$r("error",f),$r("load",f);break;case"details":$r("toggle",f);break;case"embed":case"source":case"link":$r("error",f),$r("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ft in v)if(v.hasOwnProperty(ft)&&(P=v[ft],P!=null))switch(ft){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:on(f,p,ft,P,v,null)}return;default:if(Ic(p)){for(At in v)v.hasOwnProperty(At)&&(P=v[At],P!==void 0&&O_(f,p,At,P,v,void 0));return}}for(pe in v)v.hasOwnProperty(pe)&&(P=v[pe],P!=null&&on(f,p,pe,P,v,null))}function wx(f,p,v,P){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,B=null,K=null,pe=null,je=null,ft=null,At=null;for(yt in v){var Dt=v[yt];if(v.hasOwnProperty(yt)&&Dt!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":je=Dt;default:P.hasOwnProperty(yt)||on(f,p,yt,null,P,Dt)}}for(var dt in P){var yt=P[dt];if(Dt=v[dt],P.hasOwnProperty(dt)&&(yt!=null||Dt!=null))switch(dt){case"type":B=yt;break;case"name":k=yt;break;case"checked":ft=yt;break;case"defaultChecked":At=yt;break;case"value":K=yt;break;case"defaultValue":pe=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(n(137,p));break;default:yt!==Dt&&on(f,p,dt,yt,P,Dt)}}Hh(f,K,pe,je,ft,At,B,k);return;case"select":yt=K=pe=dt=null;for(B in v)if(je=v[B],v.hasOwnProperty(B)&&je!=null)switch(B){case"value":break;case"multiple":yt=je;default:P.hasOwnProperty(B)||on(f,p,B,null,P,je)}for(k in P)if(B=P[k],je=v[k],P.hasOwnProperty(k)&&(B!=null||je!=null))switch(k){case"value":dt=B;break;case"defaultValue":pe=B;break;case"multiple":K=B;default:B!==je&&on(f,p,k,B,P,je)}p=pe,v=K,P=yt,dt!=null?kl(f,!!v,dt,!1):!!P!=!!v&&(p!=null?kl(f,!!v,p,!0):kl(f,!!v,v?[]:"",!1));return;case"textarea":yt=dt=null;for(pe in v)if(k=v[pe],v.hasOwnProperty(pe)&&k!=null&&!P.hasOwnProperty(pe))switch(pe){case"value":break;case"children":break;default:on(f,p,pe,null,P,k)}for(K in P)if(k=P[K],B=v[K],P.hasOwnProperty(K)&&(k!=null||B!=null))switch(K){case"value":dt=k;break;case"defaultValue":yt=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(n(91));break;default:k!==B&&on(f,p,K,k,P,B)}Dm(f,dt,yt);return;case"option":for(var rr in v)dt=v[rr],v.hasOwnProperty(rr)&&dt!=null&&!P.hasOwnProperty(rr)&&(rr==="selected"?f.selected=!1:on(f,p,rr,null,P,dt));for(je in P)dt=P[je],yt=v[je],P.hasOwnProperty(je)&&dt!==yt&&(dt!=null||yt!=null)&&(je==="selected"?f.selected=dt&&typeof dt!="function"&&typeof dt!="symbol":on(f,p,je,dt,P,yt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var wr in v)dt=v[wr],v.hasOwnProperty(wr)&&dt!=null&&!P.hasOwnProperty(wr)&&on(f,p,wr,null,P,dt);for(ft in P)if(dt=P[ft],yt=v[ft],P.hasOwnProperty(ft)&&dt!==yt&&(dt!=null||yt!=null))switch(ft){case"children":case"dangerouslySetInnerHTML":if(dt!=null)throw Error(n(137,p));break;default:on(f,p,ft,dt,P,yt)}return;default:if(Ic(p)){for(var mn in v)dt=v[mn],v.hasOwnProperty(mn)&&dt!==void 0&&!P.hasOwnProperty(mn)&&O_(f,p,mn,void 0,P,dt);for(At in P)dt=P[At],yt=v[At],!P.hasOwnProperty(At)||dt===yt||dt===void 0&&yt===void 0||O_(f,p,At,dt,P,yt);return}}for(var Qe in v)dt=v[Qe],v.hasOwnProperty(Qe)&&dt!=null&&!P.hasOwnProperty(Qe)&&on(f,p,Qe,null,P,dt);for(Dt in P)dt=P[Dt],yt=v[Dt],!P.hasOwnProperty(Dt)||dt===yt||dt==null&&yt==null||on(f,p,Dt,dt,P,yt)}function ca(f){switch(f){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ip(){if(typeof performance.getEntriesByType=="function"){for(var f=0,p=0,v=performance.getEntriesByType("resource"),P=0;P<v.length;P++){var k=v[P],B=k.transferSize,K=k.initiatorType,pe=k.duration;if(B&&pe&&ca(K)){for(K=0,pe=k.responseEnd,P+=1;P<v.length;P++){var je=v[P],ft=je.startTime;if(ft>pe)break;var At=je.transferSize,Dt=je.initiatorType;At&&ca(Dt)&&(je=je.responseEnd,K+=At*(je<pe?1:(pe-ft)/(je-ft)))}if(--P,p+=8*(B+K)/(k.duration/1e3),f++,10<f)break}}if(0<f)return p/f/1e6}return navigator.connection&&(f=navigator.connection.downlink,typeof f=="number")?f:5}var wg=null,Fv=null;function Tg(f){return f.nodeType===9?f:f.ownerDocument}function dh(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function jv(f,p){if(f===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&p==="foreignObject"?0:f}function D_(f,p){return f==="textarea"||f==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var ph=null;function k_(){var f=window.event;return f&&f.type==="popstate"?f===ph?!1:(ph=f,!0):(ph=null,!1)}var L_=typeof setTimeout=="function"?setTimeout:void 0,Uv=typeof clearTimeout=="function"?clearTimeout:void 0,Vv=typeof Promise=="function"?Promise:void 0,$v=typeof queueMicrotask=="function"?queueMicrotask:typeof Vv<"u"?function(f){return Vv.resolve(null).then(f).catch(Wv)}:L_;function Wv(f){setTimeout(function(){throw f})}function gh(f){return f==="head"}function Tx(f,p){var v=p,P=0;do{var k=v.nextSibling;if(f.removeChild(v),k&&k.nodeType===8)if(v=k.data,v==="/$"||v==="/&"){if(P===0){f.removeChild(k),lp(p);return}P--}else if(v==="$"||v==="$?"||v==="$~"||v==="$!"||v==="&")P++;else if(v==="html")Sg(f.ownerDocument.documentElement);else if(v==="head"){v=f.ownerDocument.head,Sg(v);for(var B=v.firstChild;B;){var K=B.nextSibling,pe=B.nodeName;B[Ar]||pe==="SCRIPT"||pe==="STYLE"||pe==="LINK"&&B.rel.toLowerCase()==="stylesheet"||v.removeChild(B),B=K}}else v==="body"&&Sg(f.ownerDocument.body);v=k}while(v);lp(p)}function nn(f,p){var v=f;f=0;do{var P=v.nextSibling;if(v.nodeType===1?p?(v._stashedDisplay=v.style.display,v.style.display="none"):(v.style.display=v._stashedDisplay||"",v.getAttribute("style")===""&&v.removeAttribute("style")):v.nodeType===3&&(p?(v._stashedText=v.nodeValue,v.nodeValue=""):v.nodeValue=v._stashedText||""),P&&P.nodeType===8)if(v=P.data,v==="/$"){if(f===0)break;f--}else v!=="$"&&v!=="$?"&&v!=="$~"&&v!=="$!"||f++;v=P}while(v)}function ac(f){var p=f.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var v=p;switch(p=p.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":ac(v),Pc(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}f.removeChild(v)}}function Yi(f,p,v,P){for(;f.nodeType===1;){var k=v;if(f.nodeName.toLowerCase()!==p.toLowerCase()){if(!P&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(P){if(!f[Ar])switch(p){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(B=f.getAttribute("rel"),B==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(B!==k.rel||f.getAttribute("href")!==(k.href==null||k.href===""?null:k.href)||f.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||f.getAttribute("title")!==(k.title==null?null:k.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(B=f.getAttribute("src"),(B!==(k.src==null?null:k.src)||f.getAttribute("type")!==(k.type==null?null:k.type)||f.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&B&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(p==="input"&&f.type==="hidden"){var B=k.name==null?null:""+k.name;if(k.type==="hidden"&&f.getAttribute("name")===B)return f}else return f;if(f=uo(f.nextSibling),f===null)break}return null}function yl(f,p,v){if(p==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!v||(f=uo(f.nextSibling),f===null))return null;return f}function mh(f,p){for(;f.nodeType!==8;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!p||(f=uo(f.nextSibling),f===null))return null;return f}function Os(f){return f.data==="$?"||f.data==="$~"}function jn(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState!=="loading"}function ki(f,p){var v=f.ownerDocument;if(f.data==="$~")f._reactRetry=p;else if(f.data!=="$?"||v.readyState!=="loading")p();else{var P=function(){p(),v.removeEventListener("DOMContentLoaded",P)};v.addEventListener("DOMContentLoaded",P),f._reactRetry=P}}function uo(f){for(;f!=null;f=f.nextSibling){var p=f.nodeType;if(p===1||p===3)break;if(p===8){if(p=f.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return f}var ua=null;function Ki(f){f=f.nextSibling;for(var p=0;f;){if(f.nodeType===8){var v=f.data;if(v==="/$"||v==="/&"){if(p===0)return uo(f.nextSibling);p--}else v!=="$"&&v!=="$!"&&v!=="$?"&&v!=="$~"&&v!=="&"||p++}f=f.nextSibling}return null}function N_(f){f=f.previousSibling;for(var p=0;f;){if(f.nodeType===8){var v=f.data;if(v==="$"||v==="$!"||v==="$?"||v==="$~"||v==="&"){if(p===0)return f;p--}else v!=="/$"&&v!=="/&"||p++}f=f.previousSibling}return null}function Sx(f,p,v){switch(p=Tg(v),f){case"html":if(f=p.documentElement,!f)throw Error(n(452));return f;case"head":if(f=p.head,!f)throw Error(n(453));return f;case"body":if(f=p.body,!f)throw Error(n(454));return f;default:throw Error(n(451))}}function Sg(f){for(var p=f.attributes;p.length;)f.removeAttributeNode(p[0]);Pc(f)}var Zr=new Map,ha=new Set;function cu(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var oc=Me.d;Me.d={f:Ax,r:Ex,D:Ds,C:vl,L:B_,m:ks,X:F_,S:_h,M:Hv};function Ax(){var f=oc.f(),p=mg();return f||p}function Ex(f){var p=Qo(f);p!==null&&p.tag===5&&p.type==="form"?Mi(p):oc.r(f)}var zf=typeof document>"u"?null:document;function z_(f,p,v){var P=zf;if(P&&typeof p=="string"&&p){var k=ss(p);k='link[rel="'+f+'"][href="'+k+'"]',typeof v=="string"&&(k+='[crossorigin="'+v+'"]'),ha.has(k)||(ha.add(k),f={rel:f,crossOrigin:v,href:p},P.querySelector(k)===null&&(p=P.createElement("link"),qi(p,"link",f),Hn(p),P.head.appendChild(p)))}}function Ds(f){oc.D(f),z_("dns-prefetch",f,null)}function vl(f,p){oc.C(f,p),z_("preconnect",f,p)}function B_(f,p,v){oc.L(f,p,v);var P=zf;if(P&&f&&p){var k='link[rel="preload"][as="'+ss(p)+'"]';p==="image"&&v&&v.imageSrcSet?(k+='[imagesrcset="'+ss(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(k+='[imagesizes="'+ss(v.imageSizes)+'"]')):k+='[href="'+ss(f)+'"]';var B=k;switch(p){case"style":B=Bf(f);break;case"script":B=Ff(f)}Zr.has(B)||(f=E({rel:"preload",href:p==="image"&&v&&v.imageSrcSet?void 0:f,as:p},v),Zr.set(B,f),P.querySelector(k)!==null||p==="style"&&P.querySelector(sp(B))||p==="script"&&P.querySelector(ap(B))||(p=P.createElement("link"),qi(p,"link",f),Hn(p),P.head.appendChild(p)))}}function ks(f,p){oc.m(f,p);var v=zf;if(v&&f){var P=p&&typeof p.as=="string"?p.as:"script",k='link[rel="modulepreload"][as="'+ss(P)+'"][href="'+ss(f)+'"]',B=k;switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=Ff(f)}if(!Zr.has(B)&&(f=E({rel:"modulepreload",href:f},p),Zr.set(B,f),v.querySelector(k)===null)){switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(ap(B)))return}P=v.createElement("link"),qi(P,"link",f),Hn(P),v.head.appendChild(P)}}}function _h(f,p,v){oc.S(f,p,v);var P=zf;if(P&&f){var k=wo(P).hoistableStyles,B=Bf(f);p=p||"default";var K=k.get(B);if(!K){var pe={loading:0,preload:null};if(K=P.querySelector(sp(B)))pe.loading=5;else{f=E({rel:"stylesheet",href:f,"data-precedence":p},v),(v=Zr.get(B))&&U_(f,v);var je=K=P.createElement("link");Hn(je),qi(je,"link",f),je._p=new Promise(function(ft,At){je.onload=ft,je.onerror=At}),je.addEventListener("load",function(){pe.loading|=1}),je.addEventListener("error",function(){pe.loading|=2}),pe.loading|=4,op(K,p,P)}K={type:"stylesheet",instance:K,count:1,state:pe},k.set(B,K)}}}function F_(f,p){oc.X(f,p);var v=zf;if(v&&f){var P=wo(v).hoistableScripts,k=Ff(f),B=P.get(k);B||(B=v.querySelector(ap(k)),B||(f=E({src:f,async:!0},p),(p=Zr.get(k))&&Gv(f,p),B=v.createElement("script"),Hn(B),qi(B,"link",f),v.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},P.set(k,B))}}function Hv(f,p){oc.M(f,p);var v=zf;if(v&&f){var P=wo(v).hoistableScripts,k=Ff(f),B=P.get(k);B||(B=v.querySelector(ap(k)),B||(f=E({src:f,async:!0,type:"module"},p),(p=Zr.get(k))&&Gv(f,p),B=v.createElement("script"),Hn(B),qi(B,"link",f),v.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},P.set(k,B))}}function qv(f,p,v,P){var k=(k=Xt.current)?cu(k):null;if(!k)throw Error(n(446));switch(f){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(p=Bf(v.href),v=wo(k).hoistableStyles,P=v.get(p),P||(P={type:"style",instance:null,count:0,state:null},v.set(p,P)),P):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){f=Bf(v.href);var B=wo(k).hoistableStyles,K=B.get(f);if(K||(k=k.ownerDocument||k,K={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(f,K),(B=k.querySelector(sp(f)))&&!B._p&&(K.instance=B,K.state.loading=5),Zr.has(f)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},Zr.set(f,v),B||j_(k,f,v,K.state))),p&&P===null)throw Error(n(528,""));return K}if(p&&P!==null)throw Error(n(529,""));return null;case"script":return p=v.async,v=v.src,typeof v=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=Ff(v),v=wo(k).hoistableScripts,P=v.get(p),P||(P={type:"script",instance:null,count:0,state:null},v.set(p,P)),P):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,f))}}function Bf(f){return'href="'+ss(f)+'"'}function sp(f){return'link[rel="stylesheet"]['+f+"]"}function Xv(f){return E({},f,{"data-precedence":f.precedence,precedence:null})}function j_(f,p,v,P){f.querySelector('link[rel="preload"][as="style"]['+p+"]")?P.loading=1:(p=f.createElement("link"),P.preload=p,p.addEventListener("load",function(){return P.loading|=1}),p.addEventListener("error",function(){return P.loading|=2}),qi(p,"link",v),Hn(p),f.head.appendChild(p))}function Ff(f){return'[src="'+ss(f)+'"]'}function ap(f){return"script[async]"+f}function jf(f,p,v){if(p.count++,p.instance===null)switch(p.type){case"style":var P=f.querySelector('style[data-href~="'+ss(v.href)+'"]');if(P)return p.instance=P,Hn(P),P;var k=E({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return P=(f.ownerDocument||f).createElement("style"),Hn(P),qi(P,"style",k),op(P,v.precedence,f),p.instance=P;case"stylesheet":k=Bf(v.href);var B=f.querySelector(sp(k));if(B)return p.state.loading|=4,p.instance=B,Hn(B),B;P=Xv(v),(k=Zr.get(k))&&U_(P,k),B=(f.ownerDocument||f).createElement("link"),Hn(B);var K=B;return K._p=new Promise(function(pe,je){K.onload=pe,K.onerror=je}),qi(B,"link",P),p.state.loading|=4,op(B,v.precedence,f),p.instance=B;case"script":return B=Ff(v.src),(k=f.querySelector(ap(B)))?(p.instance=k,Hn(k),k):(P=v,(k=Zr.get(B))&&(P=E({},v),Gv(P,k)),f=f.ownerDocument||f,k=f.createElement("script"),Hn(k),qi(k,"link",P),f.head.appendChild(k),p.instance=k);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(P=p.instance,p.state.loading|=4,op(P,v.precedence,f));return p.instance}function op(f,p,v){for(var P=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=P.length?P[P.length-1]:null,B=k,K=0;K<P.length;K++){var pe=P[K];if(pe.dataset.precedence===p)B=pe;else if(B!==k)break}B?B.parentNode.insertBefore(f,B.nextSibling):(p=v.nodeType===9?v.head:v,p.insertBefore(f,p.firstChild))}function U_(f,p){f.crossOrigin==null&&(f.crossOrigin=p.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=p.referrerPolicy),f.title==null&&(f.title=p.title)}function Gv(f,p){f.crossOrigin==null&&(f.crossOrigin=p.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=p.referrerPolicy),f.integrity==null&&(f.integrity=p.integrity)}var Ag=null;function Eg(f,p,v){if(Ag===null){var P=new Map,k=Ag=new Map;k.set(v,P)}else k=Ag,P=k.get(v),P||(P=new Map,k.set(v,P));if(P.has(f))return P;for(P.set(f,null),v=v.getElementsByTagName(f),k=0;k<v.length;k++){var B=v[k];if(!(B[Ar]||B[en]||f==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var K=B.getAttribute(p)||"";K=f+K;var pe=P.get(K);pe?pe.push(B):P.set(K,[B])}}return P}function Pg(f,p,v){f=f.ownerDocument||f,f.head.insertBefore(v,p==="title"?f.querySelector("head > title"):null)}function V_(f,p,v){if(v===1||p.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;return p.rel==="stylesheet"?(f=p.disabled,typeof p.precedence=="string"&&f==null):!0;case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function $_(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}function Zv(f,p,v,P){if(v.type==="stylesheet"&&(typeof P.media!="string"||matchMedia(P.media).matches!==!1)&&(v.state.loading&4)===0){if(v.instance===null){var k=Bf(P.href),B=p.querySelector(sp(k));if(B){p=B._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(f.count++,f=Mg.bind(f),p.then(f,f)),v.state.loading|=4,v.instance=B,Hn(B);return}B=p.ownerDocument||p,P=Xv(P),(k=Zr.get(k))&&U_(P,k),B=B.createElement("link"),Hn(B);var K=B;K._p=new Promise(function(pe,je){K.onload=pe,K.onerror=je}),qi(B,"link",P),v.instance=B}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(v,p),(p=v.state.preload)&&(v.state.loading&3)===0&&(f.count++,v=Mg.bind(f),p.addEventListener("load",v),p.addEventListener("error",v))}}var Cg=0;function Px(f,p){return f.stylesheets&&f.count===0&&Rg(f,f.stylesheets),0<f.count||0<f.imgCount?function(v){var P=setTimeout(function(){if(f.stylesheets&&Rg(f,f.stylesheets),f.unsuspend){var B=f.unsuspend;f.unsuspend=null,B()}},6e4+p);0<f.imgBytes&&Cg===0&&(Cg=62500*ip());var k=setTimeout(function(){if(f.waitingForImages=!1,f.count===0&&(f.stylesheets&&Rg(f,f.stylesheets),f.unsuspend)){var B=f.unsuspend;f.unsuspend=null,B()}},(f.imgBytes>Cg?50:800)+p);return f.unsuspend=v,function(){f.unsuspend=null,clearTimeout(P),clearTimeout(k)}}:null}function Mg(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rg(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var Ig=null;function Rg(f,p){f.stylesheets=null,f.unsuspend!==null&&(f.count++,Ig=new Map,p.forEach(Cx,f),Ig=null,Mg.call(f))}function Cx(f,p){if(!(p.state.loading&4)){var v=Ig.get(f);if(v)var P=v.get(null);else{v=new Map,Ig.set(f,v);for(var k=f.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<k.length;B++){var K=k[B];(K.nodeName==="LINK"||K.getAttribute("media")!=="not all")&&(v.set(K.dataset.precedence,K),P=K)}P&&v.set(null,P)}k=p.instance,K=k.getAttribute("data-precedence"),B=v.get(K)||P,B===P&&v.set(null,k),v.set(K,k),this.count++,P=Mg.bind(this),k.addEventListener("load",P),k.addEventListener("error",P),B?B.parentNode.insertBefore(k,B.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(k,f.firstChild)),p.state.loading|=4}}var Og={$$typeof:re,Provider:null,Consumer:null,_currentValue:Ee,_currentValue2:Ee,_threadCount:0};function Mx(f,p,v,P,k,B,K,pe,je){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=dr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dr(0),this.hiddenUpdates=dr(null),this.identifierPrefix=P,this.onUncaughtError=k,this.onCaughtError=B,this.onRecoverableError=K,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=je,this.incompleteTransitions=new Map}function Ix(f,p,v,P,k,B,K,pe,je,ft,At,Dt){return f=new Mx(f,p,v,K,je,ft,At,Dt,pe),p=1,B===!0&&(p|=24),B=Js(3,null,null,p),f.current=B,B.stateNode=f,p=Lo(),p.refCount++,f.pooledCache=p,p.refCount++,B.memoizedState={element:P,isDehydrated:v,cache:p},Fd(B),f}function Rx(f){return f?(f=Pr,f):Pr}function W_(f,p,v,P,k,B){k=Rx(k),P.context===null?P.context=k:P.pendingContext=k,P=jo(p),P.payload={element:v},B=B===void 0?null:B,B!==null&&(P.callback=B),v=ll(f,P,p),v!==null&&(ja(v,f,p),Ra(v,f,p))}function Yv(f,p){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var v=f.retryLane;f.retryLane=v!==0&&v<p?v:p}}function Kv(f,p){Yv(f,p),(f=f.alternate)&&Yv(f,p)}function Ox(f){if(f.tag===13||f.tag===31){var p=Ca(f,67108864);p!==null&&ja(p,f,67108864),Kv(f,67108864)}}function Qv(f){if(f.tag===13||f.tag===31){var p=Fa();p=Pn(p);var v=Ca(f,p);v!==null&&ja(v,f,p),Kv(f,p)}}var yh=!0;function w2(f,p,v,P){var k=fe.T;fe.T=null;var B=Me.p;try{Me.p=2,Dg(f,p,v,P)}finally{Me.p=B,fe.T=k}}function Jv(f,p,v,P){var k=fe.T;fe.T=null;var B=Me.p;try{Me.p=8,Dg(f,p,v,P)}finally{Me.p=B,fe.T=k}}function Dg(f,p,v,P){if(yh){var k=H_(P);if(k===null)sc(f,p,P,uu,v),Lx(f,P);else if(T2(k,f,p,v,P))P.stopPropagation();else if(Lx(f,P),p&4&&-1<kx.indexOf(f)){for(;k!==null;){var B=Qo(k);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var K=Le(B.pendingLanes);if(K!==0){var pe=B;for(pe.pendingLanes|=2,pe.entangledLanes|=2;K;){var je=1<<31-Ne(K);pe.entanglements[1]|=je,K&=~je}_l(B),(pn&6)===0&&(pg=vi()+500,co(0))}}break;case 31:case 13:pe=Ca(B,2),pe!==null&&ja(pe,B,2),mg(),Kv(B,2)}if(B=H_(P),B===null&&sc(f,p,P,uu,v),B===k)break;k=B}k!==null&&P.stopPropagation()}else sc(f,p,P,null,v)}}function H_(f){return f=Xh(f),q_(f)}var uu=null;function q_(f){if(uu=null,f=bo(f),f!==null){var p=l(f);if(p===null)f=null;else{var v=p.tag;if(v===13){if(f=c(p),f!==null)return f;f=null}else if(v===31){if(f=s(p),f!==null)return f;f=null}else if(v===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;f=null}else p!==f&&(f=null)}}return uu=f,null}function Dx(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Xs()){case ku:return 2;case Yo:return 8;case Ko:case Vh:return 32;case Ol:return 268435456;default:return 32}default:return 32}}var Uf=!1,hu=null,fu=null,du=null,kg=new Map,Lg=new Map,lc=[],kx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Lx(f,p){switch(f){case"focusin":case"focusout":hu=null;break;case"dragenter":case"dragleave":fu=null;break;case"mouseover":case"mouseout":du=null;break;case"pointerover":case"pointerout":kg.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lg.delete(p.pointerId)}}function Ng(f,p,v,P,k,B){return f===null||f.nativeEvent!==B?(f={blockedOn:p,domEventName:v,eventSystemFlags:P,nativeEvent:B,targetContainers:[k]},p!==null&&(p=Qo(p),p!==null&&Ox(p)),f):(f.eventSystemFlags|=P,p=f.targetContainers,k!==null&&p.indexOf(k)===-1&&p.push(k),f)}function T2(f,p,v,P,k){switch(p){case"focusin":return hu=Ng(hu,f,p,v,P,k),!0;case"dragenter":return fu=Ng(fu,f,p,v,P,k),!0;case"mouseover":return du=Ng(du,f,p,v,P,k),!0;case"pointerover":var B=k.pointerId;return kg.set(B,Ng(kg.get(B)||null,f,p,v,P,k)),!0;case"gotpointercapture":return B=k.pointerId,Lg.set(B,Ng(Lg.get(B)||null,f,p,v,P,k)),!0}return!1}function Nx(f){var p=bo(f.target);if(p!==null){var v=l(p);if(v!==null){if(p=v.tag,p===13){if(p=c(v),p!==null){f.blockedOn=p,vn(f.priority,function(){Qv(v)});return}}else if(p===31){if(p=s(v),p!==null){f.blockedOn=p,vn(f.priority,function(){Qv(v)});return}}else if(p===3&&v.stateNode.current.memoizedState.isDehydrated){f.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}f.blockedOn=null}function X_(f){if(f.blockedOn!==null)return!1;for(var p=f.targetContainers;0<p.length;){var v=H_(f.nativeEvent);if(v===null){v=f.nativeEvent;var P=new v.constructor(v.type,v);kp=P,v.target.dispatchEvent(P),kp=null}else return p=Qo(v),p!==null&&Ox(p),f.blockedOn=v,!1;p.shift()}return!0}function e0(f,p,v){X_(f)&&v.delete(p)}function S2(){Uf=!1,hu!==null&&X_(hu)&&(hu=null),fu!==null&&X_(fu)&&(fu=null),du!==null&&X_(du)&&(du=null),kg.forEach(e0),Lg.forEach(e0)}function vh(f,p){f.blockedOn===p&&(f.blockedOn=null,Uf||(Uf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,S2)))}var G_=null;function zx(f){G_!==f&&(G_=f,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){G_===f&&(G_=null);for(var p=0;p<f.length;p+=3){var v=f[p],P=f[p+1],k=f[p+2];if(typeof P!="function"){if(q_(P||v)===null)continue;break}var B=Qo(v);B!==null&&(f.splice(p,3),p-=3,Zn(B,{pending:!0,data:k,method:v.method,action:P},P,k))}}))}function lp(f){function p(je){return vh(je,f)}hu!==null&&vh(hu,f),fu!==null&&vh(fu,f),du!==null&&vh(du,f),kg.forEach(p),Lg.forEach(p);for(var v=0;v<lc.length;v++){var P=lc[v];P.blockedOn===f&&(P.blockedOn=null)}for(;0<lc.length&&(v=lc[0],v.blockedOn===null);)Nx(v),v.blockedOn===null&&lc.shift();if(v=(f.ownerDocument||f).$$reactFormReplay,v!=null)for(P=0;P<v.length;P+=3){var k=v[P],B=v[P+1],K=k[Nt]||null;if(typeof B=="function")K||zx(v);else if(K){var pe=null;if(B&&B.hasAttribute("formAction")){if(k=B,K=B[Nt]||null)pe=K.formAction;else if(q_(k)!==null)continue}else pe=K.action;typeof pe=="function"?v[P+1]=pe:(v.splice(P,3),P-=3),zx(v)}}}function Z_(){function f(B){B.canIntercept&&B.info==="react-transition"&&B.intercept({handler:function(){return new Promise(function(K){return k=K})},focusReset:"manual",scroll:"manual"})}function p(){k!==null&&(k(),k=null),P||setTimeout(v,20)}function v(){if(!P&&!navigation.transition){var B=navigation.currentEntry;B&&B.url!=null&&navigation.navigate(B.url,{state:B.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var P=!1,k=null;return navigation.addEventListener("navigate",f),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(v,100),function(){P=!0,navigation.removeEventListener("navigate",f),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),k!==null&&(k(),k=null)}}}function Y_(f){this._internalRoot=f}K_.prototype.render=Y_.prototype.render=function(f){var p=this._internalRoot;if(p===null)throw Error(n(409));var v=p.current,P=Fa();W_(v,P,f,p,null,null)},K_.prototype.unmount=Y_.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var p=f.containerInfo;W_(f.current,2,null,f,null,null),mg(),p[hr]=null}};function K_(f){this._internalRoot=f}K_.prototype.unstable_scheduleHydration=function(f){if(f){var p=Hr();f={blockedOn:null,target:f,priority:p};for(var v=0;v<lc.length&&p!==0&&p<lc[v].priority;v++);lc.splice(v,0,f),v===0&&Nx(f)}};var Bx=e.version;if(Bx!=="19.2.4")throw Error(n(527,Bx,"19.2.4"));Me.findDOMNode=function(f){var p=f._reactInternals;if(p===void 0)throw typeof f.render=="function"?Error(n(188)):(f=Object.keys(f).join(","),Error(n(268,f)));return f=b(p),f=f!==null?w(f):null,f=f===null?null:f.stateNode,f};var Fx={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:fe,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zg.isDisabled&&zg.supportsFiber)try{ie=zg.inject(Fx),oe=zg}catch{}}return s0.createRoot=function(f,p){if(!i(f))throw Error(n(299));var v=!1,P="",k=$d,B=dl,K=pl;return p!=null&&(p.unstable_strictMode===!0&&(v=!0),p.identifierPrefix!==void 0&&(P=p.identifierPrefix),p.onUncaughtError!==void 0&&(k=p.onUncaughtError),p.onCaughtError!==void 0&&(B=p.onCaughtError),p.onRecoverableError!==void 0&&(K=p.onRecoverableError)),p=Ix(f,1,!1,null,null,v,P,null,k,B,K,Z_),f[hr]=p.current,Nv(f),new Y_(p)},s0.hydrateRoot=function(f,p,v){if(!i(f))throw Error(n(299));var P=!1,k="",B=$d,K=dl,pe=pl,je=null;return v!=null&&(v.unstable_strictMode===!0&&(P=!0),v.identifierPrefix!==void 0&&(k=v.identifierPrefix),v.onUncaughtError!==void 0&&(B=v.onUncaughtError),v.onCaughtError!==void 0&&(K=v.onCaughtError),v.onRecoverableError!==void 0&&(pe=v.onRecoverableError),v.formState!==void 0&&(je=v.formState)),p=Ix(f,1,!0,p,v??null,P,k,je,B,K,pe,Z_),p.context=Rx(null),v=p.current,P=Fa(),P=Pn(P),k=jo(P),k.callback=null,ll(v,k,P),v=P,p.current.lanes=v,vr(p,v),_l(p),f[hr]=p.current,Nv(f),new K_(p)},s0.version="19.2.4",s0}var eI;function L8(){if(eI)return z2.exports;eI=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),z2.exports=k8(),z2.exports}var N8=L8(),E1={exports:{}};var z8=E1.exports,tI;function B8(){return tI||(tI=1,(function(t,e){(function(r,n){t.exports=n()})(z8,(function(){var r={},n={};function i(c,s,m){if(n[c]=m,c==="index"){var b="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",w={};return n.shared(w),n.index(r,w),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),r}}i("shared",["exports"],(function(c){function s(h,a,u,g){return new(u||(u=Promise))((function(y,T){function S(L){try{R(g.next(L))}catch(F){T(F)}}function M(L){try{R(g.throw(L))}catch(F){T(F)}}function R(L){var F;L.done?y(L.value):(F=L.value,F instanceof u?F:new u((function(U){U(F)}))).then(S,M)}R((g=g.apply(h,a||[])).next())}))}function m(h,a){this.x=h,this.y=a}function b(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var w,E;typeof SuppressedError=="function"&&SuppressedError,m.prototype={clone(){return new m(this.x,this.y)},add(h){return this.clone()._add(h)},sub(h){return this.clone()._sub(h)},multByPoint(h){return this.clone()._multByPoint(h)},divByPoint(h){return this.clone()._divByPoint(h)},mult(h){return this.clone()._mult(h)},div(h){return this.clone()._div(h)},rotate(h){return this.clone()._rotate(h)},rotateAround(h,a){return this.clone()._rotateAround(h,a)},matMult(h){return this.clone()._matMult(h)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(h){return this.x===h.x&&this.y===h.y},dist(h){return Math.sqrt(this.distSqr(h))},distSqr(h){const a=h.x-this.x,u=h.y-this.y;return a*a+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith(h){return this.angleWithSep(h.x,h.y)},angleWithSep(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult(h){const a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add(h){return this.x+=h.x,this.y+=h.y,this},_sub(h){return this.x-=h.x,this.y-=h.y,this},_mult(h){return this.x*=h,this.y*=h,this},_div(h){return this.x/=h,this.y/=h,this},_multByPoint(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint(h){return this.x/=h.x,this.y/=h.y,this},_unit(){return this._div(this.mag()),this},_perp(){const h=this.y;return this.y=this.x,this.x=-h,this},_rotate(h){const a=Math.cos(h),u=Math.sin(h),g=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=g,this},_rotateAround(h,a){const u=Math.cos(h),g=Math.sin(h),y=a.y+g*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-g*(this.y-a.y),this.y=y,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:m},m.convert=function(h){if(h instanceof m)return h;if(Array.isArray(h))return new m(+h[0],+h[1]);if(h.x!==void 0&&h.y!==void 0)return new m(+h.x,+h.y);throw new Error("Expected [x, y] or {x, y} point format")};var O=(function(){if(E)return w;function h(a,u,g,y){this.cx=3*a,this.bx=3*(g-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=g,this.p2y=y}return E=1,w=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var g=a,y=0;y<8;y++){var T=this.sampleCurveX(g)-a;if(Math.abs(T)<u)return g;var S=this.sampleCurveDerivativeX(g);if(Math.abs(S)<1e-6)break;g-=T/S}var M=0,R=1;for(g=a,y=0;y<20&&(T=this.sampleCurveX(g),!(Math.abs(T-a)<u));y++)a>T?M=g:R=g,g=.5*(R-M)+M;return g},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},w})(),N=b(O);let V,W;function j(){return V==null&&(V=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),V}function Y(){if(W==null&&(W=!1,j())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let g=0;g<25;g++){const y=4*g;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(g%5,Math.floor(g/5),1,1)}const u=a.getImageData(0,0,5,5).data;for(let g=0;g<100;g++)if(g%4!=3&&u[g]!==g){W=!0;break}}}return W||!1}var ce=1e-6,re=typeof Float32Array<"u"?Float32Array:Array;function ue(){var h=new re(9);return re!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function me(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function ge(){var h=new re(3);return re!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function Ce(h){var a=h[0],u=h[1],g=h[2];return Math.sqrt(a*a+u*u+g*g)}function We(h,a,u){var g=new re(3);return g[0]=h,g[1]=a,g[2]=u,g}function Xe(h,a,u){return h[0]=a[0]+u[0],h[1]=a[1]+u[1],h[2]=a[2]+u[2],h}function Et(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h}function gt(h,a,u){var g=a[0],y=a[1],T=a[2],S=u[0],M=u[1],R=u[2];return h[0]=y*R-T*M,h[1]=T*S-g*R,h[2]=g*M-y*S,h}var Ye,jt=Ce;function St(h,a,u){var g=a[0],y=a[1],T=a[2],S=a[3];return h[0]=u[0]*g+u[4]*y+u[8]*T+u[12]*S,h[1]=u[1]*g+u[5]*y+u[9]*T+u[13]*S,h[2]=u[2]*g+u[6]*y+u[10]*T+u[14]*S,h[3]=u[3]*g+u[7]*y+u[11]*T+u[15]*S,h}function Zt(){var h=new re(4);return re!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function fe(h,a,u,g){var y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",T=Math.PI/360;a*=T,g*=T,u*=T;var S=Math.sin(a),M=Math.cos(a),R=Math.sin(u),L=Math.cos(u),F=Math.sin(g),U=Math.cos(g);switch(y){case"xyz":h[0]=S*L*U+M*R*F,h[1]=M*R*U-S*L*F,h[2]=M*L*F+S*R*U,h[3]=M*L*U-S*R*F;break;case"xzy":h[0]=S*L*U-M*R*F,h[1]=M*R*U-S*L*F,h[2]=M*L*F+S*R*U,h[3]=M*L*U+S*R*F;break;case"yxz":h[0]=S*L*U+M*R*F,h[1]=M*R*U-S*L*F,h[2]=M*L*F-S*R*U,h[3]=M*L*U+S*R*F;break;case"yzx":h[0]=S*L*U+M*R*F,h[1]=M*R*U+S*L*F,h[2]=M*L*F-S*R*U,h[3]=M*L*U-S*R*F;break;case"zxy":h[0]=S*L*U-M*R*F,h[1]=M*R*U+S*L*F,h[2]=M*L*F+S*R*U,h[3]=M*L*U-S*R*F;break;case"zyx":h[0]=S*L*U-M*R*F,h[1]=M*R*U+S*L*F,h[2]=M*L*F-S*R*U,h[3]=M*L*U+S*R*F;break;default:throw new Error("Unknown angle order "+y)}return h}function Me(){var h=new re(2);return re!=Float32Array&&(h[0]=0,h[1]=0),h}function Ee(h,a){var u=new re(2);return u[0]=h,u[1]=a,u}ge(),Ye=new re(4),re!=Float32Array&&(Ye[0]=0,Ye[1]=0,Ye[2]=0,Ye[3]=0),ge(),We(1,0,0),We(0,1,0),Zt(),Zt(),ue(),Me();const Ue=8192;function st(h,a,u){return a*(Ue/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function ye(h,a){return(h%a+a)%a}function Be(h,a,u){return h*(1-u)+a*u}function lt(h){if(h<=0)return 0;if(h>=1)return 1;const a=h*h,u=a*h;return 4*(h<.5?u:3*(h-a)+u-.75)}function Tt(h,a,u,g){const y=new N(h,a,u,g);return T=>y.solve(T)}const zt=Tt(.25,.1,.25,1);function Xt(h,a,u){return Math.min(u,Math.max(a,h))}function Wt(h,a,u){const g=u-a,y=((h-a)%g+g)%g+a;return y===a?u:y}function nr(h,...a){for(const u of a)for(const g in u)h[g]=u[g];return h}let _t=1;function Yt(h,a,u){const g={};for(const y in h)g[y]=a.call(this,h[y],y,h);return g}function Tr(h,a,u){const g={};for(const y in h)a.call(this,h[y],y,h)&&(g[y]=h[y]);return g}function Rt(h){return Array.isArray(h)?h.map(Rt):typeof h=="object"&&h?Yt(h,Rt):h}const $n={};function _r(h){$n[h]||(typeof console<"u"&&console.warn(h),$n[h]=!0)}function sr(h,a,u){return(u.y-h.y)*(a.x-h.x)>(a.y-h.y)*(u.x-h.x)}function ur(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Yr=null;function qs(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Rl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zo(h,a,u,g,y){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(h,{timestamp:0});try{const S=T?.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const M=S.startsWith("BGR"),R=new Uint8ClampedArray(g*y*4);if(yield T.copyTo(R,(function(L,F,U,q,X){const Q=4*Math.max(-F,0),te=(Math.max(0,U)-U)*q*4+Q,ae=4*q,de=Math.max(0,F),Te=Math.max(0,U);return{rect:{x:de,y:Te,width:Math.min(L.width,F+q)-de,height:Math.min(L.height,U+X)-Te},layout:[{offset:te,stride:ae}]}})(h,a,u,g,y)),M)for(let L=0;L<R.length;L+=4){const F=R[L];R[L]=R[L+2],R[L+2]=F}return R}finally{T.close()}}))}let yo,Za;function Du(h,a,u,g){return h.addEventListener(a,u,g),{unsubscribe:()=>{h.removeEventListener(a,u,g)}}}function vi(h){return h*Math.PI/180}function Xs(h){return h/Math.PI*180}const ku={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Yo={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ko="AbortError";class Vh extends Error{constructor(a=Ko){super(a instanceof Error?a.message:a),this.name=Ko,a instanceof Error&&a.stack&&(this.stack=a.stack)}}function Ol(h){return h.name===Ko}const He={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function J(h){return He.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const ie="global-dispatcher";class oe extends Error{constructor(a,u,g,y){super(`AJAXError: ${u} (${a}): ${g}`),this.status=a,this.statusText=u,this.url=g,this.body=y}}const Pe=()=>ur(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ne=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const g=J(h.url);if(g)return g(h,a);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:ie},a)}if(!(/^file:/.test(u=h.url)||/^file:/.test(Pe())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(g,y){return s(this,void 0,void 0,(function*(){const T=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Pe(),signal:y.signal});let S,M;g.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{S=yield fetch(T)}catch(L){throw Ol(L)?L:new oe(0,L.message,g.url,new Blob)}if(!S.ok){const L=yield S.blob();throw new oe(S.status,S.statusText,g.url,L)}M=g.type==="arrayBuffer"||g.type==="image"?S.arrayBuffer():g.type==="json"?S.json():S.text();const R=yield M;return y.signal.throwIfAborted(),{data:R,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}}))})(h,a);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:ie},a)}var u;return(function(g,y){return new Promise(((T,S)=>{var M;const R=new XMLHttpRequest;R.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(R.responseType="arraybuffer");for(const L in g.headers)R.setRequestHeader(L,g.headers[L]);g.type==="json"&&(R.responseType="text",!((M=g.headers)===null||M===void 0)&&M.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=g.credentials==="include",R.onerror=()=>{S(new Error(R.statusText))},R.onload=()=>{if(!y.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let L=R.response;if(g.type==="json")try{L=JSON.parse(R.response)}catch(F){return void S(F)}T({data:L,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const L=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});S(new oe(R.status,R.statusText,g.url,L))}},y.signal.addEventListener("abort",(()=>{R.abort(),S(new Vh(y.signal.reason))})),R.send(g.body)}))})(h,a)};function tt(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function Je(h,a,u){u[h]&&u[h].indexOf(a)!==-1||(u[h]=u[h]||[],u[h].push(a))}function qe(h,a,u){if(u&&u[h]){const g=u[h].indexOf(a);g!==-1&&u[h].splice(g,1)}}class et{constructor(a,u={}){nr(this,u),this.type=a}}class Ct extends et{constructor(a,u={}){super("error",nr({error:a},u))}}class mt{on(a,u){return this._listeners=this._listeners||{},Je(a,u,this._listeners),{unsubscribe:()=>{this.off(a,u)}}}off(a,u){return qe(a,u,this._listeners),qe(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Je(a,u,this._oneTimeListeners),this):new Promise((g=>this.once(a,g)))}fire(a,u){typeof a=="string"&&(a=new et(a,u||{}));const g=a.type;if(this.listens(g)){a.target=this;const y=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const M of y)M.call(this,a);const T=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const M of T)qe(g,M,this._oneTimeListeners),M.call(this,a);const S=this._eventedParent;S&&(nr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(a))}else a instanceof Ct&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Qt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yr(h,a){const u={};for(const g in h)g!=="ref"&&(u[g]=h[g]);return Qt.forEach((g=>{g in a&&(u[g]=a[g])})),u}function or(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let u=0;u<h.length;u++)if(!or(h[u],a[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const u in h)if(!or(h[u],a[u]))return!1;return!0}return h===a}function fr(h,a){h.push(a)}function dr(h,a,u){fr(u,{command:"addSource",args:[h,a[h]]})}function vr(h,a,u){fr(a,{command:"removeSource",args:[h]}),u[h]=!0}function En(h,a,u,g){vr(h,u,g),dr(h,a,u)}function Wn(h,a,u){let g;for(g in h[u])if(Object.prototype.hasOwnProperty.call(h[u],g)&&g!=="data"&&!or(h[u][g],a[u][g]))return!1;for(g in a[u])if(Object.prototype.hasOwnProperty.call(a[u],g)&&g!=="data"&&!or(h[u][g],a[u][g]))return!1;return!0}function Nn(h,a,u,g,y,T){h=h||{},a=a||{};for(const S in h)Object.prototype.hasOwnProperty.call(h,S)&&(or(h[S],a[S])||u.push({command:T,args:[g,S,a[S],y]}));for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&!Object.prototype.hasOwnProperty.call(h,S)&&(or(h[S],a[S])||u.push({command:T,args:[g,S,a[S],y]}))}function Vi(h){return h.id}function Pn(h,a){return h[a.id]=a,h}class Ot{constructor(a,u,g,y){this.message=(a?`${a}: `:"")+g,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function Hr(h,...a){for(const u of a)for(const g in u)h[g]=u[g];return h}class vn extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class Ts{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[g,y]of u)this.bindings[g]=y}concat(a){return new Ts(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const en={kind:"null"},Nt={kind:"number"},hr={kind:"string"},Sr={kind:"boolean"},Gs={kind:"color"},dd={kind:"projectionDefinition"},vo={kind:"object"},Ar={kind:"value"},Pc={kind:"collator"},bo={kind:"formatted"},Qo={kind:"padding"},xo={kind:"colorArray"},wo={kind:"numberArray"},Hn={kind:"resolvedImage"},Lu={kind:"variableAnchorOffsetCollection"};function Xi(h,a){return{kind:"array",itemType:h,N:a}}function Fr(h){if(h.kind==="array"){const a=Fr(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const Jo=[en,Nt,hr,Sr,Gs,dd,bo,vo,Xi(Ar),Qo,wo,xo,Hn,Lu];function Nu(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Nu(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const u of Jo)if(!Nu(u,a))return null}}return`Expected ${Fr(h)} but found ${Fr(a)} instead.`}function zu(h,a){return a.some((u=>u.kind===h.kind))}function Dl(h,a){return a.some((u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h))}function Ya(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const $h=.96422,To=.82521,Ta=4/29,qr=6/29,Op=3*qr*qr,Rm=qr*qr*qr,Cc=Math.PI/180,Dp=180/Math.PI;function Wh(h){return(h%=360)<0&&(h+=360),h}function Om([h,a,u,g]){let y,T;const S=Hh((.2225045*(h=ss(h))+.7168786*(a=ss(a))+.0606169*(u=ss(u)))/1);h===a&&a===u?y=T=S:(y=Hh((.4360747*h+.3850649*a+.1430804*u)/$h),T=Hh((.0139322*h+.0971045*a+.7141733*u)/To));const M=116*S-16;return[M<0?0:M,500*(y-S),200*(S-T),g]}function ss(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Hh(h){return h>Rm?Math.pow(h,1/3):h/Op+Ta}function pd([h,a,u,g]){let y=(h+16)/116,T=isNaN(a)?y:y+a/500,S=isNaN(u)?y:y-u/200;return y=1*kl(y),T=$h*kl(T),S=To*kl(S),[qh(3.1338561*T-1.6168667*y-.4906146*S),qh(-.9787684*T+1.9161415*y+.033454*S),qh(.0719453*T-.2289914*y+1.4052427*S),g]}function qh(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function kl(h){return h>qr?h*h*h:Op*(h-Ta)}const Dm=Object.hasOwn||function(h,a){return Object.prototype.hasOwnProperty.call(h,a)};function Bu(h,a){return Dm(h,a)?h[a]:void 0}function el(h){return parseInt(h.padEnd(2,h),16)/255}function km(h,a){return Mc(a?h/100:h,0,1)}function Mc(h,a,u){return Math.min(Math.max(a,h),u)}function gd(h){return!h.some(Number.isNaN)}const Ic={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ll(h,a,u){return h+u*(a-h)}function Fu(h,a,u){return h.map(((g,y)=>Ll(g,a[y],u)))}class Cr{constructor(a,u,g,y=1,T=!0){this.r=a,this.g=u,this.b=g,this.a=y,T||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,g,y]))}static parse(a){if(a instanceof Cr)return a;if(typeof a!="string")return;const u=(function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Bu(Ic,g);if(y){const[S,M,R]=y;return[S/255,M/255,R/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const S=g.length<6?1:2;let M=1;return[el(g.slice(M,M+=S)),el(g.slice(M,M+=S)),el(g.slice(M,M+=S)),el(g.slice(M,M+S)||"ff")]}if(g.startsWith("rgb")){const S=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[M,R,L,F,U,q,X,Q,te,ae,de,Te]=S,he=[F||" ",X||" ",ae].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const ve=[L,q,te].join(""),Oe=ve==="%%%"?100:ve===""?255:0;if(Oe){const Fe=[Mc(+R/Oe,0,1),Mc(+U/Oe,0,1),Mc(+Q/Oe,0,1),de?km(+de,Te):1];if(gd(Fe))return Fe}}return}}const T=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[S,M,R,L,F,U,q,X,Q]=T,te=[R||" ",F||" ",q].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const ae=[+M,Mc(+L,0,100),Mc(+U,0,100),X?km(+X,Q):1];if(gd(ae))return(function([de,Te,he,ve]){function Oe(Fe){const it=(Fe+de/30)%12,vt=Te*Math.min(he,1-he);return he-vt*Math.max(-1,Math.min(it-3,9-it,1))}return de=Wh(de),Te/=100,he/=100,[Oe(0),Oe(8),Oe(4),ve]})(ae)}}})(a);return u?new Cr(...u,!1):void 0}get rgb(){const{r:a,g:u,b:g,a:y}=this,T=y||1/0;return this.overwriteGetter("rgb",[a/T,u/T,g/T,y])}get hcl(){return this.overwriteGetter("hcl",(function(a){const[u,g,y,T]=Om(a),S=Math.sqrt(g*g+y*y);return[Math.round(1e4*S)?Wh(Math.atan2(y,g)*Dp):NaN,S,u,T]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Om(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,g,y]=this.rgb;return`rgba(${[a,u,g].map((T=>Math.round(255*T))).join(",")},${y})`}static interpolate(a,u,g,y="rgb"){switch(y){case"rgb":{const[T,S,M,R]=Fu(a.rgb,u.rgb,g);return new Cr(T,S,M,R,!1)}case"hcl":{const[T,S,M,R]=a.hcl,[L,F,U,q]=u.hcl;let X,Q;if(isNaN(T)||isNaN(L))isNaN(T)?isNaN(L)?X=NaN:(X=L,M!==1&&M!==0||(Q=F)):(X=T,U!==1&&U!==0||(Q=S));else{let he=L-T;L>T&&he>180?he-=360:L<T&&T-L>180&&(he+=360),X=T+g*he}const[te,ae,de,Te]=(function([he,ve,Oe,Fe]){return he=isNaN(he)?0:he*Cc,pd([Oe,Math.cos(he)*ve,Math.sin(he)*ve,Fe])})([X,Q??Ll(S,F,g),Ll(M,U,g),Ll(R,q,g)]);return new Cr(te,ae,de,Te,!1)}case"lab":{const[T,S,M,R]=pd(Fu(a.lab,u.lab,g));return new Cr(T,S,M,R,!1)}}}}Cr.black=new Cr(0,0,0,1),Cr.white=new Cr(1,1,1,1),Cr.transparent=new Cr(0,0,0,0),Cr.red=new Cr(1,0,0,1);class Ka{constructor(a,u,g){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const kp=["bottom","center","top"];class Xh{constructor(a,u,g,y,T,S){this.text=a,this.image=u,this.scale=g,this.fontStack=y,this.textColor=T,this.verticalAlign=S}}class bi{constructor(a){this.sections=a}static fromString(a){return new bi([new Xh(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((a=>a.text.length!==0||a.image&&a.image.name.length!==0))}static factory(a){return a instanceof bi?a:bi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map((a=>a.text)).join("")}}class oi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof oi)return a;if(typeof a=="number")return new oi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new oi(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,g){return new oi(Fu(a.values,u.values,g))}}class Cn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Cn)return a;if(typeof a=="number")return new Cn([a]);if(Array.isArray(a)){for(const u of a)if(typeof u!="number")return;return new Cn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,g){return new Cn(Fu(a.values,u.values,g))}}class pr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof pr)return a;if(typeof a=="string"){const g=Cr.parse(a);return g?new pr([g]):void 0}if(!Array.isArray(a))return;const u=[];for(const g of a){if(typeof g!="string")return;const y=Cr.parse(g);if(!y)return;u.push(y)}return new pr(u)}toString(){return JSON.stringify(this.values)}static interpolate(a,u,g,y="rgb"){const T=[];if(a.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let S=0;S<a.values.length;S++)T.push(Cr.interpolate(a.values[S],u.values[S],g,y));return new pr(T)}}class un extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const Sa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof qn)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const g=a[u],y=a[u+1];if(typeof g!="string"||!Sa.has(g)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new qn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,g){const y=a.values,T=u.values;if(y.length!==T.length)throw new un(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${u.toString()}`);const S=[];for(let M=0;M<y.length;M+=2){if(y[M]!==T[M])throw new un(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${y[M]}, to[${M}]: ${T[M]}`);S.push(y[M]);const[R,L]=y[M+1],[F,U]=T[M+1];S.push([Ll(R,F,g),Ll(L,U,g)])}return new qn(S)}}class as{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new as({name:a,available:!1}):null}}class xi{constructor(a,u,g){this.from=a,this.to=u,this.transition=g}static interpolate(a,u,g){return new xi(a,u,g)}static parse(a){return a instanceof xi?a:Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number"?new xi(a[0],a[1],a[2]):typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number"?new xi(a.from,a.to,a.transition):typeof a=="string"?new xi(a,a,1):void 0}}function Zs(h,a,u,g){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[h,a,u,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[h,a,u,g]:[h,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function So(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof xi||h instanceof Cr||h instanceof Ka||h instanceof bi||h instanceof oi||h instanceof Cn||h instanceof pr||h instanceof qn||h instanceof as)return!0;if(Array.isArray(h)){for(const a of h)if(!So(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!So(h[a]))return!1;return!0}return!1}function Mn(h){if(h===null)return en;if(typeof h=="string")return hr;if(typeof h=="boolean")return Sr;if(typeof h=="number")return Nt;if(h instanceof Cr)return Gs;if(h instanceof xi)return dd;if(h instanceof Ka)return Pc;if(h instanceof bi)return bo;if(h instanceof oi)return Qo;if(h instanceof Cn)return wo;if(h instanceof pr)return xo;if(h instanceof qn)return Lu;if(h instanceof as)return Hn;if(Array.isArray(h)){const a=h.length;let u;for(const g of h){const y=Mn(g);if(u){if(u===y)continue;u=Ar;break}u=y}return Xi(u||Ar,a)}return vo}function Nl(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof Cr||h instanceof xi||h instanceof bi||h instanceof oi||h instanceof Cn||h instanceof pr||h instanceof qn||h instanceof as?h.toString():JSON.stringify(h)}class Ys{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!So(a[1]))return u.error("invalid value");const g=a[1];let y=Mn(g);const T=u.expectedType;return y.kind!=="array"||y.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(y=T),new Ys(y,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Rc={string:hr,number:Nt,boolean:Sr,object:vo};class os{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let g,y=1;const T=a[0];if(T==="array"){let M,R;if(a.length>2){const L=a[1];if(typeof L!="string"||!(L in Rc)||L==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=Rc[L],y++}else M=Ar;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=a[2],y++}g=Xi(M,R)}else{if(!Rc[T])throw new Error(`Types doesn't contain name = ${T}`);g=Rc[T]}const S=[];for(;y<a.length;y++){const M=u.parse(a[y],y,Ar);if(!M)return null;S.push(M)}return new os(g,S)}evaluate(a){for(let u=0;u<this.args.length;u++){const g=this.args[u].evaluate(a);if(!Nu(this.type,Mn(g)))return g;if(u===this.args.length-1)throw new un(`Expected value to be of type ${Fr(this.type)}, but found ${Fr(Mn(g))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const di={"to-boolean":Sr,"to-color":Gs,"to-number":Nt,"to-string":hr};class ls{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const g=a[0];if(!di[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=di[g],T=[];for(let S=1;S<a.length;S++){const M=u.parse(a[S],S,Ar);if(!M)return null;T.push(M)}return new ls(y,T)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,g;for(const y of this.args){if(u=y.evaluate(a),g=null,u instanceof Cr)return u;if(typeof u=="string"){const T=a.parseColor(u);if(T)return T}else if(Array.isArray(u)&&(g=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Zs(u[0],u[1],u[2],u[3]),!g))return new Cr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new un(g||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const g of this.args){u=g.evaluate(a);const y=oi.parse(u);if(y)return y}throw new un(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const g of this.args){u=g.evaluate(a);const y=Cn.parse(u);if(y)return y}throw new un(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const g of this.args){u=g.evaluate(a);const y=pr.parse(u);if(y)return y}throw new un(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const g of this.args){u=g.evaluate(a);const y=qn.parse(u);if(y)return y}throw new un(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const g of this.args){if(u=g.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new un(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return bi.fromString(Nl(this.args[0].evaluate(a)));case"resolvedImage":return as.fromString(Nl(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return Nl(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const Gh=["Unknown","Point","LineString","Polygon"];class Oc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache.get(a);return u||(u=Cr.parse(a),this._parseColorCache.set(a,u)),u}}class Dc{constructor(a,u,g=[],y,T=new Ts,S=[]){this.registry=a,this.path=g,this.key=g.map((M=>`[${M}]`)).join(""),this.scope=T,this.errors=S,this.expectedType=y,this._isConstant=u}parse(a,u,g,y,T={}){return u?this.concat(u,g,y)._parse(a,T):this._parse(a,T)}_parse(a,u){function g(y,T,S){return S==="assert"?new os(T,[y]):S==="coerce"?new ls(T,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[y];if(T){let S=T.parse(a,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,R=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value"){if(M.kind==="projectionDefinition"&&["string","array"].includes(R.kind)||["color","formatted","resolvedImage"].includes(M.kind)&&["value","string"].includes(R.kind)||["padding","numberArray"].includes(M.kind)&&["value","number","array"].includes(R.kind)||M.kind==="colorArray"&&["value","string","array"].includes(R.kind)||M.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(R.kind))S=g(S,M,u.typeAnnotation||"coerce");else if(this.checkSubtype(M,R))return null}else S=g(S,M,u.typeAnnotation||"assert")}if(!(S instanceof Ys)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const M=new Oc;try{S=new Ys(S.type,S.evaluate(M))}catch(R){return this.error(R.message),null}}return S}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,g){const y=typeof a=="number"?this.path.concat(a):this.path,T=g?this.scope.concat(g):this.scope;return new Dc(this.registry,this._isConstant,y,u||null,T,this.errors)}error(a,...u){const g=`${this.key}${u.map((y=>`[${y}]`)).join("")}`;this.errors.push(new vn(g,a))}checkSubtype(a,u){const g=Nu(a,u);return g&&this.error(g),g}}class sn{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const g=[];for(let T=1;T<a.length-1;T+=2){const S=a[T];if(typeof S!="string")return u.error(`Expected string, but found ${typeof S} instead.`,T);if(/[^a-zA-Z0-9_]/.test(S))return u.error("Variable names must contain only alphanumeric characters or '_'.",T);const M=u.parse(a[T+1],T+1);if(!M)return null;g.push([S,M])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,g);return y?new sn(g,y):null}outputDefined(){return this.result.outputDefined()}}class zl{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const g=a[1];return u.scope.has(g)?new zl(g,u.scope.get(g)):u.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class kr{constructor(a,u,g){this.type=a,this.index=u,this.input=g}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const g=u.parse(a[1],1,Nt),y=u.parse(a[2],2,Xi(u.expectedType||Ar));return g&&y?new kr(y.type.itemType,g,y):null}evaluate(a){const u=this.index.evaluate(a),g=this.input.evaluate(a);if(u<0)throw new un(`Array index out of bounds: ${u} < 0.`);if(u>=g.length)throw new un(`Array index out of bounds: ${u} > ${g.length-1}.`);if(u!==Math.floor(u))throw new un(`Array index must be an integer, but found ${u} instead.`);return g[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Er{constructor(a,u){this.type=Sr,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const g=u.parse(a[1],1,Ar),y=u.parse(a[2],2,Ar);return g&&y?zu(g.type,[Sr,hr,Nt,en,Ar])?new Er(g,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(g.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),g=this.haystack.evaluate(a);if(!g)return!1;if(!Dl(u,["boolean","string","number","null"]))throw new un(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Mn(u))} instead.`);if(!Dl(g,["string","array"]))throw new un(`Expected second argument to be of type array or string, but found ${Fr(Mn(g))} instead.`);return g.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class kc{constructor(a,u,g){this.type=Nt,this.needle=a,this.haystack=u,this.fromIndex=g}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const g=u.parse(a[1],1,Ar),y=u.parse(a[2],2,Ar);if(!g||!y)return null;if(!zu(g.type,[Sr,hr,Nt,en,Ar]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(g.type)} instead`);if(a.length===4){const T=u.parse(a[3],3,Nt);return T?new kc(g,y,T):null}return new kc(g,y)}evaluate(a){const u=this.needle.evaluate(a),g=this.haystack.evaluate(a);if(!Dl(u,["boolean","string","number","null"]))throw new un(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Mn(u))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(a)),Dl(g,["string"])){const T=g.indexOf(u,y);return T===-1?-1:[...g.slice(0,T)].length}if(Dl(g,["array"]))return g.indexOf(u,y);throw new un(`Expected second argument to be of type array or string, but found ${Fr(Mn(g))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class jr{constructor(a,u,g,y,T,S){this.inputType=a,this.type=u,this.input=g,this.cases=y,this.outputs=T,this.otherwise=S}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let g,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const T={},S=[];for(let L=2;L<a.length-1;L+=2){let F=a[L];const U=a[L+1];Array.isArray(F)||(F=[F]);const q=u.concat(L);if(F.length===0)return q.error("Expected at least one branch label.");for(const Q of F){if(typeof Q!="number"&&typeof Q!="string")return q.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return q.error("Numeric branch labels must be integer values.");if(g){if(q.checkSubtype(g,Mn(Q)))return null}else g=Mn(Q);if(T[String(Q)]!==void 0)return q.error("Branch labels must be unique.");T[String(Q)]=S.length}const X=u.parse(U,L,y);if(!X)return null;y=y||X.type,S.push(X)}const M=u.parse(a[1],1,Ar);if(!M)return null;const R=u.parse(a[a.length-1],a.length-1,y);return R?M.type.kind!=="value"&&u.concat(1).checkSubtype(g,M.type)?null:new jr(g,y,M,T,S,R):null}evaluate(a){const u=this.input.evaluate(a);return(Mn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Zh{constructor(a,u,g){this.type=a,this.branches=u,this.otherwise=g}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const y=[];for(let S=1;S<a.length-1;S+=2){const M=u.parse(a[S],S,Sr);if(!M)return null;const R=u.parse(a[S+1],S+1,g);if(!R)return null;y.push([M,R]),g=g||R.type}const T=u.parse(a[a.length-1],a.length-1,g);if(!T)return null;if(!g)throw new Error("Can't infer output type");return new Zh(g,y,T)}evaluate(a){for(const[u,g]of this.branches)if(u.evaluate(a))return g.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,g]of this.branches)a(u),a(g);a(this.otherwise)}outputDefined(){return this.branches.every((([a,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}}class Aa{constructor(a,u,g,y){this.type=a,this.input=u,this.beginIndex=g,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const g=u.parse(a[1],1,Ar),y=u.parse(a[2],2,Nt);if(!g||!y)return null;if(!zu(g.type,[Xi(Ar),hr,Ar]))return u.error(`Expected first argument to be of type array or string, but found ${Fr(g.type)} instead`);if(a.length===4){const T=u.parse(a[3],3,Nt);return T?new Aa(g.type,g,y,T):null}return new Aa(g.type,g,y)}evaluate(a){const u=this.input.evaluate(a),g=this.beginIndex.evaluate(a);let y;if(this.endIndex&&(y=this.endIndex.evaluate(a)),Dl(u,["string"]))return[...u].slice(g,y).join("");if(Dl(u,["array"]))return u.slice(g,y);throw new un(`Expected first argument to be of type array or string, but found ${Fr(Mn(u))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Bl(h,a){const u=h.length-1;let g,y,T=0,S=u,M=0;for(;T<=S;)if(M=Math.floor((T+S)/2),g=h[M],y=h[M+1],g<=a){if(M===u||a<y)return M;T=M+1}else{if(!(g>a))throw new un("Input is not a number.");S=M-1}return 0}class Fl{constructor(a,u,g){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,T]of g)this.labels.push(y),this.outputs.push(T)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const g=u.parse(a[1],1,Nt);if(!g)return null;const y=[];let T=null;u.expectedType&&u.expectedType.kind!=="value"&&(T=u.expectedType);for(let S=1;S<a.length;S+=2){const M=S===1?-1/0:a[S],R=a[S+1],L=S,F=S+1;if(typeof M!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(y.length&&y[y.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const U=u.parse(R,F,T);if(!U)return null;T=T||U.type,y.push([M,U])}return new Fl(T,g,y)}evaluate(a){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return g[0].evaluate(a);const T=u.length;return y>=u[T-1]?g[T-1].evaluate(a):g[Bl(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Lm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Yh,Lp,iv=(function(){if(Lp)return Yh;function h(a,u,g,y){this.cx=3*a,this.bx=3*(g-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=g,this.p2y=y}return Lp=1,Yh=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var g=a,y=0;y<8;y++){var T=this.sampleCurveX(g)-a;if(Math.abs(T)<u)return g;var S=this.sampleCurveDerivativeX(g);if(Math.abs(S)<1e-6)break;g-=T/S}var M=0,R=1;for(g=a,y=0;y<20&&(T=this.sampleCurveX(g),!(Math.abs(T-a)<u));y++)a>T?M=g:R=g,g=.5*(R-M)+M;return g},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},Yh})(),Np=Lm(iv);class cs{constructor(a,u,g,y,T){this.type=a,this.operator=u,this.interpolation=g,this.input=y,this.labels=[],this.outputs=[];for(const[S,M]of T)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(a,u,g,y){let T=0;if(a.name==="exponential")T=Ao(u,a.base,g,y);else if(a.name==="linear")T=Ao(u,1,g,y);else if(a.name==="cubic-bezier"){const S=a.controlPoints;T=new Np(S[0],S[1],S[2],S[3]).solve(Ao(u,1,g,y))}return T}static parse(a,u){let[g,y,T,...S]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const L=y[1];if(typeof L!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:L}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const L=y.slice(1);if(L.length!==4||L.some((F=>typeof F!="number"||F<0||F>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:L}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(T=u.parse(T,2,Nt),!T)return null;const M=[];let R=null;g!=="interpolate-hcl"&&g!=="interpolate-lab"||u.expectedType==xo?u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType):R=Gs;for(let L=0;L<S.length;L+=2){const F=S[L],U=S[L+1],q=L+3,X=L+4;if(typeof F!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(M.length&&M[M.length-1][0]>=F)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const Q=u.parse(U,X,R);if(!Q)return null;R=R||Q.type,M.push([F,Q])}return Ya(R,Nt)||Ya(R,dd)||Ya(R,Gs)||Ya(R,Qo)||Ya(R,wo)||Ya(R,xo)||Ya(R,Lu)||Ya(R,Xi(Nt))?new cs(R,g,y,T,M):u.error(`Type ${Fr(R)} is not interpolatable.`)}evaluate(a){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return g[0].evaluate(a);const T=u.length;if(y>=u[T-1])return g[T-1].evaluate(a);const S=Bl(u,y),M=cs.interpolationFactor(this.interpolation,y,u[S],u[S+1]),R=g[S].evaluate(a),L=g[S+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ll(R,L,M);case"color":return Cr.interpolate(R,L,M);case"padding":return oi.interpolate(R,L,M);case"colorArray":return pr.interpolate(R,L,M);case"numberArray":return Cn.interpolate(R,L,M);case"variableAnchorOffsetCollection":return qn.interpolate(R,L,M);case"array":return Fu(R,L,M);case"projectionDefinition":return xi.interpolate(R,L,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return Cr.interpolate(R,L,M,"hcl");case"colorArray":return pr.interpolate(R,L,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Cr.interpolate(R,L,M,"lab");case"colorArray":return pr.interpolate(R,L,M,"lab")}}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Ao(h,a,u,g){const y=g-u,T=h-u;return y===0?0:a===1?T/y:(Math.pow(a,T)-1)/(Math.pow(a,y)-1)}const In={color:Cr.interpolate,number:Ll,padding:oi.interpolate,numberArray:Cn.interpolate,colorArray:pr.interpolate,variableAnchorOffsetCollection:qn.interpolate,array:Fu};class Lc{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let g=null;const y=u.expectedType;y&&y.kind!=="value"&&(g=y);const T=[];for(const M of a.slice(1)){const R=u.parse(M,1+T.length,g,void 0,{typeAnnotation:"omit"});if(!R)return null;g=g||R.type,T.push(R)}if(!g)throw new Error("No output type");const S=y&&T.some((M=>Nu(y,M.type)));return new Lc(S?Ar:g,T)}evaluate(a){let u,g=null,y=0;for(const T of this.args)if(y++,g=T.evaluate(a),g&&g instanceof as&&!g.available&&(u||(u=g.name),g=null,y===this.args.length&&(g=u)),g!==null)break;return g}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}function Kh(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Qh(h,a,u,g){return g.compare(a,u)===0}function Xn(h,a,u){const g=h!=="=="&&h!=="!=";return class M4{constructor(T,S,M){this.type=Sr,this.lhs=T,this.rhs=S,this.collator=M,this.hasUntypedArgument=T.type.kind==="value"||S.type.kind==="value"}static parse(T,S){if(T.length!==3&&T.length!==4)return S.error("Expected two or three arguments.");const M=T[0];let R=S.parse(T[1],1,Ar);if(!R)return null;if(!Kh(M,R.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${Fr(R.type)}'.`);let L=S.parse(T[2],2,Ar);if(!L)return null;if(!Kh(M,L.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${Fr(L.type)}'.`);if(R.type.kind!==L.type.kind&&R.type.kind!=="value"&&L.type.kind!=="value")return S.error(`Cannot compare types '${Fr(R.type)}' and '${Fr(L.type)}'.`);g&&(R.type.kind==="value"&&L.type.kind!=="value"?R=new os(L.type,[R]):R.type.kind!=="value"&&L.type.kind==="value"&&(L=new os(R.type,[L])));let F=null;if(T.length===4){if(R.type.kind!=="string"&&L.type.kind!=="string"&&R.type.kind!=="value"&&L.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(F=S.parse(T[3],3,Pc),!F)return null}return new M4(R,L,F)}evaluate(T){const S=this.lhs.evaluate(T),M=this.rhs.evaluate(T);if(g&&this.hasUntypedArgument){const R=Mn(S),L=Mn(M);if(R.kind!==L.kind||R.kind!=="string"&&R.kind!=="number")throw new un(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${R.kind}, ${L.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const R=Mn(S),L=Mn(M);if(R.kind!=="string"||L.kind!=="string")return a(T,S,M)}return this.collator?u(T,S,M,this.collator.evaluate(T)):a(T,S,M)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const Nm=Xn("==",(function(h,a,u){return a===u}),Qh),md=Xn("!=",(function(h,a,u){return a!==u}),(function(h,a,u,g){return!Qh(0,a,u,g)})),zm=Xn("<",(function(h,a,u){return a<u}),(function(h,a,u,g){return g.compare(a,u)<0})),sv=Xn(">",(function(h,a,u){return a>u}),(function(h,a,u,g){return g.compare(a,u)>0})),ju=Xn("<=",(function(h,a,u){return a<=u}),(function(h,a,u,g){return g.compare(a,u)<=0})),_d=Xn(">=",(function(h,a,u){return a>=u}),(function(h,a,u,g){return g.compare(a,u)>=0}));class Uu{constructor(a,u,g){this.type=Pc,this.locale=g,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const g=a[1];if(typeof g!="object"||Array.isArray(g))return u.error("Collator options argument must be an object.");const y=u.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,Sr);if(!y)return null;const T=u.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,Sr);if(!T)return null;let S=null;return g.locale&&(S=u.parse(g.locale,1,hr),!S)?null:new Uu(y,T,S)}evaluate(a){return new Ka(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class zp{constructor(a,u,g,y,T){this.type=hr,this.number=a,this.locale=u,this.currency=g,this.minFractionDigits=y,this.maxFractionDigits=T}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const g=u.parse(a[1],1,Nt);if(!g)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let T=null;if(y.locale&&(T=u.parse(y.locale,1,hr),!T))return null;let S=null;if(y.currency&&(S=u.parse(y.currency,1,hr),!S))return null;let M=null;if(y["min-fraction-digits"]&&(M=u.parse(y["min-fraction-digits"],1,Nt),!M))return null;let R=null;return y["max-fraction-digits"]&&(R=u.parse(y["max-fraction-digits"],1,Nt),!R)?null:new zp(g,T,S,M,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Jh{constructor(a){this.type=bo,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const g=a[1];if(!Array.isArray(g)&&typeof g=="object")return u.error("First argument must be an image or text section.");const y=[];let T=!1;for(let S=1;S<=a.length-1;++S){const M=a[S];if(T&&typeof M=="object"&&!Array.isArray(M)){T=!1;let R=null;if(M["font-scale"]&&(R=u.parse(M["font-scale"],1,Nt),!R))return null;let L=null;if(M["text-font"]&&(L=u.parse(M["text-font"],1,Xi(hr)),!L))return null;let F=null;if(M["text-color"]&&(F=u.parse(M["text-color"],1,Gs),!F))return null;let U=null;if(M["vertical-align"]){if(typeof M["vertical-align"]=="string"&&!kp.includes(M["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${M["vertical-align"]}' instead.`);if(U=u.parse(M["vertical-align"],1,hr),!U)return null}const q=y[y.length-1];q.scale=R,q.font=L,q.textColor=F,q.verticalAlign=U}else{const R=u.parse(a[S],1,Ar);if(!R)return null;const L=R.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,y.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Jh(y)}evaluate(a){return new bi(this.sections.map((u=>{const g=u.content.evaluate(a);return Mn(g)===Hn?new Xh("",g,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(a):null):new Xh(Nl(g),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null,u.verticalAlign?u.verticalAlign.evaluate(a):null)})))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor),u.verticalAlign&&a(u.verticalAlign)}outputDefined(){return!1}}class Vu{constructor(a){this.type=Hn,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const g=u.parse(a[1],1,hr);return g?new Vu(g):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),g=as.fromString(u);return g&&a.availableImages&&(g.available=a.availableImages.indexOf(u)>-1),g}eachChild(a){a(this.input)}outputDefined(){return!1}}class $u{constructor(a){this.type=Nt,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const g=u.parse(a[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Fr(g.type)} instead.`):new $u(g):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new un(`Expected value to be of type string or array, but found ${Fr(Mn(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const ei=8192;function Wu(h,a){const u=(180+h[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*ei),Math.round(g*y*ei)]}function Hu(h,a){const u=Math.pow(2,a.z);return[(y=(h[0]/ei+a.x)/u,360*y-180),(g=(h[1]/ei+a.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,y}function qu(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function jl(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function Bm(h,a,u){const g=h[0]-a[0],y=h[1]-a[1],T=h[0]-u[0],S=h[1]-u[1];return g*S-T*y==0&&g*T<=0&&y*S<=0}function ef(h,a,u,g){return(y=[g[0]-u[0],g[1]-u[1]])[0]*(T=[a[0]-h[0],a[1]-h[1]])[1]-y[1]*T[0]!=0&&!(!vd(h,a,u,g)||!vd(u,g,h,a));var y,T}function Fm(h,a,u){for(const g of u)for(let y=0;y<g.length-1;++y)if(ef(h,a,g[y],g[y+1]))return!0;return!1}function Qa(h,a,u=!1){let g=!1;for(const M of a)for(let R=0;R<M.length-1;R++){if(Bm(h,M[R],M[R+1]))return u;(T=M[R])[1]>(y=h)[1]!=(S=M[R+1])[1]>y[1]&&y[0]<(S[0]-T[0])*(y[1]-T[1])/(S[1]-T[1])+T[0]&&(g=!g)}var y,T,S;return g}function yd(h,a){for(const u of a)if(Qa(h,u))return!0;return!1}function jm(h,a){for(const u of h)if(!Qa(u,a))return!1;for(let u=0;u<h.length-1;++u)if(Fm(h[u],h[u+1],a))return!1;return!0}function Um(h,a){for(const u of a)if(jm(h,u))return!0;return!1}function vd(h,a,u,g){const y=g[0]-u[0],T=g[1]-u[1],S=(h[0]-u[0])*T-y*(h[1]-u[1]),M=(a[0]-u[0])*T-y*(a[1]-u[1]);return S>0&&M<0||S<0&&M>0}function bd(h,a,u){const g=[];for(let y=0;y<h.length;y++){const T=[];for(let S=0;S<h[y].length;S++){const M=Wu(h[y][S],u);qu(a,M),T.push(M)}g.push(T)}return g}function Nc(h,a,u){const g=[];for(let y=0;y<h.length;y++){const T=bd(h[y],a,u);g.push(T)}return g}function Xu(h,a,u,g){if(h[0]<u[0]||h[0]>u[2]){const y=.5*g;let T=h[0]-u[0]>y?-g:u[0]-h[0]>y?g:0;T===0&&(T=h[0]-u[2]>y?-g:u[2]-h[0]>y?g:0),h[0]+=T}qu(a,h)}function Vm(h,a,u,g){const y=Math.pow(2,g.z)*ei,T=[g.x*ei,g.y*ei],S=[];for(const M of h)for(const R of M){const L=[R.x+T[0],R.y+T[1]];Xu(L,a,u,y),S.push(L)}return S}function tf(h,a,u,g){const y=Math.pow(2,g.z)*ei,T=[g.x*ei,g.y*ei],S=[];for(const R of h){const L=[];for(const F of R){const U=[F.x+T[0],F.y+T[1]];qu(a,U),L.push(U)}S.push(L)}if(a[2]-a[0]<=y/2){(M=a)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of S)for(const L of R)Xu(L,a,u,y)}var M;return S}class Ul{constructor(a,u){this.type=Sr,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(So(a[1])){const g=a[1];if(g.type==="FeatureCollection"){const y=[];for(const T of g.features){const{type:S,coordinates:M}=T.geometry;S==="Polygon"&&y.push(M),S==="MultiPolygon"&&y.push(...M)}if(y.length)return new Ul(g,{type:"MultiPolygon",coordinates:y})}else if(g.type==="Feature"){const y=g.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ul(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new Ul(g,g)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,g){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(g.type==="Polygon"){const M=bd(g.coordinates,T,S),R=Vm(u.geometry(),y,T,S);if(!jl(y,T))return!1;for(const L of R)if(!Qa(L,M))return!1}if(g.type==="MultiPolygon"){const M=Nc(g.coordinates,T,S),R=Vm(u.geometry(),y,T,S);if(!jl(y,T))return!1;for(const L of R)if(!yd(L,M))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,g){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(g.type==="Polygon"){const M=bd(g.coordinates,T,S),R=tf(u.geometry(),y,T,S);if(!jl(y,T))return!1;for(const L of R)if(!jm(L,M))return!1}if(g.type==="MultiPolygon"){const M=Nc(g.coordinates,T,S),R=tf(u.geometry(),y,T,S);if(!jl(y,T))return!1;for(const L of R)if(!Um(L,M))return!1}return!0})(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Bp=class{constructor(h=[],a=(u,g)=>u<g?-1:u>g?1:0){if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:u}=this,g=a[h];for(;h>0;){const y=h-1>>1,T=a[y];if(u(g,T)>=0)break;a[h]=T,h=y}a[h]=g}_down(h){const{data:a,compare:u}=this,g=this.length>>1,y=a[h];for(;h<g;){let T=1+(h<<1);const S=T+1;if(S<this.length&&u(a[S],a[T])<0&&(T=S),u(a[T],y)>=0)break;a[h]=a[T],h=T}a[h]=y}};function rf(h,a,u=0,g=h.length-1,y=Fp){for(;g>u;){if(g-u>600){const R=g-u+1,L=a-u+1,F=Math.log(R),U=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*U*(R-U)/R)*(L-R/2<0?-1:1);rf(h,a,Math.max(u,Math.floor(a-L*U/R+q)),Math.min(g,Math.floor(a+(R-L)*U/R+q)),y)}const T=h[a];let S=u,M=g;for(Vl(h,u,a),y(h[g],T)>0&&Vl(h,u,g);S<M;){for(Vl(h,S,M),S++,M--;y(h[S],T)<0;)S++;for(;y(h[M],T)>0;)M--}y(h[u],T)===0?Vl(h,u,M):(M++,Vl(h,M,g)),M<=a&&(u=M+1),a<=M&&(g=M-1)}}function Vl(h,a,u){const g=h[a];h[a]=h[u],h[u]=g}function Fp(h,a){return h<a?-1:h>a?1:0}function nf(h,a){if(h.length<=1)return[h];const u=[];let g,y;for(const T of h){const S=av(T);S!==0&&(T.area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(g&&u.push(g),g=[T]):g.push(T))}if(g&&u.push(g),a>1)for(let T=0;T<u.length;T++)u[T].length<=a||(rf(u[T],a,1,u[T].length-1,$m),u[T]=u[T].slice(0,a));return u}function $m(h,a){return a.area-h.area}function av(h){let a=0;for(let u,g,y=0,T=h.length,S=T-1;y<T;S=y++)u=h[y],g=h[S],a+=(g.x-u.x)*(u.y+g.y);return a}const Wm=1/298.257223563,sf=Wm*(2-Wm),Hm=Math.PI/180;class jp{constructor(a){const u=6378.137*Hm*1e3,g=Math.cos(a*Hm),y=1/(1-sf*(1-g*g)),T=Math.sqrt(y);this.kx=u*T*g,this.ky=u*T*y*(1-sf)}distance(a,u){const g=this.wrap(a[0]-u[0])*this.kx,y=(a[1]-u[1])*this.ky;return Math.sqrt(g*g+y*y)}pointOnLine(a,u){let g,y,T,S,M=1/0;for(let R=0;R<a.length-1;R++){let L=a[R][0],F=a[R][1],U=this.wrap(a[R+1][0]-L)*this.kx,q=(a[R+1][1]-F)*this.ky,X=0;U===0&&q===0||(X=(this.wrap(u[0]-L)*this.kx*U+(u[1]-F)*this.ky*q)/(U*U+q*q),X>1?(L=a[R+1][0],F=a[R+1][1]):X>0&&(L+=U/this.kx*X,F+=q/this.ky*X)),U=this.wrap(u[0]-L)*this.kx,q=(u[1]-F)*this.ky;const Q=U*U+q*q;Q<M&&(M=Q,g=L,y=F,T=R,S=X)}return{point:[g,y],index:T,t:Math.max(0,Math.min(1,S))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function Ss(h,a){return a[0]-h[0]}function $l(h){return h[1]-h[0]+1}function Ea(h,a){return h[1]>=h[0]&&h[1]<a}function af(h,a){if(h[0]>h[1])return[null,null];const u=$l(h);if(a){if(u===2)return[h,null];const y=Math.floor(u/2);return[[h[0],h[0]+y],[h[0]+y,h[1]]]}if(u===1)return[h,null];const g=Math.floor(u/2)-1;return[[h[0],h[0]+g],[h[0]+g+1,h[1]]]}function xd(h,a){if(!Ea(a,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let g=a[0];g<=a[1];++g)qu(u,h[g]);return u}function wd(h){const a=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const g of u)qu(a,g);return a}function of(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Td(h,a,u){if(!of(h)||!of(a))return NaN;let g=0,y=0;return h[2]<a[0]&&(g=a[0]-h[2]),h[0]>a[2]&&(g=h[0]-a[2]),h[1]>a[3]&&(y=h[1]-a[3]),h[3]<a[1]&&(y=a[1]-h[3]),u.distance([0,0],[g,y])}function Pa(h,a,u){const g=u.pointOnLine(a,h);return u.distance(h,g.point)}function lf(h,a,u,g,y){const T=Math.min(Pa(h,[u,g],y),Pa(a,[u,g],y)),S=Math.min(Pa(u,[h,a],y),Pa(g,[h,a],y));return Math.min(T,S)}function cf(h,a,u,g,y){if(!Ea(a,h.length)||!Ea(g,u.length))return 1/0;let T=1/0;for(let S=a[0];S<a[1];++S){const M=h[S],R=h[S+1];for(let L=g[0];L<g[1];++L){const F=u[L],U=u[L+1];if(ef(M,R,F,U))return 0;T=Math.min(T,lf(M,R,F,U,y))}}return T}function Sd(h,a,u,g,y){if(!Ea(a,h.length)||!Ea(g,u.length))return NaN;let T=1/0;for(let S=a[0];S<=a[1];++S)for(let M=g[0];M<=g[1];++M)if(T=Math.min(T,y.distance(h[S],u[M])),T===0)return T;return T}function qm(h,a,u){if(Qa(h,a,!0))return 0;let g=1/0;for(const y of a){const T=y[0],S=y[y.length-1];if(T!==S&&(g=Math.min(g,Pa(h,[S,T],u)),g===0))return g;const M=u.pointOnLine(y,h);if(g=Math.min(g,u.distance(h,M.point)),g===0)return g}return g}function zc(h,a,u,g){if(!Ea(a,h.length))return NaN;for(let T=a[0];T<=a[1];++T)if(Qa(h[T],u,!0))return 0;let y=1/0;for(let T=a[0];T<a[1];++T){const S=h[T],M=h[T+1];for(const R of u)for(let L=0,F=R.length,U=F-1;L<F;U=L++){const q=R[U],X=R[L];if(ef(S,M,q,X))return 0;y=Math.min(y,lf(S,M,q,X,g))}}return y}function Bc(h,a){for(const u of h)for(const g of u)if(Qa(g,a,!0))return!0;return!1}function Up(h,a,u,g=1/0){const y=wd(h),T=wd(a);if(g!==1/0&&Td(y,T,u)>=g)return g;if(jl(y,T)){if(Bc(h,a))return 0}else if(Bc(a,h))return 0;let S=1/0;for(const M of h)for(let R=0,L=M.length,F=L-1;R<L;F=R++){const U=M[F],q=M[R];for(const X of a)for(let Q=0,te=X.length,ae=te-1;Q<te;ae=Q++){const de=X[ae],Te=X[Q];if(ef(U,q,de,Te))return 0;S=Math.min(S,lf(U,q,de,Te,u))}}return S}function Xr(h,a,u,g,y,T){if(!T)return;const S=Td(xd(g,T),y,u);S<a&&h.push([S,T,[0,0]])}function Eo(h,a,u,g,y,T,S){if(!T||!S)return;const M=Td(xd(g,T),xd(y,S),u);M<a&&h.push([M,T,S])}function uf(h,a,u,g,y=1/0){let T=Math.min(g.distance(h[0],u[0][0]),y);if(T===0)return T;const S=new Bp([[0,[0,h.length-1],[0,0]]],Ss),M=wd(u);for(;S.length>0;){const R=S.pop();if(R[0]>=T)continue;const L=R[1],F=a?50:100;if($l(L)<=F){if(!Ea(L,h.length))return NaN;if(a){const U=zc(h,L,u,g);if(isNaN(U)||U===0)return U;T=Math.min(T,U)}else for(let U=L[0];U<=L[1];++U){const q=qm(h[U],u,g);if(T=Math.min(T,q),T===0)return 0}}else{const U=af(L,a);Xr(S,T,g,h,M,U[0]),Xr(S,T,g,h,M,U[1])}}return T}function hf(h,a,u,g,y,T=1/0){let S=Math.min(T,y.distance(h[0],u[0]));if(S===0)return S;const M=new Bp([[0,[0,h.length-1],[0,u.length-1]]],Ss);for(;M.length>0;){const R=M.pop();if(R[0]>=S)continue;const L=R[1],F=R[2],U=a?50:100,q=g?50:100;if($l(L)<=U&&$l(F)<=q){if(!Ea(L,h.length)&&Ea(F,u.length))return NaN;let X;if(a&&g)X=cf(h,L,u,F,y),S=Math.min(S,X);else if(a&&!g){const Q=h.slice(L[0],L[1]+1);for(let te=F[0];te<=F[1];++te)if(X=Pa(u[te],Q,y),S=Math.min(S,X),S===0)return S}else if(!a&&g){const Q=u.slice(F[0],F[1]+1);for(let te=L[0];te<=L[1];++te)if(X=Pa(h[te],Q,y),S=Math.min(S,X),S===0)return S}else X=Sd(h,L,u,F,y),S=Math.min(S,X)}else{const X=af(L,a),Q=af(F,g);Eo(M,S,y,h,u,X[0],Q[0]),Eo(M,S,y,h,u,X[0],Q[1]),Eo(M,S,y,h,u,X[1],Q[0]),Eo(M,S,y,h,u,X[1],Q[1])}}return S}function Ad(h){return h.type==="MultiPolygon"?h.coordinates.map((a=>({type:"Polygon",coordinates:a}))):h.type==="MultiLineString"?h.coordinates.map((a=>({type:"LineString",coordinates:a}))):h.type==="MultiPoint"?h.coordinates.map((a=>({type:"Point",coordinates:a}))):[h]}class Fc{constructor(a,u){this.type=Nt,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(So(a[1])){const g=a[1];if(g.type==="FeatureCollection")return new Fc(g,g.features.map((y=>Ad(y.geometry))).flat());if(g.type==="Feature")return new Fc(g,Ad(g.geometry));if("type"in g&&"coordinates"in g)return new Fc(g,Ad(g))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,g){const y=u.geometry(),T=y.flat().map((R=>Hu([R.x,R.y],u.canonical)));if(y.length===0)return NaN;const S=new jp(T[0][1]);let M=1/0;for(const R of g){switch(R.type){case"Point":M=Math.min(M,hf(T,!1,[R.coordinates],!1,S,M));break;case"LineString":M=Math.min(M,hf(T,!1,R.coordinates,!0,S,M));break;case"Polygon":M=Math.min(M,uf(T,!1,R.coordinates,S,M))}if(M===0)return M}return M})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,g){const y=u.geometry(),T=y.flat().map((R=>Hu([R.x,R.y],u.canonical)));if(y.length===0)return NaN;const S=new jp(T[0][1]);let M=1/0;for(const R of g){switch(R.type){case"Point":M=Math.min(M,hf(T,!0,[R.coordinates],!1,S,M));break;case"LineString":M=Math.min(M,hf(T,!0,R.coordinates,!0,S,M));break;case"Polygon":M=Math.min(M,uf(T,!0,R.coordinates,S,M))}if(M===0)return M}return M})(a,this.geometries);if(a.geometryType()==="Polygon")return(function(u,g){const y=u.geometry();if(y.length===0||y[0].length===0)return NaN;const T=nf(y,0).map((R=>R.map((L=>L.map((F=>Hu([F.x,F.y],u.canonical))))))),S=new jp(T[0][0][0][1]);let M=1/0;for(const R of g)for(const L of T){switch(R.type){case"Point":M=Math.min(M,uf([R.coordinates],!1,L,S,M));break;case"LineString":M=Math.min(M,uf(R.coordinates,!0,L,S,M));break;case"Polygon":M=Math.min(M,Up(L,R.coordinates,S,M))}if(M===0)return M}return M})(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ff{constructor(a){this.type=Ar,this.key=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const g=a[1];return g==null?u.error("Global state property must be defined."):typeof g!="string"?u.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new ff(g)}evaluate(a){var u;const g=(u=a.globals)===null||u===void 0?void 0:u.globalState;return g&&Object.keys(g).length!==0?Bu(g,this.key):null}eachChild(){}outputDefined(){return!1}}const Gu={"==":Nm,"!=":md,">":sv,"<":zm,">=":_d,"<=":ju,array:os,at:kr,boolean:os,case:Zh,coalesce:Lc,collator:Uu,format:Jh,image:Vu,in:Er,"index-of":kc,interpolate:cs,"interpolate-hcl":cs,"interpolate-lab":cs,length:$u,let:sn,literal:Ys,match:jr,number:os,"number-format":zp,object:os,slice:Aa,step:Fl,string:os,"to-boolean":ls,"to-color":ls,"to-number":ls,"to-string":ls,var:zl,within:Ul,distance:Fc,"global-state":ff};class Ks{constructor(a,u,g,y){this.name=a,this.type=u,this._evaluate=g,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const g=a[0],y=Ks.definitions[g];if(!y)return u.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,M=S.filter((([L])=>!Array.isArray(L)||L.length===a.length-1));let R=null;for(const[L,F]of M){R=new Dc(u.registry,us,u.path,null,u.scope);const U=[];let q=!1;for(let X=1;X<a.length;X++){const Q=a[X],te=Array.isArray(L)?L[X-1]:L.type,ae=R.parse(Q,1+U.length,te);if(!ae){q=!0;break}U.push(ae)}if(!q)if(Array.isArray(L)&&L.length!==U.length)R.error(`Expected ${L.length} arguments, but found ${U.length} instead.`);else{for(let X=0;X<U.length;X++){const Q=Array.isArray(L)?L[X]:L.type,te=U[X];R.concat(X+1).checkSubtype(Q,te.type)}if(R.errors.length===0)return new Ks(g,T,F,U)}}if(M.length===1)u.errors.push(...R.errors);else{const L=(M.length?M:S).map((([U])=>{return q=U,Array.isArray(q)?`(${q.map(Fr).join(", ")})`:`(${Fr(q.type)}...)`;var q})).join(" | "),F=[];for(let U=1;U<a.length;U++){const q=u.parse(a[U],1+F.length);if(!q)return null;F.push(Fr(q.type))}u.error(`Expected arguments of type ${L}, but found (${F.join(", ")}) instead.`)}return null}static register(a,u){Ks.definitions=u;for(const g in u)a[g]=Ks}}function Vp(h,[a,u,g,y]){a=a.evaluate(h),u=u.evaluate(h),g=g.evaluate(h);const T=y?y.evaluate(h):1,S=Zs(a,u,g,T);if(S)throw new un(S);return new Cr(a/255,u/255,g/255,T,!1)}function Ed(h,a){return h in a}function Qs(h,a){const u=a[h];return u===void 0?null:u}function Po(h){return{type:h}}function us(h){if(h instanceof zl)return us(h.boundExpression);if(h instanceof Ks&&h.name==="error"||h instanceof Uu||h instanceof Ul||h instanceof Fc||h instanceof ff)return!1;const a=h instanceof ls||h instanceof os;let u=!0;return h.eachChild((g=>{u=a?u&&us(g):u&&g instanceof Ys})),!!u&&tl(h)&&Uc(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function tl(h){if(h instanceof Ks&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Ul||h instanceof Fc)return!1;let a=!0;return h.eachChild((u=>{a&&!tl(u)&&(a=!1)})),a}function jc(h){if(h instanceof Ks&&h.name==="feature-state")return!1;let a=!0;return h.eachChild((u=>{a&&!jc(u)&&(a=!1)})),a}function Uc(h,a){if(h instanceof Ks&&a.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild((g=>{u&&!Uc(g,a)&&(u=!1)})),u}function df(h){return{result:"success",value:h}}function Wl(h){return{result:"error",value:h}}function Ca(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function $p(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Zu(h){return!!h.expression&&h.expression.interpolated}function Pr(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Pd(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Mn(h)===vo}function Js(h){return h}function Cd(h,a){const u=h.stops&&typeof h.stops[0][0]=="object",g=u||!(u||h.property!==void 0),y=h.type||(Zu(a)?"exponential":"interval"),T=(function(F){switch(F.type){case"color":return Cr.parse;case"padding":return oi.parse;case"numberArray":return Cn.parse;case"colorArray":return pr.parse;default:return null}})(a);if(T&&((h=Hr({},h)).stops&&(h.stops=h.stops.map((F=>[F[0],T(F[1])]))),h.default=T(h.default?h.default:a.default)),h.colorSpace&&(S=h.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var S;const M=(function(F){switch(F){case"exponential":return Hl;case"interval":return Md;case"categorical":return Xm;case"identity":return Wp;default:throw new Error(`Unknown function type "${F}"`)}})(y);let R,L;if(y==="categorical"){R=Object.create(null);for(const F of h.stops)R[F[0]]=F[1];L=typeof h.stops[0][0]}if(u){const F={},U=[];for(let Q=0;Q<h.stops.length;Q++){const te=h.stops[Q],ae=te[0].zoom;F[ae]===void 0&&(F[ae]={zoom:ae,type:h.type,property:h.property,default:h.default,stops:[]},U.push(ae)),F[ae].stops.push([te[0].value,te[1]])}const q=[];for(const Q of U)q.push([F[Q].zoom,Cd(F[Q],a)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:cs.interpolationFactor.bind(void 0,X),zoomStops:q.map((Q=>Q[0])),evaluate:({zoom:Q},te)=>Hl({stops:q,base:h.base},a,Q).evaluate(Q,te)}}if(g){const F=y==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:cs.interpolationFactor.bind(void 0,F),zoomStops:h.stops.map((U=>U[0])),evaluate:({zoom:U})=>M(h,a,U,R,L)}}return{kind:"source",evaluate(F,U){const q=U&&U.properties?U.properties[h.property]:void 0;return q===void 0?ea(h.default,a.default):M(h,a,q,R,L)}}}function ea(h,a,u){return h!==void 0?h:a!==void 0?a:u!==void 0?u:void 0}function Xm(h,a,u,g,y){return ea(typeof u===y?g[u]:void 0,h.default,a.default)}function Md(h,a,u){if(Pr(u)!=="number")return ea(h.default,a.default);const g=h.stops.length;if(g===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[g-1][0])return h.stops[g-1][1];const y=Bl(h.stops.map((T=>T[0])),u);return h.stops[y][1]}function Hl(h,a,u){const g=h.base!==void 0?h.base:1;if(Pr(u)!=="number")return ea(h.default,a.default);const y=h.stops.length;if(y===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[y-1][0])return h.stops[y-1][1];const T=Bl(h.stops.map((F=>F[0])),u),S=(function(F,U,q,X){const Q=X-q,te=F-q;return Q===0?0:U===1?te/Q:(Math.pow(U,te)-1)/(Math.pow(U,Q)-1)})(u,g,h.stops[T][0],h.stops[T+1][0]),M=h.stops[T][1],R=h.stops[T+1][1],L=In[a.type]||Js;return typeof M.evaluate=="function"?{evaluate(...F){const U=M.evaluate.apply(void 0,F),q=R.evaluate.apply(void 0,F);if(U!==void 0&&q!==void 0)return L(U,q,S,h.colorSpace)}}:L(M,R,S,h.colorSpace)}function Wp(h,a,u){switch(a.type){case"color":u=Cr.parse(u);break;case"formatted":u=bi.fromString(u.toString());break;case"resolvedImage":u=as.fromString(u.toString());break;case"padding":u=oi.parse(u);break;case"colorArray":u=pr.parse(u);break;case"numberArray":u=Cn.parse(u);break;default:Pr(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return ea(u,h.default,a.default)}Ks.register(Gu,{error:[{kind:"error"},[hr],(h,[a])=>{throw new un(a.evaluate(h))}],typeof:[hr,[Ar],(h,[a])=>Fr(Mn(a.evaluate(h)))],"to-rgba":[Xi(Nt,4),[Gs],(h,[a])=>{const[u,g,y,T]=a.evaluate(h).rgb;return[255*u,255*g,255*y,T]}],rgb:[Gs,[Nt,Nt,Nt],Vp],rgba:[Gs,[Nt,Nt,Nt,Nt],Vp],has:{type:Sr,overloads:[[[hr],(h,[a])=>Ed(a.evaluate(h),h.properties())],[[hr,vo],(h,[a,u])=>Ed(a.evaluate(h),u.evaluate(h))]]},get:{type:Ar,overloads:[[[hr],(h,[a])=>Qs(a.evaluate(h),h.properties())],[[hr,vo],(h,[a,u])=>Qs(a.evaluate(h),u.evaluate(h))]]},"feature-state":[Ar,[hr],(h,[a])=>Qs(a.evaluate(h),h.featureState||{})],properties:[vo,[],h=>h.properties()],"geometry-type":[hr,[],h=>h.geometryType()],id:[Ar,[],h=>h.id()],zoom:[Nt,[],h=>h.globals.zoom],"heatmap-density":[Nt,[],h=>h.globals.heatmapDensity||0],elevation:[Nt,[],h=>h.globals.elevation||0],"line-progress":[Nt,[],h=>h.globals.lineProgress||0],accumulated:[Ar,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Nt,Po(Nt),(h,a)=>{let u=0;for(const g of a)u+=g.evaluate(h);return u}],"*":[Nt,Po(Nt),(h,a)=>{let u=1;for(const g of a)u*=g.evaluate(h);return u}],"-":{type:Nt,overloads:[[[Nt,Nt],(h,[a,u])=>a.evaluate(h)-u.evaluate(h)],[[Nt],(h,[a])=>-a.evaluate(h)]]},"/":[Nt,[Nt,Nt],(h,[a,u])=>a.evaluate(h)/u.evaluate(h)],"%":[Nt,[Nt,Nt],(h,[a,u])=>a.evaluate(h)%u.evaluate(h)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(h,[a,u])=>Math.pow(a.evaluate(h),u.evaluate(h))],sqrt:[Nt,[Nt],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))],log2:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[Nt,[Nt],(h,[a])=>Math.sin(a.evaluate(h))],cos:[Nt,[Nt],(h,[a])=>Math.cos(a.evaluate(h))],tan:[Nt,[Nt],(h,[a])=>Math.tan(a.evaluate(h))],asin:[Nt,[Nt],(h,[a])=>Math.asin(a.evaluate(h))],acos:[Nt,[Nt],(h,[a])=>Math.acos(a.evaluate(h))],atan:[Nt,[Nt],(h,[a])=>Math.atan(a.evaluate(h))],min:[Nt,Po(Nt),(h,a)=>Math.min(...a.map((u=>u.evaluate(h))))],max:[Nt,Po(Nt),(h,a)=>Math.max(...a.map((u=>u.evaluate(h))))],abs:[Nt,[Nt],(h,[a])=>Math.abs(a.evaluate(h))],round:[Nt,[Nt],(h,[a])=>{const u=a.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[Nt,[Nt],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[Nt,[Nt],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[Sr,[hr,Ar],(h,[a,u])=>h.properties()[a.value]===u.value],"filter-id-==":[Sr,[Ar],(h,[a])=>h.id()===a.value],"filter-type-==":[Sr,[hr],(h,[a])=>h.geometryType()===a.value],"filter-<":[Sr,[hr,Ar],(h,[a,u])=>{const g=h.properties()[a.value],y=u.value;return typeof g==typeof y&&g<y}],"filter-id-<":[Sr,[Ar],(h,[a])=>{const u=h.id(),g=a.value;return typeof u==typeof g&&u<g}],"filter->":[Sr,[hr,Ar],(h,[a,u])=>{const g=h.properties()[a.value],y=u.value;return typeof g==typeof y&&g>y}],"filter-id->":[Sr,[Ar],(h,[a])=>{const u=h.id(),g=a.value;return typeof u==typeof g&&u>g}],"filter-<=":[Sr,[hr,Ar],(h,[a,u])=>{const g=h.properties()[a.value],y=u.value;return typeof g==typeof y&&g<=y}],"filter-id-<=":[Sr,[Ar],(h,[a])=>{const u=h.id(),g=a.value;return typeof u==typeof g&&u<=g}],"filter->=":[Sr,[hr,Ar],(h,[a,u])=>{const g=h.properties()[a.value],y=u.value;return typeof g==typeof y&&g>=y}],"filter-id->=":[Sr,[Ar],(h,[a])=>{const u=h.id(),g=a.value;return typeof u==typeof g&&u>=g}],"filter-has":[Sr,[Ar],(h,[a])=>a.value in h.properties()],"filter-has-id":[Sr,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Sr,[Xi(hr)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[Sr,[Xi(Ar)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[Sr,[hr,Xi(Ar)],(h,[a,u])=>u.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[Sr,[hr,Xi(Ar)],(h,[a,u])=>(function(g,y,T,S){for(;T<=S;){const M=T+S>>1;if(y[M]===g)return!0;y[M]>g?S=M-1:T=M+1}return!1})(h.properties()[a.value],u.value,0,u.value.length-1)],all:{type:Sr,overloads:[[[Sr,Sr],(h,[a,u])=>a.evaluate(h)&&u.evaluate(h)],[Po(Sr),(h,a)=>{for(const u of a)if(!u.evaluate(h))return!1;return!0}]]},any:{type:Sr,overloads:[[[Sr,Sr],(h,[a,u])=>a.evaluate(h)||u.evaluate(h)],[Po(Sr),(h,a)=>{for(const u of a)if(u.evaluate(h))return!0;return!1}]]},"!":[Sr,[Sr],(h,[a])=>!a.evaluate(h)],"is-supported-script":[Sr,[hr],(h,[a])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(a.evaluate(h))}],upcase:[hr,[hr],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[hr,[hr],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[hr,Po(Ar),(h,a)=>a.map((u=>Nl(u.evaluate(h)))).join("")],"resolved-locale":[hr,[Pc],(h,[a])=>a.evaluate(h).resolvedLocale()]});class Id{constructor(a,u,g){this.expression=a,this._warningHistory={},this._evaluator=new Oc,this._defaultValue=u?(function(y){if(y.type==="color"&&Pd(y.default))return new Cr(0,0,0,0);switch(y.type){case"color":return Cr.parse(y.default)||null;case"padding":return oi.parse(y.default)||null;case"numberArray":return Cn.parse(y.default)||null;case"colorArray":return pr.parse(y.default)||null;case"variableAnchorOffsetCollection":return qn.parse(y.default)||null;case"projectionDefinition":return xi.parse(y.default)||null;default:return y.default===void 0?null:y.default}})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this._globalState=g}evaluateWithoutErrorHandling(a,u,g,y,T,S){return this._globalState&&(a=Ei(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=g,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(a,u,g,y,T,S){this._globalState&&(a=Ei(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=g||null,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new un(`Expected value to be one of ${Object.keys(this._enumValues).map((R=>JSON.stringify(R))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function ql(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Gu}function Yu(h,a,u){const g=new Dc(Gu,us,[],a?(function(T){const S={color:Gs,string:hr,number:Nt,enum:hr,boolean:Sr,formatted:bo,padding:Qo,numberArray:wo,colorArray:xo,projectionDefinition:dd,resolvedImage:Hn,variableAnchorOffsetCollection:Lu};return T.type==="array"?Xi(S[T.value]||Ar,T.length):S[T.type]})(a):void 0),y=g.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?df(new Id(y,a,u)):Wl(g.errors)}class hs{constructor(a,u,g){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!jc(u.expression),this.globalStateRefs=wi(u.expression),this._globalState=g}evaluateWithoutErrorHandling(a,u,g,y,T,S){return this._globalState&&(a=Ei(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,g,y,T,S)}evaluate(a,u,g,y,T,S){return this._globalState&&(a=Ei(a,this._globalState)),this._styleExpression.evaluate(a,u,g,y,T,S)}}class Xl{constructor(a,u,g,y,T){this.kind=a,this.zoomStops=g,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!jc(u.expression),this.globalStateRefs=wi(u.expression),this.interpolationType=y,this._globalState=T}evaluateWithoutErrorHandling(a,u,g,y,T,S){return this._globalState&&(a=Ei(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,g,y,T,S)}evaluate(a,u,g,y,T,S){return this._globalState&&(a=Ei(a,this._globalState)),this._styleExpression.evaluate(a,u,g,y,T,S)}interpolationFactor(a,u,g){return this.interpolationType?cs.interpolationFactor(this.interpolationType,a,u,g):0}}function Gl(h,a,u){const g=Yu(h,a,u);if(g.result==="error")return g;const y=g.value.expression,T=tl(y);if(!T&&!Ca(a))return Wl([new vn("","data expressions not supported")]);const S=Uc(y,["zoom"]);if(!S&&!$p(a))return Wl([new vn("","zoom expressions not supported")]);const M=Zl(y);return M||S?M instanceof vn?Wl([M]):M instanceof cs&&!Zu(a)?Wl([new vn("",'"interpolate" expressions cannot be used with this property')]):df(M?new Xl(T?"camera":"composite",g.value,M.labels,M instanceof cs?M.interpolation:void 0,u):new hs(T?"constant":"source",g.value,u)):Wl([new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vc{constructor(a,u){this._parameters=a,this._specification=u,Hr(this,Cd(this._parameters,this._specification))}static deserialize(a){return new Vc(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Zl(h){let a=null;if(h instanceof sn)a=Zl(h.result);else if(h instanceof Lc){for(const u of h.args)if(a=Zl(u),a)break}else(h instanceof Fl||h instanceof cs)&&h.input instanceof Ks&&h.input.name==="zoom"&&(a=h);return a instanceof vn||h.eachChild((u=>{const g=Zl(u);g instanceof vn?a=g:!a&&g?a=new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&g&&a!==g&&(a=new vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),a}function wi(h,a=new Set){return h instanceof ff&&a.add(h.key),h.eachChild((u=>{wi(u,a)})),a}function Ei(h,a){const{zoom:u,heatmapDensity:g,elevation:y,lineProgress:T,isSupportedScript:S,accumulated:M}=h??{};return{zoom:u,heatmapDensity:g,elevation:y,lineProgress:T,isSupportedScript:S,accumulated:M,globalState:a}}function Co(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!Co(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Mo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function As(h,a){if(h==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Co(h)||(h=$c(h));const u=Yu(h,Mo,a);if(u.result==="error")throw new Error(u.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return{filter:(g,y,T)=>u.value.evaluate(g,y,{},T),needGeometry:Hp(h),getGlobalStateRefs:()=>wi(u.value.expression)}}function rl(h,a){return h<a?-1:h>a?1:0}function Hp(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(Hp(h[a]))return!0;return!1}function $c(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?Ku(h[1],h[2],"=="):a==="!="?hn(Ku(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ku(h[1],h[2],a):a==="any"?(u=h.slice(1),["any"].concat(u.map($c))):a==="all"?["all"].concat(h.slice(1).map($c)):a==="none"?["all"].concat(h.slice(1).map($c).map(hn)):a==="in"?qp(h[1],h.slice(2)):a==="!in"?hn(qp(h[1],h.slice(2))):a==="has"?Pi(h[1]):a!=="!has"||hn(Pi(h[1]));var u}function Ku(h,a,u){switch(h){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,h,a]}}function qp(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some((u=>typeof u!=typeof a[0]))?["filter-in-large",h,["literal",a.sort(rl)]]:["filter-in-small",h,["literal",a]]}}function Pi(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function hn(h){return["!",h]}function zr(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let y="[";for(const T of h)y+=`${zr(T)},`;return`${y}]`}const u=Object.keys(h).sort();let g="{";for(let y=0;y<u.length;y++)g+=`${JSON.stringify(u[y])}:${zr(h[u[y]])},`;return`${g}}`}function nl(h){let a="";for(const u of Qt)a+=`/${zr(h[u])}`;return a}function ta(h){const a=h.value;return a?[new Ot(h.key,a,"constants have been deprecated as of v8")]:[]}function zn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Es(h){if(Array.isArray(h))return h.map(Es);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const u in h)a[u]=Es(h[u]);return a}return zn(h)}function Ps(h){const a=h.key,u=h.value,g=h.valueSpec||{},y=h.objectElementValidators||{},T=h.style,S=h.styleSpec,M=h.validateSpec;let R=[];const L=Pr(u);if(L!=="object")return[new Ot(a,u,`object expected, ${L} found`)];for(const F in u){const U=F.split(".")[0],q=Bu(g,U)||g["*"];let X;if(Bu(y,U))X=y[U];else if(Bu(g,U)){if(u[F]===void 0)continue;X=M}else if(y["*"])X=y["*"];else{if(!g["*"]){R.push(new Ot(a,u[F],`unknown property "${F}"`));continue}X=M}R=R.concat(X({key:(a&&`${a}.`)+F,value:u[F],valueSpec:q,style:T,styleSpec:S,object:u,objectKey:F,validateSpec:M},u))}for(const F in g)y[F]||g[F].required&&g[F].default===void 0&&u[F]===void 0&&R.push(new Ot(a,u,`missing required property "${F}"`));return R}function pf(h){const a=h.value,u=h.valueSpec,g=h.style,y=h.styleSpec,T=h.key,S=h.arrayElementValidator||h.validateSpec;if(Pr(a)!=="array")return[new Ot(T,a,`array expected, ${Pr(a)} found`)];if(u.length&&a.length!==u.length)return[new Ot(T,a,`array length ${u.length} expected, length ${a.length} found`)];let M={type:u.value,values:u.values};y.$version<7&&(M.function=u.function),Pr(u.value)==="object"&&(M=u.value);let R=[];for(let L=0;L<a.length;L++)R=R.concat(S({array:a,arrayIndex:L,value:a[L],valueSpec:M,validateSpec:h.validateSpec,style:g,styleSpec:y,key:`${T}[${L}]`}));return R}function Io(h){const a=h.key,u=h.value,g=h.valueSpec;let y=Pr(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Ot(a,u,`number expected, ${y} found`)]:"minimum"in g&&u<g.minimum?[new Ot(a,u,`${u} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&u>g.maximum?[new Ot(a,u,`${u} is greater than the maximum value ${g.maximum}`)]:[]}function Ro(h){const a=h.valueSpec,u=zn(h.value.type);let g,y,T,S={};const M=u!=="categorical"&&h.value.property===void 0,R=!M,L=Pr(h.value.stops)==="array"&&Pr(h.value.stops[0])==="array"&&Pr(h.value.stops[0][0])==="object",F=Ps({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new Ot(X.key,X.value,'identity function may not have a "stops" property')];let Q=[];const te=X.value;return Q=Q.concat(pf({key:X.key,value:te,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:U})),Pr(te)==="array"&&te.length===0&&Q.push(new Ot(X.key,te,"array must have at least one stop")),Q},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:a,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&M&&F.push(new Ot(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||F.push(new Ot(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Zu(h.valueSpec)&&F.push(new Ot(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(R&&!Ca(h.valueSpec)?F.push(new Ot(h.key,h.value,"property functions not supported")):M&&!$p(h.valueSpec)&&F.push(new Ot(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!L||h.value.property!==void 0||F.push(new Ot(h.key,h.value,'"property" property is required')),F;function U(X){let Q=[];const te=X.value,ae=X.key;if(Pr(te)!=="array")return[new Ot(ae,te,`array expected, ${Pr(te)} found`)];if(te.length!==2)return[new Ot(ae,te,`array length 2 expected, length ${te.length} found`)];if(L){if(Pr(te[0])!=="object")return[new Ot(ae,te,`object expected, ${Pr(te[0])} found`)];if(te[0].zoom===void 0)return[new Ot(ae,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new Ot(ae,te,"object stop key must have value")];if(T&&T>zn(te[0].zoom))return[new Ot(ae,te[0].zoom,"stop zoom values must appear in ascending order")];zn(te[0].zoom)!==T&&(T=zn(te[0].zoom),y=void 0,S={}),Q=Q.concat(Ps({key:`${ae}[0]`,value:te[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Io,value:q}}))}else Q=Q.concat(q({key:`${ae}[0]`,value:te[0],validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},te));return ql(Es(te[1]))?Q.concat([new Ot(`${ae}[1]`,te[1],"expressions are not allowed in function stops.")]):Q.concat(X.validateSpec({key:`${ae}[1]`,value:te[1],valueSpec:a,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function q(X,Q){const te=Pr(X.value),ae=zn(X.value),de=X.value!==null?X.value:Q;if(g){if(te!==g)return[new Ot(X.key,de,`${te} stop domain type must match previous stop domain type ${g}`)]}else g=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new Ot(X.key,de,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&u!=="categorical"){let Te=`number expected, ${te} found`;return Ca(a)&&u===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(X.key,de,Te)]}return u!=="categorical"||te!=="number"||isFinite(ae)&&Math.floor(ae)===ae?u!=="categorical"&&te==="number"&&y!==void 0&&ae<y?[new Ot(X.key,de,"stop domain values must appear in ascending order")]:(y=ae,u==="categorical"&&ae in S?[new Ot(X.key,de,"stop domain values must be unique")]:(S[ae]=!0,[])):[new Ot(X.key,de,`integer expected, found ${ae}`)]}}function Oo(h){const a=(h.expressionContext==="property"?Gl:Yu)(Es(h.value),h.valueSpec);if(a.result==="error")return a.value.map((g=>new Ot(`${h.key}${g.key}`,h.value,g.message)));const u=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new Ot(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!jc(u))return[new Ot(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!jc(u))return[new Ot(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Uc(u,["zoom","feature-state"]))return[new Ot(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!tl(u))return[new Ot(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function il(h){const a=h.key,u=h.value,g=Pr(u);return g!=="string"?[new Ot(a,u,`color expected, ${g} found`)]:Cr.parse(String(u))?[]:[new Ot(a,u,`color expected, "${u}" found`)]}function sl(h){const a=h.key,u=h.value,g=h.valueSpec,y=[];return Array.isArray(g.values)?g.values.indexOf(zn(u))===-1&&y.push(new Ot(a,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(zn(u))===-1&&y.push(new Ot(a,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Ma(h){return Co(Es(h.value))?Oo(Hr({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Do(h)}function Do(h){const a=h.value,u=h.key;if(Pr(a)!=="array")return[new Ot(u,a,`array expected, ${Pr(a)} found`)];const g=h.styleSpec;let y,T=[];if(a.length<1)return[new Ot(u,a,"filter array must have at least 1 element")];switch(T=T.concat(sl({key:`${u}[0]`,value:a[0],valueSpec:g.filter_operator,style:h.style,styleSpec:h.styleSpec})),zn(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&zn(a[1])==="$type"&&T.push(new Ot(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&T.push(new Ot(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=Pr(a[1]),y!=="string"&&T.push(new Ot(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let S=2;S<a.length;S++)y=Pr(a[S]),zn(a[1])==="$type"?T=T.concat(sl({key:`${u}[${S}]`,value:a[S],valueSpec:g.geometry_type,style:h.style,styleSpec:h.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&T.push(new Ot(`${u}[${S}]`,a[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)T=T.concat(Do({key:`${u}[${S}]`,value:a[S],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":y=Pr(a[1]),a.length!==2?T.push(new Ot(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&T.push(new Ot(`${u}[1]`,a[1],`string expected, ${y} found`))}return T}function al(h,a){const u=h.key,g=h.validateSpec,y=h.style,T=h.styleSpec,S=h.value,M=h.objectKey,R=T[`${a}_${h.layerType}`];if(!R)return[];const L=M.match(/^(.*)-transition$/);if(a==="paint"&&L&&R[L[1]]&&R[L[1]].transition)return g({key:u,value:S,valueSpec:T.transition,style:y,styleSpec:T});const F=h.valueSpec||R[M];if(!F)return[new Ot(u,S,`unknown property "${M}"`)];let U;if(Pr(S)==="string"&&Ca(F)&&!F.tokens&&(U=/^{([^}]+)}$/.exec(S)))return[new Ot(u,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const q=[];return h.layerType==="symbol"&&M==="text-font"&&Pd(Es(S))&&zn(S.type)==="identity"&&q.push(new Ot(u,S,'"text-font" does not support identity functions')),q.concat(g({key:h.key,value:S,valueSpec:F,style:y,styleSpec:T,expressionContext:"property",propertyType:a,propertyKey:M}))}function ko(h){return al(h,"paint")}function Rd(h){return al(h,"layout")}function Od(h){let a=[];const u=h.value,g=h.key,y=h.style,T=h.styleSpec;if(Pr(u)!=="object")return[new Ot(g,u,`object expected, ${Pr(u)} found`)];u.type||u.ref||a.push(new Ot(g,u,'either "type" or "ref" is required'));let S=zn(u.type);const M=zn(u.ref);if(u.id){const R=zn(u.id);for(let L=0;L<h.arrayIndex;L++){const F=y.layers[L];zn(F.id)===R&&a.push(new Ot(g,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach((L=>{L in u&&a.push(new Ot(g,u[L],`"${L}" is prohibited for ref layers`))})),y.layers.forEach((L=>{zn(L.id)===M&&(R=L)})),R?R.ref?a.push(new Ot(g,u.ref,"ref cannot reference another ref layer")):S=zn(R.type):a.push(new Ot(g,u.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(u.source){const R=y.sources&&y.sources[u.source],L=R&&zn(R.type);R?L==="vector"&&S==="raster"?a.push(new Ot(g,u.source,`layer "${u.id}" requires a raster source`)):L!=="raster-dem"&&S==="hillshade"||L!=="raster-dem"&&S==="color-relief"?a.push(new Ot(g,u.source,`layer "${u.id}" requires a raster-dem source`)):L==="raster"&&S!=="raster"?a.push(new Ot(g,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&S!=="hillshade"&&S!=="color-relief"?a.push(new Ot(g,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):S!=="line"||!u.paint||!u.paint["line-gradient"]||L==="geojson"&&R.lineMetrics||a.push(new Ot(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new Ot(g,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new Ot(g,u.source,`source "${u.source}" not found`))}else a.push(new Ot(g,u,'missing required property "source"'));return a=a.concat(Ps({key:g,value:u,valueSpec:T.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${g}.type`,value:u.type,valueSpec:T.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:Ma,layout:R=>Ps({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":L=>Rd(Hr({layerType:S},L))}}),paint:R=>Ps({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":L=>ko(Hr({layerType:S},L))}})}})),a}function ra(h){const a=h.value,u=h.key,g=Pr(a);return g!=="string"?[new Ot(u,a,`string expected, ${g} found`)]:[]}const Qu={promoteId:function({key:h,value:a}){if(Pr(a)==="string")return ra({key:h,value:a});{const u=[];for(const g in a)u.push(...ra({key:`${h}.${g}`,value:a[g]}));return u}}};function ol(h){const a=h.value,u=h.key,g=h.styleSpec,y=h.style,T=h.validateSpec;if(!a.type)return[new Ot(u,a,'"type" is required')];const S=zn(a.type);let M;switch(S){case"vector":case"raster":return M=Ps({key:u,value:a,valueSpec:g[`source_${S.replace("-","_")}`],style:h.style,styleSpec:g,objectElementValidators:Qu,validateSpec:T}),M;case"raster-dem":return M=(function(R){var L;const F=(L=R.sourceName)!==null&&L!==void 0?L:"",U=R.value,q=R.styleSpec,X=q.source_raster_dem,Q=R.style;let te=[];const ae=Pr(U);if(U===void 0)return te;if(ae!=="object")return te.push(new Ot("source_raster_dem",U,`object expected, ${ae} found`)),te;const de=zn(U.encoding)==="custom",Te=["redFactor","greenFactor","blueFactor","baseShift"],he=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const ve in U)!de&&Te.includes(ve)?te.push(new Ot(ve,U[ve],`In "${F}": "${ve}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):X[ve]?te=te.concat(R.validateSpec({key:ve,value:U[ve],valueSpec:X[ve],validateSpec:R.validateSpec,style:Q,styleSpec:q})):te.push(new Ot(ve,U[ve],`unknown property "${ve}"`));return te})({sourceName:u,value:a,style:h.style,styleSpec:g,validateSpec:T}),M;case"geojson":if(M=Ps({key:u,value:a,valueSpec:g.source_geojson,style:y,styleSpec:g,validateSpec:T,objectElementValidators:Qu}),a.cluster)for(const R in a.clusterProperties){const[L,F]=a.clusterProperties[R],U=typeof L=="string"?[L,["accumulated"],["get",R]]:L;M.push(...Oo({key:`${u}.${R}.map`,value:F,expressionContext:"cluster-map"})),M.push(...Oo({key:`${u}.${R}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return M;case"video":return Ps({key:u,value:a,valueSpec:g.source_video,style:y,validateSpec:T,styleSpec:g});case"image":return Ps({key:u,value:a,valueSpec:g.source_image,style:y,validateSpec:T,styleSpec:g});case"canvas":return[new Ot(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sl({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function li(h){const a=h.value,u=h.styleSpec,g=u.light,y=h.style;let T=[];const S=Pr(a);if(a===void 0)return T;if(S!=="object")return T=T.concat([new Ot("light",a,`object expected, ${S} found`)]),T;for(const M in a){const R=M.match(/^(.*)-transition$/);T=T.concat(R&&g[R[1]]&&g[R[1]].transition?h.validateSpec({key:M,value:a[M],valueSpec:u.transition,validateSpec:h.validateSpec,style:y,styleSpec:u}):g[M]?h.validateSpec({key:M,value:a[M],valueSpec:g[M],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Ot(M,a[M],`unknown property "${M}"`)])}return T}function gf(h){const a=h.value,u=h.styleSpec,g=u.sky,y=h.style,T=Pr(a);if(a===void 0)return[];if(T!=="object")return[new Ot("sky",a,`object expected, ${T} found`)];let S=[];for(const M in a)S=S.concat(g[M]?h.validateSpec({key:M,value:a[M],valueSpec:g[M],style:y,styleSpec:u}):[new Ot(M,a[M],`unknown property "${M}"`)]);return S}function Dd(h){const a=h.value,u=h.styleSpec,g=u.terrain,y=h.style;let T=[];const S=Pr(a);if(a===void 0)return T;if(S!=="object")return T=T.concat([new Ot("terrain",a,`object expected, ${S} found`)]),T;for(const M in a)T=T.concat(g[M]?h.validateSpec({key:M,value:a[M],valueSpec:g[M],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Ot(M,a[M],`unknown property "${M}"`)]);return T}function Xp(h){let a=[];const u=h.value,g=h.key;if(Array.isArray(u)){const y=[],T=[];for(const S in u)u[S].id&&y.includes(u[S].id)&&a.push(new Ot(g,u,`all the sprites' ids must be unique, but ${u[S].id} is duplicated`)),y.push(u[S].id),u[S].url&&T.includes(u[S].url)&&a.push(new Ot(g,u,`all the sprites' URLs must be unique, but ${u[S].url} is duplicated`)),T.push(u[S].url),a=a.concat(Ps({key:`${g}[${S}]`,value:u[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return ra({key:g,value:u})}function Gm(h){return!!h&&h.constructor===Object}function Gp(h){return Gm(h.value)?[]:[new Ot(h.key,h.value,`object expected, ${Pr(h.value)} found`)]}const ti={"*":()=>[],array:pf,boolean:function(h){const a=h.value,u=h.key,g=Pr(a);return g!=="boolean"?[new Ot(u,a,`boolean expected, ${g} found`)]:[]},number:Io,color:il,constants:ta,enum:sl,filter:Ma,function:Ro,layer:Od,object:Ps,source:ol,light:li,sky:gf,terrain:Dd,projection:function(h){const a=h.value,u=h.styleSpec,g=u.projection,y=h.style,T=Pr(a);if(a===void 0)return[];if(T!=="object")return[new Ot("projection",a,`object expected, ${T} found`)];let S=[];for(const M in a)S=S.concat(g[M]?h.validateSpec({key:M,value:a[M],valueSpec:g[M],style:y,styleSpec:u}):[new Ot(M,a[M],`unknown property "${M}"`)]);return S},projectionDefinition:function(h){const a=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const g=Pr(u);return g!=="array"||(function(y){return Array.isArray(y)&&y.length===3&&typeof y[0]=="string"&&typeof y[1]=="string"&&typeof y[2]=="number"})(u)||(function(y){return!!["interpolate","step","literal"].includes(y[0])})(u)?["array","string"].includes(g)?[]:[new Ot(a,u,`projection expected, invalid type "${g}" found`)]:[new Ot(a,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:ra,formatted:function(h){return ra(h).length===0?[]:Oo(h)},resolvedImage:function(h){return ra(h).length===0?[]:Oo(h)},padding:function(h){const a=h.key,u=h.value;if(Pr(u)==="array"){if(u.length<1||u.length>4)return[new Ot(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const g={type:"number"};let y=[];for(let T=0;T<u.length;T++)y=y.concat(h.validateSpec({key:`${a}[${T}]`,value:u[T],validateSpec:h.validateSpec,valueSpec:g}));return y}return Io({key:a,value:u,valueSpec:{}})},numberArray:function(h){const a=h.key,u=h.value;if(Pr(u)==="array"){const g={type:"number"};if(u.length<1)return[new Ot(a,u,"array length at least 1 expected, length 0 found")];let y=[];for(let T=0;T<u.length;T++)y=y.concat(h.validateSpec({key:`${a}[${T}]`,value:u[T],validateSpec:h.validateSpec,valueSpec:g}));return y}return Io({key:a,value:u,valueSpec:{}})},colorArray:function(h){const a=h.key,u=h.value;if(Pr(u)==="array"){if(u.length<1)return[new Ot(a,u,"array length at least 1 expected, length 0 found")];let g=[];for(let y=0;y<u.length;y++)g=g.concat(il({key:`${a}[${y}]`,value:u[y]}));return g}return il({key:a,value:u})},variableAnchorOffsetCollection:function(h){const a=h.key,u=h.value,g=Pr(u),y=h.styleSpec;if(g!=="array"||u.length<1||u.length%2!=0)return[new Ot(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let S=0;S<u.length;S+=2)T=T.concat(sl({key:`${a}[${S}]`,value:u[S],valueSpec:y.layout_symbol["text-anchor"]})),T=T.concat(pf({key:`${a}[${S+1}]`,value:u[S+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:y}));return T},sprite:Xp,state:Gp,fontFaces:function(h){const a=h.key,u=h.value,g=h.validateSpec,y=h.styleSpec,T=h.style;if(!Gm(u))return[new Ot(a,u,`object expected, ${Pr(u)} found`)];const S=[];for(const M in u){const R=u[M],L=Pr(R);if(L==="string")S.push(...ra({key:`${a}.${M}`,value:R}));else if(L==="array"){const F={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[U,q]of R.entries())S.push(...Ps({key:`${a}.${M}[${U}]`,value:q,valueSpec:F,styleSpec:y,style:T,validateSpec:g}))}else S.push(new Ot(`${a}.${M}`,R,`string or array expected, ${L} found`))}return S}};function Lo(h){const a=h.value,u=h.valueSpec,g=h.styleSpec;return h.validateSpec=Lo,u.expression&&Pd(zn(a))?Ro(h):u.expression&&ql(Es(a))?Oo(h):u.type&&ti[u.type]?ti[u.type](h):Ps(Hr({},h,{valueSpec:u.type?g[u.type]:u}))}function Ju(h){const a=h.value,u=h.key,g=ra(h);return g.length||(a.indexOf("{fontstack}")===-1&&g.push(new Ot(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&g.push(new Ot(u,a,'"glyphs" url must include a "{range}" token'))),g}function Gi(h,a=Le){let u=[];return u=u.concat(Lo({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Lo,objectElementValidators:{glyphs:Ju,"*":()=>[]}})),h.constants&&(u=u.concat(ta({key:"constants",value:h.constants}))),Wc(u)}function na(h){return function(a){return h(Object.assign({},a,{validateSpec:Lo}))}}function Wc(h){return[].concat(h).sort(((a,u)=>a.line-u.line))}function Zi(h){return function(...a){return Wc(h.apply(this,a))}}Gi.source=Zi(na(ol)),Gi.sprite=Zi(na(Xp)),Gi.glyphs=Zi(na(Ju)),Gi.light=Zi(na(li)),Gi.sky=Zi(na(gf)),Gi.terrain=Zi(na(Dd)),Gi.state=Zi(na(Gp)),Gi.layer=Zi(na(Od)),Gi.filter=Zi(na(Ma)),Gi.paintProperty=Zi(na(ko)),Gi.layoutProperty=Zi(na(Rd));const ov={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class eh{constructor(a,u){this._globalState=u,this.setValue(a)}evaluate(){var a;return(a=this._literalValue)!==null&&a!==void 0?a:this._compiledValue.evaluate({})}setValue(a){if(a==null||a==="visible"||a==="none")return this._literalValue=a==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const u=Yu(a,ov,this._globalState);if(u.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(u.value.map((g=>`${g.key}: ${g.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=u.value,this._globalStateRefs=wi(u.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const mf=Le,Ti=Gi,Ja=Ti.light,kd=Ti.sky,Ld=Ti.paintProperty,Zm=Ti.layoutProperty;function eo(h,a){let u=!1;if(a&&a.length)for(const g of a)h.fire(new Ct(new Error(g.message))),u=!0;return u}class Yl{constructor(a,u,g){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const S=new Int32Array(this.arrayBuffer);a=S[0],this.d=(u=S[1])+2*(g=S[2]);for(let R=0;R<this.d*this.d;R++){const L=S[3+R],F=S[3+R+1];y.push(L===F?null:S.subarray(L,F))}const M=S[3+y.length+1];this.keys=S.subarray(S[3+y.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*g;for(let S=0;S<this.d*this.d;S++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=g,this.scale=u/a,this.uid=0;const T=g/u*a;this.min=-T,this.max=a+T}insert(a,u,g,y,T){this._forEachCell(u,g,y,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,g,y,T,S){this.cells[T].push(S)}query(a,u,g,y,T){const S=this.min,M=this.max;if(a<=S&&u<=S&&M<=g&&M<=y&&!T)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,u,g,y,this._queryCell,R,{},T),R}}_queryCell(a,u,g,y,T,S,M,R){const L=this.cells[T];if(L!==null){const F=this.keys,U=this.bboxes;for(let q=0;q<L.length;q++){const X=L[q];if(M[X]===void 0){const Q=4*X;(R?R(U[Q+0],U[Q+1],U[Q+2],U[Q+3]):a<=U[Q+2]&&u<=U[Q+3]&&g>=U[Q+0]&&y>=U[Q+1])?(M[X]=!0,S.push(F[X])):M[X]=!1}}}}_forEachCell(a,u,g,y,T,S,M,R){const L=this._convertToCellCoord(a),F=this._convertToCellCoord(u),U=this._convertToCellCoord(g),q=this._convertToCellCoord(y);for(let X=L;X<=U;X++)for(let Q=F;Q<=q;Q++){const te=this.d*Q+X;if((!R||R(this._convertFromCellCoord(X),this._convertFromCellCoord(Q),this._convertFromCellCoord(X+1),this._convertFromCellCoord(Q+1)))&&T.call(this,a,u,g,y,te,S,M,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let g=0;for(let S=0;S<this.cells.length;S++)g+=this.cells[S].length;const y=new Int32Array(u+g+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let T=u;for(let S=0;S<a.length;S++){const M=a[S];y[3+S]=T,y.set(M,T),T+=M.length}return y[3+a.length]=T,y.set(this.keys,T),T+=this.keys.length,y[3+a.length+1]=T,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer}static serialize(a,u){const g=a.toArrayBuffer();return u&&u.push(g),{buffer:g}}static deserialize(a){return new Yl(a.buffer)}}const Cs={};function Ht(h,a,u={}){if(Cs[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),Cs[h]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}Ht("Object",Object),Ht("Set",Set),Ht("TransferableGridIndex",Yl),Ht("Color",Cr),Ht("Error",Error),Ht("AJAXError",oe),Ht("ResolvedImage",as),Ht("StylePropertyFunction",Vc),Ht("StyleExpression",Id,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Xl),Ht("ZoomConstantExpression",hs),Ht("CompoundExpression",Ks,{omit:["_evaluate"]});for(const h in Gu)Gu[h]._classRegistryKey||Ht(`Expression_${h}`,Gu[h]);function _f(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Nd(h){return h.$name||h.constructor._classRegistryKey}function Ia(h){return!(function(a){if(a===null||typeof a!="object")return!1;const u=Nd(a);return!(!u||u==="Object")})(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||_f(h)||qs(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function to(h,a){if(Ia(h))return(_f(h)||qs(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const T=[];for(const S of h)T.push(to(S,a));return T}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=Nd(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!Cs[u])throw new Error(`${u} is not registered.`);const{klass:g}=Cs[u],y=g.serialize?g.serialize(h,a):{};if(g.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in h){if(!h.hasOwnProperty(T)||Cs[u].omit.indexOf(T)>=0)continue;const S=h[T];y[T]=Cs[u].shallow.indexOf(T)>=0?S:to(S,a)}h instanceof Error&&(y.message=h.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(y.$name=u),y}function th(h){if(Ia(h))return h;if(Array.isArray(h))return h.map(th);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=Nd(h)||"Object";if(!Cs[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=Cs[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(h);const g=Object.create(u.prototype);for(const y of Object.keys(h)){if(y==="$name")continue;const T=h[y];g[y]=Cs[a].shallow.indexOf(y)>=0?T:th(T)}return g}class zd{constructor(){this.first=!0}update(a,u){const g=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=g,!0))}}function No(h){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function Hc(h){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function yf(h){return/\s/u.test(String.fromCodePoint(h))}function zo(h){for(const a of h)if(Hc(a.codePointAt(0)))return!0;return!1}function Bd(h){for(const a of h)if(!Zp(a.codePointAt(0)))return!1;return!0}function vf(h){const a=h.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}})).filter((u=>u));return new RegExp(a.join("|"),"u")}const Bo=vf(["Arab","Dupl","Mong","Ougr","Syrc"]);function Zp(h){return!Bo.test(String.fromCodePoint(h))}function Fo(h){return!(Hc(h)||(a=h,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(a))));var a}const Fd=vf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function bf(h){return Fd.test(String.fromCodePoint(h))}function jo(h,a){return!(!a&&bf(h)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(h)))}function ll(h){for(const a of h)if(bf(a.codePointAt(0)))return!0;return!1}const Ra=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(Ra.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,a){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,g=new Promise((T=>{this.loadScriptResolve=T}));a(u);const y=new Promise((T=>setTimeout((()=>T()),this.TIMEOUT)));if(yield Promise.race([g,y]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:u};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}};class tn{constructor(a,u){this.isSupportedScript=Yp,this.zoom=a,u?(this.now=u.now||0,this.fadeDuration=u.fadeDuration||0,this.zoomHistory=u.zoomHistory||new zd,this.transition=u.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zd,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),g=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*u}}}function Yp(h){return(function(a,u){for(const g of a)if(!jo(g.codePointAt(0),u))return!1;return!0})(h,Ra.getRTLTextPluginStatus()==="loaded")}const cl="-transition";class Kl{constructor(a,u,g){this.property=a,this.value=u,this.expression=(function(y,T,S){if(Pd(y))return new Vc(y,T);if(ql(y)){const M=Gl(y,T,S);if(M.result==="error")throw new Error(M.value.map((R=>`${R.key}: ${R.message}`)).join(", "));return M.value}{let M=y;return T.type==="color"&&typeof y=="string"?M=Cr.parse(y):T.type!=="padding"||typeof y!="number"&&!Array.isArray(y)?T.type!=="numberArray"||typeof y!="number"&&!Array.isArray(y)?T.type!=="colorArray"||typeof y!="string"&&!Array.isArray(y)?T.type==="variableAnchorOffsetCollection"&&Array.isArray(y)?M=qn.parse(y):T.type==="projectionDefinition"&&typeof y=="string"&&(M=xi.parse(y)):M=pr.parse(y):M=Cn.parse(y):M=oi.parse(y),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>M}}})(u===void 0?a.specification.default:u,a.specification,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(a,u,g){return this.property.possiblyEvaluate(this,a,u,g)}}class xf{constructor(a,u){this.property=a,this.value=new Kl(a,void 0,u)}transitioned(a,u){return new qc(this.property,this.value,u,nr({},a.transition,this.transition),a.now)}untransitioned(){return new qc(this.property,this.value,null,{},0)}}class jd{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._globalState=u}getValue(a){return Rt(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new xf(this._values[a].property,this._globalState)),this._values[a].value=new Kl(this._values[a].property,u===null?void 0:Rt(u),this._globalState)}getTransition(a){return Rt(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new xf(this._values[a].property,this._globalState)),this._values[a].transition=Rt(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(a[u]=g);const y=this.getTransition(u);y!==void 0&&(a[`${u}${cl}`]=y)}return a}transitioned(a,u){const g=new wf(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].transitioned(a,u._values[y]);return g}untransitioned(){const a=new wf(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class qc{constructor(a,u,g,y,T){this.property=a,this.value=u,this.begin=T+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=g)}possiblyEvaluate(a,u,g){const y=a.now||0,T=this.value.possiblyEvaluate(a,u,g),S=this.prior;if(S){if(y>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(y<this.begin)return S.possiblyEvaluate(a,u,g);{const M=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,u,g),T,lt(M))}}return T}}class wf{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,g){const y=new Xc(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(a,u,g);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Kp{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._globalState=u}hasValue(a){return this._values[a].value!==void 0}getValue(a){return Rt(this._values[a].value)}setValue(a,u){this._values[a]=new Kl(this._values[a].property,u===null?void 0:Rt(u),this._globalState)}serialize(){const a={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(a[u]=g)}return a}possiblyEvaluate(a,u,g){const y=new Xc(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(a,u,g);return y}}class ia{constructor(a,u,g){this.property=a,this.value=u,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,g,y){return this.property.evaluate(this.value,this.parameters,a,u,g,y)}}class Xc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class qt{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,g){const y=In[this.specification.type];return y?y(a,u,g):a}}class er{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,g,y){return new ia(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},g,y)}:a.expression,u)}interpolate(a,u,g){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new ia(this,{kind:"constant",value:void 0},a.parameters);const y=In[this.specification.type];if(y){const T=y(a.value.value,u.value.value,g);return new ia(this,{kind:"constant",value:T},a.parameters)}return a}evaluate(a,u,g,y,T,S){return a.kind==="constant"?a.value:a.evaluate(u,g,y,T,S)}}class Oa extends er{possiblyEvaluate(a,u,g,y){if(a.value===void 0)return new ia(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const T=a.expression.evaluate(u,null,{},g,y),S=a.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,M=this._calculate(S,S,S,u);return new ia(this,{kind:"constant",value:M},u)}if(a.expression.kind==="camera"){const T=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new ia(this,{kind:"constant",value:T},u)}return new ia(this,a.expression,u)}evaluate(a,u,g,y,T,S){if(a.kind==="source"){const M=a.evaluate(u,g,y,T,S);return this._calculate(M,M,M,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},g,y),a.evaluate({zoom:Math.floor(u.zoom)},g,y),a.evaluate({zoom:Math.floor(u.zoom)+1},g,y),u):a.value}_calculate(a,u,g,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:g,to:u}}interpolate(a){return a}}class rh{constructor(a){this.specification=a}possiblyEvaluate(a,u,g,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const T=a.expression.evaluate(u,null,{},g,y);return this._calculate(T,T,T,u)}return this._calculate(a.expression.evaluate(new tn(Math.floor(u.zoom-1),u)),a.expression.evaluate(new tn(Math.floor(u.zoom),u)),a.expression.evaluate(new tn(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,g,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:g,to:u}}interpolate(a){return a}}class Tf{constructor(a){this.specification=a}possiblyEvaluate(a,u,g,y){return!!a.expression.evaluate(u,null,{},g,y)}interpolate(){return!1}}class ri{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const g=a[u];g.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new Kl(g,void 0,void 0),T=this.defaultTransitionablePropertyValues[u]=new xf(g,void 0);this.defaultTransitioningPropertyValues[u]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}Ht("DataDrivenProperty",er),Ht("DataConstantProperty",qt),Ht("CrossFadedDataDrivenProperty",Oa),Ht("CrossFadedProperty",rh),Ht("ColorRampProperty",Tf);class Bn extends mt{constructor(a,u,g){if(super(),this.id=a.id,this.type=a.type,this._globalState=g,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(y,T){return new eh(y,T)})(this.visibility,g),a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter,this._featureFilter=As(a.filter,g)),u.layout&&(this._unevaluatedLayout=new Kp(u.layout,g)),u.paint)){this._transitionablePaint=new jd(u.paint,g);for(const y in a.paint)this.setPaintProperty(y,a.paint[y],{validate:!1});for(const y in a.layout)this.setLayoutProperty(y,a.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xc(u.paint)}}setFilter(a){this.filter=a,this._featureFilter=As(a,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}getLayoutAffectingGlobalStateRefs(){const a=new Set;for(const u of this._visibilityExpression.getGlobalStateRefs())a.add(u);if(this._unevaluatedLayout)for(const u in this._unevaluatedLayout._values){const g=this._unevaluatedLayout._values[u];for(const y of g.getGlobalStateRefs())a.add(y)}for(const u of this._featureFilter.getGlobalStateRefs())a.add(u);return a}getPaintAffectingGlobalStateRefs(){var a;const u=new globalThis.Map;if(this._transitionablePaint)for(const g in this._transitionablePaint._values){const y=this._transitionablePaint._values[g].value;for(const T of y.getGlobalStateRefs()){const S=(a=u.get(T))!==null&&a!==void 0?a:[];S.push({name:g,value:y.value}),u.set(T,S)}}return u}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(a,u,g={}){if(u==null||!this._validate(Zm,`layers.${this.id}.layout.${a}`,a,u,g))return a==="visibility"?(this.visibility=u,this._visibilityExpression.setValue(u),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(a,u)}getPaintProperty(a){return a.endsWith(cl)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,g={}){if(u!=null&&this._validate(Ld,`layers.${this.id}.paint.${a}`,a,u,g))return!1;if(a.endsWith(cl))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],T=y.property.specification["property-type"]==="cross-faded-data-driven",S=y.value.isDataDriven(),M=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||S||T||this._handleOverridablePaintPropertyUpdate(a,M,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,g){return!1}isHidden(a=this.minzoom,u=!1){return!!(this.minzoom&&a<(u?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&a>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Tr(a,((u,g)=>!(u===void 0||g==="layout"&&!Object.keys(u).length||g==="paint"&&!Object.keys(u).length)))}_validate(a,u,g,y,T={}){return(!T||T.validate!==!1)&&eo(this,a.call(Ti,{key:u,layerType:this.type,objectKey:g,value:y,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof ia&&Ca(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}let Gn;var Sf={get paint(){return Gn=Gn||new ri({"raster-opacity":new qt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new qt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new qt(Le.paint_raster["raster-saturation"]),"raster-contrast":new qt(Le.paint_raster["raster-contrast"]),"raster-resampling":new qt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new qt(Le.paint_raster["raster-fade-duration"])})}};class ul extends Bn{constructor(a,u){super(a,Sf,u)}}const Dr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kr{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Rn(h,a=1){let u=0,g=0;return{members:h.map((y=>{const T=Dr[y.type].BYTES_PER_ELEMENT,S=u=Da(u,Math.max(a,T)),M=y.components||1;return g=Math.max(g,T),u+=T*M,{name:y.name,type:y.type,components:M,offset:S}})),size:Da(u,Math.max(g,a)),alignment:a}}function Da(h,a){return Math.ceil(h/a)*a}class ro extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const g=this.length;return this.resize(g+1),this.emplace(g,a,u)}emplace(a,u,g){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=g,a}}ro.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",ro);class Gc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,g)}emplace(a,u,g,y){const T=3*a;return this.int16[T+0]=u,this.int16[T+1]=g,this.int16[T+2]=y,a}}Gc.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",Gc);class Zc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,g,y)}emplace(a,u,g,y,T){const S=4*a;return this.int16[S+0]=u,this.int16[S+1]=g,this.int16[S+2]=y,this.int16[S+3]=T,a}}Zc.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",Zc);class hl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,u,g,y,T,S)}emplace(a,u,g,y,T,S,M){const R=6*a;return this.int16[R+0]=u,this.int16[R+1]=g,this.int16[R+2]=y,this.int16[R+3]=T,this.int16[R+4]=S,this.int16[R+5]=M,a}}hl.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",hl);class Qp extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,u,g,y,T,S)}emplace(a,u,g,y,T,S,M){const R=4*a,L=8*a;return this.int16[R+0]=u,this.int16[R+1]=g,this.uint8[L+4]=y,this.uint8[L+5]=T,this.uint8[L+6]=S,this.uint8[L+7]=M,a}}Qp.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",Qp);class wn extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const g=this.length;return this.resize(g+1),this.emplace(g,a,u)}emplace(a,u,g){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=g,a}}wn.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",wn);class no extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R,L,F){const U=this.length;return this.resize(U+1),this.emplace(U,a,u,g,y,T,S,M,R,L,F)}emplace(a,u,g,y,T,S,M,R,L,F,U){const q=10*a;return this.uint16[q+0]=u,this.uint16[q+1]=g,this.uint16[q+2]=y,this.uint16[q+3]=T,this.uint16[q+4]=S,this.uint16[q+5]=M,this.uint16[q+6]=R,this.uint16[q+7]=L,this.uint16[q+8]=F,this.uint16[q+9]=U,a}}no.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",no);class nh extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R){const L=this.length;return this.resize(L+1),this.emplace(L,a,u,g,y,T,S,M,R)}emplace(a,u,g,y,T,S,M,R,L){const F=8*a;return this.uint16[F+0]=u,this.uint16[F+1]=g,this.uint16[F+2]=y,this.uint16[F+3]=T,this.uint16[F+4]=S,this.uint16[F+5]=M,this.uint16[F+6]=R,this.uint16[F+7]=L,a}}nh.prototype.bytesPerElement=16,Ht("StructArrayLayout8ui16",nh);class ih extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R,L,F,U,q){const X=this.length;return this.resize(X+1),this.emplace(X,a,u,g,y,T,S,M,R,L,F,U,q)}emplace(a,u,g,y,T,S,M,R,L,F,U,q,X){const Q=12*a;return this.int16[Q+0]=u,this.int16[Q+1]=g,this.int16[Q+2]=y,this.int16[Q+3]=T,this.uint16[Q+4]=S,this.uint16[Q+5]=M,this.uint16[Q+6]=R,this.uint16[Q+7]=L,this.int16[Q+8]=F,this.int16[Q+9]=U,this.int16[Q+10]=q,this.int16[Q+11]=X,a}}ih.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",ih);class Af extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,g){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,g)}emplace(a,u,g,y){const T=3*a;return this.float32[T+0]=u,this.float32[T+1]=g,this.float32[T+2]=y,a}}Af.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",Af);class Ef extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}Ef.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",Ef);class Pf extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R,L){const F=this.length;return this.resize(F+1),this.emplace(F,a,u,g,y,T,S,M,R,L)}emplace(a,u,g,y,T,S,M,R,L,F){const U=10*a,q=5*a;return this.int16[U+0]=u,this.int16[U+1]=g,this.int16[U+2]=y,this.int16[U+3]=T,this.int16[U+4]=S,this.int16[U+5]=M,this.uint32[q+3]=R,this.uint16[U+8]=L,this.uint16[U+9]=F,a}}Pf.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",Pf);class Ql extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,u,g,y,T,S)}emplace(a,u,g,y,T,S,M){const R=6*a;return this.int16[R+0]=u,this.int16[R+1]=g,this.int16[R+2]=y,this.int16[R+3]=T,this.int16[R+4]=S,this.int16[R+5]=M,a}}Ql.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",Ql);class fl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T){const S=this.length;return this.resize(S+1),this.emplace(S,a,u,g,y,T)}emplace(a,u,g,y,T,S){const M=4*a,R=8*a;return this.float32[M+0]=u,this.float32[M+1]=g,this.float32[M+2]=y,this.int16[R+6]=T,this.int16[R+7]=S,a}}fl.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",fl);class $i extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,u,g,y,T,S)}emplace(a,u,g,y,T,S,M){const R=16*a,L=4*a,F=8*a;return this.uint8[R+0]=u,this.uint8[R+1]=g,this.float32[L+1]=y,this.float32[L+2]=T,this.int16[F+6]=S,this.int16[F+7]=M,a}}$i.prototype.bytesPerElement=16,Ht("StructArrayLayout2ub2f2i16",$i);class On extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,g)}emplace(a,u,g,y){const T=3*a;return this.uint16[T+0]=u,this.uint16[T+1]=g,this.uint16[T+2]=y,a}}On.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",On);class Uo extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de){const Te=this.length;return this.resize(Te+1),this.emplace(Te,a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de)}emplace(a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de,Te){const he=24*a,ve=12*a,Oe=48*a;return this.int16[he+0]=u,this.int16[he+1]=g,this.uint16[he+2]=y,this.uint16[he+3]=T,this.uint32[ve+2]=S,this.uint32[ve+3]=M,this.uint32[ve+4]=R,this.uint16[he+10]=L,this.uint16[he+11]=F,this.uint16[he+12]=U,this.float32[ve+7]=q,this.float32[ve+8]=X,this.uint8[Oe+36]=Q,this.uint8[Oe+37]=te,this.uint8[Oe+38]=ae,this.uint32[ve+10]=de,this.int16[he+22]=Te,a}}Uo.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Uo);class Yc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de,Te,he,ve,Oe,Fe,it,vt,xt,It,Vt,kt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de,Te,he,ve,Oe,Fe,it,vt,xt,It,Vt,kt)}emplace(a,u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de,Te,he,ve,Oe,Fe,it,vt,xt,It,Vt,kt,wt){const pt=32*a,Gt=16*a;return this.int16[pt+0]=u,this.int16[pt+1]=g,this.int16[pt+2]=y,this.int16[pt+3]=T,this.int16[pt+4]=S,this.int16[pt+5]=M,this.int16[pt+6]=R,this.int16[pt+7]=L,this.uint16[pt+8]=F,this.uint16[pt+9]=U,this.uint16[pt+10]=q,this.uint16[pt+11]=X,this.uint16[pt+12]=Q,this.uint16[pt+13]=te,this.uint16[pt+14]=ae,this.uint16[pt+15]=de,this.uint16[pt+16]=Te,this.uint16[pt+17]=he,this.uint16[pt+18]=ve,this.uint16[pt+19]=Oe,this.uint16[pt+20]=Fe,this.uint16[pt+21]=it,this.uint16[pt+22]=vt,this.uint32[Gt+12]=xt,this.float32[Gt+13]=It,this.float32[Gt+14]=Vt,this.uint16[pt+30]=kt,this.uint16[pt+31]=wt,a}}Yc.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",Yc);class Kc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}Kc.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",Kc);class sh extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,g){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,g)}emplace(a,u,g,y){const T=3*a;return this.uint16[6*a+0]=u,this.float32[T+1]=g,this.float32[T+2]=y,a}}sh.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",sh);class io extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,g){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,g)}emplace(a,u,g,y){const T=4*a;return this.uint32[2*a+0]=u,this.uint16[T+2]=g,this.uint16[T+3]=y,a}}io.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",io);class A extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const g=this.length;return this.resize(g+1),this.emplace(g,a,u)}emplace(a,u,g){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=g,a}}A.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",A);class o extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}o.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",o);class d extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,g,y)}emplace(a,u,g,y,T){const S=4*a;return this.float32[S+0]=u,this.float32[S+1]=g,this.float32[S+2]=y,this.float32[S+3]=T,a}}d.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",d);class _ extends Kr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new m(this.anchorPointX,this.anchorPointY)}}_.prototype.size=20;class x extends Pf{get(a){return new _(this,a)}}Ht("CollisionBoxArray",x);class C extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}C.prototype.size=48;class I extends Uo{get(a){return new C(this,a)}}Ht("PlacedSymbolArray",I);class D extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}D.prototype.size=64;class z extends Yc{get(a){return new D(this,a)}}Ht("SymbolInstanceArray",z);class $ extends Kc{getoffsetX(a){return this.float32[1*a+0]}}Ht("GlyphOffsetArray",$);class H extends Gc{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Ht("SymbolLineVertexArray",H);class Z extends Kr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Z.prototype.size=12;class G extends sh{get(a){return new Z(this,a)}}Ht("TextAnchorOffsetArray",G);class ne extends Kr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ne.prototype.size=8;class le extends io{get(a){return new ne(this,a)}}Ht("FeatureIndexArray",le);class _e extends ro{}class xe extends ro{}class be extends ro{}class Ae extends hl{}class ke extends Qp{}class Se extends wn{}class De extends no{}class ze extends nh{}class Re extends ih{}class Ve extends Af{}class ct extends Ef{}class nt extends Ql{}class at extends $i{}class ot extends On{}class Ft extends A{}const Ut=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pt}=Ut;class $t{constructor(a=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=a}prepareSegment(a,u,g,y){const T=this.segments[this.segments.length-1];return a>$t.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${$t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${$t.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+a>$t.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==y?this.createNewSegment(u,g,y):T}createNewSegment(a,u,g){const y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(y.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(y),y}getOrCreateLatestSegment(a,u,g){return this.prepareSegment(0,a,u,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,g,y){return new $t([{vertexOffset:a,primitiveOffset:u,vertexLength:g,primitiveLength:y,vaos:{},sortKey:0}])}}function xr(h,a){return 256*(h=Xt(Math.floor(h),0,255))+Xt(Math.floor(a),0,255)}$t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",$t);const Qr=Rn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),_n=Rn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var fn,Tn,an,Fn={exports:{}},Sn={exports:{}},Ci={exports:{}},Zn=(function(){if(an)return Fn.exports;an=1;var h=(fn||(fn=1,Sn.exports=function(u,g){var y,T,S,M,R,L,F,U;for(T=u.length-(y=3&u.length),S=g,R=3432918353,L=461845907,U=0;U<T;)F=255&u.charCodeAt(U)|(255&u.charCodeAt(++U))<<8|(255&u.charCodeAt(++U))<<16|(255&u.charCodeAt(++U))<<24,++U,S=27492+(65535&(M=5*(65535&(S=(S^=F=(65535&(F=(F=(65535&F)*R+(((F>>>16)*R&65535)<<16)&4294967295)<<15|F>>>17))*L+(((F>>>16)*L&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(F=0,y){case 3:F^=(255&u.charCodeAt(U+2))<<16;case 2:F^=(255&u.charCodeAt(U+1))<<8;case 1:S^=F=(65535&(F=(F=(65535&(F^=255&u.charCodeAt(U)))*R+(((F>>>16)*R&65535)<<16)&4294967295)<<15|F>>>17))*L+(((F>>>16)*L&65535)<<16)&4294967295}return S^=u.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}),Sn.exports),a=(Tn||(Tn=1,Ci.exports=function(u,g){for(var y,T=u.length,S=g^T,M=0;T>=4;)y=1540483477*(65535&(y=255&u.charCodeAt(M)|(255&u.charCodeAt(++M))<<8|(255&u.charCodeAt(++M))<<16|(255&u.charCodeAt(++M))<<24))+((1540483477*(y>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),T-=4,++M;switch(T){case 3:S^=(255&u.charCodeAt(M+2))<<16;case 2:S^=(255&u.charCodeAt(M+1))<<8;case 1:S=1540483477*(65535&(S^=255&u.charCodeAt(M)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}),Ci.exports);return Fn.exports=h,Fn.exports.murmur3=h,Fn.exports.murmur2=a,Fn.exports})(),Yn=b(Zn);class Mi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,g,y){this.ids.push(Vo(a)),this.positions.push(u,g,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Vo(a);let g=0,y=this.ids.length-1;for(;g<y;){const S=g+y>>1;this.ids[S]>=u?y=S:g=S+1}const T=[];for(;this.ids[g]===u;)T.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return T}static serialize(a,u){const g=new Float64Array(a.ids),y=new Uint32Array(a.positions);return $o(g,y,0,g.length-1),u&&u.push(g.buffer,y.buffer),{ids:g,positions:y}}static deserialize(a){const u=new Mi;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function Vo(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Yn(String(h))}function $o(h,a,u,g){for(;u<g;){const y=h[u+g>>1];let T=u-1,S=g+1;for(;;){do T++;while(h[T]<y);do S--;while(h[S]>y);if(T>=S)break;so(h,T,S),so(a,3*T,3*S),so(a,3*T+1,3*S+1),so(a,3*T+2,3*S+2)}S-u<g-S?($o(h,a,u,S),u=S+1):($o(h,a,S+1,g),g=S)}}function so(h,a,u){const g=h[a];h[a]=h[u],h[u]=g}Ht("FeaturePositionMap",Mi);class Ms{constructor(a,u){this.gl=a.gl,this.location=u}}class Qc extends Ms{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ah extends Ms{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class ao extends Ms{constructor(a,u){super(a,u),this.current=Cr.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Is=new Float32Array(16);function sa(h){return[xr(255*h.r,255*h.g),xr(255*h.b,255*h.a)]}class ka{constructor(a,u,g){this.value=a,this.uniformNames=u.map((y=>`u_${y}`)),this.type=g}setUniform(a,u,g){a.set(g.constantOr(this.value))}getBinding(a,u,g){return this.type==="color"?new ao(a,u):new Qc(a,u)}}class La{constructor(a,u){this.uniformNames=u.map((g=>`u_${g}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setConstantDashPositions(a,u){this.dashTo=[0,a.y,a.height,a.width],this.dashFrom=[0,u.y,u.height,u.width]}setUniform(a,u,g,y){let T=null;y==="u_pattern_to"?T=this.patternTo:y==="u_pattern_from"?T=this.patternFrom:y==="u_dasharray_to"?T=this.dashTo:y==="u_dasharray_from"?T=this.dashFrom:y==="u_pixel_ratio_to"?T=this.pixelRatioTo:y==="u_pixel_ratio_from"&&(T=this.pixelRatioFrom),T!==null&&a.set(T)}getBinding(a,u,g){return g.substr(0,9)==="u_pattern"||g.substr(0,12)==="u_dasharray_"?new ah(a,u):new Qc(a,u)}}class rn{constructor(a,u,g,y){this.expression=a,this.type=g,this.maxValue=0,this.paintVertexAttributes=u.map((T=>({name:`a_${T}`,type:"Float32",components:g==="color"?2:1,offset:0}))),this.paintVertexArray=new y}populatePaintArray(a,u,g){const y=this.paintVertexArray.length,T=this.expression.evaluate(new tn(0,g),u,{},g.canonical,[],g.formattedSection);this.paintVertexArray.resize(a),this._setPaintValue(y,a,T)}updatePaintArray(a,u,g,y,T){const S=this.expression.evaluate(new tn(0,T),g,y);this._setPaintValue(a,u,S)}_setPaintValue(a,u,g){if(this.type==="color"){const y=sa(g);for(let T=a;T<u;T++)this.paintVertexArray.emplace(T,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dn{constructor(a,u,g,y,T,S){this.expression=a,this.uniformNames=u.map((M=>`u_${M}_t`)),this.type=g,this.useIntegerZoom=y,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=u.map((M=>({name:`a_${M}`,type:"Float32",components:g==="color"?4:2,offset:0}))),this.paintVertexArray=new S}populatePaintArray(a,u,g){const y=this.expression.evaluate(new tn(this.zoom,g),u,{},g.canonical,[],g.formattedSection),T=this.expression.evaluate(new tn(this.zoom+1,g),u,{},g.canonical,[],g.formattedSection),S=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(S,a,y,T)}updatePaintArray(a,u,g,y,T){const S=this.expression.evaluate(new tn(this.zoom,T),g,y),M=this.expression.evaluate(new tn(this.zoom+1,T),g,y);this._setPaintValue(a,u,S,M)}_setPaintValue(a,u,g,y){if(this.type==="color"){const T=sa(g),S=sa(y);for(let M=a;M<u;M++)this.paintVertexArray.emplace(M,T[0],T[1],S[0],S[1])}else{for(let T=a;T<u;T++)this.paintVertexArray.emplace(T,g,y);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=Xt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,g){return new Qc(a,u)}}class ci{constructor(a,u,g,y,T,S){this.expression=a,this.type=u,this.useIntegerZoom=g,this.zoom=y,this.layerId=S,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(a,u,g){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,this.getPositionIds(u),g)}updatePaintArray(a,u,g,y,T){this._setPaintValues(a,u,this.getPositionIds(g),T)}_setPaintValues(a,u,g,y){const T=this.getPositions(y);if(!T||!g)return;const S=T[g.min],M=T[g.mid],R=T[g.max];if(S&&M&&R)for(let L=a;L<u;L++)this.emplace(this.zoomInPaintVertexArray,L,M,S),this.emplace(this.zoomOutPaintVertexArray,L,M,R)}upload(a){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const u=this.getVertexAttributes();this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,u,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,u,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class pi extends ci{getPositions(a){return a.imagePositions}getPositionIds(a){return a.patterns&&a.patterns[this.layerId]}getVertexAttributes(){return Qr.members}emplace(a,u,g,y){a.emplace(u,g.tlbr[0],g.tlbr[1],g.tlbr[2],g.tlbr[3],y.tlbr[0],y.tlbr[1],y.tlbr[2],y.tlbr[3],g.pixelRatio,y.pixelRatio)}}class Ud extends ci{getPositions(a){return a.dashPositions}getPositionIds(a){return a.dashes&&a.dashes[this.layerId]}getVertexAttributes(){return _n.members}emplace(a,u,g,y){a.emplace(u,0,g.y,g.height,g.width,0,y.y,y.height,y.width)}}class Vd{constructor(a,u,g){this.binders={},this._buffers=[];const y=[];for(const T in a.paint._values){if(!g(T))continue;const S=a.paint.get(T);if(!(S instanceof ia&&Ca(S.property.specification)))continue;const M=Ym(T,a.type),R=S.value,L=S.property.specification.type,F=S.property.useIntegerZoom,U=S.property.specification["property-type"],q=U==="cross-faded"||U==="cross-faded-data-driven";if(R.kind==="constant")this.binders[T]=q?new La(R.value,M):new ka(R.value,M,L),y.push(`/u_${T}`);else if(R.kind==="source"||q){const X=ec(T,L,"source");this.binders[T]=q?T==="line-dasharray"?new Ud(R,L,F,u,X,a.id):new pi(R,L,F,u,X,a.id):new rn(R,M,L,X),y.push(`/a_${T}`)}else{const X=ec(T,L,"composite");this.binders[T]=new dn(R,M,L,F,u,X),y.push(`/z_${T}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof rn||u instanceof dn?u.maxValue:0}populatePaintArrays(a,u,g){for(const y in this.binders){const T=this.binders[y];(T instanceof rn||T instanceof dn||T instanceof ci)&&T.populatePaintArray(a,u,g)}}setConstantPatternPositions(a,u){for(const g in this.binders){const y=this.binders[g];y instanceof La&&y.setConstantPatternPositions(a,u)}}setConstantDashPositions(a,u){for(const g in this.binders){const y=this.binders[g];y instanceof La&&y.setConstantDashPositions(a,u)}}updatePaintArrays(a,u,g,y,T){let S=!1;for(const M in a){const R=u.getPositions(M);for(const L of R){const F=g.feature(L.index);for(const U in this.binders){const q=this.binders[U];if((q instanceof rn||q instanceof dn||q instanceof ci)&&q.expression.isStateDependent===!0){const X=y.paint.get(U);q.expression=X.value,q.updatePaintArray(L.start,L.end,F,a[M],T),S=!0}}}}return S}defines(){const a=[];for(const u in this.binders){const g=this.binders[u];(g instanceof ka||g instanceof La)&&a.push(...g.uniformNames.map((y=>`#define HAS_UNIFORM_${y}`)))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof rn||g instanceof dn)for(let y=0;y<g.paintVertexAttributes.length;y++)a.push(g.paintVertexAttributes[y].name);else if(g instanceof ci){const y=g.getVertexAttributes();for(const T of y)a.push(T.name)}}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof ka||g instanceof La||g instanceof dn)for(const y of g.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const g=[];for(const y in this.binders){const T=this.binders[y];if(T instanceof ka||T instanceof La||T instanceof dn){for(const S of T.uniformNames)if(u[S]){const M=T.getBinding(a,u[S],S);g.push({name:S,property:y,binding:M})}}}return g}setUniforms(a,u,g,y){for(const{name:T,property:S,binding:M}of u)this.binders[S].setUniform(M,y,g.get(S),T)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const g=this.binders[u];if(a&&g instanceof ci){const y=a.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(g instanceof rn||g instanceof dn)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(a){for(const u in this.binders){const g=this.binders[u];(g instanceof rn||g instanceof dn||g instanceof ci)&&g.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof rn||u instanceof dn||u instanceof ci)&&u.destroy()}}}class Jl{constructor(a,u,g=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new Vd(y,u,g);this.needsUpload=!1,this._featureMap=new Mi,this._bufferOffset=0}populatePaintArrays(a,u,g,y){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(a,u,y);u.id!==void 0&&this._featureMap.add(u.id,g,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,g,y){for(const T of g)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(a,this._featureMap,u,T,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function Ym(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function ec(h,a,u){const g={color:{source:wn,composite:d},number:{source:Kc,composite:wn}},y=(function(T){return{"line-pattern":{source:De,composite:De},"fill-pattern":{source:De,composite:De},"fill-extrusion-pattern":{source:De,composite:De},"line-dasharray":{source:ze,composite:ze}}[T]})(h);return y&&y[u]||g[a][u]}Ht("ConstantBinder",ka),Ht("CrossFadedConstantBinder",La),Ht("SourceExpressionBinder",rn),Ht("CrossFadedPatternBinder",pi),Ht("CrossFadedDasharrayBinder",Ud),Ht("CompositeExpressionBinder",dn),Ht("ProgramConfiguration",Vd,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Jl);const $d=Math.pow(2,14)-1,dl=-$d-1;function pl(h){const a=Ue/h.extent,u=h.loadGeometry();for(let g=0;g<u.length;g++){const y=u[g];for(let T=0;T<y.length;T++){const S=y[T],M=Math.round(S.x*a),R=Math.round(S.y*a);S.x=Xt(M,dl,$d),S.y=Xt(R,dl,$d),(M<S.x||M>S.x+1||R<S.y||R>S.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function oo(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?pl(h):[]}}const Wd=-32768;function Cf(h,a,u,g,y){h.emplaceBack(Wd+8*a+g,Wd+8*u+y)}class Mf{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new xe,this.indexArray=new ot,this.segments=new $t,this.programConfigurations=new Jl(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,g){const y=this.layers[0],T=[];let S=null,M=!1,R=y.type==="heatmap";if(y.type==="circle"){const F=y;S=F.layout.get("circle-sort-key"),M=!S.isConstant(),R=R||F.paint.get("circle-pitch-alignment")==="map"}const L=R?u.subdivisionGranularity.circle:1;for(const{feature:F,id:U,index:q,sourceLayerIndex:X}of a){const Q=this.layers[0]._featureFilter.needGeometry,te=oo(F,Q);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),te,g))continue;const ae=M?S.evaluate(te,{},g):void 0,de={id:U,properties:F.properties,type:F.type,sourceLayerIndex:X,index:q,geometry:Q?te.geometry:pl(F),patterns:{},sortKey:ae};T.push(de)}M&&T.sort(((F,U)=>F.sortKey-U.sortKey));for(const F of T){const{geometry:U,index:q,sourceLayerIndex:X}=F,Q=a[q].feature;this.addFeature(F,U,q,g,L),u.featureIndex.insert(Q,U,q,X,this.index)}}update(a,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:g})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Pt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,g,y,T=1){let S;switch(T){case 1:S=[0,7];break;case 3:S=[0,2,5,7];break;case 5:S=[0,1,3,4,6,7];break;case 7:S=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const M=S.length;for(const R of u)for(const L of R){const F=L.x,U=L.y;if(F<0||F>=Ue||U<0||U>=Ue)continue;const q=this.segments.prepareSegment(M*M,this.layoutVertexArray,this.indexArray,a.sortKey),X=q.vertexLength;for(let Q=0;Q<M;Q++)for(let te=0;te<M;te++)Cf(this.layoutVertexArray,F,U,S[te],S[Q]);for(let Q=0;Q<M-1;Q++)for(let te=0;te<M-1;te++){const ae=X+Q*M+te,de=X+(Q+1)*M+te;this.indexArray.emplaceBack(ae,de+1,ae+1),this.indexArray.emplaceBack(ae,de,de+1)}q.vertexLength+=M*M,q.primitiveLength+=(M-1)*(M-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,g,{imagePositions:{},canonical:y})}}function If(h,a){for(let u=0;u<h.length;u++)if(tc(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(tc(h,a[u]))return!0;return!!Wi(h,a)}function Km(h,a,u){return!!tc(h,a)||!!Jm(a,h,u)}function Qm(h,a){if(h.length===1)return cv(a,h[0]);for(let u=0;u<a.length;u++){const g=a[u];for(let y=0;y<g.length;y++)if(tc(h,g[y]))return!0}for(let u=0;u<h.length;u++)if(cv(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(Wi(h,a[u]))return!0;return!1}function Ii(h,a,u){if(h.length>1){if(Wi(h,a))return!0;for(let g=0;g<a.length;g++)if(Jm(a[g],h,u))return!0}for(let g=0;g<h.length;g++)if(Jm(h[g],a,u))return!0;return!1}function Wi(h,a){if(h.length===0||a.length===0)return!1;for(let u=0;u<h.length-1;u++){const g=h[u],y=h[u+1];for(let T=0;T<a.length-1;T++)if(jb(g,y,a[T],a[T+1]))return!0}return!1}function jb(h,a,u,g){return sr(h,u,g)!==sr(a,u,g)&&sr(h,a,u)!==sr(h,a,g)}function Jm(h,a,u){const g=u*u;if(a.length===1)return h.distSqr(a[0])<g;for(let y=1;y<a.length;y++)if(lv(h,a[y-1],a[y])<g)return!0;return!1}function lv(h,a,u){const g=a.distSqr(u);if(g===0)return h.distSqr(a);const y=((h.x-a.x)*(u.x-a.x)+(h.y-a.y)*(u.y-a.y))/g;return h.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function cv(h,a){let u,g,y,T=!1;for(let S=0;S<h.length;S++){u=h[S];for(let M=0,R=u.length-1;M<u.length;R=M++)g=u[M],y=u[R],g.y>a.y!=y.y>a.y&&a.x<(y.x-g.x)*(a.y-g.y)/(y.y-g.y)+g.x&&(T=!T)}return T}function tc(h,a){let u=!1;for(let g=0,y=h.length-1;g<h.length;y=g++){const T=h[g],S=h[y];T.y>a.y!=S.y>a.y&&a.x<(S.x-T.x)*(a.y-T.y)/(S.y-T.y)+T.x&&(u=!u)}return u}function Ub(h,a,u){const g=u[0],y=u[2];if(h.x<g.x&&a.x<g.x||h.x>y.x&&a.x>y.x||h.y<g.y&&a.y<g.y||h.y>y.y&&a.y>y.y)return!1;const T=sr(h,a,u[0]);return T!==sr(h,a,u[1])||T!==sr(h,a,u[2])||T!==sr(h,a,u[3])}function Jc(h,a,u){const g=a.paint.get(h).value;return g.kind==="constant"?g.value:u.programConfigurations.get(a.id).getMaxValue(h)}function Jp(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function e_(h,a,u,g,y){if(!a[0]&&!a[1])return h;const T=m.convert(a)._mult(y);u==="viewport"&&T._rotate(-g);const S=[];for(let M=0;M<h.length;M++)S.push(h[M].sub(T));return S}function t_(h){const a=[];for(let u=0;u<h.length;u++){const g=h[u],y=a.at(-1);(u===0||y&&!g.equals(y))&&a.push(g)}return a}function uv({queryGeometry:h,size:a},u){return Km(h,u,a)}function Vb({queryGeometry:h,size:a,transform:u,unwrappedTileID:g,getElevation:y},T){return Km(h,T,a*(u.projectTileCoordinates(T.x,T.y,g,y).signedDistanceFromCamera/u.cameraToCenterDistance))}function $b({queryGeometry:h,size:a,transform:u,unwrappedTileID:g,getElevation:y},T){const S=u.projectTileCoordinates(T.x,T.y,g,y).signedDistanceFromCamera,M=a*(u.cameraToCenterDistance/S);return Km(h,eg(T,u,g,y),M)}function Wb({queryGeometry:h,size:a,transform:u,unwrappedTileID:g,getElevation:y},T){return Km(h,eg(T,u,g,y),a)}function r_({queryGeometry:h,size:a,transform:u,unwrappedTileID:g,getElevation:y,pitchAlignment:T="map",pitchScale:S="map"},M){const R=T==="map"?S==="map"?uv:Vb:S==="map"?$b:Wb,L={queryGeometry:h,size:a,transform:u,unwrappedTileID:g,getElevation:y};for(const F of M)for(const U of F)if(R(L,U))return!0;return!1}function eg(h,a,u,g){const y=a.projectTileCoordinates(h.x,h.y,u,g).point;return new m((.5*y.x+.5)*a.width,(.5*-y.y+.5)*a.height)}let n_,hv;Ht("CircleBucket",Mf,{omit:["layers"]});var fv={get paint(){return hv=hv||new ri({"circle-radius":new er(Le.paint_circle["circle-radius"]),"circle-color":new er(Le.paint_circle["circle-color"]),"circle-blur":new er(Le.paint_circle["circle-blur"]),"circle-opacity":new er(Le.paint_circle["circle-opacity"]),"circle-translate":new qt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new qt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new er(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new er(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new er(Le.paint_circle["circle-stroke-opacity"])})},get layout(){return n_=n_||new ri({"circle-sort-key":new er(Le.layout_circle["circle-sort-key"])})}};class i_ extends Bn{constructor(a,u){super(a,fv,u)}createBucket(a){return new Mf(a)}queryRadius(a){const u=a;return Jc("circle-radius",this,u)+Jc("circle-stroke-width",this,u)+Jp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:g,geometry:y,transform:T,pixelsToTileUnits:S,unwrappedTileID:M,getElevation:R}){const L=e_(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,S),F=this.paint.get("circle-radius").evaluate(u,g)+this.paint.get("circle-stroke-width").evaluate(u,g),U=this.paint.get("circle-pitch-scale"),q=this.paint.get("circle-pitch-alignment");let X,Q;return q==="map"?(X=L,Q=F*S):(X=(function(te,ae,de,Te){return te.map((he=>eg(he,ae,de,Te)))})(L,T,M,R),Q=F),r_({queryGeometry:X,size:Q,transform:T,unwrappedTileID:M,getElevation:R,pitchAlignment:q,pitchScale:U},y)}}class s_ extends Mf{}let dv;Ht("HeatmapBucket",s_,{omit:["layers"]});var pv={get paint(){return dv=dv||new ri({"heatmap-radius":new er(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new er(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tf(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qt(Le.paint_heatmap["heatmap-opacity"])})}};function a_(h,{width:a,height:u},g,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*g)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*g}`)}else y=new Uint8Array(a*u*g);return h.width=a,h.height=u,h.data=y,h}function rc(h,{width:a,height:u},g){if(a===h.width&&u===h.height)return;const y=a_({},{width:a,height:u},g);tg(h,y,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,a),height:Math.min(h.height,u)},g),h.width=a,h.height=u,h.data=y.data}function tg(h,a,u,g,y,T){if(y.width===0||y.height===0)return a;if(y.width>h.width||y.height>h.height||u.x>h.width-y.width||u.y>h.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||g.x>a.width-y.width||g.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const S=h.data,M=a.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<y.height;R++){const L=((u.y+R)*h.width+u.x)*T,F=((g.y+R)*a.width+g.x)*T;for(let U=0;U<y.width*T;U++)M[F+U]=S[L+U]}return a}class rg{constructor(a,u){a_(this,a,1,u)}resize(a){rc(this,a,1)}clone(){return new rg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,g,y,T){tg(a,u,g,y,T,1)}}class Rs{constructor(a,u){a_(this,a,4,u)}resize(a){rc(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,g,y,T){tg(a,u,g,y,T,4)}setPixel(a,u,g){const y=4*(a*this.width+u);this.data[y+0]=Math.round(255*g.r/g.a),this.data[y+1]=Math.round(255*g.g/g.a),this.data[y+2]=Math.round(255*g.b/g.a),this.data[y+3]=Math.round(255*g.a)}}function nc(h){const a={},u=h.resolution||256,g=h.clips?h.clips.length:1,y=h.image||new Rs({width:u,height:g});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const T=(S,M,R)=>{a[h.evaluationKey]=R;const L=h.expression.evaluate(a);y.setPixel(S/4/u,M/4,L)};if(h.clips)for(let S=0,M=0;S<g;++S,M+=4*u)for(let R=0,L=0;R<u;R++,L+=4){const F=R/(u-1),{start:U,end:q}=h.clips[S];T(M,L,U*(1-F)+q*F)}else for(let S=0,M=0;S<u;S++,M+=4)T(0,M,S/(u-1));return y}Ht("AlphaImage",rg),Ht("RGBAImage",Rs);const ng="big-fb";class Hb extends Bn{createBucket(a){return new s_(a)}constructor(a,u){super(a,pv,u),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=nc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ng)&&this.heatmapFbos.delete(ng)}queryRadius(a){return Jc("heatmap-radius",this,a)}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:g,geometry:y,transform:T,pixelsToTileUnits:S,unwrappedTileID:M,getElevation:R}){return r_({queryGeometry:a,size:this.paint.get("heatmap-radius").evaluate(u,g)*S,transform:T,unwrappedTileID:M,getElevation:R},y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let ig;var sg={get paint(){return ig=ig||new ri({"hillshade-illumination-direction":new qt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new qt(Le.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new qt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qt(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new qt(Le.paint_hillshade["hillshade-method"])})}};class Kn extends Bn{constructor(a,u){super(a,sg,u),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let a=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,g=this.paint.get("hillshade-highlight-color").values,y=this.paint.get("hillshade-shadow-color").values;const T=Math.max(a.length,u.length,g.length,y.length);a=a.concat(Array(T-a.length).fill(a.at(-1))),u=u.concat(Array(T-u.length).fill(u.at(-1))),g=g.concat(Array(T-g.length).fill(g.at(-1))),y=y.concat(Array(T-y.length).fill(y.at(-1)));const S=u.map(vi);return{directionRadians:a.map(vi),altitudeRadians:S,shadowColor:y,highlightColor:g}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let qb;var _2={get paint(){return qb=qb||new ri({"color-relief-opacity":new qt(Le["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Tf(Le["paint_color-relief"]["color-relief-color"])})}};class o_{constructor(a,u,g,y){this.context=a,this.format=g,this.texture=a.gl.createTexture(),this.update(u,y)}update(a,u,g){const{width:y,height:T}=a,S=!(this.size&&this.size[0]===y&&this.size[1]===T||g),{context:M}=this,{gl:R}=M;if(this.useMipmap=!!(u&&u.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!u||u.premultiply!==!1)),S)this.size=[y,T],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||qs(a)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,a):R.texImage2D(R.TEXTURE_2D,0,this.format,y,T,0,this.format,R.UNSIGNED_BYTE,a.data);else{const{x:L,y:F}=g||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||qs(a)?R.texSubImage2D(R.TEXTURE_2D,0,L,F,R.RGBA,R.UNSIGNED_BYTE,a):R.texSubImage2D(R.TEXTURE_2D,0,L,F,y,T,R.RGBA,R.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),M.pixelStoreUnpackFlipY.setDefault(),M.pixelStoreUnpack.setDefault(),M.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,u,g){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),g!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=T.LINEAR),a!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,a),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,g||a),this.filter=a),u!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,u),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class Hd{constructor(a,u,g,y=1,T=1,S=1,M=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void _r(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=T,this.blueFactor=S,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<R;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(R,L)]=this.data[this._idx(R-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,R)]=this.data[this._idx(L,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<R;L++)for(let F=0;F<R;F++){const U=this.get(L,F);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(a,u){const g=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(g[y],g[y+1],g[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${a}, y: ${u}, dim: ${this.dim}`);return(u+1)*this.stride+(a+1)}unpack(a,u,g){return a*this.redFactor+u*this.greenFactor+g*this.blueFactor-this.baseShift}pack(a){return eu(a,this.getUnpackVector())}getPixels(){return new Rs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,g){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,T=u*this.dim+this.dim,S=g*this.dim,M=g*this.dim+this.dim;switch(u){case-1:y=T-1;break;case 1:T=y+1}switch(g){case-1:S=M-1;break;case 1:M=S+1}const R=-u*this.dim,L=-g*this.dim;for(let F=S;F<M;F++)for(let U=y;U<T;U++)this.data[this._idx(U,F)]=a.data[this._idx(U+R,F+L)]}}function eu(h,a){const u=a[0],g=a[1],y=a[2],T=a[3],S=Math.min(u,g,y),M=Math.round((h+T)/S);return{r:Math.floor(M*S/u)%256,g:Math.floor(M*S/g)%256,b:Math.floor(M*S/y)%256}}Ht("DEMData",Hd);class Xb extends Bn{constructor(a,u){super(a,_2,u)}_createColorRamp(a){const u={elevationStops:[],colorStops:[]},g=this._transitionablePaint._values["color-relief-color"].value.expression;if(g instanceof hs&&g._styleExpression.expression instanceof cs){this.colorRampExpression=g;const S=g._styleExpression.expression;u.elevationStops=S.labels,u.colorStops=[];for(const M of u.elevationStops)u.colorStops.push(S.evaluate({globals:{elevation:M}}))}if(u.elevationStops.length<1&&(u.elevationStops=[0],u.colorStops=[Cr.transparent]),u.elevationStops.length<2&&(u.elevationStops.push(u.elevationStops[0]+1),u.colorStops.push(u.colorStops[0])),u.elevationStops.length<=a)return u;const y={elevationStops:[],colorStops:[]},T=(u.elevationStops.length-1)/(a-1);for(let S=0;S<u.elevationStops.length-.5;S+=T)y.elevationStops.push(u.elevationStops[Math.round(S)]),y.colorStops.push(u.colorStops[Math.round(S)]);return _r(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${a}, provided: ${u.elevationStops.length}`),y}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(a,u,g){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const y=this._createColorRamp(u),T=new Rs({width:y.colorStops.length,height:1}),S=new Rs({width:y.colorStops.length,height:1});for(let M=0;M<y.elevationStops.length;M++){const R=eu(y.elevationStops[M],g);S.setPixel(0,M,new Cr(R.r/255,R.g/255,R.b/255,1)),T.setPixel(0,M,y.colorStops[M])}return this.colorRampTextures={elevationTexture:new o_(a,S,a.gl.RGBA),colorTexture:new o_(a,T,a.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Gb=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ag}=Gb;function lo(h,a,u){const g=u.patternDependencies;let y=!1;for(const T of a){const S=T.paint.get(`${h}-pattern`);S.isConstant()||(y=!0);const M=S.constantOr(null);M&&(y=!0,g[M.to]=!0,g[M.from]=!0)}return y}function l_(h,a,u,g,y){const{zoom:T}=g,S=y.patternDependencies;for(const M of a){const R=M.paint.get(`${h}-pattern`).value;if(R.kind!=="constant"){let L=R.evaluate({zoom:T-1},u,{},y.availableImages),F=R.evaluate({zoom:T},u,{},y.availableImages),U=R.evaluate({zoom:T+1},u,{},y.availableImages);L=L&&L.name?L.name:L,F=F&&F.name?F.name:F,U=U&&U.name?U.name:U,S[L]=!0,S[F]=!0,S[U]=!0,u.patterns[M.id]={min:L,mid:F,max:U}}}return u}function c_(h,a,u,g,y){let T;if(y===(function(S,M,R,L){let F=0;for(let U=M,q=R-L;U<R;U+=L)F+=(S[q]-S[U])*(S[U+1]+S[q+1]),q=U;return F})(h,a,u,g)>0)for(let S=a;S<u;S+=g)T=aa(S/g|0,h[S],h[S+1],T);else for(let S=u-g;S>=a;S-=g)T=aa(S/g|0,h[S],h[S+1],T);return T&&Na(T,T.next)&&(oa(T),T=T.next),T}function oh(h,a){if(!h)return h;a||(a=h);let u,g=h;do if(u=!1,g.steiner||!Na(g,g.next)&&Gr(g.prev,g,g.next)!==0)g=g.next;else{if(oa(g),g=a=g.prev,g===g.next)break;u=!0}while(u||g!==a);return a}function Rf(h,a,u,g,y,T,S){if(!h)return;!S&&T&&(function(R,L,F,U){let q=R;do q.z===0&&(q.z=Oi(q.x,q.y,L,F,U)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==R);q.prevZ.nextZ=null,q.prevZ=null,(function(X){let Q,te=1;do{let ae,de=X;X=null;let Te=null;for(Q=0;de;){Q++;let he=de,ve=0;for(let Fe=0;Fe<te&&(ve++,he=he.nextZ,he);Fe++);let Oe=te;for(;ve>0||Oe>0&&he;)ve!==0&&(Oe===0||!he||de.z<=he.z)?(ae=de,de=de.nextZ,ve--):(ae=he,he=he.nextZ,Oe--),Te?Te.nextZ=ae:X=ae,ae.prevZ=Te,Te=ae;de=he}Te.nextZ=null,te*=2}while(Q>1)})(q)})(h,g,y,T);let M=h;for(;h.prev!==h.next;){const R=h.prev,L=h.next;if(T?u_(h,g,y,T):gv(h))a.push(R.i,h.i,L.i),oa(h),h=L.next,M=L.next;else if((h=L)===M){S?S===1?Rf(h=Zb(oh(h),a),a,u,g,y,T,2):S===2&&tu(h,a,u,g,y,T):Rf(oh(h),a,u,g,y,T,1);break}}}function gv(h){const a=h.prev,u=h,g=h.next;if(Gr(a,u,g)>=0)return!1;const y=a.x,T=u.x,S=g.x,M=a.y,R=u.y,L=g.y,F=Math.min(y,T,S),U=Math.min(M,R,L),q=Math.max(y,T,S),X=Math.max(M,R,L);let Q=g.next;for(;Q!==a;){if(Q.x>=F&&Q.x<=q&&Q.y>=U&&Q.y<=X&&qd(y,M,T,R,S,L,Q.x,Q.y)&&Gr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function u_(h,a,u,g){const y=h.prev,T=h,S=h.next;if(Gr(y,T,S)>=0)return!1;const M=y.x,R=T.x,L=S.x,F=y.y,U=T.y,q=S.y,X=Math.min(M,R,L),Q=Math.min(F,U,q),te=Math.max(M,R,L),ae=Math.max(F,U,q),de=Oi(X,Q,a,u,g),Te=Oi(te,ae,a,u,g);let he=h.prevZ,ve=h.nextZ;for(;he&&he.z>=de&&ve&&ve.z<=Te;){if(he.x>=X&&he.x<=te&&he.y>=Q&&he.y<=ae&&he!==y&&he!==S&&qd(M,F,R,U,L,q,he.x,he.y)&&Gr(he.prev,he,he.next)>=0||(he=he.prevZ,ve.x>=X&&ve.x<=te&&ve.y>=Q&&ve.y<=ae&&ve!==y&&ve!==S&&qd(M,F,R,U,L,q,ve.x,ve.y)&&Gr(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;he&&he.z>=de;){if(he.x>=X&&he.x<=te&&he.y>=Q&&he.y<=ae&&he!==y&&he!==S&&qd(M,F,R,U,L,q,he.x,he.y)&&Gr(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ve&&ve.z<=Te;){if(ve.x>=X&&ve.x<=te&&ve.y>=Q&&ve.y<=ae&&ve!==y&&ve!==S&&qd(M,F,R,U,L,q,ve.x,ve.y)&&Gr(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function Zb(h,a){let u=h;do{const g=u.prev,y=u.next.next;!Na(g,y)&&yv(g,u,u.next,y)&&cg(g,y)&&cg(y,g)&&(a.push(g.i,u.i,y.i),oa(u),oa(u.next),u=h=y),u=u.next}while(u!==h);return oh(u)}function tu(h,a,u,g,y,T){let S=h;do{let M=S.next.next;for(;M!==S.prev;){if(S.i!==M.i&&ni(S,M)){let R=ug(S,M);return S=oh(S,S.next),R=oh(R,R.next),Rf(S,a,u,g,y,T,0),void Rf(R,a,u,g,y,T,0)}M=M.next}S=S.next}while(S!==h)}function Ri(h,a){let u=h.x-a.x;return u===0&&(u=h.y-a.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(a.next.y-a.y)/(a.next.x-a.x)),u}function mv(h,a){const u=(function(y,T){let S=T;const M=y.x,R=y.y;let L,F=-1/0;if(Na(y,S))return S;do{if(Na(y,S.next))return S.next;if(R<=S.y&&R>=S.next.y&&S.next.y!==S.y){const te=S.x+(R-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(te<=M&&te>F&&(F=te,L=S.x<S.next.x?S:S.next,te===M))return L}S=S.next}while(S!==T);if(!L)return null;const U=L,q=L.x,X=L.y;let Q=1/0;S=L;do{if(M>=S.x&&S.x>=q&&M!==S.x&&_v(R<X?M:F,R,q,X,R<X?F:M,R,S.x,S.y)){const te=Math.abs(R-S.y)/(M-S.x);cg(S,y)&&(te<Q||te===Q&&(S.x>L.x||S.x===L.x&&Yb(L,S)))&&(L=S,Q=te)}S=S.next}while(S!==U);return L})(h,a);if(!u)return a;const g=ug(u,h);return oh(g,g.next),oh(u,u.next)}function Yb(h,a){return Gr(h.prev,h,a.prev)<0&&Gr(a.next,h,h.next)<0}function Oi(h,a,u,g,y){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*y|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-g)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function y2(h){let a=h,u=h;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==h);return u}function _v(h,a,u,g,y,T,S,M){return(y-S)*(a-M)>=(h-S)*(T-M)&&(h-S)*(g-M)>=(u-S)*(a-M)&&(u-S)*(T-M)>=(y-S)*(g-M)}function qd(h,a,u,g,y,T,S,M){return!(h===S&&a===M)&&_v(h,a,u,g,y,T,S,M)}function ni(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!(function(u,g){let y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==g.i&&y.next.i!==g.i&&yv(y,y.next,u,g))return!0;y=y.next}while(y!==u);return!1})(h,a)&&(cg(h,a)&&cg(a,h)&&(function(u,g){let y=u,T=!1;const S=(u.x+g.x)/2,M=(u.y+g.y)/2;do y.y>M!=y.next.y>M&&y.next.y!==y.y&&S<(y.next.x-y.x)*(M-y.y)/(y.next.y-y.y)+y.x&&(T=!T),y=y.next;while(y!==u);return T})(h,a)&&(Gr(h.prev,h,a.prev)||Gr(h,a.prev,a))||Na(h,a)&&Gr(h.prev,h,h.next)>0&&Gr(a.prev,a,a.next)>0)}function Gr(h,a,u){return(a.y-h.y)*(u.x-a.x)-(a.x-h.x)*(u.y-a.y)}function Na(h,a){return h.x===a.x&&h.y===a.y}function yv(h,a,u,g){const y=lg(Gr(h,a,u)),T=lg(Gr(h,a,g)),S=lg(Gr(u,g,h)),M=lg(Gr(u,g,a));return y!==T&&S!==M||!(y!==0||!og(h,u,a))||!(T!==0||!og(h,g,a))||!(S!==0||!og(u,h,g))||!(M!==0||!og(u,a,g))}function og(h,a,u){return a.x<=Math.max(h.x,u.x)&&a.x>=Math.min(h.x,u.x)&&a.y<=Math.max(h.y,u.y)&&a.y>=Math.min(h.y,u.y)}function lg(h){return h>0?1:h<0?-1:0}function cg(h,a){return Gr(h.prev,h,h.next)<0?Gr(h,a,h.next)>=0&&Gr(h,h.prev,a)>=0:Gr(h,a,h.prev)<0||Gr(h,h.next,a)<0}function ug(h,a){const u=h_(h.i,h.x,h.y),g=h_(a.i,a.x,a.y),y=h.next,T=a.prev;return h.next=a,a.prev=h,u.next=y,y.prev=u,g.next=u,u.prev=g,T.next=g,g.prev=T,g}function aa(h,a,u,g){const y=h_(h,a,u);return g?(y.next=g.next,y.prev=g,g.next.prev=y,g.next=y):(y.prev=y,y.next=y),y}function oa(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function h_(h,a,u){return{i:h,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Hi{constructor(a,u){if(u>a)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=a,this._minGranularity=u}getGranularityForZoomLevel(a){return Math.max(Math.floor(this._baseZoomGranularity/(1<<a)),this._minGranularity,1)}}class hg{constructor(a){this.fill=a.fill,this.line=a.line,this.tile=a.tile,this.stencil=a.stencil,this.circle=a.circle}}hg.noSubdivision=new hg({fill:new Hi(0,0),line:new Hi(0,0),tile:new Hi(0,0),stencil:new Hi(0,0),circle:1}),Ht("SubdivisionGranularityExpression",Hi),Ht("SubdivisionGranularitySetting",hg);const za=-32768,gl=32767;class ru{constructor(a,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=a,this._granularityCellSize=Ue/a,this._canonical=u}_getKey(a,u){return(a+=32768)<<16|u+32768}_vertexToIndex(a,u){if(a<-32768||u<-32768||a>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const g=0|Math.round(a),y=0|Math.round(u),T=this._getKey(g,y);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const S=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,S),this._vertexBuffer.push(g,y),S}_subdivideTrianglesScanline(a){if(this._granularity<2)return(function(y,T){const S=[];for(let M=0;M<T.length;M+=3){const R=T[M],L=T[M+1],F=T[M+2],U=y[2*R],q=y[2*R+1];(y[2*L]-U)*(y[2*F+1]-q)-(y[2*L+1]-q)*(y[2*F]-U)>0?(S.push(R),S.push(F),S.push(L)):(S.push(R),S.push(L),S.push(F))}return S})(this._vertexBuffer,a);const u=[],g=a.length;for(let y=0;y<g;y+=3){const T=[a[y+0],a[y+1],a[y+2]],S=[this._vertexBuffer[2*a[y+0]+0],this._vertexBuffer[2*a[y+0]+1],this._vertexBuffer[2*a[y+1]+0],this._vertexBuffer[2*a[y+1]+1],this._vertexBuffer[2*a[y+2]+0],this._vertexBuffer[2*a[y+2]+1]];let M=1/0,R=1/0,L=-1/0,F=-1/0;for(let te=0;te<3;te++){const ae=S[2*te],de=S[2*te+1];M=Math.min(M,ae),L=Math.max(L,ae),R=Math.min(R,de),F=Math.max(F,de)}if(M===L||R===F)continue;const U=Math.floor(M/this._granularityCellSize),q=Math.ceil(L/this._granularityCellSize),X=Math.floor(R/this._granularityCellSize),Q=Math.ceil(F/this._granularityCellSize);if(U!==q||X!==Q)for(let te=X;te<Q;te++){const ae=this._scanlineGenerateVertexRingForCellRow(te,S,T);ml(this._vertexBuffer,ae,u)}else u.push(...T)}return u}_scanlineGenerateVertexRingForCellRow(a,u,g){const y=a*this._granularityCellSize,T=y+this._granularityCellSize,S=[];for(let M=0;M<3;M++){const R=u[2*M],L=u[2*M+1],F=u[2*(M+1)%6],U=u[(2*(M+1)+1)%6],q=u[2*(M+2)%6],X=u[(2*(M+2)+1)%6],Q=F-R,te=U-L,ae=Q===0,de=te===0,Te=(y-L)/te,he=(T-L)/te,ve=Math.min(Te,he),Oe=Math.max(Te,he);if(!de&&(ve>=1||Oe<=0)||de&&(L<y||L>T)){U>=y&&U<=T&&S.push(g[(M+1)%3]);continue}!de&&ve>0&&S.push(this._vertexToIndex(R+Q*ve,L+te*ve));const Fe=R+Q*Math.max(ve,0),it=R+Q*Math.min(Oe,1);ae||this._generateIntraEdgeVertices(S,R,L,F,U,Fe,it),!de&&Oe<1&&S.push(this._vertexToIndex(R+Q*Oe,L+te*Oe)),(de||U>=y&&U<=T)&&S.push(g[(M+1)%3]),!de&&(U<=y||U>=T)&&this._generateInterEdgeVertices(S,R,L,F,U,q,X,it,y,T)}return S}_generateIntraEdgeVertices(a,u,g,y,T,S,M){const R=y-u,L=T-g,F=L===0,U=F?Math.min(u,y):Math.min(S,M),q=F?Math.max(u,y):Math.max(S,M),X=Math.floor(U/this._granularityCellSize)+1,Q=Math.ceil(q/this._granularityCellSize)-1;if(F?u<y:S<M)for(let te=X;te<=Q;te++){const ae=te*this._granularityCellSize;a.push(this._vertexToIndex(ae,g+L*(ae-u)/R))}else for(let te=Q;te>=X;te--){const ae=te*this._granularityCellSize;a.push(this._vertexToIndex(ae,g+L*(ae-u)/R))}}_generateInterEdgeVertices(a,u,g,y,T,S,M,R,L,F){const U=T-g,q=S-y,X=M-T,Q=(L-T)/X,te=(F-T)/X,ae=Math.min(Q,te),de=Math.max(Q,te),Te=y+q*ae;let he=Math.floor(Math.min(Te,R)/this._granularityCellSize)+1,ve=Math.ceil(Math.max(Te,R)/this._granularityCellSize)-1,Oe=R<Te;const Fe=X===0;if(Fe&&(M===L||M===F))return;if(Fe||ae>=1||de<=0){const vt=g-M,xt=S+(u-S)*Math.min((L-M)/vt,(F-M)/vt);he=Math.floor(Math.min(xt,R)/this._granularityCellSize)+1,ve=Math.ceil(Math.max(xt,R)/this._granularityCellSize)-1,Oe=R<xt}const it=U>0?F:L;if(Oe)for(let vt=he;vt<=ve;vt++)a.push(this._vertexToIndex(vt*this._granularityCellSize,it));else for(let vt=ve;vt>=he;vt--)a.push(this._vertexToIndex(vt*this._granularityCellSize,it))}_generateOutline(a){const u=[];for(const g of a){const y=nu(g,this._granularity,!0),T=this._pointArrayToIndices(y),S=[];for(let M=1;M<T.length;M++)S.push(T[M-1]),S.push(T[M]);u.push(S)}return u}_handlePoles(a){let u=!1,g=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(u||g)&&this._fillPoles(a,u,g)}_ensureNoPoleVertices(){const a=this._vertexBuffer;for(let u=0;u<a.length;u+=2){const g=a[u+1];g===za&&(a[u+1]=-32767),g===gl&&(a[u+1]=32766)}}_generatePoleQuad(a,u,g,y,T,S){y>T!=(S===za)?(a.push(u),a.push(g),a.push(this._vertexToIndex(y,S)),a.push(g),a.push(this._vertexToIndex(T,S)),a.push(this._vertexToIndex(y,S))):(a.push(g),a.push(u),a.push(this._vertexToIndex(y,S)),a.push(this._vertexToIndex(T,S)),a.push(g),a.push(this._vertexToIndex(y,S)))}_fillPoles(a,u,g){const y=this._vertexBuffer,T=Ue,S=a.length;for(let M=2;M<S;M+=3){const R=a[M-2],L=a[M-1],F=a[M],U=y[2*R],q=y[2*R+1],X=y[2*L],Q=y[2*L+1],te=y[2*F],ae=y[2*F+1];u&&(q===0&&Q===0&&this._generatePoleQuad(a,R,L,U,X,za),Q===0&&ae===0&&this._generatePoleQuad(a,L,F,X,te,za),ae===0&&q===0&&this._generatePoleQuad(a,F,R,te,U,za)),g&&(q===T&&Q===T&&this._generatePoleQuad(a,R,L,U,X,gl),Q===T&&ae===T&&this._generatePoleQuad(a,L,F,X,te,gl),ae===T&&q===T&&this._generatePoleQuad(a,F,R,te,U,gl))}}_initializeVertices(a){for(let u=0;u<a.length;u+=2)this._vertexToIndex(a[u],a[u+1])}subdividePolygonInternal(a,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:g,holeIndices:y}=(function(M){const R=[],L=[];for(const F of M)if(F.length!==0){F!==M[0]&&R.push(L.length/2);for(let U=0;U<F.length;U++)L.push(F[U].x),L.push(F[U].y)}return{flattened:L,holeIndices:R}})(a);let T;this._initializeVertices(g);try{const M=(function(L,F,U=2){const q=F&&F.length,X=q?F[0]*U:L.length;let Q=c_(L,0,X,U,!0);const te=[];if(!Q||Q.next===Q.prev)return te;let ae,de,Te;if(q&&(Q=(function(he,ve,Oe,Fe){const it=[];for(let vt=0,xt=ve.length;vt<xt;vt++){const It=c_(he,ve[vt]*Fe,vt<xt-1?ve[vt+1]*Fe:he.length,Fe,!1);It===It.next&&(It.steiner=!0),it.push(y2(It))}it.sort(Ri);for(let vt=0;vt<it.length;vt++)Oe=mv(it[vt],Oe);return Oe})(L,F,Q,U)),L.length>80*U){ae=L[0],de=L[1];let he=ae,ve=de;for(let Oe=U;Oe<X;Oe+=U){const Fe=L[Oe],it=L[Oe+1];Fe<ae&&(ae=Fe),it<de&&(de=it),Fe>he&&(he=Fe),it>ve&&(ve=it)}Te=Math.max(he-ae,ve-de),Te=Te!==0?32767/Te:0}return Rf(Q,te,U,ae,de,Te,0),te})(g,y),R=this._convertIndices(g,M);T=this._subdivideTrianglesScanline(R)}catch(M){console.error(M)}let S=[];return u&&(S=this._generateOutline(a)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:S}}_convertIndices(a,u){const g=[];for(let y=0;y<u.length;y++)g.push(this._vertexToIndex(a[2*u[y]],a[2*u[y]+1]));return g}_pointArrayToIndices(a){const u=[];for(let g=0;g<a.length;g++){const y=a[g];u.push(this._vertexToIndex(y.x,y.y))}return u}}function f_(h,a,u,g=!0){return new ru(u,a).subdividePolygonInternal(h,g)}function nu(h,a,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const g=h[0],y=h[h.length-1],T=u&&(g.x!==y.x||g.y!==y.y);if(a<2)return T?[...h,h[0]]:[...h];const S=Math.floor(Ue/a),M=[];M.push(new m(h[0].x,h[0].y));const R=h.length,L=T?R:R-1;for(let F=0;F<L;F++){const U=h[F],q=F<R-1?h[F+1]:h[0],X=U.x,Q=U.y,te=q.x,ae=q.y,de=X!==te,Te=Q!==ae;if(!de&&!Te)continue;const he=te-X,ve=ae-Q,Oe=Math.abs(he),Fe=Math.abs(ve);let it=X,vt=Q;for(;;){const It=he>0?(Math.floor(it/S)+1)*S:(Math.ceil(it/S)-1)*S,Vt=ve>0?(Math.floor(vt/S)+1)*S:(Math.ceil(vt/S)-1)*S,kt=Math.abs(it-It),wt=Math.abs(vt-Vt),pt=Math.abs(it-te),Gt=Math.abs(vt-ae),Jt=de?kt/Oe:Number.POSITIVE_INFINITY,ar=Te?wt/Fe:Number.POSITIVE_INFINITY;if((pt<=kt||!de)&&(Gt<=wt||!Te))break;if(Jt<ar&&de||!Te){it=It,vt+=ve*Jt;const tr=new m(it,Math.round(vt));M[M.length-1].x===tr.x&&M[M.length-1].y===tr.y||M.push(tr)}else{it+=he*ar,vt=Vt;const tr=new m(Math.round(it),vt);M[M.length-1].x===tr.x&&M[M.length-1].y===tr.y||M.push(tr)}}const xt=new m(te,ae);M[M.length-1].x===xt.x&&M[M.length-1].y===xt.y||M.push(xt)}return M}function ml(h,a,u){if(a.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,y=h[2*a[0]];for(let R=1;R<a.length;R++){const L=h[2*a[R]];L<y&&(y=L,g=R)}const T=a.length;let S=g,M=(S+1)%T;for(;;){const R=S-1>=0?S-1:T-1,L=(M+1)%T,F=h[2*a[R]],U=h[2*a[L]],q=h[2*a[S]],X=h[2*a[S]+1],Q=h[2*a[M]+1];let te=!1;if(F<U)te=!0;else if(F>U)te=!1;else{const ae=Q-X,de=-(h[2*a[M]]-q),Te=X<Q?1:-1;((F-q)*ae+(h[2*a[R]+1]-X)*de)*Te>((U-q)*ae+(h[2*a[L]+1]-X)*de)*Te&&(te=!0)}if(te){const ae=a[R],de=a[S],Te=a[M];ae!==de&&ae!==Te&&de!==Te&&u.push(Te,de,ae),S--,S<0&&(S=T-1)}else{const ae=a[L],de=a[S],Te=a[M];ae!==de&&ae!==Te&&de!==Te&&u.push(Te,de,ae),M++,M>=T&&(M=0)}if(R===L)break}}function vv(h,a,u,g,y,T,S,M,R){const L=y.length/2,F=S&&M&&R;if(L<$t.MAX_VERTEX_ARRAY_LENGTH){const U=a.prepareSegment(L,u,g),q=U.vertexLength;for(let te=0;te<T.length;te+=3)g.emplaceBack(q+T[te],q+T[te+1],q+T[te+2]);let X,Q;U.vertexLength+=L,U.primitiveLength+=T.length/3,F&&(Q=S.prepareSegment(L,u,M),X=Q.vertexLength,Q.vertexLength+=L);for(let te=0;te<y.length;te+=2)h(y[te],y[te+1]);if(F)for(let te=0;te<R.length;te++){const ae=R[te];for(let de=1;de<ae.length;de+=2)M.emplaceBack(X+ae[de-1],X+ae[de]);Q.primitiveLength+=ae.length/2}}else(function(U,q,X,Q,te,ae){const de=[];for(let Fe=0;Fe<Q.length/2;Fe++)de.push(-1);const Te={count:0};let he=0,ve=U.getOrCreateLatestSegment(q,X),Oe=ve.vertexLength;for(let Fe=2;Fe<te.length;Fe+=3){const it=te[Fe-2],vt=te[Fe-1],xt=te[Fe];let It=de[it]<he,Vt=de[vt]<he,kt=de[xt]<he;ve.vertexLength+((It?1:0)+(Vt?1:0)+(kt?1:0))>$t.MAX_VERTEX_ARRAY_LENGTH&&(ve=U.createNewSegment(q,X),he=Te.count,It=!0,Vt=!0,kt=!0,Oe=0);const wt=ic(de,Q,ae,Te,it,It,ve),pt=ic(de,Q,ae,Te,vt,Vt,ve),Gt=ic(de,Q,ae,Te,xt,kt,ve);X.emplaceBack(Oe+wt-he,Oe+pt-he,Oe+Gt-he),ve.primitiveLength++}})(a,u,g,y,T,h),F&&(function(U,q,X,Q,te,ae){const de=[];for(let Fe=0;Fe<Q.length/2;Fe++)de.push(-1);const Te={count:0};let he=0,ve=U.getOrCreateLatestSegment(q,X),Oe=ve.vertexLength;for(let Fe=0;Fe<te.length;Fe++){const it=te[Fe];for(let vt=1;vt<te[Fe].length;vt+=2){const xt=it[vt-1],It=it[vt];let Vt=de[xt]<he,kt=de[It]<he;ve.vertexLength+((Vt?1:0)+(kt?1:0))>$t.MAX_VERTEX_ARRAY_LENGTH&&(ve=U.createNewSegment(q,X),he=Te.count,Vt=!0,kt=!0,Oe=0);const wt=ic(de,Q,ae,Te,xt,Vt,ve),pt=ic(de,Q,ae,Te,It,kt,ve);X.emplaceBack(Oe+wt-he,Oe+pt-he),ve.primitiveLength++}}})(S,u,M,y,R,h),a.forceNewSegmentOnNextPrepare(),S?.forceNewSegmentOnNextPrepare()}function ic(h,a,u,g,y,T,S){if(T){const M=g.count;return u(a[2*y],a[2*y+1]),h[y]=g.count,g.count++,S.vertexLength++,M}return h[y]}class Of{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new be,this.indexArray=new ot,this.indexArray2=new Ft,this.programConfigurations=new Jl(a.layers,a.zoom),this.segments=new $t,this.segments2=new $t,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,g){this.hasDependencies=lo("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),T=!y.isConstant(),S=[];for(const{feature:M,id:R,index:L,sourceLayerIndex:F}of a){const U=this.layers[0]._featureFilter.needGeometry,q=oo(M,U);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),q,g))continue;const X=T?y.evaluate(q,{},g,u.availableImages):void 0,Q={id:R,properties:M.properties,type:M.type,sourceLayerIndex:F,index:L,geometry:U?q.geometry:pl(M),patterns:{},sortKey:X};S.push(Q)}T&&S.sort(((M,R)=>M.sortKey-R.sortKey));for(const M of S){const{geometry:R,index:L,sourceLayerIndex:F}=M;if(this.hasDependencies){const U=l_("fill",this.layers,M,{zoom:this.zoom},u);this.patternFeatures.push(U)}else this.addFeature(M,R,L,g,{},u.subdivisionGranularity);u.featureIndex.insert(a[L].feature,R,L,F,this.index)}}update(a,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:g})}addFeatures(a,u,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,g,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ag),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,g,y,T,S){for(const M of nf(u,500)){const R=f_(M,y,S.fill.getGranularityForZoomLevel(y.z)),L=this.layoutVertexArray;vv(((F,U)=>{L.emplaceBack(F,U)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,g,{imagePositions:T,canonical:y})}}let Xd,Df;Ht("FillBucket",Of,{omit:["layers","patternFeatures"]});var Kb={get paint(){return Df=Df||new ri({"fill-antialias":new qt(Le.paint_fill["fill-antialias"]),"fill-opacity":new er(Le.paint_fill["fill-opacity"]),"fill-color":new er(Le.paint_fill["fill-color"]),"fill-outline-color":new er(Le.paint_fill["fill-outline-color"]),"fill-translate":new qt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new qt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Oa(Le.paint_fill["fill-pattern"])})},get layout(){return Xd=Xd||new ri({"fill-sort-key":new er(Le.layout_fill["fill-sort-key"])})}};class Qb extends Bn{constructor(a,u){super(a,Kb,u)}recalculate(a,u){super.recalculate(a,u);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Of(a)}queryRadius(){return Jp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:a,geometry:u,transform:g,pixelsToTileUnits:y}){return Qm(e_(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,y),u)}isTileClipped(){return!0}}const fg=Rn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jb=Rn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:d_}=fg;class Gd{constructor(a,u,g,y,T){this.properties={},this.extent=g,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=y,this._values=T,a.readFields(v2,this,u)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos,g=[];let y,T=1,S=0,M=0,R=0;for(;a.pos<u;){if(S<=0){const L=a.readVarint();T=7&L,S=L>>3}if(S--,T===1||T===2)M+=a.readSVarint(),R+=a.readSVarint(),T===1&&(y&&g.push(y),y=[]),y&&y.push(new m(M,R));else{if(T!==7)throw new Error(`unknown command ${T}`);y&&y.push(y[0].clone())}}return y&&g.push(y),g}bbox(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos;let g=1,y=0,T=0,S=0,M=1/0,R=-1/0,L=1/0,F=-1/0;for(;a.pos<u;){if(y<=0){const U=a.readVarint();g=7&U,y=U>>3}if(y--,g===1||g===2)T+=a.readSVarint(),S+=a.readSVarint(),T<M&&(M=T),T>R&&(R=T),S<L&&(L=S),S>F&&(F=S);else if(g!==7)throw new Error(`unknown command ${g}`)}return[M,L,R,F]}toGeoJSON(a,u,g){const y=this.extent*Math.pow(2,g),T=this.extent*a,S=this.extent*u,M=this.loadGeometry();function R(q){return[360*(q.x+T)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+S)/y)*Math.PI))-90]}function L(q){return q.map(R)}let F;if(this.type===1){const q=[];for(const Q of M)q.push(Q[0]);const X=L(q);F=q.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const q=M.map(L);F=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=ex(M),X=[];for(const Q of q)X.push(Q.map(L));F=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const U={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(U.id=this.id),U}}function v2(h,a,u){h===1?a.id=u.readVarint():h===2?(function(g,y){const T=g.readVarint()+g.pos;for(;g.pos<T;){const S=y._keys[g.readVarint()],M=y._values[g.readVarint()];y.properties[S]=M}})(u,a):h===3?a.type=u.readVarint():h===4&&(a._geometry=u.pos)}function ex(h){const a=h.length;if(a<=1)return[h];const u=[];let g,y;for(let T=0;T<a;T++){const S=pn(h[T]);S!==0&&(y===void 0&&(y=S<0),y===S<0?(g&&u.push(g),g=[h[T]]):g&&g.push(h[T]))}return g&&u.push(g),u}function pn(h){let a=0;for(let u,g,y=0,T=h.length,S=T-1;y<T;S=y++)u=h[y],g=h[S],a+=(g.x-u.x)*(u.y+g.y);return a}Gd.types=["Unknown","Point","LineString","Polygon"];class Dn{constructor(a,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Ur,this,u),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const u=this._pbf.readVarint()+this._pbf.pos;return new Gd(this._pbf,u,this.extent,this._keys,this._values)}}function Ur(h,a,u){h===15?a.version=u.readVarint():h===1?a.name=u.readString():h===5?a.extent=u.readVarint():h===2?a._features.push(u.pos):h===3?a._keys.push(u.readString()):h===4&&a._values.push((function(g){let y=null;const T=g.readVarint()+g.pos;for(;g.pos<T;){const S=g.readVarint()>>3;y=S===1?g.readString():S===2?g.readFloat():S===3?g.readDouble():S===4?g.readVarint64():S===5?g.readVarint():S===6?g.readSVarint():S===7?g.readBoolean():null}if(y==null)throw new Error("unknown feature value");return y})(u))}class Vr{constructor(a,u){this.layers=a.readFields(bn,{},u)}}function bn(h,a,u){if(h===3){const g=new Dn(u,u.readVarint()+u.pos);g.length&&(a[g.name]=g)}}const la=Math.pow(2,13);function Wo(h,a,u,g,y,T,S,M){h.emplaceBack(a,u,2*Math.floor(g*la)+S,y*la*2,T*la*2,Math.round(M))}class lh{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new Ae,this.centroidVertexArray=new _e,this.indexArray=new ot,this.programConfigurations=new Jl(a.layers,a.zoom),this.segments=new $t,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,g){this.features=[],this.hasDependencies=lo("fill-extrusion",this.layers,u);for(const{feature:y,id:T,index:S,sourceLayerIndex:M}of a){const R=this.layers[0]._featureFilter.needGeometry,L=oo(y,R);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),L,g))continue;const F={id:T,sourceLayerIndex:M,index:S,geometry:R?L.geometry:pl(y),properties:y.properties,type:y.type,patterns:{}};this.hasDependencies?this.features.push(l_("fill-extrusion",this.layers,F,{zoom:this.zoom},u)):this.addFeature(F,F.geometry,S,g,{},u.subdivisionGranularity),u.featureIndex.insert(y,F.geometry,S,M,this.index,!0)}}addFeatures(a,u,g){for(const y of this.features){const{geometry:T}=y;this.addFeature(y,T,y.index,u,g,a.subdivisionGranularity)}}update(a,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:g})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,d_),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Jb.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,g,y,T,S){for(const M of nf(u,500)){const R={x:0,y:0,sampleCount:0},L=this.layoutVertexArray.length;this.processPolygon(R,y,a,M,S);const F=this.layoutVertexArray.length-L,U=Math.floor(R.x/R.sampleCount),q=Math.floor(R.y/R.sampleCount);for(let X=0;X<F;X++)this.centroidVertexArray.emplaceBack(U,q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,g,{imagePositions:T,canonical:y})}processPolygon(a,u,g,y,T){if(y.length<1||ui(y[0]))return;for(const U of y)U.length!==0&&bv(a,U);const S={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},M=T.fill.getGranularityForZoomLevel(u.z),R=Gd.types[g.type]==="Polygon";for(const U of y){if(U.length===0||ui(U))continue;const q=nu(U,M,R);this._generateSideFaces(q,S)}if(!R)return;const L=f_(y,u,M,!1),F=this.layoutVertexArray;vv(((U,q)=>{Wo(F,U,q,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,L.verticesFlattened,L.indicesTriangles)}_generateSideFaces(a,u){let g=0;for(let y=1;y<a.length;y++){const T=a[y],S=a[y-1];if(iu(T,S))continue;u.segment.vertexLength+4>$t.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const M=T.sub(S)._perp()._unit(),R=S.dist(T);g+R>32768&&(g=0),Wo(this.layoutVertexArray,T.x,T.y,M.x,M.y,0,0,g),Wo(this.layoutVertexArray,T.x,T.y,M.x,M.y,0,1,g),g+=R,Wo(this.layoutVertexArray,S.x,S.y,M.x,M.y,0,0,g),Wo(this.layoutVertexArray,S.x,S.y,M.x,M.y,0,1,g);const L=u.segment.vertexLength;this.indexArray.emplaceBack(L,L+2,L+1),this.indexArray.emplaceBack(L+1,L+2,L+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function bv(h,a){for(let u=0;u<a.length;u++){const g=a[u];u===a.length-1&&a[0].x===g.x&&a[0].y===g.y||(h.x+=g.x,h.y+=g.y,h.sampleCount++)}}function iu(h,a){return h.x===a.x&&(h.x<0||h.x>Ue)||h.y===a.y&&(h.y<0||h.y>Ue)}function ui(h){return h.every((a=>a.x<0))||h.every((a=>a.x>Ue))||h.every((a=>a.y<0))||h.every((a=>a.y>Ue))}let su;Ht("FillExtrusionBucket",lh,{omit:["layers","features"]});var kf={get paint(){return su=su||new ri({"fill-extrusion-opacity":new qt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new er(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Oa(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new er(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new er(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xv extends Bn{constructor(a,u){super(a,kf,u)}createBucket(a){return new lh(a)}queryRadius(){return Jp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:g,geometry:y,transform:T,pixelsToTileUnits:S,pixelPosMatrix:M}){const R=e_(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,S),L=this.paint.get("fill-extrusion-height").evaluate(u,g),F=this.paint.get("fill-extrusion-base").evaluate(u,g),U=(function(X,Q){const te=[];for(const ae of X){const de=[ae.x,ae.y,0,1];St(de,de,Q),te.push(new m(de[0]/de[3],de[1]/de[3]))}return te})(R,M),q=(function(X,Q,te,ae){const de=[],Te=[],he=ae[8]*Q,ve=ae[9]*Q,Oe=ae[10]*Q,Fe=ae[11]*Q,it=ae[8]*te,vt=ae[9]*te,xt=ae[10]*te,It=ae[11]*te;for(const Vt of X){const kt=[],wt=[];for(const pt of Vt){const Gt=pt.x,Jt=pt.y,ar=ae[0]*Gt+ae[4]*Jt+ae[12],tr=ae[1]*Gt+ae[5]*Jt+ae[13],Or=ae[2]*Gt+ae[6]*Jt+ae[14],Qn=ae[3]*Gt+ae[7]*Jt+ae[15],Li=Or+Oe,Ls=Qn+Fe,cc=ar+it,Ua=tr+vt,ds=Or+xt,Ns=Qn+It,gi=new m((ar+he)/Ls,(tr+ve)/Ls);gi.z=Li/Ls,kt.push(gi);const ps=new m(cc/Ns,Ua/Ns);ps.z=ds/Ns,wt.push(ps)}de.push(kt),Te.push(wt)}return[de,Te]})(y,F,L,M);return(function(X,Q,te){let ae=1/0;Qm(te,Q)&&(ae=Lf(te,Q[0]));for(let de=0;de<Q.length;de++){const Te=Q[de],he=X[de];for(let ve=0;ve<Te.length-1;ve++){const Oe=Te[ve],Fe=[Oe,Te[ve+1],he[ve+1],he[ve],Oe];If(te,Fe)&&(ae=Math.min(ae,Lf(te,Fe)))}}return ae!==1/0&&ae})(q[0],q[1],U)}}function fs(h,a){return h.x*a.x+h.y*a.y}function Lf(h,a){if(h.length===1){let u=0;const g=a[u++];let y;for(;!y||g.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const T=a[u],S=h[0],M=y.sub(g),R=T.sub(g),L=S.sub(g),F=fs(M,M),U=fs(M,R),q=fs(R,R),X=fs(L,M),Q=fs(L,R),te=F*q-U*U,ae=(q*X-U*Q)/te,de=(F*Q-U*X)/te,Te=g.z*(1-ae-de)+y.z*ae+T.z*de;if(isFinite(Te))return Te}return 1/0}{let u=1/0;for(const g of a)u=Math.min(u,g.z);return u}}const dg=Rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ba}=dg,wv=Rn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:p_}=wv,tx=Math.cos(Math.PI/180*37.5),pg=Math.pow(2,14)/.5;class Zd{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new ke,this.layoutVertexArray2=new Se,this.indexArray=new ot,this.programConfigurations=new Jl(a.layers,a.zoom),this.segments=new $t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,g){this.hasDependencies=lo("line",this.layers,u)||this.hasLineDasharray(this.layers);const y=this.layers[0].layout.get("line-sort-key"),T=!y.isConstant(),S=[];for(const{feature:M,id:R,index:L,sourceLayerIndex:F}of a){const U=this.layers[0]._featureFilter.needGeometry,q=oo(M,U);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),q,g))continue;const X=T?y.evaluate(q,{},g):void 0,Q={id:R,properties:M.properties,type:M.type,sourceLayerIndex:F,index:L,geometry:U?q.geometry:pl(M),patterns:{},dashes:{},sortKey:X};S.push(Q)}T&&S.sort(((M,R)=>M.sortKey-R.sortKey));for(const M of S){const{geometry:R,index:L,sourceLayerIndex:F}=M;this.hasDependencies?(lo("line",this.layers,u)?l_("line",this.layers,M,{zoom:this.zoom},u):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,M,this.zoom,u),this.patternFeatures.push(M)):this.addFeature(M,R,L,g,{},{},u.subdivisionGranularity),u.featureIndex.insert(a[L].feature,R,L,F,this.index)}}update(a,u,g,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:g,dashPositions:y})}addFeatures(a,u,g,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,u,g,y,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,p_)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ba),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,g,y,T,S,M){const R=this.layers[0].layout,L=R.get("line-join").evaluate(a,{}),F=R.get("line-cap"),U=R.get("line-miter-limit"),q=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const X of u)this.addLine(X,a,L,F,U,q,y,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,g,{imagePositions:T,dashPositions:S,canonical:y})}addLine(a,u,g,y,T,S,M,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,a=nu(a,M?R.line.getGranularityForZoomLevel(M.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<a.length-1;he++)this.totalDistance+=a[he].dist(a[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Gd.types[u.type]==="Polygon";let F=a.length;for(;F>=2&&a[F-1].equals(a[F-2]);)F--;let U=0;for(;U<F-1&&a[U].equals(a[U+1]);)U++;if(F<(L?3:2))return;g==="bevel"&&(T=1.05);const q=this.overscaling<=16?122880/(512*this.overscaling):0,X=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let Q,te,ae,de,Te;this.e1=this.e2=-1,L&&(Q=a[F-2],Te=a[U].sub(Q)._unit()._perp());for(let he=U;he<F;he++){if(ae=he===F-1?L?a[U+1]:void 0:a[he+1],ae&&a[he].equals(ae))continue;Te&&(de=Te),Q&&(te=Q),Q=a[he],Te=ae?ae.sub(Q)._unit()._perp():de,de=de||Te;let ve=de.add(Te);ve.x===0&&ve.y===0||ve._unit();const Oe=de.x*Te.x+de.y*Te.y,Fe=ve.x*Te.x+ve.y*Te.y,it=Fe!==0?1/Fe:1/0,vt=2*Math.sqrt(2-2*Fe),xt=Fe<tx&&te&&ae,It=de.x*Te.y-de.y*Te.x>0;if(xt&&he>U){const wt=Q.dist(te);if(wt>2*q){const pt=Q.sub(Q.sub(te)._mult(q/wt)._round());this.updateDistance(te,pt),this.addCurrentVertex(pt,de,0,0,X),te=pt}}const Vt=te&&ae;let kt=Vt?g:L?"butt":y;if(Vt&&kt==="round"&&(it<S?kt="miter":it<=2&&(kt="fakeround")),kt==="miter"&&it>T&&(kt="bevel"),kt==="bevel"&&(it>2&&(kt="flipbevel"),it<T&&(kt="miter")),te&&this.updateDistance(te,Q),kt==="miter")ve._mult(it),this.addCurrentVertex(Q,ve,0,0,X);else if(kt==="flipbevel"){if(it>100)ve=Te.mult(-1);else{const wt=it*de.add(Te).mag()/de.sub(Te).mag();ve._perp()._mult(wt*(It?-1:1))}this.addCurrentVertex(Q,ve,0,0,X),this.addCurrentVertex(Q,ve.mult(-1),0,0,X)}else if(kt==="bevel"||kt==="fakeround"){const wt=-Math.sqrt(it*it-1),pt=It?wt:0,Gt=It?0:wt;if(te&&this.addCurrentVertex(Q,de,pt,Gt,X),kt==="fakeround"){const Jt=Math.round(180*vt/Math.PI/20);for(let ar=1;ar<Jt;ar++){let tr=ar/Jt;if(tr!==.5){const Qn=tr-.5;tr+=tr*Qn*(tr-1)*((1.0904+Oe*(Oe*(3.55645-1.43519*Oe)-3.2452))*Qn*Qn+(.848013+Oe*(.215638*Oe-1.06021)))}const Or=Te.sub(de)._mult(tr)._add(de)._unit()._mult(It?-1:1);this.addHalfVertex(Q,Or.x,Or.y,!1,It,0,X)}}ae&&this.addCurrentVertex(Q,Te,-pt,-Gt,X)}else if(kt==="butt")this.addCurrentVertex(Q,ve,0,0,X);else if(kt==="square"){const wt=te?1:-1;this.addCurrentVertex(Q,ve,wt,wt,X)}else kt==="round"&&(te&&(this.addCurrentVertex(Q,de,0,0,X),this.addCurrentVertex(Q,de,1,1,X,!0)),ae&&(this.addCurrentVertex(Q,Te,-1,-1,X,!0),this.addCurrentVertex(Q,Te,0,0,X)));if(xt&&he<F-1){const wt=Q.dist(ae);if(wt>2*q){const pt=Q.add(ae.sub(Q)._mult(q/wt)._round());this.updateDistance(Q,pt),this.addCurrentVertex(pt,Te,0,0,X),Q=pt}}}}addCurrentVertex(a,u,g,y,T,S=!1){const M=u.y*y-u.x,R=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*g,u.y-u.x*g,S,!1,g,T),this.addHalfVertex(a,M,R,S,!0,-y,T),this.distance>pg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,g,y,T,S))}addHalfVertex({x:a,y:u},g,y,T,S,M,R){const L=.5*(this.lineClips?this.scaledDistance*(pg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(T?1:0),(u<<1)+(S?1:0),Math.round(63*g)+128,Math.round(63*y)+128,1+(M===0?0:M<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),R.primitiveLength++),S?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}hasLineDasharray(a){for(const u of a){const g=u.paint.get("line-dasharray");if(g&&!g.isConstant())return!0}return!1}addLineDashDependencies(a,u,g,y){for(const T of a){const S=T.paint.get("line-dasharray");if(!S||S.value.kind==="constant")continue;const M=T.layout.get("line-cap")==="round",R={dasharray:S.value.evaluate({zoom:g-1},u,{}),round:M},L={dasharray:S.value.evaluate({zoom:g},u,{}),round:M},F={dasharray:S.value.evaluate({zoom:g+1},u,{}),round:M},U=`${R.dasharray.join(",")},${R.round}`,q=`${L.dasharray.join(",")},${L.round}`,X=`${F.dasharray.join(",")},${F.round}`;y.dashDependencies[U]=R,y.dashDependencies[q]=L,y.dashDependencies[X]=F,u.dashes[T.id]={min:U,mid:q,max:X}}}}let au,Di;Ht("LineBucket",Zd,{omit:["layers","patternFeatures"]});var ou={get paint(){return Di=Di||new ri({"line-opacity":new er(Le.paint_line["line-opacity"]),"line-color":new er(Le.paint_line["line-color"]),"line-translate":new qt(Le.paint_line["line-translate"]),"line-translate-anchor":new qt(Le.paint_line["line-translate-anchor"]),"line-width":new er(Le.paint_line["line-width"]),"line-gap-width":new er(Le.paint_line["line-gap-width"]),"line-offset":new er(Le.paint_line["line-offset"]),"line-blur":new er(Le.paint_line["line-blur"]),"line-dasharray":new Oa(Le.paint_line["line-dasharray"]),"line-pattern":new Oa(Le.paint_line["line-pattern"]),"line-gradient":new Tf(Le.paint_line["line-gradient"])})},get layout(){return au=au||new ri({"line-cap":new qt(Le.layout_line["line-cap"]),"line-join":new er(Le.layout_line["line-join"]),"line-miter-limit":new qt(Le.layout_line["line-miter-limit"]),"line-round-limit":new qt(Le.layout_line["line-round-limit"]),"line-sort-key":new er(Le.layout_line["line-sort-key"])})}};class Yd extends er{possiblyEvaluate(a,u){return u=new tn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,g,y){return u=nr({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,g,y)}}let Ho;class Tv extends Bn{constructor(a,u){super(a,ou,u),this.gradientVersion=0,Ho||(Ho=new Yd(ou.paint.properties["line-width"].specification),Ho.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!(function(g){return g._styleExpression!==void 0})(u)&&u._styleExpression.expression instanceof Fl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=Ho.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Zd(a)}queryRadius(a){const u=a,g=g_(Jc("line-width",this,u),Jc("line-gap-width",this,u)),y=Jc("line-offset",this,u);return g/2+Math.abs(y)+Jp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:g,geometry:y,transform:T,pixelsToTileUnits:S}){const M=e_(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,S),R=S/2*g_(this.paint.get("line-width").evaluate(u,g),this.paint.get("line-gap-width").evaluate(u,g)),L=this.paint.get("line-offset").evaluate(u,g);return L&&(y=(function(F,U){const q=[];for(let X=0;X<F.length;X++){const Q=t_(F[X]),te=[];for(let ae=0;ae<Q.length;ae++){const de=Q[ae],Te=Q[ae-1],he=Q[ae+1],ve=ae===0?new m(0,0):de.sub(Te)._unit()._perp(),Oe=ae===Q.length-1?new m(0,0):he.sub(de)._unit()._perp(),Fe=ve._add(Oe)._unit(),it=Fe.x*Oe.x+Fe.y*Oe.y;it!==0&&Fe._mult(1/it),te.push(Fe._mult(U)._add(de))}q.push(te)}return q})(y,L*S)),(function(F,U,q){for(let X=0;X<U.length;X++){const Q=U[X];if(F.length>=3){for(let te=0;te<Q.length;te++)if(tc(F,Q[te]))return!0}if(Ii(F,Q,q))return!0}return!1})(M,y,R)}isTileClipped(){return!0}}function g_(h,a){return a>0?a+2*h:h}const rx=Rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gg=Rn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sv=Rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Rn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fa=Rn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nx=Rn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ja(h,a,u){return h.sections.forEach((g=>{g.text=(function(y,T,S){const M=T.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?y=y.toLocaleUpperCase():M==="lowercase"&&(y=y.toLocaleLowerCase()),Ra.applyArabicShaping&&(y=Ra.applyArabicShaping(y)),y})(g.text,a,u)})),h}Rn([{name:"triangle",components:3,type:"Uint16"}]),Rn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Rn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Rn([{type:"Float32",name:"offsetX"}]),Rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Rn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Si=24;const Kd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},b2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ch={40:!0};function mg(h,a,u,g,y,T){if("fontStack"in a){const S=u[a.fontStack],M=S&&S[h];return M?M.metrics.advance*a.scale+y:0}{const S=g[a.imageName];return S?S.displaySize[0]*a.scale*Si/T+y:0}}function m_(h,a,u,g){const y=Math.pow(h-a,2);return g?h<a?y/2:2*y:y+Math.abs(u)*u}function Qd(h,a,u){let g=0;return h===10&&(g-=1e4),u&&(g+=150),h!==40&&h!==65288||(g+=50),a!==41&&a!==65289||(g+=50),g}function Av(h,a,u,g,y,T){let S=null,M=m_(a,u,y,T);for(const R of g){const L=m_(a-R.x,u,y,T)+R.badness;L<=M&&(S=R,M=L)}return{index:h,x:a,priorBreak:S,badness:M}}function Ev(h){return h?Ev(h.priorBreak).concat(h.index):[]}class Nf{constructor(a="",u=[],g=[]){this.text=a,this.sections=u,this.sectionIndex=g,this.imageSectionID=null}static fromFeature(a,u){const g=new Nf;for(let y=0;y<a.sections.length;y++){const T=a.sections[y];T.image?g.addImageSection(T):g.addTextSection(T,u)}return g}length(){return[...this.text].length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}verticalizePunctuation(){this.text=(function(a){let u="",g={premature:!0,value:void 0};const y=a[Symbol.iterator]();let T=y.next();const S=a[Symbol.iterator]();S.next();let M=S.next();for(;!T.done;)u+=!M.done&&Fo(M.value.codePointAt(0))&&!Kd[M.value]||!g.premature&&Fo(g.value.codePointAt(0))&&!Kd[g.value]||!Kd[T.value]?T.value:Kd[T.value],g={value:T.value,premature:!1},T=y.next(),M=S.next();return u})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const a=this.text.match(/^\s*/),u=a?a[0].length:0,g=this.text.match(/\S\s*$/),y=g?g[0].length-1:0;this.text=this.text.substring(u,this.text.length-y),this.sectionIndex=this.sectionIndex.slice(u,this.sectionIndex.length-y)}substring(a,u){const g=[...this.text].slice(a,u).join(""),y=this.sectionIndex.slice(a,u);return new Nf(g,this.sections,y)}toCodeUnitIndex(a){return[...this.text].slice(0,a).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((a,u)=>Math.max(a,this.sections[u].scale)),0)}getMaxImageSize(a){let u=0,g=0;for(let y=0;y<this.length();y++){const T=this.getSection(y);if("imageName"in T){const S=a[T.imageName];if(!S)continue;const M=S.displaySize;u=Math.max(u,M[0]),g=Math.max(g,M[1])}}return{maxImageWidth:u,maxImageHeight:g}}addTextSection(a,u){this.text+=a.text,this.sections.push({scale:a.scale||1,verticalAlign:a.verticalAlign||"bottom",fontStack:a.fontStack||u});const g=this.sections.length-1;this.sectionIndex.push(...[...a.text].map((()=>g)))}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void _r("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push({scale:1,verticalAlign:a.verticalAlign||"bottom",imageName:u}),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(a,u,g,y,T){const S=[],M=this.determineAverageLineWidth(a,u,g,y,T),R=this.hasZeroWidthSpaces();let L=0,F=0;const U=this.text[Symbol.iterator]();let q=U.next();const X=this.text[Symbol.iterator]();X.next();let Q=X.next();const te=this.text[Symbol.iterator]();te.next(),te.next();let ae=te.next();for(;!q.done;){const de=this.getSection(F),Te=q.value.codePointAt(0);if(yf(Te)||(L+=mg(Te,de,g,y,a,T)),!Q.done){const he=No(Te),ve=Q.value.codePointAt(0);(b2[Te]||he||"imageName"in de||!ae.done&&ch[ve])&&S.push(Av(F+1,L,M,S,Qd(Te,ve,he&&R),!1))}F++,q=U.next(),Q=X.next(),ae=te.next()}return Ev(Av(this.length(),L,M,S,0,!0))}determineAverageLineWidth(a,u,g,y,T){let S=0,M=0;for(const R of this.text){const L=this.getSection(M);S+=mg(R.codePointAt(0),L,g,y,a,T),M++}return S/Math.max(1,Math.ceil(S/u))}}const __=4294967296,_g=1/__,y_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class v_{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,u,g=this.length){for(;this.pos<g;){const y=this.readVarint(),T=y>>3,S=this.pos;this.type=7&y,a(T,u,this),this.pos===S&&this.skip(y)}return u}readMessage(a,u){return this.readFields(a,u,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*__;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*__;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const u=this.buf;let g,y;return y=u[this.pos++],g=127&y,y<128?g:(y=u[this.pos++],g|=(127&y)<<7,y<128?g:(y=u[this.pos++],g|=(127&y)<<14,y<128?g:(y=u[this.pos++],g|=(127&y)<<21,y<128?g:(y=u[this.pos],g|=(15&y)<<28,(function(T,S,M){const R=M.buf;let L,F;if(F=R[M.pos++],L=(112&F)>>4,F<128||(F=R[M.pos++],L|=(127&F)<<3,F<128)||(F=R[M.pos++],L|=(127&F)<<10,F<128)||(F=R[M.pos++],L|=(127&F)<<17,F<128)||(F=R[M.pos++],L|=(127&F)<<24,F<128)||(F=R[M.pos++],L|=(1&F)<<31,F<128))return Jd(T,L,S);throw new Error("Expected varint not more than 10 bytes")})(g,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&y_?y_.decode(this.buf.subarray(u,a)):(function(g,y,T){let S="",M=y;for(;M<T;){const R=g[M];let L,F,U,q=null,X=R>239?4:R>223?3:R>191?2:1;if(M+X>T)break;X===1?R<128&&(q=R):X===2?(L=g[M+1],(192&L)==128&&(q=(31&R)<<6|63&L,q<=127&&(q=null))):X===3?(L=g[M+1],F=g[M+2],(192&L)==128&&(192&F)==128&&(q=(15&R)<<12|(63&L)<<6|63&F,(q<=2047||q>=55296&&q<=57343)&&(q=null))):X===4&&(L=g[M+1],F=g[M+2],U=g[M+3],(192&L)==128&&(192&F)==128&&(192&U)==128&&(q=(15&R)<<18|(63&L)<<12|(63&F)<<6|63&U,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,X=1):q>65535&&(q-=65536,S+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),S+=String.fromCharCode(q),M+=X}return S})(this.buf,u,a)}readBytes(){const a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u}readPackedVarint(a=[],u){const g=this.readPackedEnd();for(;this.pos<g;)a.push(this.readVarint(u));return a}readPackedSVarint(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const u=7&a;if(u===0)for(;this.buf[this.pos++]>127;);else if(u===2)this.pos=this.readVarint()+this.pos;else if(u===5)this.pos+=4;else{if(u!==1)throw new Error(`Unimplemented type: ${u}`);this.pos+=8}}writeTag(a,u){this.writeVarint(a<<3|u)}realloc(a){let u=this.length||16;for(;u<this.pos+a;)u*=2;if(u!==this.length){const g=new Uint8Array(u);g.set(this.buf),this.buf=g,this.dataView=new DataView(g.buffer),this.length=u}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*_g),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*_g),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(u,g){let y,T;if(u>=0?(y=u%4294967296|0,T=u/4294967296|0):(y=~(-u%4294967296),T=~(-u/4294967296),4294967295^y?y=y+1|0:(y=0,T=T+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),(function(S,M,R){R.buf[R.pos++]=127&S|128,S>>>=7,R.buf[R.pos++]=127&S|128,S>>>=7,R.buf[R.pos++]=127&S|128,S>>>=7,R.buf[R.pos++]=127&S|128,R.buf[R.pos]=127&(S>>>=7)})(y,0,g),(function(S,M){const R=(7&S)<<4;M.buf[M.pos++]|=R|((S>>>=3)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S)))))})(T,g)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const u=this.pos;this.pos=(function(y,T,S){for(let M,R,L=0;L<T.length;L++){if(M=T.charCodeAt(L),M>55295&&M<57344){if(!R){M>56319||L+1===T.length?(y[S++]=239,y[S++]=191,y[S++]=189):R=M;continue}if(M<56320){y[S++]=239,y[S++]=191,y[S++]=189,R=M;continue}M=R-55296<<10|M-56320|65536,R=null}else R&&(y[S++]=239,y[S++]=191,y[S++]=189,R=null);M<128?y[S++]=M:(M<2048?y[S++]=M>>6|192:(M<65536?y[S++]=M>>12|224:(y[S++]=M>>18|240,y[S++]=M>>12&63|128),y[S++]=M>>6&63|128),y[S++]=63&M|128)}return S})(this.buf,a,this.pos);const g=this.pos-u;g>=128&&ix(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const u=a.length;this.writeVarint(u),this.realloc(u);for(let g=0;g<u;g++)this.buf[this.pos++]=a[g]}writeRawMessage(a,u){this.pos++;const g=this.pos;a(u,this);const y=this.pos-g;y>=128&&ix(g,y,this),this.pos=g-1,this.writeVarint(y),this.pos+=y}writeMessage(a,u,g){this.writeTag(a,2),this.writeRawMessage(u,g)}writePackedVarint(a,u){u.length&&this.writeMessage(a,sx,u)}writePackedSVarint(a,u){u.length&&this.writeMessage(a,ax,u)}writePackedBoolean(a,u){u.length&&this.writeMessage(a,ox,u)}writePackedFloat(a,u){u.length&&this.writeMessage(a,ep,u)}writePackedDouble(a,u){u.length&&this.writeMessage(a,b_,u)}writePackedFixed32(a,u){u.length&&this.writeMessage(a,lx,u)}writePackedSFixed32(a,u){u.length&&this.writeMessage(a,cx,u)}writePackedFixed64(a,u){u.length&&this.writeMessage(a,ux,u)}writePackedSFixed64(a,u){u.length&&this.writeMessage(a,hx,u)}writeBytesField(a,u){this.writeTag(a,2),this.writeBytes(u)}writeFixed32Field(a,u){this.writeTag(a,5),this.writeFixed32(u)}writeSFixed32Field(a,u){this.writeTag(a,5),this.writeSFixed32(u)}writeFixed64Field(a,u){this.writeTag(a,1),this.writeFixed64(u)}writeSFixed64Field(a,u){this.writeTag(a,1),this.writeSFixed64(u)}writeVarintField(a,u){this.writeTag(a,0),this.writeVarint(u)}writeSVarintField(a,u){this.writeTag(a,0),this.writeSVarint(u)}writeStringField(a,u){this.writeTag(a,2),this.writeString(u)}writeFloatField(a,u){this.writeTag(a,5),this.writeFloat(u)}writeDoubleField(a,u){this.writeTag(a,1),this.writeDouble(u)}writeBooleanField(a,u){this.writeVarintField(a,+u)}}function Jd(h,a,u){return u?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function ix(h,a,u){const g=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(g);for(let y=u.pos-1;y>=h;y--)u.buf[y+g]=u.buf[y]}function sx(h,a){for(let u=0;u<h.length;u++)a.writeVarint(h[u])}function ax(h,a){for(let u=0;u<h.length;u++)a.writeSVarint(h[u])}function ep(h,a){for(let u=0;u<h.length;u++)a.writeFloat(h[u])}function b_(h,a){for(let u=0;u<h.length;u++)a.writeDouble(h[u])}function ox(h,a){for(let u=0;u<h.length;u++)a.writeBoolean(h[u])}function lx(h,a){for(let u=0;u<h.length;u++)a.writeFixed32(h[u])}function cx(h,a){for(let u=0;u<h.length;u++)a.writeSFixed32(h[u])}function ux(h,a){for(let u=0;u<h.length;u++)a.writeFixed64(h[u])}function hx(h,a){for(let u=0;u<h.length;u++)a.writeSFixed64(h[u])}function fx(h,a,u){h===1&&u.readMessage(x_,a)}function x_(h,a,u){if(h===3){const{id:g,bitmap:y,width:T,height:S,left:M,top:R,advance:L}=u.readMessage(dx,{});a.push({id:g,bitmap:new rg({width:T+6,height:S+6},y),metrics:{width:T,height:S,left:M,top:R,advance:L}})}}function dx(h,a,u){h===1?a.id=u.readVarint():h===2?a.bitmap=u.readBytes():h===3?a.width=u.readVarint():h===4?a.height=u.readVarint():h===5?a.left=u.readSVarint():h===6?a.top=u.readSVarint():h===7&&(a.advance=u.readVarint())}function Pv(h){let a=0,u=0;for(const S of h)a+=S.w*S.h,u=Math.max(u,S.w);h.sort(((S,M)=>M.h-S.h));const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,T=0;for(const S of h)for(let M=g.length-1;M>=0;M--){const R=g[M];if(!(S.w>R.w||S.h>R.h)){if(S.x=R.x,S.y=R.y,T=Math.max(T,S.y+S.h),y=Math.max(y,S.x+S.w),S.w===R.w&&S.h===R.h){const L=g.pop();L&&M<g.length&&(g[M]=L)}else S.h===R.h?(R.x+=S.w,R.w-=S.w):S.w===R.w?(R.y+=S.h,R.h-=S.h):(g.push({x:R.x+S.w,y:R.y,w:R.w-S.w,h:S.h}),R.y+=S.h,R.h-=S.h);break}}return{w:y,h:T,fill:a/(y*T)||0}}class gn{constructor(a,{pixelRatio:u,version:g,stretchX:y,stretchY:T,content:S,textFitWidth:M,textFitHeight:R}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=T,this.content=S,this.version=g,this.textFitWidth=M,this.textFitHeight=R}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class w_{constructor(a,u){const g={},y={};this.haveRenderCallbacks=[];const T=[];this.addImages(a,g,T),this.addImages(u,y,T);const{w:S,h:M}=Pv(T),R=new Rs({width:S||1,height:M||1});for(const L in a){const F=a[L],U=g[L].paddedRect;Rs.copy(F.data,R,{x:0,y:0},{x:U.x+1,y:U.y+1},F.data)}for(const L in u){const F=u[L],U=y[L].paddedRect,q=U.x+1,X=U.y+1,Q=F.data.width,te=F.data.height;Rs.copy(F.data,R,{x:0,y:0},{x:q,y:X},F.data),Rs.copy(F.data,R,{x:0,y:te-1},{x:q,y:X-1},{width:Q,height:1}),Rs.copy(F.data,R,{x:0,y:0},{x:q,y:X+te},{width:Q,height:1}),Rs.copy(F.data,R,{x:Q-1,y:0},{x:q-1,y:X},{width:1,height:te}),Rs.copy(F.data,R,{x:0,y:0},{x:q+Q,y:X},{width:1,height:te})}this.image=R,this.iconPositions=g,this.patternPositions=y}addImages(a,u,g){for(const y in a){const T=a[y],S={x:0,y:0,w:T.data.width+2,h:T.data.height+2};g.push(S),u[y]=new gn(S,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in a.updatedImages)this.patchUpdatedImage(this.iconPositions[g],a.getImage(g),u),this.patchUpdatedImage(this.patternPositions[g],a.getImage(g),u)}patchUpdatedImage(a,u,g){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,T]=a.tl;g.update(u.data,void 0,{x:y,y:T})}}var uh;function yg(h,a,u,g,y,T,S,M,R,L,F,U,q,X,Q){const te=Nf.fromFeature(h,y);let ae;U===c.az.vertical&&te.verticalizePunctuation();let de=te.determineLineBreaks(L,T,a,g,X);const{processBidirectionalText:Te,processStyledBidirectionalText:he}=Ra;if(Te&&te.sections.length===1){ae=[],de=de.map((it=>te.toCodeUnitIndex(it)));const Fe=Te(te.toString(),de);for(const it of Fe){const vt=[...it].map((()=>0));ae.push(new Nf(it,te.sections,vt))}}else if(he){ae=[],de=de.map((xt=>te.toCodeUnitIndex(xt)));let Fe=0;const it=[];for(const xt of te.text)it.push(...Array(xt.length).fill(te.sectionIndex[Fe])),Fe++;const vt=he(te.text,it,de);for(const xt of vt){const It=[];let Vt="";for(const kt of xt[0])It.push(xt[1][Vt.length]),Vt+=kt;ae.push(new Nf(xt[0],te.sections,It))}}else ae=(function(Fe,it){const vt=[];let xt=0;for(const It of it)vt.push(Fe.substring(xt,It)),xt=It;return xt<Fe.length()&&vt.push(Fe.substring(xt,Fe.length())),vt})(te,de);const ve=[],Oe={positionedLines:ve,text:te.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:U,iconsInText:!1,verticalizable:!1};return(function(Fe,it,vt,xt,It,Vt,kt,wt,pt,Gt,Jt,ar){let tr=0,Or=0,Qn=0,Li=0;const Ls=wt==="right"?1:wt==="left"?0:.5,cc=Si/ar;let Ua=0;for(const gi of It){gi.trim();const ps=gi.getMaxScale(),fa={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Ua]=fa;const da=fa.positionedGlyphs;let ho=0;if(!gi.length()){Or+=Vt,++Ua;continue}const zs=x2(xt,gi,cc);let fo=0;for(const Qi of gi.text){const ii=gi.getSection(fo),Ni=Qi.codePointAt(0),hi=T_(pt,Jt,Ni),Ji={glyph:Ni,imageName:null,x:tr,y:Or+-17,vertical:hi,scale:1,fontStack:"",sectionIndex:gi.getSectionIndex(fo),metrics:null,rect:null};let Vf;if("fontStack"in ii){if(Vf=tp(ii,Ni,hi,zs,it,vt),!Vf)continue;Ji.fontStack=ii.fontStack}else{if(Fe.iconsInText=!0,ii.scale*=cc,Vf=Mv(ii,hi,ps,zs,xt),!Vf)continue;ho=Math.max(ho,Vf.imageOffset),Ji.imageName=ii.imageName}const{rect:gu,metrics:n0,baselineOffset:cp}=Vf;Ji.y+=cp,Ji.scale=ii.scale,Ji.metrics=n0,Ji.rect=gu,da.push(Ji),hi?(Fe.verticalizable=!0,tr+=("imageName"in ii?n0.advance:Si)*ii.scale+Gt):tr+=n0.advance*ii.scale+Gt,fo++}da.length!==0&&(Qn=Math.max(tr-Gt,Qn),S_(da,0,da.length-1,Ls)),tr=0,fa.lineOffset=Math.max(ho,(ps-1)*Si);const uc=Vt*ps+ho;Or+=uc,Li=Math.max(uc,Li),++Ua}const{horizontalAlign:ds,verticalAlign:Ns}=Cv(kt);(function(gi,ps,fa,da,ho,zs,fo,uc,Qi){const ii=(ps-fa)*ho;let Ni=0;Ni=zs!==fo?-uc*da- -17:-da*Qi*fo+.5*fo;for(const hi of gi)for(const Ji of hi.positionedGlyphs)Ji.x+=ii,Ji.y+=Ni})(Fe.positionedLines,Ls,ds,Ns,Qn,Li,Vt,Or,It.length),Fe.top+=-Ns*Or,Fe.bottom=Fe.top+Or,Fe.left+=-ds*Qn,Fe.right=Fe.left+Qn})(Oe,a,u,g,ae,S,M,R,U,L,q,Q),!(function(Fe){for(const it of Fe)if(it.positionedGlyphs.length!==0)return!1;return!0})(ve)&&Oe}function Cv(h){let a=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function x2(h,a,u){const g=a.getMaxScale()*Si,{maxImageWidth:y,maxImageHeight:T}=a.getMaxImageSize(h),S=Math.max(g,T*u);return{verticalLineContentWidth:Math.max(g,y*u),horizontalLineContentHeight:S}}function px(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function T_(h,a,u){return!(h===c.az.horizontal||!a&&!Hc(u)||a&&(yf(u)||(g=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(g)))));var g}function tp(h,a,u,g,y,T){const S=T[h.fontStack],M=(function(L,F,U,q){if(L&&L.rect)return L;const X=F[U.fontStack],Q=X&&X[q];return Q?{rect:null,metrics:Q.metrics}:null})(S&&S[a],y,h,a);if(M===null)return null;let R;if(u)R=g.verticalLineContentWidth-h.scale*Si;else{const L=px(h.verticalAlign);R=(g.horizontalLineContentHeight-h.scale*Si)*L}return{rect:M.rect,metrics:M.metrics,baselineOffset:R}}function Mv(h,a,u,g,y){const T=y[h.imageName];if(!T)return null;const S=T.paddedRect,M=T.displaySize,R={width:M[0],height:M[1],left:1,top:-3,advance:a?M[1]:M[0]};let L;if(a)L=g.verticalLineContentWidth-M[1]*h.scale;else{const F=px(h.verticalAlign);L=(g.horizontalLineContentHeight-M[1]*h.scale)*F}return{rect:S,metrics:R,baselineOffset:L,imageOffset:(a?M[0]:M[1])*h.scale-Si*u}}function S_(h,a,u,g){if(g===0)return;const y=h[u],T=(h[u].x+y.metrics.advance*y.scale)*g;for(let S=a;S<=u;S++)h[S].x-=T}function Iv(h,a,u){const{horizontalAlign:g,verticalAlign:y}=Cv(u),T=a[0]-h.displaySize[0]*g,S=a[1]-h.displaySize[1]*y;return{image:h,top:S,bottom:S+h.displaySize[1],left:T,right:T+h.displaySize[0]}}function lu(h){var a,u;let g=h.left,y=h.top,T=h.right-g,S=h.bottom-y;const M=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",R=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",L=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(R==="proportional"){if(M==="stretchOnly"&&T/S<L||M==="proportional"){const F=Math.ceil(S*L);g*=F/T,T=F}}else if(M==="proportional"&&R==="stretchOnly"&&L!==0&&T/S>L){const F=Math.ceil(T/L);y*=F/S,S=F}return{x1:g,y1:y,x2:g+T,y2:y+S}}function _l(h,a,u,g,y,T){const S=h.image;let M;if(S.content){const ae=S.content,de=S.pixelRatio||1;M=[ae[0]/de,ae[1]/de,S.displaySize[0]-ae[2]/de,S.displaySize[1]-ae[3]/de]}const R=a.left*T,L=a.right*T;let F,U,q,X;u==="width"||u==="both"?(X=y[0]+R-g[3],U=y[0]+L+g[1]):(X=y[0]+(R+L-S.displaySize[0])/2,U=X+S.displaySize[0]);const Q=a.top*T,te=a.bottom*T;return u==="height"||u==="both"?(F=y[1]+Q-g[0],q=y[1]+te+g[2]):(F=y[1]+(Q+te-S.displaySize[1])/2,q=F+S.displaySize[1]),{image:S,top:F,right:U,bottom:q,left:X,collisionPadding:M}}Ht("ImagePosition",gn),Ht("ImageAtlas",w_),c.az=void 0,(uh=c.az||(c.az={}))[uh.none=0]="none",uh[uh.horizontal=1]="horizontal",uh[uh.vertical=2]="vertical",uh[uh.horizontalOnly=3]="horizontalOnly";const co=128,hh=32640;function Rv(h,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new tn(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:y}=u;let T=0;for(;T<g.length&&g[T]<=h;)T++;T=Math.max(0,T-1);let S=T;for(;S<g.length&&g[S]<h+1;)S++;S=Math.min(g.length-1,S);const M=g[T],R=g[S];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:y}:{kind:"camera",minZoom:M,maxZoom:R,minSize:u.evaluate(new tn(M)),maxSize:u.evaluate(new tn(R)),interpolationType:y}}}function A_(h,a,u){let g="never";const y=h.get(a);return y?g=y:h.get(u)&&(g="always"),g}const gx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vg(h,a,u,g,y,T,S,M,R,L,F,U,q){const X=M?Math.min(hh,Math.round(M[0])):0,Q=M?Math.min(hh,Math.round(M[1])):0;h.emplaceBack(a,u,Math.round(32*g),Math.round(32*y),T,S,(X<<1)+(R?1:0),Q,16*L,16*F,256*U,256*q)}function Ov(h,a,u){h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u)}function Dv(h){for(const a of h.sections)if(ll(a.text))return!0;return!1}class E_{constructor(a){this.layoutVertexArray=new Re,this.indexArray=new ot,this.programConfigurations=a,this.segments=new $t,this.dynamicLayoutVertexArray=new Ve,this.opacityVertexArray=new ct,this.hasVisibleVertices=!1,this.placedSymbolArray=new I}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,g,y){this.isEmpty()||(g&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,rx.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,gg.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,gx,!0),this.opacityVertexBuffer.itemSize=1),(g||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",E_);class P_{constructor(a,u,g){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new g,this.segments=new $t,this.collisionVertexArray=new at}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Sv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",P_);class rp{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((S=>S.id)),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rv(this.zoom,u["text-size"]),this.iconSizeData=Rv(this.zoom,u["icon-size"]);const g=this.layers[0].layout,y=g.get("symbol-sort-key"),T=g.get("symbol-z-order");this.canOverlap=A_(g,"text-overlap","text-allow-overlap")!=="never"||A_(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map((S=>c.az[S]))),this.stateDependentLayerIds=this.layers.filter((S=>S.isStateDependent())).map((S=>S.id)),this.sourceID=a.sourceID}createArrays(){this.text=new E_(new Jl(this.layers,this.zoom,(a=>/^text/.test(a)))),this.icon=new E_(new Jl(this.layers,this.zoom,(a=>/^icon/.test(a)))),this.glyphOffsetArray=new $,this.lineVertexArray=new H,this.symbolInstances=new z,this.textAnchorOffsets=new G}calculateGlyphDependencies(a,u,g,y,T){for(const S of a)if(u[S.codePointAt(0)]=!0,(g||y)&&T){const M=Kd[S];M&&(u[M.codePointAt(0)]=!0)}}populate(a,u,g){const y=this.layers[0],T=y.layout,S=T.get("text-font"),M=T.get("text-field"),R=T.get("icon-image"),L=(M.value.kind!=="constant"||M.value.value instanceof bi&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),F=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,U=T.get("symbol-sort-key");if(this.features=[],!L&&!F)return;const q=u.iconDependencies,X=u.glyphDependencies,Q=u.availableImages,te=new tn(this.zoom);for(const{feature:ae,id:de,index:Te,sourceLayerIndex:he}of a){const ve=y._featureFilter.needGeometry,Oe=oo(ae,ve);if(!y._featureFilter.filter(te,Oe,g))continue;let Fe,it;if(ve||(Oe.geometry=pl(ae)),L){const xt=y.getValueAndResolveTokens("text-field",Oe,g,Q),It=bi.factory(xt),Vt=this.hasRTLText=this.hasRTLText||Dv(It);(!Vt||Ra.getRTLTextPluginStatus()==="unavailable"||Vt&&Ra.isParsed())&&(Fe=ja(It,y,Oe))}if(F){const xt=y.getValueAndResolveTokens("icon-image",Oe,g,Q);it=xt instanceof as?xt:as.fromString(xt)}if(!Fe&&!it)continue;const vt=this.sortFeaturesByKey?U.evaluate(Oe,{},g):void 0;if(this.features.push({id:de,text:Fe,icon:it,index:Te,sourceLayerIndex:he,geometry:Oe.geometry,properties:ae.properties,type:Gd.types[ae.type],sortKey:vt}),it&&(q[it.name]=!0),Fe){const xt=S.evaluate(Oe,{},g).join(","),It=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.az.vertical)>=0;for(const Vt of Fe.sections)if(Vt.image)q[Vt.image.name]=!0;else{const kt=zo(Fe.toString()),wt=Vt.fontStack||xt,pt=X[wt]=X[wt]||{};this.calculateGlyphDependencies(Vt.text,pt,It,this.allowVerticalPlacement,kt)}}}T.get("symbol-placement")==="line"&&(this.features=(function(ae){const de={},Te={},he=[];let ve=0;function Oe(xt){he.push(ae[xt]),ve++}function Fe(xt,It,Vt){const kt=Te[xt];return delete Te[xt],Te[It]=kt,he[kt].geometry[0].pop(),he[kt].geometry[0]=he[kt].geometry[0].concat(Vt[0]),kt}function it(xt,It,Vt){const kt=de[It];return delete de[It],de[xt]=kt,he[kt].geometry[0].shift(),he[kt].geometry[0]=Vt[0].concat(he[kt].geometry[0]),kt}function vt(xt,It,Vt){const kt=Vt?It[0][It[0].length-1]:It[0][0];return`${xt}:${kt.x}:${kt.y}`}for(let xt=0;xt<ae.length;xt++){const It=ae[xt],Vt=It.geometry,kt=It.text?It.text.toString():null;if(!kt){Oe(xt);continue}const wt=vt(kt,Vt),pt=vt(kt,Vt,!0);if(wt in Te&&pt in de&&Te[wt]!==de[pt]){const Gt=it(wt,pt,Vt),Jt=Fe(wt,pt,he[Gt].geometry);delete de[wt],delete Te[pt],Te[vt(kt,he[Jt].geometry,!0)]=Jt,he[Gt].geometry=null}else wt in Te?Fe(wt,pt,Vt):pt in de?it(wt,pt,Vt):(Oe(xt),de[wt]=ve-1,Te[pt]=ve-1)}return he.filter((xt=>xt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ae,de)=>ae.sortKey-de.sortKey))}update(a,u,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:g}),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:g}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const g=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),T=a.dist(u[a.segment]);const S={};for(let M=a.segment+1;M<u.length;M++)S[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:y},M<u.length-1&&(y+=u[M+1].dist(u[M]));for(let M=a.segment||0;M>=0;M--)S[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:T},M>0&&(T+=u[M-1].dist(u[M]));for(let M=0;M<u.length;M++){const R=S[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(a,u,g,y,T,S,M,R,L,F,U,q){const X=a.indexArray,Q=a.layoutVertexArray,te=a.segments.prepareSegment(4*u.length,Q,X,this.canOverlap?S.sortKey:void 0),ae=this.glyphOffsetArray.length,de=te.vertexLength,Te=this.allowVerticalPlacement&&M===c.az.vertical?Math.PI/2:0,he=S.text&&S.text.sections;for(let ve=0;ve<u.length;ve++){const{tl:Oe,tr:Fe,bl:it,br:vt,tex:xt,pixelOffsetTL:It,pixelOffsetBR:Vt,minFontScaleX:kt,minFontScaleY:wt,glyphOffset:pt,isSDF:Gt,sectionIndex:Jt}=u[ve],ar=te.vertexLength,tr=pt[1];vg(Q,R.x,R.y,Oe.x,tr+Oe.y,xt.x,xt.y,g,Gt,It.x,It.y,kt,wt),vg(Q,R.x,R.y,Fe.x,tr+Fe.y,xt.x+xt.w,xt.y,g,Gt,Vt.x,It.y,kt,wt),vg(Q,R.x,R.y,it.x,tr+it.y,xt.x,xt.y+xt.h,g,Gt,It.x,Vt.y,kt,wt),vg(Q,R.x,R.y,vt.x,tr+vt.y,xt.x+xt.w,xt.y+xt.h,g,Gt,Vt.x,Vt.y,kt,wt),Ov(a.dynamicLayoutVertexArray,R,Te),X.emplaceBack(ar,ar+2,ar+1),X.emplaceBack(ar+1,ar+2,ar+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),ve!==u.length-1&&Jt===u[ve+1].sectionIndex||a.programConfigurations.populatePaintArrays(Q.length,S,S.index,{imagePositions:{},canonical:q,formattedSection:he&&he[Jt]})}a.placedSymbolArray.emplaceBack(R.x,R.y,ae,this.glyphOffsetArray.length-ae,de,L,F,R.segment,g?g[0]:0,g?g[1]:0,y[0],y[1],M,0,!1,0,U)}_addCollisionDebugVertex(a,u,g,y,T,S){return u.emplaceBack(0,0),a.emplaceBack(g.x,g.y,y,T,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(a,u,g,y,T,S,M){const R=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),L=R.vertexLength,F=T.layoutVertexArray,U=T.collisionVertexArray,q=M.anchorX,X=M.anchorY;this._addCollisionDebugVertex(F,U,S,q,X,new m(a,u)),this._addCollisionDebugVertex(F,U,S,q,X,new m(g,u)),this._addCollisionDebugVertex(F,U,S,q,X,new m(g,y)),this._addCollisionDebugVertex(F,U,S,q,X,new m(a,y)),R.vertexLength+=4;const Q=T.indexArray;Q.emplaceBack(L,L+1),Q.emplaceBack(L+1,L+2),Q.emplaceBack(L+2,L+3),Q.emplaceBack(L+3,L),R.primitiveLength+=4}addDebugCollisionBoxes(a,u,g,y){for(let T=a;T<u;T++){const S=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,y?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new P_(nt,Fa.members,Ft),this.iconCollisionBox=new P_(nt,Fa.members,Ft);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,g,y,T,S,M,R,L){const F={};for(let U=u;U<g;U++){const q=a.get(U);F.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.textFeatureIndex=q.featureIndex;break}for(let U=y;U<T;U++){const q=a.get(U);F.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalTextFeatureIndex=q.featureIndex;break}for(let U=S;U<M;U++){const q=a.get(U);F.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.iconFeatureIndex=q.featureIndex;break}for(let U=R;U<L;U++){const q=a.get(U);F.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalIconFeatureIndex=q.featureIndex;break}return F}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const g=a.placedSymbolArray.get(u),y=g.vertexStartIndex+4*g.numGlyphs;for(let T=g.vertexStartIndex;T<y;T+=4)a.indexArray.emplaceBack(T,T+2,T+1),a.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),g=Math.cos(a),y=[],T=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const R=this.symbolInstances.get(M);y.push(0|Math.round(u*R.anchorX+g*R.anchorY)),T.push(R.featureIndex)}return S.sort(((M,R)=>y[M]-y[R]||T[R]-T[M])),S}addToSortKeyRanges(a,u){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===u?g.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const g=this.symbolInstances.get(u);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(((y,T,S)=>{y>=0&&S.indexOf(y)===T&&this.addIndicesForPlacedSymbol(this.text,y)})),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let C_,M_;Ht("SymbolBucket",rp,{omit:["layers","collisionBoxArray","features","compareText"]}),rp.MAX_GLYPHS=65535,rp.addDynamicAttributes=Ov;var kv={get paint(){return M_=M_||new ri({"icon-opacity":new er(Le.paint_symbol["icon-opacity"]),"icon-color":new er(Le.paint_symbol["icon-color"]),"icon-halo-color":new er(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new er(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new er(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new qt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new qt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new er(Le.paint_symbol["text-opacity"]),"text-color":new er(Le.paint_symbol["text-color"],{runtimeType:Gs,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new er(Le.paint_symbol["text-halo-color"]),"text-halo-width":new er(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new er(Le.paint_symbol["text-halo-blur"]),"text-translate":new qt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new qt(Le.paint_symbol["text-translate-anchor"])})},get layout(){return C_=C_||new ri({"symbol-placement":new qt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new qt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new er(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new qt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new qt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new qt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new er(Le.layout_symbol["icon-size"]),"icon-text-fit":new qt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new er(Le.layout_symbol["icon-image"]),"icon-rotate":new er(Le.layout_symbol["icon-rotate"]),"icon-padding":new er(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new qt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new er(Le.layout_symbol["icon-offset"]),"icon-anchor":new er(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new er(Le.layout_symbol["text-field"]),"text-font":new er(Le.layout_symbol["text-font"]),"text-size":new er(Le.layout_symbol["text-size"]),"text-max-width":new er(Le.layout_symbol["text-max-width"]),"text-line-height":new qt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new er(Le.layout_symbol["text-letter-spacing"]),"text-justify":new er(Le.layout_symbol["text-justify"]),"text-radial-offset":new er(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qt(Le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new er(Le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new er(Le.layout_symbol["text-anchor"]),"text-max-angle":new qt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new qt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new er(Le.layout_symbol["text-rotate"]),"text-padding":new qt(Le.layout_symbol["text-padding"]),"text-keep-upright":new qt(Le.layout_symbol["text-keep-upright"]),"text-transform":new er(Le.layout_symbol["text-transform"]),"text-offset":new er(Le.layout_symbol["text-offset"]),"text-allow-overlap":new qt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new qt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new qt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new qt(Le.layout_symbol["text-optional"])})}};class mx{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:en,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",mx,{omit:["defaultValue"]});class fh extends Bn{constructor(a,u){super(a,kv,u)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const y=[];for(const T of g)y.indexOf(T)<0&&y.push(T);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,g,y){const T=this.layout.get(a).evaluate(u,{},g,y),S=this._unevaluatedLayout._values[a];return S.isDataDriven()||ql(S.value)||!T?T:(function(M,R){return R.replace(/{([^{}]+)}/g,((L,F)=>M&&F in M?String(M[F]):""))})(u.properties,T)}createBucket(a){return new rp(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of kv.paint.overridableProperties){if(!fh.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),g=new mx(u),y=new Id(g,u.property.specification);let T=null;T=u.value.kind==="constant"||u.value.kind==="source"?new hs("source",y):new Xl("composite",y,u.value.zoomStops),this.paint._values[a]=new ia(u.property,T,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,g){return!(!this.layout||u.isDataDriven()||g.isDataDriven())&&fh.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const g=a.get("text-field"),y=kv.paint.properties[u];let T=!1;const S=M=>{for(const R of M)if(y.overrides&&y.overrides.hasOverride(R))return void(T=!0)};if(g.value.kind==="constant"&&g.value.value instanceof bi)S(g.value.value.sections);else if(g.value.kind==="source"||g.value.kind==="composite"){const M=L=>{T||(L instanceof Ys&&Mn(L.value)===bo?S(L.value.sections):L instanceof Jh?S(L.sections):L.eachChild(M))},R=g.value;R._styleExpression&&M(R._styleExpression.expression)}return T}}let _x;var yx={get paint(){return _x=_x||new ri({"background-color":new qt(Le.paint_background["background-color"]),"background-pattern":new rh(Le.paint_background["background-pattern"]),"background-opacity":new qt(Le.paint_background["background-opacity"])})}};class $r extends Bn{constructor(a,u){super(a,yx,u)}}class Lv extends Bn{constructor(a,u){super(a,{},u),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class I_{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Nv={once:!0},R_=63710088e-1;class sc{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sc(Wt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,g=this.lat*u,y=a.lat*u,T=Math.sin(g)*Math.sin(y)+Math.cos(g)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return R_*Math.acos(Math.min(T,1))}static convert(a){if(a instanceof sc)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new sc(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new sc(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const np=2*Math.PI*R_;function bg(h){return np*Math.cos(h*Math.PI/180)}function vx(h){return(180+h)/360}function zv(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function bx(h,a){return h/bg(a)}function xx(h){return 360*h-180}function xg(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function Bv(h,a){return h*bg(xg(a))}class on{constructor(a,u,g=0){this.x=+a,this.y=+u,this.z=+g}static fromLngLat(a,u=0){const g=sc.convert(a);return new on(vx(g.lng),zv(g.lat),bx(u,g.lat))}toLngLat(){return new sc(xx(this.x),xg(this.y))}toAltitude(){return Bv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/np*(a=xg(this.y),1/Math.cos(a*Math.PI/180));var a}}function O_(h,a,u){var g=2*Math.PI*6378137/256/Math.pow(2,u);return[h*g-2*Math.PI*6378137/2,a*g-2*Math.PI*6378137/2]}class qi{constructor(a,u,g){if(!(function(y,T,S){return!(y<0||y>25||S<0||S>=Math.pow(2,y)||T<0||T>=Math.pow(2,y))})(a,u,g))throw new Error(`x=${u}, y=${g}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=g,this.key=ip(0,a,a,u,g)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,g){const y=(S=this.y,M=this.z,R=O_(256*(T=this.x),256*(S=Math.pow(2,M)-S-1),M),L=O_(256*(T+1),256*(S+1),M),R[0]+","+R[1]+","+L[0]+","+L[1]);var T,S,M,R,L;const F=(function(U,q,X){let Q,te="";for(let ae=U;ae>0;ae--)Q=1<<ae-1,te+=(q&Q?1:0)+(X&Q?2:0);return te})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new m((a.x*u-this.x)*Ue,(a.y*u-this.y)*Ue)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wx{constructor(a,u){this.wrap=a,this.canonical=u,this.key=ip(a,u.z,u.z,u.x,u.y)}}class ca{constructor(a,u,g,y,T){if(this.terrainRttPosMatrix32f=null,a<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${g}`);this.overscaledZ=a,this.wrap=u,this.canonical=new qi(g,+y,+T),this.key=ip(u,a,g,y,T)}clone(){return new ca(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new ca(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-a;return a>this.canonical.z?ip(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):ip(this.wrap*+u,a,a,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(a){if(a.wrap!==this.wrap||this.overscaledZ-a.overscaledZ<=0)return!1;if(a.overscaledZ===0)return this.overscaledZ>0;const u=this.canonical.z-a.canonical.z;return!(u<0)&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,g=2*this.canonical.x,y=2*this.canonical.y;return[new ca(u,this.wrap,u,g,y),new ca(u,this.wrap,u,g+1,y),new ca(u,this.wrap,u,g,y+1),new ca(u,this.wrap,u,g+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new ca(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new on(a.x-this.wrap,a.y))}normalizeCoordinates(a,u,g=8192){if(a>=0&&a<g&&u>=0&&u<g)return{tileID:this,x:a,y:u};const y=Math.floor(a/g),T=Math.floor(u/g),S=a-y*g,M=u-T*g,R=this.canonical.z,L=1<<R,F=this.canonical.y+T;if(F<0||F>=L)return null;let U=this.canonical.x+y,q=this.wrap;return U<0?(q-=Math.ceil(-U/L),U=(U%L+L)%L):U>=L&&(q+=Math.floor(U/L),U%=L),{tileID:new ca(this.overscaledZ,q,R,U,F),x:S,y:M}}}function ip(h,a,u,g,y){(h*=2)<0&&(h=-1*h-1);const T=1<<u;return(T*T*h+T*y+g).toString(36)+u.toString(36)+a.toString(36)}function wg(h,a){return a?h.properties[a]:h.id}function Fv(h,a){const u={id:h.id};if(a.removeAllProperties&&(delete h.removeProperties,delete h.addOrUpdateProperties,delete a.removeProperties),a.removeProperties)for(const g of a.removeProperties){const y=h.addOrUpdateProperties.findIndex((T=>T.key===g));y>-1&&h.addOrUpdateProperties.splice(y,1)}return(h.removeAllProperties||a.removeAllProperties)&&(u.removeAllProperties=!0),(h.removeProperties||a.removeProperties)&&(u.removeProperties=[...h.removeProperties||[],...a.removeProperties||[]]),(h.addOrUpdateProperties||a.addOrUpdateProperties)&&(u.addOrUpdateProperties=[...h.addOrUpdateProperties||[],...a.addOrUpdateProperties||[]]),(h.newGeometry||a.newGeometry)&&(u.newGeometry=a.newGeometry||h.newGeometry),u}function Tg(h){var a,u;if(!h)return{};const g={};return g.removeAll=h.removeAll,g.remove=new Set(h.remove||[]),g.add=new Map((a=h.add)===null||a===void 0?void 0:a.map((y=>[y.id,y]))),g.update=new Map((u=h.update)===null||u===void 0?void 0:u.map((y=>[y.id,y]))),g}Ht("CanonicalTileID",qi),Ht("OverscaledTileID",ca,{omit:["terrainRttPosMatrix32f"]});class dh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(a){return this.minX=Math.min(this.minX,a.x),this.minY=Math.min(this.minY,a.y),this.maxX=Math.max(this.maxX,a.x),this.maxY=Math.max(this.maxY,a.y),this}expandBy(a){return this.minX-=a,this.minY-=a,this.maxX+=a,this.maxY+=a,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(a){return this.expandBy(-a)}map(a){const u=new dh;return u.extend(a(new m(this.minX,this.minY))),u.extend(a(new m(this.maxX,this.minY))),u.extend(a(new m(this.minX,this.maxY))),u.extend(a(new m(this.maxX,this.maxY))),u}static fromPoints(a){const u=new dh;for(const g of a)u.extend(g);return u}contains(a){return a.x>=this.minX&&a.x<=this.maxX&&a.y>=this.minY&&a.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(a){return!this.empty()&&!a.empty()&&a.minX>=this.minX&&a.maxX<=this.maxX&&a.minY>=this.minY&&a.maxY<=this.maxY}intersects(a){return!this.empty()&&!a.empty()&&a.minX<=this.maxX&&a.maxX>=this.minX&&a.minY<=this.maxY&&a.maxY>=this.minY}}class jv{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const g=a[u];this._stringToNumber[g]=u,this._numberToString[u]=g}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class D_{constructor(a,u,g,y,T){this.type="Feature",this._vectorTileFeature=a,this._x=g,this._y=y,this._z=u,this.properties=a.properties,this.id=T}projectPoint(a,u,g,y){return[360*(a.x+u)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(a.y+g)/y)*Math.PI))-90]}projectLine(a,u,g,y){return a.map((T=>this.projectPoint(T,u,g,y)))}get geometry(){if(this._geometry)return this._geometry;const a=this._vectorTileFeature,u=a.extent*Math.pow(2,this._z),g=a.extent*this._x,y=a.extent*this._y,T=a.loadGeometry();switch(a.type){case 1:{const S=[];for(const R of T)S.push(R[0]);const M=this.projectLine(S,g,y,u);this._geometry=S.length===1?{type:"Point",coordinates:M[0]}:{type:"MultiPoint",coordinates:M};break}case 2:{const S=T.map((M=>this.projectLine(M,g,y,u)));this._geometry=S.length===1?{type:"LineString",coordinates:S[0]}:{type:"MultiLineString",coordinates:S};break}case 3:{const S=ex(T),M=[];for(const R of S)M.push(R.map((L=>this.projectLine(L,g,y,u))));this._geometry=M.length===1?{type:"Polygon",coordinates:M[0]}:{type:"MultiPolygon",coordinates:M};break}default:throw new Error(`unknown feature type: ${a.type}`)}return this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&u!=="_x"&&u!=="_y"&&u!=="_z"&&(a[u]=this[u]);return a}}class ph{_name;dataBuffer;nullabilityBuffer;_size;constructor(a,u,g){this._name=a,this.dataBuffer=u,typeof g=="number"?this._size=g:(this.nullabilityBuffer=g,this._size=g.size())}getValue(a){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(a)?null:this.getValueFromBuffer(a)}has(a){return this.nullabilityBuffer&&this.nullabilityBuffer.get(a)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class k_ extends ph{}class L_ extends k_{getValueFromBuffer(a){return this.dataBuffer[a]}}class Uv extends k_{getValueFromBuffer(a){return this.dataBuffer[a]}}class Vv extends ph{delta;constructor(a,u,g,y){super(a,u,y),this.delta=g}}class $v extends Vv{constructor(a,u,g,y){super(a,Int32Array.of(u),g,y)}getValueFromBuffer(a){return this.dataBuffer[0]+a*this.delta}}class Wv extends ph{constructor(a,u,g){super(a,Int32Array.of(u),g)}getValueFromBuffer(a){return this.dataBuffer[0]}}class gh{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(a,u,g,y,T=4096){this._name=a,this._geometryVector=u,this._idVector=g,this._propertyVectors=y,this._extent=T}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(a){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((u=>[u.name,u])))),this.propertyVectorsMap.get(a)}*[Symbol.iterator](){const a=this.geometryVector[Symbol.iterator]();let u=0;for(;u<this.numFeatures;){let g;this.idVector&&(g=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(u)):this.idVector.getValue(u));const y=a?.next().value,T={};for(const S of this.propertyVectors){if(!S)continue;const M=S.name,R=S.getValue(u);R!==null&&(T[M]=R)}u++,yield{id:g,geometry:y,properties:T}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const a=[],u=this.geometryVector.getGeometries();for(let g=0;g<this.numFeatures;g++){let y;this.idVector&&(y=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(g)):this.idVector.getValue(g));const T={coordinates:u[g],type:this.geometryVector.geometryType(g)},S={};for(const M of this.propertyVectors){if(!M)continue;const R=M.name,L=M.getValue(g);L!==null&&(S[R]=L)}a.push({id:y,geometry:T,properties:S})}return a}containsMaxSaveIntegerValues(a){return a instanceof L_||a instanceof Wv&&a instanceof $v||a instanceof Uv}}class Tx{value;constructor(a){this.value=a}get(){return this.value}set(a){this.value=a}increment(){return this.value++}add(a){this.value+=a}}var nn,ac,Yi,yl,mh,Os,jn,ki,uo,ua;function Ki(h,a,u){const g=new Int32Array(u);let y=0,T=a.get();for(let S=0;S<g.length;S++){let M=h[T++],R=127&M;M<128||(M=h[T++],R|=(127&M)<<7,M<128||(M=h[T++],R|=(127&M)<<14,M<128||(M=h[T++],R|=(127&M)<<21,M<128||(M=h[T++],R|=(15&M)<<28)))),g[y++]=R}return a.set(T),g}function N_(h,a,u){const g=new BigInt64Array(u);for(let y=0;y<g.length;y++)g[y]=Sx(h,a);return g}function Sx(h,a){let u=0n,g=0,y=a.get();for(;y<h.length;){const T=h[y++];if(u|=BigInt(127&T)<<BigInt(g),!(128&T))break;if(g+=7,g>=64)throw new Error("Varint too long")}return a.set(y),u}function Sg(h,a){let u,g;return g=h[a.get()],a.increment(),u=127&g,g<128?u:(g=h[a.get()],a.increment(),u|=(127&g)<<7,g<128?u:(g=h[a.get()],a.increment(),u|=(127&g)<<14,g<128?u:(g=h[a.get()],a.increment(),u|=(127&g)<<21,g<128?u:(g=h[a.get()],u|=(15&g)<<28,(function(y,T,S){let M,R;if(R=T[S.get()],S.increment(),M=(112&R)>>4,R<128||(R=T[S.get()],S.increment(),M|=(127&R)<<3,R<128)||(R=T[S.get()],S.increment(),M|=(127&R)<<10,R<128)||(R=T[S.get()],S.increment(),M|=(127&R)<<17,R<128)||(R=T[S.get()],S.increment(),M|=(127&R)<<24,R<128)||(R=T[S.get()],S.increment(),M|=(1&R)<<31,R<128))return 4294967296*M+(y>>>0);throw new Error("Expected varint not more than 10 bytes")})(u,h,a)))))}function Zr(h){return h>>>1^-(1&h)}function ha(h){return h>>1n^-(1n&h)}function cu(h){return h%2==1?(h+1)/-2:h/2}function oc(h,a,u){if(u===void 0){u=0;for(let T=0;T<a;T++)u+=h[T]}const g=new Int32Array(u);let y=0;for(let T=0;T<a;T++){const S=h[T];g.fill(h[T+a],y,y+S),y+=S}return g}function Ax(h,a,u){if(u===void 0){u=0;for(let T=0;T<a;T++)u+=Number(h[T])}const g=new BigInt64Array(u);let y=0;for(let T=0;T<a;T++){const S=Number(h[T]);g.fill(h[T+a],y,y+S),y+=S}return g}function Ex(h,a,u){const g=new Float64Array(u);let y=0;for(let T=0;T<a;T++){const S=h[T];g.fill(h[T+a],y,y+S),y+=S}return g}function zf(h){const a=h.length/4*4;let u=1;if(a>=4)for(let g=h[0];u<a-4;u+=4)g=h[u]+=g,g=h[u+1]+=g,g=h[u+2]+=g,g=h[u+3]+=g;for(;u!=h.length;)h[u]+=h[u-1],++u}(function(h){h.NONE="NONE",h.DELTA="DELTA",h.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",h.RLE="RLE",h.MORTON="MORTON",h.PDE="PDE"})(nn||(nn={})),(function(h){h.NONE="NONE",h.FAST_PFOR="FAST_PFOR",h.VARINT="VARINT",h.ALP="ALP"})(ac||(ac={})),(function(h){h.PRESENT="PRESENT",h.DATA="DATA",h.OFFSET="OFFSET",h.LENGTH="LENGTH"})(Yi||(Yi={}));class z_{_dictionaryType;_offsetType;_lengthType;constructor(a,u,g){this._dictionaryType=a,this._offsetType=u,this._lengthType=g}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ds(h,a){const u=(function(g,y){const T=g[y.get()],S=Object.values(Yi)[T>>4];let M=null;switch(S){case Yi.DATA:M=new z_(Object.values(yl)[15&T]);break;case Yi.OFFSET:M=new z_(null,Object.values(mh)[15&T]);break;case Yi.LENGTH:M=new z_(null,null,Object.values(Os)[15&T])}y.increment();const R=g[y.get()],L=Object.values(nn)[R>>5],F=Object.values(nn)[R>>2&7],U=Object.values(ac)[3&R];y.increment();const q=Ki(g,y,2),X=q[0];return{physicalStreamType:S,logicalStreamType:M,logicalLevelTechnique1:L,logicalLevelTechnique2:F,physicalLevelTechnique:U,numValues:X,byteLength:q[1],decompressedCount:X}})(h,a);return u.logicalLevelTechnique1===nn.MORTON?(function(g,y,T){const S=Ki(y,T,2);return{physicalStreamType:g.physicalStreamType,logicalStreamType:g.logicalStreamType,logicalLevelTechnique1:g.logicalLevelTechnique1,logicalLevelTechnique2:g.logicalLevelTechnique2,physicalLevelTechnique:g.physicalLevelTechnique,numValues:g.numValues,byteLength:g.byteLength,decompressedCount:g.decompressedCount,numBits:S[0],coordinateShift:S[1]}})(u,h,a):nn.RLE!==u.logicalLevelTechnique1&&nn.RLE!==u.logicalLevelTechnique2||ac.NONE===u.physicalLevelTechnique?u:(function(g,y,T){const S=Ki(y,T,2);return{physicalStreamType:g.physicalStreamType,logicalStreamType:g.logicalStreamType,logicalLevelTechnique1:g.logicalLevelTechnique1,logicalLevelTechnique2:g.logicalLevelTechnique2,physicalLevelTechnique:g.physicalLevelTechnique,numValues:g.numValues,byteLength:g.byteLength,decompressedCount:S[1],runs:S[0],numRleValues:S[1]}})(u,h,a)}(function(h){h.NONE="NONE",h.SINGLE="SINGLE",h.SHARED="SHARED",h.VERTEX="VERTEX",h.MORTON="MORTON",h.FSST="FSST"})(yl||(yl={})),(function(h){h.VERTEX="VERTEX",h.INDEX="INDEX",h.STRING="STRING",h.KEY="KEY"})(mh||(mh={})),(function(h){h.VAR_BINARY="VAR_BINARY",h.GEOMETRIES="GEOMETRIES",h.PARTS="PARTS",h.RINGS="RINGS",h.TRIANGLES="TRIANGLES",h.SYMBOL="SYMBOL",h.DICTIONARY="DICTIONARY"})(Os||(Os={})),(function(h){h[h.FLAT=0]="FLAT",h[h.CONST=1]="CONST",h[h.SEQUENCE=2]="SEQUENCE",h[h.DICTIONARY=3]="DICTIONARY",h[h.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(jn||(jn={}));class vl{values;_size;constructor(a,u){this.values=a,this._size=u}get(a){const u=Math.floor(a/8);return(this.values[u]>>a%8&1)==1}set(a,u){const g=Math.floor(a/8);this.values[g]=this.values[g]|(u?1:0)<<a%8}getInt(a){const u=Math.floor(a/8);return this.values[u]>>a%8&1}size(){return this._size}getBuffer(){return this.values}}function B_(h,a,u){if(!a)return h;const g=a.size(),y=new h.constructor(g);let T=0;for(let S=0;S<g;S++)y[S]=a.get(S)?h[T++]:u;return y}function ks(h,a,u,g,y,T){return(function(S,M,R,L,F){switch(M.logicalLevelTechnique1){case nn.DELTA:if(M.logicalLevelTechnique2===nn.RLE){const U=M;if(!F)return(function(q,X,Q){const te=new Int32Array(Q);let ae=0,de=0;for(let Te=0;Te<X;Te++){const he=q[Te],ve=Zr(q[Te+X]);for(let Oe=0;Oe<he;Oe++)de+=ve,te[ae++]=de}return te})(S,U.runs,U.numRleValues);S=oc(S,U.runs,U.numRleValues)}(function(U){U[0]=Zr(U[0]);const q=U.length/4*4;let X=1;if(q>=4)for(;X<q-4;X+=4){const Q=U[X+1],te=U[X+2],ae=U[X+3];U[X]=Zr(U[X])+U[X-1],U[X+1]=Zr(Q)+U[X],U[X+2]=Zr(te)+U[X+1],U[X+3]=Zr(ae)+U[X+2]}for(;X!=U.length;++X)U[X]=Zr(U[X])+U[X-1]})(S);break;case nn.RLE:S=(function(U,q,X){return X?(function(Q,te,ae){if(ae===void 0){ae=0;for(let he=0;he<te;he++)ae+=Q[he]}const de=new Int32Array(ae);let Te=0;for(let he=0;he<te;he++){const ve=Q[he];let Oe=Q[he+te];Oe=Zr(Oe),de.fill(Oe,Te,Te+ve),Te+=ve}return de})(U,q.runs,q.numRleValues):oc(U,q.runs,q.numRleValues)})(S,M,R);break;case nn.MORTON:zf(S);break;case nn.COMPONENTWISE_DELTA:(function(U){if(U.length<2)return;U[0]=Zr(U[0]),U[1]=Zr(U[1]);const q=U.length/4*4;let X=2;if(q>=4)for(;X<q-4;X+=4){const Q=U[X+1],te=U[X+2],ae=U[X+3];U[X]=Zr(U[X])+U[X-2],U[X+1]=Zr(Q)+U[X-1],U[X+2]=Zr(te)+U[X],U[X+3]=Zr(ae)+U[X+1]}for(;X!=U.length;X+=2)U[X]=Zr(U[X])+U[X-2],U[X+1]=Zr(U[X+1])+U[X-1]})(S);break;case nn.NONE:R&&(function(U){for(let q=0;q<U.length;q++)U[q]=Zr(U[q])})(S);break;default:throw new Error(`The specified Logical level technique is not supported: ${M.logicalLevelTechnique1}`)}return F?B_(S,F,0):S})(F_(h,a,u),u,g,0,T)}function _h(h,a,u){return(function(g,y){if(y.logicalLevelTechnique1===nn.DELTA&&y.logicalLevelTechnique2===nn.NONE)return(function(T){const S=new Int32Array(T.length+1);S[0]=0,S[1]=Zr(T[0]);let M=S[1];for(let R=2;R!=S.length;++R)M+=Zr(T[R-1]),S[R]=S[R-1]+M;return new Uint32Array(S)})(g);if(y.logicalLevelTechnique1===nn.RLE&&y.logicalLevelTechnique2===nn.NONE)return(function(T,S,M){const R=new Int32Array(M+1);R[0]=0;let L=1,F=R[0];for(let U=0;U<S;U++){const q=T[U],X=T[U+S];for(let Q=L;Q<L+q;Q++)R[Q]=X+F,F=R[Q];L+=q}return new Uint32Array(R)})(g,y.runs,y.numRleValues);if(y.logicalLevelTechnique1===nn.NONE&&y.logicalLevelTechnique2===nn.NONE){(function(S){let M=0;for(let R=0;R<S.length;R++)S[R]+=M,M=S[R]})(g);const T=new Uint32Array(y.numValues+1);return T[0]=0,T.set(g,1),T}if(y.logicalLevelTechnique1===nn.DELTA&&y.logicalLevelTechnique2===nn.RLE){const T=(function(S,M,R){const L=new Int32Array(R+1);L[0]=0;let F=1,U=L[0];for(let q=0;q<M;q++){const X=S[q];let Q=S[q+M];Q=Zr(Q);for(let te=F;te<F+X;te++)L[te]=Q+U,U=L[te];F+=X}return new Uint32Array(L)})(g,y.runs,y.numRleValues);return zf(T),T}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(F_(h,a,u),u)}function F_(h,a,u){const g=u.physicalLevelTechnique;if(g===ac.FAST_PFOR)return(function(){throw new Error("FastPFor is not implemented yet.")})();if(g===ac.VARINT)return Ki(h,a,u.numValues);if(g===ac.NONE){const y=a.get();a.add(u.byteLength);const T=h.subarray(y,a.get());return new Int32Array(T)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Hv(h,a,u,g){const y=F_(h,a,u);if(y.length===1){const T=y[0];return g?Zr(T):T}return g?(function(T){return Zr(T[1])})(y):(function(T){return T[1]})(y)}function qv(h,a,u){return(function(g){if(g.length==2){const y=Zr(g[1]);return[y,y]}return[Zr(g[2]),Zr(g[3])]})(F_(h,a,u))}function Bf(h,a,u){return(function(g){if(g.length==2){const y=ha(g[1]);return[y,y]}return[ha(g[2]),ha(g[3])]})(N_(h,a,u.numValues))}function sp(h,a,u,g,y){return(function(T,S,M,R){switch(S.logicalLevelTechnique1){case nn.DELTA:if(S.logicalLevelTechnique2===nn.RLE){const L=S;if(!R)return(function(F,U,q){const X=new BigInt64Array(q);let Q=0,te=0n;for(let ae=0;ae<U;ae++){const de=Number(F[ae]),Te=ha(F[ae+U]);for(let he=0;he<de;he++)te+=Te,X[Q++]=te}return X})(T,L.runs,L.numRleValues);T=Ax(T,L.runs,L.numRleValues)}(function(L){L[0]=ha(L[0]);const F=L.length/4*4;let U=1;if(F>=4)for(;U<F-4;U+=4){const q=L[U+1],X=L[U+2],Q=L[U+3];L[U]=ha(L[U])+L[U-1],L[U+1]=ha(q)+L[U],L[U+2]=ha(X)+L[U+1],L[U+3]=ha(Q)+L[U+2]}for(;U!=L.length;++U)L[U]=ha(L[U])+L[U-1]})(T);break;case nn.RLE:T=(function(L,F,U){return U?(function(q,X,Q){if(Q===void 0){Q=0;for(let de=0;de<X;de++)Q+=Number(q[de])}const te=new BigInt64Array(Q);let ae=0;for(let de=0;de<X;de++){const Te=Number(q[de]);let he=q[de+X];he=ha(he),te.fill(he,ae,ae+Te),ae+=Te}return te})(L,F.runs,F.numRleValues):Ax(L,F.runs,F.numRleValues)})(T,S,M);break;case nn.NONE:M&&(function(L){for(let F=0;F<L.length;F++)L[F]=ha(L[F])})(T);break;default:throw new Error(`The specified Logical level technique is not supported: ${S.logicalLevelTechnique1}`)}return R?B_(T,R,0n):T})(N_(h,a,u.numValues),u,g,y)}function Xv(h,a,u,g){const y=N_(h,a,u.numValues);if(y.length===1){const T=y[0];return g?ha(T):T}return g?(function(T){return ha(T[1])})(y):(function(T){return T[1]})(y)}function j_(h,a,u,g){const y=h.logicalLevelTechnique1;if(y===nn.RLE)return h.runs===1?jn.CONST:jn.FLAT;if(y!==nn.DELTA||h.logicalLevelTechnique2!==nn.RLE)return h.numValues===1?jn.CONST:jn.FLAT;const T=a instanceof vl?a.size():a;if(h.numRleValues!==T)return jn.FLAT;if(h.runs===1)return jn.SEQUENCE;if(h.runs!==2)return h.numValues===1?jn.CONST:jn.FLAT;const S=g.get();let M;if(h.physicalLevelTechnique===ac.VARINT)M=Ki(u,g,4);else{const R=g.get();M=new Int32Array(u.buffer,u.byteOffset+R,4)}return g.set(S),M[2]===2&&M[3]===2?jn.SEQUENCE:h.numValues===1?jn.CONST:jn.FLAT}class Ff extends k_{getValueFromBuffer(a){return this.dataBuffer[a]}}class ap extends Vv{constructor(a,u,g,y){super(a,BigInt64Array.of(u),g,y)}getValueFromBuffer(a){return this.dataBuffer[0]+BigInt(a)*this.delta}}class jf{_geometryOffsets;_partOffsets;_ringOffsets;constructor(a,u,g){this._geometryOffsets=a,this._partOffsets=u,this._ringOffsets=g}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function op(h,a,u){return{x:U_(h,a)-u,y:U_(h>>1,a)-u}}function U_(h,a){let u=0;for(let g=0;g<a;g++)u|=(h&1<<2*g)>>g;return u}(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON",h[h.MULTIPOINT=3]="MULTIPOINT",h[h.MULTILINESTRING=4]="MULTILINESTRING",h[h.MULTIPOLYGON=5]="MULTIPOLYGON"})(ki||(ki={})),(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON"})(uo||(uo={})),(function(h){h[h.MORTON=0]="MORTON",h[h.VEC_2=1]="VEC_2",h[h.VEC_3=2]="VEC_3"})(ua||(ua={}));class Gv{createPoint(a){return[[a]]}createMultiPoint(a){return a.map((u=>[u]))}createLineString(a){return[a]}createMultiLineString(a){return a}createPolygon(a,u){return[a].concat(u)}createMultiPolygon(a){return a.flat()}}function Ag(h){const a=new Array(h.numGeometries);let u=1,g=1,y=1,T=0;const S=new Gv;let M=0,R=0;const L=h.mortonSettings,F=h.topologyVector,U=F.geometryOffsets,q=F.partOffsets,X=F.ringOffsets,Q=h.vertexOffsets,te=h.containsPolygonGeometry(),ae=h.vertexBuffer;for(let de=0;de<h.numGeometries;de++){const Te=h.geometryType(de);if(Te===ki.POINT){if(Q&&Q.length!==0)if(h.vertexBufferType===ua.VEC_2){const he=2*Q[R++],ve=new m(ae[he],ae[he+1]);a[T++]=S.createPoint(ve)}else{const he=op(ae[Q[R++]],L.numBits,L.coordinateShift),ve=new m(he.x,he.y);a[T++]=S.createPoint(ve)}else{const he=new m(ae[M++],ae[M++]);a[T++]=S.createPoint(he)}U&&y++,q&&u++,X&&g++}else if(Te===ki.MULTIPOINT){const he=U[y]-U[y-1];y++;const ve=new Array(he);if(Q&&Q.length!==0){for(let Oe=0;Oe<he;Oe++){const Fe=2*Q[R++];ve[Oe]=new m(ae[Fe],ae[Fe+1])}a[T++]=S.createMultiPoint(ve)}else{for(let Oe=0;Oe<he;Oe++){const Fe=ae[M++],it=ae[M++];ve[Oe]=new m(Fe,it)}a[T++]=S.createMultiPoint(ve)}}else if(Te===ki.LINESTRING){let he,ve=0;te?(ve=X[g]-X[g-1],g++):ve=q[u]-q[u-1],u++,Q&&Q.length!==0?(he=h.vertexBufferType===ua.VEC_2?Zv(ae,Q,R,ve,!1):Cg(ae,Q,R,ve,!1,L),R+=ve):(he=$_(ae,M,ve,!1),M+=2*ve),a[T++]=S.createLineString(he),U&&y++}else if(Te===ki.POLYGON){const he=q[u]-q[u-1];u++;const ve=new Array(he-1);let Oe=X[g]-X[g-1];if(g++,Q&&Q.length!==0){const Fe=h.vertexBufferType===ua.VEC_2?Pg(ae,Q,R,Oe):V_(ae,Q,R,Oe,0,L);R+=Oe;for(let it=0;it<ve.length;it++)Oe=X[g]-X[g-1],g++,ve[it]=h.vertexBufferType===ua.VEC_2?Pg(ae,Q,R,Oe):V_(ae,Q,R,Oe,0,L),R+=Oe;a[T++]=S.createPolygon(Fe,ve)}else{const Fe=Eg(ae,M,Oe);M+=2*Oe;for(let it=0;it<ve.length;it++)Oe=X[g]-X[g-1],g++,ve[it]=Eg(ae,M,Oe),M+=2*Oe;a[T++]=S.createPolygon(Fe,ve)}U&&y++}else if(Te===ki.MULTILINESTRING){const he=U[y]-U[y-1];y++;const ve=new Array(he);if(Q&&Q.length!==0){for(let Oe=0;Oe<he;Oe++){let Fe=0;te?(Fe=X[g]-X[g-1],g++):Fe=q[u]-q[u-1],u++;const it=h.vertexBufferType===ua.VEC_2?Zv(ae,Q,R,Fe,!1):Cg(ae,Q,R,Fe,!1,L);ve[Oe]=it,R+=Fe}a[T++]=S.createMultiLineString(ve)}else{for(let Oe=0;Oe<he;Oe++){let Fe=0;te?(Fe=X[g]-X[g-1],g++):Fe=q[u]-q[u-1],u++,ve[Oe]=$_(ae,M,Fe,!1),M+=2*Fe}a[T++]=S.createMultiLineString(ve)}}else{if(Te!==ki.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const he=U[y]-U[y-1];y++;const ve=new Array(he);let Oe=0;if(Q&&Q.length!==0){for(let Fe=0;Fe<he;Fe++){const it=q[u]-q[u-1];u++;const vt=new Array(it-1);Oe=X[g]-X[g-1],g++;const xt=h.vertexBufferType===ua.VEC_2?Pg(ae,Q,R,Oe):V_(ae,Q,R,Oe,0,L);R+=Oe;for(let It=0;It<vt.length;It++)Oe=X[g]-X[g-1],g++,vt[It]=h.vertexBufferType===ua.VEC_2?Pg(ae,Q,R,Oe):V_(ae,Q,R,Oe,0,L),R+=Oe;ve[Fe]=S.createPolygon(xt,vt)}a[T++]=S.createMultiPolygon(ve)}else{for(let Fe=0;Fe<he;Fe++){const it=q[u]-q[u-1];u++;const vt=new Array(it-1);Oe=X[g]-X[g-1],g++;const xt=Eg(ae,M,Oe);M+=2*Oe;for(let It=0;It<vt.length;It++){const Vt=X[g]-X[g-1];g++,vt[It]=Eg(ae,M,Vt),M+=2*Vt}ve[Fe]=S.createPolygon(xt,vt)}a[T++]=S.createMultiPolygon(ve)}}}}return a}function Eg(h,a,u){return $_(h,a,u,!0)}function Pg(h,a,u,g){return Zv(h,a,u,g,!0)}function V_(h,a,u,g,y,T){return Cg(h,a,u,g,!0,T)}function $_(h,a,u,g){const y=new Array(g?u+1:u);for(let T=0;T<2*u;T+=2)y[T/2]=new m(h[a+T],h[a+T+1]);return g&&(y[y.length-1]=y[0]),y}function Zv(h,a,u,g,y){const T=new Array(y?g+1:g);for(let S=0;S<2*g;S+=2){const M=2*a[u+S/2];T[S/2]=new m(h[M],h[M+1])}return y&&(T[T.length-1]=T[0]),T}function Cg(h,a,u,g,y,T){const S=new Array(y?g+1:g);for(let M=0;M<g;M++){const R=op(h[a[u+M]],T.numBits,T.coordinateShift);S[M]=new m(R.x,R.y)}return y&&(S[S.length-1]=S[0]),S}class Px{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(a,u,g,y,T){this._vertexBufferType=a,this._topologyVector=u,this._vertexOffsets=g,this._vertexBuffer=y,this._mortonSettings=T}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const a=Ag(this);let u=0;for(;u<this.numGeometries;)yield{coordinates:a[u],type:this.geometryType(u)},u++}getSimpleEncodedVertex(a){const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getVertex(a){if(this.vertexOffsets&&this.mortonSettings){const g=op(this.vertexBuffer[this.vertexOffsets[a]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[g.x,g.y]}const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getGeometries(){return Ag(this)}get mortonSettings(){return this._mortonSettings}}class Mg extends Px{_numGeometries;_geometryType;constructor(a,u,g,y,T,S,M){super(g,y,T,S,M),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ki.POLYGON||this._geometryType===ki.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Ig extends Px{_geometryTypes;constructor(a,u,g,y,T,S){super(a,g,y,T,S),this._geometryTypes=u}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let a=0;a<this.numGeometries;a++)if(this.geometryType(a)===ki.POLYGON||this.geometryType(a)===ki.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Rg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(a,u,g,y){this._triangleOffsets=a,this._indexBuffer=u,this._vertexBuffer=g,this._topologyVector=y}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const a=new Array(this.numGeometries),u=this._topologyVector,g=u.partOffsets,y=u.ringOffsets,T=u.geometryOffsets;let S=0,M=1,R=1,L=1;for(let F=0;F<this.numGeometries;F++)switch(this.geometryType(F)){case ki.POLYGON:{const U=g[M]-g[M-1];M++;const q=[];for(let X=0;X<U;X++){const Q=y[R]-y[R-1];R++;const te=[];for(let ae=0;ae<Q;ae++){const de=this._vertexBuffer[S++],Te=this._vertexBuffer[S++];te.push(new m(de,Te))}te.length>0&&te.push(te[0]),q.push(te)}a[F]=q,T&&L++}break;case ki.MULTIPOLYGON:{const U=T[L]-T[L-1];L++;const q=[];for(let X=0;X<U;X++){const Q=g[M]-g[M-1];M++;for(let te=0;te<Q;te++){const ae=y[R]-y[R-1];R++;const de=[];for(let Te=0;Te<ae;Te++){const he=this._vertexBuffer[S++],ve=this._vertexBuffer[S++];de.push(new m(he,ve))}de.length>0&&de.push(de[0]),q.push(de)}}a[F]=q}}return a}[Symbol.iterator](){return null}}function Cx(h,a,u,g,y,T){return new Og(h,a,u,g,y,T)}class Og extends Rg{_numGeometries;_geometryType;constructor(a,u,g,y,T,S){super(g,y,T,S),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Mx(h,a,u,g,y){return new Ix(h,a,u,g,y)}class Ix extends Rg{_geometryTypes;constructor(a,u,g,y,T){super(u,g,y,T),this._geometryTypes=a}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Rx(h,a,u,g,y){const T=Ds(h,u);let S=null,M=null,R=null,L=null;if(j_(T,g,h,u)===jn.CONST){const Te=Hv(h,u,T,!1);let he=null,ve=null,Oe=null,Fe=null;for(let it=0;it<a-1;it++){const vt=Ds(h,u);switch(vt.physicalStreamType){case Yi.LENGTH:switch(vt.logicalStreamType.lengthType){case Os.GEOMETRIES:he=_h(h,u,vt);break;case Os.PARTS:ve=_h(h,u,vt);break;case Os.RINGS:Oe=_h(h,u,vt);break;case Os.TRIANGLES:Fe=_h(h,u,vt)}break;case Yi.OFFSET:switch(vt.logicalStreamType.offsetType){case mh.VERTEX:S=ks(h,u,vt,!1);break;case mh.INDEX:L=ks(h,u,vt,!1)}break;case Yi.DATA:yl.VERTEX===vt.logicalStreamType.dictionaryType?M=ks(h,u,vt,!0):(R={numBits:vt.numBits,coordinateShift:vt.coordinateShift},M=ks(h,u,vt,!1))}}return L!==null?he!=null||ve!=null?Cx(g,Te,Fe,L,M,new jf(he,ve,Oe)):Cx(g,Te,Fe,L,M):R===null?(function(it,vt,xt,It,Vt){return new Mg(it,vt,ua.VEC_2,xt,It,Vt)})(g,Te,new jf(he,ve,Oe),S,M):(function(it,vt,xt,It,Vt,kt){return new Mg(it,vt,ua.MORTON,xt,It,Vt,kt)})(g,Te,new jf(he,ve,Oe),S,M,R)}const F=ks(h,u,T,!1);let U=null,q=null,X=null,Q=null;for(let Te=0;Te<a-1;Te++){const he=Ds(h,u);switch(he.physicalStreamType){case Yi.LENGTH:switch(he.logicalStreamType.lengthType){case Os.GEOMETRIES:U=ks(h,u,he,!1);break;case Os.PARTS:q=ks(h,u,he,!1);break;case Os.RINGS:X=ks(h,u,he,!1);break;case Os.TRIANGLES:Q=_h(h,u,he)}break;case Yi.OFFSET:switch(he.logicalStreamType.offsetType){case mh.VERTEX:S=ks(h,u,he,!1);break;case mh.INDEX:L=ks(h,u,he,!1)}break;case Yi.DATA:yl.VERTEX===he.logicalStreamType.dictionaryType?M=ks(h,u,he,!0):(R={numBits:he.numBits,coordinateShift:he.coordinateShift},M=ks(h,u,he,!1))}}let te=null,ae=null,de=null;return U!==null?(te=W_(F,U,2),q!==null&&X!==null?(ae=Yv(F,te,q,!1),de=(function(Te,he,ve,Oe){const Fe=new Uint32Array(ve[ve.length-1]+1);let it=0;Fe[0]=it;let vt=1,xt=1,It=0;for(let Vt=0;Vt<Te.length;Vt++){const kt=Te[Vt],wt=he[Vt+1]-he[Vt];if(kt!==0&&kt!==3)for(let pt=0;pt<wt;pt++){const Gt=ve[vt]-ve[vt-1];vt++;for(let Jt=0;Jt<Gt;Jt++)it=Fe[xt++]=it+Oe[It++]}else for(let pt=0;pt<wt;pt++)Fe[xt++]=++it,vt++}return Fe})(F,te,ae,X)):q!==null&&(ae=(function(Te,he,ve){const Oe=new Uint32Array(he[he.length-1]+1);let Fe=0;Oe[0]=Fe;let it=1,vt=0;for(let xt=0;xt<Te.length;xt++){const It=Te[xt],Vt=he[xt+1]-he[xt];if(It===4||It===1)for(let kt=0;kt<Vt;kt++)Fe=Oe[it++]=Fe+ve[vt++];else for(let kt=0;kt<Vt;kt++)Oe[it++]=++Fe}return Oe})(F,te,q))):q!==null&&X!==null?(ae=W_(F,q,1),de=Yv(F,ae,X,!0)):q!==null&&(ae=W_(F,q,0)),L!==null&&ae===null?Mx(F,Q,L,M):L!==null?Mx(F,Q,L,M,new jf(te,ae,de)):R===null?(function(Te,he,ve,Oe){return new Ig(ua.VEC_2,Te,he,ve,Oe)})(F,new jf(te,ae,de),S,M):(function(Te,he,ve,Oe,Fe){return new Ig(ua.MORTON,Te,he,ve,Oe,Fe)})(F,new jf(te,ae,de),S,M,R)}function W_(h,a,u){const g=new Uint32Array(h.length+1);let y=0;g[0]=y;let T=0;for(let S=0;S<h.length;S++)y=g[S+1]=y+(h[S]>u?a[T++]:1);return g}function Yv(h,a,u,g){const y=new Uint32Array(a[a.length-1]+1);let T=0;y[0]=T;let S=1,M=0;for(let R=0;R<h.length;R++){const L=h[R],F=a[R+1]-a[R];if(L===5||L===2||g&&(L===4||L===1))for(let U=0;U<F;U++)T=y[S++]=T+u[M++];else for(let U=0;U<F;U++)y[S++]=++T}return y}class Kv extends ph{dataVector;constructor(a,u,g){super(a,u.getBuffer(),g),this.dataVector=u}getValueFromBuffer(a){return this.dataVector.get(a)}}class Ox extends k_{getValueFromBuffer(a){return this.dataBuffer[a]}}class Qv extends ph{constructor(a,u,g){super(a,BigInt64Array.of(u),g)}getValueFromBuffer(a){return this.dataBuffer[0]}}function yh(h,a,u,g,y){const T=(function(S,M,R,L){const F=new Uint8Array(M);let U=0;const q=L.get()+R;for(;U<M&&!(L.get()>=q);){const X=S[L.increment()];if(X<=127){const Q=X+3,te=S[L.increment()],ae=Math.min(U+Q,M);F.fill(te,U,ae),U=ae}else{const Q=256-X;for(let te=0;te<Q&&U<M;te++)F[U++]=S[L.increment()]}}return L.set(q),F})(h,Math.ceil(a/8),u,g);return y?(function(S,M,R){if(!R)return S;const L=R.size(),F=new vl(S,M),U=new vl(new Uint8Array(Math.ceil(L/8)),L);let q=0;for(let X=0;X<L;X++){const Q=!!R.get(X)&&F.get(q++);U.set(X,Q)}return U.getBuffer()})(T,a,y):T}const w2=new TextDecoder;function Jv(h,a,u){return u-a>=12?w2.decode(h.subarray(a,u)):(function(g,y,T){let S="",M=y;for(;M<T;){const R=g[M];let L,F,U,q=null,X=R>239?4:R>223?3:R>191?2:1;if(M+X>T)break;X===1?R<128&&(q=R):X===2?(L=g[M+1],(192&L)==128&&(q=(31&R)<<6|63&L,q<=127&&(q=null))):X===3?(L=g[M+1],F=g[M+2],(192&L)==128&&(192&F)==128&&(q=(15&R)<<12|(63&L)<<6|63&F,(q<=2047||q>=55296&&q<=57343)&&(q=null))):X===4&&(L=g[M+1],F=g[M+2],U=g[M+3],(192&L)==128&&(192&F)==128&&(192&U)==128&&(q=(15&R)<<18|(63&L)<<12|(63&F)<<6|63&U,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,X=1):q>65535&&(q-=65536,S+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),S+=String.fromCharCode(q),M+=X}return S})(h,a,u)}class Dg extends ph{offsetBuffer;constructor(a,u,g,y){super(a,g,y),this.offsetBuffer=u}}class H_ extends Dg{textEncoder;constructor(a,u,g,y){super(a,u,g,y??u.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(a){return Jv(this.dataBuffer,this.offsetBuffer[a],this.offsetBuffer[a+1])}}class uu extends Dg{indexBuffer;textEncoder;constructor(a,u,g,y,T){super(a,g,y,T??u.length),this.indexBuffer=u,this.indexBuffer=u,this.textEncoder=new TextEncoder}getValueFromBuffer(a){const u=this.indexBuffer[a];return Jv(this.dataBuffer,this.offsetBuffer[u],this.offsetBuffer[u+1])}}class q_ extends Dg{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(a,u,g,y,T,S,M){super(a,g,y,M),this.indexBuffer=u,this.symbolOffsetBuffer=T,this.symbolTableBuffer=S,this.textEncoder=new TextEncoder}getValueFromBuffer(a){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(g,y,T){const S=[],M=new Array(y.length).fill(0);for(let R=1;R<y.length;R++)M[R]=M[R-1]+y[R-1];for(let R=0;R<T.length;R++)if(T[R]===255)S.push(T[++R]);else{const L=y[T[R]],F=M[T[R]];for(let U=0;U<L;U++)S.push(g[F+U])}return new Uint8Array(S)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const u=this.indexBuffer[a];return Jv(this.decodedDictionary,this.offsetBuffer[u],this.offsetBuffer[u+1])}offsetToLengthBuffer(a){const u=new Uint32Array(a.length-1);let g=a[0];for(let y=1;y<a.length;y++){const T=a[y];u[y-1]=T-g,g=T}return u}}function Dx(h,a,u,g,y,T){return u.type==="scalarType"?(function(S,M,R,L,F,U){let q=null,X=0;if(S===0)return null;if(U.nullable){const te=Ds(M,R);X=te.numValues;const ae=R.get(),de=yh(M,X,te.byteLength,R);R.set(ae+te.byteLength),q=new vl(de,te.numValues)}const Q=q??L;switch(F.physicalType){case 4:case 3:return(function(te,ae,de,Te,he){const ve=Ds(te,ae),Oe=j_(ve,he,te,ae),Fe=Te.physicalType===3;if(Oe===jn.FLAT){const it=ks(te,ae,ve,Fe,0,Uf(he)?he:void 0);return new L_(de.name,it,he)}if(Oe===jn.SEQUENCE){const it=qv(te,ae,ve);return new $v(de.name,it[0],it[1],ve.numRleValues)}{const it=Hv(te,ae,ve,Fe);return new Wv(de.name,it,he)}})(M,R,U,F,Q);case 9:return(function(te,ae,de,Te,he){let ve=null,Oe=null,Fe=null,it=null,vt=null,xt=null,It=null,Vt=null;for(let kt=0;kt<Te;kt++){const wt=Ds(ae,de);if(wt.byteLength!==0)switch(wt.physicalStreamType){case Yi.PRESENT:{const pt=yh(ae,wt.numValues,wt.byteLength,de);xt=new vl(pt,wt.numValues);break}case Yi.OFFSET:Oe=ks(ae,de,wt,!1,0,he!=null||xt!=null?he??xt:void 0);break;case Yi.LENGTH:{const pt=_h(ae,de,wt);Os.DICTIONARY===wt.logicalStreamType.lengthType?ve=pt:Os.SYMBOL===wt.logicalStreamType.lengthType?it=pt:It=pt;break}case Yi.DATA:{const pt=ae.subarray(de.get(),de.get()+wt.byteLength);de.add(wt.byteLength);const Gt=wt.logicalStreamType.dictionaryType;yl.FSST===Gt?vt=pt:yl.SINGLE===Gt||yl.SHARED===Gt?Fe=pt:yl.NONE===Gt&&(Vt=pt);break}}}return(function(kt,wt,pt,Gt,Jt,ar,tr){return wt?new q_(kt,pt,Gt,Jt,ar,wt,tr):null})(te,vt,Oe,ve,Fe,it,he??xt)??(function(kt,wt,pt,Gt,Jt){return wt?Jt?new uu(kt,pt,Gt,wt,Jt):new uu(kt,pt,Gt,wt):null})(te,Fe,Oe,ve,he??xt)??(function(kt,wt,pt,Gt,Jt){if(!wt||!pt)return null;if(Gt)return Jt?new uu(kt,Gt,wt,pt,Jt):new uu(kt,Gt,wt,pt);if(Jt&&Jt.size()!==wt.length-1){const ar=new Int32Array(Jt.size());let tr=0;for(let Or=0;Or<Jt.size();Or++)ar[Or]=Jt.get(Or)?tr++:0;return new uu(kt,ar,wt,pt,Jt)}return Jt?new H_(kt,wt,pt,Jt):new H_(kt,wt,pt)})(te,It,Vt,Oe,he??xt)})(U.name,M,R,U.nullable?S-1:S,q);case 0:return(function(te,ae,de,Te,he){const ve=Ds(te,ae),Oe=ve.numValues,Fe=ae.get(),it=Uf(he)?he:void 0,vt=yh(te,Oe,ve.byteLength,ae,it);ae.set(Fe+ve.byteLength);const xt=new vl(vt,Oe);return new Kv(de.name,xt,he)})(M,R,U,0,Q);case 6:case 5:return(function(te,ae,de,Te,he){const ve=Ds(te,ae),Oe=j_(ve,Te,te,ae),Fe=he.physicalType===5;if(Oe===jn.FLAT){const it=sp(te,ae,ve,Fe,Uf(Te)?Te:void 0);return new Ff(de.name,it,Te)}if(Oe===jn.SEQUENCE){const it=Bf(te,ae,ve);return new ap(de.name,it[0],it[1],ve.numRleValues)}{const it=Xv(te,ae,ve,Fe);return new Qv(de.name,it,Te)}})(M,R,U,Q,F);case 7:return(function(te,ae,de,Te){const he=Ds(te,ae),ve=Uf(Te)?Te:void 0,Oe=(function(Fe,it,vt,xt){const It=it.get(),Vt=It+vt*Float32Array.BYTES_PER_ELEMENT,kt=new Uint8Array(Fe.subarray(It,Vt)).buffer,wt=new Float32Array(kt);return it.set(Vt),xt?B_(wt,xt,0):wt})(te,ae,he.numValues,ve);return new Ox(de.name,Oe,Te)})(M,R,U,Q);case 8:return(function(te,ae,de,Te){const he=Ds(te,ae),ve=Uf(Te)?Te:void 0,Oe=(function(Fe,it,vt,xt){const It=it.get(),Vt=It+vt*Float64Array.BYTES_PER_ELEMENT,kt=new Uint8Array(Fe.subarray(It,Vt)).buffer,wt=new Float64Array(kt);return it.set(Vt),xt?B_(wt,xt,0):wt})(te,ae,he.numValues,ve);return new Uv(de.name,Oe,Te)})(M,R,U,Q);default:throw new Error(`The specified data type for the field is currently not supported: ${F}`)}})(g,h,a,y,u.scalarType,u):g===0?null:(function(S,M,R,L){let F=null,U=null,q=null,X=null,Q=!1;for(;!Q;){const Te=Ds(S,M);switch(Te.physicalStreamType){case Yi.LENGTH:Os.DICTIONARY===Te.logicalStreamType.lengthType?F=_h(S,M,Te):q=_h(S,M,Te);break;case Yi.DATA:yl.SINGLE===Te.logicalStreamType.dictionaryType||yl.SHARED===Te.logicalStreamType.dictionaryType?(U=S.subarray(M.get(),M.get()+Te.byteLength),Q=!0):X=S.subarray(M.get(),M.get()+Te.byteLength),M.add(Te.byteLength)}}const te=R.complexType.children,ae=[];let de=0;for(const Te of te){const he=Ki(S,M,1)[0];if(he==0)continue;const ve=Te.name?`${R.name}${Te.name}`:R.name;if(he!==2||Te.type!=="scalarField"||Te.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Oe=Ds(S,M),Fe=yh(S,Oe.numValues,Oe.byteLength,M),it=Ds(S,M),vt=ks(S,M,it,!1,0,it.decompressedCount!==L?new vl(Fe,Oe.numValues):void 0);ae[de++]=X?new q_(ve,vt,F,U,q,X,new vl(Fe,Oe.numValues)):new uu(ve,vt,F,U,new vl(Fe,Oe.numValues))}return ae})(h,a,u,y)}function Uf(h){return h instanceof vl}function hu(h){switch(h){case 0:case 1:case 2:case 3:{const a={};a.nullable=!!(1&h),a.columnScope=0;const u={};return u.physicalType=h>1?6:4,u.type="physicalType",a.scalarType=u,a.type="scalarType",a}case 4:{const a={nullable:!1,columnScope:0},u={type:"physicalType",physicalType:0};return a.type="complexType",a.complexType=u,a}case 30:{const a={nullable:!1,columnScope:0},u={type:"physicalType",physicalType:1};return a.type="complexType",a.complexType=u,a}default:return(function(a){let u=null;switch(a){case 10:case 11:u=0;break;case 12:case 13:u=1;break;case 14:case 15:u=2;break;case 16:case 17:u=3;break;case 18:case 19:u=4;break;case 20:case 21:u=5;break;case 22:case 23:u=6;break;case 24:case 25:u=7;break;case 26:case 27:u=8;break;case 28:case 29:u=9;break;default:return null}const g={};g.nullable=!!(1&a),g.columnScope=0;const y={type:"physicalType"};return y.physicalType=u,g.type="scalarType",g.scalarType=y,g})(h)}}function fu(h){return h>=10}function du(h){return h===30}function kg(h){if(h.name==="id")return!1;if(h.type==="scalarType"){const a=h.scalarType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(a.type==="logicalType")return!1}else if(h.type==="complexType"){const a=h.complexType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",h),!1}const Lg=new TextDecoder;function lc(h,a){const u=Ki(h,a,1)[0];if(u===0)return"";const g=a.get(),y=h.subarray(g,g+u);return a.add(u),Lg.decode(y)}function kx(h,a){const u=Ki(h,a,1)[0]>>>0;if(u<10||u>30)throw new Error(`Unsupported field type code ${u}. Supported: 10-29(scalars), 30(STRUCT)`);const g=hu(u);if(fu(u)&&(g.name=lc(h,a)),du(u)){const y=Ki(h,a,1)[0]>>>0;g.complexType.children=new Array(y);for(let T=0;T<y;T++)g.complexType.children[T]=kx(h,a)}return(function(y){return{name:y.name,nullable:y.nullable,scalarField:y.scalarType,complexField:y.complexType,type:y.type==="scalarType"?"scalarField":"complexField"}})(g)}function Lx(h,a){const u=Ki(h,a,1)[0]>>>0,g=hu(u);if(!g)throw new Error(`Unsupported column type code ${u}. Supported: 0-3(ID), 4(GEOMETRY), 10-29(scalars), 30(STRUCT)`);if(fu(u)?g.name=lc(h,a):u>=0&&u<=3?g.name="id":u===4&&(g.name="geometry"),du(u)){const y=Ki(h,a,1)[0]>>>0,T=g.complexType;T.children=new Array(y);for(let S=0;S<y;S++)T.children[S]=kx(h,a)}return g}function Ng(h,a){const u={featureTables:[]},g={};g.name=lc(h,a);const y=Ki(h,a,1)[0]>>>0,T=Ki(h,a,1)[0]>>>0;g.columns=new Array(T);for(let S=0;S<T;S++)g.columns[S]=Lx(h,a);return u.featureTables.push(g),[u,y]}function T2(h,a,u,g,y,T,S=!1){const M=a.scalarType.physicalType,R=j_(y,T,h,u);if(M===4)switch(R){case jn.FLAT:{const L=ks(h,u,y,!1);return new L_(g,L,T)}case jn.SEQUENCE:{const L=qv(h,u,y);return new $v(g,L[0],L[1],y.numRleValues)}case jn.CONST:{const L=Hv(h,u,y,!1);return new Wv(g,L,T)}}else switch(R){case jn.FLAT:{if(S){const F=(function(U,q,X){const Q=(function(te,ae,de){const Te=new Float64Array(de);for(let he=0;he<de;he++)Te[he]=Sg(te,ae);return Te})(U,q,X.numValues);return(function(te,ae){switch(ae.logicalLevelTechnique1){case nn.DELTA:return ae.logicalLevelTechnique2===nn.RLE&&(te=Ex(te,ae.runs,ae.numRleValues)),(function(de){de[0]=cu(de[0]);const Te=de.length/4*4;let he=1;if(Te>=4)for(;he<Te-4;he+=4){const ve=de[he+1],Oe=de[he+2],Fe=de[he+3];de[he]=cu(de[he])+de[he-1],de[he+1]=cu(ve)+de[he],de[he+2]=cu(Oe)+de[he+1],de[he+3]=cu(Fe)+de[he+2]}for(;he!=de.length;++he)de[he]=cu(de[he])+de[he-1]})(te),te;case nn.RLE:return(function(de,Te){return Ex(de,Te.runs,Te.numRleValues)})(te,ae);case nn.NONE:return te;default:throw new Error(`The specified Logical level technique is not supported: ${ae.logicalLevelTechnique1}`)}})(Q,X)})(h,u,y);return new Uv(g,F,T)}const L=sp(h,u,y,!1);return new Ff(g,L,T)}case jn.SEQUENCE:{const L=Bf(h,u,y);return new ap(g,L[0],L[1],y.numRleValues)}case jn.CONST:{const L=Xv(h,u,y,!1);return new Qv(g,L,T)}}throw new Error("Vector type not supported for id column.")}class Nx{constructor(a,u){var g;switch(this._featureData=a,this.properties=this._featureData.properties||{},(g=this._featureData.geometry)===null||g===void 0?void 0:g.type){case ki.POINT:case ki.MULTIPOINT:this.type=1;break;case ki.LINESTRING:case ki.MULTILINESTRING:this.type=2;break;case ki.POLYGON:case ki.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=u,this.id=Number(this._featureData.id)}loadGeometry(){const a=[];for(const u of this._featureData.geometry.coordinates){const g=[];for(const y of u)g.push(new m(y.x,y.y));a.push(g)}return a}}class X_{constructor(a){this.features=[],this.featureTable=a,this.name=a.name,this.extent=a.extent,this.version=2,this.features=a.getFeatures(),this.length=this.features.length}feature(a){return new Nx(this.features[a],this.extent)}}class e0{constructor(a){this.layers={};const u=(function(g,y,T=!0){const S=new Tx(0),M=[];for(;S.get()<g.length;){const R=Ki(g,S,1)[0]>>>0,L=S.get()+R;if(L>g.length)throw new Error(`Block overruns tile: ${L} > ${g.length}`);if(Ki(g,S,1)[0]>>>0!=1){S.set(L);continue}const F=Ng(g,S),U=F[1],q=F[0].featureTables[0];let X=null,Q=null;const te=[];let ae=0;for(const Te of q.columns){const he=Te.name;if(he==="id"){let ve=null;if(Te.nullable){const Fe=Ds(g,S),it=S.get(),vt=yh(g,Fe.numValues,Fe.byteLength,S);S.set(it+Fe.byteLength),ve=new vl(vt,Fe.numValues)}const Oe=Ds(g,S);ae=Oe.decompressedCount,X=T2(g,Te,S,he,Oe,ve??ae,T)}else if(he==="geometry"){const ve=Ki(g,S,1)[0];if(ae===0){const Oe=S.get();ae=Ds(g,S).decompressedCount,S.set(Oe)}Q=Rx(g,ve,S,ae)}else{const ve=kg(Te)?Ki(g,S,1)[0]:1;if(ve===0)continue;const Oe=Dx(g,S,Te,ve,ae);if(Oe)if(Array.isArray(Oe))for(const Fe of Oe)te.push(Fe);else te.push(Oe)}}const de=new gh(q.name,Q,X,te,U);M.push(de),S.set(L)}return M})(new Uint8Array(a));this.layers=u.reduce(((g,y)=>Object.assign(Object.assign({},g),{[y.name]:new X_(y)})),{})}}class S2{constructor(a,u){this.feature=a,this.type=a.type,this.properties=a.tags?a.tags:{},this.extent=u,"id"in a&&(typeof a.id=="string"?this.id=parseInt(a.id,10):typeof a.id!="number"||isNaN(a.id)||(this.id=a.id))}loadGeometry(){const a=[],u=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const g of u){const y=[];for(const T of g)y.push(new m(T[0],T[1]));a.push(y)}return a}}const vh="_geojsonTileLayer";function G_(h,a){a.writeVarintField(15,h.version||1),a.writeStringField(1,h.name||""),a.writeVarintField(5,h.extent||4096);const u={keys:[],values:[],keycache:{},valuecache:{}};for(let T=0;T<h.length;T++)u.feature=h.feature(T),a.writeMessage(2,zx,u);const g=u.keys;for(const T of g)a.writeStringField(3,T);const y=u.values;for(const T of y)a.writeMessage(4,Bx,T)}function zx(h,a){if(!h.feature)return;const u=h.feature;u.id!==void 0&&a.writeVarintField(1,u.id),a.writeMessage(2,lp,h),a.writeVarintField(3,u.type),a.writeMessage(4,K_,u)}function lp(h,a){for(const u in h.feature?.properties){let g=h.feature.properties[u],y=h.keycache[u];if(g==null)continue;y===void 0&&(h.keys.push(u),y=h.keys.length-1,h.keycache[u]=y),a.writeVarint(y),typeof g!="string"&&typeof g!="boolean"&&typeof g!="number"&&(g=JSON.stringify(g));const T=typeof g+":"+g;let S=h.valuecache[T];S===void 0&&(h.values.push(g),S=h.values.length-1,h.valuecache[T]=S),a.writeVarint(S)}}function Z_(h,a){return(a<<3)+(7&h)}function Y_(h){return h<<1^h>>31}function K_(h,a){const u=h.loadGeometry(),g=h.type;let y=0,T=0;for(const S of u){let M=1;g===1&&(M=S.length),a.writeVarint(Z_(1,M));const R=g===3?S.length-1:S.length;for(let L=0;L<R;L++){L===1&&g!==1&&a.writeVarint(Z_(2,R-1));const F=S[L].x-y,U=S[L].y-T;a.writeVarint(Y_(F)),a.writeVarint(Y_(U)),y+=F,T+=U}h.type===3&&a.writeVarint(Z_(7,1))}}function Bx(h,a){const u=typeof h;u==="string"?a.writeStringField(1,h):u==="boolean"?a.writeBooleanField(7,h):u==="number"&&(h%1!=0?a.writeDoubleField(3,h):h<0?a.writeSVarintField(6,h):a.writeVarintField(5,h))}class Fx{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Yl(Ue,16,0),this.grid3D=new Yl(Ue,16,0),this.featureIndexArray=new le,this.promoteId=u}insert(a,u,g,y,T,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,y,T);const R=S?this.grid3D:this.grid;for(let L=0;L<u.length;L++){const F=u[L],U=[1/0,1/0,-1/0,-1/0];for(let q=0;q<F.length;q++){const X=F[q];U[0]=Math.min(U[0],X.x),U[1]=Math.min(U[1],X.y),U[2]=Math.max(U[2],X.x),U[3]=Math.max(U[3],X.y)}U[0]<Ue&&U[1]<Ue&&U[2]>=0&&U[3]>=0&&R.insert(M,U[0],U[1],U[2],U[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Vr(new v_(this.rawTileData)).layers:new e0(this.rawTileData).layers,this.sourceLayerCoder=new jv(this.vtLayers?Object.keys(this.vtLayers).sort():[vh])),this.vtLayers}query(a,u,g,y){this.loadVTLayers();const T=a.params,S=Ue/a.tileSize/a.scale,M=As(T.filter,T.globalState),R=a.queryGeometry,L=a.queryPadding*S,F=dh.fromPoints(R),U=this.grid.query(F.minX-L,F.minY-L,F.maxX+L,F.maxY+L),q=dh.fromPoints(a.cameraQueryGeometry).expandBy(L),X=this.grid3D.query(q.minX,q.minY,q.maxX,q.maxY,((ae,de,Te,he)=>(function(ve,Oe,Fe,it,vt){for(const It of ve)if(Oe<=It.x&&Fe<=It.y&&it>=It.x&&vt>=It.y)return!0;const xt=[new m(Oe,Fe),new m(Oe,vt),new m(it,vt),new m(it,Fe)];if(ve.length>2){for(const It of xt)if(tc(ve,It))return!0}for(let It=0;It<ve.length-1;It++)if(Ub(ve[It],ve[It+1],xt))return!0;return!1})(a.cameraQueryGeometry,ae-L,de-L,Te+L,he+L)));for(const ae of X)U.push(ae);U.sort(f);const Q={};let te;for(let ae=0;ae<U.length;ae++){const de=U[ae];if(de===te)continue;te=de;const Te=this.featureIndexArray.get(de);let he=null;this.loadMatchingFeature(Q,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,M,T.layers,T.availableImages,u,g,y,((ve,Oe,Fe)=>(he||(he=pl(ve)),Oe.queryIntersectsFeature({queryGeometry:R,feature:ve,featureState:Fe,geometry:he,zoom:this.z,transform:a.transform,pixelsToTileUnits:S,pixelPosMatrix:a.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:a.getElevation}))))}return Q}loadMatchingFeature(a,u,g,y,T,S,M,R,L,F,U){const q=this.bucketLayerIDs[u];if(S&&!q.some((ae=>S.has(ae))))return;const X=this.sourceLayerCoder.decode(g),Q=this.vtLayers[X].feature(y);if(T.needGeometry){const ae=oo(Q,!0);if(!T.filter(new tn(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!T.filter(new tn(this.tileID.overscaledZ),Q))return;const te=this.getId(Q,X);for(let ae=0;ae<q.length;ae++){const de=q[ae];if(S&&!S.has(de))continue;const Te=R[de];if(!Te)continue;let he={};te&&F&&(he=F.getState(Te.sourceLayer||vh,te));const ve=nr({},L[de]);ve.paint=zg(ve.paint,Te.paint,Q,he,M),ve.layout=zg(ve.layout,Te.layout,Q,he,M);const Oe=!U||U(Q,Te,he);if(!Oe)continue;const Fe=new D_(Q,this.z,this.x,this.y,te);Fe.layer=ve;let it=a[de];it===void 0&&(it=a[de]=[]),it.push({featureIndex:y,feature:Fe,intersectionZ:Oe})}}lookupSymbolFeatures(a,u,g,y,T,S,M,R){const L={};this.loadVTLayers();const F=As(T.filterSpec,T.globalState);for(const U of a)this.loadMatchingFeature(L,g,y,U,F,S,M,R,u);return L}hasLayer(a){for(const u of this.bucketLayerIDs)for(const g of u)if(a===g)return!0;return!1}getId(a,u){var g;let y=a.id;return this.promoteId&&(y=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof y=="boolean"&&(y=Number(y)),y===void 0&&(!((g=a.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(y=Number(a.properties.cluster_id))),y}}function zg(h,a,u,g,y){return Yt(h,((T,S)=>{const M=a instanceof Xc?a.get(S):null;return M&&M.evaluate?M.evaluate(u,g,y):M}))}function f(h,a){return a-h}function p(h,a,u,g,y){const T=[];for(let S=0;S<h.length;S++){const M=h[S];let R;for(let L=0;L<M.length-1;L++){let F=M[L],U=M[L+1];F.x<a&&U.x<a||(F.x<a?F=new m(a,F.y+(a-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x<a&&(U=new m(a,F.y+(a-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y<u&&U.y<u||(F.y<u?F=new m(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round():U.y<u&&(U=new m(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round()),F.x>=g&&U.x>=g||(F.x>=g?F=new m(g,F.y+(g-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x>=g&&(U=new m(g,F.y+(g-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y>=y&&U.y>=y||(F.y>=y?F=new m(F.x+(y-F.y)/(U.y-F.y)*(U.x-F.x),y)._round():U.y>=y&&(U=new m(F.x+(y-F.y)/(U.y-F.y)*(U.x-F.x),y)._round()),R&&F.equals(R[R.length-1])||(R=[F],T.push(R)),R.push(U)))))}}return T}function v(h,a,u,g,y){switch(a){case 1:return(function(T,S,M,R){const L=[];for(const F of T)for(const U of F){const q=R===0?U.x:U.y;q>=S&&q<=M&&L.push([U])}return L})(h,u,g,y);case 2:return k(h,u,g,y,!1);case 3:return k(h,u,g,y,!0)}return[]}function P(h,a,u,g,y){const T=g===0?B:K;let S=[];const M=[];for(let F=0;F<h.length-1;F++){const U=h[F],q=h[F+1],X=g===0?U.x:U.y,Q=g===0?q.x:q.y;let te=!1;X<a?Q>a&&S.push(T(U,q,a)):X>u?Q<u&&S.push(T(U,q,u)):S.push(U),Q<a&&X>=a&&(S.push(T(U,q,a)),te=!0),Q>u&&X<=u&&(S.push(T(U,q,u)),te=!0),!y&&te&&(M.push(S),S=[])}const R=h.length-1,L=g===0?h[R].x:h[R].y;return L>=a&&L<=u&&S.push(h[R]),y&&S.length>0&&!S[0].equals(S[S.length-1])&&S.push(new m(S[0].x,S[0].y)),S.length>0&&M.push(S),M}function k(h,a,u,g,y){const T=[];for(const S of h){const M=P(S,a,u,g,y);M.length>0&&T.push(...M)}return T}function B(h,a,u){return new m(u,h.y+(u-h.x)/(a.x-h.x)*(a.y-h.y))}function K(h,a,u){return new m(h.x+(u-h.y)/(a.y-h.y)*(a.x-h.x),u)}Ht("FeatureIndex",Fx,{omit:["rawTileData","sourceLayerCoder"]});class pe extends m{constructor(a,u,g,y){super(a,u),this.angle=g,y!==void 0&&(this.segment=y)}clone(){return new pe(this.x,this.y,this.angle,this.segment)}}function je(h,a,u,g,y){if(a.segment===void 0||u===0)return!0;let T=a,S=a.segment+1,M=0;for(;M>-u/2;){if(S--,S<0)return!1;M-=h[S].dist(T),T=h[S]}M+=h[S].dist(h[S+1]),S++;const R=[];let L=0;for(;M<u/2;){const F=h[S],U=h[S+1];if(!U)return!1;let q=h[S-1].angleTo(F)-F.angleTo(U);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:q}),L+=q;M-R[0].distance>g;)L-=R.shift().angleDelta;if(L>y)return!1;S++,M+=F.dist(U)}return!0}function ft(h){let a=0;for(let u=0;u<h.length-1;u++)a+=h[u].dist(h[u+1]);return a}function At(h,a,u){return h?.6*a*u:0}function Dt(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function dt(h,a,u,g,y,T){const S=At(u,y,T),M=Dt(u,g)*T;let R=0;const L=ft(h)/2;for(let F=0;F<h.length-1;F++){const U=h[F],q=h[F+1],X=U.dist(q);if(R+X>L){const Q=(L-R)/X,te=In.number(U.x,q.x,Q),ae=In.number(U.y,q.y,Q),de=new pe(te,ae,q.angleTo(U),F);return de._round(),!S||je(h,de,M,S,a)?de:void 0}R+=X}}function yt(h,a,u,g,y,T,S,M,R){const L=At(g,T,S),F=Dt(g,y),U=F*S,q=h[0].x===0||h[0].x===R||h[0].y===0||h[0].y===R;return a-U<a/4&&(a=U+a/4),rr(h,q?a/2*M%a:(F/2+2*T)*S*M%a,a,L,u,U,q,!1,R)}function rr(h,a,u,g,y,T,S,M,R){const L=T/2,F=ft(h);let U=0,q=a-u,X=[];for(let Q=0;Q<h.length-1;Q++){const te=h[Q],ae=h[Q+1],de=te.dist(ae),Te=ae.angleTo(te);for(;q+u<U+de;){q+=u;const he=(q-U)/de,ve=In.number(te.x,ae.x,he),Oe=In.number(te.y,ae.y,he);if(ve>=0&&ve<R&&Oe>=0&&Oe<R&&q-L>=0&&q+L<=F){const Fe=new pe(ve,Oe,Te,Q);Fe._round(),g&&!je(h,Fe,T,g,y)||X.push(Fe)}}U+=de}return M||X.length||S||(X=rr(h,U/2,u,g,y,T,S,!0,R)),X}function wr(h,a,u,g){const y=[],T=h.image,S=T.pixelRatio,M=T.paddedRect.w-2,R=T.paddedRect.h-2;let L={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const F=T.stretchX||[[0,M]],U=T.stretchY||[[0,R]],q=(pt,Gt)=>pt+Gt[1]-Gt[0],X=F.reduce(q,0),Q=U.reduce(q,0),te=M-X,ae=R-Q;let de=0,Te=X,he=0,ve=Q,Oe=0,Fe=te,it=0,vt=ae;if(T.content&&g){const pt=T.content,Gt=pt[2]-pt[0],Jt=pt[3]-pt[1];(T.textFitWidth||T.textFitHeight)&&(L=lu(h)),de=mn(F,0,pt[0]),he=mn(U,0,pt[1]),Te=mn(F,pt[0],pt[2]),ve=mn(U,pt[1],pt[3]),Oe=pt[0]-de,it=pt[1]-he,Fe=Gt-Te,vt=Jt-ve}const xt=L.x1,It=L.y1,Vt=L.x2-xt,kt=L.y2-It,wt=(pt,Gt,Jt,ar)=>{const tr=$e(pt.stretch-de,Te,Vt,xt),Or=ht(pt.fixed-Oe,Fe,pt.stretch,X),Qn=$e(Gt.stretch-he,ve,kt,It),Li=ht(Gt.fixed-it,vt,Gt.stretch,Q),Ls=$e(Jt.stretch-de,Te,Vt,xt),cc=ht(Jt.fixed-Oe,Fe,Jt.stretch,X),Ua=$e(ar.stretch-he,ve,kt,It),ds=ht(ar.fixed-it,vt,ar.stretch,Q),Ns=new m(tr,Qn),gi=new m(Ls,Qn),ps=new m(Ls,Ua),fa=new m(tr,Ua),da=new m(Or/S,Li/S),ho=new m(cc/S,ds/S),zs=a*Math.PI/180;if(zs){const Qi=Math.sin(zs),ii=Math.cos(zs),Ni=[ii,-Qi,Qi,ii];Ns._matMult(Ni),gi._matMult(Ni),fa._matMult(Ni),ps._matMult(Ni)}const fo=pt.stretch+pt.fixed,uc=Gt.stretch+Gt.fixed;return{tl:Ns,tr:gi,bl:fa,br:ps,tex:{x:T.paddedRect.x+1+fo,y:T.paddedRect.y+1+uc,w:Jt.stretch+Jt.fixed-fo,h:ar.stretch+ar.fixed-uc},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:da,pixelOffsetBR:ho,minFontScaleX:Fe/S/Vt,minFontScaleY:vt/S/kt,isSDF:u}};if(g&&(T.stretchX||T.stretchY)){const pt=Qe(F,te,X),Gt=Qe(U,ae,Q);for(let Jt=0;Jt<pt.length-1;Jt++){const ar=pt[Jt],tr=pt[Jt+1];for(let Or=0;Or<Gt.length-1;Or++)y.push(wt(ar,Gt[Or],tr,Gt[Or+1]))}}else y.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return y}function mn(h,a,u){let g=0;for(const y of h)g+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return g}function Qe(h,a,u){const g=[{fixed:-1,stretch:0}];for(const[y,T]of h){const S=g[g.length-1];g.push({fixed:y-S.stretch,stretch:S.stretch}),g.push({fixed:y-S.stretch,stretch:S.stretch+(T-y)})}return g.push({fixed:a+1,stretch:u}),g}function $e(h,a,u,g){return h/a*u+g}function ht(h,a,u,g){return h-a*u/g}Ht("Anchor",pe);class Mt{constructor(a,u,g,y,T,S,M,R,L,F){var U;if(this.boxStartIndex=a.length,L){let q=S.top,X=S.bottom;const Q=S.collisionPadding;Q&&(q-=Q[1],X+=Q[3]);let te=X-q;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{const q=!((U=S.image)===null||U===void 0)&&U.content&&(S.image.textFitWidth||S.image.textFitHeight)?lu(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom};q.y1=q.y1*M-R[0],q.y2=q.y2*M+R[2],q.x1=q.x1*M-R[3],q.x2=q.x2*M+R[1];const X=S.collisionPadding;if(X&&(q.x1-=X[0]*M,q.y1-=X[1]*M,q.x2+=X[2]*M,q.y2+=X[3]*M),F){const Q=new m(q.x1,q.y1),te=new m(q.x2,q.y1),ae=new m(q.x1,q.y2),de=new m(q.x2,q.y2),Te=F*Math.PI/180;Q._rotate(Te),te._rotate(Te),ae._rotate(Te),de._rotate(Te),q.x1=Math.min(Q.x,te.x,ae.x,de.x),q.x2=Math.max(Q.x,te.x,ae.x,de.x),q.y1=Math.min(Q.y,te.y,ae.y,de.y),q.y2=Math.max(Q.y,te.y,ae.y,de.y)}a.emplaceBack(u.x,u.y,q.x1,q.y1,q.x2,q.y2,g,y,T)}this.boxEndIndex=a.length}}class gr{constructor(a=[],u=(g,y)=>g<y?-1:g>y?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:g}=this,y=u[a];for(;a>0;){const T=a-1>>1,S=u[T];if(g(y,S)>=0)break;u[a]=S,a=T}u[a]=y}_down(a){const{data:u,compare:g}=this,y=this.length>>1,T=u[a];for(;a<y;){let S=1+(a<<1);const M=S+1;if(M<this.length&&g(u[M],u[S])<0&&(S=M),g(u[S],T)>=0)break;u[a]=u[S],a=S}u[a]=T}}function ln(h,a=1,u=!1){const g=dh.fromPoints(h[0]),y=Math.min(g.width(),g.height());let T=y/2;const S=new gr([],lr),{minX:M,minY:R,maxX:L,maxY:F}=g;if(y===0)return new m(M,R);for(let X=M;X<L;X+=y)for(let Q=R;Q<F;Q+=y)S.push(new Ir(X+T,Q+T,T,h));let U=(function(X){let Q=0,te=0,ae=0;const de=X[0];for(let Te=0,he=de.length,ve=he-1;Te<he;ve=Te++){const Oe=de[Te],Fe=de[ve],it=Oe.x*Fe.y-Fe.x*Oe.y;te+=(Oe.x+Fe.x)*it,ae+=(Oe.y+Fe.y)*it,Q+=3*it}return new Ir(te/Q,ae/Q,0,X)})(h),q=S.length;for(;S.length;){const X=S.pop();(X.d>U.d||!U.d)&&(U=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,q)),X.max-U.d<=a||(T=X.h/2,S.push(new Ir(X.p.x-T,X.p.y-T,T,h)),S.push(new Ir(X.p.x+T,X.p.y-T,T,h)),S.push(new Ir(X.p.x-T,X.p.y+T,T,h)),S.push(new Ir(X.p.x+T,X.p.y+T,T,h)),q+=4)}return u&&(console.log(`num probes: ${q}`),console.log(`best distance: ${U.d}`)),U.p}function lr(h,a){return a.max-h.max}function Ir(h,a,u,g){this.p=new m(h,a),this.h=u,this.d=(function(y,T){let S=!1,M=1/0;for(let R=0;R<T.length;R++){const L=T[R];for(let F=0,U=L.length,q=U-1;F<U;q=F++){const X=L[F],Q=L[q];X.y>y.y!=Q.y>y.y&&y.x<(Q.x-X.x)*(y.y-X.y)/(Q.y-X.y)+X.x&&(S=!S),M=Math.min(M,lv(y,X,Q))}}return(S?1:-1)*Math.sqrt(M)})(this.p,g),this.max=this.d+this.h*Math.SQRT2}var br;c.aP=void 0,(br=c.aP||(c.aP={}))[br.center=1]="center",br[br.left=2]="left",br[br.right=3]="right",br[br.top=4]="top",br[br.bottom=5]="bottom",br[br["top-left"]=6]="top-left",br[br["top-right"]=7]="top-right",br[br["bottom-left"]=8]="bottom-left",br[br["bottom-right"]=9]="bottom-right";const Jr=Number.POSITIVE_INFINITY;function pu(h,a){return a[1]!==Jr?(function(u,g,y){let T=0,S=0;switch(g=Math.abs(g),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":T=-g;break;case"top-left":case"bottom-left":case"left":T=g}return[T,S]})(h,a[0],a[1]):(function(u,g){let y=0,T=0;g<0&&(g=0);const S=g/Math.SQRT2;switch(u){case"top-right":case"top-left":T=S-7;break;case"bottom-right":case"bottom-left":T=7-S;break;case"bottom":T=7-g;break;case"top":T=g-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=g;break;case"right":y=-g}return[y,T]})(h,a[0])}function jx(h,a,u){var g;const y=h.layout,T=(g=y.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(a,{},u);if(T){const M=T.values,R=[];for(let L=0;L<M.length;L+=2){const F=R[L]=M[L],U=M[L+1].map((q=>q*Si));F.startsWith("top")?U[1]-=7:F.startsWith("bottom")&&(U[1]+=7),R[L+1]=U}return new qn(R)}const S=y.get("text-variable-anchor");if(S){let M;M=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*Si,Jr]:y.get("text-offset").evaluate(a,{},u).map((L=>L*Si));const R=[];for(const L of S)R.push(L,pu(L,M));return new qn(R)}return null}function A2(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function h8(h,a,u,g,y,T,S,M,R,L,F,U){let q=T.textMaxSize.evaluate(a,{});q===void 0&&(q=S);const X=h.layers[0].layout,Q=X.get("icon-offset").evaluate(a,{},F),te=kM(u.horizontal),ae=S/24,de=h.tilePixelRatio*ae,Te=h.tilePixelRatio*q/24,he=h.tilePixelRatio*M,ve=h.tilePixelRatio*X.get("symbol-spacing"),Oe=X.get("text-padding")*h.tilePixelRatio,Fe=(function(Jt,ar,tr,Or=1){const Qn=Jt.get("icon-padding").evaluate(ar,{},tr),Li=Qn&&Qn.values;return[Li[0]*Or,Li[1]*Or,Li[2]*Or,Li[3]*Or]})(X,a,F,h.tilePixelRatio),it=X.get("text-max-angle")/180*Math.PI,vt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",xt=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",It=X.get("symbol-placement"),Vt=ve/2,kt=X.get("icon-text-fit");let wt;g&&kt!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(wt=_l(g,u.vertical,kt,X.get("icon-text-fit-padding"),Q,ae)),te&&(g=_l(g,te,kt,X.get("icon-text-fit-padding"),Q,ae)));const pt=F?U.line.getGranularityForZoomLevel(F.z):1,Gt=(Jt,ar)=>{ar.x<0||ar.x>=Ue||ar.y<0||ar.y>=Ue||(function(tr,Or,Qn,Li,Ls,cc,Ua,ds,Ns,gi,ps,fa,da,ho,zs,fo,uc,Qi,ii,Ni,hi,Ji,Vf,gu,n0){const cp=tr.addToLineVertexArray(Or,Qn);let Bg,Q_,J_,ey,BM=0,FM=0,jM=0,UM=0,D2=-1,k2=-1;const $f={};let VM=Yn("");if(tr.allowVerticalPlacement&&Li.vertical){const pa=ds.layout.get("text-rotate").evaluate(hi,{},gu)+90;J_=new Mt(Ns,Or,gi,ps,fa,Li.vertical,da,ho,zs,pa),Ua&&(ey=new Mt(Ns,Or,gi,ps,fa,Ua,uc,Qi,zs,pa))}if(Ls){const pa=ds.layout.get("icon-rotate").evaluate(hi,{}),bl=ds.layout.get("icon-text-fit")!=="none",Fg=wr(Ls,pa,Vf,bl),_u=Ua?wr(Ua,pa,Vf,bl):void 0;Q_=new Mt(Ns,Or,gi,ps,fa,Ls,uc,Qi,!1,pa),BM=4*Fg.length;const jg=tr.iconSizeData;let bh=null;jg.kind==="source"?(bh=[co*ds.layout.get("icon-size").evaluate(hi,{})],bh[0]>hh&&_r(`${tr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):jg.kind==="composite"&&(bh=[co*Ji.compositeIconSizes[0].evaluate(hi,{},gu),co*Ji.compositeIconSizes[1].evaluate(hi,{},gu)],(bh[0]>hh||bh[1]>hh)&&_r(`${tr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tr.addSymbols(tr.icon,Fg,bh,Ni,ii,hi,c.az.none,Or,cp.lineStartIndex,cp.lineLength,-1,gu),D2=tr.icon.placedSymbolArray.length-1,_u&&(FM=4*_u.length,tr.addSymbols(tr.icon,_u,bh,Ni,ii,hi,c.az.vertical,Or,cp.lineStartIndex,cp.lineLength,-1,gu),k2=tr.icon.placedSymbolArray.length-1)}const $M=Object.keys(Li.horizontal);for(const pa of $M){const bl=Li.horizontal[pa];if(!Bg){VM=Yn(bl.text);const _u=ds.layout.get("text-rotate").evaluate(hi,{},gu);Bg=new Mt(Ns,Or,gi,ps,fa,bl,da,ho,zs,_u)}const Fg=bl.positionedLines.length===1;if(jM+=DM(tr,Or,bl,cc,ds,zs,hi,fo,cp,Li.vertical?c.az.horizontal:c.az.horizontalOnly,Fg?$M:[pa],$f,D2,Ji,gu),Fg)break}Li.vertical&&(UM+=DM(tr,Or,Li.vertical,cc,ds,zs,hi,fo,cp,c.az.vertical,["vertical"],$f,k2,Ji,gu));const p8=Bg?Bg.boxStartIndex:tr.collisionBoxArray.length,g8=Bg?Bg.boxEndIndex:tr.collisionBoxArray.length,m8=J_?J_.boxStartIndex:tr.collisionBoxArray.length,_8=J_?J_.boxEndIndex:tr.collisionBoxArray.length,y8=Q_?Q_.boxStartIndex:tr.collisionBoxArray.length,v8=Q_?Q_.boxEndIndex:tr.collisionBoxArray.length,b8=ey?ey.boxStartIndex:tr.collisionBoxArray.length,x8=ey?ey.boxEndIndex:tr.collisionBoxArray.length;let mu=-1;const Vx=(pa,bl)=>pa&&pa.circleDiameter?Math.max(pa.circleDiameter,bl):bl;mu=Vx(Bg,mu),mu=Vx(J_,mu),mu=Vx(Q_,mu),mu=Vx(ey,mu);const WM=mu>-1?1:0;WM&&(mu*=n0/Si),tr.glyphOffsetArray.length>=rp.MAX_GLYPHS&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hi.sortKey!==void 0&&tr.addToSortKeyRanges(tr.symbolInstances.length,hi.sortKey);const w8=jx(ds,hi,gu),[T8,S8]=(function(pa,bl){const Fg=pa.length,_u=bl?.values;if(_u?.length>0)for(let jg=0;jg<_u.length;jg+=2){const bh=_u[jg+1];pa.emplaceBack(c.aP[_u[jg]],bh[0],bh[1])}return[Fg,pa.length]})(tr.textAnchorOffsets,w8);tr.symbolInstances.emplaceBack(Or.x,Or.y,$f.right>=0?$f.right:-1,$f.center>=0?$f.center:-1,$f.left>=0?$f.left:-1,$f.vertical||-1,D2,k2,VM,p8,g8,m8,_8,y8,v8,b8,x8,gi,jM,UM,BM,FM,WM,0,da,mu,T8,S8)})(h,ar,Jt,u,g,y,wt,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,de,[Oe,Oe,Oe,Oe],vt,R,he,Fe,xt,Q,a,T,L,F,S)};if(It==="line")for(const Jt of p(a.geometry,0,0,Ue,Ue)){const ar=nu(Jt,pt),tr=yt(ar,ve,it,u.vertical||te,g,24,Te,h.overscaling,Ue);for(const Or of tr)te&&f8(h,te.text,Vt,Or)||Gt(ar,Or)}else if(It==="line-center"){for(const Jt of a.geometry)if(Jt.length>1){const ar=nu(Jt,pt),tr=dt(ar,it,u.vertical||te,g,24,Te);tr&&Gt(ar,tr)}}else if(a.type==="Polygon")for(const Jt of nf(a.geometry,0)){const ar=ln(Jt,16);Gt(nu(Jt[0],pt,!0),new pe(ar.x,ar.y,0))}else if(a.type==="LineString")for(const Jt of a.geometry){const ar=nu(Jt,pt);Gt(ar,new pe(ar[0].x,ar[0].y,0))}else if(a.type==="Point")for(const Jt of a.geometry)for(const ar of Jt)Gt([ar],new pe(ar.x,ar.y,0))}function DM(h,a,u,g,y,T,S,M,R,L,F,U,q,X,Q){const te=(function(Te,he,ve,Oe,Fe,it,vt,xt){const It=Oe.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Vt=[];for(const kt of he.positionedLines)for(const wt of kt.positionedGlyphs){if(!wt.rect)continue;const pt=wt.rect||{};let Gt=4,Jt=!0,ar=1,tr=0;const Or=(Fe||xt)&&wt.vertical,Qn=wt.metrics.advance*wt.scale/2;if(xt&&he.verticalizable&&(tr=kt.lineOffset/2-(wt.imageName?-(Si-wt.metrics.width*wt.scale)/2:(wt.scale-1)*Si)),wt.imageName){const Qi=vt[wt.imageName];Jt=Qi.sdf,ar=Qi.pixelRatio,Gt=1/ar}const Li=Fe?[wt.x+Qn,wt.y]:[0,0];let Ls=Fe?[0,0]:[wt.x+Qn+ve[0],wt.y+ve[1]-tr],cc=[0,0];Or&&(cc=Ls,Ls=[0,0]);const Ua=wt.metrics.isDoubleResolution?2:1,ds=(wt.metrics.left-Gt)*wt.scale-Qn+Ls[0],Ns=(-wt.metrics.top-Gt)*wt.scale+Ls[1],gi=ds+pt.w/Ua*wt.scale/ar,ps=Ns+pt.h/Ua*wt.scale/ar,fa=new m(ds,Ns),da=new m(gi,Ns),ho=new m(ds,ps),zs=new m(gi,ps);if(Or){const Qi=new m(-Qn,Qn- -17),ii=-Math.PI/2,Ni=12-Qn,hi=new m(22-Ni,-(wt.imageName?Ni:0)),Ji=new m(...cc);fa._rotateAround(ii,Qi)._add(hi)._add(Ji),da._rotateAround(ii,Qi)._add(hi)._add(Ji),ho._rotateAround(ii,Qi)._add(hi)._add(Ji),zs._rotateAround(ii,Qi)._add(hi)._add(Ji)}if(It){const Qi=Math.sin(It),ii=Math.cos(It),Ni=[ii,-Qi,Qi,ii];fa._matMult(Ni),da._matMult(Ni),ho._matMult(Ni),zs._matMult(Ni)}const fo=new m(0,0),uc=new m(0,0);Vt.push({tl:fa,tr:da,bl:ho,br:zs,tex:pt,writingMode:he.writingMode,glyphOffset:Li,sectionIndex:wt.sectionIndex,isSDF:Jt,pixelOffsetTL:fo,pixelOffsetBR:uc,minFontScaleX:0,minFontScaleY:0})}return Vt})(0,u,M,y,T,S,g,h.allowVerticalPlacement),ae=h.textSizeData;let de=null;ae.kind==="source"?(de=[co*y.layout.get("text-size").evaluate(S,{})],de[0]>hh&&_r(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(de=[co*X.compositeTextSizes[0].evaluate(S,{},Q),co*X.compositeTextSizes[1].evaluate(S,{},Q)],(de[0]>hh||de[1]>hh)&&_r(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),h.addSymbols(h.text,te,de,M,T,S,L,a,R.lineStartIndex,R.lineLength,q,Q);for(const Te of F)U[Te]=h.text.placedSymbolArray.length-1;return 4*te.length}function kM(h){for(const a in h)return h[a];return null}function f8(h,a,u,g){const y=h.compareText;if(a in y){const T=y[a];for(let S=T.length-1;S>=0;S--)if(g.dist(T[S])<u)return!0}else y[a]=[];return y[a].push(g),!1}const LM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class E2{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,g]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=g>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const T=LM[15&g];if(!T)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(a,2,1),[M]=new Uint32Array(a,4,1);return new E2(M,S,T,a)}constructor(a,u=64,g=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=g,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const T=LM.indexOf(this.ArrayType),S=2*a*this.ArrayType.BYTES_PER_ELEMENT,M=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${g}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=a,this.coords[this._pos++]=u,g}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return P2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,g,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:S,nodeSize:M}=this,R=[0,T.length-1,0],L=[];for(;R.length;){const F=R.pop()||0,U=R.pop()||0,q=R.pop()||0;if(U-q<=M){for(let ae=q;ae<=U;ae++){const de=S[2*ae],Te=S[2*ae+1];de>=a&&de<=g&&Te>=u&&Te<=y&&L.push(T[ae])}continue}const X=q+U>>1,Q=S[2*X],te=S[2*X+1];Q>=a&&Q<=g&&te>=u&&te<=y&&L.push(T[X]),(F===0?a<=Q:u<=te)&&(R.push(q),R.push(X-1),R.push(1-F)),(F===0?g>=Q:y>=te)&&(R.push(X+1),R.push(U),R.push(1-F))}return L}within(a,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:T,nodeSize:S}=this,M=[0,y.length-1,0],R=[],L=g*g;for(;M.length;){const F=M.pop()||0,U=M.pop()||0,q=M.pop()||0;if(U-q<=S){for(let ae=q;ae<=U;ae++)zM(T[2*ae],T[2*ae+1],a,u)<=L&&R.push(y[ae]);continue}const X=q+U>>1,Q=T[2*X],te=T[2*X+1];zM(Q,te,a,u)<=L&&R.push(y[X]),(F===0?a-g<=Q:u-g<=te)&&(M.push(q),M.push(X-1),M.push(1-F)),(F===0?a+g>=Q:u+g>=te)&&(M.push(X+1),M.push(U),M.push(1-F))}return R}}function P2(h,a,u,g,y,T){if(y-g<=u)return;const S=g+y>>1;NM(h,a,S,g,y,T),P2(h,a,u,g,S-1,1-T),P2(h,a,u,S+1,y,1-T)}function NM(h,a,u,g,y,T){for(;y>g;){if(y-g>600){const L=y-g+1,F=u-g+1,U=Math.log(L),q=.5*Math.exp(2*U/3),X=.5*Math.sqrt(U*q*(L-q)/L)*(F-L/2<0?-1:1);NM(h,a,u,Math.max(g,Math.floor(u-F*q/L+X)),Math.min(y,Math.floor(u+(L-F)*q/L+X)),T)}const S=a[2*u+T];let M=g,R=y;for(t0(h,a,g,u),a[2*y+T]>S&&t0(h,a,g,y);M<R;){for(t0(h,a,M,R),M++,R--;a[2*M+T]<S;)M++;for(;a[2*R+T]>S;)R--}a[2*g+T]===S?t0(h,a,g,R):(R++,t0(h,a,R,y)),R<=u&&(g=R+1),u<=R&&(y=R-1)}}function t0(h,a,u,g){C2(h,u,g),C2(a,2*u,2*g),C2(a,2*u+1,2*g+1)}function C2(h,a,u){const g=h[a];h[a]=h[u],h[u]=g}function zM(h,a,u,g){const y=h-u,T=a-g;return y*y+T*T}var M2;c.cI=void 0,(M2=c.cI||(c.cI={})).create="create",M2.load="load",M2.fullLoad="fullLoad";let Ux=null,r0=[];const I2=1e3/60,R2="loadTime",O2="fullLoadTime",d8={mark(h){performance.mark(h)},recordStartOfFrameAt(h){Ux!=null&&r0.push(h-Ux),Ux=h},resetRuntimeMetrics(){Ux=null,r0=[]},clearInitializationMetrics(){performance.clearMeasures(R2),performance.clearMeasures(O2);for(const h in c.cI)performance.clearMarks(c.cI[h])},remove(){this.resetRuntimeMetrics(),this.clearInitializationMetrics()},getPerformanceMetrics(){performance.measure(R2,c.cI.create,c.cI.load),performance.measure(O2,c.cI.create,c.cI.fullLoad);const h=performance.getEntriesByName(R2)[0].duration,a=performance.getEntriesByName(O2)[0].duration,u=r0.length;return{loadTimeMs:h,fullLoadTimeMs:a,averageFramesPerSecond:1/(r0.reduce(((g,y)=>g+y),0)/u/1e3),virtualDroppedFramesCount:r0.filter((g=>g>I2)).reduce(((g,y)=>g+(y-I2)/I2),0),totalFramesCount:u}}};c.$=j,c.A=re,c.B=eo,c.C=Ti,c.D=qt,c.E=mt,c.F=function([h,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(a)*Math.sin(u),y:h*Math.sin(a)*Math.sin(u),z:h*Math.cos(u)}},c.G=In,c.H=tn,c.I=gn,c.J=kd,c.K=function(h){if(Yr==null){const a=h.navigator?h.navigator.userAgent:null;Yr=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Yr},c.L=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new I_((()=>this.process())),this.subscription=Du(this.target,"message",(u=>this.receive(u)),!1),this.globalScope=ur(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}unregisterMessageHandler(h){delete this.messageHandlers[h]}sendAsync(h,a){return new Promise(((u,g)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10),T=a?Du(a.signal,"abort",(()=>{T?.unsubscribe(),delete this.resolveRejects[y];const R={id:y,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)}),Nv):null;this.resolveRejects[y]={resolve:R=>{T?.unsubscribe(),u(R)},reject:R=>{T?.unsubscribe(),g(R)}};const S=[],M=Object.assign(Object.assign({},h),{id:y,sourceMapId:this.mapId,origin:location.origin,data:to(h.data,S)});this.target.postMessage(M,{transfer:S})}))}receive(h){const a=h.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const g=this.abortControllers[u];return delete this.abortControllers[u],void(g&&g.abort())}if(ur(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return s(this,void 0,void 0,(function*(){if(a.type==="<response>"){const y=this.resolveRejects[h];return delete this.resolveRejects[h],y?void(a.error?y.reject(th(a.error)):y.resolve(th(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=th(a.data),g=new AbortController;this.abortControllers[h]=g;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,g);this.completeTask(h,null,y)}catch(y){this.completeTask(h,y)}}))}completeTask(h,a,u){const g=[];delete this.abortControllers[h];const y={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?to(a):null,data:to(u,g)};this.target.postMessage(y,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.M=ie,c.N=function(){var h=new re(16);return re!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.O=function(h,a,u){var g,y,T,S,M,R,L,F,U,q,X,Q,te=u[0],ae=u[1],de=u[2];return a===h?(h[12]=a[0]*te+a[4]*ae+a[8]*de+a[12],h[13]=a[1]*te+a[5]*ae+a[9]*de+a[13],h[14]=a[2]*te+a[6]*ae+a[10]*de+a[14],h[15]=a[3]*te+a[7]*ae+a[11]*de+a[15]):(y=a[1],T=a[2],S=a[3],M=a[4],R=a[5],L=a[6],F=a[7],U=a[8],q=a[9],X=a[10],Q=a[11],h[0]=g=a[0],h[1]=y,h[2]=T,h[3]=S,h[4]=M,h[5]=R,h[6]=L,h[7]=F,h[8]=U,h[9]=q,h[10]=X,h[11]=Q,h[12]=g*te+M*ae+U*de+a[12],h[13]=y*te+R*ae+q*de+a[13],h[14]=T*te+L*ae+X*de+a[14],h[15]=S*te+F*ae+Q*de+a[15]),h},c.P=m,c.Q=function(h,a,u){var g=u[0],y=u[1],T=u[2];return h[0]=a[0]*g,h[1]=a[1]*g,h[2]=a[2]*g,h[3]=a[3]*g,h[4]=a[4]*y,h[5]=a[5]*y,h[6]=a[6]*y,h[7]=a[7]*y,h[8]=a[8]*T,h[9]=a[9]*T,h[10]=a[10]*T,h[11]=a[11]*T,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.R=Rs,c.S=function(h,a,u){var g=a[0],y=a[1],T=a[2],S=a[3],M=a[4],R=a[5],L=a[6],F=a[7],U=a[8],q=a[9],X=a[10],Q=a[11],te=a[12],ae=a[13],de=a[14],Te=a[15],he=u[0],ve=u[1],Oe=u[2],Fe=u[3];return h[0]=he*g+ve*M+Oe*U+Fe*te,h[1]=he*y+ve*R+Oe*q+Fe*ae,h[2]=he*T+ve*L+Oe*X+Fe*de,h[3]=he*S+ve*F+Oe*Q+Fe*Te,h[4]=(he=u[4])*g+(ve=u[5])*M+(Oe=u[6])*U+(Fe=u[7])*te,h[5]=he*y+ve*R+Oe*q+Fe*ae,h[6]=he*T+ve*L+Oe*X+Fe*de,h[7]=he*S+ve*F+Oe*Q+Fe*Te,h[8]=(he=u[8])*g+(ve=u[9])*M+(Oe=u[10])*U+(Fe=u[11])*te,h[9]=he*y+ve*R+Oe*q+Fe*ae,h[10]=he*T+ve*L+Oe*X+Fe*de,h[11]=he*S+ve*F+Oe*Q+Fe*Te,h[12]=(he=u[12])*g+(ve=u[13])*M+(Oe=u[14])*U+(Fe=u[15])*te,h[13]=he*y+ve*R+Oe*q+Fe*ae,h[14]=he*T+ve*L+Oe*X+Fe*de,h[15]=he*S+ve*F+Oe*Q+Fe*Te,h},c.T=o_,c.U=function(h,a){const u={};for(let g=0;g<a.length;g++){const y=a[g];y in h&&(u[y]=h[y])}return u},c.V=sc,c.W=Wt,c.X=zv,c.Y=vx,c.Z=Ol,c._=s,c.a=Vh,c.a$=Et,c.a0=Y,c.a1=Zo,c.a2=ca,c.a3=xx,c.a4=xg,c.a5=Ue,c.a6=function(h,a,u){if(!h)return a||{};if(!a)return h||{};const g=Tg(h),y=Tg(a);(function(S,M){M.removeAll&&(S.add.clear(),S.update.clear(),S.remove.clear(),M.remove.clear());for(const R of M.remove)S.add.delete(R),S.update.delete(R);for(const[R,L]of M.update){const F=S.update.get(R);F&&(M.update.set(R,Fv(F,L)),S.update.delete(R))}})(g,y);const T={};if((g.removeAll||y.removeAll)&&(T.removeAll=!0),T.remove=new Set([...g.remove,...y.remove]),T.add=new Map([...g.add,...y.add]),T.update=new Map([...g.update,...y.update]),T.remove.size&&T.add.size)for(const S of T.add.keys())T.remove.delete(S);return(function(S){const M={};return S.removeAll&&(M.removeAll=S.removeAll),S.remove&&(M.remove=Array.from(S.remove)),S.add&&(M.add=Array.from(S.add.values())),S.update&&(M.update=Array.from(S.update.values())),M})(T)},c.a7=function(h,a){const u=new Map;if(h==null||h.type==null)return u;if(h.type==="Feature"){const g=wg(h,a);return g==null?void 0:(u.set(g,h),u)}if(h.type==="FeatureCollection"){const g=new Set;for(const y of h.features){const T=wg(y,a);if(T==null||g.has(T))return;g.add(T),u.set(T,y)}return u}},c.a8=function(h,a,u){var g,y;const T=[];if(a.removeAll)h.clear();else if(a.remove)for(const S of a.remove){const M=h.get(S);M&&(T.push(M.geometry),h.delete(S))}if(a.add)for(const S of a.add){const M=wg(S,u);if(M==null)continue;const R=h.get(M);R&&T.push(R.geometry),T.push(S.geometry),h.set(M,S)}if(a.update)for(const S of a.update){const M=h.get(S.id);if(!M)continue;const R=!!S.newGeometry,L=S.removeAllProperties||((g=S.removeProperties)===null||g===void 0?void 0:g.length)>0||((y=S.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0;if(!R&&!L)continue;T.push(M.geometry);const F=Object.assign({},M);if(h.set(S.id,F),R&&(T.push(S.newGeometry),F.geometry=S.newGeometry),L){if(F.properties=S.removeAllProperties?{}:Object.assign({},F.properties||{}),S.removeProperties)for(const U of S.removeProperties)delete F.properties[U];if(S.addOrUpdateProperties)for(const{key:U,value:q}of S.addOrUpdateProperties)F.properties[U]=q}}return T},c.a9=on,c.aA=function(h,{uSize:a,uSizeT:u},{lowerSize:g,upperSize:y}){return h.kind==="source"?g/co:h.kind==="composite"?In.number(g/co,y/co,u):a},c.aB=function(h,a){var u=a[0],g=a[1],y=a[2],T=a[3],S=a[4],M=a[5],R=a[6],L=a[7],F=a[8],U=a[9],q=a[10],X=a[11],Q=a[12],te=a[13],ae=a[14],de=a[15],Te=u*M-g*S,he=u*R-y*S,ve=u*L-T*S,Oe=g*R-y*M,Fe=g*L-T*M,it=y*L-T*R,vt=F*te-U*Q,xt=F*ae-q*Q,It=F*de-X*Q,Vt=U*ae-q*te,kt=U*de-X*te,wt=q*de-X*ae,pt=Te*wt-he*kt+ve*Vt+Oe*It-Fe*xt+it*vt;return pt?(h[0]=(M*wt-R*kt+L*Vt)*(pt=1/pt),h[1]=(y*kt-g*wt-T*Vt)*pt,h[2]=(te*it-ae*Fe+de*Oe)*pt,h[3]=(q*Fe-U*it-X*Oe)*pt,h[4]=(R*It-S*wt-L*xt)*pt,h[5]=(u*wt-y*It+T*xt)*pt,h[6]=(ae*ve-Q*it-de*he)*pt,h[7]=(F*it-q*ve+X*he)*pt,h[8]=(S*kt-M*It+L*vt)*pt,h[9]=(g*It-u*kt-T*vt)*pt,h[10]=(Q*Fe-te*ve+de*Te)*pt,h[11]=(U*ve-F*Fe-X*Te)*pt,h[12]=(M*xt-S*Vt-R*vt)*pt,h[13]=(u*Vt-g*xt+y*vt)*pt,h[14]=(te*he-Q*Oe-ae*Te)*pt,h[15]=(F*Oe-U*he+q*Te)*pt,h):null},c.aC=Me,c.aD=function(h){var a=h[0],u=h[1];return Math.sqrt(a*a+u*u)},c.aE=function(h){return h[0]=0,h[1]=0,h},c.aF=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h},c.aG=Ov,c.aH=St,c.aI=function(h,a,u,g){const y=a.y-h.y,T=a.x-h.x,S=g.y-u.y,M=g.x-u.x,R=S*T-M*y;if(R===0)return null;const L=(M*(h.y-u.y)-S*(h.x-u.x))/R;return new m(h.x+L*T,h.y+L*y)},c.aJ=p,c.aK=If,c.aL=function(h){let a=1/0,u=1/0,g=-1/0,y=-1/0;for(const T of h)a=Math.min(a,T.x),u=Math.min(u,T.y),g=Math.max(g,T.x),y=Math.max(y,T.y);return[a,u,g,y]},c.aM=Si,c.aN=st,c.aO=function(h,a,u,g,y=!1){if(!u[0]&&!u[1])return[0,0];const T=y?g==="map"?-h.bearingInRadians:0:g==="viewport"?h.bearingInRadians:0;if(T){const S=Math.sin(T),M=Math.cos(T);u=[u[0]*M-u[1]*S,u[0]*S+u[1]*M]}return[y?u[0]:st(a,u[0],h.zoom),y?u[1]:st(a,u[1],h.zoom)]},c.aQ=A_,c.aR=A2,c.aS=Cv,c.aT=E2,c.aU=Rn,c.aV=hg,c.aW=_e,c.aX=$t,c.aY=ot,c.aZ=Xs,c.a_=Bv,c.aa=dh,c.ab=25,c.ac=qi,c.ad=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise((u=>{a.onloadstart=()=>{u(a)};for(const g of h){const y=window.document.createElement("source");tt(g)||(a.crossOrigin="Anonymous"),y.src=g,a.appendChild(y)}}))},c.ae=Ot,c.af=function(){return _t++},c.ag=x,c.ah=rp,c.ai=vh,c.aj=As,c.ak=oo,c.al=D_,c.am=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,g,y,T)=>{const S=y||T;return a[g]=!S||S.toLowerCase(),""})),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},c.an=Xt,c.ao=85.051129,c.ap=vi,c.aq=function(h){return Math.pow(2,h)},c.ar=me,c.as=bx,c.at=function(h){return Math.log(h)/Math.LN2},c.au=function(h){var a=h[0],u=h[1];return a*a+u*u},c.av=function(h){if(!h.length)return new Set;const a=Math.max(...h.map((R=>R.canonical.z)));let u=1/0,g=-1/0,y=1/0,T=-1/0;const S=[];for(const R of h){const{x:L,y:F,z:U}=R.canonical,q=Math.pow(2,a-U),X=L*q,Q=F*q;S.push({id:R,x:X,y:Q}),X<u&&(u=X),X>g&&(g=X),Q<y&&(y=Q),Q>T&&(T=Q)}const M=new Set;for(const R of S)R.x!==u&&R.x!==g&&R.y!==y&&R.y!==T||M.add(R.id);return M},c.aw=function(h,a){const u=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*a.wrap)-+(a.wrap<0);return h.overscaledZ-a.overscaledZ||g-u||a.canonical.y-h.canonical.y||a.canonical.x-h.canonical.x},c.ax=class{constructor(h,a){this.max=h,this.onRemove=a,this.reset()}reset(){for(const h in this.data)for(const a of this.data[h])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(h,a,u){const g=h.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:a,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout((()=>{this.remove(h,y)}),u)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){const a=this.data[h].shift();return a.timeout&&clearTimeout(a.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),a.value}getByKey(h){const a=this.data[h];return a?a[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,a){if(!this.has(h))return this;const u=h.wrapped().key,g=a===void 0?0:this.data[u].indexOf(a),y=this.data[u][g];return this.data[u].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(h){const a=[];for(const u in this.data)for(const g of this.data[u])h(g.value)||a.push(g);for(const u of a)this.remove(u.value.tileID,u)}},c.ay=function(h,a){let u=0,g=0;if(h.kind==="constant")g=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:y,minZoom:T,maxZoom:S}=h,M=y?Xt(cs.interpolationFactor(y,a,T,S),0,1):0;h.kind==="camera"?g=In.number(h.minSize,h.maxSize,M):u=M}return{uSizeT:u,uSize:g}},c.b=qs,c.b$=ao,c.b0=Xe,c.b1=function(h){var a=new re(3);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a},c.b2=function(h,a,u){return h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],h},c.b3=function(h,a){var u=a[0],g=a[1],y=a[2],T=u*u+g*g+y*y;return T>0&&(T=1/Math.sqrt(T)),h[0]=a[0]*T,h[1]=a[1]*T,h[2]=a[2]*T,h},c.b4=gt,c.b5=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]},c.b6=function(h,a,u){return h[0]=a[0]*u[0],h[1]=a[1]*u[1],h[2]=a[2]*u[2],h[3]=a[3]*u[3],h},c.b7=Ce,c.b8=function(h,a,u){const g=a[0]*u[0]+a[1]*u[1]+a[2]*u[2];return g===0?null:(-(h[0]*u[0]+h[1]*u[1]+h[2]*u[2])-u[3])/g},c.b9=jt,c.bA=function(){return new Float64Array(3)},c.bB=fe,c.bC=function(h,a,u){var g=u[0],y=u[1],T=u[2],S=u[3],M=a[0],R=a[1],L=a[2],F=y*L-T*R,U=T*M-g*L,q=g*R-y*M;return h[0]=M+S*(F+=F)+y*(q+=q)-T*(U+=U),h[1]=R+S*U+T*F-g*q,h[2]=L+S*q+g*U-y*F,h},c.bD=function(h,a,u){const g=(y=[h[0],h[1],h[2],a[0],a[1],a[2],u[0],u[1],u[2]])[0]*((F=y[8])*(S=y[4])-(M=y[5])*(L=y[7]))+y[1]*(-F*(T=y[3])+M*(R=y[6]))+y[2]*(L*T-S*R);var y,T,S,M,R,L,F;if(g===0)return null;const U=gt([],[a[0],a[1],a[2]],[u[0],u[1],u[2]]),q=gt([],[u[0],u[1],u[2]],[h[0],h[1],h[2]]),X=gt([],[h[0],h[1],h[2]],[a[0],a[1],a[2]]),Q=Et([],U,-h[3]);return Xe(Q,Q,Et([],q,-a[3])),Xe(Q,Q,Et([],X,-u[3])),Et(Q,Q,1/g),Q},c.bE=R_,c.bF=function(){return new Float64Array(4)},c.bG=function(h,a,u,g){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[0]*Math.cos(g)-y[1]*Math.sin(g),T[1]=y[0]*Math.sin(g)+y[1]*Math.cos(g),T[2]=y[2],h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bH=function(h,a,u,g){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[0],T[1]=y[1]*Math.cos(g)-y[2]*Math.sin(g),T[2]=y[1]*Math.sin(g)+y[2]*Math.cos(g),h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bI=function(h,a,u,g){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[2]*Math.sin(g)+y[0]*Math.cos(g),T[1]=y[1],T[2]=y[2]*Math.cos(g)-y[0]*Math.sin(g),h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bJ=function(h,a,u){var g=Math.sin(u),y=Math.cos(u),T=a[0],S=a[1],M=a[2],R=a[3],L=a[8],F=a[9],U=a[10],q=a[11];return a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=T*y-L*g,h[1]=S*y-F*g,h[2]=M*y-U*g,h[3]=R*y-q*g,h[8]=T*g+L*y,h[9]=S*g+F*y,h[10]=M*g+U*y,h[11]=R*g+q*y,h},c.bK=function(h,a){const u=ye(h,360),g=ye(a,360),y=g-u,T=g>u?y-360:y+360;return Math.abs(y)<Math.abs(T)?y:T},c.bL=function(h){return h[0]=0,h[1]=0,h[2]=0,h},c.bM=function(h,a,u,g){const y=Math.sqrt(h*h+a*a),T=Math.sqrt(u*u+g*g);h/=y,a/=y,u/=T,g/=T;const S=Math.acos(h*u+a*g);return-a*u+h*g>0?S:-S},c.bN=function(h,a){const u=ye(h,2*Math.PI),g=ye(a,2*Math.PI);return Math.min(Math.abs(u-g),Math.abs(u-g+2*Math.PI),Math.abs(u-g-2*Math.PI))},c.bO=function(){const h={},a=Le.$version;for(const u in Le.$root){const g=Le.$root[u];if(g.required){let y=null;y=u==="version"?a:g.type==="array"?[]:{},y!=null&&(h[u]=y)}}return h},c.bP=Pe,c.bQ=zd,c.bR=function h(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let g=0;g<a.length;g++)if(!h(a[g],u[g]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const g in a)if(!h(a[g],u[g]))return!1;return!0}return a===u},c.bS=function(h){h=h.slice();const a=Object.create(null);for(let u=0;u<h.length;u++)a[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=yr(h[u],a[h[u].ref]));return h},c.bT=function(h,a){if(h.type==="custom")return new Lv(h,a);switch(h.type){case"background":return new $r(h,a);case"circle":return new i_(h,a);case"color-relief":return new Xb(h,a);case"fill":return new Qb(h,a);case"fill-extrusion":return new xv(h,a);case"heatmap":return new Hb(h,a);case"hillshade":return new Kn(h,a);case"line":return new Tv(h,a);case"raster":return new ul(h,a);case"symbol":return new fh(h,a)}},c.bU=h=>h.type==="raster",c.bV=Rt,c.bW=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let u=[];try{if(!or(h.version,a.version))return[{command:"setStyle",args:[a]}];or(h.center,a.center)||u.push({command:"setCenter",args:[a.center]}),or(h.state,a.state)||u.push({command:"setGlobalState",args:[a.state]}),or(h.centerAltitude,a.centerAltitude)||u.push({command:"setCenterAltitude",args:[a.centerAltitude]}),or(h.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),or(h.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),or(h.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),or(h.roll,a.roll)||u.push({command:"setRoll",args:[a.roll]}),or(h.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),or(h.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),or(h.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),or(h.light,a.light)||u.push({command:"setLight",args:[a.light]}),or(h.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),or(h.sky,a.sky)||u.push({command:"setSky",args:[a.sky]}),or(h.projection,a.projection)||u.push({command:"setProjection",args:[a.projection]});const g={},y=[];(function(S,M,R,L){let F;for(F in M=M||{},S=S||{})Object.prototype.hasOwnProperty.call(S,F)&&(Object.prototype.hasOwnProperty.call(M,F)||vr(F,R,L));for(F in M)Object.prototype.hasOwnProperty.call(M,F)&&(Object.prototype.hasOwnProperty.call(S,F)?or(S[F],M[F])||(S[F].type==="geojson"&&M[F].type==="geojson"&&Wn(S,M,F)?fr(R,{command:"setGeoJSONSourceData",args:[F,M[F].data]}):En(F,M,R,L)):dr(F,M,R))})(h.sources,a.sources,y,g);const T=[];h.layers&&h.layers.forEach((S=>{"source"in S&&g[S.source]?u.push({command:"removeLayer",args:[S.id]}):T.push(S)})),u=u.concat(y),(function(S,M,R){M=M||[];const L=(S=S||[]).map(Vi),F=M.map(Vi),U=S.reduce(Pn,{}),q=M.reduce(Pn,{}),X=L.slice(),Q=Object.create(null);let te,ae,de,Te,he;for(let ve=0,Oe=0;ve<L.length;ve++)te=L[ve],Object.prototype.hasOwnProperty.call(q,te)?Oe++:(fr(R,{command:"removeLayer",args:[te]}),X.splice(X.indexOf(te,Oe),1));for(let ve=0,Oe=0;ve<F.length;ve++)te=F[F.length-1-ve],X[X.length-1-ve]!==te&&(Object.prototype.hasOwnProperty.call(U,te)?(fr(R,{command:"removeLayer",args:[te]}),X.splice(X.lastIndexOf(te,X.length-Oe),1)):Oe++,Te=X[X.length-ve],fr(R,{command:"addLayer",args:[q[te],Te]}),X.splice(X.length-ve,0,te),Q[te]=!0);for(let ve=0;ve<F.length;ve++)if(te=F[ve],ae=U[te],de=q[te],!Q[te]&&!or(ae,de))if(or(ae.source,de.source)&&or(ae["source-layer"],de["source-layer"])&&or(ae.type,de.type)){for(he in Nn(ae.layout,de.layout,R,te,null,"setLayoutProperty"),Nn(ae.paint,de.paint,R,te,null,"setPaintProperty"),or(ae.filter,de.filter)||fr(R,{command:"setFilter",args:[te,de.filter]}),or(ae.minzoom,de.minzoom)&&or(ae.maxzoom,de.maxzoom)||fr(R,{command:"setLayerZoomRange",args:[te,de.minzoom,de.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Nn(ae[he],de[he],R,te,he.slice(6),"setPaintProperty"):or(ae[he],de[he])||fr(R,{command:"setLayerProperty",args:[te,he,de[he]]}));for(he in de)Object.prototype.hasOwnProperty.call(de,he)&&!Object.prototype.hasOwnProperty.call(ae,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Nn(ae[he],de[he],R,te,he.slice(6),"setPaintProperty"):or(ae[he],de[he])||fr(R,{command:"setLayerProperty",args:[te,he,de[he]]}))}else fr(R,{command:"removeLayer",args:[te]}),Te=X[X.lastIndexOf(te)+1],fr(R,{command:"addLayer",args:[de,Te]})})(T,a.layers,u)}catch(g){console.warn("Unable to compute style diff:",g),u=[{command:"setStyle",args:[a]}]}return u},c.bX=function(h){const a=[],u=h.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},c.bY=Yt,c.bZ=Tr,c.b_=class extends Ms{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.ba=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h[3]=a[3]*u,h},c.bb=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]},c.bc=wx,c.bd=ip,c.be=function(h,a,u,g,y){var T=1/Math.tan(a/2);if(h[0]=T/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=T,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,y!=null&&y!==1/0){var S=1/(g-y);h[10]=(y+g)*S,h[14]=2*y*g*S}else h[10]=-1,h[14]=-2*g;return h},c.bf=function(h){var a=new re(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.bg=function(h,a,u){var g=Math.sin(u),y=Math.cos(u),T=a[0],S=a[1],M=a[2],R=a[3],L=a[4],F=a[5],U=a[6],q=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=T*y+L*g,h[1]=S*y+F*g,h[2]=M*y+U*g,h[3]=R*y+q*g,h[4]=L*y-T*g,h[5]=F*y-S*g,h[6]=U*y-M*g,h[7]=q*y-R*g,h},c.bh=function(h,a,u){var g=Math.sin(u),y=Math.cos(u),T=a[4],S=a[5],M=a[6],R=a[7],L=a[8],F=a[9],U=a[10],q=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=T*y+L*g,h[5]=S*y+F*g,h[6]=M*y+U*g,h[7]=R*y+q*g,h[8]=L*y-T*g,h[9]=F*y-S*g,h[10]=U*y-M*g,h[11]=q*y-R*g,h},c.bi=function(){const h=new Float32Array(16);return me(h),h},c.bj=function(){const h=new Float64Array(16);return me(h),h},c.bk=function(){return new Float64Array(16)},c.bl=function(h,a,u){const g=new Float64Array(4);return fe(g,h,a-90,u),g},c.bm=function(h,a,u,g){var y,T,S,M,R,L=a[0],F=a[1],U=a[2],q=a[3],X=u[0],Q=u[1],te=u[2],ae=u[3];return(T=L*X+F*Q+U*te+q*ae)<0&&(T=-T,X=-X,Q=-Q,te=-te,ae=-ae),1-T>ce?(y=Math.acos(T),S=Math.sin(y),M=Math.sin((1-g)*y)/S,R=Math.sin(g*y)/S):(M=1-g,R=g),h[0]=M*L+R*X,h[1]=M*F+R*Q,h[2]=M*U+R*te,h[3]=M*q+R*ae,h},c.bn=function(h){const a=new Float64Array(9);var u,g,y,T,S,M,R,L,F,U,q,X,Q,te,ae,de,Te,he;U=(y=(g=h)[0])*(R=y+y),q=(T=g[1])*R,Q=(S=g[2])*R,te=S*(L=T+T),de=(M=g[3])*R,Te=M*L,he=M*(F=S+S),(u=a)[0]=1-(X=T*L)-(ae=S*F),u[3]=q-he,u[6]=Q+Te,u[1]=q+he,u[4]=1-U-ae,u[7]=te-de,u[2]=Q-Te,u[5]=te+de,u[8]=1-U-X;const ve=Xs(-Math.asin(Xt(a[2],-1,1)));let Oe,Fe;return Math.hypot(a[5],a[8])<.001?(Oe=0,Fe=-Xs(Math.atan2(a[3],a[4]))):(Oe=Xs(a[5]===0&&a[8]===0?0:Math.atan2(a[5],a[8])),Fe=Xs(a[1]===0&&a[0]===0?0:Math.atan2(a[1],a[0]))),{roll:Oe,pitch:ve+90,bearing:Fe}},c.bo=function(h,a){return h.roll==a.roll&&h.pitch==a.pitch&&h.bearing==a.bearing},c.bp=Cr,c.bq=Qc,c.br=za,c.bs=gl,c.bt=Hi,c.bu=Be,c.bv=lt,c.bw=xi,c.bx=function(h,a,u,g,y){return Be(g,y,Xt((h-a)/(u-a),0,1))},c.by=function(h,a,u,g){return h[0]=a[0]+u[0]*g,h[1]=a[1]+u[1]*g,h[2]=a[2]+u[2]*g,h},c.bz=ye,c.c=He,c.c$=class{constructor(h){this.start=`${h}#start`,this.end=`${h}#end`,this.measure=h,performance.mark(this.start)}finish(){performance.mark(this.end);let h=performance.getEntriesByName(this.measure);return h.length===0&&(performance.measure(this.measure,this.start,this.end),h=performance.getEntriesByName(this.measure),performance.clearMarks(this.start),performance.clearMarks(this.end),performance.clearMeasures(this.measure)),h}},c.c0=class extends Ms{constructor(h,a){super(h,a),this.current=Is}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.c1=ah,c.c2=class extends Ms{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.c3=class extends Ms{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.c4=ue,c.c5=function(h,a){var u=Math.sin(a),g=Math.cos(a);return h[0]=g,h[1]=u,h[2]=0,h[3]=-u,h[4]=g,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},c.c6=function(h,a,u){var g=a[0],y=a[1],T=a[2];return h[0]=g*u[0]+y*u[3]+T*u[6],h[1]=g*u[1]+y*u[4]+T*u[7],h[2]=g*u[2]+y*u[5]+T*u[8],h},c.c7=function(h,a,u,g,y,T,S){var M=1/(a-u),R=1/(g-y),L=1/(T-S);return h[0]=-2*M,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*R,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*L,h[11]=0,h[12]=(a+u)*M,h[13]=(y+g)*R,h[14]=(S+T)*L,h[15]=1,h},c.c8=class extends Ms{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)a[4*u]=h[u].r,a[4*u+1]=h[u].g,a[4*u+2]=h[u].b,a[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,a)}}},c.c9=class extends Ms{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(h);this.gl.uniform1fv(this.location,a)}}},c.cA=function(h,a){var u;if(!Yo[a])return!1;const g=h?.target,y=((u=g?.ownerDocument)===null||u===void 0?void 0:u.defaultView)||window;return h instanceof y.MouseEvent||h instanceof y.WheelEvent},c.cB=function(h,a){return ku[a]&&"touches"in h},c.cC=function(h){return ku[h]||Yo[h]},c.cD=function(h,a,u){var g=a[0],y=a[1];return h[0]=u[0]*g+u[4]*y+u[12],h[1]=u[1]*g+u[5]*y+u[13],h},c.cE=function(h,a){const{x:u,y:g}=on.fromLngLat(a);return!(h<0||h>25||g<0||g>=1||u<0||u>=1)},c.cF=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.cG=class extends Gc{},c.cH=d8,c.cJ=oe,c.cK=function(h,a){He.REGISTERED_PROTOCOLS[h]=a},c.cL=function(h){delete He.REGISTERED_PROTOCOLS[h]},c.cM=function(h,a){const u={};for(let y=0;y<h.length;y++){const T=a&&a[h[y].id]||nl(h[y]);a&&(a[h[y].id]=T);let S=u[T];S||(S=u[T]=[]),S.push(h[y])}const g=[];for(const y in u)g.push(u[y]);return g},c.cN=Ht,c.cO=jv,c.cP=Fx,c.cQ=w_,c.cR=function(h){var a;h.bucket.createArrays(),h.bucket.tilePixelRatio=Ue/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const u=h.bucket.layers[0],g=u.layout,y=u._unevaluatedLayout._values,T={layoutIconSize:y["icon-size"].possiblyEvaluate(new tn(h.bucket.zoom+1),h.canonical),layoutTextSize:y["text-size"].possiblyEvaluate(new tn(h.bucket.zoom+1),h.canonical),textMaxSize:y["text-size"].possiblyEvaluate(new tn(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:U}=h.bucket.textSizeData;T.compositeTextSizes=[y["text-size"].possiblyEvaluate(new tn(F),h.canonical),y["text-size"].possiblyEvaluate(new tn(U),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:U}=h.bucket.iconSizeData;T.compositeIconSizes=[y["icon-size"].possiblyEvaluate(new tn(F),h.canonical),y["icon-size"].possiblyEvaluate(new tn(U),h.canonical)]}const S=g.get("text-line-height")*Si,M=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",R=g.get("text-keep-upright"),L=g.get("text-size");for(const F of h.bucket.features){const U=g.get("text-font").evaluate(F,{},h.canonical).join(","),q=L.evaluate(F,{},h.canonical),X=T.layoutTextSize.evaluate(F,{},h.canonical),Q=T.layoutIconSize.evaluate(F,{},h.canonical),te={horizontal:{},vertical:void 0},ae=F.text;let de,Te=[0,0];if(ae){const Oe=ae.toString(),Fe=g.get("text-letter-spacing").evaluate(F,{},h.canonical)*Si,it=Bd(Oe)?Fe:0,vt=g.get("text-anchor").evaluate(F,{},h.canonical),xt=jx(u,F,h.canonical);if(!xt){const wt=g.get("text-radial-offset").evaluate(F,{},h.canonical);Te=wt?pu(vt,[wt*Si,Jr]):g.get("text-offset").evaluate(F,{},h.canonical).map((pt=>pt*Si))}let It=M?"center":g.get("text-justify").evaluate(F,{},h.canonical);const Vt=g.get("symbol-placement")==="point"?g.get("text-max-width").evaluate(F,{},h.canonical)*Si:1/0,kt=()=>{h.bucket.allowVerticalPlacement&&zo(Oe)&&(te.vertical=yg(ae,h.glyphMap,h.glyphPositions,h.imagePositions,U,Vt,S,vt,"left",it,Te,c.az.vertical,!0,X,q))};if(!M&&xt){const wt=new Set;if(It==="auto")for(let Gt=0;Gt<xt.values.length;Gt+=2)wt.add(A2(xt.values[Gt]));else wt.add(It);let pt=!1;for(const Gt of wt)if(!te.horizontal[Gt])if(pt)te.horizontal[Gt]=te.horizontal[0];else{const Jt=yg(ae,h.glyphMap,h.glyphPositions,h.imagePositions,U,Vt,S,"center",Gt,it,Te,c.az.horizontal,!1,X,q);Jt&&(te.horizontal[Gt]=Jt,pt=Jt.positionedLines.length===1)}kt()}else{It==="auto"&&(It=A2(vt));const wt=yg(ae,h.glyphMap,h.glyphPositions,h.imagePositions,U,Vt,S,vt,It,it,Te,c.az.horizontal,!1,X,q);wt&&(te.horizontal[It]=wt),kt(),zo(Oe)&&M&&R&&(te.vertical=yg(ae,h.glyphMap,h.glyphPositions,h.imagePositions,U,Vt,S,vt,It,it,Te,c.az.vertical,!1,X,q))}}let he=!1;if(F.icon&&F.icon.name){const Oe=h.imageMap[F.icon.name];Oe&&(de=Iv(h.imagePositions[F.icon.name],g.get("icon-offset").evaluate(F,{},h.canonical),g.get("icon-anchor").evaluate(F,{},h.canonical)),he=!!Oe.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=he:h.bucket.sdfIcons!==he&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==h.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const ve=kM(te.horizontal)||te.vertical;(a=h.bucket).iconsInText||(a.iconsInText=!!ve&&ve.iconsInText),(ve||de)&&h8(h.bucket,F,te,de,h.imageMap,T,X,Q,Te,he,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.cS=Of,c.cT=lh,c.cU=Zd,c.cV=function(h){const a=new v_;return(function(u,g){for(const y in u.layers)g.writeMessage(3,G_,u.layers[y])})(h,a),a.finish()},c.cW=function(h,a,u,g,y,T){let S=v(h,a,u,y,0);return S=v(S,a,g,T,1),S},c.cX=class{constructor(h){this.maxEntries=h,this.map=new Map}get(h){const a=this.map.get(h);return a!==void 0&&(this.map.delete(h),this.map.set(h,a)),a}set(h,a){if(this.map.has(h))this.map.delete(h);else if(this.map.size>=this.maxEntries){const u=this.map.keys().next().value;this.map.delete(u)}this.map.set(h,a)}clear(){this.map.clear()}},c.cY=Vr,c.cZ=v_,c.c_=e0,c.ca=class extends fl{},c.cb=nx,c.cc=class extends On{},c.cd=ng,c.ce=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.cf=nc,c.cg=function(h,a,u){var g=a[0],y=a[1],T=a[2],S=u[3]*g+u[7]*y+u[11]*T+u[15];return h[0]=(u[0]*g+u[4]*y+u[8]*T+u[12])/(S=S||1),h[1]=(u[1]*g+u[5]*y+u[9]*T+u[13])/S,h[2]=(u[2]*g+u[6]*y+u[10]*T+u[14])/S,h},c.ch=class extends Zc{},c.ci=class extends o{},c.cj=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.ck=function(h,a){var u=h[0],g=h[1],y=h[2],T=h[3],S=h[4],M=h[5],R=h[6],L=h[7],F=h[8],U=h[9],q=h[10],X=h[11],Q=h[12],te=h[13],ae=h[14],de=h[15],Te=a[0],he=a[1],ve=a[2],Oe=a[3],Fe=a[4],it=a[5],vt=a[6],xt=a[7],It=a[8],Vt=a[9],kt=a[10],wt=a[11],pt=a[12],Gt=a[13],Jt=a[14],ar=a[15];return Math.abs(u-Te)<=ce*Math.max(1,Math.abs(u),Math.abs(Te))&&Math.abs(g-he)<=ce*Math.max(1,Math.abs(g),Math.abs(he))&&Math.abs(y-ve)<=ce*Math.max(1,Math.abs(y),Math.abs(ve))&&Math.abs(T-Oe)<=ce*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(S-Fe)<=ce*Math.max(1,Math.abs(S),Math.abs(Fe))&&Math.abs(M-it)<=ce*Math.max(1,Math.abs(M),Math.abs(it))&&Math.abs(R-vt)<=ce*Math.max(1,Math.abs(R),Math.abs(vt))&&Math.abs(L-xt)<=ce*Math.max(1,Math.abs(L),Math.abs(xt))&&Math.abs(F-It)<=ce*Math.max(1,Math.abs(F),Math.abs(It))&&Math.abs(U-Vt)<=ce*Math.max(1,Math.abs(U),Math.abs(Vt))&&Math.abs(q-kt)<=ce*Math.max(1,Math.abs(q),Math.abs(kt))&&Math.abs(X-wt)<=ce*Math.max(1,Math.abs(X),Math.abs(wt))&&Math.abs(Q-pt)<=ce*Math.max(1,Math.abs(Q),Math.abs(pt))&&Math.abs(te-Gt)<=ce*Math.max(1,Math.abs(te),Math.abs(Gt))&&Math.abs(ae-Jt)<=ce*Math.max(1,Math.abs(ae),Math.abs(Jt))&&Math.abs(de-ar)<=ce*Math.max(1,Math.abs(de),Math.abs(ar))},c.cl=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.cm=h=>h.type==="symbol",c.cn=h=>h.type==="circle",c.co=h=>h.type==="heatmap",c.cp=h=>h.type==="line",c.cq=h=>h.type==="fill",c.cr=h=>h.type==="fill-extrusion",c.cs=h=>h.type==="hillshade",c.ct=h=>h.type==="color-relief",c.cu=h=>h.type==="background",c.cv=h=>h.type==="custom",c.cw=Tt,c.cx=function(h,a,u){if(a<=0)return h;const g=1/a;return u===void 0||Math.abs(u)<1e-10?Math.round(h*g)/g:(u>0?Math.ceil(h*g-1e-9):Math.floor(h*g+1e-10))/g},c.cy=function(h,a,u){const g=Ee(a.x-u.x,a.y-u.y),y=Ee(h.x-u.x,h.y-u.y);var T,S;return Xs(Math.atan2(g[0]*y[1]-g[1]*y[0],(T=g)[0]*(S=y)[0]+T[1]*S[1]))},c.cz=zt,c.d=tt,c.d0=function(h,a,u,g,y){return s(this,void 0,void 0,(function*(){if(Y())try{return yield Zo(h,a,u,g,y)}catch{}return(function(T,S,M,R,L){const F=T.width,U=T.height;yo&&Za||(yo=new OffscreenCanvas(F,U),Za=yo.getContext("2d",{willReadFrequently:!0})),yo.width=F,yo.height=U,Za.drawImage(T,0,0,F,U);const q=Za.getImageData(S,M,R,L);return Za.clearRect(0,0,F,U),q.data})(h,a,u,g,y)}))},c.d1=Hd,c.d2=b,c.d3=class{constructor(h,a){this.layers={[vh]:this},this.name=vh,this.version=a?a.version:1,this.extent=a?a.extent:4096,this.length=h.length,this.features=h}feature(h){return new S2(this.features[h],this.extent)}},c.d4=Yu,c.d5=Ra,c.e=nr,c.f=h=>s(void 0,void 0,void 0,(function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=J,c.h=h=>new Promise(((a,u)=>{const g=new Image;g.onload=()=>{a(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame((()=>{g.src=Rl}))},g.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(h)],{type:"image/png"});g.src=h.byteLength?URL.createObjectURL(y):Rl})),c.i=ur,c.j=(h,a)=>Ne(nr(h,{type:"json"}),a),c.k=Ct,c.l=et,c.m=Ne,c.n=(h,a)=>Ne(nr(h,{type:"arrayBuffer"}),a),c.o=function(h){return new v_(h).readFields(fx,[])},c.p=Pv,c.q=function(h){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))},c.r=rg,c.s=Du,c.t=ri,c.u=Le,c.v=mf,c.w=_r,c.x=jd,c.y=Ja,c.z=cl})),i("worker",["./shared"],(function(c){class s{constructor(J,ie){this.keyCache={},J&&this.replace(J,ie)}replace(J,ie){this._layerConfigs={},this._layers={},this.update(J,[],ie)}update(J,ie,oe){for(const Ne of J){this._layerConfigs[Ne.id]=Ne;const tt=this._layers[Ne.id]=c.bT(Ne,oe);tt._featureFilter=c.aj(tt.filter,oe),this.keyCache[Ne.id]&&delete this.keyCache[Ne.id]}for(const Ne of ie)delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne];this.familiesBySource={};const Pe=c.cM(Object.values(this._layerConfigs),this.keyCache);for(const Ne of Pe){const tt=Ne.map((Le=>this._layers[Le.id])),Je=tt[0];if(Je.isHidden())continue;const qe=Je.source||"";let et=this.familiesBySource[qe];et||(et=this.familiesBySource[qe]={});const Ct=Je.sourceLayer||c.ai;let mt=et[Ct];mt||(mt=et[Ct]=[]),mt.push(tt)}}}class m{constructor(J){const ie={},oe=[];for(const Je in J){const qe=J[Je],et=ie[Je]={};for(const Ct in qe){const mt=qe[+Ct];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const Le={x:0,y:0,w:mt.bitmap.width+2,h:mt.bitmap.height+2};oe.push(Le),et[Ct]={rect:Le,metrics:mt.metrics}}}const{w:Pe,h:Ne}=c.p(oe),tt=new c.r({width:Pe||1,height:Ne||1});for(const Je in J){const qe=J[Je];for(const et in qe){const Ct=qe[+et];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const mt=ie[Je][et].rect;c.r.copy(Ct.bitmap,tt,{x:0,y:0},{x:mt.x+1,y:mt.y+1},Ct.bitmap)}}this.image=tt,this.positions=ie}}c.cN("GlyphAtlas",m);class b{constructor(J){this.tileID=new c.a2(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,ie,oe,Pe,Ne){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new c.ag;const tt=new c.cO(Object.keys(J.layers).sort()),Je=new c.cP(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const qe={},et={featureIndex:Je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:oe,subdivisionGranularity:Ne},Ct=ie.familiesBySource[this.source];for(const Hr in Ct){const vn=J.layers[Hr];if(!vn)continue;vn.version===1&&c.w(`Vector tile source "${this.source}" layer "${Hr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ts=tt.encode(Hr),en=[];for(let Nt=0;Nt<vn.length;Nt++){const hr=vn.feature(Nt),Sr=Je.getId(hr,Hr);en.push({feature:hr,id:Sr,index:Nt,sourceLayerIndex:Ts})}for(const Nt of Ct[Hr]){const hr=Nt[0];hr.source!==this.source&&c.w(`layer.source = ${hr.source} does not equal this.source = ${this.source}`),hr.isHidden(this.zoom,!0)||(w(Nt,this.zoom,oe),(qe[hr.id]=hr.createBucket({index:Je.bucketLayerIDs.length,layers:Nt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ts,sourceID:this.source})).populate(en,et,this.tileID.canonical),Je.bucketLayerIDs.push(Nt.map((Sr=>Sr.id))))}}const mt=c.bY(et.glyphDependencies,(Hr=>Object.keys(Hr).map(Number)));this.inFlightDependencies.forEach((Hr=>Hr?.abort())),this.inFlightDependencies=[];let Le=Promise.resolve({});if(Object.keys(mt).length){const Hr=new AbortController;this.inFlightDependencies.push(Hr),Le=Pe.sendAsync({type:"GG",data:{stacks:mt,source:this.source,tileID:this.tileID,type:"glyphs"}},Hr)}const Qt=Object.keys(et.iconDependencies);let yr=Promise.resolve({});if(Qt.length){const Hr=new AbortController;this.inFlightDependencies.push(Hr),yr=Pe.sendAsync({type:"GI",data:{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"}},Hr)}const or=Object.keys(et.patternDependencies);let fr=Promise.resolve({});if(or.length){const Hr=new AbortController;this.inFlightDependencies.push(Hr),fr=Pe.sendAsync({type:"GI",data:{icons:or,source:this.source,tileID:this.tileID,type:"patterns"}},Hr)}const dr=et.dashDependencies;let vr=Promise.resolve({});if(Object.keys(dr).length){const Hr=new AbortController;this.inFlightDependencies.push(Hr),vr=Pe.sendAsync({type:"GDA",data:{dashes:dr}},Hr)}const[En,Wn,Nn,Vi]=yield Promise.all([Le,yr,fr,vr]),Pn=new m(En),Ot=new c.cQ(Wn,Nn);for(const Hr in qe){const vn=qe[Hr];vn instanceof c.ah?(w(vn.layers,this.zoom,oe),c.cR({bucket:vn,glyphMap:En,glyphPositions:Pn.positions,imageMap:Wn,imagePositions:Ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:et.subdivisionGranularity})):vn.hasDependencies&&(vn instanceof c.cS||vn instanceof c.cT||vn instanceof c.cU)&&(w(vn.layers,this.zoom,oe),vn.addFeatures(et,this.tileID.canonical,Ot.patternPositions,Vi))}return this.status="done",{buckets:Object.values(qe).filter((Hr=>!Hr.isEmpty())),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pn.image,imageAtlas:Ot,dashPositions:Vi,glyphMap:this.returnDependencies?En:null,iconMap:this.returnDependencies?Wn:null,glyphPositions:this.returnDependencies?Pn.positions:null}}))}}function w(He,J,ie){const oe=new c.H(J);for(const Pe of He)Pe.recalculate(oe,ie)}class E{constructor(){this.loading={},this.loaded={},this.parsing={}}startLoading(J,ie){this.loading[J]=ie}finishLoading(J){delete this.loading[J]}abort(J){const ie=this.loading[J];ie?.abort&&(ie.abort.abort(),delete this.loading[J])}setParsing(J,ie){this.parsing[J]=ie}consumeParsing(J){const ie=this.parsing[J];if(ie)return delete this.parsing[J],ie}clearParsing(J){delete this.parsing[J]}markLoaded(J,ie){this.loaded[J]=ie}getLoaded(J){const ie=this.loaded[J];if(ie)return ie}removeLoaded(J){delete this.loaded[J]}clearLoaded(){this.loaded={}}}class O{constructor(J,ie,oe,Pe,Ne){this.type=J,this.properties=oe||{},this.extent=Ne,this.pointsArray=ie,this.id=Pe}loadGeometry(){return this.pointsArray.map((J=>J.map((ie=>new c.P(ie.x,ie.y)))))}}class N{constructor(J,ie,oe){this.version=2,this._myFeatures=J,this.name=ie,this.length=J.length,this.extent=oe}feature(J){return this._myFeatures[J]}}class V{constructor(){this.layers={}}addLayer(J){this.layers[J.name]=J}}function W(He){let J=c.cV(He);return J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),{vectorTile:He,rawData:J.buffer}}function j(He,J,ie){const{extent:oe}=He,Pe=Math.pow(2,ie.z-J.z),Ne=(ie.x-J.x*Pe)*oe,tt=(ie.y-J.y*Pe)*oe,Je=[];for(let qe=0;qe<He.length;qe++){const et=He.feature(qe);let Ct=et.loadGeometry();for(const Le of Ct)for(const Qt of Le)Qt.x=Qt.x*Pe-Ne,Qt.y=Qt.y*Pe-tt;const mt=128;Ct=c.cW(Ct,et.type,-mt,-mt,oe+mt,oe+mt),Ct.length!==0&&Je.push(new O(et.type,Ct,et.properties,et.id,oe))}return new N(Je,He.name,oe)}class Y{constructor(J,ie,oe){this.actor=J,this.layerIndex=ie,this.availableImages=oe,this.tileState=new E,this.overzoomedTileResultCache=new c.cX(1e3)}loadVectorTile(J,ie){return c._(this,void 0,void 0,(function*(){const oe=yield c.n(J.request,ie);try{return{vectorTile:J.encoding!=="mlt"?new c.cY(new c.cZ(oe.data)):new c.c_(oe.data),rawData:oe.data,cacheControl:oe.cacheControl,expires:oe.expires}}catch(Pe){const Ne=new Uint8Array(oe.data);let tt=`Unable to parse the tile at ${J.request.url}, `;throw tt+=Ne[0]===31&&Ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.message}`,new Error(tt)}}))}loadTile(J){return c._(this,void 0,void 0,(function*(){const{uid:ie,overzoomParameters:oe}=J;oe&&(J.request=oe.overzoomRequest);const Pe=this._startRequestTiming(J),Ne=new b(J);this.tileState.startLoading(ie,Ne);const tt=new AbortController;Ne.abort=tt;try{const Je=yield this.loadVectorTile(J,tt);if(this.tileState.finishLoading(ie),!Je)return null;let{vectorTile:qe,rawData:et}=Je;oe&&({vectorTile:qe,rawData:et}=this._getOverzoomTile(J,Je.vectorTile));const Ct=this._getExpiryData(Je),mt=this._finishRequestTiming(Pe);Ne.vectorTile=qe,this.tileState.markLoaded(ie,Ne);const Le={rawData:et,cacheControl:Ct,resourceTiming:mt};this.tileState.setParsing(ie,Le);try{return yield this._parseWorkerTile(Ne,J,Le)}finally{this.tileState.clearParsing(ie)}}catch(Je){throw this.tileState.finishLoading(ie),Ne.status="done",this.tileState.markLoaded(ie,Ne),Je}}))}_parseWorkerTile(J,ie,oe){return c._(this,void 0,void 0,(function*(){let Pe=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);if(oe){const{rawData:Ne,cacheControl:tt,resourceTiming:Je}=oe;Pe=c.e({rawTileData:Ne.slice(0),encoding:ie.encoding},Pe,tt,Je)}return Pe}))}_getExpiryData(J){const{expires:ie,cacheControl:oe}=J,Pe={};return ie&&(Pe.expires=ie),oe&&(Pe.cacheControl=oe),Pe}_startRequestTiming(J){var ie;if(!((ie=J.request)===null||ie===void 0)&&ie.collectResourceTiming)return new c.c$(J.request.url)}_finishRequestTiming(J){const ie=J?.finish();return ie?{resourceTiming:JSON.parse(JSON.stringify(ie))}:{}}_getOverzoomTile(J,ie){const{tileID:oe,source:Pe,overzoomParameters:Ne}=J,{maxZoomTileID:tt}=Ne,Je=`${tt.key}_${oe.key}`,qe=this.overzoomedTileResultCache.get(Je);if(qe)return qe;const et=new V,Ct=this.layerIndex.familiesBySource[Pe];for(const Le in Ct){const Qt=ie.layers[Le];if(!Qt)continue;const yr=j(Qt,tt,oe.canonical);yr.length>0&&et.addLayer(yr)}const mt=W(et);return this.overzoomedTileResultCache.set(Je,mt),mt}reloadTile(J){return c._(this,void 0,void 0,(function*(){const ie=J.uid,oe=this.tileState.getLoaded(ie);if(!oe)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(oe.showCollisionBoxes=J.showCollisionBoxes,oe.status==="parsing"){const Pe=this.tileState.consumeParsing(ie);return yield this._parseWorkerTile(oe,J,Pe)}if(oe.status==="done"&&oe.vectorTile)return yield this._parseWorkerTile(oe,J)}))}abortTile(J){return c._(this,void 0,void 0,(function*(){this.tileState.abort(J.uid)}))}removeTile(J){return c._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(J.uid)}))}}class ce{constructor(){this.loaded={}}loadTile(J){return c._(this,void 0,void 0,(function*(){const{uid:ie,encoding:oe,rawImageData:Pe,redFactor:Ne,greenFactor:tt,blueFactor:Je,baseShift:qe}=J,et=Pe.width+2,Ct=Pe.height+2,mt=c.b(Pe)?new c.R({width:et,height:Ct},yield c.d0(Pe,-1,-1,et,Ct)):Pe,Le=new c.d1(ie,mt,oe,Ne,tt,Je,qe);return this.loaded=this.loaded||{},this.loaded[ie]=Le,Le}))}removeTile(J){const ie=this.loaded,oe=J.uid;ie&&ie[oe]&&delete ie[oe]}}var re,ue,me=(function(){if(ue)return re;function He(ie,oe){if(ie.length!==0){J(ie[0],oe);for(var Pe=1;Pe<ie.length;Pe++)J(ie[Pe],!oe)}}function J(ie,oe){for(var Pe=0,Ne=0,tt=0,Je=ie.length,qe=Je-1;tt<Je;qe=tt++){var et=(ie[tt][0]-ie[qe][0])*(ie[qe][1]+ie[tt][1]),Ct=Pe+et;Ne+=Math.abs(Pe)>=Math.abs(et)?Pe-Ct+et:et-Ct+Pe,Pe=Ct}Pe+Ne>=0!=!!oe&&ie.reverse()}return ue=1,re=function ie(oe,Pe){var Ne,tt=oe&&oe.type;if(tt==="FeatureCollection")for(Ne=0;Ne<oe.features.length;Ne++)ie(oe.features[Ne],Pe);else if(tt==="GeometryCollection")for(Ne=0;Ne<oe.geometries.length;Ne++)ie(oe.geometries[Ne],Pe);else if(tt==="Feature")ie(oe.geometry,Pe);else if(tt==="Polygon")He(oe.coordinates,Pe);else if(tt==="MultiPolygon")for(Ne=0;Ne<oe.coordinates.length;Ne++)He(oe.coordinates[Ne],Pe);return oe}})(),ge=c.d2(me);const Ce={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},We=Math.fround||(Xe=new Float32Array(1),He=>(Xe[0]=+He,Xe[0]));var Xe;class Et{constructor(J){this.options=Object.assign(Object.create(Ce),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:ie,minZoom:oe,maxZoom:Pe}=this.options;ie&&console.time("total time");const Ne=`prepare ${J.length} points`;ie&&console.time(Ne),this.points=J;const tt=[];for(let qe=0;qe<J.length;qe++){const et=J[qe];if(!et.geometry)continue;const[Ct,mt]=et.geometry.coordinates,Le=We(jt(Ct)),Qt=We(St(mt));tt.push(Le,Qt,1/0,qe,-1,1),this.options.reduce&&tt.push(0)}let Je=this.trees[Pe+1]=this._createTree(tt);ie&&console.timeEnd(Ne);for(let qe=Pe;qe>=oe;qe--){const et=+Date.now();Je=this.trees[qe]=this._createTree(this._cluster(Je,qe)),ie&&console.log("z%d: %d clusters in %dms",qe,Je.numItems,+Date.now()-et)}return ie&&console.timeEnd("total time"),this}getClusters(J,ie){let oe=((J[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,J[1]));let Ne=J[2]===180?180:((J[2]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)oe=-180,Ne=180;else if(oe>Ne){const mt=this.getClusters([oe,Pe,180,tt],ie),Le=this.getClusters([-180,Pe,Ne,tt],ie);return mt.concat(Le)}const Je=this.trees[this._limitZoom(ie)],qe=Je.range(jt(oe),St(tt),jt(Ne),St(Pe)),et=Je.data,Ct=[];for(const mt of qe){const Le=this.stride*mt;Ct.push(et[Le+5]>1?gt(et,Le,this.clusterProps):this.points[et[Le+3]])}return Ct}getChildren(J){const ie=this._getOriginId(J),oe=this._getOriginZoom(J),Pe="No cluster with the specified id.",Ne=this.trees[oe];if(!Ne)throw new Error(Pe);const tt=Ne.data;if(ie*this.stride>=tt.length)throw new Error(Pe);const Je=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),qe=Ne.within(tt[ie*this.stride],tt[ie*this.stride+1],Je),et=[];for(const Ct of qe){const mt=Ct*this.stride;tt[mt+4]===J&&et.push(tt[mt+5]>1?gt(tt,mt,this.clusterProps):this.points[tt[mt+3]])}if(et.length===0)throw new Error(Pe);return et}getLeaves(J,ie,oe){const Pe=[];return this._appendLeaves(Pe,J,ie=ie||10,oe=oe||0,0),Pe}getTile(J,ie,oe){const Pe=this.trees[this._limitZoom(J)],Ne=Math.pow(2,J),{extent:tt,radius:Je}=this.options,qe=Je/tt,et=(oe-qe)/Ne,Ct=(oe+1+qe)/Ne,mt={features:[]};return this._addTileFeatures(Pe.range((ie-qe)/Ne,et,(ie+1+qe)/Ne,Ct),Pe.data,ie,oe,Ne,mt),ie===0&&this._addTileFeatures(Pe.range(1-qe/Ne,et,1,Ct),Pe.data,Ne,oe,Ne,mt),ie===Ne-1&&this._addTileFeatures(Pe.range(0,et,qe/Ne,Ct),Pe.data,-1,oe,Ne,mt),mt.features.length?mt:null}getClusterExpansionZoom(J){let ie=this._getOriginZoom(J)-1;for(;ie<=this.options.maxZoom;){const oe=this.getChildren(J);if(ie++,oe.length!==1)break;J=oe[0].properties.cluster_id}return ie}_appendLeaves(J,ie,oe,Pe,Ne){const tt=this.getChildren(ie);for(const Je of tt){const qe=Je.properties;if(qe&&qe.cluster?Ne+qe.point_count<=Pe?Ne+=qe.point_count:Ne=this._appendLeaves(J,qe.cluster_id,oe,Pe,Ne):Ne<Pe?Ne++:J.push(Je),J.length===oe)break}return Ne}_createTree(J){const ie=new c.aT(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<J.length;oe+=this.stride)ie.add(J[oe],J[oe+1]);return ie.finish(),ie.data=J,ie}_addTileFeatures(J,ie,oe,Pe,Ne,tt){for(const Je of J){const qe=Je*this.stride,et=ie[qe+5]>1;let Ct,mt,Le;if(et)Ct=Ye(ie,qe,this.clusterProps),mt=ie[qe],Le=ie[qe+1];else{const or=this.points[ie[qe+3]];Ct=or.properties;const[fr,dr]=or.geometry.coordinates;mt=jt(fr),Le=St(dr)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(mt*Ne-oe)),Math.round(this.options.extent*(Le*Ne-Pe))]],tags:Ct};let yr;yr=et||this.options.generateId?ie[qe+3]:this.points[ie[qe+3]].id,yr!==void 0&&(Qt.id=yr),tt.features.push(Qt)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,ie){const{radius:oe,extent:Pe,reduce:Ne,minPoints:tt}=this.options,Je=oe/(Pe*Math.pow(2,ie)),qe=J.data,et=[],Ct=this.stride;for(let mt=0;mt<qe.length;mt+=Ct){if(qe[mt+2]<=ie)continue;qe[mt+2]=ie;const Le=qe[mt],Qt=qe[mt+1],yr=J.within(qe[mt],qe[mt+1],Je),or=qe[mt+5];let fr=or;for(const dr of yr){const vr=dr*Ct;qe[vr+2]>ie&&(fr+=qe[vr+5])}if(fr>or&&fr>=tt){let dr,vr=Le*or,En=Qt*or,Wn=-1;const Nn=(mt/Ct<<5)+(ie+1)+this.points.length;for(const Vi of yr){const Pn=Vi*Ct;if(qe[Pn+2]<=ie)continue;qe[Pn+2]=ie;const Ot=qe[Pn+5];vr+=qe[Pn]*Ot,En+=qe[Pn+1]*Ot,qe[Pn+4]=Nn,Ne&&(dr||(dr=this._map(qe,mt,!0),Wn=this.clusterProps.length,this.clusterProps.push(dr)),Ne(dr,this._map(qe,Pn)))}qe[mt+4]=Nn,et.push(vr/fr,En/fr,1/0,Nn,-1,fr),Ne&&et.push(Wn)}else{for(let dr=0;dr<Ct;dr++)et.push(qe[mt+dr]);if(fr>1)for(const dr of yr){const vr=dr*Ct;if(!(qe[vr+2]<=ie)){qe[vr+2]=ie;for(let En=0;En<Ct;En++)et.push(qe[vr+En])}}}}return et}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ie,oe){if(J[ie+5]>1){const tt=this.clusterProps[J[ie+6]];return oe?Object.assign({},tt):tt}const Pe=this.points[J[ie+3]].properties,Ne=this.options.map(Pe);return oe&&Ne===Pe?Object.assign({},Ne):Ne}}function gt(He,J,ie){return{type:"Feature",id:He[J+3],properties:Ye(He,J,ie),geometry:{type:"Point",coordinates:[(oe=He[J],360*(oe-.5)),Zt(He[J+1])]}};var oe}function Ye(He,J,ie){const oe=He[J+5],Pe=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,Ne=He[J+6],tt=Ne===-1?{}:Object.assign({},ie[Ne]);return Object.assign(tt,{cluster:!0,cluster_id:He[J+3],point_count:oe,point_count_abbreviated:Pe})}function jt(He){return He/360+.5}function St(He){const J=Math.sin(He*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function Zt(He){const J=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function fe(He,J,ie,oe){let Pe=oe;const Ne=J+(ie-J>>1);let tt,Je=ie-J;const qe=He[J],et=He[J+1],Ct=He[ie],mt=He[ie+1];for(let Le=J+3;Le<ie;Le+=3){const Qt=Me(He[Le],He[Le+1],qe,et,Ct,mt);if(Qt>Pe)tt=Le,Pe=Qt;else if(Qt===Pe){const yr=Math.abs(Le-Ne);yr<Je&&(tt=Le,Je=yr)}}Pe>oe&&(tt-J>3&&fe(He,J,tt,oe),He[tt+2]=Pe,ie-tt>3&&fe(He,tt,ie,oe))}function Me(He,J,ie,oe,Pe,Ne){let tt=Pe-ie,Je=Ne-oe;if(tt!==0||Je!==0){const qe=((He-ie)*tt+(J-oe)*Je)/(tt*tt+Je*Je);qe>1?(ie=Pe,oe=Ne):qe>0&&(ie+=tt*qe,oe+=Je*qe)}return tt=He-ie,Je=J-oe,tt*tt+Je*Je}function Ee(He,J,ie,oe){const Pe={type:J,geom:ie},Ne={id:He??null,type:Pe.type,geometry:Pe.geom,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(Pe.type){case"Point":case"MultiPoint":case"LineString":Ue(Ne,Pe.geom);break;case"Polygon":Ue(Ne,Pe.geom[0]);break;case"MultiLineString":for(const tt of Pe.geom)Ue(Ne,tt);break;case"MultiPolygon":for(const tt of Pe.geom)Ue(Ne,tt[0])}return Ne}function Ue(He,J){for(let ie=0;ie<J.length;ie+=3)He.minX=Math.min(He.minX,J[ie]),He.minY=Math.min(He.minY,J[ie+1]),He.maxX=Math.max(He.maxX,J[ie]),He.maxY=Math.max(He.maxY,J[ie+1])}function st(He,J){const ie=[];switch(He.type){case"FeatureCollection":for(let oe=0;oe<He.features.length;oe++)ye(ie,He.features[oe],J,oe);break;case"Feature":ye(ie,He,J);break;default:ye(ie,{geometry:He,properties:void 0},J)}return ie}function ye(He,J,ie,oe){if(!J.geometry)return;if(J.geometry.type==="GeometryCollection"){for(const Je of J.geometry.geometries)ye(He,{id:J.id,geometry:Je,properties:J.properties},ie,oe);return}if(!J.geometry.coordinates?.length)return;const Ne=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let tt=J.id;switch(ie.promoteId?tt=J.properties?.[ie.promoteId]:ie.generateId&&(tt=oe||0),J.geometry.type){case"Point":{const Je=[];return Be(J.geometry.coordinates,Je),void He.push(Ee(tt,J.geometry.type,Je,J.properties))}case"MultiPoint":{const Je=[];for(const qe of J.geometry.coordinates)Be(qe,Je);return void He.push(Ee(tt,J.geometry.type,Je,J.properties))}case"LineString":{const Je=[];return lt(J.geometry.coordinates,Je,Ne,!1),void He.push(Ee(tt,J.geometry.type,Je,J.properties))}case"MultiLineString":{if(ie.lineMetrics){for(const qe of J.geometry.coordinates){const et=[];lt(qe,et,Ne,!1),He.push(Ee(tt,"LineString",et,J.properties))}return}const Je=[];return Tt(J.geometry.coordinates,Je,Ne,!1),void He.push(Ee(tt,J.geometry.type,Je,J.properties))}case"Polygon":{const Je=[];return Tt(J.geometry.coordinates,Je,Ne,!0),void He.push(Ee(tt,J.geometry.type,Je,J.properties))}case"MultiPolygon":{const Je=[];for(const qe of J.geometry.coordinates){const et=[];Tt(qe,et,Ne,!0),Je.push(et)}return void He.push(Ee(tt,J.geometry.type,Je,J.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Be(He,J){J.push(zt(He[0]),Xt(He[1]),0)}function lt(He,J,ie,oe){let Pe,Ne,tt=0;for(let qe=0;qe<He.length;qe++){const et=zt(He[qe][0]),Ct=Xt(He[qe][1]);J.push(et,Ct,0),qe>0&&(tt+=oe?(Pe*Ct-et*Ne)/2:Math.sqrt(Math.pow(et-Pe,2)+Math.pow(Ct-Ne,2))),Pe=et,Ne=Ct}const Je=J.length-3;J[2]=1,ie>0&&fe(J,0,Je,ie),J[Je+2]=1,J.size=Math.abs(tt),J.start=0,J.end=J.size}function Tt(He,J,ie,oe){for(let Pe=0;Pe<He.length;Pe++){const Ne=[];lt(He[Pe],Ne,ie,oe),J.push(Ne)}}function zt(He){return He/360+.5}function Xt(He){const J=Math.sin(He*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function Wt(He,J,ie,oe,Pe,Ne,tt,Je){if(oe/=J,Ne>=(ie/=J)&&tt<oe)return He;if(tt<ie||Ne>=oe)return null;const qe=[];for(const et of He){const Ct=Pe===0?et.minX:et.minY,mt=Pe===0?et.maxX:et.maxY;if(Ct>=ie&&mt<oe)qe.push(et);else if(!(mt<ie||Ct>=oe))switch(et.type){case"Point":case"MultiPoint":{const Le=[];if(nr(et.geometry,Le,ie,oe,Pe),!Le.length)continue;qe.push(Ee(et.id,Le.length===3?"Point":"MultiPoint",Le,et.tags));continue}case"LineString":{const Le=[];if(_t(et.geometry,Le,ie,oe,Pe,!1,Je.lineMetrics),!Le.length)continue;if(Je.lineMetrics){for(const Qt of Le)qe.push(Ee(et.id,et.type,Qt,et.tags));continue}if(Le.length>1){qe.push(Ee(et.id,"MultiLineString",Le,et.tags));continue}qe.push(Ee(et.id,et.type,Le[0],et.tags));continue}case"MultiLineString":{const Le=[];if(Tr(et.geometry,Le,ie,oe,Pe,!1),!Le.length)continue;if(Le.length===1){qe.push(Ee(et.id,"LineString",Le[0],et.tags));continue}qe.push(Ee(et.id,et.type,Le,et.tags));continue}case"Polygon":{const Le=[];if(Tr(et.geometry,Le,ie,oe,Pe,!0),!Le.length)continue;qe.push(Ee(et.id,et.type,Le,et.tags));continue}case"MultiPolygon":{const Le=[];for(const Qt of et.geometry){const yr=[];Tr(Qt,yr,ie,oe,Pe,!0),yr.length&&Le.push(yr)}if(!Le.length)continue;qe.push(Ee(et.id,et.type,Le,et.tags));continue}}}return qe.length?qe:null}function nr(He,J,ie,oe,Pe){for(let Ne=0;Ne<He.length;Ne+=3){const tt=He[Ne+Pe];tt>=ie&&tt<=oe&&Rt(J,He[Ne],He[Ne+1],He[Ne+2])}}function _t(He,J,ie,oe,Pe,Ne,tt){let Je=Yt(He);const qe=Pe===0?$n:_r;let et,Ct,mt=He.start;for(let fr=0;fr<He.length-3;fr+=3){const dr=He[fr],vr=He[fr+1],En=He[fr+2],Wn=He[fr+3],Nn=He[fr+4],Vi=Pe===0?dr:vr,Pn=Pe===0?Wn:Nn;let Ot=!1;tt&&(et=Math.sqrt(Math.pow(dr-Wn,2)+Math.pow(vr-Nn,2))),Vi<ie?Pn>ie&&(Ct=qe(Je,dr,vr,Wn,Nn,ie),tt&&(Je.start=mt+et*Ct)):Vi>oe?Pn<oe&&(Ct=qe(Je,dr,vr,Wn,Nn,oe),tt&&(Je.start=mt+et*Ct)):Rt(Je,dr,vr,En),Pn<ie&&Vi>=ie&&(Ct=qe(Je,dr,vr,Wn,Nn,ie),Ot=!0),Pn>oe&&Vi<=oe&&(Ct=qe(Je,dr,vr,Wn,Nn,oe),Ot=!0),!Ne&&Ot&&(tt&&(Je.end=mt+et*Ct),J.push(Je),Je=Yt(He)),tt&&(mt+=et)}let Le=He.length-3;const Qt=He[Le],yr=He[Le+1],or=Pe===0?Qt:yr;or>=ie&&or<=oe&&Rt(Je,Qt,yr,He[Le+2]),Le=Je.length-3,Ne&&Le>=3&&(Je[Le]!==Je[0]||Je[Le+1]!==Je[1])&&Rt(Je,Je[0],Je[1],Je[2]),Je.length&&J.push(Je)}function Yt(He){const J=[];return J.size=He.size,J.start=He.start,J.end=He.end,J}function Tr(He,J,ie,oe,Pe,Ne){for(const tt of He)_t(tt,J,ie,oe,Pe,Ne,!1)}function Rt(He,J,ie,oe){He.push(J,ie,oe)}function $n(He,J,ie,oe,Pe,Ne){const tt=(Ne-J)/(oe-J);return Rt(He,Ne,ie+(Pe-ie)*tt,1),tt}function _r(He,J,ie,oe,Pe,Ne){const tt=(Ne-ie)/(Pe-ie);return Rt(He,J+(oe-J)*tt,Ne,1),tt}function sr(He,J){const ie=J.buffer/J.extent;let oe=He;const Pe=Wt(He,1,-1-ie,ie,0,-1,2,J),Ne=Wt(He,1,1-ie,2+ie,0,-1,2,J);return(Pe||Ne)&&(oe=Wt(He,1,-ie,1+ie,0,-1,2,J)||[],Pe&&(oe=ur(Pe,1).concat(oe)),Ne&&(oe=oe.concat(ur(Ne,-1)))),oe}function ur(He,J){const ie=[];for(const oe of He)switch(oe.type){case"Point":case"MultiPoint":case"LineString":{const Pe=Yr(oe.geometry,J);ie.push(Ee(oe.id,oe.type,Pe,oe.tags));continue}case"MultiLineString":case"Polygon":{const Pe=[];for(const Ne of oe.geometry)Pe.push(Yr(Ne,J));ie.push(Ee(oe.id,oe.type,Pe,oe.tags));continue}case"MultiPolygon":{const Pe=[];for(const Ne of oe.geometry){const tt=[];for(const Je of Ne)tt.push(Yr(Je,J));Pe.push(tt)}ie.push(Ee(oe.id,oe.type,Pe,oe.tags));continue}}return ie}function Yr(He,J){const ie=[];ie.size=He.size,He.start!==void 0&&(ie.start=He.start,ie.end=He.end);for(let oe=0;oe<He.length;oe+=3)ie.push(He[oe]+J,He[oe+1],He[oe+2]);return ie}function qs(He,J){if(He.transformed)return He;const ie=1<<He.z,oe=He.x,Pe=He.y;for(const Ne of He.features){if(Ne.type===1){const Je=[];for(let qe=0;qe<Ne.geometry.length;qe+=2)Je.push(Rl(Ne.geometry[qe],Ne.geometry[qe+1],J,ie,oe,Pe));Ne.geometry=Je;continue}const tt=[];for(const Je of Ne.geometry){const qe=[];for(let et=0;et<Je.length;et+=2)qe.push(Rl(Je[et],Je[et+1],J,ie,oe,Pe));tt.push(qe)}Ne.geometry=tt}return He.transformed=!0,He}function Rl(He,J,ie,oe,Pe,Ne){return[Math.round(ie*(He*oe-Pe)),Math.round(ie*(J*oe-Ne))]}function Zo(He,J,ie,oe,Pe){const Ne=J===Pe.maxZoom?0:Pe.tolerance/((1<<J)*Pe.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:ie,y:oe,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of He)yo(tt,Je,Ne,Pe);return tt}function yo(He,J,ie,oe){He.minX=Math.min(He.minX,J.minX),He.minY=Math.min(He.minY,J.minY),He.maxX=Math.max(He.maxX,J.maxX),He.maxY=Math.max(He.maxY,J.maxY);let Pe,Ne=J.tags||null;switch(J.type){case"Point":case"MultiPoint":{const tt=[];for(let Je=0;Je<J.geometry.length;Je+=3)tt.push(J.geometry[Je],J.geometry[Je+1]),He.numPoints++,He.numSimplified++;if(!tt.length)return;Pe={type:1,tags:Ne,geometry:tt};break}case"LineString":{const tt=[];if(Za(tt,J.geometry,He,ie,!1,!1),!tt.length)return;if(oe.lineMetrics){Ne={};for(const Je in J.tags)Ne[Je]=J.tags[Je];Ne.mapbox_clip_start=J.geometry.start/J.geometry.size,Ne.mapbox_clip_end=J.geometry.end/J.geometry.size}Pe={type:2,tags:Ne,geometry:tt};break}case"MultiLineString":case"Polygon":{const tt=[];for(let Je=0;Je<J.geometry.length;Je++)Za(tt,J.geometry[Je],He,ie,J.type==="Polygon",Je===0);if(!tt.length)return;Pe={type:J.type==="Polygon"?3:2,tags:Ne,geometry:tt};break}case"MultiPolygon":{const tt=[];for(let Je=0;Je<J.geometry.length;Je++){const qe=J.geometry[Je];for(let et=0;et<qe.length;et++)Za(tt,qe[et],He,ie,!0,et===0)}if(!tt.length)return;Pe={type:3,tags:Ne,geometry:tt};break}}J.id!==null&&(Pe.id=J.id),He.features.push(Pe)}function Za(He,J,ie,oe,Pe,Ne){const tt=oe*oe;if(oe>0&&J.size<(Pe?tt:oe))return void(ie.numPoints+=J.length/3);const Je=[];for(let qe=0;qe<J.length;qe+=3)(oe===0||J[qe+2]>tt)&&(ie.numSimplified++,Je.push(J[qe],J[qe+1])),ie.numPoints++;Pe&&(function(qe,et){let Ct=0;for(let mt=0,Le=qe.length,Qt=Le-2;mt<Le;Qt=mt,mt+=2)Ct+=(qe[mt]-qe[Qt])*(qe[mt+1]+qe[Qt+1]);if(Ct>0===et)for(let mt=0,Le=qe.length;mt<Le/2;mt+=2){const Qt=qe[mt],yr=qe[mt+1];qe[mt]=qe[Le-2-mt],qe[mt+1]=qe[Le-1-mt],qe[Le-2-mt]=Qt,qe[Le-1-mt]=yr}})(Je,Ne),He.push(Je)}function Du(He,J,ie){const oe=!!J.newGeometry,Pe=J.removeAllProperties||J.removeProperties?.length>0||J.addOrUpdateProperties?.length>0;if(oe){let Ne=st({type:"FeatureCollection",features:[{type:"Feature",id:He.id,geometry:J.newGeometry,properties:Pe?vi(He.tags,J):He.tags}]},ie);return Ne=sr(Ne,ie),Ne[0]}if(Pe){const Ne={...He};return Ne.tags=vi(Ne.tags,J),Ne}return null}function vi(He,J){if(J.removeAllProperties)return{};const ie={...He||{}};if(J.removeProperties)for(const oe of J.removeProperties)delete ie[oe];if(J.addOrUpdateProperties)for(const{key:oe,value:Pe}of J.addOrUpdateProperties)ie[oe]=Pe;return ie}const Xs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class ku{options;tiles;tileCoords;stats={};total=0;source;constructor(J,ie){const oe=(ie=this.options=Object.assign({},Xs,ie)).debug;if(oe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=st(J,ie);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=sr(Pe,ie),Pe.length&&this.splitTile(Pe,0,0,0),ie.updateable&&(this.source=Pe),oe&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,ie,oe,Pe,Ne,tt,Je){const qe=[J,ie,oe,Pe],et=this.options,Ct=et.debug;for(;qe.length;){Pe=qe.pop(),oe=qe.pop(),ie=qe.pop(),J=qe.pop();const mt=1<<ie,Le=Yo(ie,oe,Pe);let Qt=this.tiles[Le];if(!Qt&&(Ct>1&&console.time("creation"),Qt=this.tiles[Le]=Zo(J,ie,oe,Pe,et),this.tileCoords.push({z:ie,x:oe,y:Pe,id:Le}),Ct)){Ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,oe,Pe,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Ot=`z${ie}`;this.stats[Ot]=(this.stats[Ot]||0)+1,this.total++}if(Qt.source=J,Ne==null){if(ie===et.indexMaxZoom||Qt.numPoints<=et.indexMaxPoints)continue}else{if(ie===et.maxZoom||ie===Ne)continue;if(Ne!=null){const Ot=Ne-ie;if(oe!==tt>>Ot||Pe!==Je>>Ot)continue}}if(Qt.source=null,!J.length)continue;Ct>1&&console.time("clipping");const yr=.5*et.buffer/et.extent,or=.5-yr,fr=.5+yr,dr=1+yr;let vr=null,En=null,Wn=null,Nn=null;const Vi=Wt(J,mt,oe-yr,oe+fr,0,Qt.minX,Qt.maxX,et),Pn=Wt(J,mt,oe+or,oe+dr,0,Qt.minX,Qt.maxX,et);Vi&&(vr=Wt(Vi,mt,Pe-yr,Pe+fr,1,Qt.minY,Qt.maxY,et),En=Wt(Vi,mt,Pe+or,Pe+dr,1,Qt.minY,Qt.maxY,et)),Pn&&(Wn=Wt(Pn,mt,Pe-yr,Pe+fr,1,Qt.minY,Qt.maxY,et),Nn=Wt(Pn,mt,Pe+or,Pe+dr,1,Qt.minY,Qt.maxY,et)),Ct>1&&console.timeEnd("clipping"),qe.push(vr||[],ie+1,2*oe,2*Pe),qe.push(En||[],ie+1,2*oe,2*Pe+1),qe.push(Wn||[],ie+1,2*oe+1,2*Pe),qe.push(Nn||[],ie+1,2*oe+1,2*Pe+1)}}getTile(J,ie,oe){J=+J,ie=+ie,oe=+oe;const Pe=this.options,{extent:Ne,debug:tt}=Pe;if(J<0||J>24)return null;const Je=1<<J,qe=Yo(J,ie=ie+Je&Je-1,oe);if(this.tiles[qe])return qs(this.tiles[qe],Ne);tt>1&&console.log("drilling down to z%d-%d-%d",J,ie,oe);let et,Ct=J,mt=ie,Le=oe;for(;!et&&Ct>0;)Ct--,mt>>=1,Le>>=1,et=this.tiles[Yo(Ct,mt,Le)];return et?.source?(tt>1&&(console.log("found parent tile z%d-%d-%d",Ct,mt,Le),console.time("drilling down")),this.splitTile(et.source,Ct,mt,Le,J,ie,oe),tt>1&&console.timeEnd("drilling down"),this.tiles[qe]?qs(this.tiles[qe],Ne):null):null}invalidateTiles(J){const ie=this.options,{debug:oe}=ie;let Pe=1/0,Ne=-1/0,tt=1/0,Je=-1/0;for(const Ct of J)Pe=Math.min(Pe,Ct.minX),Ne=Math.max(Ne,Ct.maxX),tt=Math.min(tt,Ct.minY),Je=Math.max(Je,Ct.maxY);const qe=ie.buffer/ie.extent,et=new Set;for(const Ct in this.tiles){const mt=this.tiles[Ct],Le=1<<mt.z,Qt=(mt.x-qe)/Le,yr=(mt.x+1+qe)/Le,or=(mt.y-qe)/Le,fr=(mt.y+1+qe)/Le;if(Ne<Qt||Pe>=yr||Je<or||tt>=fr)continue;let dr=!1;for(const vr of J)if(vr.maxX>=Qt&&vr.minX<yr&&vr.maxY>=or&&vr.minY<fr){dr=!0;break}if(dr){if(oe){oe>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",mt.z,mt.x,mt.y,mt.numFeatures,mt.numPoints,mt.numSimplified);const vr=`z${mt.z}`;this.stats[vr]=(this.stats[vr]||0)-1,this.total--}delete this.tiles[Ct],et.add(Ct)}}et.size&&(this.tileCoords=this.tileCoords.filter((Ct=>!et.has(Ct.id))))}updateData(J){const ie=this.options,oe=ie.debug;if(!ie.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:Pe,source:Ne}=(function(mt,Le,Qt){const yr=(function(fr){return fr?{removeAll:fr.removeAll,remove:new Set(fr.remove||[]),add:new Map(fr.add?.map((dr=>[dr.id,dr]))),update:new Map(fr.update?.map((dr=>[dr.id,dr])))}:{remove:new Set,add:new Map,update:new Map}})(Le);let or=[];if(yr.removeAll&&(or=mt,mt=[]),yr.remove.size||yr.add.size){const fr=[];for(const dr of mt){const{id:vr}=dr;(yr.remove.has(vr)||yr.add.has(vr))&&fr.push(dr)}if(fr.length){or.push(...fr);const dr=new Set(fr.map((vr=>vr.id)));mt=mt.filter((vr=>!dr.has(vr.id)))}if(yr.add.size){let dr=st({type:"FeatureCollection",features:Array.from(yr.add.values())},Qt);dr=sr(dr,Qt),or.push(...dr),mt.push(...dr)}}if(yr.update.size)for(const[fr,dr]of yr.update){const vr=mt.findIndex((Nn=>Nn.id===fr));if(vr===-1)continue;const En=mt[vr],Wn=Du(En,dr,Qt);Wn&&(or.push(En,Wn),mt[vr]=Wn)}return{affected:or,source:mt}})(this.source,J,ie);if(!Pe.length)return;this.source=Ne,oe>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(Pe),oe>1&&console.timeEnd("invalidating");const[tt,Je,qe]=[0,0,0],et=Zo(this.source,tt,Je,qe,this.options);et.source=this.source;const Ct=Yo(tt,Je,qe);if(this.tiles[Ct]=et,this.tileCoords.push({z:tt,x:Je,y:qe,id:Ct}),oe){const mt=`z${tt}`;this.stats[mt]=(this.stats[mt]||0)+1,this.total++}}}function Yo(He,J,ie){return 32*((1<<He)*ie+J)+He}class Ko{constructor(J,ie,oe,Pe=Vh){this._dataUpdateable=new Map,this.actor=J,this.layerIndex=ie,this.availableImages=oe,this.tileState=new E,this._createGeoJSONIndex=Pe}loadVectorTile(J){if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const{z:ie,x:oe,y:Pe}=J.tileID.canonical,Ne=this._geoJSONIndex.getTile(ie,oe,Pe);return Ne?W(new c.d3(Ne.features,{version:2,extent:c.a5})):null}loadTile(J){return c._(this,void 0,void 0,(function*(){const{uid:ie}=J,oe=new b(J);oe.abort=new AbortController;try{const Pe=this.loadVectorTile(J);if(!Pe)return null;const{vectorTile:Ne,rawData:tt}=Pe;oe.vectorTile=Ne,this.tileState.markLoaded(ie,oe);const Je={rawData:tt};this.tileState.setParsing(ie,Je);try{return yield this._parseWorkerTile(oe,J,Je)}finally{this.tileState.clearParsing(ie)}}catch(Pe){throw oe.status="done",this.tileState.markLoaded(ie,oe),Pe}}))}_reloadLoadedTile(J){return c._(this,void 0,void 0,(function*(){const ie=J.uid,oe=this.tileState.getLoaded(ie);if(!oe)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(oe.showCollisionBoxes=J.showCollisionBoxes,oe.status==="parsing"){const Pe=this.tileState.consumeParsing(ie);return yield this._parseWorkerTile(oe,J,Pe)}if(oe.status==="done"&&oe.vectorTile)return yield this._parseWorkerTile(oe,J)}))}_parseWorkerTile(J,ie,oe){return c._(this,void 0,void 0,(function*(){let Pe=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);if(oe){const{rawData:Ne}=oe;Pe=c.e({rawTileData:Ne.slice(0)},Pe)}return Pe}))}abortTile(J){return c._(this,void 0,void 0,(function*(){this.tileState.abort(J.uid)}))}removeTile(J){return c._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(J.uid)}))}loadData(J){return c._(this,void 0,void 0,(function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const oe=this._startRequestTiming(J);this._pendingRequest=new AbortController;try{(!this._pendingData||J.request||J.data||J.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest));const Pe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Pe,J),this.tileState.clearLoaded();const Ne={};return J.request&&(Ne.data=Pe),this._finishRequestTiming(oe,J,Ne),Ne}catch(Pe){if(delete this._pendingRequest,c.Z(Pe))return{abandoned:!0};throw Pe}}))}_startRequestTiming(J){var ie;if(!((ie=J.request)===null||ie===void 0)&&ie.collectResourceTiming)return new c.c$(J.request.url)}_finishRequestTiming(J,ie,oe){const Pe=J?.finish();Pe&&(oe.resourceTiming={[ie.source]:JSON.parse(JSON.stringify(Pe))})}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(J){return this.tileState.getLoaded(J.uid)?this._reloadLoadedTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,ie){return c._(this,void 0,void 0,(function*(){let oe;if(J.request?oe=yield this.loadGeoJSONFromUrl(J.request,J.promoteId,ie):J.data?oe=this._loadGeoJSONFromObject(J.data,J.promoteId):J.dataDiff&&(oe=this._loadGeoJSONFromDiff(J.dataDiff,J.promoteId,J.source)),delete this._pendingRequest,typeof oe!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);return ge(oe,!0),J.filter&&(oe=this._filterGeoJSON(oe,J.filter)),oe}))}loadGeoJSONFromUrl(J,ie,oe){return c._(this,void 0,void 0,(function*(){const Pe=yield c.j(J,oe);return this._dataUpdateable=c.a7(Pe.data,ie),Pe.data}))}_loadGeoJSONFromObject(J,ie){return this._dataUpdateable=c.a7(J,ie),J}_loadGeoJSONFromDiff(J,ie,oe){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${oe}`);c.a8(this._dataUpdateable,J,ie);const Pe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Pe)}_filterGeoJSON(J,ie){const oe=c.d4(ie,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map((Ne=>`${Ne.key}: ${Ne.message}`)).join(", "));const Pe=J.features.filter((Ne=>oe.value.evaluate({zoom:0},Ne)));return this._toFeatureCollection(Pe)}_toFeatureCollection(J){return{type:"FeatureCollection",features:J}}removeSource(J){return c._(this,void 0,void 0,(function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort()}))}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}function Vh(He,J){return J.cluster?new Et((function({superclusterOptions:ie,clusterProperties:oe}){if(!oe||!ie)return ie;const Pe={},Ne={},tt={accumulated:null,zoom:0},Je={properties:null},qe=Object.keys(oe);for(const et of qe){const[Ct,mt]=oe[et],Le=c.d4(mt),Qt=c.d4(typeof Ct=="string"?[Ct,["accumulated"],["get",et]]:Ct);Pe[et]=Le.value,Ne[et]=Qt.value}return ie.map=et=>{Je.properties=et;const Ct={};for(const mt of qe)Ct[mt]=Pe[mt].evaluate(tt,Je);return Ct},ie.reduce=(et,Ct)=>{Je.properties=Ct;for(const mt of qe)tt.accumulated=et[mt],et[mt]=Ne[mt].evaluate(tt,Je)},ie})(J)).load(He.features):(function(ie,oe){return new ku(ie,oe)})(He,J.geojsonVtOptions)}class Ol{constructor(J){this.self=J,this.actor=new c.L(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ie,oe)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=oe},this.self.addProtocol=c.cK,this.self.removeProtocol=c.cL,this.self.registerRTLTextPlugin=ie=>{c.d5.setMethods(ie)},this.actor.registerMessageHandler("LDT",((ie,oe)=>this._getDEMWorkerSource(ie,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RDT",((ie,oe)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ie,oe.source).removeTile(oe)})))),this.actor.registerMessageHandler("GCEZ",((ie,oe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ie,oe.type,oe.source).getClusterExpansionZoom(oe)})))),this.actor.registerMessageHandler("GCC",((ie,oe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ie,oe.type,oe.source).getClusterChildren(oe)})))),this.actor.registerMessageHandler("GCL",((ie,oe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ie,oe.type,oe.source).getClusterLeaves(oe)})))),this.actor.registerMessageHandler("LD",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).loadData(oe))),this.actor.registerMessageHandler("GD",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).getData())),this.actor.registerMessageHandler("LT",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RT",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).reloadTile(oe))),this.actor.registerMessageHandler("AT",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).abortTile(oe))),this.actor.registerMessageHandler("RMT",((ie,oe)=>this._getWorkerSource(ie,oe.type,oe.source).removeTile(oe))),this.actor.registerMessageHandler("RS",((ie,oe)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[ie]||!this.workerSources[ie][oe.type]||!this.workerSources[ie][oe.type][oe.source])return;const Pe=this.workerSources[ie][oe.type][oe.source];delete this.workerSources[ie][oe.type][oe.source],Pe.removeSource!==void 0&&Pe.removeSource(oe)})))),this.actor.registerMessageHandler("RM",(ie=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie],this.globalStates.delete(ie)})))),this.actor.registerMessageHandler("SR",((ie,oe)=>c._(this,void 0,void 0,(function*(){this.referrer=oe})))),this.actor.registerMessageHandler("SRPS",((ie,oe)=>this._syncRTLPluginState(ie,oe))),this.actor.registerMessageHandler("IS",((ie,oe)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(oe)})))),this.actor.registerMessageHandler("SI",((ie,oe)=>this._setImages(ie,oe))),this.actor.registerMessageHandler("UL",((ie,oe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ie).update(oe.layers,oe.removedIds,this._getGlobalState(ie))})))),this.actor.registerMessageHandler("UGS",((ie,oe)=>c._(this,void 0,void 0,(function*(){const Pe=this._getGlobalState(ie);for(const Ne in oe)Pe[Ne]=oe[Ne]})))),this.actor.registerMessageHandler("SL",((ie,oe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ie).replace(oe,this._getGlobalState(ie))}))))}_getGlobalState(J){let ie=this.globalStates.get(J);return ie||(ie={},this.globalStates.set(J,ie)),ie}_setImages(J,ie){return c._(this,void 0,void 0,(function*(){this.availableImages[J]=ie;for(const oe in this.workerSources[J]){const Pe=this.workerSources[J][oe];for(const Ne in Pe)Pe[Ne].availableImages=ie}}))}_syncRTLPluginState(J,ie){return c._(this,void 0,void 0,(function*(){return yield c.d5.syncState(ie,this.self.importScripts)}))}_getAvailableImages(J){let ie=this.availableImages[J];return ie||(ie=[]),ie}_getLayerIndex(J){let ie=this.layerIndexes[J];return ie||(ie=this.layerIndexes[J]=new s),ie}_getWorkerSource(J,ie,oe){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][ie]||(this.workerSources[J][ie]={}),!this.workerSources[J][ie][oe]){const Pe={sendAsync:(Ne,tt)=>(Ne.targetMapId=J,this.actor.sendAsync(Ne,tt))};switch(ie){case"vector":this.workerSources[J][ie][oe]=new Y(Pe,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][ie][oe]=new Ko(Pe,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][ie][oe]=new this.externalWorkerSourceTypes[ie](Pe,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][ie][oe]}_getDEMWorkerSource(J,ie){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][ie]||(this.demWorkerSources[J][ie]=new ce),this.demWorkerSources[J][ie]}}return c.i(self)&&(self.worker=new Ol(self)),Ol})),i("index",["exports","./shared"],(function(c,s){var m="5.18.0";function b(){var A=new s.A(4);return s.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A}let w,E,O;const N={frame(A,o,d,_){const x=_||window,C=x.requestAnimationFrame((D=>{I(),o(D)})),{unsubscribe:I}=s.s(A.signal,"abort",(()=>{I(),x.cancelAnimationFrame(C),d(new s.a(A.signal.reason))}),!1)},frameAsync(A,o){return new Promise(((d,_)=>{this.frame(A,d,_,o)}))},getImageData(A,o=0){return this.getImageCanvasContext(A).getImageData(-o,-o,A.width+2*o,A.height+2*o)},getImageCanvasContext(A){const o=window.document.createElement("canvas"),d=o.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return o.width=A.width,o.height=A.height,d.drawImage(A,0,0,A.width,A.height),d},resolveURL:A=>(w||(w=document.createElement("a")),w.href=A,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return O!==void 0?O:!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)},set prefersReducedMotion(A){O=A}},V=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(A){this._frozenAt=A}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function W(){return V.getCurrentTime()}class j{static testProp(o){if(!j.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in j.docStyle)return o[d];return o[0]}static create(o,d,_){const x=window.document.createElement(o);return d!==void 0&&(x.className=d),_&&_.appendChild(x),x}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){j.docStyle&&j.selectProp&&(j.userSelect=j.docStyle[j.selectProp],j.docStyle[j.selectProp]="none")}static enableDrag(){j.docStyle&&j.selectProp&&(j.docStyle[j.selectProp]=j.userSelect)}static setTransform(o,d){o.style[j.transformProp]=d}static addEventListener(o,d,_,x={}){o.addEventListener(d,_,"passive"in x?x:x.capture)}static removeEventListener(o,d,_,x={}){o.removeEventListener(d,_,"passive"in x?x:x.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",j.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",j.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",j.suppressClickInternal,!0)}),0)}static getScale(o){const d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}static getPoint(o,d,_){const x=d.boundingClientRect;return new s.P((_.clientX-x.left)/d.x-o.clientLeft,(_.clientY-x.top)/d.y-o.clientTop)}static mousePos(o,d){const _=j.getScale(o);return j.getPoint(o,_,d)}static touchPos(o,d){const _=[],x=j.getScale(o);for(let C=0;C<d.length;C++)_.push(j.getPoint(o,x,d[C]));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){const d=new DOMParser().parseFromString(o,"text/html").body||document.createElement("body"),_=d.querySelectorAll("script");for(const x of _)x.remove();return j.clean(d),d.innerHTML}static isPossiblyDangerous(o,d){const _=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!_.includes("javascript:")&&!_.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){const d=o.children;for(const _ of d)j.removeAttributes(_),j.clean(_)}static removeAttributes(o){for(const{name:d,value:_}of o.attributes)j.isPossiblyDangerous(d,_)&&o.removeAttribute(d)}}j.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,j.selectProp=j.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),j.transformProp=j.testProp(["transform","WebkitTransform"]);const Y={supported:!1,testSupport:function(A){!ue&&re&&(me?ge(A):ce=A)}};let ce,re,ue=!1,me=!1;function ge(A){const o=A.createTexture();A.bindTexture(A.TEXTURE_2D,o);try{if(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,re),A.isContextLost())return;Y.supported=!0}catch{}A.deleteTexture(o),ue=!0}var Ce;typeof document<"u"&&(re=document.createElement("img"),re.onload=()=>{ce&&ge(ce),ce=null,me=!0},re.onerror=()=>{ue=!0,ce=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(A){let o,d,_,x;A.resetRequestQueue=()=>{o=[],d=0,_=0,x={}},A.addThrottleControl=z=>{const $=_++;return x[$]=z,$},A.removeThrottleControl=z=>{delete x[z],I()},A.getImage=(z,$,H=!0)=>new Promise(((Z,G)=>{Y.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),s.e(z,{type:"image"}),o.push({abortController:$,requestParameters:z,supportImageRefresh:H,state:"queued",onError:ne=>{G(ne)},onSuccess:ne=>{Z(ne)}}),I()}));const C=z=>s._(this,void 0,void 0,(function*(){z.state="running";const{requestParameters:$,supportImageRefresh:H,onError:Z,onSuccess:G,abortController:ne}=z,le=H===!1&&!s.i(self)&&!s.g($.url)&&(!$.headers||Object.keys($.headers).reduce(((be,Ae)=>be&&Ae==="accept"),!0));d++;const _e=le?D($,ne):s.m($,ne);try{const be=yield _e;delete z.abortController,z.state="completed",be.data instanceof HTMLImageElement||s.b(be.data)?G(be):be.data&&G({data:yield(xe=be.data,typeof createImageBitmap=="function"?s.f(xe):s.h(xe)),cacheControl:be.cacheControl,expires:be.expires})}catch(be){delete z.abortController,Z(be)}finally{d--,I()}var xe})),I=()=>{const z=(()=>{for(const $ of Object.keys(x))if(x[$]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let $=d;$<z&&o.length>0;$++){const H=o.shift();H.abortController.signal.aborted?$--:C(H)}},D=(z,$)=>new Promise(((H,Z)=>{const G=new Image,ne=z.url,le=z.credentials;le&&le==="include"?G.crossOrigin="use-credentials":(le&&le==="same-origin"||!s.d(ne))&&(G.crossOrigin="anonymous"),$.signal.addEventListener("abort",(()=>{G.src="",Z(new s.a($.signal.reason))})),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,H({data:G})},G.onerror=()=>{G.onerror=G.onload=null,$.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=ne}))})(Ce||(Ce={})),Ce.resetRequestQueue();class We{constructor(o){this._transformRequestFn=o??null}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function Xe(A){const o=[];if(typeof A=="string")o.push({id:"default",url:A});else if(A&&A.length>0){const d=[];for(const{id:_,url:x}of A){const C=`${_}${x}`;d.indexOf(C)===-1&&(d.push(C),o.push({id:_,url:x}))}}return o}function Et(A,o,d){try{const _=new URL(A);return _.pathname+=`${o}${d}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${A}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function gt(A){const{userImage:o}=A;return!!(o&&o.render&&o.render())&&(A.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ye extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const o of Object.keys(this.images))this.removeImage(o);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let _=!0;const x=d.data||d.spriteData;return this._validateStretch(d.stretchX,x&&x.width)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,x&&x.height)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,d){if(!o)return!0;let _=0;for(const x of o){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const _=d.spriteData,x=_&&_.width||d.data.width,C=_&&_.height||d.data.height;return!(o[0]<0||x<o[0]||o[1]<0||C<o[1]||o[2]<0||x<o[2]||o[3]<0||C<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,_=!0){const x=this.getImage(o);if(_&&(x.data.width!==d.data.width||x.data.height!==d.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=x.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise(((d,_)=>{let x=!0;if(!this.isLoaded())for(const C of o)this.images[C]||(x=!1);this.isLoaded()||x?d(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:d})}))}_getImagesForIds(o){const d={};for(const _ of o){let x=this.getImage(_);x||(this.fire(new s.l("styleimagemissing",{id:_})),x=this.getImage(_)),x?d[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],_=this.getImage(o);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new s.I(x,_);this.patterns[o]={bin:x,position:C}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const C in this.patterns)o.push(this.patterns[C].bin);const{w:d,h:_}=s.p(o),x=this.atlasImage;x.resize({width:d||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],D=I.x+1,z=I.y+1,$=this.getImage(C).data,H=$.width,Z=$.height;s.R.copy($,x,{x:0,y:0},{x:D,y:z},{width:H,height:Z}),s.R.copy($,x,{x:0,y:Z-1},{x:D,y:z-1},{width:H,height:1}),s.R.copy($,x,{x:0,y:0},{x:D,y:z+Z},{width:H,height:1}),s.R.copy($,x,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:Z}),s.R.copy($,x,{x:0,y:0},{x:D+H,y:z},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||s.w(`Image with ID: "${d}" was not found`),gt(_)&&this.updateImage(d,_)}}cloneImages(){const o={};for(const d in this.images){const _=this.images[d];o[d]=Object.assign(Object.assign({},_),{data:_.data?_.data.clone():null})}return o}}const jt=1e20;function St(A,o,d,_,x,C,I,D,z){for(let $=o;$<o+_;$++)Zt(A,d*C+$,C,x,I,D,z);for(let $=d;$<d+x;$++)Zt(A,$*C+o,1,_,I,D,z)}function Zt(A,o,d,_,x,C,I){C[0]=0,I[0]=-jt,I[1]=jt,x[0]=A[o];for(let D=1,z=0,$=0;D<_;D++){x[D]=A[o+D*d];const H=D*D;do{const Z=C[z];$=(x[D]-x[Z]+H-Z*Z)/(D-Z)/2}while($<=I[z]&&--z>-1);z++,C[z]=D,I[z]=$,I[z+1]=jt}for(let D=0,z=0;D<_;D++){for(;I[z+1]<D;)z++;const $=C[z],H=D-$;A[o+D*d]=x[$]+H*H}}const fe=s.v.layout_symbol["text-font"].default.join(",");class Me{constructor(o,d,_){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={},this.lang=_}setURL(o){this.url=o}getGlyphs(o){return s._(this,void 0,void 0,(function*(){const d=[];for(const C in o)for(const I of o[C])d.push(this._getAndCacheGlyphsPromise(C,I));const _=yield Promise.all(d),x={};for(const{stack:C,id:I,glyph:D}of _)x[C]||(x[C]={}),x[C][I]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return x}))}_getAndCacheGlyphsPromise(o,d){return s._(this,void 0,void 0,(function*(){let _=this.entries[o];_||(_=this.entries[o]={glyphs:{},requests:{},ranges:{}});let x=_.glyphs[d];return x!==void 0?{stack:o,id:d,glyph:x}:!this.url||this._charUsesLocalIdeographFontFamily(d)?(x=_.glyphs[d]=this._drawGlyph(_,o,d),{stack:o,id:d,glyph:x}):yield this._downloadAndCacheRangePromise(o,d)}))}_downloadAndCacheRangePromise(o,d){return s._(this,void 0,void 0,(function*(){const _=this.entries[o],x=Math.floor(d/256);if(_.ranges[x])return{stack:o,id:d,glyph:null};if(!_.requests[x]){const C=Me.loadGlyphRange(o,x,this.url,this.requestManager);_.requests[x]=C}try{const C=yield _.requests[x];for(const I in C)_.glyphs[+I]=C[+I];return _.ranges[x]=!0,{stack:o,id:d,glyph:C[d]||null}}catch(C){const I=_.glyphs[d]=this._drawGlyph(_,o,d);return this._warnOnMissingGlyphRange(I,x,d,C),{stack:o,id:d,glyph:I}}}))}_warnOnMissingGlyphRange(o,d,_,x){const C=256*d,I=C+255,D=_.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${d}, ${C}-${I}. Rendering codepoint U+${D} locally instead. ${x}`)}_charUsesLocalIdeographFontFamily(o){return!!this.localIdeographFontFamily&&s.q(o)}_drawGlyph(o,d,_){const x=d===fe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(_),C=x?"ideographTinySDF":"tinySDF";o[C]||(o[C]=this._createTinySDF(x?this.localIdeographFontFamily:d));const I=o[C].draw(String.fromCodePoint(_)),D=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(_));return{id:_,bitmap:new s.r({width:I.width||60,height:I.height||60},I.data),metrics:{width:D?0:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:D?0:I.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(o){const d=o?o.split(","):[];d.push("sans-serif");const _=d.map((x=>/[-\w]+/.test(x)?x:`'${CSS.escape(x)}'`)).join(",");return new Me.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:this._fontWeight(d[0]),fontStyle:this._fontStyle(d[0]),lang:this.lang})}_fontStyle(o){return/italic/i.test(o)?"italic":/oblique/i.test(o)?"oblique":"normal"}_fontWeight(o){const d={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let _;for(const[x,C]of Object.entries(d))new RegExp(`\\b${x}\\b`,"i").test(o)&&(_=`${C}`);return _}destroy(){for(const o in this.entries){const d=this.entries[o];d.tinySDF&&(d.tinySDF=null),d.ideographTinySDF&&(d.ideographTinySDF=null),d.glyphs={},d.requests={},d.ranges={}}this.entries={}}}Me.loadGlyphRange=function(A,o,d,_){return s._(this,void 0,void 0,(function*(){const x=256*o,C=x+255,I=_.transformRequest(d.replace("{fontstack}",A).replace("{range}",`${x}-${C}`),"Glyphs"),D=yield s.n(I,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${o}, ${x}-${C}`);const z={};for(const $ of s.o(D.data))z[$.id]=$;return z}))},Me.TinySDF=class{constructor({fontSize:A=24,buffer:o=3,radius:d=8,cutoff:_=.25,fontFamily:x="sans-serif",fontWeight:C="normal",fontStyle:I="normal",lang:D=null}={}){this.buffer=o,this.cutoff=_,this.radius=d,this.lang=D;const z=this.size=A+4*o,$=this._createCanvas(z),H=this.ctx=$.getContext("2d",{willReadFrequently:!0});H.font=`${I} ${C} ${A}px ${x}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(A){const o=document.createElement("canvas");return o.width=o.height=A,o}draw(A){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:x,actualBoundingBoxRight:C}=this.ctx.measureText(A),I=Math.ceil(d),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(C-x))),z=Math.min(this.size-this.buffer,I+Math.ceil(_)),$=D+2*this.buffer,H=z+2*this.buffer,Z=Math.max($*H,0),G=new Uint8ClampedArray(Z),ne={data:G,width:$,height:H,glyphWidth:D,glyphHeight:z,glyphTop:I,glyphLeft:0,glyphAdvance:o};if(D===0||z===0)return ne;const{ctx:le,buffer:_e,gridInner:xe,gridOuter:be}=this;this.lang&&(le.lang=this.lang),le.clearRect(_e,_e,D,z),le.fillText(A,_e,_e+I);const Ae=le.getImageData(_e,_e,D,z);be.fill(jt,0,Z),xe.fill(0,0,Z);for(let ke=0;ke<z;ke++)for(let Se=0;Se<D;Se++){const De=Ae.data[4*(ke*D+Se)+3]/255;if(De===0)continue;const ze=(ke+_e)*$+Se+_e;if(De===1)be[ze]=0,xe[ze]=jt;else{const Re=.5-De;be[ze]=Re>0?Re*Re:0,xe[ze]=Re<0?Re*Re:0}}St(be,0,0,$,H,$,this.f,this.v,this.z),St(xe,_e,_e,D,z,$,this.f,this.v,this.z);for(let ke=0;ke<Z;ke++){const Se=Math.sqrt(be[ke])-Math.sqrt(xe[ke]);G[ke]=Math.round(255-255*(Se/this.radius+this.cutoff))}return ne}};class Ee{constructor(){this.specification=s.u.light.position}possiblyEvaluate(o,d){return s.F(o.expression.evaluate(d))}interpolate(o,d,_){return{x:s.G.number(o.x,d.x,_),y:s.G.number(o.y,d.y,_),z:s.G.number(o.z,d.z,_)}}}let Ue;class st extends s.E{constructor(o){super(),Ue=Ue||new s.t({anchor:new s.D(s.u.light.anchor),position:new Ee,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(Ue,void 0),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(s.y,o,d))for(const _ in o){const x=o[_];_.endsWith(s.z)?this._transitionable.setTransition(_.slice(0,-s.z.length),x):this._transitionable.setValue(_,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_){return(!_||_.validate!==!1)&&s.B(this,o.call(s.C,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}const ye=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class Be extends s.E{constructor(o){super(),this._transitionable=new s.x(ye,void 0),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(o,d={}){if(!this._validate(s.J,o,d)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in o){const x=o[_];_.endsWith(s.z)?this._transitionable.setTransition(_.slice(0,-s.z.length),x):this._transitionable.setValue(_,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_={}){return _?.validate!==!1&&s.B(this,o.call(s.C,s.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class lt{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const _=o.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(o,d)),this.dashEntry[_]}getDashRanges(o,d,_){const x=[];let C=o.length%2==1?-o[o.length-1]*_:0,I=o[0]*_,D=!0;x.push({left:C,right:I,isDash:D,zeroLength:o[0]===0});let z=o[0];for(let $=1;$<o.length;$++){D=!D;const H=o[$];C=z*_,z+=H,I=z*_,x.push({left:C,right:I,isDash:D,zeroLength:H===0})}return x}addRoundDash(o,d,_){const x=d/2;for(let C=-_;C<=_;C++){const I=this.width*(this.nextRow+_+C);let D=0,z=o[D];for(let $=0;$<this.width;$++){$/z.right>1&&(z=o[++D]);const H=Math.abs($-z.left),Z=Math.abs($-z.right),G=Math.min(H,Z);let ne;const le=C/_*(x+1);if(z.isDash){const _e=x-Math.abs(le);ne=Math.sqrt(G*G+_e*_e)}else ne=x-Math.sqrt(G*G+le*le);this.data[I+$]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(o){for(let D=o.length-1;D>=0;--D){const z=o[D],$=o[D+1];z.zeroLength?o.splice(D,1):$&&$.isDash===z.isDash&&($.left=z.left,o.splice(D,1))}const d=o[0],_=o[o.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const x=this.width*this.nextRow;let C=0,I=o[C];for(let D=0;D<this.width;D++){D/I.right>1&&(I=o[++C]);const z=Math.abs(D-I.left),$=Math.abs(D-I.right),H=Math.min(z,$);this.data[x+D]=Math.max(0,Math.min(255,(I.isDash?H:-H)+128))}}addDash(o,d){const _=d?7:0,x=2*_+1;if(this.nextRow+x>this.height)return s.w("LineAtlas out of space"),null;let C=0;for(let D=0;D<o.length;D++)C+=o[D];if(C!==0){const D=this.width/C,z=this.getDashRanges(o,this.width,D);d?this.addRoundDash(z,D,_):this.addRegularDash(z)}const I={y:this.nextRow+_,height:2*_,width:C};return this.nextRow+=x,this.dirty=!0,I}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Tt="maplibre_preloaded_worker_pool";class zt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<zt.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Tt]}numActive(){return Object.keys(this.active).length}}const Xt=Math.floor(N.hardwareConcurrency/2);let Wt,nr;function _t(){return Wt||(Wt=new zt),Wt}zt.workerCount=s.K(globalThis)?Math.max(Math.min(Xt,3),1):1;class Yt{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let x=0;x<_.length;x++){const C=new s.L(_[x],d);C.name=`Worker ${x}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d){const _=[];for(const x of this.actors)_.push(x.sendAsync({type:o,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,d){for(const _ of this.actors)_.registerMessageHandler(o,d)}unregisterMessageHandler(o){for(const d of this.actors)d.unregisterMessageHandler(o)}}function Tr(){return nr||(nr=new Yt(_t(),s.M),nr.registerMessageHandler("GR",((A,o,d)=>s.m(o,d)))),nr}function Rt(A,o){const d=s.N();return s.O(d,d,[1,1,0]),s.Q(d,d,[.5*A.width,.5*A.height,1]),A.calculatePosMatrix?s.S(d,d,A.calculatePosMatrix(o.toUnwrapped())):d}function $n(A,o,d,_,x,C,I){var D;const z=(function(G,ne,le){if(G)for(const _e of G){const xe=ne[_e];if(xe&&xe.source===le&&xe.type==="fill-extrusion")return!0}else for(const _e in ne){const xe=ne[_e];if(xe.source===le&&xe.type==="fill-extrusion")return!0}return!1})((D=x?.layers)!==null&&D!==void 0?D:null,o,A.id),$=C.maxPitchScaleFactor(),H=A.tilesIn(_,$,z);H.sort(_r);const Z=[];for(const G of H)Z.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(o,d,A.getState(),G.queryGeometry,G.cameraQueryGeometry,G.scale,x,C,$,Rt(C,G.tileID),I?(ne,le)=>I(G.tileID,ne,le):void 0)});return(function(G,ne){for(const le in G)for(const _e of G[le])sr(_e,ne);return G})((function(G){const ne={},le={};for(const _e of G){const xe=_e.queryResults,be=_e.wrappedTileID,Ae=le[be]=le[be]||{};for(const ke in xe){const Se=xe[ke],De=Ae[ke]=Ae[ke]||{},ze=ne[ke]=ne[ke]||[];for(const Re of Se)De[Re.featureIndex]||(De[Re.featureIndex]=!0,ze.push(Re))}}return ne})(Z),A)}function _r(A,o){const d=A.tileID,_=o.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function sr(A,o){const d=A.feature,_=o.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=_}function ur(A,o,d,_){return s._(this,void 0,void 0,(function*(){let x=A;if(A.url?x=(yield s.j(o.transformRequest(A.url,"Source"),d)).data:yield N.frameAsync(d,_),!x)return null;const C=s.U(s.e(x,A),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in x&&x.vector_layers&&(C.vectorLayerIds=x.vector_layers.map((I=>I.id))),C}))}class Yr{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof s.V?new s.V(o.lng,o.lat):s.V.convert(o),this}setSouthWest(o){return this._sw=o instanceof s.V?new s.V(o.lng,o.lat):s.V.convert(o),this}extend(o){const d=this._sw,_=this._ne;let x,C;if(o instanceof s.V)x=o,C=o;else{if(!(o instanceof Yr))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Yr.convert(o)):this.extend(s.V.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(s.V.convert(o)):this;if(x=o._sw,C=o._ne,!x||!C)return this}return d||_?(d.lng=Math.min(x.lng,d.lng),d.lat=Math.min(x.lat,d.lat),_.lng=Math.max(C.lng,_.lng),_.lat=Math.max(C.lat,_.lat)):(this._sw=new s.V(x.lng,x.lat),this._ne=new s.V(C.lng,C.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:_}=s.V.convert(o);let x=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&x}intersects(o){if(!((o=Yr.convert(o)).getNorth()>=this.getSouth()&&o.getSouth()<=this.getNorth()))return!1;const d=Math.abs(this.getEast()-this.getWest()),_=Math.abs(o.getEast()-o.getWest());if(d>=360||_>=360)return!0;const x=s.W(this.getWest(),-180,180),C=s.W(this.getEast(),-180,180),I=s.W(o.getWest(),-180,180),D=s.W(o.getEast(),-180,180),z=x>C,$=I>D;return!(!z||!$)||(z?D>=x||I<=C:$?C>=I||x<=D:I<=C&&D>=x)}static convert(o){return o instanceof Yr?o:o&&new Yr(o)}static fromLngLat(o,d=0){const _=360*d/40075017,x=_/Math.cos(Math.PI/180*o.lat);return new Yr(new s.V(o.lng-x,o.lat-_),new s.V(o.lng+x,o.lat+_))}adjustAntiMeridian(){const o=new s.V(this._sw.lng,this._sw.lat),d=new s.V(this._ne.lng,this._ne.lat);return new Yr(o,o.lng>d.lng?new s.V(d.lng+360,d.lat):d)}}class qs{constructor(o,d,_){this.bounds=Yr.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),_=Math.floor(s.Y(this.bounds.getWest())*d),x=Math.floor(s.X(this.bounds.getNorth())*d),C=Math.ceil(s.Y(this.bounds.getEast())*d),I=Math.ceil(s.X(this.bounds.getSouth())*d);return o.x>=_&&o.x<C&&o.y>=x&&o.y<I}}class Rl extends s.E{constructor(o,d,_,x){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(d,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield ur(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),o&&(s.e(this,o),o.bounds&&(this.tileBounds=new qs(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this._loaded=!0,s.Z(o)||this.fire(new s.k(o))}}))}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(o)};_.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise(((C,I)=>{o.reloadPromise={resolve:C,reject:I}}))}else o.actor=this.dispatcher.getActor(),x="LT";o.abortController=new AbortController;try{const C=yield o.actor.sendAsync({type:x,data:_},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,C)}catch(C){if(delete o.abortController,o.aborted)return;if(C&&C.status!==404)throw C;this._afterTileLoadWorkerResponse(o,null)}}))}_getOverzoomParameters(o){if(o.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const d=o.tileID.scaledTo(this.maxzoom).canonical,_=d.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:d,overzoomRequest:this.map._requestManager.transformRequest(_,"Tile")}}_afterTileLoadWorkerResponse(o,d){if(d&&d.resourceTiming&&(o.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&o.setExpiryData(d),o.loadVectorData(d,this.map.painter),o.reloadPromise){const _=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(_.resolve).catch(_.reject)}}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Zo extends s.E{constructor(o,d,_,x){super(),this.id=o,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.U(d,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(o=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield ur(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,d&&(s.e(this,d),d.bounds&&(this.tileBounds=new qs(d.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(d){this._tileJSONRequest=null,this._loaded=!0,s.Z(d)||this.fire(new s.k(d))}}))}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}serialize(){return s.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const _=yield Ce.getImage(this.map._requestManager.transformRequest(d,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&o.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const x=this.map.painter.context,C=x.gl,I=_.data;o.texture=this.map.painter.getTileTexture(I.width),o.texture?o.texture.update(I,{useMipmap:!0}):(o.texture=new s.T(x,I,C.RGBA,{useMipmap:!0}),o.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(_){if(delete o.abortController,o.aborted)o.state="unloaded";else if(_)throw o.state="errored",_}}))}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)}))}hasTransition(){return!1}}class yo extends Zo{constructor(o,d,_,x){super(o,d,_,x),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const x=yield Ce.getImage(_,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(x&&x.data){const C=x.data;this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&o.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const I=s.b(C)&&s.$()?C:yield this.readImageNow(C),D={type:this.type,uid:o.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const z=yield o.actor.sendAsync({type:"LDT",data:D});o.dem=z,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(x){if(delete o.abortController,o.aborted)o.state="unloaded";else if(x)throw o.state="errored",x}}))}readImageNow(o){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.a0()){const d=o.width+2,_=o.height+2;try{return new s.R({width:d,height:_},yield s.a1(o,-1,-1,d,_))}catch{}}return N.getImageData(o,1)}))}_getNeighboringTiles(o){const d=o.canonical,_=Math.pow(2,d.z),x=(d.x-1+_)%_,C=d.x===0?o.wrap-1:o.wrap,I=(d.x+1+_)%_,D=d.x+1===_?o.wrap+1:o.wrap,z={};return z[new s.a2(o.overscaledZ,C,d.z,x,d.y).key]={backfilled:!1},z[new s.a2(o.overscaledZ,D,d.z,I,d.y).key]={backfilled:!1},d.y>0&&(z[new s.a2(o.overscaledZ,C,d.z,x,d.y-1).key]={backfilled:!1},z[new s.a2(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},z[new s.a2(o.overscaledZ,D,d.z,I,d.y-1).key]={backfilled:!1}),d.y+1<_&&(z[new s.a2(o.overscaledZ,C,d.z,x,d.y+1).key]={backfilled:!1},z[new s.a2(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},z[new s.a2(o.overscaledZ,D,d.z,I,d.y+1).key]={backfilled:!1}),z}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))}))}}function Za(A){return A.type==="GeometryCollection"?A.geometries.map((o=>o.coordinates)).flat(1/0):A.coordinates.flat(1/0)}function Du(A){const o=new Yr;let d;switch(A.type){case"FeatureCollection":d=A.features.map((_=>Za(_.geometry))).flat(1/0);break;case"Feature":d=Za(A.geometry);break;default:d=Za(A)}if(d.length==0)return o;for(let _=0;_<d.length-1;_+=2)o.extend([d[_],d[_+1]]);return o}class vi extends s.E{constructor(o,d,_,x){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=_.getActor(),this.setEventedParent(x),this._data=typeof d.data=="string"?{url:d.data}:{geojson:d.data},this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(o){return o*(s.a5/this.tileSize)}_getClusterMaxZoom(o){const d=o?Math.round(o):this.maxzoom-1;return Number.isInteger(o)||o===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${o}" rounded to "${d}"`),d}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(o){this.map=o,this.load()}setData(o,d){this._data=typeof o=="string"?{url:o}:{geojson:o},this._pendingWorkerUpdate={data:o};const _=this._updateWorkerData();return d?_:this}updateData(o,d){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,o);const _=this._updateWorkerData();return d?_:this}getData(){return s._(this,void 0,void 0,(function*(){const o=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})}))}getBounds(){return s._(this,void 0,void 0,(function*(){return Du(yield this.getData())}))}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(o.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,d,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:d,offset:_}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:o,diff:d}=this._pendingWorkerUpdate,_=this._getLoadGeoJSONParameters(o,d);o!==void 0?this._pendingWorkerUpdate.data=void 0:d&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(_)}))}_getLoadGeoJSONParameters(o,d){const _=s.e({type:this.type},this.workerOptions);return typeof o=="string"?(_.request=this.map._requestManager.transformRequest(N.resolveURL(o),"Source"),_.request.collectResourceTiming=this._collectResourceTiming,_):o!==void 0?(_.data=o,_):(d&&(_.dataDiff=d),_)}_dispatchWorkerUpdate(o){return s._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:o});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));d.data&&(this._data={geojson:d.data});const _=this._applyDiffToSource(o.dataDiff),x=this._getShouldReloadTileOptions(_),C={dataType:"source"};this._applyResourceTiming(C,d),this.fire(new s.l("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},C),{sourceDataType:"content",shouldReloadTileOptions:x})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(d))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(o,d){var _;if(!this._collectResourceTiming)return;const x=(_=d.resourceTiming)===null||_===void 0?void 0:_[this.id];if(!x)return;const C=x.slice(0);C?.length&&s.e(o,{resourceTiming:C})}_applyDiffToSource(o){if(!o)return;const d=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const x=s.a7(this._data.geojson,d);if(!x)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:x}}if(!this._data.updateable)return;const _=s.a8(this._data.updateable,o,d);return o.removeAll||this._options.cluster?void 0:_}_getShouldReloadTileOptions(o){if(o)return{affectedBounds:o.filter(Boolean).map((d=>Du(d)))}}shouldReloadTile(o,{affectedBounds:d}){if(o.state==="loading")return!0;if(o.state==="unloaded")return!1;const{buffer:_,extent:x}=this.workerOptions.geojsonVtOptions,C=(function({x:I,y:D,z},$=0){const H=s.a3((I-$)/Math.pow(2,z)),Z=s.a4((D+1+$)/Math.pow(2,z)),G=s.a3((I+1+$)/Math.pow(2,z)),ne=s.a4((D-$)/Math.pow(2,z));return new Yr([H,Z],[G,ne])})(o.tileID.canonical,_/x);for(const I of d)if(C.intersects(I))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.actor?"RT":"LT";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};o.abortController=new AbortController;const x=yield this.actor.sendAsync({type:d,data:_},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(x,this.map.painter,d==="RT")}))}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Xs extends s.E{constructor(o,d,_,x){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=d}load(o){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield Ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,o&&(this.coordinates=o),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,s.Z(d)||this.fire(new s.k(d))}}))}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(s.a9.fromLngLat);var _;return this.tileID=(function(x){const C=s.aa.fromPoints(x),I=C.width(),D=C.height(),z=Math.max(I,D),$=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),H=Math.pow(2,$);return new s.ac($,Math.floor((C.minX+C.maxX)/2*H),Math.floor((C.minY+C.maxY)/2*H))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((x=>this.tileID.getTilePoint(x)._round())),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.texture||(this.texture=new s.T(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){const{minX:d,minY:_,maxX:x,maxY:C}=s.aa.fromPoints(o),I={};for(let D=0;D<=s.ab;D++){const z=Math.pow(2,D),$=Math.floor(d*z),H=Math.floor(_*z),Z=Math.floor(x*z),G=Math.floor(C*z),ne=($%z+z)%z,le=Z%z,_e=Math.floor($/z),xe=Math.floor(Z/z);I[D]={minWrap:_e,maxWrap:xe,minTileXWrapped:ne,maxTileXWrapped:le,minTileY:H,maxTileY:G}}return I}}class ku extends Xs{constructor(o,d,_,x){super(o,d,_,x),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield s.ad(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new s.k(new s.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const x in this.tiles){const C=this.tiles[x];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Yo extends Xs{constructor(o,d,_,x){super(o,d,_,x),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((C=>!Array.isArray(C)||C.length!==2||C.some((I=>typeof I!="number"))))||this.fire(new s.k(new s.ae(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ae(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.k(new s.ae(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ae(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ae(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(d,this.canvas,_.RGBA,{premultiply:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let x=!1;for(const C in this.tiles){const I=this.tiles[C];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ko={},Vh=A=>{switch(A){case"geojson":return vi;case"image":return Xs;case"raster":return Zo;case"raster-dem":return yo;case"vector":return Rl;case"video":return ku;case"canvas":return Yo}return Ko[A]},Ol="RTLPluginLoaded";class He extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Tr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return s._(this,arguments,void 0,(function*(d,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Ol))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let J=null;function ie(){return J||(J=new He),J}var oe,Pe;(function(A){A[A.Base=0]="Base",A[A.Parent=1]="Parent"})(oe||(oe={})),(function(A){A[A.Departing=0]="Departing",A[A.Incoming=1]="Incoming"})(Pe||(Pe={}));class Ne{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=o,this.uid=s.af(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttFingerprint={},this.expiredRequestCount=0,this.state="loading"}isRenderable(o){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(o||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:o,fadingDirection:d,fadingParentID:_,fadeEndTime:x}){this.resetFadeLogic(),this.fadingRole=o,this.fadingDirection=d,this.fadingParentID=_,this.fadeEndTime=x}setSelfFadeLogic(o){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=o}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=W(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData,this.latestFeatureIndex.encoding=o.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=(function(x,C){const I={};if(!C)return I;for(const D of x){const z=D.layerIds.map(($=>C.getLayer($))).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(($=>z.filter((H=>H.id===$))[0])));for(const $ of z)I[$.id]=D}}return I})(o.buckets,d?.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const C=this.buckets[x];if(C instanceof s.ah){if(this.hasSymbolBuckets=!0,!_)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const C=this.buckets[x];if(C instanceof s.ah&&C.hasRTLText){this.hasRTLText=!0,ie().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const C=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(x).queryRadius(C))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),this.dashPositions=o.dashPositions}else this.collisionBoxArray=new s.ag}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,_,x,C,I,D,z,$,H,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:C,scale:I,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*$,getElevation:Z},o,d,_):{}}querySourceFeatures(o,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const x=_.loadVTLayers(),C=d&&d.sourceLayer?d.sourceLayer:"",I=x[s.ai]||x[C];if(!I)return;const D=s.aj(d?.filter,d?.globalState),{z,x:$,y:H}=this.tileID.canonical,Z={z,x:$,y:H};for(let G=0;G<I.length;G++){const ne=I.feature(G);if(D.needGeometry){const xe=s.ak(ne,!0);if(!D.filter(new s.H(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!D.filter(new s.H(this.tileID.overscaledZ),ne))continue;const le=_.getId(ne,C),_e=new s.al(ne,z,$,H,le);_e.tile=Z,o.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const _=s.am(o.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const _=Date.now();let x=!1;if(this.expirationTime>_)x=!1;else if(d)if(this.expirationTime<d)x=!0;else{const C=this.expirationTime-d;C?this.expirationTime=_+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!d.style.hasLayer(x))continue;const C=this.buckets[x],I=C.layers[0].sourceLayer||s.ai,D=_[I],z=o[I];if(!D||!z||Object.keys(z).length===0)continue;C.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const $=d&&d.style&&d.style.getLayer(x);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(C)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(o){this.symbolFadeHoldUntil=W()+o}setDependencies(o,d){const _={};for(const x of d)_[x]=!0;this.dependencies[o]=_}hasDependency(o,d){for(const _ of o){const x=this.dependencies[_];if(x){for(const C of d)if(x[C])return!0}}return!1}}class tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={},this.revision=0}updateState(o,d,_){const x=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][x]=this.stateChanges[o][x]||{},s.e(this.stateChanges[o][x],_),this.deletedStates[o]===null){this.deletedStates[o]={};for(const C in this.state[o])C!==x&&(this.deletedStates[o][C]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][x]===null){this.deletedStates[o][x]={};for(const C in this.state[o][x])_[C]||(this.deletedStates[o][x][C]=null)}else for(const C in _)this.deletedStates[o]&&this.deletedStates[o][x]&&this.deletedStates[o][x][C]===null&&delete this.deletedStates[o][x][C]}removeFeatureState(o,d,_){if(this.deletedStates[o]===null)return;const x=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},_&&d!==void 0)this.deletedStates[o][x]!==null&&(this.deletedStates[o][x]=this.deletedStates[o][x]||{},this.deletedStates[o][x][_]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][x])for(_ in this.deletedStates[o][x]={},this.stateChanges[o][x])this.deletedStates[o][x][_]=null;else this.deletedStates[o][x]=null;else this.deletedStates[o]=null}getState(o,d){const _=String(d),x=s.e({},(this.state[o]||{})[_],(this.stateChanges[o]||{})[_]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const C=this.deletedStates[o][d];if(C===null)return{};for(const I in C)delete x[I]}return x}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const _={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const C={};for(const I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),s.e(this.state[x][I],this.stateChanges[x][I]),C[I]=this.state[x][I];_[x]=C}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const C={};if(this.deletedStates[x]===null)for(const I in this.state[x])C[I]={},this.state[x][I]={};else for(const I in this.deletedStates[x]){if(this.deletedStates[x][I]===null)this.state[x][I]={};else for(const D of Object.keys(this.deletedStates[x][I]))delete this.state[x][I][D];C[I]=this.state[x][I]}_[x]=_[x]||{},s.e(_[x],C)}this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0&&(this.revision++,o.setFeatureState(_,d))}}const Je=89.25;function qe(A,o){const d=s.an(o.lat,-s.ao,s.ao);return new s.P(s.Y(o.lng)*A,s.X(d)*A)}function et(A,o){return new s.a9(o.x/A,o.y/A).toLngLat()}function Ct(A){return A.cameraToCenterDistance*Math.min(.85*Math.tan(s.ap(90-A.pitch)),Math.tan(s.ap(Je-A.pitch)))}function mt(A,o){const d=A.canonical,_=o/s.aq(d.z),x=d.x+Math.pow(2,d.z)*A.wrap,C=s.ar(new Float64Array(16));return s.O(C,C,[x*_,d.y*_,0]),s.Q(C,C,[_/s.a5,_/s.a5,1]),C}function Le(A,o,d,_,x){const C=s.a9.fromLngLat(A,o),I=x*s.as(1,A.lat),{x:D,y:z,z:$}=Qt(d,_);return new s.a9(C.x+I*-D,C.y+I*-z,C.z+I*-$)}function Qt(A,o){const d=s.ap(A),_=s.ap(o),x=Math.cos(-d),C=Math.sin(d);return{x:C*Math.sin(_),y:-C*Math.cos(_),z:x}}function yr(A,o,d){const _=o.intersectsFrustum(A);if(!d||_===0)return _;const x=o.intersectsPlane(d);return x===0?0:_===2&&x===2?2:1}function or(A,o,d){let _=0;const x=(d-o)/10;for(let C=0;C<10;C++)_+=x*Math.pow(Math.cos(o+(C+.5)/10*(d-o)),A);return _}function fr(A,o){return function(d,_,x,C,I){const D=2*((A-1)/s.at(Math.cos(s.ap(Je-I))/Math.cos(s.ap(Je)))-1),z=Math.acos(x/C),$=2*or(D-1,0,s.ap(I/2)),H=Math.min(s.ap(Je),z+s.ap(I/2)),Z=or(D-1,Math.min(H,z-s.ap(I/2)),H),G=Math.atan(_/x),ne=Math.hypot(_,x);let le=d;return le+=s.at(C/ne/Math.max(.5,Math.cos(s.ap(I/2)))),le+=D*s.at(Math.cos(G))/2,le-=s.at(Math.max(1,Z/$/o))/2,le}}const dr=fr(9.314,3);function vr(A,o){const d=(o.roundZoom?Math.round:Math.floor)(A.zoom+s.at(A.tileSize/o.tileSize));return Math.max(0,d)}function En(A,o){const d=A.getCameraFrustum(),_=A.getClippingPlane(),x=A.screenPointToMercatorCoordinate(A.getCameraPoint()),C=s.a9.fromLngLat(A.center,A.elevation);x.z=C.z+Math.cos(A.pitchInRadians)*A.cameraToCenterDistance/A.worldSize;const I=A.getCoveringTilesDetailsProvider(),D=I.allowVariableZoom(A,o),z=vr(A,o),$=o.minzoom||0,H=o.maxzoom!==void 0?o.maxzoom:A.maxZoom,Z=Math.min(Math.max(0,z),H),G=Math.pow(2,Z),ne=[G*x.x,G*x.y,0],le=[G*C.x,G*C.y,0],_e=Math.hypot(C.x-x.x,C.y-x.y),xe=Math.abs(C.z-x.z),be=Math.hypot(_e,xe),Ae=De=>({zoom:0,x:0,y:0,wrap:De,fullyVisible:!1}),ke=[],Se=[];if(A.renderWorldCopies&&I.allowWorldCopies())for(let De=1;De<=3;De++)ke.push(Ae(-De)),ke.push(Ae(De));for(ke.push(Ae(0));ke.length>0;){const De=ke.pop(),ze=De.x,Re=De.y;let Ve=De.fullyVisible;const ct={x:ze,y:Re,z:De.zoom},nt=I.getTileBoundingVolume(ct,De.wrap,A.elevation,o);if(!Ve){const Ut=yr(d,nt,_);if(Ut===0)continue;Ve=Ut===2}const at=I.distanceToTile2d(x.x,x.y,ct,nt);let ot=z;D&&(ot=(o.calculateTileZoom||dr)(A.zoom+s.at(A.tileSize/o.tileSize),at,xe,be,A.fov)),ot=(o.roundZoom?Math.round:Math.floor)(ot),ot=Math.max(0,ot);const Ft=Math.min(ot,H);if(De.wrap=I.getWrap(C,ct,De.wrap),De.zoom>=Ft){if(De.zoom<$)continue;const Ut=Z-De.zoom,Pt=ne[0]-.5-(ze<<Ut),$t=ne[1]-.5-(Re<<Ut),xr=o.reparseOverscaled?Math.max(De.zoom,ot):De.zoom;Se.push({tileID:new s.a2(De.zoom===H?xr:De.zoom,De.wrap,De.zoom,ze,Re),distanceSq:s.au([le[0]-.5-ze,le[1]-.5-Re]),tileDistanceToCamera:Math.sqrt(Pt*Pt+$t*$t)})}else for(let Ut=0;Ut<4;Ut++)ke.push({zoom:De.zoom+1,x:(ze<<1)+Ut%2,y:(Re<<1)+(Ut>>1),wrap:De.wrap,fullyVisible:Ve})}return Se.sort(((De,ze)=>De.distanceSq-ze.distanceSq)).map((De=>De.tileID))}const Wn=s.aa.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function Nn(A){return A==="raster"||A==="image"||A==="video"}function Vi(A,o,d,_,x,C,I){if(!o.hasData())return!1;const{tileID:D,fadingRole:z,fadingDirection:$,fadingParentID:H}=o;if(z===oe.Base&&$===Pe.Incoming&&H)return d[H.key]=H,!0;const Z=Math.max(D.overscaledZ-x,C);for(let G=D.overscaledZ-1;G>=Z;G--){const ne=D.scaledTo(G),le=A.getLoadedTile(ne);if(le)return o.setCrossFadeLogic({fadingRole:oe.Base,fadingDirection:Pe.Incoming,fadingParentID:le.tileID,fadeEndTime:_+I}),le.setCrossFadeLogic({fadingRole:oe.Parent,fadingDirection:Pe.Departing,fadeEndTime:_+I}),d[ne.key]=ne,!0}return!1}function Pn(A,o,d,_,x,C){if(!o.hasData())return!1;const I=o.tileID.children(x);let D=Ot(A,o,I,d,_,x,C);if(D)return!0;for(const z of I)Ot(A,o,z.children(x),d,_,x,C)&&(D=!0);return D}function Ot(A,o,d,_,x,C,I){if(d[0].overscaledZ>=C)return!1;let D=!1;for(const z of d){const $=A.getLoadedTile(z);if(!$)continue;const{fadingRole:H,fadingDirection:Z,fadingParentID:G}=$;H===oe.Base&&Z===Pe.Departing&&G||($.setCrossFadeLogic({fadingRole:oe.Base,fadingDirection:Pe.Departing,fadingParentID:o.tileID,fadeEndTime:x+I}),o.setCrossFadeLogic({fadingRole:oe.Parent,fadingDirection:Pe.Incoming,fadeEndTime:x+I})),_[z.key]=z,D=!0}return D}function Hr(A,o,d,_){const x=A.tileID;return!!A.selfFading||!A.hasData()&&!!o.has(x)&&(A.setSelfFadeLogic(d+_),!0)}function vn(A,o){var d;A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let _=o.tileID.canonical.x-A.tileID.canonical.x;const x=o.tileID.canonical.y-A.tileID.canonical.y,C=Math.pow(2,A.tileID.canonical.z),I=o.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+C)===1?_+=C:Math.abs(_-C)===1&&(_-=C)),o.dem&&A.dem&&(A.dem.backfillBorder(o.dem,_,x),!((d=A.neighboringTiles)===null||d===void 0)&&d[I]&&(A.neighboringTiles[I].backfilled=!0)))}class Ts{constructor(){this._tiles={}}handleWrapJump(o){const d={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+o),d[x.tileID.key]=x}this._tiles=d}setFeatureState(o,d){for(const _ in this._tiles)this._tiles[_].setFeatureState(o,d)}getAllTiles(){return Object.values(this._tiles)}getAllIds(o=!1){return o?Object.values(this._tiles).map((d=>d.tileID)).sort(s.aw).map((d=>d.key)):Object.keys(this._tiles)}getTileById(o){return this._tiles[o]}setTile(o,d){this._tiles[o]=d}deleteTileById(o){delete this._tiles[o]}getLoadedTile(o){const d=this.getTileById(o.key);return d?.hasData()?d:null}isIdRenderable(o,d=!1){var _;return(_=this.getTileById(o))===null||_===void 0?void 0:_.isRenderable(d)}getRenderableIds(o=0,d){const _=[];for(const x of this.getAllIds())this.isIdRenderable(x,d)&&_.push(this.getTileById(x));return d?_.sort(((x,C)=>{const I=x.tileID,D=C.tileID,z=new s.P(I.canonical.x,I.canonical.y)._rotate(-o),$=new s.P(D.canonical.x,D.canonical.y)._rotate(-o);return I.overscaledZ-D.overscaledZ||$.y-z.y||$.x-z.x})).map((x=>x.tileID.key)):_.map((x=>x.tileID)).sort(s.aw).map((x=>x.key))}}class en extends s.E{constructor(o,d,_){super(),this.id=o,this.dispatcher=_,this.on("data",(x=>this._dataHandler(x))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((x,C,I,D)=>{const z=new(Vh(C.type))(x,C,I,D);if(z.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${z.id}`);return z})(o,d,_,this),this._inViewTiles=new Ts,this._outOfViewCache=new s.ax(0,(x=>this._unloadTile(x))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new tt,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){for(const d of this._inViewTiles.getAllTiles())d.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o),this._inViewTiles=new Ts}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o of this._inViewTiles.getAllTiles())if(o.state!=="loaded"&&o.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d,_){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,d,_)}catch(x){o.state="errored",x.status!==404?this._source.fire(new s.k(x,{tile:o})):this.update(this.transform,this.terrain)}}))}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new s.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const d of this._inViewTiles.getAllTiles())d.upload(o),d.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(o){var d;return this._inViewTiles.getRenderableIds((d=this.transform)===null||d===void 0?void 0:d.bearingInRadians,o)}hasRenderableParent(o){const d=o.overscaledZ-1;if(d>=this._source.minzoom){const _=this.getLoadedTile(o.scaledTo(d));if(_)return this._inViewTiles.isIdRenderable(_.tileID.key)}return!1}reload(o,d=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const _ of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(_);d&&!this._source.shouldReloadTile(x,d)||(o?this._reloadTile(_,"expired"):x.state!=="errored"&&this._reloadTile(_,"reloading"))}}}_reloadTile(o,d){return s._(this,void 0,void 0,(function*(){const _=this._inViewTiles.getTileById(o);_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,o,d))}))}_tileLoaded(o,d,_){o.timeAdded=W(),o.selfFading&&(o.fadeEndTime=o.timeAdded+this._rasterFadeDuration),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&(function(x,C){var I,D;const z=C.getRenderableIds();for(const $ of z){if(!x.neighboringTiles||!x.neighboringTiles[$])continue;const H=C.getTileById($);x.neighboringTiles[$].backfilled||vn(x,H),!((D=(I=H.neighboringTiles)===null||I===void 0?void 0:I[x.tileID.key])===null||D===void 0)&&D.backfilled||vn(H,x)}})(o,this._inViewTiles),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:o,coord:o.tileID}))}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._inViewTiles.getTileById(o)}_retainLoadedChildren(o,d){const _=this._getLoadedDescendents(d),x=new Set;for(const C of d){const I=_[C.key];if(!I?.length){x.add(C);continue}const D=C.overscaledZ+en.maxOverzooming,z=I.filter((Z=>Z.tileID.overscaledZ<=D));if(!z.length){x.add(C);continue}const $=Math.min(...z.map((Z=>Z.tileID.overscaledZ))),H=z.filter((Z=>Z.tileID.overscaledZ===$)).map((Z=>Z.tileID));for(const Z of H)o[Z.key]=Z;this._areDescendentsComplete(H,$,C.overscaledZ)||x.add(C)}return x}_getLoadedDescendents(o){var d;const _={};for(const x of this._inViewTiles.getAllTiles().filter((C=>C.hasData())))for(const C of o)x.tileID.isChildOf(C)&&(_[d=C.key]||(_[d]=[])).push(x);return _}_areDescendentsComplete(o,d,_){return o.length===1&&o[0].isOverscaled()?o[0].overscaledZ===d:Math.pow(4,d-_)===o.length}getLoadedTile(o){return this._inViewTiles.getLoadedTile(o)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,x=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._outOfViewCache.setMaxSize(C)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);this._prevLng=o,d&&(this._inViewTiles.handleWrapJump(d),this._resetTileReloadTimers())}update(o,d){if(!this._sourceLoaded||this._paused)return;let _;this.transform=o,this.terrain=d,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map((z=>new s.a2(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y))):(_=En(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?o.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter((z=>this._source.hasTile(z))))):_=[],this.usedForTerrain&&(_=this._addTerrainIdealTiles(_));const x=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=vr(o,this._source),I=this._updateRetainedTiles(_,C),D=Nn(this._source.type);D&&this._rasterFadeDuration>0&&!d&&(function(z,$,H,Z,G,ne,le){const _e=W(),xe=s.av($);for(const be of $){const Ae=z.getTileById(be.key);Ae.fadingDirection!==Pe.Departing&&Ae.fadeOpacity!==0||Ae.resetFadeLogic(),Vi(z,Ae,H,_e,Z,G,le)||Pn(z,Ae,H,_e,ne,le)||Hr(Ae,xe,_e,le)||Ae.resetFadeLogic()}})(this._inViewTiles,_,I,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),D?this._cleanUpRasterTiles(I):this._cleanUpVectorTiles(I)}_cleanUpRasterTiles(o){for(const d of this._inViewTiles.getAllIds())o[d]||this._removeTile(d)}_cleanUpVectorTiles(o){for(const d of this._inViewTiles.getAllIds()){const _=this._inViewTiles.getTileById(d);o[d]?_.clearSymbolFadeHold():_.hasSymbolBuckets?_.holdingForSymbolFade()?_.symbolFadeFinished()&&this._removeTile(d):_.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(d)}}_addTerrainIdealTiles(o){const d=[];for(const _ of o)if(_.canonical.z>this._source.minzoom){const x=_.scaledTo(_.canonical.z-1);d.push(x);const C=_.scaledTo(Math.max(this._source.minzoom,Math.min(_.canonical.z,5)));d.push(C)}return o.concat(d)}releaseSymbolFadeTiles(){for(const o of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(o).holdingForSymbolFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){var _;const x=new Set;for(const $ of o)this._addTile($).hasData()||x.add($);const C=o.reduce((($,H)=>($[H.key]=H,$)),{}),I=this._retainLoadedChildren(C,x),D={},z=Math.max(d-en.maxUnderzooming,this._source.minzoom);for(const $ of I){let H=this._inViewTiles.getTileById($.key),Z=H?.wasRequested();for(let G=$.overscaledZ-1;G>=z;--G){const ne=$.scaledTo(G);if(D[ne.key])break;if(D[ne.key]=!0,H=this.getTile(ne),!H&&Z&&(H=this._addTile(ne)),H){const le=H.hasData();if((le||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||Z)&&(C[ne.key]=ne),Z=H.wasRequested(),le)break}}}return C}_addTile(o){let d=this._inViewTiles.getTileById(o.key);if(d)return d;d=this._outOfViewCache.getAndRemove(o),d&&(d.resetFadeLogic(),this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null));const _=d;return d||(d=new Ne(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,o.key,d.state)),d.uses++,this._inViewTiles.setTile(o.key,d),_||this._source.fire(new s.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){this._clearTileReloadTimer(o);const _=d.getExpiryTimeout();_&&(this._timers[o]=setTimeout((()=>{this._reloadTile(o,"expired"),delete this._timers[o]}),_))}_clearTileReloadTimer(o){const d=this._timers[o];d&&(clearTimeout(d),delete this._timers[o])}_resetTileReloadTimers(){for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(o);this._setTileReloadTimer(o,d)}}refreshTiles(o){for(const d of this._inViewTiles.getAllIds()){const _=this._inViewTiles.getTileById(d);(this._inViewTiles.isIdRenderable(d)||_.state=="errored")&&o.some((x=>x.equals(_.tileID.canonical)))&&this._reloadTile(d,"expired")}}_removeTile(o){const d=this._inViewTiles.getTileById(o);d&&(d.uses--,this._inViewTiles.deleteTileById(o),this._clearTileReloadTimer(o),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._outOfViewCache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(o){o.dataType==="source"&&(o.sourceDataType!=="metadata"?o.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(o.sourceDataChanged,o.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o of this._inViewTiles.getAllIds())this._removeTile(o);this._outOfViewCache.reset()}tilesIn(o,d,_){const x=[],C=this.transform;if(!C)return x;const I=C.getCoveringTilesDetailsProvider().allowWorldCopies(),D=_?C.getCameraQueryGeometry(o):o,z=ne=>C.screenPointToMercatorCoordinate(ne,this.terrain),$=this.transformBbox(o,z,!I),H=this.transformBbox(D,z,!I),Z=this.getIds(),G=s.aa.fromPoints(H);for(let ne=0;ne<Z.length;ne++){const le=this._inViewTiles.getTileById(Z[ne]);if(le.holdingForSymbolFade())continue;const _e=I?[le.tileID]:[le.tileID.unwrapTo(-1),le.tileID.unwrapTo(0)],xe=Math.pow(2,C.zoom-le.tileID.overscaledZ),be=d*le.queryPadding*s.a5/le.tileSize/xe;for(const Ae of _e){const ke=G.map((Se=>Ae.getTilePoint(new s.a9(Se.x,Se.y))));if(ke.expandBy(be),ke.intersects(Wn)){const Se=$.map((ze=>Ae.getTilePoint(ze))),De=H.map((ze=>Ae.getTilePoint(ze)));x.push({tile:le,tileID:I?Ae:Ae.unwrapTo(0),queryGeometry:Se,cameraQueryGeometry:De,scale:xe})}}}return x}transformBbox(o,d,_){let x=o.map(d);if(_){const C=s.aa.fromPoints(o);C.shrinkBy(.001*Math.min(C.width(),C.height()));const I=C.map(d);s.aa.fromPoints(x).covers(I)||(x=x.map((D=>D.x>.5?new s.a9(D.x-1,D.y,D.z):D)))}return x}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map((_=>this._inViewTiles.getTileById(_).tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){return!!this._source.hasTransition()||!(!Nn(this._source.type)||!(function(o,d){if(d<=0)return!1;const _=W();for(const x of o.getAllTiles())if(x.fadeEndTime>=_)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(o){this._rasterFadeDuration=o}setFeatureState(o,d,_){this._state.updateState(o=o||s.ai,d,_)}removeFeatureState(o,d,_){this._state.removeFeatureState(o=o||s.ai,d,_)}getFeatureState(o,d){return this._state.getState(o=o||s.ai,d)}setDependencies(o,d,_){const x=this._inViewTiles.getTileById(o);x&&x.setDependencies(d,_)}reloadTilesForDependencies(o,d){for(const _ of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(_).hasDependency(o,d)&&this._reloadTile(_,"reloading");this._outOfViewCache.filter((_=>!_.hasDependency(o,d)))}areTilesLoaded(){for(const o of this._inViewTiles.getAllTiles())if(o.state!=="loaded"&&o.state!=="errored")return!1;return!0}}en.maxUnderzooming=10,en.maxOverzooming=3;class Nt{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.an(o,0,1);let d=1,_=this._distances[d];const x=o*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];const C=d-1,I=this._distances[C],D=_-I,z=D>0?(x-I)/D:0;return this.points[C].mult(1-z).add(this.points[d].mult(z))}}function hr(A,o){let d=!0;return A==="always"||A!=="never"&&o!=="never"||(d=!1),d}class Sr{constructor(o,d,_){const x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(d/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,_,x,C){this._forEachCell(d,_,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(o,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(o,d,_,x,C,I){this.boxCells[C].push(I)}_insertCircleCell(o,d,_,x,C,I){this.circleCells[C].push(I)}_query(o,d,_,x,C,I,D){if(_<0||o>this.width||x<0||d>this.height)return[];const z=[];if(o<=0&&d<=0&&this.width<=_&&this.height<=x){if(C)return[{key:null,x1:o,y1:d,x2:_,y2:x}];for(let $=0;$<this.boxKeys.length;$++)z.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const H=this.circles[3*$],Z=this.circles[3*$+1],G=this.circles[3*$+2];z.push({key:this.circleKeys[$],x1:H-G,y1:Z-G,x2:H+G,y2:Z+G})}}else this._forEachCell(o,d,_,x,this._queryCell,z,{hitTest:C,overlapMode:I,seenUids:{box:{},circle:{}}},D);return z}query(o,d,_,x){return this._query(o,d,_,x,!1,null)}hitTest(o,d,_,x,C,I){return this._query(o,d,_,x,!0,C,I).length>0}hitTestCircle(o,d,_,x,C){const I=o-_,D=o+_,z=d-_,$=d+_;if(D<0||I>this.width||$<0||z>this.height)return!1;const H=[];return this._forEachCell(I,z,D,$,this._queryCellCircle,H,{hitTest:!0,overlapMode:x,circle:{x:o,y:d,radius:_},seenUids:{box:{},circle:{}}},C),H.length>0}_queryCell(o,d,_,x,C,I,D,z){const{seenUids:$,hitTest:H,overlapMode:Z}=D,G=this.boxCells[C];if(G!==null){const le=this.bboxes;for(const _e of G)if(!$.box[_e]){$.box[_e]=!0;const xe=4*_e,be=this.boxKeys[_e];if(o<=le[xe+2]&&d<=le[xe+3]&&_>=le[xe+0]&&x>=le[xe+1]&&(!z||z(be))&&(!H||!hr(Z,be.overlapMode))&&(I.push({key:be,x1:le[xe],y1:le[xe+1],x2:le[xe+2],y2:le[xe+3]}),H))return!0}}const ne=this.circleCells[C];if(ne!==null){const le=this.circles;for(const _e of ne)if(!$.circle[_e]){$.circle[_e]=!0;const xe=3*_e,be=this.circleKeys[_e];if(this._circleAndRectCollide(le[xe],le[xe+1],le[xe+2],o,d,_,x)&&(!z||z(be))&&(!H||!hr(Z,be.overlapMode))){const Ae=le[xe],ke=le[xe+1],Se=le[xe+2];if(I.push({key:be,x1:Ae-Se,y1:ke-Se,x2:Ae+Se,y2:ke+Se}),H)return!0}}}return!1}_queryCellCircle(o,d,_,x,C,I,D,z){const{circle:$,seenUids:H,overlapMode:Z}=D,G=this.boxCells[C];if(G!==null){const le=this.bboxes;for(const _e of G)if(!H.box[_e]){H.box[_e]=!0;const xe=4*_e,be=this.boxKeys[_e];if(this._circleAndRectCollide($.x,$.y,$.radius,le[xe+0],le[xe+1],le[xe+2],le[xe+3])&&(!z||z(be))&&!hr(Z,be.overlapMode))return I.push(!0),!0}}const ne=this.circleCells[C];if(ne!==null){const le=this.circles;for(const _e of ne)if(!H.circle[_e]){H.circle[_e]=!0;const xe=3*_e,be=this.circleKeys[_e];if(this._circlesCollide(le[xe],le[xe+1],le[xe+2],$.x,$.y,$.radius)&&(!z||z(be))&&!hr(Z,be.overlapMode))return I.push(!0),!0}}}_forEachCell(o,d,_,x,C,I,D,z){const $=this._convertToXCellCoord(o),H=this._convertToYCellCoord(d),Z=this._convertToXCellCoord(_),G=this._convertToYCellCoord(x);for(let ne=$;ne<=Z;ne++)for(let le=H;le<=G;le++)if(C.call(this,o,d,_,x,this.xCellCount*le+ne,I,D,z))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,_,x,C,I){const D=x-o,z=C-d,$=_+I;return $*$>D*D+z*z}_circleAndRectCollide(o,d,_,x,C,I,D){const z=(I-x)/2,$=Math.abs(o-(x+z));if($>z+_)return!1;const H=(D-C)/2,Z=Math.abs(d-(C+H));if(Z>H+_)return!1;if($<=z||Z<=H)return!0;const G=$-z,ne=Z-H;return G*G+ne*ne<=_*_}}function Gs(A,o,d){const _=s.N();if(!A){const{vecSouth:Z,vecEast:G}=vo(o),ne=b();ne[0]=G[0],ne[1]=G[1],ne[2]=Z[0],ne[3]=Z[1],x=ne,(H=(I=(C=ne)[0])*($=C[3])-(z=C[2])*(D=C[1]))&&(x[0]=$*(H=1/H),x[1]=-D*H,x[2]=-z*H,x[3]=I*H),_[0]=ne[0],_[1]=ne[1],_[4]=ne[2],_[5]=ne[3]}var x,C,I,D,z,$,H;return s.Q(_,_,[1/d,1/d,1]),_}function dd(A,o,d,_){if(A){const x=s.N();if(!o){const{vecSouth:C,vecEast:I}=vo(d);x[0]=I[0],x[1]=I[1],x[4]=C[0],x[5]=C[1]}return s.Q(x,x,[_,_,1]),x}return d.pixelsToClipSpaceMatrix}function vo(A){const o=Math.cos(A.rollInRadians),d=Math.sin(A.rollInRadians),_=Math.cos(A.pitchInRadians),x=Math.cos(A.bearingInRadians),C=Math.sin(A.bearingInRadians),I=s.aC();I[0]=-x*_*d-C*o,I[1]=-C*_*d+x*o;const D=s.aD(I);D<1e-9?s.aE(I):s.aF(I,I,1/D);const z=s.aC();z[0]=x*_*o-C*d,z[1]=C*_*o+x*d;const $=s.aD(z);return $<1e-9?s.aE(z):s.aF(z,z,1/$),{vecEast:z,vecSouth:I}}function Ar(A,o,d,_){let x;_?(x=[A,o,_(A,o),1],s.aH(x,x,d)):(x=[A,o,0,1],Ta(x,x,d));const C=x[3];return{point:new s.P(x[0]/C,x[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}function Pc(A,o){return .5+A/o*.5}function bo(A,o){return A.x>=-o[0]&&A.x<=o[0]&&A.y>=-o[1]&&A.y<=o[1]}function Qo(A,o,d,_,x,C,I,D,z,$,H,Z,G){const ne=d?A.textSizeData:A.iconSizeData,le=s.ay(ne,o.transform.zoom),_e=[256/o.width*2+1,256/o.height*2+1],xe=d?A.text.dynamicLayoutVertexArray:A.icon.dynamicLayoutVertexArray;xe.clear();const be=A.lineVertexArray,Ae=d?A.text.placedSymbolArray:A.icon.placedSymbolArray,ke=o.transform.width/o.transform.height;let Se=!1;for(let De=0;De<Ae.length;De++){const ze=Ae.get(De);if(ze.hidden||ze.writingMode===s.az.vertical&&!Se){To(ze.numGlyphs,xe);continue}Se=!1;const Re=new s.P(ze.anchorX,ze.anchorY),Ve={getElevation:G,pitchedLabelPlaneMatrix:_,lineVertexArray:be,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:Re,unwrappedTileID:z,width:$,height:H,translation:Z},ct=Nu(ze.anchorX,ze.anchorY,Ve);if(!bo(ct.point,_e)){To(ze.numGlyphs,xe);continue}const nt=Pc(o.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),at=s.aA(ne,le,ze),ot=C?at*o.transform.getPitchedTextCorrection(ze.anchorX,ze.anchorY,z)/nt:at*nt,Ft=Hn({projectionContext:Ve,pitchedLabelPlaneMatrixInverse:x,symbol:ze,fontSize:ot,flip:!1,keepUpright:I,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:xe,aspectRatio:ke,rotateToLine:D});Se=Ft.useVertical,(Ft.notEnoughRoom||Se||Ft.needsFlipping&&Hn({projectionContext:Ve,pitchedLabelPlaneMatrixInverse:x,symbol:ze,fontSize:ot,flip:!0,keepUpright:I,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:xe,aspectRatio:ke,rotateToLine:D}).notEnoughRoom)&&To(ze.numGlyphs,xe)}d?A.text.dynamicLayoutVertexBuffer.updateData(xe):A.icon.dynamicLayoutVertexBuffer.updateData(xe)}function xo(A,o,d,_,x,C,I,D){const z=C.glyphStartIndex+C.numGlyphs,$=C.lineStartIndex,H=C.lineStartIndex+C.lineLength,Z=o.getoffsetX(C.glyphStartIndex),G=o.getoffsetX(z-1),ne=Ya(A*Z,d,_,x,C.segment,$,H,D,I);if(!ne)return null;const le=Ya(A*G,d,_,x,C.segment,$,H,D,I);return le?D.projectionCache.anyProjectionOccluded?null:{first:ne,last:le}:null}function wo(A,o,d,_){return A===s.az.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*_?{useVertical:!0}:(A===s.az.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function Hn(A){const{projectionContext:o,pitchedLabelPlaneMatrixInverse:d,symbol:_,fontSize:x,flip:C,keepUpright:I,glyphOffsetArray:D,dynamicLayoutVertexArray:z,aspectRatio:$,rotateToLine:H}=A,Z=x/24,G=_.lineOffsetX*Z,ne=_.lineOffsetY*Z;let le;if(_.numGlyphs>1){const _e=_.glyphStartIndex+_.numGlyphs,xe=_.lineStartIndex,be=_.lineStartIndex+_.lineLength,Ae=xo(Z,D,G,ne,C,_,H,o);if(!Ae)return{notEnoughRoom:!0};const ke=Jo(Ae.first.point.x,Ae.first.point.y,o,d),Se=Jo(Ae.last.point.x,Ae.last.point.y,o,d);if(I&&!C){const De=wo(_.writingMode,ke,Se,$);if(De)return De}le=[Ae.first];for(let De=_.glyphStartIndex+1;De<_e-1;De++){const ze=Ya(Z*D.getoffsetX(De),G,ne,C,_.segment,xe,be,o,H);if(!ze)return{notEnoughRoom:!0};le.push(ze)}le.push(Ae.last)}else{if(I&&!C){const xe=Fr(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,be=_.lineStartIndex+_.segment+1,Ae=new s.P(o.lineVertexArray.getx(be),o.lineVertexArray.gety(be)),ke=Fr(Ae.x,Ae.y,o),Se=ke.signedDistanceFromCamera>0?ke.point:Lu(o.tileAnchorPoint,Ae,xe,1,o),De=Jo(xe.x,xe.y,o,d),ze=Jo(Se.x,Se.y,o,d),Re=wo(_.writingMode,De,ze,$);if(Re)return Re}const _e=Ya(Z*D.getoffsetX(_.glyphStartIndex),G,ne,C,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,o,H);if(!_e||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};le=[_e]}for(const _e of le)s.aG(z,_e.point,_e.angle);return{}}function Lu(A,o,d,_,x){const C=A.add(A.sub(o)._unit()),I=Fr(C.x,C.y,x).point,D=d.sub(I);return d.add(D._mult(_/D.mag()))}function Xi(A,o,d){const _=o.projectionCache;if(_.projections[A])return _.projections[A];const x=new s.P(o.lineVertexArray.getx(A),o.lineVertexArray.gety(A)),C=Fr(x.x,x.y,o);if(C.signedDistanceFromCamera>0)return _.projections[A]=C.point,_.anyProjectionOccluded=_.anyProjectionOccluded||C.isOccluded,C.point;const I=A-d.direction;return Lu(d.distanceFromAnchor===0?o.tileAnchorPoint:new s.P(o.lineVertexArray.getx(I),o.lineVertexArray.gety(I)),x,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,o)}function Fr(A,o,d){const _=A+d.translation[0],x=o+d.translation[1];let C;return d.pitchWithMap?(C=Ar(_,x,d.pitchedLabelPlaneMatrix,d.getElevation),C.isOccluded=!1):(C=d.transform.projectTileCoordinates(_,x,d.unwrappedTileID,d.getElevation),C.point.x=(.5*C.point.x+.5)*d.width,C.point.y=(.5*-C.point.y+.5)*d.height),C}function Jo(A,o,d,_){if(d.pitchWithMap){const x=[A,o,0,1];return s.aH(x,x,_),d.transform.projectTileCoordinates(x[0]/x[3],x[1]/x[3],d.unwrappedTileID,d.getElevation).point}return{x:A/d.width*2-1,y:1-o/d.height*2}}function Nu(A,o,d){return d.transform.projectTileCoordinates(A,o,d.unwrappedTileID,d.getElevation)}function zu(A,o,d){return A._unit()._perp()._mult(o*d)}function Dl(A,o,d,_,x,C,I,D,z){if(D.projectionCache.offsets[A])return D.projectionCache.offsets[A];const $=d.add(o);if(A+z.direction<_||A+z.direction>=x)return D.projectionCache.offsets[A]=$,$;const H=Xi(A+z.direction,D,z),Z=zu(H.sub(d),I,z.direction),G=d.add(Z),ne=H.add(Z);return D.projectionCache.offsets[A]=s.aI(C,$,G,ne)||$,D.projectionCache.offsets[A]}function Ya(A,o,d,_,x,C,I,D,z){const $=_?A-o:A+o;let H=$>0?1:-1,Z=0;_&&(H*=-1,Z=Math.PI),H<0&&(Z+=Math.PI);let G,ne=H>0?C+x:C+x+1;D.projectionCache.cachedAnchorPoint?G=D.projectionCache.cachedAnchorPoint:(G=Fr(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=G);let le,_e,xe=G,be=G,Ae=0,ke=0;const Se=Math.abs($),De=[];let ze;for(;Ae+ke<=Se;){if(ne+=H,ne<C||ne>=I)return null;Ae+=ke,be=xe,_e=le;const ct={absOffsetX:Se,direction:H,distanceFromAnchor:Ae,previousVertex:be};if(xe=Xi(ne,D,ct),d===0)De.push(be),ze=xe.sub(be);else{let nt;const at=xe.sub(be);nt=at.mag()===0?zu(Xi(ne+H,D,ct).sub(xe),d,H):zu(at,d,H),_e||(_e=be.add(nt)),le=Dl(ne,nt,xe,C,I,_e,d,D,ct),De.push(_e),ze=le.sub(_e)}ke=ze.mag()}const Re=ze._mult((Se-Ae)/ke)._add(_e||be),Ve=Z+Math.atan2(xe.y-be.y,xe.x-be.x);return De.push(Re),{point:Re,angle:z?Ve:0,path:De}}const $h=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function To(A,o){for(let d=0;d<A;d++){const _=o.length;o.resize(_+4),o.float32.set($h,3*_)}}function Ta(A,o,d){const _=o[0],x=o[1];return A[0]=d[0]*_+d[4]*x+d[12],A[1]=d[1]*_+d[5]*x+d[13],A[3]=d[3]*_+d[7]*x+d[15],A}const qr=100;class Op{constructor(o,d=new Sr(o.width+200,o.height+200,25),_=new Sr(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=_,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+qr,this.screenBottomBoundary=o.height+qr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,_,x,C,I,D,z,$,H,Z,G){const ne=this.projectAndGetPerspectiveRatio(o.anchorPointX+z[0],o.anchorPointY+z[1],C,H,G),le=_*ne.perspectiveRatio;let _e;if(I||D)_e=this._projectCollisionBox(o,le,x,C,I,D,z,ne,H,Z,G);else{const ze=ne.x+(Z?Z.x*le:0),Re=ne.y+(Z?Z.y*le:0);_e={allPointsOccluded:!1,box:[ze+o.x1*le,Re+o.y1*le,ze+o.x2*le,Re+o.y2*le]}}const[xe,be,Ae,ke]=_e.box,Se=I?_e.allPointsOccluded:ne.isOccluded;let De=Se;return De||(De=ne.perspectiveRatio<this.perspectiveRatioCutoff),De||(De=!this.isInsideGrid(xe,be,Ae,ke)),De||d!=="always"&&this.grid.hitTest(xe,be,Ae,ke,d,$)?{box:[xe,be,Ae,ke],placeable:!1,offscreen:!1,occluded:Se}:{box:[xe,be,Ae,ke],placeable:!0,offscreen:this.isOffscreen(xe,be,Ae,ke),occluded:Se}}placeCollisionCircles(o,d,_,x,C,I,D,z,$,H,Z,G,ne,le){const _e=[],xe=new s.P(d.anchorX,d.anchorY),be=this.getPerspectiveRatio(xe.x,xe.y,I,le),Ae=($?C*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,I)/be:C*be)/s.aM,ke={getElevation:le,pitchedLabelPlaneMatrix:D,lineVertexArray:_,pitchWithMap:$,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:xe,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:ne},Se=xo(Ae,x,d.lineOffsetX*Ae,d.lineOffsetY*Ae,!1,d,!1,ke);let De=!1,ze=!1,Re=!0;if(Se){const Ve=.5*Z*be+G,ct=new s.P(-100,-100),nt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),at=new Nt,ot=Se.first,Ft=Se.last;let Ut=[];for(let xr=ot.path.length-1;xr>=1;xr--)Ut.push(ot.path[xr]);for(let xr=1;xr<Ft.path.length;xr++)Ut.push(Ft.path[xr]);const Pt=2.5*Ve;if($){const xr=this.projectPathToScreenSpace(Ut,ke);Ut=xr.some((Qr=>Qr.signedDistanceFromCamera<=0))?[]:xr.map((Qr=>Qr.point))}let $t=[];if(Ut.length>0){const xr=Ut[0].clone(),Qr=Ut[0].clone();for(let _n=1;_n<Ut.length;_n++)xr.x=Math.min(xr.x,Ut[_n].x),xr.y=Math.min(xr.y,Ut[_n].y),Qr.x=Math.max(Qr.x,Ut[_n].x),Qr.y=Math.max(Qr.y,Ut[_n].y);$t=xr.x>=ct.x&&Qr.x<=nt.x&&xr.y>=ct.y&&Qr.y<=nt.y?[Ut]:Qr.x<ct.x||xr.x>nt.x||Qr.y<ct.y||xr.y>nt.y?[]:s.aJ([Ut],ct.x,ct.y,nt.x,nt.y)}for(const xr of $t){at.reset(xr,.25*Ve);let Qr=0;Qr=at.length<=.5*Ve?1:Math.ceil(at.paddedLength/Pt)+1;for(let _n=0;_n<Qr;_n++){const fn=_n/Math.max(Qr-1,1),Tn=at.lerp(fn),an=Tn.x+qr,Fn=Tn.y+qr;_e.push(an,Fn,Ve,0);const Sn=an-Ve,Ci=Fn-Ve,Zn=an+Ve,Yn=Fn+Ve;if(Re=Re&&this.isOffscreen(Sn,Ci,Zn,Yn),ze=ze||this.isInsideGrid(Sn,Ci,Zn,Yn),o!=="always"&&this.grid.hitTestCircle(an,Fn,Ve,o,H)&&(De=!0,!z))return{circles:[],offscreen:!1,collisionDetected:De}}}}return{circles:!z&&De||!ze||be<this.perspectiveRatioCutoff?[]:_e,offscreen:Re,collisionDetected:De}}projectPathToScreenSpace(o,d){const _=(function(x,C){const I=s.N();return s.aB(I,C.pitchedLabelPlaneMatrix),x.map((D=>{const z=Ar(D.x,D.y,I,C.getElevation),$=C.transform.projectTileCoordinates(z.point.x,z.point.y,C.unwrappedTileID,C.getElevation);return $.point.x=(.5*$.point.x+.5)*C.width,$.point.y=(.5*-$.point.y+.5)*C.height,$}))})(o,d);return(function(x){let C=0,I=0,D=0,z=0;for(let $=0;$<x.length;$++)x[$].isOccluded?(D=$+1,z=0):(z++,z>I&&(I=z,C=D));return x.slice(C,C+I)})(_)}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],_=new s.aa;for(const Z of o){const G=new s.P(Z.x+qr,Z.y+qr);_.extend(G),d.push(G)}const{minX:x,minY:C,maxX:I,maxY:D}=_,z=this.grid.query(x,C,I,D).concat(this.ignoredGrid.query(x,C,I,D)),$={},H={};for(const Z of z){const G=Z.key;if($[G.bucketInstanceId]===void 0&&($[G.bucketInstanceId]={}),$[G.bucketInstanceId][G.featureIndex])continue;const ne=[new s.P(Z.x1,Z.y1),new s.P(Z.x2,Z.y1),new s.P(Z.x2,Z.y2),new s.P(Z.x1,Z.y2)];s.aK(d,ne)&&($[G.bucketInstanceId][G.featureIndex]=!0,H[G.bucketInstanceId]===void 0&&(H[G.bucketInstanceId]=[]),H[G.bucketInstanceId].push(G.featureIndex))}return H}insertCollisionBox(o,d,_,x,C,I){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:C,collisionGroupID:I,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,_,x,C,I){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:x,featureIndex:C,collisionGroupID:I,overlapMode:d};for(let $=0;$<o.length;$+=4)D.insertCircle(z,o[$],o[$+1],o[$+2])}projectAndGetPerspectiveRatio(o,d,_,x,C){if(C){let I;x?(I=[o,d,x(o,d),1],s.aH(I,I,C)):(I=[o,d,0,1],Ta(I,I,C));const D=I[3];return{x:(I[0]/D+1)/2*this.transform.width+qr,y:(-I[1]/D+1)/2*this.transform.height+qr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}{const I=this.transform.projectTileCoordinates(o,d,_,x);return{x:(I.point.x+1)/2*this.transform.width+qr,y:(1-I.point.y)/2*this.transform.height+qr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(o,d,_,x){const C=this.transform.projectTileCoordinates(o,d,_,x);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(o,d,_,x){return _<qr||o>=this.screenRightBoundary||x<qr||d>this.screenBottomBoundary}isInsideGrid(o,d,_,x){return _>=0&&o<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=s.ar([]);return s.O(o,o,[-100,-100,0]),o}_projectCollisionBox(o,d,_,x,C,I,D,z,$,H,Z){let G=1,ne=0,le=0,_e=1;const xe=o.anchorPointX+D[0],be=o.anchorPointY+D[1];if(I&&!C){const Ut=this.projectAndGetPerspectiveRatio(xe+1,be,x,$,Z),Pt=Ut.x-z.x,$t=Math.atan((Ut.y-z.y)/Pt)+(Pt<0?Math.PI:0),xr=Math.sin($t),Qr=Math.cos($t);G=Qr,ne=xr,le=-xr,_e=Qr}else if(!I&&C){const Ut=vo(this.transform);G=Ut.vecEast[0],ne=Ut.vecEast[1],le=Ut.vecSouth[0],_e=Ut.vecSouth[1]}let Ae=z.x,ke=z.y,Se=d;C&&(Ae=xe,ke=be,Se=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Se*=this.transform.getPitchedTextCorrection(xe,be,x),H||(Se*=s.an(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),H&&(Ae+=G*H.x*Se+le*H.y*Se,ke+=ne*H.x*Se+_e*H.y*Se);const De=o.x1*Se,ze=o.x2*Se,Re=(De+ze)/2,Ve=o.y1*Se,ct=o.y2*Se,nt=(Ve+ct)/2,at=[{offsetX:De,offsetY:Ve},{offsetX:Re,offsetY:Ve},{offsetX:ze,offsetY:Ve},{offsetX:ze,offsetY:nt},{offsetX:ze,offsetY:ct},{offsetX:Re,offsetY:ct},{offsetX:De,offsetY:ct},{offsetX:De,offsetY:nt}];let ot=[];for(const{offsetX:Ut,offsetY:Pt}of at)ot.push(new s.P(Ae+G*Ut+le*Pt,ke+ne*Ut+_e*Pt));let Ft=!1;if(C){const Ut=ot.map((Pt=>this.projectAndGetPerspectiveRatio(Pt.x,Pt.y,x,$,Z)));Ft=Ut.some((Pt=>!Pt.isOccluded)),ot=Ut.map((Pt=>new s.P(Pt.x,Pt.y)))}else Ft=!0;return{box:s.aL(ot),allPointsOccluded:!Ft}}}class Rm{constructor(o,d,_,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Cc{constructor(o,d,_,x,C){this.text=new Rm(o?o.text:null,d,_,C),this.icon=new Rm(o?o.icon:null,d,x,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Dp{constructor(o,d,_){this.text=o,this.icon=d,this.skipFade=_}}class Wh{constructor(o,d,_,x,C){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=C}}class Om{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[o]}}function ss(A,o,d,_,x){const{horizontalAlign:C,verticalAlign:I}=s.aS(A);return new s.P(-(C-.5)*o+_[0]*x,-(I-.5)*d+_[1]*x)}class Hh{constructor(o,d,_,x,C){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new Op(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Om(x),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const d=this.terrain;return d?(_,x)=>d.getElevation(o,_,x):null}getBucketParts(o,d,_,x){const C=_.getBucket(d),I=_.latestFeatureIndex;if(!C||!I||d.id!==C.layerIds[0])return;const D=_.collisionBoxArray,z=C.layers[0].layout,$=C.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),Z=_.tileSize/s.a5,G=_.tileID.toUnwrapped(),ne=z.get("text-rotation-alignment")==="map",le=s.aN(_,1,this.transform.zoom),_e=s.aO(this.collisionIndex.transform,_,$.get("text-translate"),$.get("text-translate-anchor")),xe=s.aO(this.collisionIndex.transform,_,$.get("icon-translate"),$.get("icon-translate-anchor")),be=Gs(ne,this.transform,le);this.retainedQueryData[C.bucketInstanceId]=new Wh(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const Ae={bucket:C,layout:z,translationText:_e,translationIcon:xe,unwrappedTileID:G,pitchedLabelPlaneMatrix:be,scale:H,textPixelRatio:Z,holdingForFade:_.holdingForSymbolFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ay(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(const ke of C.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:De,symbolInstanceEnd:ze}=ke;o.push({sortKey:Se,symbolInstanceStart:De,symbolInstanceEnd:ze,parameters:Ae})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(o,d,_,x,C,I,D,z,$,H,Z,G,ne,le,_e,xe,be,Ae,ke,Se){const De=s.aP[o.textAnchor],ze=[o.textOffset0,o.textOffset1],Re=ss(De,_,x,ze,C),Ve=this.collisionIndex.placeCollisionBox(d,G,z,$,H,D,I,xe,Z.predicate,ke,Re,Se);if((!Ae||this.collisionIndex.placeCollisionBox(Ae,G,z,$,H,D,I,be,Z.predicate,ke,Re,Se).placeable)&&Ve.placeable){let ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[ne.crossTileID].anchor),ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ne.crossTileID]={textOffset:ze,width:_,height:x,anchor:De,textBoxScale:C,prevAnchor:ct},this.markUsedJustification(le,De,ne,_e),le.allowVerticalPlacement&&(this.markUsedOrientation(le,_e,ne),this.placedOrientations[ne.crossTileID]=_e),{shift:Re,placedGlyphBoxes:Ve}}}placeLayerBucketPart(o,d,_){const{bucket:x,layout:C,translationText:I,translationIcon:D,unwrappedTileID:z,pitchedLabelPlaneMatrix:$,textPixelRatio:H,holdingForFade:Z,collisionBoxArray:G,partiallyEvaluatedTextSize:ne,collisionGroup:le}=o.parameters,_e=C.get("text-optional"),xe=C.get("icon-optional"),be=s.aQ(C,"text-overlap","text-allow-overlap"),Ae=be==="always",ke=s.aQ(C,"icon-overlap","icon-allow-overlap"),Se=ke==="always",De=C.get("text-rotation-alignment")==="map",ze=C.get("text-pitch-alignment")==="map",Re=C.get("icon-text-fit")!=="none",Ve=C.get("symbol-z-order")==="viewport-y",ct=Ae&&(Se||!x.hasIconData()||xe),nt=Se&&(Ae||!x.hasTextData()||_e);!x.collisionArrays&&G&&x.deserializeCollisionBoxes(G);const at=this.retainedQueryData[x.bucketInstanceId].tileID,ot=this._getTerrainElevationFunc(at),Ft=this.transform.getFastPathSimpleProjectionMatrix(at),Ut=(Pt,$t,xr)=>{var Qr,_n;if(d[Pt.crossTileID])return;if(Z)return void(this.placements[Pt.crossTileID]=new Dp(!1,!1,!1));let fn=!1,Tn=!1,an=!0,Fn=null,Sn={box:null,placeable:!1,offscreen:null,occluded:!1},Ci={placeable:!1},Zn=null,Yn=null,Mi=null,Vo=0,$o=0,so=0;$t.textFeatureIndex?Vo=$t.textFeatureIndex:Pt.useRuntimeCollisionCircles&&(Vo=Pt.featureIndex),$t.verticalTextFeatureIndex&&($o=$t.verticalTextFeatureIndex);const Ms=$t.textBox;if(Ms){const Is=rn=>{let dn=s.az.horizontal;if(x.allowVerticalPlacement&&!rn&&this.prevPlacement){const ci=this.prevPlacement.placedOrientations[Pt.crossTileID];ci&&(this.placedOrientations[Pt.crossTileID]=ci,dn=ci,this.markUsedOrientation(x,dn,Pt))}return dn},sa=(rn,dn)=>{if(x.allowVerticalPlacement&&Pt.numVerticalGlyphVertices>0&&$t.verticalTextBox){for(const ci of x.writingModes)if(ci===s.az.vertical?(Sn=dn(),Ci=Sn):Sn=rn(),Sn&&Sn.placeable)break}else Sn=rn()},ka=Pt.textAnchorOffsetStartIndex,La=Pt.textAnchorOffsetEndIndex;if(La===ka){const rn=(dn,ci)=>{const pi=this.collisionIndex.placeCollisionBox(dn,be,H,at,z,ze,De,I,le.predicate,ot,void 0,Ft);return pi&&pi.placeable&&(this.markUsedOrientation(x,ci,Pt),this.placedOrientations[Pt.crossTileID]=ci),pi};sa((()=>rn(Ms,s.az.horizontal)),(()=>{const dn=$t.verticalTextBox;return x.allowVerticalPlacement&&Pt.numVerticalGlyphVertices>0&&dn?rn(dn,s.az.vertical):{box:null,offscreen:null}})),Is(Sn&&Sn.placeable)}else{let rn=s.aP[(_n=(Qr=this.prevPlacement)===null||Qr===void 0?void 0:Qr.variableOffsets[Pt.crossTileID])===null||_n===void 0?void 0:_n.anchor];const dn=(pi,Ud,Vd)=>{const Jl=pi.x2-pi.x1,Ym=pi.y2-pi.y1,ec=Pt.textBoxScale,$d=Re&&ke==="never"?Ud:null;let dl=null,pl=be==="never"?1:2,oo="never";rn&&pl++;for(let Wd=0;Wd<pl;Wd++){for(let Cf=ka;Cf<La;Cf++){const Mf=x.textAnchorOffsets.get(Cf);if(rn&&Mf.textAnchor!==rn)continue;const If=this.attemptAnchorPlacement(Mf,pi,Jl,Ym,ec,De,ze,H,at,z,le,oo,Pt,x,Vd,I,D,$d,ot);if(If&&(dl=If.placedGlyphBoxes,dl&&dl.placeable))return fn=!0,Fn=If.shift,dl}rn?rn=null:oo=be}return _&&!dl&&(dl={box:this.collisionIndex.placeCollisionBox(Ms,"always",H,at,z,ze,De,I,le.predicate,ot,void 0,Ft).box,offscreen:!1,placeable:!1,occluded:!1}),dl};sa((()=>dn(Ms,$t.iconBox,s.az.horizontal)),(()=>{const pi=$t.verticalTextBox;return x.allowVerticalPlacement&&(!Sn||!Sn.placeable)&&Pt.numVerticalGlyphVertices>0&&pi?dn(pi,$t.verticalIconBox,s.az.vertical):{box:null,occluded:!0,offscreen:null}})),Sn&&(fn=Sn.placeable,an=Sn.offscreen);const ci=Is(Sn&&Sn.placeable);if(!fn&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[Pt.crossTileID];pi&&(this.variableOffsets[Pt.crossTileID]=pi,this.markUsedJustification(x,pi.anchor,Pt,ci))}}}if(Zn=Sn,fn=Zn&&Zn.placeable,an=Zn&&Zn.offscreen,Pt.useRuntimeCollisionCircles&&Pt.centerJustifiedTextSymbolIndex>=0){const Is=x.text.placedSymbolArray.get(Pt.centerJustifiedTextSymbolIndex),sa=s.aA(x.textSizeData,ne,Is),ka=C.get("text-padding");Yn=this.collisionIndex.placeCollisionCircles(be,Is,x.lineVertexArray,x.glyphOffsetArray,sa,z,$,_,ze,le.predicate,Pt.collisionCircleDiameter,ka,I,ot),Yn.circles.length&&Yn.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),fn=Ae||Yn.circles.length>0&&!Yn.collisionDetected,an=an&&Yn.offscreen}if($t.iconFeatureIndex&&(so=$t.iconFeatureIndex),$t.iconBox){const Is=sa=>this.collisionIndex.placeCollisionBox(sa,ke,H,at,z,ze,De,D,le.predicate,ot,Re&&Fn?Fn:void 0,Ft);Ci&&Ci.placeable&&$t.verticalIconBox?(Mi=Is($t.verticalIconBox),Tn=Mi.placeable):(Mi=Is($t.iconBox),Tn=Mi.placeable),an=an&&Mi.offscreen}const Qc=_e||Pt.numHorizontalGlyphVertices===0&&Pt.numVerticalGlyphVertices===0,ah=xe||Pt.numIconVertices===0;Qc||ah?ah?Qc||(Tn=Tn&&fn):fn=Tn&&fn:Tn=fn=Tn&&fn;const ao=Tn&&Mi.placeable;if(fn&&Zn.placeable&&this.collisionIndex.insertCollisionBox(Zn.box,be,C.get("text-ignore-placement"),x.bucketInstanceId,Ci&&Ci.placeable&&$o?$o:Vo,le.ID),ao&&this.collisionIndex.insertCollisionBox(Mi.box,ke,C.get("icon-ignore-placement"),x.bucketInstanceId,so,le.ID),Yn&&fn&&this.collisionIndex.insertCollisionCircles(Yn.circles,be,C.get("text-ignore-placement"),x.bucketInstanceId,Vo,le.ID),_&&this.storeCollisionData(x.bucketInstanceId,xr,$t,Zn,Mi,Yn),Pt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Pt.crossTileID]=new Dp((fn||ct)&&!Zn?.occluded,(Tn||nt)&&!Mi?.occluded,an||x.justReloaded),d[Pt.crossTileID]=!0};if(Ve){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Pt=x.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let $t=Pt.length-1;$t>=0;--$t){const xr=Pt[$t];Ut(x.symbolInstances.get(xr),x.collisionArrays[xr],xr)}}else for(let Pt=o.symbolInstanceStart;Pt<o.symbolInstanceEnd;Pt++)Ut(x.symbolInstances.get(Pt),x.collisionArrays[Pt],Pt);x.justReloaded=!1}storeCollisionData(o,d,_,x,C,I){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(o)?D=this.collisionBoxArrays.get(o):(D=new Map,this.collisionBoxArrays.set(o,D)),D.has(d)?z=D.get(d):(z={text:null,icon:null},D.set(d,z)),_.textBox&&(z.text=x.box),_.iconBox&&(z.icon=C.box)}if(I){let D=this.collisionCircleArrays[o];D===void 0&&(D=this.collisionCircleArrays[o]=[]);for(let z=0;z<I.circles.length;z+=4)D.push(I.circles[z+0]-qr),D.push(I.circles[z+1]-qr),D.push(I.circles[z+2]),D.push(I.collisionDetected?1:0)}}markUsedJustification(o,d,_,x){let C;C=x===s.az.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.aR(d)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of I)D>=0&&(o.text.placedSymbolArray.get(D).crossTileID=C>=0&&D!==C?0:_.crossTileID)}markUsedOrientation(o,d,_){const x=d===s.az.horizontal||d===s.az.horizontalOnly?d:0,C=d===s.az.vertical?d:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of I)o.text.placedSymbolArray.get(D).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const x=d?d.symbolFadeChange(o):1,C=d?d.opacities:{},I=d?d.variableOffsets:{},D=d?d.placedOrientations:{};for(const z in this.placements){const $=this.placements[z],H=C[z];H?(this.opacities[z]=new Cc(H,x,$.text,$.icon),_=_||$.text!==H.text.placed||$.icon!==H.icon.placed):(this.opacities[z]=new Cc(null,x,$.text,$.icon,$.skipFade),_=_||$.text||$.icon)}for(const z in C){const $=C[z];if(!this.opacities[z]){const H=new Cc($,x,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||$.text.placed||$.icon.placed)}}for(const z in I)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=I[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const _={};for(const x of d){const C=x.getBucket(o);C&&x.latestFeatureIndex&&o.id===C.layerIds[0]&&this.updateBucketOpacities(C,x.tileID,_,x.collisionBoxArray)}}updateBucketOpacities(o,d,_,x){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const C=o.layers[0],I=C.layout,D=new Cc(null,0,!1,!1,!0),z=I.get("text-allow-overlap"),$=I.get("icon-allow-overlap"),H=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=I.get("text-rotation-alignment")==="map",G=I.get("text-pitch-alignment")==="map",ne=I.get("icon-text-fit")!=="none",le=new Cc(null,0,z&&($||!o.hasIconData()||I.get("icon-optional")),$&&(z||!o.hasTextData()||I.get("text-optional")),!0);!o.collisionArrays&&x&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(x);const _e=(be,Ae,ke)=>{for(let Se=0;Se<Ae/4;Se++)be.opacityVertexArray.emplaceBack(ke);be.hasVisibleVertices=be.hasVisibleVertices||ke!==Ic},xe=this.collisionBoxArrays.get(o.bucketInstanceId);for(let be=0;be<o.symbolInstances.length;be++){const Ae=o.symbolInstances.get(be),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:Se,crossTileID:De}=Ae;let ze=this.opacities[De];_[De]?ze=D:ze||(ze=le,this.opacities[De]=ze),_[De]=!0;const Re=Ae.numIconVertices>0,Ve=this.placedOrientations[Ae.crossTileID],ct=Ve===s.az.vertical,nt=Ve===s.az.horizontal||Ve===s.az.horizontalOnly;if(ke>0||Se>0){const ot=gd(ze.text);_e(o.text,ke,ct?Ic:ot),_e(o.text,Se,nt?Ic:ot);const Ft=ze.text.isHidden();[Ae.rightJustifiedTextSymbolIndex,Ae.centerJustifiedTextSymbolIndex,Ae.leftJustifiedTextSymbolIndex].forEach(($t=>{$t>=0&&(o.text.placedSymbolArray.get($t).hidden=Ft||ct?1:0)})),Ae.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Ae.verticalPlacedTextSymbolIndex).hidden=Ft||nt?1:0);const Ut=this.variableOffsets[Ae.crossTileID];Ut&&this.markUsedJustification(o,Ut.anchor,Ae,Ve);const Pt=this.placedOrientations[Ae.crossTileID];Pt&&(this.markUsedJustification(o,"left",Ae,Pt),this.markUsedOrientation(o,Pt,Ae))}if(Re){const ot=gd(ze.icon),Ft=!(ne&&Ae.verticalPlacedIconSymbolIndex&&ct);Ae.placedIconSymbolIndex>=0&&(_e(o.icon,Ae.numIconVertices,Ft?ot:Ic),o.icon.placedSymbolArray.get(Ae.placedIconSymbolIndex).hidden=ze.icon.isHidden()),Ae.verticalPlacedIconSymbolIndex>=0&&(_e(o.icon,Ae.numVerticalIconVertices,Ft?Ic:ot),o.icon.placedSymbolArray.get(Ae.verticalPlacedIconSymbolIndex).hidden=ze.icon.isHidden())}const at=xe&&xe.has(be)?xe.get(be):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const ot=o.collisionArrays[be];if(ot){let Ft=new s.P(0,0);if(ot.textBox||ot.verticalTextBox){let Ut=!0;if(H){const Pt=this.variableOffsets[De];Pt?(Ft=ss(Pt.anchor,Pt.width,Pt.height,Pt.textOffset,Pt.textBoxScale),Z&&Ft._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ut=!1}if(ot.textBox||ot.verticalTextBox){let Pt;ot.textBox&&(Pt=ct),ot.verticalTextBox&&(Pt=nt),pd(o.textCollisionBox.collisionVertexArray,ze.text.placed,!Ut||Pt,at.text,Ft.x,Ft.y)}}if(ot.iconBox||ot.verticalIconBox){const Ut=!!(!nt&&ot.verticalIconBox);let Pt;ot.iconBox&&(Pt=Ut),ot.verticalIconBox&&(Pt=!Ut),pd(o.iconCollisionBox.collisionVertexArray,ze.icon.placed,Pt,at.icon,ne?Ft.x:0,ne?Ft.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function pd(A,o,d,_,x,C){_&&_.length!==0||(_=[0,0,0,0]);const I=_[0]-qr,D=_[1]-qr,z=_[2]-qr,$=_[3]-qr;A.emplaceBack(o?1:0,d?1:0,x||0,C||0,I,D),A.emplaceBack(o?1:0,d?1:0,x||0,C||0,z,D),A.emplaceBack(o?1:0,d?1:0,x||0,C||0,z,$),A.emplaceBack(o?1:0,d?1:0,x||0,C||0,I,$)}const qh=Math.pow(2,25),kl=Math.pow(2,24),Dm=Math.pow(2,17),Bu=Math.pow(2,16),el=Math.pow(2,9),km=Math.pow(2,8),Mc=Math.pow(2,1);function gd(A){if(A.opacity===0&&!A.placed)return 0;if(A.opacity===1&&A.placed)return 4294967295;const o=A.placed?1:0,d=Math.floor(127*A.opacity);return d*qh+o*kl+d*Dm+o*Bu+d*el+o*km+d*Mc+o}const Ic=0;class Ll{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,_,x,C){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(I,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((D,z)=>D.sortKey-z.sortKey)));this._currentPartIndex<I.length;)if(d.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,C())return!0;return!1}}class Fu{constructor(o,d,_,x,C,I,D,z){this.placement=new Hh(o,d,I,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(o,d,_){const x=W(),C=()=>!this._forceFullPlacement&&W()-x>2;for(;this._currentPlacementIndex>=0;){const I=d[o[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=D)&&(!I.maxzoom||I.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Ll(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Cr=512/s.a5/2;class Ka{constructor(o,d,_){this.tileID=o,this.bucketInstanceId=_,this._symbolsByKey={};const x=new Map;for(let C=0;C<d.length;C++){const I=d.get(C),D=I.key,z=x.get(D);z?z.push(I):x.set(D,[I])}for(const[C,I]of x){const D={positions:I.map((z=>({x:Math.floor(z.anchorX*Cr),y:Math.floor(z.anchorY*Cr)}))),crossTileIDs:I.map((z=>z.crossTileID))};if(D.positions.length>128){const z=new s.aT(D.positions.length,16,Uint16Array);for(const{x:$,y:H}of D.positions)z.add($,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[C]=D}}getScaledCoordinates(o,d){const{x:_,y:x,z:C}=this.tileID.canonical,{x:I,y:D,z}=d.canonical,$=Cr/Math.pow(2,z-C),H=(D*s.a5+o.anchorY)*$,Z=x*s.a5*Cr;return{x:Math.floor((I*s.a5+o.anchorX)*$-_*s.a5*Cr),y:Math.floor(H-Z)}}findMatches(o,d,_){const x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let C=0;C<o.length;C++){const I=o.get(C);if(I.crossTileID)continue;const D=this._symbolsByKey[I.key];if(!D)continue;const z=this.getScaledCoordinates(I,d);if(D.index){const $=D.index.range(z.x-x,z.y-x,z.x+x,z.y+x).sort();for(const H of $){const Z=D.crossTileIDs[H];if(!_[Z]){_[Z]=!0,I.crossTileID=Z;break}}}else if(D.positions)for(let $=0;$<D.positions.length;$++){const H=D.positions[$],Z=D.crossTileIDs[$];if(Math.abs(H.x-z.x)<=x&&Math.abs(H.y-z.y)<=x&&!_[Z]){_[Z]=!0,I.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:o})=>o))}}class kp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const _ in this.indexes){const x=this.indexes[_],C={};for(const I in x){const D=x[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+d),C[D.tileID.key]=D}this.indexes[_]=C}this.lng=o}addBucket(o,d,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>o.overscaledZ)for(const D in I){const z=I[D];z.tileID.isChildOf(o)&&z.findMatches(d.symbolInstances,o,x)}else{const D=I[o.scaledTo(Number(C)).key];D&&D.findMatches(d.symbolInstances,o,x)}}for(let C=0;C<d.symbolInstances.length;C++){const I=d.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),x[I.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ka(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const _ of d.getCrossTileIDsLists())for(const x of _)delete this.usedCrossTileIDs[o][x]}removeStaleBuckets(o){let d=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const C in x)o[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[C]),delete x[C],d=!0)}return d}}class bi{constructor(){this.layerIndexes={},this.crossTileIDs=new kp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,_){let x=this.layerIndexes[o.id];x===void 0&&(x=this.layerIndexes[o.id]=new Xh);let C=!1;const I={};x.handleWrapJump(_);for(const D of d){const z=D.getBucket(o);z&&o.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,z,this.crossTileIDs)&&(C=!0),I[z.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(C=!0),C}pruneUnusedLayers(o){const d={};o.forEach((_=>{d[_]=!0}));for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}var oi="void main() {fragColor=vec4(1.0);}";const Cn={prelude:pr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:pr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:pr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:pr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:pr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pr(oi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:pr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:pr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:pr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:pr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:pr(oi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:pr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:pr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:pr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:pr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:pr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:pr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:pr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:pr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:pr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:pr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:pr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:pr(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:pr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function pr(A,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=o.match(/in ([\w]+) ([\w]+)/g),x=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=C?C.concat(x):x,D={};return{fragmentSource:A=A.replace(d,((z,$,H,Z,G)=>(D[G]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${H} ${Z} ${G};
#else
uniform ${H} ${Z} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${H} ${Z} ${G} = u_${G};
#endif
`))),vertexSource:o=o.replace(d,((z,$,H,Z,G)=>{const ne=Z==="float"?"vec2":"vec4",le=G.match(/color/)?"color":ne;return D[G]?$==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${H} ${ne} a_${G};
out ${H} ${Z} ${G};
#else
uniform ${H} ${Z} u_${G};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${H} ${Z} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${le}(a_${G}, u_${G}_t);
#else
    ${H} ${Z} ${G} = u_${G};
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${H} ${ne} a_${G};
#else
uniform ${H} ${Z} u_${G};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${H} ${Z} ${G} = a_${G};
#else
    ${H} ${Z} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${H} ${Z} ${G} = unpack_mix_${le}(a_${G}, u_${G}_t);
#else
    ${H} ${Z} ${G} = u_${G};
#endif
`})),staticAttributes:_,staticUniforms:I}}class un{constructor(o,d,_){this.vertexBuffer=o,this.indexBuffer=d,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Sa=s.aU([{name:"a_pos",type:"Int16",components:2}]);const qn="#define PROJECTION_MERCATOR",as="mercator";class xi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return as}get shaderDefine(){return qn}get shaderPreludeCode(){return Cn.projectionMercator}get vertexShaderPreludeCode(){return Cn.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,d,_,x,C){if(this._cachedMesh)return this._cachedMesh;const I=new s.aW;I.emplaceBack(0,0),I.emplaceBack(s.a5,0),I.emplaceBack(0,s.a5),I.emplaceBack(s.a5,s.a5);const D=o.createVertexBuffer(I,Sa.members),z=s.aX.simpleSegment(0,0,4,2),$=new s.aY;$.emplaceBack(1,0,2),$.emplaceBack(1,2,3);const H=o.createIndexBuffer($);return this._cachedMesh=new un(D,H,z),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}class Zs{constructor(o=0,d=0,_=0,x=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=_,this.right=x}interpolate(o,d,_){return d.top!=null&&o.top!=null&&(this.top=s.G.number(o.top,d.top,_)),d.bottom!=null&&o.bottom!=null&&(this.bottom=s.G.number(o.bottom,d.bottom,_)),d.left!=null&&o.left!=null&&(this.left=s.G.number(o.left,d.left,_)),d.right!=null&&o.right!=null&&(this.right=s.G.number(o.right,d.right,_)),this}getCenter(o,d){const _=s.an((this.left+o-this.right)/2,0,o),x=s.an((this.top+d-this.bottom)/2,0,d);return new s.P(_,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function So(A,o){if(!A.renderWorldCopies||A.lngRange)return;const d=o.lng-A.center.lng;o.lng+=d>180?-360:d<-180?360:0}function Mn(A){return Math.max(0,Math.floor(A))}class Nl{constructor(o,d){var _;this.applyConstrain=(x,C)=>this._constrainOverride!==null?this._constrainOverride(x,C):this._callbacks.defaultConstrain(x,C),this._callbacks=o,this._tileSize=512,this._renderWorldCopies=d?.renderWorldCopies===void 0||!!d?.renderWorldCopies,this._minZoom=d?.minZoom||0,this._maxZoom=d?.maxZoom||22,this._minPitch=d?.minPitch==null?0:d?.minPitch,this._maxPitch=d?.maxPitch==null?60:d?.maxPitch,this._constrainOverride=(_=d?.constrainOverride)!==null&&_!==void 0?_:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Mn(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Zs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,d,_){this._constrainOverride=o.constrainOverride,this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=Mn(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new Zs(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!_&&o.autoCalculateNearFarZ,d&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get constrainOverride(){return this._constrainOverride}setConstrainOverride(o){o===void 0&&(o=null),this._constrainOverride!==o&&(this._constrainOverride=o,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){const d=s.W(o,-180,180)*Math.PI/180;var _,x,C,I,D,z,$,H,Z;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=b(),_=this._rotationMatrix,C=-this._bearingInRadians,I=(x=this._rotationMatrix)[0],D=x[1],z=x[2],$=x[3],H=Math.sin(C),Z=Math.cos(C),_[0]=I*Z+z*H,_[1]=D*Z+$*H,_[2]=I*-H+z*Z,_[3]=D*-H+$*Z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){const d=s.an(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){const d=o/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aZ(this._fovInRadians)}setFov(o){o=s.an(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=s.ap(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){const d=this.applyConstrain(this._center,o).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=s.aq(d),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,d){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,_){this._unmodified=!1,this._edgeInsets.interpolate(o,d,_),this.constrainInternal(),this._calcMatrices()}resize(o,d,_=!0){this._width=o,this._height=d,_&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Yr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ao,s.ao])}getCameraQueryGeometry(o,d){if(d.length===1)return[d[0],o];{const{minX:_,minY:x,maxX:C,maxY:I}=s.aa.fromPoints(d).extend(o);return[new s.P(_,x),new s.P(C,x),new s.P(C,I),new s.P(_,I),new s.P(_,x)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:d,zoom:_}=this.applyConstrain(this.center,this.zoom);this.setCenter(d),this.setZoom(_),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=s.ar(new Float64Array(16));s.Q(o,o,[this._width/2,-this._height/2,1]),s.O(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=s.ar(new Float64Array(16)),s.Q(o,o,[1,-1,1]),s.O(o,o,[-1,-1,0]),s.Q(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,d,_,x){const C=_!==void 0?_:this.bearing,I=x=x!==void 0?x:this.pitch,{distanceToCenter:D,clampedElevation:z}=this._distanceToCenterFromAltElevationPitch(d,this.elevation,I),{x:$,y:H}=Qt(I,C),Z=s.a9.fromLngLat(o,d);let G,ne,le=s.a_(1,Z.y),_e=0;do{if(_e+=1,_e>10)break;ne=D/le,G=new s.a9(Z.x+$*ne,Z.y+H*ne),le=1/G.meterInMercatorCoordinateUnits()}while(Math.abs(D-ne*le)>1e-12);return{center:G.toLngLat(),elevation:z,zoom:s.at(this.height/2/Math.tan(this.fovInRadians/2)/ne/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;const d=1/this.worldSize,_=s.as(1,this.center.lat)*this.worldSize,x=s.a9.fromLngLat(this.center,this.elevation),C=x.x/d,I=x.y/d,D=x.z/d,z=this.pitch,$=this.bearing,{x:H,y:Z,z:G}=Qt(z,$),ne=this.cameraToCenterDistance,le=C+ne*-H,_e=I+ne*-Z,xe=D+ne*G,{distanceToCenter:be,clampedElevation:Ae}=this._distanceToCenterFromAltElevationPitch(xe/_,o,z),ke=be*_,Se=new s.a9((le+H*ke)*d,(_e+Z*ke)*d,0).toLngLat(),De=s.as(1,Se.lat),ze=s.at(this.height/2/Math.tan(this.fovInRadians/2)/be/De/this.tileSize);this._elevation=Ae,this._center=Se,this.setZoom(ze)}_distanceToCenterFromAltElevationPitch(o,d,_){const x=-Math.cos(s.ap(_)),C=o-d;let I,D=d;return x*C>=0||Math.abs(x)<.1?(I=1e4,D=o+I*x):I=-C/x,{distanceToCenter:I,clampedElevation:D}}getCameraPoint(){const o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const o=s.as(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];const d=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/d,o.canonical.y/d,1/d/s.a5,1/d/s.a5]}}class Ys{constructor(o,d){this.min=o,this.max=d,this.center=s.a$([],s.b0([],this.min,this.max),.5)}quadrant(o){const d=[o%2==0,o<2],_=s.b1(this.min),x=s.b1(this.max);for(let C=0;C<d.length;C++)_[C]=d[C]?this.min[C]:this.center[C],x[C]=d[C]?this.center[C]:this.max[C];return x[2]=this.max[2],new Ys(_,x)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let d=!0;for(let _=0;_<o.planes.length;_++){const x=this.intersectsPlane(o.planes[_]);if(x===0)return 0;x===1&&(d=!1)}return d?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let d=o[3],_=o[3];for(let x=0;x<3;x++)o[x]>0?(d+=o[x]*this.min[x],_+=o[x]*this.max[x]):(_+=o[x]*this.min[x],d+=o[x]*this.max[x]);return d>=0?2:_<0?0:1}}class Rc{distanceToTile2d(o,d,_,x){const C=x.distanceX([o,d]),I=x.distanceY([o,d]);return Math.hypot(C,I)}getWrap(o,d,_){return _}getTileBoundingVolume(o,d,_,x){var C,I;let D=0,z=0;if(x?.terrain){const H=new s.a2(o.z,d,o.z,o.x,o.y),Z=x.terrain.getMinMaxElevation(H);D=(C=Z.minElevation)!==null&&C!==void 0?C:Math.min(0,_),z=(I=Z.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}const $=1<<o.z;return new Ys([d+o.x/$,o.y/$,D],[d+(o.x+1)/$,(o.y+1)/$,z])}allowVariableZoom(o,d){const _=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,x=s.an(78.5-_/2,0,60);return!!d.terrain||o.pitch>x}allowWorldCopies(){return!0}prepareNextFrame(){}}class os{constructor(o,d,_){this.points=o,this.planes=d,this.aabb=_}static fromInvProjectionMatrix(o,d=1,_=0,x,C){const I=C?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],D=Math.pow(2,_),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((G=>(function(ne,le,_e,xe){const be=s.aH([],ne,le),Ae=1/be[3]/_e*xe;return s.b6(be,be,[Ae,Ae,1/be[3],Ae])})(G,o,d,D)));x&&(function(G,ne,le,_e){const xe=_e?4:0,be=_e?0:4;let Ae=0;const ke=[],Se=[];for(let Re=0;Re<4;Re++){const Ve=s.b2([],G[Re+be],G[Re+xe]),ct=s.b7(Ve);s.a$(Ve,Ve,1/ct),ke.push(ct),Se.push(Ve)}for(let Re=0;Re<4;Re++){const Ve=s.b8(G[Re+xe],Se[Re],le);Ae=Ve!==null&&Ve>=0?Math.max(Ae,Ve):Math.max(Ae,ke[Re])}const De=(function(Re,Ve){const ct=s.b2([],Re[Ve[0]],Re[Ve[1]]),nt=s.b2([],Re[Ve[2]],Re[Ve[1]]),at=[0,0,0,0];return s.b3(at,s.b4([],ct,nt)),at[3]=-s.b5(at,Re[Ve[0]]),at})(G,ne),ze=(function(Re,Ve){const ct=s.b9(Re),nt=s.ba([],Re,1/ct),at=s.b2([],Ve,s.a$([],nt,s.b5(Ve,nt))),ot=s.b9(at);if(ot>0){const Ft=Math.sqrt(1-nt[3]*nt[3]),Ut=s.a$([],nt,-nt[3]),Pt=s.b0([],Ut,s.a$([],at,Ft/ot));return s.bb(Ve,Pt)}return null})(le,De);if(ze!==null){const Re=ze/s.b5(Se[0],De);Ae=Math.min(Ae,Re)}for(let Re=0;Re<4;Re++){const Ve=Math.min(Ae,ke[Re]);G[Re+be]=[G[Re+xe][0]+Se[Re][0]*Ve,G[Re+xe][1]+Se[Re][1]*Ve,G[Re+xe][2]+Se[Re][2]*Ve,1]}})(z,I[0],x,C);const $=I.map((G=>{const ne=s.b2([],z[G[0]],z[G[1]]),le=s.b2([],z[G[2]],z[G[1]]),_e=s.b3([],s.b4([],ne,le)),xe=-s.b5(_e,z[G[1]]);return _e.concat(xe)})),H=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],Z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const G of z)for(let ne=0;ne<3;ne++)H[ne]=Math.min(H[ne],G[ne]),Z[ne]=Math.max(Z[ne],G[ne]);return new os(z,$,new Ys(H,Z))}}class di{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,_){return this._helper.interpolatePadding(o,d,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d,_=!0){this._helper.resize(o,d,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,d){}constructor(o){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(d,_)=>{_=s.an(+_,this.minZoom,this.maxZoom);const x={center:new s.V(d.lng,d.lat),zoom:_};let C=this._helper._lngRange;if(!this._helper._renderWorldCopies&&C===null){const Se=179.9999999999;C=[-Se,Se]}const I=this.tileSize*s.aq(x.zoom);let D=0,z=I,$=0,H=I,Z=0,G=0;const{x:ne,y:le}=this.size;if(this._helper._latRange){const Se=this._helper._latRange;D=s.X(Se[1])*I,z=s.X(Se[0])*I,z-D<le&&(Z=le/(z-D))}C&&($=s.W(s.Y(C[0])*I,0,I),H=s.W(s.Y(C[1])*I,0,I),H<$&&(H+=I),H-$<ne&&(G=ne/(H-$)));const{x:_e,y:xe}=qe(I,d);let be,Ae;const ke=Math.max(G||0,Z||0);if(ke){const Se=new s.P(G?(H+$)/2:_e,Z?(z+D)/2:xe);return x.center=et(I,Se).wrap(),x.zoom+=s.at(ke),x}if(this._helper._latRange){const Se=le/2;xe-Se<D&&(Ae=D+Se),xe+Se>z&&(Ae=z-Se)}if(C){const Se=($+H)/2;let De=_e;this._helper._renderWorldCopies&&(De=s.W(_e,Se-I/2,Se+I/2));const ze=ne/2;De-ze<$&&(be=$+ze),De+ze>H&&(be=H-ze)}if(be!==void 0||Ae!==void 0){const Se=new s.P(be??_e,Ae??xe);x.center=et(I,Se).wrap()}return x},this.applyConstrain=(d,_)=>this._helper.applyConstrain(d,_),this._helper=new Nl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,_)=>this.defaultConstrain(d,_)},o),this._coveringTilesDetailsProvider=new Rc}clone(){const o=new di;return o.apply(this,!1),o}apply(o,d,_){this._helper.apply(o,d,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){const d=[new s.bc(0,o)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new s.P(0,0)),x=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),C=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),D=Math.floor(Math.min(_.x,x.x,C.x,I.x)),z=Math.floor(Math.max(_.x,x.x,C.x,I.x)),$=1;for(let H=D-$;H<=z+$;H++)H!==0&&d.push(new s.bc(H,o))}return d}getCameraFrustum(){return os.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){const d=this.screenPointToLocation(this.centerPoint,o),_=o?o.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(o,d){const _=s.as(this.elevation,this.center.lat),x=this.screenPointToMercatorCoordinateAtZ(d,_),C=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),I=s.a9.fromLngLat(o),D=new s.a9(I.x-(x.x-C.x),I.y-(x.y-C.y));this.setCenter(D?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,d){return d?this.coordinatePoint(s.a9.fromLngLat(o),d.getElevationForLngLat(o,this),this._pixelMatrix3D):this.coordinatePoint(s.a9.fromLngLat(o))}screenPointToLocation(o,d){var _;return(_=this.screenPointToMercatorCoordinate(o,d))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(o,d){if(d){const _=d.pointCoordinate(o);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,d){const _=d||0,x=[o.x,o.y,0,1],C=[o.x,o.y,1,1];s.aH(x,x,this._pixelMatrixInverse),s.aH(C,C,this._pixelMatrixInverse);const I=x[3],D=C[3],z=x[1]/I,$=C[1]/D,H=x[2]/I,Z=C[2]/D,G=H===Z?0:(_-H)/(Z-H);return new s.a9(s.G.number(x[0]/I,C[0]/D,G)/this.worldSize,s.G.number(z,$,G)/this.worldSize,_)}coordinatePoint(o,d=0,_=this._pixelMatrix){const x=[o.x*this.worldSize,o.y*this.worldSize,d,1];return s.aH(x,x,_),new s.P(x[0]/x[3],x[1]/x[3])}getBounds(){const o=Math.max(0,this._helper._height/2-Ct(this));return new Yr().extend(this.screenPointToLocation(new s.P(0,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(o,d){return d?d.pointCoordinate(o)!=null:o.y>this.height/2-Ct(this)}calculatePosMatrix(o,d=!1,_){var x;const C=(x=o.key)!==null&&x!==void 0?x:s.bd(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),I=d?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(C)){const $=I.get(C);return _?$.f32:$.f64}const D=mt(o,this.worldSize);s.S(D,d?this._alignedProjMatrix:this._viewProjMatrix,D);const z={f64:D,f32:new Float32Array(D)};return I.set(C,z),_?z.f32:z.f64}calculateFogMatrix(o){const d=o.key,_=this._fogMatrixCacheF32;if(_.has(d))return _.get(d);const x=mt(o,this.worldSize);return s.S(x,this._fogMatrix,x),_.set(d,new Float32Array(x)),_.get(d)}calculateCenterFromCameraLngLatAlt(o,d,_,x){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,_,x)}_calculateNearFarZIfNeeded(o,d,_){if(!this._helper.autoCalculateNearFarZ)return;const x=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),C=o-x*this._helper._pixelPerMeter/Math.cos(d),I=x<0?C:o,D=Math.PI/2+this.pitchInRadians,z=s.ap(this.fov)*(Math.abs(Math.cos(s.ap(this.roll)))*this.height+Math.abs(Math.sin(s.ap(this.roll)))*this.width)/this.height*(.5+_.y/this.height),$=Math.sin(z)*I/Math.sin(s.an(Math.PI-D-z,.01,Math.PI-.01)),H=Ct(this),Z=Math.atan(H/this._helper.cameraToCenterDistance),G=s.ap(.75),ne=Z>G?2*Z*(.5+_.y/(2*H)):G,le=Math.sin(ne)*I/Math.sin(s.an(Math.PI-D-ne,.01,Math.PI-.01)),_e=Math.min($,le);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*_e+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const o=this.centerOffset,d=qe(this.worldSize,this.center),_=d.x,x=d.y;this._helper._pixelPerMeter=s.as(1,this.center.lat)*this.worldSize;const C=s.ap(Math.min(this.pitch,Je)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(C));let D;this._calculateNearFarZIfNeeded(I,C,o),D=new Float64Array(16),s.be(D,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aB(this._invProjMatrix,D),D[8]=2*-o.x/this._helper._width,D[9]=2*o.y/this._helper._height,this._projectionMatrix=s.bf(D),s.Q(D,D,[1,-1,1]),s.O(D,D,[0,0,-this._helper.cameraToCenterDistance]),s.bg(D,D,-this.rollInRadians),s.bh(D,D,this.pitchInRadians),s.bg(D,D,-this.bearingInRadians),s.O(D,D,[-_,-x,0]),this._mercatorMatrix=s.Q([],D,[this.worldSize,this.worldSize,this.worldSize]),s.Q(D,D,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,D),s.O(D,D,[0,0,-this.elevation]),this._viewProjMatrix=D,this._invViewProjMatrix=s.aB([],D);const z=[0,0,-1,1];s.aH(z,z,this._invViewProjMatrix),this._cameraPosition=[z[0]/z[3],z[1]/z[3],z[2]/z[3]],this._fogMatrix=new Float64Array(16),s.be(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-_,-x,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,D);const $=this._helper._width%2/2,H=this._helper._height%2/2,Z=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),ne=_-Math.round(_)+Z*$+G*H,le=x-Math.round(x)+Z*H+G*$,_e=new Float64Array(D);if(s.O(_e,_e,[ne>.5?ne-1:ne,le>.5?le-1:le,0]),this._alignedProjMatrix=_e,D=s.aB(new Float64Array(16),this._pixelMatrix),!D)throw new Error("failed to invert matrix");this._pixelMatrixInverse=D,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const o=this.screenPointToMercatorCoordinate(new s.P(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return s.aH(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const o=s.as(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,d){const _=s.a9.fromLngLat(o),x=[_.x*this.worldSize,_.y*this.worldSize,d,1];return s.aH(x,x,this._viewProjMatrix),x[2]/x[3]}getProjectionData(o){const{overscaledTileID:d,aligned:_,applyTerrainMatrix:x}=o,C=this._helper.getMercatorTileCoordinates(d),I=d?this.calculatePosMatrix(d,_,!0):null;let D;return D=d&&d.terrainRttPosMatrix32f&&x?d.terrainRttPosMatrix32f:I||s.bi(),{mainMatrix:D,tileMercatorCoords:C,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:D}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,d,_){return 1}transformLightDirection(o){return s.b1(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,d,_,x){const C=this.calculatePosMatrix(_);let I;x?(I=[o,d,x(o,d),1],s.aH(I,I,C)):(I=[o,d,0,1],Ta(I,I,C));const D=I[3];return{point:new s.P(I[0]/D,I[1]/D),signedDistanceFromCamera:D,isOccluded:!1}}populateCache(o){for(const d of o)this.calculatePosMatrix(d)}getMatrixForModel(o,d){const _=s.a9.fromLngLat(o,d),x=_.meterInMercatorCoordinateUnits(),C=s.bj();return s.O(C,C,[_.x,_.y,_.z]),s.bg(C,C,Math.PI),s.bh(C,C,Math.PI/2),s.Q(C,C,[-x,x,x]),C}getProjectionDataForCustomLayer(o=!0){const d=new s.a2(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:o}),x=mt(d,this.worldSize);s.S(x,this._viewProjMatrix,x),_.tileMercatorCoords=[0,0,1,1];const C=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],I=s.bk();return s.Q(I,x,C),_.fallbackMatrix=I,_.mainMatrix=I,_}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function ls(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Gh(A){if(A.useSlerp)if(A.k<1){const o=s.bl(A.startEulerAngles.roll,A.startEulerAngles.pitch,A.startEulerAngles.bearing),d=s.bl(A.endEulerAngles.roll,A.endEulerAngles.pitch,A.endEulerAngles.bearing),_=new Float64Array(4);s.bm(_,o,d,A.k);const x=s.bn(_);A.tr.setRoll(x.roll),A.tr.setPitch(x.pitch),A.tr.setBearing(x.bearing)}else A.tr.setRoll(A.endEulerAngles.roll),A.tr.setPitch(A.endEulerAngles.pitch),A.tr.setBearing(A.endEulerAngles.bearing);else A.tr.setRoll(s.G.number(A.startEulerAngles.roll,A.endEulerAngles.roll,A.k)),A.tr.setPitch(s.G.number(A.startEulerAngles.pitch,A.endEulerAngles.pitch,A.k)),A.tr.setBearing(s.G.number(A.startEulerAngles.bearing,A.endEulerAngles.bearing,A.k))}function Oc(A,o,d,_,x){const C=x.padding,I=qe(x.worldSize,d.getNorthWest()),D=qe(x.worldSize,d.getNorthEast()),z=qe(x.worldSize,d.getSouthEast()),$=qe(x.worldSize,d.getSouthWest()),H=s.ap(-_),Z=I.rotate(H),G=D.rotate(H),ne=z.rotate(H),le=$.rotate(H),_e=new s.P(Math.max(Z.x,G.x,le.x,ne.x),Math.max(Z.y,G.y,le.y,ne.y)),xe=new s.P(Math.min(Z.x,G.x,le.x,ne.x),Math.min(Z.y,G.y,le.y,ne.y)),be=_e.sub(xe),Ae=(x.width-(C.left+C.right+o.left+o.right))/be.x,ke=(x.height-(C.top+C.bottom+o.top+o.bottom))/be.y;if(ke<0||Ae<0)return void ls();const Se=Math.min(s.at(x.scale*Math.min(Ae,ke)),A.maxZoom),De=s.P.convert(A.offset),ze=new s.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(s.ap(_)),Re=De.add(ze).mult(x.scale/s.aq(Se));return{center:et(x.worldSize,I.add(z).div(2).sub(Re)),zoom:Se,bearing:_}}class Dc{get useGlobeControls(){return!1}handlePanInertia(o,d){const _=o.mag(),x=Math.abs(Ct(d));return{easingOffset:o.mult(Math.min(.75*x/_,1)),easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(o,d){o.bearingDelta&&d.setBearing(d.bearing+o.bearingDelta),o.pitchDelta&&d.setPitch(d.pitch+o.pitchDelta),o.rollDelta&&d.setRoll(d.roll+o.rollDelta),o.zoomDelta&&d.setZoom(d.zoom+o.zoomDelta)}handleMapControlsPan(o,d,_){o.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(_,o.around)}cameraForBoxAndBearing(o,d,_,x,C){return Oc(o,d,_,x,C)}handleJumpToCenterZoom(o,d){o.zoom!==(d.zoom!==void 0?+d.zoom:o.zoom)&&o.setZoom(+d.zoom),d.center!==void 0&&o.setCenter(s.V.convert(d.center))}handleEaseTo(o,d){const _=o.zoom,x=o.padding,C={roll:o.roll,pitch:o.pitch,bearing:o.bearing},I={roll:d.roll===void 0?o.roll:d.roll,pitch:d.pitch===void 0?o.pitch:d.pitch,bearing:d.bearing===void 0?o.bearing:d.bearing},D=d.zoom!==void 0,z=!o.isPaddingEqual(d.padding);let $=!1;const H=D?+d.zoom:o.zoom;let Z=o.centerPoint.add(d.offsetAsPoint);const G=o.screenPointToLocation(Z),{center:ne,zoom:le}=o.applyConstrain(s.V.convert(d.center||G),H??_);So(o,ne);const _e=qe(o.worldSize,G),xe=qe(o.worldSize,ne).sub(_e),be=s.aq(le-_);return $=le!==_,{easeFunc:Ae=>{if($&&o.setZoom(s.G.number(_,le,Ae)),s.bo(C,I)||Gh({startEulerAngles:C,endEulerAngles:I,tr:o,k:Ae,useSlerp:C.roll!=I.roll}),z&&(o.interpolatePadding(x,d.padding,Ae),Z=o.centerPoint.add(d.offsetAsPoint)),d.around)o.setLocationAtPoint(d.around,d.aroundPoint);else{const ke=s.aq(o.zoom-_),Se=le>_?Math.min(2,be):Math.max(.5,be),De=Math.pow(Se,1-Ae),ze=et(o.worldSize,_e.add(xe.mult(Ae*De)).mult(ke));o.setLocationAtPoint(o.renderWorldCopies?ze.wrap():ze,Z)}},isZooming:$,elevationCenter:ne}}handleFlyTo(o,d){const _=d.zoom!==void 0,x=o.zoom,C=o.applyConstrain(s.V.convert(d.center||d.locationAtOffset),_?+d.zoom:x),I=C.center,D=C.zoom;So(o,I);const z=qe(o.worldSize,d.locationAtOffset),$=qe(o.worldSize,I).sub(z),H=$.mag(),Z=s.aq(D-x);let G;if(d.minZoom!==void 0){const ne=Math.min(+d.minZoom,x,D),le=o.applyConstrain(I,ne).zoom;G=s.aq(le-x)}return{easeFunc:(ne,le,_e,xe)=>{o.setZoom(ne===1?D:x+s.at(le));const be=ne===1?I:et(o.worldSize,z.add($.mult(_e)).mult(le));o.setLocationAtPoint(o.renderWorldCopies?be.wrap():be,xe)},scaleOfZoom:Z,targetCenter:I,scaleOfMinZoom:G,pixelPathLength:H}}}class sn{constructor(o,d,_){this.blendFunction=o,this.blendColor=d,this.mask=_}}sn.Replace=[1,0],sn.disabled=new sn(sn.Replace,s.bp.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,s.bp.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,771],s.bp.transparent,[!0,!0,!0,!0]);const zl=2305;class kr{constructor(o,d,_){this.enable=o,this.mode=d,this.frontFace=_}}kr.disabled=new kr(!1,1029,zl),kr.backCCW=new kr(!0,1029,zl),kr.frontCCW=new kr(!0,1028,zl);class Er{constructor(o,d,_){this.func=o,this.mask=d,this.range=_}}Er.ReadOnly=!1,Er.ReadWrite=!0,Er.disabled=new Er(519,Er.ReadOnly,[0,1]);const kc=7680;class jr{constructor(o,d,_,x,C,I){this.test=o,this.ref=d,this.mask=_,this.fail=x,this.depthFail=C,this.pass=I}}jr.disabled=new jr({func:519,mask:0},0,0,kc,kc,kc);const Zh=new WeakMap;function Aa(A){var o;if(Zh.has(A))return Zh.get(A);{const d=(o=A.getParameter(A.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Zh.set(A,d),d}}class Bl{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;const d=o.context,_=d.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const x=new s.aW;x.emplaceBack(-1,-1),x.emplaceBack(2,-1),x.emplaceBack(-1,2);const C=new s.aY;C.emplaceBack(0,1,2),this._fullscreenTriangle=new un(d.createVertexBuffer(x,Sa.members),d.createIndexBuffer(C),s.aX.simpleSegment(0,0,x.length,C.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(_.TEXTURE1);const I=_.createTexture();_.bindTexture(_.TEXTURE_2D,I),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),Aa(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,d){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const o=this._cachedRenderContext.context,d=o.gl;o.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,d){const _=this._cachedRenderContext.context,x=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:s.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,x.TRIANGLES,Er.disabled,jr.disabled,sn.unblended,kr.disabled,((C,I)=>({u_input:C,u_output_expected:I}))(o,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Aa(x)){x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.readBuffer(x.COLOR_ATTACHMENT0),x.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null);const C=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0);x.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:C}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Aa(o)){const d=o.clientWaitSync(this._readbackQueue.sync,0,0);if(d===o.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Bl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let d=0;return d+=o[0]/256,d+=o[1]/65536,d+=o[2]/16777216,o[3]<127&&(d=-d),d/128}}const Fl=s.a5/128;function Lm(A,o){const d=A.granularity!==void 0?Math.max(A.granularity,1):1,_=d+(A.generateBorders?2:0),x=d+(A.extendToNorthPole||A.generateBorders?1:0)+(A.extendToSouthPole||A.generateBorders?1:0),C=_+1,I=x+1,D=A.generateBorders?-1:0,z=A.generateBorders||A.extendToNorthPole?-1:0,$=d+(A.generateBorders?1:0),H=d+(A.generateBorders||A.extendToSouthPole?1:0),Z=C*I,G=_*x*6,ne=C*I>65536;if(ne&&o==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const le=ne||o==="32bit",_e=new Int16Array(2*Z);let xe=0;for(let ke=z;ke<=H;ke++)for(let Se=D;Se<=$;Se++){let De=Se/d*s.a5;Se===-1&&(De=-Fl),Se===d+1&&(De=s.a5+Fl);let ze=ke/d*s.a5;ke===-1&&(ze=A.extendToNorthPole?s.br:-Fl),ke===d+1&&(ze=A.extendToSouthPole?s.bs:s.a5+Fl),_e[xe++]=De,_e[xe++]=ze}const be=le?new Uint32Array(G):new Uint16Array(G);let Ae=0;for(let ke=0;ke<x;ke++)for(let Se=0;Se<_;Se++){const De=Se+1+ke*C,ze=Se+(ke+1)*C,Re=Se+1+(ke+1)*C;be[Ae++]=Se+ke*C,be[Ae++]=ze,be[Ae++]=De,be[Ae++]=De,be[Ae++]=ze,be[Ae++]=Re}return{vertices:_e.buffer.slice(0),indices:be.buffer.slice(0),uses32bitIndices:le}}const Yh=new s.aV({fill:new s.bt(128,2),line:new s.bt(512,0),tile:new s.bt(128,32),stencil:new s.bt(128,1),circle:3});class Lp{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Cn.projectionGlobe}get vertexShaderPreludeCode(){return Cn.projectionMercator.vertexSource}get subdivisionGranularity(){return Yh}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new Bl(o));const d=s.X(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,x=this._errorMeasurement.updateErrorLoop(d,_),C=W();x!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=x,this._errorMeasurementLastChangeTime=C);const I=Math.min(Math.max((C-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bv(I))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,d,_,x,C){const I=(C==="stencil"?Yh.stencil:Yh.tile).getGranularityForZoomLevel(d.z);return this._getMesh(o,{granularity:I,generateBorders:_,extendToNorthPole:d.y===0&&x,extendToSouthPole:d.y===(1<<d.z)-1&&x})}_getMesh(o,d){const _=this._getMeshKey(d);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const x=(function(C,I){const D=Lm(I,"16bit"),z=s.aW.deserialize({arrayBuffer:D.vertices,length:D.vertices.byteLength/2/2}),$=s.aY.deserialize({arrayBuffer:D.indices,length:D.indices.byteLength/2/3});return new un(C.createVertexBuffer(z,Sa.members),C.createIndexBuffer($),s.aX.simpleSegment(0,0,z.length,$.length))})(o,d);return this._tileMeshCache[_]=x,x}recalculate(o){}hasTransition(){const o=W();let d=!1;return d=d||(o-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}const iv=new s.t({type:new s.D(s.u.projection.type)});class Np extends s.E{constructor(o){super(),this._transitionable=new s.x(iv,void 0),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new xi,this._verticalPerspectiveProjection=new Lp}get transitionState(){const o=this.properties.get("type");if(typeof o=="string"&&o==="mercator")return 0;if(typeof o=="string"&&o==="vertical-perspective")return 1;if(o instanceof s.bw){if(o.from==="vertical-perspective"&&o.to==="mercator")return 1-o.transition;if(o.from==="mercator"&&o.to==="vertical-perspective")return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,d,_,x,C){return this.currentProjection.getMeshFromTileID(o,d,_,x,C)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function cs(A){const o=Lc(A.worldSize,A.center.lat);return 2*Math.PI*o}function Ao(A,o,d,_,x){const C=1/(1<<x),I=o/s.a5*C+_*C,D=s.bz((A/s.a5*C+d*C)*Math.PI*2+Math.PI,2*Math.PI),z=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,$=Math.cos(z),H=new Float64Array(3);return H[0]=Math.sin(D)*$,H[1]=Math.sin(z),H[2]=Math.cos(D)*$,H}function In(A){return(function(o,d){const _=Math.cos(d),x=new Float64Array(3);return x[0]=Math.sin(o)*_,x[1]=Math.sin(d),x[2]=Math.cos(o)*_,x})(A.lng*Math.PI/180,A.lat*Math.PI/180)}function Lc(A,o){return A/(2*Math.PI)/Math.cos(o*Math.PI/180)}function Kh(A){const o=Math.asin(A[1])/Math.PI*180,d=Math.sqrt(A[0]*A[0]+A[2]*A[2]);if(d>1e-6){const _=A[0]/d,x=Math.acos(A[2]/d),C=(_>0?x:-x)/Math.PI*180;return new s.V(s.W(C,-180,180),o)}return new s.V(0,o)}function Qh(A){return Math.cos(A*Math.PI/180)}function Xn(A,o){const d=Qh(A),_=Qh(o);return s.at(_/d)}function Nm(A,o){const d=A.rotate(o.bearingInRadians),_=o.zoom+Xn(o.center.lat,0),x=s.bu(1/Qh(o.center.lat),1/Qh(Math.min(Math.abs(o.center.lat),60)),s.bx(_,7,3,0,1)),C=360/cs({worldSize:o.worldSize,center:{lat:o.center.lat}});return new s.V(o.center.lng-d.x*C*x,s.an(o.center.lat+d.y*C,-s.ao,s.ao))}function md(A){const o=.5*A,d=Math.sin(o),_=Math.cos(o);return Math.log(d+_)-Math.log(_-d)}function zm(A,o,d,_){const x=A.lat+d*_;if(Math.abs(d)>1){const C=(Math.sign(A.lat+d)!==Math.sign(A.lat)?-Math.abs(A.lat):Math.abs(A.lat))*Math.PI/180,I=Math.abs(A.lat+d)*Math.PI/180,D=md(C+_*(I-C)),z=md(C),$=md(I);return new s.V(A.lng+o*((D-z)/($-z)),x)}return new s.V(A.lng+o*_,x)}class sv{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=o}swapBuffers(){if(!this._hadAnyChanges)return;const o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(o,d,_,x){const C=`${o.z}_${o.x}_${o.y}_${x?.terrain?"t":""}`,I=this._cache.get(C);if(I)return I;const D=this._cachePrevious.get(C);if(D)return this._cache.set(C,D),D;const z=this._boundingVolumeFactory(o,d,_,x);return this._cache.set(C,z),this._hadAnyChanges=!0,z}}class ju{constructor(o,d,_,x){this.min=_,this.max=x,this.points=o,this.planes=d}static fromAabb(o,d){const _=[];for(let x=0;x<8;x++)_.push([1&~x?o[0]:d[0],(x>>1&1)==1?d[1]:o[1],(x>>2&1)==1?d[2]:o[2]]);return new ju(_,[[-1,0,0,d[0]],[1,0,0,-o[0]],[0,-1,0,d[1]],[0,1,0,-o[1]],[0,0,-1,d[2]],[0,0,1,-o[2]]],o,d)}static fromCenterSizeAngles(o,d,_){const x=s.bB([],_[0],_[1],_[2]),C=s.bC([],[d[0],0,0],x),I=s.bC([],[0,d[1],0],x),D=s.bC([],[0,0,d[2]],x),z=[...o],$=[...o];for(let Z=0;Z<8;Z++)for(let G=0;G<3;G++){const ne=o[G]+C[G]*(1&~Z?-1:1)+I[G]*((Z>>1&1)==1?1:-1)+D[G]*((Z>>2&1)==1?1:-1);z[G]=Math.min(z[G],ne),$[G]=Math.max($[G],ne)}const H=[];for(let Z=0;Z<8;Z++){const G=[...o];s.b0(G,G,s.a$([],C,1&~Z?-1:1)),s.b0(G,G,s.a$([],I,(Z>>1&1)==1?1:-1)),s.b0(G,G,s.a$([],D,(Z>>2&1)==1?1:-1)),H.push(G)}return new ju(H,[[...C,-s.b5(C,H[0])],[...I,-s.b5(I,H[0])],[...D,-s.b5(D,H[0])],[-C[0],-C[1],-C[2],-s.b5(C,H[7])],[-I[0],-I[1],-I[2],-s.b5(I,H[7])],[-D[0],-D[1],-D[2],-s.b5(D,H[7])]],z,$)}intersectsFrustum(o){let d=!0;const _=this.points.length,x=this.planes.length,C=o.planes.length,I=o.points.length;for(let D=0;D<C;D++){const z=o.planes[D];let $=0;for(let H=0;H<_;H++){const Z=this.points[H];z[0]*Z[0]+z[1]*Z[1]+z[2]*Z[2]+z[3]>=0&&$++}if($===0)return 0;$<_&&(d=!1)}if(d)return 2;for(let D=0;D<x;D++){const z=this.planes[D];let $=0;for(let H=0;H<I;H++){const Z=o.points[H];z[0]*Z[0]+z[1]*Z[1]+z[2]*Z[2]+z[3]>=0&&$++}if($===0)return 0}return 1}intersectsPlane(o){const d=this.points.length;let _=0;for(let x=0;x<d;x++){const C=this.points[x];o[0]*C[0]+o[1]*C[1]+o[2]*C[2]+o[3]>=0&&_++}return _===d?2:_===0?0:1}}function _d(A,o,d){const _=A-o;return _<0?-_:Math.max(0,_-d)}function Uu(A,o,d,_,x){const C=A-d;let I;return I=C<0?Math.min(-C,1+C-x):C>1?Math.min(Math.max(C-x,0),1-C):0,Math.max(I,_d(o,_,x))}class zp{constructor(){this._boundingVolumeCache=new sv(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(o,d,_,x){const C=1<<_.z,I=1/C,D=_.x/C,z=_.y/C;let $=2;return $=Math.min($,Uu(o,d,D,z,I)),$=Math.min($,Uu(o,d,D+.5,-z-I,I)),$=Math.min($,Uu(o,d,D+.5,2-z-I,I)),$}getWrap(o,d,_){const x=1<<d.z,C=1/x,I=d.x/x,D=_d(o.x,I,C),z=_d(o.x,I-1,C),$=_d(o.x,I+1,C),H=Math.min(D,z,$);return H===$?1:H===z?-1:0}allowVariableZoom(o,d){return vr(o,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(o,d,_,x){return this._boundingVolumeCache.getTileBoundingVolume(o,d,_,x)}_computeTileBoundingVolume(o,d,_,x){var C,I;let D=0,z=0;if(x?.terrain){const $=new s.a2(o.z,d,o.z,o.x,o.y),H=x.terrain.getMinMaxElevation($);D=(C=H.minElevation)!==null&&C!==void 0?C:Math.min(0,_),z=(I=H.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}if(D/=s.bE,z/=s.bE,D+=1,z+=1,o.z<=0)return ju.fromAabb([-z,-z,-z],[z,z,z]);if(o.z===1)return ju.fromAabb([o.x===0?-z:0,o.y===0?0:-z,-z],[o.x===0?0:z,o.y===0?z:0,z]);{const $=[Ao(0,0,o.x,o.y,o.z),Ao(s.a5,0,o.x,o.y,o.z),Ao(s.a5,s.a5,o.x,o.y,o.z),Ao(0,s.a5,o.x,o.y,o.z)],H=[];for(const at of $)H.push(s.a$([],at,z));if(z!==D)for(const at of $)H.push(s.a$([],at,D));o.y===0&&H.push([0,1,0]),o.y===(1<<o.z)-1&&H.push([0,-1,0]);const Z=[1,1,1],G=[-1,-1,-1];for(const at of H)for(let ot=0;ot<3;ot++)Z[ot]=Math.min(Z[ot],at[ot]),G[ot]=Math.max(G[ot],at[ot]);const ne=Ao(s.a5/2,s.a5/2,o.x,o.y,o.z),le=s.b4([],[0,1,0],ne);s.b3(le,le);const _e=s.b4([],ne,le);s.b3(_e,_e);const xe=s.b4([],$[2],$[1]);s.b3(xe,xe);const be=s.b4([],$[0],$[3]);s.b3(be,be),H.push(s.a$([],ne,z)),o.y>=(1<<o.z)/2&&H.push(s.a$([],Ao(s.a5/2,0,o.x,o.y,o.z),z)),o.y<(1<<o.z)/2&&H.push(s.a$([],Ao(s.a5/2,s.a5,o.x,o.y,o.z),z));const Ae=Jh(ne,H),ke=Jh(_e,H),Se=[-ne[0],-ne[1],-ne[2],Ae.max],De=[ne[0],ne[1],ne[2],-Ae.min],ze=[-_e[0],-_e[1],-_e[2],ke.max],Re=[_e[0],_e[1],_e[2],-ke.min],Ve=[...xe,0],ct=[...be,0],nt=[];return o.y===0?nt.push(s.bD(ct,Ve,Se),s.bD(ct,Ve,De)):nt.push(s.bD(ze,Ve,Se),s.bD(ze,Ve,De),s.bD(ze,ct,Se),s.bD(ze,ct,De)),o.y===(1<<o.z)-1?nt.push(s.bD(ct,Ve,Se),s.bD(ct,Ve,De)):nt.push(s.bD(Re,Ve,Se),s.bD(Re,Ve,De),s.bD(Re,ct,Se),s.bD(Re,ct,De)),new ju(nt,[Se,De,ze,Re,Ve,ct],Z,G)}}}function Jh(A,o){let d=1/0,_=-1/0;for(const x of o){const C=s.b5(A,x);d=Math.min(d,C),_=Math.max(_,C)}return{min:d,max:_}}class Vu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,_){return this._helper.interpolatePadding(o,d,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d){this._helper.resize(o,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(o){this._cachedClippingPlane=s.bF(),this._projectionMatrix=s.bj(),this._globeViewProjMatrix32f=s.bi(),this._globeViewProjMatrixNoCorrection=s.bj(),this._globeViewProjMatrixNoCorrectionInverted=s.bj(),this._globeProjMatrixInverted=s.bj(),this._cameraPosition=s.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(d,_)=>{const x=s.an(d.lat,-s.ao,s.ao),C=s.an(+_,this.minZoom+Xn(0,x),this.maxZoom);return{center:new s.V(d.lng,x),zoom:C}},this.applyConstrain=(d,_)=>this._helper.applyConstrain(d,_),this._helper=new Nl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,_)=>this.defaultConstrain(d,_)},o),this._coveringTilesDetailsProvider=new zp}clone(){const o=new Vu;return o.apply(this,!1),o}apply(o,d,_){this._globeLatitudeErrorCorrectionRadians=_||0,this._helper.apply(o,d)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const o=s.bA();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){const{overscaledTileID:d,applyGlobeMatrix:_}=o,x=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:x,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){const d=this.pitchInRadians,_=this.cameraToCenterDistance/o,x=Math.sin(d)*_,C=Math.cos(d)*_+1,I=1/Math.sqrt(x*x+C*C)*1;let D=-x,z=C;const $=Math.sqrt(D*D+z*z);D/=$,z/=$;const H=[0,D,z];s.bG(H,H,[0,0,0],-this.bearingInRadians),s.bH(H,H,[0,0,0],-1*this.center.lat*Math.PI/180),s.bI(H,H,[0,0,0],this.center.lng*Math.PI/180);const Z=1/s.b7(H);return s.a$(H,H,Z),[...H,-I*Z]}isLocationOccluded(o){return!this.isSurfacePointVisible(In(o))}transformLightDirection(o){const d=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,x=Math.cos(_),C=[Math.sin(d)*x,Math.sin(_),Math.cos(d)*x],I=[C[2],0,-C[0]],D=[0,0,0];s.b4(D,I,C),s.b3(I,I),s.b3(D,D);const z=[0,0,0];return s.b3(z,[I[0]*o[0]+D[0]*o[1]+C[0]*o[2],I[1]*o[0]+D[1]*o[1]+C[1]*o[2],I[2]*o[0]+D[2]*o[1]+C[2]*o[2]]),z}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,d,_){const x=(function(D,z,$){const H=1/(1<<$.z);return new s.a9(D/s.a5*H+$.x*H,z/s.a5*H+$.y*H)})(o,d,_.canonical),C=(I=x.y,[s.bz(x.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(C[1])}projectTileCoordinates(o,d,_,x){const C=_.canonical,I=Ao(o,d,C.x,C.y,C.z),D=1+(x?x(o,d):0)/s.bE,z=[I[0]*D,I[1]*D,I[2]*D,1];s.aH(z,z,this._globeViewProjMatrixNoCorrection);const $=this._cachedClippingPlane,H=$[0]*I[0]+$[1]*I[1]+$[2]*I[2]+$[3]<0;return{point:new s.P(z[0]/z[3],z[1]/z[3]),signedDistanceFromCamera:z[3],isOccluded:H}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const o=Lc(this.worldSize,this.center.lat),d=s.bk(),_=s.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),s.be(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const x=this.centerOffset;d[8]=2*-x.x/this._helper._width,d[9]=2*x.y/this._helper._height,this._projectionMatrix=s.bf(d),this._globeProjMatrixInverted=s.bk(),s.aB(this._globeProjMatrixInverted,d),s.O(d,d,[0,0,-this.cameraToCenterDistance]),s.bg(d,d,this.rollInRadians),s.bh(d,d,-this.pitchInRadians),s.bg(d,d,this.bearingInRadians),s.O(d,d,[0,0,-o]);const C=s.bA();C[0]=o,C[1]=o,C[2]=o,s.bh(_,d,this.center.lat*Math.PI/180),s.bJ(_,_,-this.center.lng*Math.PI/180),s.Q(_,_,C),this._globeViewProjMatrixNoCorrection=_,s.bh(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bJ(d,d,-this.center.lng*Math.PI/180),s.Q(d,d,C),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),s.aB(this._globeViewProjMatrixNoCorrectionInverted,_);const I=s.bA();this._cameraPosition=s.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/o,s.bG(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),s.bH(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),s.bG(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),s.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bH(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),s.bI(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);const D=s.bf(this._globeViewProjMatrixNoCorrectionInverted);s.Q(D,D,[1,1,-1]),this._cachedFrustum=os.fromInvProjectionMatrix(D,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(o){s.w("calculateFogMatrix is not supported on globe projection.");const d=s.bk();return s.ar(d),d}getVisibleUnwrappedCoordinates(o){return[new s.bc(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=In(o);s.a$(_,_,1+d/s.bE);const x=s.bF();return s.aH(x,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),x[2]/x[3]}populateCache(o){}getBounds(){const o=.5*this.width,d=.5*this.height,_=[new s.P(0,0),new s.P(o,0),new s.P(this.width,0),new s.P(this.width,d),new s.P(this.width,this.height),new s.P(o,this.height),new s.P(0,this.height),new s.P(0,d)],x=[];for(const Z of _)x.push(this.unprojectScreenPoint(Z));let C=0,I=0,D=0,z=0;const $=this.center;for(const Z of x){const G=s.bK($.lng,Z.lng),ne=s.bK($.lat,Z.lat);G<I&&(I=G),G>C&&(C=G),ne<z&&(z=ne),ne>D&&(D=ne)}const H=[$.lng+I,$.lat+z,$.lng+C,$.lat+D];return this.isSurfacePointOnScreen([0,1,0])&&(H[3]=90,H[0]=-180,H[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(H[1]=-90,H[0]=-180,H[2]=180),new Yr(H)}calculateCenterFromCameraLngLatAlt(o,d,_,x){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,_,x)}setLocationAtPoint(o,d){const _=In(this.unprojectScreenPoint(d)),x=In(o),C=s.bA();s.bL(C);const I=s.bA();s.bI(I,_,C,-this.center.lng*Math.PI/180),s.bH(I,I,C,this.center.lat*Math.PI/180);const D=x[0]*x[0]+x[2]*x[2],z=I[0]*I[0];if(D<z)return;const $=Math.sqrt(D-z),H=-$,Z=s.bM(x[0],x[2],I[0],$),G=s.bM(x[0],x[2],I[0],H),ne=s.bA();s.bI(ne,x,C,-Z);const le=s.bM(ne[1],ne[2],I[1],I[2]),_e=s.bA();s.bI(_e,x,C,-G);const xe=s.bM(_e[1],_e[2],I[1],I[2]),be=.5*Math.PI,Ae=le>=-be&&le<=be,ke=xe>=-be&&xe<=be;let Se,De;if(Ae&&ke){const ct=this.center.lng*Math.PI/180,nt=this.center.lat*Math.PI/180;s.bN(Z,ct)+s.bN(le,nt)<s.bN(G,ct)+s.bN(xe,nt)?(Se=Z,De=le):(Se=G,De=xe)}else if(Ae)Se=Z,De=le;else{if(!ke)return;Se=G,De=xe}const ze=Se/Math.PI*180,Re=De/Math.PI*180,Ve=this.center.lat;this.setCenter(new s.V(ze,s.an(Re,-90,90))),this.setZoom(this.zoom+Xn(Ve,this.center.lat))}locationToScreenPoint(o,d){const _=In(o);if(d){const x=d.getElevationForLngLatZoom(o,this._helper._tileZoom);s.a$(_,_,1+x/s.bE)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(o){const d=s.bF();return s.aH(d,[...o,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new s.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,d){if(d){const _=d.pointCoordinate(o);if(_)return _}return s.a9.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,d){var _;return(_=this.screenPointToMercatorCoordinate(o,d))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(o,d){const _=this._cameraPosition,x=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(_,x)}getRayDirectionFromPixel(o){const d=s.bF();d[0]=o.x/this.width*2-1,d[1]=-1*(o.y/this.height*2-1),d[2]=1,d[3]=1,s.aH(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const _=s.bA();_[0]=d[0]-this._cameraPosition[0],_[1]=d[1]-this._cameraPosition[1],_[2]=d[2]-this._cameraPosition[2];const x=s.bA();return s.b3(x,_),x}isSurfacePointVisible(o){const d=this._cachedClippingPlane;return d[0]*o[0]+d[1]*o[1]+d[2]*o[2]+d[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;const d=s.bF();return s.aH(d,[...o,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(o,d){const _=s.b5(o,d),x=s.bA(),C=s.bA();s.a$(C,d,_),s.b2(x,o,C);const I=1-s.b5(x,x);if(I<0)return null;const D=s.b5(o,o)-1,z=-_+(_<0?1:-1)*Math.sqrt(I),$=D/z,H=z;return{tMin:Math.min($,H),tMax:Math.max($,H)}}unprojectScreenPoint(o){const d=this._cameraPosition,_=this.getRayDirectionFromPixel(o),x=this.rayPlanetIntersection(d,_);if(x){const H=s.bA();s.b0(H,d,[_[0]*x.tMin,_[1]*x.tMin,_[2]*x.tMin]);const Z=s.bA();return s.b3(Z,H),Kh(Z)}const C=this._cachedClippingPlane,I=C[0]*_[0]+C[1]*_[1]+C[2]*_[2],D=-s.bb(C,d)/I,z=s.bA();if(D>0)s.b0(z,d,[_[0]*D,_[1]*D,_[2]*D]);else{const H=s.bA();s.b0(H,d,[2*_[0],2*_[1],2*_[2]]);const Z=s.bb(this._cachedClippingPlane,H);s.b2(z,H,[this._cachedClippingPlane[0]*Z,this._cachedClippingPlane[1]*Z,this._cachedClippingPlane[2]*Z])}const $=(function(H){const Z=s.bA();return Z[0]=H[0]*-H[3],Z[1]=H[1]*-H[3],Z[2]=H[2]*-H[3],{center:Z,radius:Math.sqrt(1-H[3]*H[3])}})(C);return Kh((function(H,Z,G){const ne=s.bA();s.b2(ne,G,H);const le=s.bA();return s.by(le,H,ne,Z/s.b9(ne)),le})($.center,$.radius,z))}getMatrixForModel(o,d){const _=s.V.convert(o),x=1/s.bE,C=s.bj();return s.bJ(C,C,_.lng/180*Math.PI),s.bh(C,C,-_.lat/180*Math.PI),s.O(C,C,[0,0,1+d/s.bE]),s.bh(C,C,.5*Math.PI),s.Q(C,C,[x,x,x]),C}getProjectionDataForCustomLayer(o=!0){const d=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:o});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(o){}}class $u{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,_){return this._helper.interpolatePadding(o,d,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d,_=!0){this._helper.resize(o,d,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,d){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(o){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(d,_)=>this.currentTransform.defaultConstrain(d,_),this.applyConstrain=(d,_)=>this._helper.applyConstrain(d,_),this._helper=new Nl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,_)=>this.defaultConstrain(d,_)},o),this._globeness=1,this._mercatorTransform=new di,this._verticalPerspectiveTransform=new Vu}clone(){const o=new $u;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this,!1),o}apply(o,d){this._helper.apply(o,d),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){const d=this._mercatorTransform.getProjectionData(o),_=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:d.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return s.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,d,_){const x=this._mercatorTransform.getPitchedTextCorrection(o,d,_),C=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,d,_);return s.bu(x,C,this._globeness)}projectTileCoordinates(o,d,_,x){return this.currentTransform.projectTileCoordinates(o,d,_,x)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,d){return this.currentTransform.lngLatToCameraDepth(o,d)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(o,d,_,x){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,_,x)}setLocationAtPoint(o,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,d),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(o,d),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(o,d){return this.currentTransform.locationToScreenPoint(o,d)}screenPointToMercatorCoordinate(o,d){return this.currentTransform.screenPointToMercatorCoordinate(o,d)}screenPointToLocation(o,d){return this.currentTransform.screenPointToLocation(o,d)}isPointOnMapSurface(o,d){return this.currentTransform.isPointOnMapSurface(o,d)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,d){return this.currentTransform.getMatrixForModel(o,d)}getProjectionDataForCustomLayer(o=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return d;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return _.fallbackMatrix=d.mainMatrix,_}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class ei{get useGlobeControls(){return!0}handlePanInertia(o,d){const _=Nm(o,d);return Math.abs(_.lng-d.center.lng)>180&&(_.lng=d.center.lng+179.5*Math.sign(_.lng-d.center.lng)),{easingCenter:_,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,d){const _=o.around,x=d.screenPointToLocation(_);o.bearingDelta&&d.setBearing(d.bearing+o.bearingDelta),o.pitchDelta&&d.setPitch(d.pitch+o.pitchDelta),o.rollDelta&&d.setRoll(d.roll+o.rollDelta);const C=d.zoom;o.zoomDelta&&d.setZoom(d.zoom+o.zoomDelta);const I=d.zoom-C;if(I===0)return;const D=s.bK(d.center.lng,x.lng),z=D/(Math.abs(D/180)+1),$=s.bK(d.center.lat,x.lat),H=d.getRayDirectionFromPixel(_),Z=d.cameraPosition,G=-1*s.b5(Z,H),ne=s.bA();s.b0(ne,Z,[H[0]*G,H[1]*G,H[2]*G]);const le=s.b7(ne)-1,_e=Math.exp(.5*-Math.max(le-.3,0)),xe=Lc(d.worldSize,d.center.lat)/Math.min(d.width,d.height),be=s.bx(xe,.9,.5,1,.25),Ae=(1-s.aq(-I))*Math.min(_e,be),ke=d.center.lat,Se=d.zoom,De=new s.V(d.center.lng+z*Ae,s.an(d.center.lat+$*Ae,-s.ao,s.ao));d.setLocationAtPoint(x,_);const ze=d.center,Re=s.bx(Math.abs(D),45,85,0,1),Ve=s.bx(xe,.75,.35,0,1),ct=Math.pow(Math.max(Re,Ve),.25),nt=s.bK(ze.lng,De.lng),at=s.bK(ze.lat,De.lat);d.setCenter(new s.V(ze.lng+nt*ct,ze.lat+at*ct).wrap()),d.setZoom(Se+Xn(ke,d.center.lat))}handleMapControlsPan(o,d,_){if(!o.panDelta)return;const x=d.center.lat,C=d.zoom;d.setCenter(Nm(o.panDelta,d).wrap()),d.setZoom(C+Xn(x,d.center.lat))}cameraForBoxAndBearing(o,d,_,x,C){const I=Oc(o,d,_,x,C),D=d.left/C.width*2-1,z=(C.width-d.right)/C.width*2-1,$=d.top/C.height*-2+1,H=(C.height-d.bottom)/C.height*-2+1,Z=s.bK(_.getWest(),_.getEast())<0,G=Z?_.getEast():_.getWest(),ne=Z?_.getWest():_.getEast(),le=Math.max(_.getNorth(),_.getSouth()),_e=Math.min(_.getNorth(),_.getSouth()),xe=G+.5*s.bK(G,ne),be=le+.5*s.bK(le,_e),Ae=C.clone();Ae.setCenter(I.center),Ae.setBearing(I.bearing),Ae.setPitch(0),Ae.setRoll(0),Ae.setZoom(I.zoom);const ke=Ae.modelViewProjectionMatrix,Se=[In(_.getNorthWest()),In(_.getNorthEast()),In(_.getSouthWest()),In(_.getSouthEast()),In(new s.V(ne,be)),In(new s.V(G,be)),In(new s.V(xe,le)),In(new s.V(xe,_e))],De=In(I.center);let ze=Number.POSITIVE_INFINITY;for(const Re of Se)D<0&&(ze=ei.getLesserNonNegativeNonNull(ze,ei.solveVectorScale(Re,De,ke,"x",D))),z>0&&(ze=ei.getLesserNonNegativeNonNull(ze,ei.solveVectorScale(Re,De,ke,"x",z))),$>0&&(ze=ei.getLesserNonNegativeNonNull(ze,ei.solveVectorScale(Re,De,ke,"y",$))),H<0&&(ze=ei.getLesserNonNegativeNonNull(ze,ei.solveVectorScale(Re,De,ke,"y",H)));if(Number.isFinite(ze)&&ze!==0)return I.zoom=Ae.zoom+s.at(ze),I;ls()}handleJumpToCenterZoom(o,d){const _=o.center.lat,x=o.applyConstrain(d.center?s.V.convert(d.center):o.center,o.zoom).center;o.setCenter(x.wrap());const C=d.zoom!==void 0?+d.zoom:o.zoom+Xn(_,x.lat);o.zoom!==C&&o.setZoom(C)}handleEaseTo(o,d){const _=o.zoom,x=o.center,C=o.padding,I={roll:o.roll,pitch:o.pitch,bearing:o.bearing},D={roll:d.roll===void 0?o.roll:d.roll,pitch:d.pitch===void 0?o.pitch:d.pitch,bearing:d.bearing===void 0?o.bearing:d.bearing},z=d.zoom!==void 0,$=!o.isPaddingEqual(d.padding);let H=!1;const Z=d.center?s.V.convert(d.center):x,G=o.applyConstrain(Z,_).center;So(o,G);const ne=o.clone();ne.setCenter(G),ne.setZoom(z?+d.zoom:_+Xn(x.lat,Z.lat)),ne.setBearing(d.bearing);const le=new s.P(s.an(o.centerPoint.x+d.offsetAsPoint.x,0,o.width),s.an(o.centerPoint.y+d.offsetAsPoint.y,0,o.height));ne.setLocationAtPoint(G,le);const _e=(d.offset&&d.offsetAsPoint.mag())>0?ne.center:G,xe=z?+d.zoom:_+Xn(x.lat,_e.lat),be=_+Xn(x.lat,0),Ae=xe+Xn(_e.lat,0),ke=s.bK(x.lng,_e.lng),Se=s.bK(x.lat,_e.lat),De=s.aq(Ae-be);return H=xe!==_,{easeFunc:ze=>{if(s.bo(I,D)||Gh({startEulerAngles:I,endEulerAngles:D,tr:o,k:ze,useSlerp:I.roll!=D.roll}),$&&o.interpolatePadding(C,d.padding,ze),d.around)s.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(d.around,d.aroundPoint);else{const Re=Ae>be?Math.min(2,De):Math.max(.5,De),Ve=Math.pow(Re,1-ze),ct=zm(x,ke,Se,ze*Ve);o.setCenter(ct.wrap())}if(H){const Re=s.G.number(be,Ae,ze)+Xn(0,o.center.lat);o.setZoom(Re)}},isZooming:H,elevationCenter:_e}}handleFlyTo(o,d){const _=d.zoom!==void 0,x=o.center,C=o.zoom,I=o.padding,D=!o.isPaddingEqual(d.padding),z=o.applyConstrain(s.V.convert(d.center||d.locationAtOffset),C).center,$=_?+d.zoom:o.zoom+Xn(o.center.lat,z.lat),H=o.clone();H.setCenter(z),H.setZoom($),H.setBearing(d.bearing);const Z=new s.P(s.an(o.centerPoint.x+d.offsetAsPoint.x,0,o.width),s.an(o.centerPoint.y+d.offsetAsPoint.y,0,o.height));H.setLocationAtPoint(z,Z);const G=H.center;So(o,G);const ne=(function(Se,De,ze){const Re=In(De),Ve=In(ze),ct=s.b5(Re,Ve),nt=Math.acos(ct),at=cs(Se);return nt/(2*Math.PI)*at})(o,x,G),le=C+Xn(x.lat,0),_e=$+Xn(G.lat,0),xe=s.aq(_e-le);let be;if(typeof d.minZoom=="number"){const Se=+d.minZoom+Xn(G.lat,0),De=Math.min(Se,le,_e)+Xn(0,G.lat),ze=o.applyConstrain(G,De).zoom+Xn(G.lat,0);be=s.aq(ze-le)}const Ae=s.bK(x.lng,G.lng),ke=s.bK(x.lat,G.lat);return{easeFunc:(Se,De,ze,Re)=>{const Ve=zm(x,Ae,ke,ze);D&&o.interpolatePadding(I,d.padding,Se);const ct=Se===1?G:Ve;o.setCenter(ct.wrap());const nt=le+s.at(De);o.setZoom(Se===1?$:nt+Xn(0,ct.lat))},scaleOfZoom:xe,targetCenter:G,scaleOfMinZoom:be,pixelPathLength:ne}}static solveVectorScale(o,d,_,x,C){const I=x==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],D=[_[3],_[7],_[11],_[15]],z=o[0]*I[0]+o[1]*I[1]+o[2]*I[2],$=o[0]*D[0]+o[1]*D[1]+o[2]*D[2],H=d[0]*I[0]+d[1]*I[1]+d[2]*I[2],Z=d[0]*D[0]+d[1]*D[1]+d[2]*D[2];return H+C*$===z+C*Z||D[3]*(z-H)+I[3]*(Z-$)+z*Z==H*$?null:(H+I[3]-C*Z-C*D[3])/(H-z-C*Z+C*$)}static getLesserNonNegativeNonNull(o,d){return d!==null&&d>=0&&d<o?d:o}}class Wu{constructor(o){this._globe=o,this._mercatorCameraHelper=new Dc,this._verticalPerspectiveCameraHelper=new ei}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,d){return this.currentHelper.handlePanInertia(o,d)}handleMapControlsRollPitchBearingZoom(o,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,d)}handleMapControlsPan(o,d,_){this.currentHelper.handleMapControlsPan(o,d,_)}cameraForBoxAndBearing(o,d,_,x,C){return this.currentHelper.cameraForBoxAndBearing(o,d,_,x,C)}handleJumpToCenterZoom(o,d){this.currentHelper.handleJumpToCenterZoom(o,d)}handleEaseTo(o,d){return this.currentHelper.handleEaseTo(o,d)}handleFlyTo(o,d){return this.currentHelper.handleFlyTo(o,d)}}const Hu=(A,o)=>s.B(A,o&&o.filter((d=>d.identifier!=="source.canvas"))),qu=s.bO();class jl extends s.E{constructor(o,d={}){var _,x;super(),this._rtlPluginLoaded=()=>{for(const I in this.tileManagers){const D=this.tileManagers[I].getSource().type;D!=="vector"&&D!=="geojson"||this.tileManagers[I].reload()}},this.map=o,this.dispatcher=new Yt(_t(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",((I,D)=>this.getGlyphs(I,D))),this.dispatcher.registerMessageHandler("GI",((I,D)=>this.getImages(I,D))),this.dispatcher.registerMessageHandler("GDA",((I,D)=>this.getDashes(I,D))),this.imageManager=new Ye,this.imageManager.setEventedParent(this);const C=((_=o._container)===null||_===void 0?void 0:_.lang)||typeof document<"u"&&((x=document.documentElement)===null||x===void 0?void 0:x.lang)||void 0;this.glyphManager=new Me(o._requestManager,d.localIdeographFontFamily,C),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new bi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bP()),ie().on(Ol,this._rtlPluginLoaded),this.on("data",(I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;const D=this.tileManagers[I.sourceId];if(!D)return;const z=D.getSource();if(z&&z.vectorLayerIds)for(const $ in this._layers){const H=this._layers[$];H.source===z.id&&this._validateLayer(H)}}))}_setInitialValues(){var o;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((o=this.crossTileSymbolIndex)===null||o===void 0?void 0:o.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(o,d){var _,x,C;this._checkLoaded();const I=d===null?(C=(x=(_=this.stylesheet.state)===null||_===void 0?void 0:_[o])===null||x===void 0?void 0:x.default)!==null&&C!==void 0?C:null:d;if(s.bR(I,this._globalState[o]))return this;this._globalState[o]=I,this._applyGlobalStateChanges([o])}getGlobalState(){return this._globalState}setGlobalState(o){this._checkLoaded();const d=[];for(const _ in o)!s.bR(this._globalState[_],o[_].default)&&(d.push(_),this._globalState[_]=o[_].default);this._applyGlobalStateChanges(d)}_applyGlobalStateChanges(o){if(o.length===0)return;const d=new Set,_={};for(const x of o){_[x]=this._globalState[x];for(const C in this._layers){const I=this._layers[C],D=I.getLayoutAffectingGlobalStateRefs(),z=I.getPaintAffectingGlobalStateRefs(),$=I.getVisibilityAffectingGlobalStateRefs();if(D.has(x)&&d.add(I.source),z.has(x))for(const{name:H,value:Z}of z.get(x))this._updatePaintProperty(I,H,Z);$?.has(x)&&(I.recalculateVisibility(),this._updateLayer(I))}}this.dispatcher.broadcast("UGS",_);for(const x in this.tileManagers)d.has(x)&&(this._reloadSource(x),this._changed=!0)}loadURL(o,d={},_){this.fire(new s.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const x=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const C=this._loadStyleRequest;s.j(x,this._loadStyleRequest).then((I=>{this._loadStyleRequest=null,this._load(I.data,d,_)})).catch((I=>{this._loadStyleRequest=null,I&&!C.signal.aborted&&this.fire(new s.k(I))}))}loadJSON(o,d={},_){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(o,d,_)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(qu,{validate:!1})}_load(o,d,_){var x,C;let I=d.transformStyle?d.transformStyle(_,o):o;if(!d.validate||!Hu(this,s.C(I))){I=Object.assign({},I),this._loaded=!0,this.stylesheet=I;for(const D in I.sources)this.addSource(D,I.sources[D],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new st(this.stylesheet.light),this._setProjectionInternal(((x=this.stylesheet.projection)===null||x===void 0?void 0:x.type)||"mercator"),this.sky=new Be(this.stylesheet.sky),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var o,d,_;const x=s.bS(this.stylesheet.layers);this.setGlobalState((o=this.stylesheet.state)!==null&&o!==void 0?o:null),this.dispatcher.broadcast("SL",x),this._order=x.map((C=>C.id)),this._layers={},this._serializedLayers=null;for(const C of x){const I=s.bT(C,this._globalState);if(I.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=I,s.bU(I)&&this.tileManagers[I.source]){const D=(_=(d=C.paint)===null||d===void 0?void 0:d["raster-fade-duration"])!==null&&_!==void 0?_:I.paint.get("raster-fade-duration");this.tileManagers[I.source].setRasterFadeDuration(D)}}}_loadSprite(o,d=!1,_=void 0){this.imageManager.setLoaded(!1);const x=new AbortController;let C;this._spriteRequest=x,(function(I,D,z,$){return s._(this,void 0,void 0,(function*(){const H=Xe(I),Z=z>1?"@2x":"",G={},ne={};for(const{id:le,url:_e}of H){const xe=D.transformRequest(Et(_e,Z,".json"),"SpriteJSON");G[le]=s.j(xe,$);const be=D.transformRequest(Et(_e,Z,".png"),"SpriteImage");ne[le]=Ce.getImage(be,$)}return yield Promise.all([...Object.values(G),...Object.values(ne)]),(function(le,_e){return s._(this,void 0,void 0,(function*(){const xe={};for(const be in le){xe[be]={};const Ae=N.getImageCanvasContext((yield _e[be]).data),ke=(yield le[be]).data;for(const Se in ke){const{width:De,height:ze,x:Re,y:Ve,sdf:ct,pixelRatio:nt,stretchX:at,stretchY:ot,content:Ft,textFitWidth:Ut,textFitHeight:Pt}=ke[Se];xe[be][Se]={data:null,pixelRatio:nt,sdf:ct,stretchX:at,stretchY:ot,content:Ft,textFitWidth:Ut,textFitHeight:Pt,spriteData:{width:De,height:ze,x:Re,y:Ve,context:Ae}}}}return xe}))})(G,ne)}))})(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((I=>{if(this._spriteRequest=null,I)for(const D in I){this._spritesImagesIds[D]=[];const z=this._spritesImagesIds[D]?this._spritesImagesIds[D].filter(($=>!($ in I))):[];for(const $ of z)this.imageManager.removeImage($),this._changedImages[$]=!0;for(const $ in I[D]){const H=D==="default"?$:`${D}:${$}`;this._spritesImagesIds[D].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,I[D][$],!1):this.imageManager.addImage(H,I[D][$]),d&&(this._changedImages[H]=!0)}}})).catch((I=>{this._spriteRequest=null,C=I,x.signal.aborted||this.fire(new s.k(C))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),_&&_(C)}))}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(o){const d=this.tileManagers[o.source];if(!d)return;const _=o.sourceLayer;if(!_)return;const x=d.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.k(new Error(`Source layer "${_}" does not exist on source "${x.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.tileManagers)if(!this.tileManagers[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,d=!1){const _=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d?s.bV(_):_);const x=[];for(const C of o)if(_[C]){const I=d?s.bV(_[C]):_[C];x.push(I)}return x}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const x=this._layers[_];x.type!=="custom"&&(o[_]=x.serialize())}return o}hasTransitions(){var o,d,_;if(!((o=this.light)===null||o===void 0)&&o.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const x in this.tileManagers)if(this.tileManagers[x].hasTransition())return!0;for(const x in this._layers)if(this._layers[x].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(d){const x=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(x.length||C.length)&&this._updateWorkerLayers(x,C);for(const I in this._updatedSources){const D=this._updatedSources[I];if(D==="reload")this._reloadSource(I);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const _={};for(const x in this.tileManagers){const C=this.tileManagers[x];_[x]=C.used,C.used=!1}for(const x of this._order){const C=this._layers[x];C.recalculate(o,this._availableImages),!C.isHidden(o.zoom)&&C.source&&(this.tileManagers[C.source].used=!0)}for(const x in _){const C=this.tileManagers[x];!!_[x]!=!!C.used&&C.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,d&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.tileManagers)this.tileManagers[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.tileManagers)this.tileManagers[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){var _;this._checkLoaded();const x=this.serialize();if(o=d.transformStyle?d.transformStyle(x,o):o,((_=d.validate)===null||_===void 0||_)&&Hu(this,s.C(o)))return!1;(o=s.bV(o)).layers=s.bS(o.layers);const C=s.bW(x,o),I=this._getOperationsToPerform(C);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const D of I.operations)D();return this.stylesheet=o,this._serializedLayers=null,this.fire(new s.l("style.load",{style:this})),!0}_getOperationsToPerform(o){const d=[],_=[];for(const x of o)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,x.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,x.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,x.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,x.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,x.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,x.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,x.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,x.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,x.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,x.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,x.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,x.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,x.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,x.args)));break;case"setProjection":this.setProjection.apply(this,x.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,x.args)));break;case"setTransition":d.push((()=>{}));break;default:_.push(x.command)}return{operations:d,unimplemented:_}}addImage(o,d){if(this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,_={}){if(this._checkLoaded(),this.tileManagers[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.C.source,`sources.${o}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const x=this.tileManagers[o]=new en(o,d,this.dispatcher);x.style=this,x.setEventedParent(this,(()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:o}))),x.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.tileManagers[o]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.k(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));const d=this.tileManagers[o];delete this.tileManagers[o],delete this._updatedSources[o],d.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.tileManagers[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const _=this.tileManagers[o].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(o){return this.tileManagers[o]&&this.tileManagers[o].getSource()}addLayer(o,d,_={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new s.k(new Error(`Layer "${x}" already exists on this map.`)));let C;if(o.type==="custom"){if(Hu(this,s.bX(o)))return;C=s.bT(o,this._globalState)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(x,o.source),o=s.bV(o),o=s.e(o,{source:x})),this._validate(s.C.layer,`layers.${x}`,o,{arrayIndex:-1},_))return;C=s.bT(o,this._globalState),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}})}const I=d?this._order.indexOf(d):this._order.length;if(d&&I===-1)this.fire(new s.k(new Error(`Cannot add layer "${x}" before non-existing layer "${d}".`)));else{if(this._order.splice(I,0,x),this._layerOrderChanged=!0,this._layers[x]=C,this._removedLayers[x]&&C.source&&C.type!=="custom"){const D=this._removedLayers[x];delete this._removedLayers[x],D.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.tileManagers[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const _=this._order.indexOf(o);this._order.splice(_,1);const x=d?this._order.indexOf(d):this._order.length;d&&x===-1?this.fire(new s.k(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,_){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===d&&x.maxzoom===_||(d!=null&&(x.minzoom=d),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,_={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!s.bR(x.filter,d))return d==null?(x.setFilter(void 0),void this._updateLayer(x)):void(this._validate(s.C.filter,`layers.${x.id}.filter`,d,null,_)||(x.setFilter(s.bV(d)),this._updateLayer(x)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return s.bV(this.getLayer(o).filter)}setLayoutProperty(o,d,_,x={}){this._checkLoaded();const C=this.getLayer(o);C?s.bR(C.getLayoutProperty(d),_)||(C.setLayoutProperty(d,_,x),this._updateLayer(C)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const _=this.getLayer(o);if(_)return _.getLayoutProperty(d);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,_,x={}){this._checkLoaded();const C=this.getLayer(o);C?s.bR(C.getPaintProperty(d),_)||this._updatePaintProperty(C,d,_,x):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}_updatePaintProperty(o,d,_,x={}){o.setPaintProperty(d,_,x)&&this._updateLayer(o),s.bU(o)&&d==="raster-fade-duration"&&this.tileManagers[o.source].setRasterFadeDuration(_),this._changed=!0,this._updatedPaintProps[o.id]=!0,this._serializedLayers=null}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const _=o.source,x=o.sourceLayer,C=this.tileManagers[_];if(C===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.getSource().type;I==="geojson"&&x?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||x?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),C.setFeatureState(x,o.id,d)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const _=o.source,x=this.tileManagers[_];if(x===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));const C=x.getSource().type,I=C==="vector"?o.sourceLayer:void 0;C!=="vector"||I?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(I,o.id,d):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,_=o.sourceLayer,x=this.tileManagers[d];if(x!==void 0)return x.getSource().type!=="vector"||_?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),x.getFeatureState(_,o.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=s.bY(this.tileManagers,(C=>C.serialize())),d=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,x=this.stylesheet;return s.bZ({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,projection:x.projection,sources:o,layers:d,terrain:_},(C=>C!==void 0))}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.tileManagers[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.tileManagers[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=I=>this._layers[I].type==="fill-extrusion",_={},x=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(d(D)){_[D]=I;for(const z of o){const $=z[D];if($)for(const H of $)x.push(H)}}}x.sort(((I,D)=>D.intersectionZ-I.intersectionZ));const C=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(d(D))for(let z=x.length-1;z>=0;z--){const $=x[z].feature;if(_[$.layer.id]<I)break;C.push($),x.pop()}else for(const z of o){const $=z[D];if($)for(const H of $)C.push(H.feature)}}return C}queryRenderedFeatures(o,d,_){d&&d.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",d.filter,null,d);const x={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const $ of d.layers){const H=this._layers[$];if(!H)return this.fire(new s.k(new Error(`The layer '${$}' does not exist in the map's style and cannot be queried for features.`))),[];x[H.source]=!0}}const C=[];d.availableImages=this._availableImages;const I=this._serializedAllLayers(),D=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,z=Object.assign(Object.assign({},d),{layers:D,globalState:this._globalState});for(const $ in this.tileManagers)d.layers&&!x[$]||C.push($n(this.tileManagers[$],this._layers,I,o,z,_,this.map.terrain?(H,Z,G)=>this.map.terrain.getElevation(H,Z,G):void 0));return this.placement&&C.push((function($,H,Z,G,ne,le,_e){const xe={},be=le.queryRenderedSymbols(G),Ae=[];for(const ke of Object.keys(be).map(Number))Ae.push(_e[ke]);Ae.sort(_r);for(const ke of Ae){const Se=ke.featureIndex.lookupSymbolFeatures(be[ke.bucketInstanceId],H,ke.bucketIndex,ke.sourceLayerIndex,{filterSpec:ne.filter,globalState:ne.globalState},ne.layers,ne.availableImages,$);for(const De in Se){const ze=xe[De]=xe[De]||[],Re=Se[De];Re.sort(((Ve,ct)=>{const nt=ke.featureSortOrder;if(nt){const at=nt.indexOf(Ve.featureIndex);return nt.indexOf(ct.featureIndex)-at}return ct.featureIndex-Ve.featureIndex}));for(const Ve of Re)ze.push(Ve)}}return(function(ke,Se,De){for(const ze in ke)for(const Re of ke[ze])sr(Re,De[Se[ze].source]);return ke})(xe,$,Z)})(this._layers,I,this.tileManagers,o,z,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(o,d){d?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.tileManagers[o];return _?(function(x,C){const I=x.getRenderableIds().map(($=>x.getTileByID($))),D=[],z={};for(let $=0;$<I.length;$++){const H=I[$],Z=H.tileID.canonical.key;z[Z]||(z[Z]=!0,H.querySourceFeatures(D,C))}return D})(_,d?Object.assign(Object.assign({},d),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const I in o)if(!s.bR(o[I],_[I])){x=!0;break}if(!x)return;const C={now:W(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(C)}getProjection(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.stylesheet.projection=o,this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this._setProjectionInternal(o.type)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,d={}){this._checkLoaded();const _=this.getSky();let x=!1;if(!o&&!_)return;if(o&&!_)x=!0;else if(!o&&_)x=!0;else for(const I in o)if(!s.bR(o[I],_[I])){x=!0;break}if(!x)return;const C={now:W(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,d),this.sky.updateTransitions(C)}_setProjectionInternal(o){const d=(function(_,x){const C={constrainOverride:x};if(Array.isArray(_)){const I=new Np({type:_});return{projection:I,transform:new $u(C),cameraHelper:new Wu(I)}}switch(_){case"mercator":return{projection:new xi,transform:new di(C),cameraHelper:new Dc};case"globe":{const I=new Np({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:I,transform:new $u(C),cameraHelper:new Wu(I)}}case"vertical-perspective":return{projection:new Lp,transform:new Vu(C),cameraHelper:new ei};default:return s.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new xi,transform:new di(C),cameraHelper:new Dc}}})(o,this.map.transformConstrain);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const _ in this.tileManagers)this.tileManagers[_].reload()}_validate(o,d,_,x,C={}){return(!C||C.validate!==!1)&&Hu(this,o.call(s.C,s.e({key:d,style:this.serialize(),value:_,styleSpec:s.u},x)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ie().off(Ol,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.tileManagers){const _=this.tileManagers[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.tileManagers[o].clearTiles()}_reloadSource(o){this.tileManagers[o].resume(),this.tileManagers[o].reload()}_updateSources(o){for(const d in this.tileManagers)this.tileManagers[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.tileManagers)this._reloadSource(o)}_updatePlacement(o,d,_,x,C=!1){let I=!1,D=!1;const z={};for(const $ of this._order){const H=this._layers[$];if(H.type!=="symbol")continue;if(!z[H.source]){const G=this.tileManagers[H.source];z[H.source]=G.getRenderableIds(!0).map((ne=>G.getTileByID(ne))).sort(((ne,le)=>le.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(le.tileID)?-1:1)))}const Z=this.crossTileSymbolIndex.addLayer(H,z[H.source],o.center.lng);I=I||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(W(),o.zoom))&&(this.pauseablePlacement=new Fu(o,this.map.terrain,this._order,C,d,_,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(W()),D=!0),I&&this.pauseablePlacement.placement.setStale()),D||I)for(const $ of this._order){const H=this._layers[$];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(W())}_releaseSymbolFadeTiles(){for(const o in this.tileManagers)this.tileManagers[o].releaseSymbolFadeTiles()}getImages(o,d){return s._(this,void 0,void 0,(function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const x=this.tileManagers[d.source];return x&&x.setDependencies(d.tileID.key,d.type,d.icons),_}))}getGlyphs(o,d){return s._(this,void 0,void 0,(function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),x=this.tileManagers[d.source];return x&&x.setDependencies(d.tileID.key,d.type,[""]),_}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(s.C.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}getDashes(o,d){return s._(this,void 0,void 0,(function*(){const _={};for(const[x,C]of Object.entries(d.dashes))_[x]=this.lineAtlas.getDash(C.dasharray,C.round);return _}))}addSprite(o,d,_={},x){this._checkLoaded();const C=[{id:o,url:d}],I=[...Xe(this.stylesheet.sprite),...C];this._validate(s.C.sprite,"sprite",I,null,_)||(this.stylesheet.sprite=I,this._loadSprite(C,!0,x))}removeSprite(o){this._checkLoaded();const d=Xe(this.stylesheet.sprite);if(d.find((_=>_.id===o))){if(this._spritesImagesIds[o])for(const _ of this._spritesImagesIds[o])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex((_=>_.id===o)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Xe(this.stylesheet.sprite)}setSprite(o,d={},_){this._checkLoaded(),o&&this._validate(s.C.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,_):(this._unloadSprite(),_&&_(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const o in this.tileManagers){const d=this.tileManagers[o];d.setEventedParent(null),d.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const o in this._layers){const d=this._layers[o];d.setEventedParent(null),d.onRemove&&d.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Bm=s.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ef{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,_,x,C,I,D,z,$){this.context=o;let H=this.boundPaintVertexBuffers.length!==x.length;for(let Z=0;!H&&Z<x.length;Z++)this.boundPaintVertexBuffers[Z]!==x[Z]&&(H=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==C||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==$?this.freshBind(d,_,x,C,I,D,z,$):(o.bindVertexArray.set(this.vao),D&&D.bind(),C&&C.dynamicDraw&&C.bind(),z&&z.bind(),$&&$.bind())}freshBind(o,d,_,x,C,I,D,z){const $=o.numAttributes,H=this.context,Z=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,d.enableAttributes(Z,o);for(const G of _)G.enableAttributes(Z,o);I&&I.enableAttributes(Z,o),D&&D.enableAttributes(Z,o),z&&z.enableAttributes(Z,o),d.bind(),d.setVertexAttribPointers(Z,o,C);for(const G of _)G.bind(),G.setVertexAttribPointers(Z,o,C);I&&(I.bind(),I.setVertexAttribPointers(Z,o,C)),x&&x.bind(),D&&(D.bind(),D.setVertexAttribPointers(Z,o,C)),z&&(z.bind(),z.setVertexAttribPointers(Z,o,C)),H.currentNumAttributes=$}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Fm=(A,o,d,_,x)=>({u_texture:0,u_ele_delta:A,u_fog_matrix:o,u_fog_color:d?d.properties.get("fog-color"):s.bp.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:x?0:d?d.calculateFogBlendOpacity(_):0,u_horizon_color:d?d.properties.get("horizon-color"):s.bp.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:x?1:0}),Qa={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function yd(A){const o=[];for(let d=0;d<A.length;d++){if(A[d]===null)continue;const _=A[d].split(" ");o.push(_.pop())}return o}class jm{constructor(o,d,_,x,C,I,D,z,$=[]){const H=o.gl;this.program=H.createProgram();const Z=yd(d.staticAttributes),G=_?_.getBinderAttributes():[],ne=Z.concat(G),le=Cn.prelude.staticUniforms?yd(Cn.prelude.staticUniforms):[],_e=D.staticUniforms?yd(D.staticUniforms):[],xe=d.staticUniforms?yd(d.staticUniforms):[],be=_?_.getBinderUniforms():[],Ae=le.concat(_e).concat(xe).concat(be),ke=[];for(const nt of Ae)ke.indexOf(nt)<0&&ke.push(nt);const Se=_?_.defines():[];Aa(H)&&Se.unshift("#version 300 es"),C&&Se.push("#define OVERDRAW_INSPECTOR;"),I&&Se.push("#define TERRAIN3D;"),z&&Se.push(z),$&&Se.push(...$);let De=Se.concat(Cn.prelude.fragmentSource,D.fragmentSource,d.fragmentSource).join(`
`),ze=Se.concat(Cn.prelude.vertexSource,D.vertexSource,d.vertexSource).join(`
`);Aa(H)||(De=(function(nt){return nt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(De),ze=(function(nt){return nt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ze));const Re=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Re,De),H.compileShader(Re),!H.getShaderParameter(Re,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(Re)}`);H.attachShader(this.program,Re);const Ve=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ve,ze),H.compileShader(Ve),!H.getShaderParameter(Ve,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(Ve)}`);H.attachShader(this.program,Ve),this.attributes={};const ct={};this.numAttributes=ne.length;for(let nt=0;nt<this.numAttributes;nt++)ne[nt]&&(H.bindAttribLocation(this.program,nt,ne[nt]),this.attributes[ne[nt]]=nt);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(Ve),H.deleteShader(Re);for(let nt=0;nt<ke.length;nt++){const at=ke[nt];if(at&&!ct[at]){const ot=H.getUniformLocation(this.program,at);ot&&(ct[at]=ot)}}this.fixedUniforms=x(o,ct),this.terrainUniforms=((nt,at)=>({u_depth:new s.b_(nt,at.u_depth),u_terrain:new s.b_(nt,at.u_terrain),u_terrain_dim:new s.bq(nt,at.u_terrain_dim),u_terrain_matrix:new s.c0(nt,at.u_terrain_matrix),u_terrain_unpack:new s.c1(nt,at.u_terrain_unpack),u_terrain_exaggeration:new s.bq(nt,at.u_terrain_exaggeration)}))(o,ct),this.projectionUniforms=((nt,at)=>({u_projection_matrix:new s.c0(nt,at.u_projection_matrix),u_projection_tile_mercator_coords:new s.c1(nt,at.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c1(nt,at.u_projection_clipping_plane),u_projection_transition:new s.bq(nt,at.u_projection_transition),u_projection_fallback_matrix:new s.c0(nt,at.u_projection_fallback_matrix)}))(o,ct),this.binderUniforms=_?_.getUniforms(o,ct):[]}draw(o,d,_,x,C,I,D,z,$,H,Z,G,ne,le,_e,xe,be,Ae,ke){const Se=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(x),o.setColorMode(C),o.setCullFace(I),z){o.activeTexture.set(Se.TEXTURE2),Se.bindTexture(Se.TEXTURE_2D,z.depthTexture),o.activeTexture.set(Se.TEXTURE3),Se.bindTexture(Se.TEXTURE_2D,z.texture);for(const ze in this.terrainUniforms)this.terrainUniforms[ze].set(z[ze])}if($)for(const ze in $)this.projectionUniforms[Qa[ze]].set($[ze]);if(D)for(const ze in this.fixedUniforms)this.fixedUniforms[ze].set(D[ze]);xe&&xe.setUniforms(o,this.binderUniforms,le,{zoom:_e});let De=0;switch(d){case Se.LINES:De=2;break;case Se.TRIANGLES:De=3;break;case Se.LINE_STRIP:De=1}for(const ze of ne.get()){const Re=ze.vaos||(ze.vaos={});(Re[H]||(Re[H]=new ef)).bind(o,this,Z,xe?xe.getPaintVertexBuffers():[],G,ze.vertexOffset,be,Ae,ke),Se.drawElements(d,ze.primitiveLength*De,Se.UNSIGNED_SHORT,ze.primitiveOffset*De*2)}}}function Um(A,o,d){const _=1/s.aN(d,1,o.transform.tileZoom),x=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,o.transform.tileZoom)/x,I=C*(d.tileID.canonical.x+d.tileID.wrap*x),D=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,A.fromScale,A.toScale],u_fade:A.t,u_pixel_coord_upper:[I>>16,D>>16],u_pixel_coord_lower:[65535&I,65535&D]}}const vd=(A,o,d,_)=>{const x=A.style.light,C=x.properties.get("position"),I=[C.x,C.y,C.z],D=s.c4();x.properties.get("anchor")==="viewport"&&s.c5(D,A.transform.bearingInRadians),s.c6(I,I,D);const z=A.transform.transformLightDirection(I),$=x.properties.get("color");return{u_lightpos:I,u_lightpos_globe:z,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+o,u_opacity:d,u_fill_translate:_}},bd=(A,o,d,_,x,C,I)=>s.e(vd(A,o,d,_),Um(C,A,I),{u_height_factor:-Math.pow(2,x.overscaledZ)/I.tileSize/8}),Nc=(A,o,d,_)=>s.e(Um(o,A,d),{u_fill_translate:_}),Xu=(A,o)=>({u_world:A,u_fill_translate:o}),Vm=(A,o,d,_,x)=>s.e(Nc(A,o,d,x),{u_world:_}),tf=(A,o,d,_,x)=>{const C=A.transform;let I,D,z=0;if(d.paint.get("circle-pitch-alignment")==="map"){const $=s.aN(o,1,C.zoom);I=!0,D=[$,$],z=$/(s.a5*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*x}else I=!1,D=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:A.pixelRatio,u_extrude_scale:D,u_globe_extrude_scale:z,u_translate:_}},Ul=A=>({u_pixel_extrude_scale:[1/A.width,1/A.height]}),Bp=A=>({u_viewport_size:[A.width,A.height]}),rf=(A,o=1)=>({u_color:A,u_overlay:0,u_overlay_scale:o}),Vl=(A,o,d,_)=>{const x=s.aN(A,1,o)/(s.a5*Math.pow(2,A.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:s.aN(A,1,o),u_intensity:d,u_globe_extrude_scale:x}},Fp=(A,o,d,_)=>{const x=s.N();s.c7(x,0,A.width,A.height,0,0,1);const C=A.context.gl;return{u_matrix:x,u_world:[C.drawingBufferWidth,C.drawingBufferHeight],u_image:d,u_color_ramp:_,u_opacity:o.paint.get("heatmap-opacity")}},nf=(A,o,d)=>{const _=d.paint.get("hillshade-accent-color");let x;switch(d.paint.get("hillshade-method")){case"basic":x=4;break;case"combined":x=1;break;case"igor":x=2;break;case"multidirectional":x=3;break;default:x=0}const C=d.getIlluminationProperties();for(let I=0;I<C.directionRadians.length;I++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(C.directionRadians[I]+=A.transform.bearingInRadians);return{u_image:0,u_latrange:av(0,o.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:C.altitudeRadians,u_azimuths:C.directionRadians,u_accent:_,u_method:x,u_highlights:C.highlightColor,u_shadows:C.shadowColor}},$m=(A,o)=>{const d=o.stride,_=s.N();return s.c7(_,0,s.a5,-s.a5,0,0,1),s.O(_,_,[0,-s.a5,0]),{u_matrix:_,u_image:1,u_dimension:[d,d],u_zoom:A.overscaledZ,u_unpack:o.getUnpackVector()}};function av(A,o){const d=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new s.a9(0,_/d).toLngLat().lat,new s.a9(0,(_+1)/d).toLngLat().lat]}const Wm=(A,o,d=0)=>({u_image:0,u_unpack:o.getUnpackVector(),u_dimension:[o.stride,o.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:A.paint.get("color-relief-opacity")}),sf=(A,o,d,_)=>{const x=A.transform;return{u_translation:af(A,o,d),u_ratio:_/s.aN(o,1,x.zoom),u_device_pixel_ratio:A.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Hm=(A,o,d,_,x)=>s.e(sf(A,o,d,_),{u_image:0,u_image_height:x}),jp=(A,o,d,_,x)=>{const C=A.transform,I=Ea(o,C);return{u_translation:af(A,o,d),u_texsize:o.imageAtlasTexture.size,u_ratio:_/s.aN(o,1,C.zoom),u_device_pixel_ratio:A.pixelRatio,u_image:0,u_scale:[I,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},Ss=(A,o,d,_,x)=>{const C=Ea(o,A.transform);return s.e(sf(A,o,d,_),{u_tileratio:C,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image:0,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})},$l=(A,o,d,_,x,C)=>{const I=Ea(o,A.transform);return s.e(sf(A,o,d,_),{u_image:0,u_image_height:C,u_tileratio:I,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image_dash:1,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})};function Ea(A,o){return 1/s.aN(A,1,o.tileZoom)}function af(A,o,d){return s.aO(A.transform,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const xd=(A,o,d,_,x)=>{return{u_tl_parent:A,u_scale_parent:o,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(I=_.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(C=_.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:wd(_.paint.get("raster-hue-rotate")),u_coords_top:[x[0].x,x[0].y,x[1].x,x[1].y],u_coords_bottom:[x[3].x,x[3].y,x[2].x,x[2].y]};var C,I};function wd(A){A*=Math.PI/180;const o=Math.sin(A),d=Math.cos(A);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const of=(A,o,d,_,x,C,I,D,z,$,H,Z,G)=>{const ne=I.transform;return{u_is_size_zoom_constant:+(A==="constant"||A==="source"),u_is_size_feature_constant:+(A==="constant"||A==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ne.width/ne.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:D,u_coord_matrix:z,u_is_text:+H,u_pitch_with_map:+_,u_is_along_line:x,u_is_variable_anchor:C,u_texsize:Z,u_texture:0,u_translation:$,u_pitched_scale:G}},Td=(A,o,d,_,x,C,I,D,z,$,H,Z,G,ne)=>{const le=I.transform;return s.e(of(A,o,d,_,x,C,I,D,z,$,H,Z,ne),{u_gamma_scale:_?Math.cos(le.pitch*Math.PI/180)*le.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Pa=(A,o,d,_,x,C,I,D,z,$,H,Z,G)=>s.e(Td(A,o,d,_,x,C,I,D,z,$,!0,H,0,G),{u_texsize_icon:Z,u_texture_icon:1}),lf=(A,o)=>({u_opacity:A,u_color:o}),cf=(A,o,d,_,x)=>s.e((function(C,I,D,z){const $=D.imageManager.getPattern(C.from.toString()),H=D.imageManager.getPattern(C.to.toString()),{width:Z,height:G}=D.imageManager.getPixelSize(),ne=Math.pow(2,z.tileID.overscaledZ),le=z.tileSize*Math.pow(2,D.transform.tileZoom)/ne,_e=le*(z.tileID.canonical.x+z.tileID.wrap*ne),xe=le*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[Z,G],u_mix:I.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/s.aN(z,1,D.transform.tileZoom),u_pixel_coord_upper:[_e>>16,xe>>16],u_pixel_coord_lower:[65535&_e,65535&xe]}})(d,x,o,_),{u_opacity:A}),Sd=(A,o)=>{},qm={fillExtrusion:(A,o)=>({u_lightpos:new s.c2(A,o.u_lightpos),u_lightpos_globe:new s.c2(A,o.u_lightpos_globe),u_lightintensity:new s.bq(A,o.u_lightintensity),u_lightcolor:new s.c2(A,o.u_lightcolor),u_vertical_gradient:new s.bq(A,o.u_vertical_gradient),u_opacity:new s.bq(A,o.u_opacity),u_fill_translate:new s.c3(A,o.u_fill_translate)}),fillExtrusionPattern:(A,o)=>({u_lightpos:new s.c2(A,o.u_lightpos),u_lightpos_globe:new s.c2(A,o.u_lightpos_globe),u_lightintensity:new s.bq(A,o.u_lightintensity),u_lightcolor:new s.c2(A,o.u_lightcolor),u_vertical_gradient:new s.bq(A,o.u_vertical_gradient),u_height_factor:new s.bq(A,o.u_height_factor),u_opacity:new s.bq(A,o.u_opacity),u_fill_translate:new s.c3(A,o.u_fill_translate),u_image:new s.b_(A,o.u_image),u_texsize:new s.c3(A,o.u_texsize),u_pixel_coord_upper:new s.c3(A,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,o.u_pixel_coord_lower),u_scale:new s.c2(A,o.u_scale),u_fade:new s.bq(A,o.u_fade)}),fill:(A,o)=>({u_fill_translate:new s.c3(A,o.u_fill_translate)}),fillPattern:(A,o)=>({u_image:new s.b_(A,o.u_image),u_texsize:new s.c3(A,o.u_texsize),u_pixel_coord_upper:new s.c3(A,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,o.u_pixel_coord_lower),u_scale:new s.c2(A,o.u_scale),u_fade:new s.bq(A,o.u_fade),u_fill_translate:new s.c3(A,o.u_fill_translate)}),fillOutline:(A,o)=>({u_world:new s.c3(A,o.u_world),u_fill_translate:new s.c3(A,o.u_fill_translate)}),fillOutlinePattern:(A,o)=>({u_world:new s.c3(A,o.u_world),u_image:new s.b_(A,o.u_image),u_texsize:new s.c3(A,o.u_texsize),u_pixel_coord_upper:new s.c3(A,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,o.u_pixel_coord_lower),u_scale:new s.c2(A,o.u_scale),u_fade:new s.bq(A,o.u_fade),u_fill_translate:new s.c3(A,o.u_fill_translate)}),circle:(A,o)=>({u_camera_to_center_distance:new s.bq(A,o.u_camera_to_center_distance),u_scale_with_map:new s.b_(A,o.u_scale_with_map),u_pitch_with_map:new s.b_(A,o.u_pitch_with_map),u_extrude_scale:new s.c3(A,o.u_extrude_scale),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_globe_extrude_scale:new s.bq(A,o.u_globe_extrude_scale),u_translate:new s.c3(A,o.u_translate)}),collisionBox:(A,o)=>({u_pixel_extrude_scale:new s.c3(A,o.u_pixel_extrude_scale)}),collisionCircle:(A,o)=>({u_viewport_size:new s.c3(A,o.u_viewport_size)}),debug:(A,o)=>({u_color:new s.b$(A,o.u_color),u_overlay:new s.b_(A,o.u_overlay),u_overlay_scale:new s.bq(A,o.u_overlay_scale)}),depth:Sd,clippingMask:Sd,heatmap:(A,o)=>({u_extrude_scale:new s.bq(A,o.u_extrude_scale),u_intensity:new s.bq(A,o.u_intensity),u_globe_extrude_scale:new s.bq(A,o.u_globe_extrude_scale)}),heatmapTexture:(A,o)=>({u_matrix:new s.c0(A,o.u_matrix),u_world:new s.c3(A,o.u_world),u_image:new s.b_(A,o.u_image),u_color_ramp:new s.b_(A,o.u_color_ramp),u_opacity:new s.bq(A,o.u_opacity)}),hillshade:(A,o)=>({u_image:new s.b_(A,o.u_image),u_latrange:new s.c3(A,o.u_latrange),u_exaggeration:new s.bq(A,o.u_exaggeration),u_altitudes:new s.c9(A,o.u_altitudes),u_azimuths:new s.c9(A,o.u_azimuths),u_accent:new s.b$(A,o.u_accent),u_method:new s.b_(A,o.u_method),u_shadows:new s.c8(A,o.u_shadows),u_highlights:new s.c8(A,o.u_highlights)}),hillshadePrepare:(A,o)=>({u_matrix:new s.c0(A,o.u_matrix),u_image:new s.b_(A,o.u_image),u_dimension:new s.c3(A,o.u_dimension),u_zoom:new s.bq(A,o.u_zoom),u_unpack:new s.c1(A,o.u_unpack)}),colorRelief:(A,o)=>({u_image:new s.b_(A,o.u_image),u_unpack:new s.c1(A,o.u_unpack),u_dimension:new s.c3(A,o.u_dimension),u_elevation_stops:new s.b_(A,o.u_elevation_stops),u_color_stops:new s.b_(A,o.u_color_stops),u_color_ramp_size:new s.b_(A,o.u_color_ramp_size),u_opacity:new s.bq(A,o.u_opacity)}),line:(A,o)=>({u_translation:new s.c3(A,o.u_translation),u_ratio:new s.bq(A,o.u_ratio),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,o.u_units_to_pixels)}),lineGradient:(A,o)=>({u_translation:new s.c3(A,o.u_translation),u_ratio:new s.bq(A,o.u_ratio),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,o.u_units_to_pixels),u_image:new s.b_(A,o.u_image),u_image_height:new s.bq(A,o.u_image_height)}),linePattern:(A,o)=>({u_translation:new s.c3(A,o.u_translation),u_texsize:new s.c3(A,o.u_texsize),u_ratio:new s.bq(A,o.u_ratio),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_image:new s.b_(A,o.u_image),u_units_to_pixels:new s.c3(A,o.u_units_to_pixels),u_scale:new s.c2(A,o.u_scale),u_fade:new s.bq(A,o.u_fade)}),lineSDF:(A,o)=>({u_translation:new s.c3(A,o.u_translation),u_ratio:new s.bq(A,o.u_ratio),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,o.u_units_to_pixels),u_image:new s.b_(A,o.u_image),u_mix:new s.bq(A,o.u_mix),u_tileratio:new s.bq(A,o.u_tileratio),u_crossfade_from:new s.bq(A,o.u_crossfade_from),u_crossfade_to:new s.bq(A,o.u_crossfade_to),u_lineatlas_width:new s.bq(A,o.u_lineatlas_width),u_lineatlas_height:new s.bq(A,o.u_lineatlas_height)}),lineGradientSDF:(A,o)=>({u_translation:new s.c3(A,o.u_translation),u_ratio:new s.bq(A,o.u_ratio),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,o.u_units_to_pixels),u_image:new s.b_(A,o.u_image),u_image_height:new s.bq(A,o.u_image_height),u_tileratio:new s.bq(A,o.u_tileratio),u_crossfade_from:new s.bq(A,o.u_crossfade_from),u_crossfade_to:new s.bq(A,o.u_crossfade_to),u_image_dash:new s.b_(A,o.u_image_dash),u_mix:new s.bq(A,o.u_mix),u_lineatlas_width:new s.bq(A,o.u_lineatlas_width),u_lineatlas_height:new s.bq(A,o.u_lineatlas_height)}),raster:(A,o)=>({u_tl_parent:new s.c3(A,o.u_tl_parent),u_scale_parent:new s.bq(A,o.u_scale_parent),u_buffer_scale:new s.bq(A,o.u_buffer_scale),u_fade_t:new s.bq(A,o.u_fade_t),u_opacity:new s.bq(A,o.u_opacity),u_image0:new s.b_(A,o.u_image0),u_image1:new s.b_(A,o.u_image1),u_brightness_low:new s.bq(A,o.u_brightness_low),u_brightness_high:new s.bq(A,o.u_brightness_high),u_saturation_factor:new s.bq(A,o.u_saturation_factor),u_contrast_factor:new s.bq(A,o.u_contrast_factor),u_spin_weights:new s.c2(A,o.u_spin_weights),u_coords_top:new s.c1(A,o.u_coords_top),u_coords_bottom:new s.c1(A,o.u_coords_bottom)}),symbolIcon:(A,o)=>({u_is_size_zoom_constant:new s.b_(A,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,o.u_is_size_feature_constant),u_size_t:new s.bq(A,o.u_size_t),u_size:new s.bq(A,o.u_size),u_camera_to_center_distance:new s.bq(A,o.u_camera_to_center_distance),u_pitch:new s.bq(A,o.u_pitch),u_rotate_symbol:new s.b_(A,o.u_rotate_symbol),u_aspect_ratio:new s.bq(A,o.u_aspect_ratio),u_fade_change:new s.bq(A,o.u_fade_change),u_label_plane_matrix:new s.c0(A,o.u_label_plane_matrix),u_coord_matrix:new s.c0(A,o.u_coord_matrix),u_is_text:new s.b_(A,o.u_is_text),u_pitch_with_map:new s.b_(A,o.u_pitch_with_map),u_is_along_line:new s.b_(A,o.u_is_along_line),u_is_variable_anchor:new s.b_(A,o.u_is_variable_anchor),u_texsize:new s.c3(A,o.u_texsize),u_texture:new s.b_(A,o.u_texture),u_translation:new s.c3(A,o.u_translation),u_pitched_scale:new s.bq(A,o.u_pitched_scale)}),symbolSDF:(A,o)=>({u_is_size_zoom_constant:new s.b_(A,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,o.u_is_size_feature_constant),u_size_t:new s.bq(A,o.u_size_t),u_size:new s.bq(A,o.u_size),u_camera_to_center_distance:new s.bq(A,o.u_camera_to_center_distance),u_pitch:new s.bq(A,o.u_pitch),u_rotate_symbol:new s.b_(A,o.u_rotate_symbol),u_aspect_ratio:new s.bq(A,o.u_aspect_ratio),u_fade_change:new s.bq(A,o.u_fade_change),u_label_plane_matrix:new s.c0(A,o.u_label_plane_matrix),u_coord_matrix:new s.c0(A,o.u_coord_matrix),u_is_text:new s.b_(A,o.u_is_text),u_pitch_with_map:new s.b_(A,o.u_pitch_with_map),u_is_along_line:new s.b_(A,o.u_is_along_line),u_is_variable_anchor:new s.b_(A,o.u_is_variable_anchor),u_texsize:new s.c3(A,o.u_texsize),u_texture:new s.b_(A,o.u_texture),u_gamma_scale:new s.bq(A,o.u_gamma_scale),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_is_halo:new s.b_(A,o.u_is_halo),u_translation:new s.c3(A,o.u_translation),u_pitched_scale:new s.bq(A,o.u_pitched_scale)}),symbolTextAndIcon:(A,o)=>({u_is_size_zoom_constant:new s.b_(A,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,o.u_is_size_feature_constant),u_size_t:new s.bq(A,o.u_size_t),u_size:new s.bq(A,o.u_size),u_camera_to_center_distance:new s.bq(A,o.u_camera_to_center_distance),u_pitch:new s.bq(A,o.u_pitch),u_rotate_symbol:new s.b_(A,o.u_rotate_symbol),u_aspect_ratio:new s.bq(A,o.u_aspect_ratio),u_fade_change:new s.bq(A,o.u_fade_change),u_label_plane_matrix:new s.c0(A,o.u_label_plane_matrix),u_coord_matrix:new s.c0(A,o.u_coord_matrix),u_is_text:new s.b_(A,o.u_is_text),u_pitch_with_map:new s.b_(A,o.u_pitch_with_map),u_is_along_line:new s.b_(A,o.u_is_along_line),u_is_variable_anchor:new s.b_(A,o.u_is_variable_anchor),u_texsize:new s.c3(A,o.u_texsize),u_texsize_icon:new s.c3(A,o.u_texsize_icon),u_texture:new s.b_(A,o.u_texture),u_texture_icon:new s.b_(A,o.u_texture_icon),u_gamma_scale:new s.bq(A,o.u_gamma_scale),u_device_pixel_ratio:new s.bq(A,o.u_device_pixel_ratio),u_is_halo:new s.b_(A,o.u_is_halo),u_translation:new s.c3(A,o.u_translation),u_pitched_scale:new s.bq(A,o.u_pitched_scale)}),background:(A,o)=>({u_opacity:new s.bq(A,o.u_opacity),u_color:new s.b$(A,o.u_color)}),backgroundPattern:(A,o)=>({u_opacity:new s.bq(A,o.u_opacity),u_image:new s.b_(A,o.u_image),u_pattern_tl_a:new s.c3(A,o.u_pattern_tl_a),u_pattern_br_a:new s.c3(A,o.u_pattern_br_a),u_pattern_tl_b:new s.c3(A,o.u_pattern_tl_b),u_pattern_br_b:new s.c3(A,o.u_pattern_br_b),u_texsize:new s.c3(A,o.u_texsize),u_mix:new s.bq(A,o.u_mix),u_pattern_size_a:new s.c3(A,o.u_pattern_size_a),u_pattern_size_b:new s.c3(A,o.u_pattern_size_b),u_scale_a:new s.bq(A,o.u_scale_a),u_scale_b:new s.bq(A,o.u_scale_b),u_pixel_coord_upper:new s.c3(A,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,o.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bq(A,o.u_tile_units_to_pixels)}),terrain:(A,o)=>({u_texture:new s.b_(A,o.u_texture),u_ele_delta:new s.bq(A,o.u_ele_delta),u_fog_matrix:new s.c0(A,o.u_fog_matrix),u_fog_color:new s.b$(A,o.u_fog_color),u_fog_ground_blend:new s.bq(A,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bq(A,o.u_fog_ground_blend_opacity),u_horizon_color:new s.b$(A,o.u_horizon_color),u_horizon_fog_blend:new s.bq(A,o.u_horizon_fog_blend),u_is_globe_mode:new s.bq(A,o.u_is_globe_mode)}),terrainDepth:(A,o)=>({u_ele_delta:new s.bq(A,o.u_ele_delta)}),terrainCoords:(A,o)=>({u_texture:new s.b_(A,o.u_texture),u_terrain_coords_id:new s.bq(A,o.u_terrain_coords_id),u_ele_delta:new s.bq(A,o.u_ele_delta)}),projectionErrorMeasurement:(A,o)=>({u_input:new s.bq(A,o.u_input),u_output_expected:new s.bq(A,o.u_output_expected)}),atmosphere:(A,o)=>({u_sun_pos:new s.c2(A,o.u_sun_pos),u_atmosphere_blend:new s.bq(A,o.u_atmosphere_blend),u_globe_position:new s.c2(A,o.u_globe_position),u_globe_radius:new s.bq(A,o.u_globe_radius),u_inv_proj_matrix:new s.c0(A,o.u_inv_proj_matrix)}),sky:(A,o)=>({u_sky_color:new s.b$(A,o.u_sky_color),u_horizon_color:new s.b$(A,o.u_horizon_color),u_horizon:new s.c3(A,o.u_horizon),u_horizon_normal:new s.c3(A,o.u_horizon_normal),u_sky_horizon_blend:new s.bq(A,o.u_sky_horizon_blend),u_sky_blend:new s.bq(A,o.u_sky_blend)})};class zc{constructor(o,d,_){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Up{constructor(o,d,_,x){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),o.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let _=0;_<this.attributes.length;_++){const x=d.attributes[this.attributes[_].name];x!==void 0&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,d,_){for(let x=0;x<this.attributes.length;x++){const C=this.attributes[x],I=d.attributes[C.name];I!==void 0&&o.vertexAttribPointer(I,C.components,o[Bc[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Eo extends Xr{getDefault(){return s.bp.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class uf extends Xr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class hf extends Xr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ad extends Xr{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Fc extends Xr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ff extends Xr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Gu extends Xr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Ks extends Xr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Vp extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ed extends Xr{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Qs extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Po extends Xr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class us extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class tl extends Xr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class jc extends Xr{getDefault(){return s.bp.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Uc extends Xr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class df extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Wl extends Xr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ca extends Xr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class $p extends Xr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Zu extends Xr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Pr extends Xr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Pd extends Xr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Js extends Xr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Cd extends Xr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ea extends Xr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xm extends Xr{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Md extends Xr{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const _=this.gl;Aa(_)?_.bindVertexArray(o):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Hl extends Xr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Wp extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Id extends Xr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ql extends Xr{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Yu extends ql{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class hs extends ql{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Xl extends ql{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}const Gl="Framebuffer is not complete";class Vc{constructor(o,d,_,x,C){this.context=o,this.width=d,this.height=_;const I=o.gl,D=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Yu(o,D),x)this.depthAttachment=C?new Xl(o,D):new hs(o,D);else if(C)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(Gl)}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class Zl{constructor(o){var d,_;if(this.gl=o,this.clearColor=new Eo(this),this.clearDepth=new uf(this),this.clearStencil=new hf(this),this.colorMask=new Ad(this),this.depthMask=new Fc(this),this.stencilMask=new ff(this),this.stencilFunc=new Gu(this),this.stencilOp=new Ks(this),this.stencilTest=new Vp(this),this.depthRange=new Ed(this),this.depthTest=new Qs(this),this.depthFunc=new Po(this),this.blend=new us(this),this.blendFunc=new tl(this),this.blendColor=new jc(this),this.blendEquation=new Uc(this),this.cullFace=new df(this),this.cullFaceSide=new Wl(this),this.frontFace=new Ca(this),this.program=new $p(this),this.activeTexture=new Zu(this),this.viewport=new Pr(this),this.bindFramebuffer=new Pd(this),this.bindRenderbuffer=new Js(this),this.bindTexture=new Cd(this),this.bindVertexBuffer=new ea(this),this.bindElementBuffer=new Xm(this),this.bindVertexArray=new Md(this),this.pixelStoreUnpack=new Hl(this),this.pixelStoreUnpackPremultiplyAlpha=new Wp(this),this.pixelStoreUnpackFlipY=new Id(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Aa(o)){this.HALF_FLOAT=o.HALF_FLOAT;const x=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:x?.RGBA16F_EXT,this.RGB16F=(_=o.RGB16F)!==null&&_!==void 0?_:x?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const x=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=x?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new zc(this,o,d)}createVertexBuffer(o,d,_){return new Up(this,o,d,_)}createRenderbuffer(o,d,_){const x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,o,d,_),this.bindRenderbuffer.set(null),C}createFramebuffer(o,d,_,x){return new Vc(this,o,d,_,x)}clear({color:o,depth:d,stencil:_}){const x=this.gl;let C=0;o&&(C|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(C|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(C|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(C)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.bR(o.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Aa(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return Aa(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let wi;function Ei(A,o,d,_,x){const C=A.context,I=A.transform,D=C.gl,z=A.useProgram("collisionBox"),$=[];let H=0,Z=0;for(let be=0;be<_.length;be++){const Ae=_[be],ke=o.getTile(Ae).getBucket(d);if(!ke)continue;const Se=x?ke.textCollisionBox:ke.iconCollisionBox,De=ke.collisionCircleArray;De.length>0&&($.push({circleArray:De,circleOffset:Z,coord:Ae}),H+=De.length/4,Z=H),Se&&z.draw(C,D.LINES,Er.disabled,jr.disabled,A.colorModeForRenderPass(),kr.disabled,Ul(A.transform),A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ae),I.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,A.transform.zoom,null,null,Se.collisionVertexBuffer)}if(!x||!$.length)return;const G=A.useProgram("collisionCircle"),ne=new s.ca;ne.resize(4*H),ne._trim();let le=0;for(const be of $)for(let Ae=0;Ae<be.circleArray.length/4;Ae++){const ke=4*Ae,Se=be.circleArray[ke+0],De=be.circleArray[ke+1],ze=be.circleArray[ke+2],Re=be.circleArray[ke+3];ne.emplace(le++,Se,De,ze,Re,0),ne.emplace(le++,Se,De,ze,Re,1),ne.emplace(le++,Se,De,ze,Re,2),ne.emplace(le++,Se,De,ze,Re,3)}(!wi||wi.length<2*H)&&(wi=(function(be){const Ae=2*be,ke=new s.cc;ke.resize(Ae),ke._trim();for(let Se=0;Se<Ae;Se++){const De=6*Se;ke.uint16[De+0]=4*Se+0,ke.uint16[De+1]=4*Se+1,ke.uint16[De+2]=4*Se+2,ke.uint16[De+3]=4*Se+2,ke.uint16[De+4]=4*Se+3,ke.uint16[De+5]=4*Se+0}return ke})(H));const _e=C.createIndexBuffer(wi,!0),xe=C.createVertexBuffer(ne,s.cb.members,!0);for(const be of $){const Ae=Bp(A.transform);G.draw(C,D.TRIANGLES,Er.disabled,jr.disabled,A.colorModeForRenderPass(),kr.disabled,Ae,A.style.map.terrain&&A.style.map.terrain.getTerrainData(be.coord),null,d.id,xe,_e,s.aX.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,A.transform.zoom,null,null,null)}xe.destroy(),_e.destroy()}const Co=s.ar(new Float32Array(16));function Mo(A,o,d,_,x,C){const{horizontalAlign:I,verticalAlign:D}=s.aS(A);return new s.P((-(I-.5)*o/x+_[0])*C,(-(D-.5)*d/x+_[1])*C)}function As(A,o,d,_,x,C){const I=o.tileAnchorPoint.add(new s.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let D=_.mult(C);d||(D=D.rotate(-x));const z=I.add(D);return Ar(z.x,z.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(d){const D=Fr(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(A),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return A.add(_.rotate(z))}return A.add(_)}function rl(A,o,d,_,x,C,I,D,z,$,H,Z){const G=A.text.placedSymbolArray,ne=A.text.dynamicLayoutVertexArray,le=A.icon.dynamicLayoutVertexArray,_e={};ne.clear();for(let xe=0;xe<G.length;xe++){const be=G.get(xe),Ae=be.hidden||!be.crossTileID||A.allowVerticalPlacement&&!be.placedOrientation?null:_[be.crossTileID];if(Ae){const ke=new s.P(be.anchorX,be.anchorY),Se={getElevation:Z,width:x.width,height:x.height,pitchedLabelPlaneMatrix:C,pitchWithMap:d,transform:x,tileAnchorPoint:ke,translation:$,unwrappedTileID:H},De=d?Nu(ke.x,ke.y,Se):Fr(ke.x,ke.y,Se),ze=Pc(x.cameraToCenterDistance,De.signedDistanceFromCamera);let Re=s.aA(A.textSizeData,D,be)*ze/s.aM;d&&(Re*=A.tilePixelRatio/I);const{width:Ve,height:ct,anchor:nt,textOffset:at,textBoxScale:ot}=Ae,Ft=Mo(nt,Ve,ct,at,ot,Re),Ut=x.getPitchedTextCorrection(ke.x+$[0],ke.y+$[1],H),Pt=As(De.point,Se,o,Ft,-x.bearingInRadians,Ut),$t=A.allowVerticalPlacement&&be.placedOrientation===s.az.vertical?Math.PI/2:0;for(let xr=0;xr<be.numGlyphs;xr++)s.aG(ne,Pt,$t);z&&be.associatedIconIndex>=0&&(_e[be.associatedIconIndex]={shiftedAnchor:Pt,angle:$t})}else To(be.numGlyphs,ne)}if(z){le.clear();const xe=A.icon.placedSymbolArray;for(let be=0;be<xe.length;be++){const Ae=xe.get(be);if(Ae.hidden)To(Ae.numGlyphs,le);else{const ke=_e[be];if(ke)for(let Se=0;Se<Ae.numGlyphs;Se++)s.aG(le,ke.shiftedAnchor,ke.angle);else To(Ae.numGlyphs,le)}}A.icon.dynamicLayoutVertexBuffer.updateData(le)}A.text.dynamicLayoutVertexBuffer.updateData(ne)}function Hp(A,o,d){return d.iconsInText&&o?"symbolTextAndIcon":A?"symbolSDF":"symbolIcon"}function $c(A,o,d,_,x,C,I,D,z,$,H,Z,G){const ne=A.context,le=ne.gl,_e=A.transform,xe=D==="map",be=z==="map",Ae=D!=="viewport"&&d.layout.get("symbol-placement")!=="point",ke=xe&&!be&&!Ae,Se=!d.layout.get("symbol-sort-key").isConstant();let De=!1;const ze=A.getDepthModeForSublayer(0,Er.ReadOnly),Re=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ve=[],ct=_e.getCircleRadiusCorrection();for(const nt of _){const at=o.getTile(nt),ot=at.getBucket(d);if(!ot)continue;const Ft=x?ot.text:ot.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const Ut=Ft.programConfigurations.get(d.id),Pt=x||ot.sdfIcons,$t=x?ot.textSizeData:ot.iconSizeData,xr=be||_e.pitch!==0,Qr=A.useProgram(Hp(Pt,x,ot),Ut),_n=s.ay($t,_e.zoom),fn=A.style.map.terrain&&A.style.map.terrain.getTerrainData(nt);let Tn,an,Fn,Sn,Ci=[0,0],Zn=null;if(x)an=at.glyphAtlasTexture,Fn=le.LINEAR,Tn=at.glyphAtlasTexture.size,ot.iconsInText&&(Ci=at.imageAtlasTexture.size,Zn=at.imageAtlasTexture,Sn=xr||A.options.rotating||A.options.zooming||$t.kind==="composite"||$t.kind==="camera"?le.LINEAR:le.NEAREST);else{const rn=d.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear;an=at.imageAtlasTexture,Fn=Pt||A.options.rotating||A.options.zooming||rn||xr?le.LINEAR:le.NEAREST,Tn=at.imageAtlasTexture.size}const Yn=s.aN(at,1,A.transform.zoom),Mi=Gs(xe,A.transform,Yn),Vo=s.N();s.aB(Vo,Mi);const $o=dd(be,xe,A.transform,Yn),so=s.aO(_e,at,C,I),Ms=_e.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),Qc=Re&&ot.hasTextData(),ah=d.layout.get("icon-text-fit")!=="none"&&Qc&&ot.hasIconData();if(Ae){const rn=A.style.map.terrain?(ci,pi)=>A.style.map.terrain.getElevation(nt,ci,pi):null,dn=d.layout.get("text-rotation-alignment")==="map";Qo(ot,A,x,Mi,Vo,be,$,dn,nt.toUnwrapped(),_e.width,_e.height,so,rn)}const ao=x&&Re||ah,Is=Ae||ao?Co:be?Mi:A.transform.clipSpaceToPixelsMatrix,sa=Pt&&d.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ka;ka=Pt?ot.iconsInText?Pa($t.kind,_n,ke,be,Ae,ao,A,Is,$o,so,Tn,Ci,ct):Td($t.kind,_n,ke,be,Ae,ao,A,Is,$o,so,x,Tn,0,ct):of($t.kind,_n,ke,be,Ae,ao,A,Is,$o,so,x,Tn,ct);const La={program:Qr,buffers:Ft,uniformValues:ka,projectionData:Ms,atlasTexture:an,atlasTextureIcon:Zn,atlasInterpolation:Fn,atlasInterpolationIcon:Sn,isSDF:Pt,hasHalo:sa};if(Se&&ot.canOverlap){De=!0;const rn=Ft.segments.get();for(const dn of rn)Ve.push({segments:new s.aX([dn]),sortKey:dn.sortKey,state:La,terrainData:fn})}else Ve.push({segments:Ft.segments,sortKey:0,state:La,terrainData:fn})}De&&Ve.sort(((nt,at)=>nt.sortKey-at.sortKey));for(const nt of Ve){const at=nt.state;if(ne.activeTexture.set(le.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,le.CLAMP_TO_EDGE),at.atlasTextureIcon&&(ne.activeTexture.set(le.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),at.isSDF){const ot=at.uniformValues;at.hasHalo&&(ot.u_is_halo=1,Ku(at.buffers,nt.segments,d,A,at.program,ze,H,Z,ot,at.projectionData,nt.terrainData)),ot.u_is_halo=0}Ku(at.buffers,nt.segments,d,A,at.program,ze,H,Z,at.uniformValues,at.projectionData,nt.terrainData)}}function Ku(A,o,d,_,x,C,I,D,z,$,H){const Z=_.context;x.draw(Z,Z.gl.TRIANGLES,C,I,D,kr.backCCW,z,H,$,d.id,A.layoutVertexBuffer,A.indexBuffer,o,d.paint,_.transform.zoom,A.programConfigurations.get(d.id),A.dynamicLayoutVertexBuffer,A.opacityVertexBuffer)}function qp(A,o,d,_,x){const C=A.context,I=C.gl,D=jr.disabled,z=new sn([I.ONE,I.ONE],s.bp.transparent,[!0,!0,!0,!0]),$=o.getBucket(d);if(!$)return;const H=_.key;let Z=d.heatmapFbos.get(H);Z||(Z=hn(C,o.tileSize,o.tileSize),d.heatmapFbos.set(H,Z)),C.bindFramebuffer.set(Z.framebuffer),C.viewport.set([0,0,o.tileSize,o.tileSize]),C.clear({color:s.bp.transparent});const G=$.programConfigurations.get(d.id),ne=A.useProgram("heatmap",G,!x),le=A.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),_e=A.style.map.terrain.getTerrainData(_);ne.draw(C,I.TRIANGLES,Er.disabled,D,z,kr.disabled,Vl(o,A.transform.zoom,d.paint.get("heatmap-intensity"),1),_e,le,d.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,d.paint,A.transform.zoom,G)}function Pi(A,o,d,_,x){const C=A.context,I=C.gl,D=A.transform;C.setColorMode(A.colorModeForRenderPass());const z=zr(C,o),$=d.key,H=o.heatmapFbos.get($);if(!H)return;C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,H.colorAttachment.get()),C.activeTexture.set(I.TEXTURE1),z.bind(I.LINEAR,I.CLAMP_TO_EDGE);const Z=D.getProjectionData({overscaledTileID:d,applyTerrainMatrix:x,applyGlobeMatrix:!_});A.useProgram("heatmapTexture").draw(C,I.TRIANGLES,Er.disabled,jr.disabled,A.colorModeForRenderPass(),kr.disabled,Fp(A,o,0,1),null,Z,o.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments,o.paint,D.zoom),H.destroy(),o.heatmapFbos.delete($)}function hn(A,o,d){var _,x;const C=A.gl,I=C.createTexture();C.bindTexture(C.TEXTURE_2D,I),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR);const D=(_=A.HALF_FLOAT)!==null&&_!==void 0?_:C.UNSIGNED_BYTE,z=(x=A.RGBA16F)!==null&&x!==void 0?x:C.RGBA;C.texImage2D(C.TEXTURE_2D,0,z,o,d,0,C.RGBA,D,null);const $=A.createFramebuffer(o,d,!1,!1);return $.colorAttachment.set(I),$}function zr(A,o){return o.colorRampTexture||(o.colorRampTexture=new s.T(A,o.colorRamp,A.gl.RGBA)),o.colorRampTexture}function nl(A,o,d,_,x,C,I,D){let z=256;if(x.stepInterpolant){const $=o.getSource().maxzoom,H=I.canonical.z===$?Math.ceil(1<<A.transform.maxZoom-I.canonical.z):1;z=s.an(s.ce(C.maxLineLength/s.a5*1024*H),256,d.maxTextureSize)}return D.gradient=s.cf({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:z,image:D.gradient||void 0,clips:C.lineClipsArray}),D.texture?D.texture.update(D.gradient):D.texture=new s.T(d,D.gradient,_.RGBA),D.version=x.gradientVersion,D.texture}function ta(A,o,d,_,x){A.activeTexture.set(o.TEXTURE0),d.imageAtlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),_.updatePaintBuffers(x)}function zn(A,o,d,_,x,C){(x||A.lineAtlas.dirty)&&(o.activeTexture.set(d.TEXTURE0),A.lineAtlas.bind(o)),_.updatePaintBuffers(C)}function Es(A,o,d,_,x,C,I){const D=C.gradients[x.id];let z=D.texture;x.gradientVersion!==D.version&&(z=nl(A,o,d,_,x,C,I,D)),d.activeTexture.set(_.TEXTURE0),z.bind(x.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}function Ps(A,o,d,_,x,C,I,D,z){const $=C.gradients[x.id];let H=$.texture;x.gradientVersion!==$.version&&(H=nl(A,o,d,_,x,C,I,$)),d.activeTexture.set(_.TEXTURE0),H.bind(x.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE),d.activeTexture.set(_.TEXTURE1),A.lineAtlas.bind(d),D.updatePaintBuffers(z)}function pf(A,o,d,_,x){if(!d||!_||!_.imageAtlas)return;const C=_.imageAtlas.patternPositions;let I=C[d.to.toString()],D=C[d.from.toString()];if(!I&&D&&(I=D),!D&&I&&(D=I),!I||!D){const z=x.getPaintProperty(o);I=C[z],D=C[z]}I&&D&&A.setConstantPatternPositions(I,D)}function Io(A,o,d,_,x,C,I,D){const z=A.context.gl,$="fill-pattern",H=d.paint.get($),Z=H&&H.constantOr(1),G=d.getCrossfadeParameters();let ne,le,_e,xe,be;const Ae=A.transform,ke=d.paint.get("fill-translate"),Se=d.paint.get("fill-translate-anchor");I?(le=Z&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=z.LINES):(le=Z?"fillPattern":"fill",ne=z.TRIANGLES);const De=H.constantOr(null);for(const ze of _){const Re=o.getTile(ze);if(Z&&!Re.patternsLoaded())continue;const Ve=Re.getBucket(d);if(!Ve)continue;const ct=Ve.programConfigurations.get(d.id),nt=A.useProgram(le,ct),at=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ze);Z&&(A.context.activeTexture.set(z.TEXTURE0),Re.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ct.updatePaintBuffers(G)),pf(ct,$,De,Re,d);const ot=Ae.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Ft=s.aO(Ae,Re,ke,Se);if(I){xe=Ve.indexBuffer2,be=Ve.segments2;const Pt=[z.drawingBufferWidth,z.drawingBufferHeight];_e=le==="fillOutlinePattern"&&Z?Vm(A,G,Re,Pt,Ft):Xu(Pt,Ft)}else xe=Ve.indexBuffer,be=Ve.segments,_e=Z?Nc(A,G,Re,Ft):{u_fill_translate:Ft};const Ut=A.stencilModeForClipping(ze);nt.draw(A.context,ne,x,Ut,C,kr.backCCW,_e,at,ot,d.id,Ve.layoutVertexBuffer,xe,be,d.paint,A.transform.zoom,ct)}}function Ro(A,o,d,_,x,C,I,D){const z=A.context,$=z.gl,H="fill-extrusion-pattern",Z=d.paint.get(H),G=Z.constantOr(1),ne=d.getCrossfadeParameters(),le=d.paint.get("fill-extrusion-opacity"),_e=Z.constantOr(null),xe=A.transform;for(const be of _){const Ae=o.getTile(be),ke=Ae.getBucket(d);if(!ke)continue;const Se=A.style.map.terrain&&A.style.map.terrain.getTerrainData(be),De=ke.programConfigurations.get(d.id),ze=A.useProgram(G?"fillExtrusionPattern":"fillExtrusion",De);G&&(A.context.activeTexture.set($.TEXTURE0),Ae.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),De.updatePaintBuffers(ne));const Re=xe.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!D,applyTerrainMatrix:!0});pf(De,H,_e,Ae,d);const Ve=s.aO(xe,Ae,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ct=d.paint.get("fill-extrusion-vertical-gradient"),nt=G?bd(A,ct,le,Ve,be,ne,Ae):vd(A,ct,le,Ve);ze.draw(z,z.gl.TRIANGLES,x,C,I,kr.backCCW,nt,Se,Re,d.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,d.paint,A.transform.zoom,De,A.style.map.terrain&&ke.centroidVertexBuffer)}}function Oo(A,o,d,_,x,C,I,D,z){var $;const H=A.style.projection,Z=A.context,G=A.transform,ne=Z.gl,le=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],_e=A.useProgram("hillshade",null,!1,le),xe=!A.options.moving;for(const be of _){const Ae=o.getTile(be),ke=Ae.fbo;if(!ke)continue;const Se=H.getMeshFromTileID(Z,be.canonical,D,!0,"raster"),De=($=A.style.map.terrain)===null||$===void 0?void 0:$.getTerrainData(be);Z.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,ke.colorAttachment.get());const ze=G.getProjectionData({overscaledTileID:be,aligned:xe,applyGlobeMatrix:!z,applyTerrainMatrix:!0});_e.draw(Z,ne.TRIANGLES,C,x[be.overscaledZ],I,kr.backCCW,nf(A,Ae,d),De,ze,d.id,Se.vertexBuffer,Se.indexBuffer,Se.segments)}}function il(A,o,d,_,x,C,I,D,z){var $;const H=A.style.projection,Z=A.context,G=A.transform,ne=Z.gl,le=A.useProgram("colorRelief"),_e=!A.options.moving;let xe=!0,be=0;for(const Ae of _){const ke=o.getTile(Ae),Se=ke.dem;if(xe){const nt=ne.getParameter(ne.MAX_TEXTURE_SIZE),{elevationTexture:at,colorTexture:ot}=d.getColorRampTextures(Z,nt,Se.getUnpackVector());Z.activeTexture.set(ne.TEXTURE1),at.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),Z.activeTexture.set(ne.TEXTURE4),ot.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),xe=!1,be=at.size[0]}if(!Se||!Se.data)continue;const De=Se.stride,ze=Se.getPixels();if(Z.activeTexture.set(ne.TEXTURE0),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||A.getTileTexture(De),ke.demTexture){const nt=ke.demTexture;nt.update(ze,{premultiply:!1}),nt.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}else ke.demTexture=new s.T(Z,ze,ne.RGBA,{premultiply:!1}),ke.demTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Re=H.getMeshFromTileID(Z,Ae.canonical,D,!0,"raster"),Ve=($=A.style.map.terrain)===null||$===void 0?void 0:$.getTerrainData(Ae),ct=G.getProjectionData({overscaledTileID:Ae,aligned:_e,applyGlobeMatrix:!z,applyTerrainMatrix:!0});le.draw(Z,ne.TRIANGLES,C,x[Ae.overscaledZ],I,kr.backCCW,Wm(d,ke.dem,be),Ve,ct,d.id,Re.vertexBuffer,Re.indexBuffer,Re.segments)}}const sl=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function Ma(A,o,d,_,x,C,I,D,z=!1,$=!1){const H=_[_.length-1].overscaledZ,Z=A.context,G=Z.gl,ne=A.useProgram("raster"),le=A.transform,_e=A.style.projection,xe=A.colorModeForRenderPass(),be=!A.options.moving,Ae=d.paint.get("raster-opacity"),ke=d.paint.get("raster-resampling"),Se=d.paint.get("raster-fade-duration"),De=!!A.style.map.terrain;for(const ze of _){const Re=A.getDepthModeForSublayer(ze.overscaledZ-H,Ae===1?Er.ReadWrite:Er.ReadOnly,G.LESS),Ve=o.getTile(ze),ct=ke==="nearest"?G.NEAREST:G.LINEAR;Z.activeTexture.set(G.TEXTURE0),Ve.texture.bind(ct,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(G.TEXTURE1);const{parentTile:nt,parentScaleBy:at,parentTopLeft:ot,fadeValues:Ft}=Do(Ve,o,Se,De);Ve.fadeOpacity=Ft.tileOpacity,nt?(nt.fadeOpacity=Ft.parentTileOpacity,nt.texture.bind(ct,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST)):Ve.texture.bind(ct,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Ve.texture.useMipmap&&Z.extTextureFilterAnisotropic&&A.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const Ut=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ze),Pt=le.getProjectionData({overscaledTileID:ze,aligned:be,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),$t=xd(ot,at,Ft.fadeMix,d,D),xr=_e.getMeshFromTileID(Z,ze.canonical,C,I,"raster");ne.draw(Z,G.TRIANGLES,Re,x?x[ze.overscaledZ]:jr.disabled,xe,z?kr.frontCCW:kr.backCCW,$t,Ut,Pt,d.id,xr.vertexBuffer,xr.indexBuffer,xr.segments)}}function Do(A,o,d,_){const x={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(d===0||_)return x;if(A.fadingParentID){const C=o.getLoadedTile(A.fadingParentID);if(!C)return x;const I=Math.pow(2,C.tileID.overscaledZ-A.tileID.overscaledZ),D=[A.tileID.canonical.x*I%1,A.tileID.canonical.y*I%1],z=(function($,H,Z){const G=W(),ne=(G-H.timeAdded)/Z,le=$.fadingDirection===Pe.Incoming,_e=s.an((G-$.timeAdded)/Z,0,1),xe=s.an(1-ne,0,1),be=le?_e:xe;return{tileOpacity:be,parentTileOpacity:le?xe:_e,fadeMix:{opacity:1,mix:1-be}}})(A,C,d);return{parentTile:C,parentScaleBy:I,parentTopLeft:D,fadeValues:z}}if(A.selfFading){const C=(function(I,D){const z=(W()-I.timeAdded)/D,$=s.an(z,0,1);return{tileOpacity:$,fadeMix:{opacity:$,mix:0}}})(A,d);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:C}}return x}const al=new s.bp(1,0,0,1),ko=new s.bp(0,1,0,1),Rd=new s.bp(0,0,1,1),Od=new s.bp(1,0,1,1),ra=new s.bp(0,1,1,1);function Qu(A,o,d,_){li(A,0,o+d/2,A.transform.width,d,_)}function ol(A,o,d,_){li(A,o-d/2,0,d,A.transform.height,_)}function li(A,o,d,_,x,C){const I=A.context,D=I.gl;D.enable(D.SCISSOR_TEST),D.scissor(o*A.pixelRatio,d*A.pixelRatio,_*A.pixelRatio,x*A.pixelRatio),I.clear({color:C}),D.disable(D.SCISSOR_TEST)}function gf(A,o,d){const _=A.context,x=_.gl,C=A.useProgram("debug"),I=Er.disabled,D=jr.disabled,z=A.colorModeForRenderPass(),$="$debug",H=A.style.map.terrain&&A.style.map.terrain.getTerrainData(d);_.activeTexture.set(x.TEXTURE0);const Z=o.getTileByID(d.key).latestRawTileData,G=Math.floor((Z&&Z.byteLength||0)/1024),ne=o.getTile(d).tileSize,le=512/Math.min(ne,512)*(d.overscaledZ/A.transform.zoom)*.5;let _e=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(_e+=` => ${d.overscaledZ}`),(function(be,Ae){be.initDebugOverlayCanvas();const ke=be.debugOverlayCanvas,Se=be.context.gl,De=be.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,ke.width,ke.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(Ae,5,5),De.strokeText(Ae,5,5),be.debugOverlayTexture.update(ke),be.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)})(A,`${_e} ${G}kB`);const xe=A.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(_,x.TRIANGLES,I,D,sn.alphaBlended,kr.disabled,rf(s.bp.transparent,le),null,xe,$,A.debugBuffer,A.quadTriangleIndexBuffer,A.debugSegments),C.draw(_,x.LINE_STRIP,I,D,z,kr.disabled,rf(s.bp.red),H,xe,$,A.debugBuffer,A.tileBorderIndexBuffer,A.debugSegments)}function Dd(A,o,d,_){const{isRenderingGlobe:x}=_,C=A.context,I=C.gl,D=A.transform,z=A.colorModeForRenderPass(),$=A.getDepthModeFor3D(),H=A.useProgram("terrain");C.bindFramebuffer.set(null),C.viewport.set([0,0,A.width,A.height]);for(const Z of d){const G=o.getTerrainMesh(Z.tileID),ne=A.renderToTexture.getTexture(Z),le=o.getTerrainData(Z.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,ne.texture);const _e=o.getMeshFrameDelta(D.zoom),xe=D.calculateFogMatrix(Z.tileID.toUnwrapped()),be=Fm(_e,xe,A.style.sky,D.pitch,x),Ae=D.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});H.draw(C,I.TRIANGLES,$,jr.disabled,z,kr.backCCW,be,le,Ae,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function Xp(A,o){if(!o.mesh){const d=new s.aW;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const _=new s.aY;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),o.mesh=new un(A.createVertexBuffer(d,Sa.members),A.createIndexBuffer(_),s.aX.simpleSegment(0,0,d.length,_.length))}return o.mesh}class Gm{constructor(o,d){this.context=new Zl(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=en.maxOverzooming+en.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bi}resize(o,d,_){if(this.width=Math.floor(o*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const o=this.context,d=new s.aW;d.emplaceBack(0,0),d.emplaceBack(s.a5,0),d.emplaceBack(0,s.a5),d.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=o.createVertexBuffer(d,Sa.members),this.tileExtentSegments=s.aX.simpleSegment(0,0,4,2);const _=new s.aW;_.emplaceBack(0,0),_.emplaceBack(s.a5,0),_.emplaceBack(0,s.a5),_.emplaceBack(s.a5,s.a5),this.debugBuffer=o.createVertexBuffer(_,Sa.members),this.debugSegments=s.aX.simpleSegment(0,0,4,5);const x=new s.ch;x.emplaceBack(0,0,0,0),x.emplaceBack(s.a5,0,s.a5,0),x.emplaceBack(0,s.a5,0,s.a5),x.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=o.createVertexBuffer(x,Bm.members),this.rasterBoundsSegments=s.aX.simpleSegment(0,0,4,2);const C=new s.aW;C.emplaceBack(0,0),C.emplaceBack(s.a5,0),C.emplaceBack(0,s.a5),C.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(C,Sa.members),this.rasterBoundsSegmentsPosOnly=s.aX.simpleSegment(0,0,4,5);const I=new s.aW;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(I,Sa.members),this.viewportSegments=s.aX.simpleSegment(0,0,4,2);const D=new s.ci;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(D);const z=new s.aY;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(z);const $=this.context.gl;this.stencilClearMode=new jr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO),this.tileExtentMesh=new un(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.N();s.c7(_,0,this.width,this.height,0,0,1),s.Q(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const x={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(o,d.TRIANGLES,Er.disabled,this.stencilClearMode,sn.disabled,kr.disabled,null,null,x,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d,_){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source,this.nextStencilID+d.length>256&&this.clearStencil();const x=this.context;x.setColorMode(sn.disabled),x.setDepthMode(Er.disabled);const C={};for(const I of d)C[I.key]=this.nextStencilID++;this._renderTileMasks(C,d,_,!0),this._renderTileMasks(C,d,_,!1),this._tileClippingMaskIDs=C}_renderTileMasks(o,d,_,x){const C=this.context,I=C.gl,D=this.style.projection,z=this.transform,$=this.useProgram("clippingMask");for(const H of d){const Z=o[H.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(H),ne=D.getMeshFromTileID(this.context,H.canonical,x,!0,"stencil"),le=z.getProjectionData({overscaledTileID:H,applyGlobeMatrix:!_,applyTerrainMatrix:!0});$.draw(C,I.TRIANGLES,Er.disabled,new jr({func:I.ALWAYS,mask:0},Z,255,I.KEEP,I.KEEP,I.REPLACE),sn.disabled,_?kr.disabled:kr.backCCW,null,G,le,"$clipping",ne.vertexBuffer,ne.indexBuffer,ne.segments)}}_renderTilesDepthBuffer(){const o=this.context,d=o.gl,_=this.style.projection,x=this.transform,C=this.useProgram("depth"),I=this.getDepthModeFor3D(),D=En(x,{tileSize:x.tileSize});for(const z of D){const $=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),H=_.getMeshFromTileID(this.context,z.canonical,!0,!0,"raster"),Z=x.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(o,d.TRIANGLES,I,jr.disabled,sn.disabled,kr.backCCW,null,$,Z,"$clipping",H.vertexBuffer,H.indexBuffer,H.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new jr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new jr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){const d=this.context.gl,_=o.sort(((I,D)=>D.overscaledZ-I.overscaledZ)),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let D=0;D<C;D++)I[D+x]=new jr({func:d.GEQUAL,mask:255},D+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[x]:jr.disabled},_]}stencilConfigForOverlapTwoPass(o){const d=this.context.gl,_=o.sort(((I,D)=>D.overscaledZ-I.overscaledZ)),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(this.clearStencil(),C>1){const I={},D={};for(let z=0;z<C;z++)I[z+x]=new jr({func:d.GREATER,mask:255},C+1+z,255,d.KEEP,d.KEEP,d.REPLACE),D[z+x]=new jr({func:d.GREATER,mask:255},1+z,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*C+1,[I,D,_]}return this.nextStencilID=3,[{[x]:new jr({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[x]:new jr({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new sn([o.CONSTANT_COLOR,o.ONE],new s.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}getDepthModeForSublayer(o,d,_){if(!this.opaquePassEnabledForLayer())return Er.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Er(_||this.context.gl.LEQUAL,d,[x,x])}getDepthModeFor3D(){return new Er(this.context.gl.LEQUAL,Er.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){var _,x;this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(W()),this.imageManager.beginFrame();const C=this.style._order,I=this.style.tileManagers,D={},z={},$={},H={isRenderingToTexture:!1,isRenderingGlobe:((_=o.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const G in I){const ne=I[G];ne.used&&ne.prepare(this.context),D[G]=ne.getVisibleCoordinates(!1),z[G]=D[G].slice().reverse(),$[G]=ne.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<C.length;G++)if(this.style._layers[C[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of C){const ne=this.style._layers[G];if(!ne.hasOffscreenPass()||ne.isHidden(this.transform.zoom))continue;const le=z[ne.source];(ne.type==="custom"||le.length)&&this.renderLayer(this,I[ne.source],ne,le,H)}if((x=this.style.projection)===null||x===void 0||x.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.bp.black:s.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(G,ne){const le=G.context,_e=le.gl,xe=((ze,Re,Ve)=>{const ct=Math.cos(Re.rollInRadians),nt=Math.sin(Re.rollInRadians),at=Ct(Re),ot=Re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ze.properties.get("sky-color"),u_horizon_color:ze.properties.get("horizon-color"),u_horizon:[(Re.width/2-at*nt)*Ve,(Re.height/2+at*ct)*Ve],u_horizon_normal:[-nt,ct],u_sky_horizon_blend:ze.properties.get("sky-horizon-blend")*Re.height/2*Ve,u_sky_blend:ot}})(ne,G.style.map.transform,G.pixelRatio),be=new Er(_e.LEQUAL,Er.ReadWrite,[0,1]),Ae=jr.disabled,ke=G.colorModeForRenderPass(),Se=G.useProgram("sky"),De=Xp(le,ne);Se.draw(le,_e.TRIANGLES,be,Ae,ke,kr.disabled,xe,null,void 0,"sky",De.vertexBuffer,De.indexBuffer,De.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[C[this.currentLayer]],ne=I[G.source],le=D[G.source];this._renderTileClippingMasks(G,le,!1),this.renderLayer(this,ne,G,le,H)}this.renderPass="translucent";let Z=!1;for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const G=this.style._layers[C[this.currentLayer]],ne=I[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,H))continue;this.opaquePassEnabledForLayer()||Z||(Z=!0,H.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const le=(G.type==="symbol"?$:z)[G.source];this._renderTileClippingMasks(G,D[G.source],!!this.renderToTexture),this.renderLayer(this,ne,G,le,H)}if(H.isRenderingGlobe&&(function(G,ne,le){const _e=G.context,xe=_e.gl,be=G.useProgram("atmosphere"),Ae=new Er(xe.LEQUAL,Er.ReadOnly,[0,1]),ke=G.transform,Se=(function(ot,Ft){const Ut=ot.properties.get("position"),Pt=[-Ut.x,-Ut.y,-Ut.z],$t=s.ar(new Float64Array(16));return ot.properties.get("anchor")==="map"&&(s.bg($t,$t,Ft.rollInRadians),s.bh($t,$t,-Ft.pitchInRadians),s.bg($t,$t,Ft.bearingInRadians),s.bh($t,$t,Ft.center.lat*Math.PI/180),s.bJ($t,$t,-Ft.center.lng*Math.PI/180)),s.cg(Pt,Pt,$t),Pt})(le,G.transform),De=ke.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ze=ne.properties.get("atmosphere-blend")*De.projectionTransition;if(ze===0)return;const Re=Lc(ke.worldSize,ke.center.lat),Ve=ke.inverseProjectionMatrix,ct=new Float64Array(4);ct[3]=1,s.aH(ct,ct,ke.modelViewProjectionMatrix),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1,s.aH(ct,ct,Ve),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1;const nt=((ot,Ft,Ut,Pt,$t)=>({u_sun_pos:ot,u_atmosphere_blend:Ft,u_globe_position:Ut,u_globe_radius:Pt,u_inv_proj_matrix:$t}))(Se,ze,[ct[0],ct[1],ct[2]],Re,Ve),at=Xp(_e,ne);be.draw(_e,xe.TRIANGLES,Ae,jr.disabled,sn.alphaBlended,kr.disabled,nt,null,null,"atmosphere",at.vertexBuffer,at.indexBuffer,at.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=(function(ne,le){let _e=null;const xe=Object.values(ne._layers).flatMap((Se=>Se.source&&!Se.isHidden(le)?[ne.tileManagers[Se.source]]:[])),be=xe.filter((Se=>Se.getSource().type==="vector")),Ae=xe.filter((Se=>Se.getSource().type!=="vector")),ke=Se=>{(!_e||_e.getSource().maxzoom<Se.getSource().maxzoom)&&(_e=Se)};return be.forEach((Se=>ke(Se))),_e||Ae.forEach((Se=>ke(Se))),_e})(this.style,this.transform.zoom);G&&(function(ne,le,_e){for(let xe=0;xe<_e.length;xe++)gf(ne,le,_e[xe])})(this,G,G.getVisibleCoordinates())}this.options.showPadding&&(function(G){const ne=G.transform.padding;Qu(G,G.transform.height-(ne.top||0),3,al),Qu(G,ne.bottom||0,3,ko),ol(G,ne.left||0,3,Rd),ol(G,G.transform.width-(ne.right||0),3,Od);const le=G.transform.centerPoint;(function(_e,xe,be,Ae){li(_e,xe-1,be-10,2,20,Ae),li(_e,xe-10,be-1,20,2,Ae)})(G,le.x,G.transform.height-le.y,ra)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=o?!s.cj(d,_):!s.ck(d,_)),x||(x=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),x&&(s.cl(d,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(C,I){const D=C.context,z=D.gl,$=C.transform,H=sn.unblended,Z=new Er(z.LEQUAL,Er.ReadWrite,[0,1]),G=I.tileManager.getRenderableTiles(),ne=C.useProgram("terrainDepth");D.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),D.clear({color:s.bp.transparent,depth:1});for(const le of G){const _e=I.getTerrainMesh(le.tileID),xe=I.getTerrainData(le.tileID),be=$.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ae={u_ele_delta:I.getMeshFrameDelta($.zoom)};ne.draw(D,z.TRIANGLES,Z,jr.disabled,H,kr.backCCW,Ae,xe,be,"terrain",_e.vertexBuffer,_e.indexBuffer,_e.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,C.width,C.height])})(this,this.style.map.terrain),(function(C,I){const D=C.context,z=D.gl,$=C.transform,H=sn.unblended,Z=new Er(z.LEQUAL,Er.ReadWrite,[0,1]),G=I.getCoordsTexture(),ne=I.tileManager.getRenderableTiles(),le=C.useProgram("terrainCoords");D.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),D.clear({color:s.bp.transparent,depth:1}),I.coordsIndex=[];for(const _e of ne){const xe=I.getTerrainMesh(_e.tileID),be=I.getTerrainData(_e.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.texture);const Ae={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta($.zoom)},ke=$.getProjectionData({overscaledTileID:_e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});le.draw(D,z.TRIANGLES,Z,jr.disabled,H,kr.backCCW,Ae,be,ke,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments),I.coordsIndex.push(_e.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,C.width,C.height])})(this,this.style.map.terrain))}renderLayer(o,d,_,x,C){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(x||[]).length)&&(this.id=_.id,s.cm(_)?(function(I,D,z,$,H,Z){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:G}=Z,ne=jr.disabled,le=I.colorModeForRenderPass();(z._unevaluatedLayout.hasValue("text-variable-anchor")||z._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(_e,xe,be,Ae,ke,Se,De,ze,Re){const Ve=xe.transform,ct=xe.style.map.terrain,nt=ke==="map",at=Se==="map";for(const ot of _e){const Ft=Ae.getTile(ot),Ut=Ft.getBucket(be);if(!Ut||!Ut.text||!Ut.text.segments.get().length)continue;const Pt=s.ay(Ut.textSizeData,Ve.zoom),$t=s.aN(Ft,1,xe.transform.zoom),xr=Gs(nt,xe.transform,$t),Qr=be.layout.get("icon-text-fit")!=="none"&&Ut.hasIconData();if(Pt){const _n=Math.pow(2,Ve.zoom-Ft.tileID.overscaledZ),fn=ct?(Tn,an)=>ct.getElevation(ot,Tn,an):null;rl(Ut,nt,at,Re,Ve,xr,_n,Pt,Qr,s.aO(Ve,Ft,De,ze),ot.toUnwrapped(),fn)}}})($,I,z,D,z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),H),z.paint.get("icon-opacity").constantOr(1)!==0&&$c(I,D,z,$,!1,z.paint.get("icon-translate"),z.paint.get("icon-translate-anchor"),z.layout.get("icon-rotation-alignment"),z.layout.get("icon-pitch-alignment"),z.layout.get("icon-keep-upright"),ne,le,G),z.paint.get("text-opacity").constantOr(1)!==0&&$c(I,D,z,$,!0,z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.layout.get("text-keep-upright"),ne,le,G),D.map.showCollisionBoxes&&(Ei(I,D,z,$,!0),Ei(I,D,z,$,!1))})(o,d,_,x,this.style.placement.variableOffsets,C):s.cn(_)?(function(I,D,z,$,H){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=H,G=z.paint.get("circle-opacity"),ne=z.paint.get("circle-stroke-width"),le=z.paint.get("circle-stroke-opacity"),_e=!z.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(ne.constantOr(1)===0||le.constantOr(1)===0))return;const xe=I.context,be=xe.gl,Ae=I.transform,ke=I.getDepthModeForSublayer(0,Er.ReadOnly),Se=jr.disabled,De=I.colorModeForRenderPass(),ze=[],Re=Ae.getCircleRadiusCorrection();for(let Ve=0;Ve<$.length;Ve++){const ct=$[Ve],nt=D.getTile(ct),at=nt.getBucket(z);if(!at)continue;const ot=z.paint.get("circle-translate"),Ft=z.paint.get("circle-translate-anchor"),Ut=s.aO(Ae,nt,ot,Ft),Pt=at.programConfigurations.get(z.id),$t=I.useProgram("circle",Pt),xr=at.layoutVertexBuffer,Qr=at.indexBuffer,_n=I.style.map.terrain&&I.style.map.terrain.getTerrainData(ct),fn={programConfiguration:Pt,program:$t,layoutVertexBuffer:xr,indexBuffer:Qr,uniformValues:tf(I,nt,z,Ut,Re),terrainData:_n,projectionData:Ae.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!Z,applyTerrainMatrix:!0})};if(_e){const Tn=at.segments.get();for(const an of Tn)ze.push({segments:new s.aX([an]),sortKey:an.sortKey,state:fn})}else ze.push({segments:at.segments,sortKey:0,state:fn})}_e&&ze.sort(((Ve,ct)=>Ve.sortKey-ct.sortKey));for(const Ve of ze){const{programConfiguration:ct,program:nt,layoutVertexBuffer:at,indexBuffer:ot,uniformValues:Ft,terrainData:Ut,projectionData:Pt}=Ve.state;nt.draw(xe,be.TRIANGLES,ke,Se,De,kr.backCCW,Ft,Ut,Pt,z.id,at,ot,Ve.segments,z.paint,I.transform.zoom,ct)}})(o,d,_,x,C):s.co(_)?(function(I,D,z,$,H){if(z.paint.get("heatmap-opacity")===0)return;const Z=I.context,{isRenderingToTexture:G,isRenderingGlobe:ne}=H;if(I.style.map.terrain){for(const le of $){const _e=D.getTile(le);D.hasRenderableParent(le)||(I.renderPass==="offscreen"?qp(I,_e,z,le,ne):I.renderPass==="translucent"&&Pi(I,z,le,G,ne))}Z.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?(function(le,_e,xe,be){const Ae=le.context,ke=Ae.gl,Se=le.transform,De=jr.disabled,ze=new sn([ke.ONE,ke.ONE],s.bp.transparent,[!0,!0,!0,!0]);(function(Re,Ve,ct){const nt=Re.gl;Re.activeTexture.set(nt.TEXTURE1),Re.viewport.set([0,0,Ve.width/4,Ve.height/4]);let at=ct.heatmapFbos.get(s.cd);at?(nt.bindTexture(nt.TEXTURE_2D,at.colorAttachment.get()),Re.bindFramebuffer.set(at.framebuffer)):(at=hn(Re,Ve.width/4,Ve.height/4),ct.heatmapFbos.set(s.cd,at))})(Ae,le,xe),Ae.clear({color:s.bp.transparent});for(let Re=0;Re<be.length;Re++){const Ve=be[Re];if(_e.hasRenderableParent(Ve))continue;const ct=_e.getTile(Ve),nt=ct.getBucket(xe);if(!nt)continue;const at=nt.programConfigurations.get(xe.id),ot=le.useProgram("heatmap",at),Ft=Se.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ut=Se.getCircleRadiusCorrection();ot.draw(Ae,ke.TRIANGLES,Er.disabled,De,ze,kr.backCCW,Vl(ct,Se.zoom,xe.paint.get("heatmap-intensity"),Ut),null,Ft,xe.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,xe.paint,Se.zoom,at)}Ae.viewport.set([0,0,le.width,le.height])})(I,D,z,$):I.renderPass==="translucent"&&(function(le,_e){const xe=le.context,be=xe.gl;xe.setColorMode(le.colorModeForRenderPass());const Ae=_e.heatmapFbos.get(s.cd);Ae&&(xe.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_2D,Ae.colorAttachment.get()),xe.activeTexture.set(be.TEXTURE1),zr(xe,_e).bind(be.LINEAR,be.CLAMP_TO_EDGE),le.useProgram("heatmapTexture").draw(xe,be.TRIANGLES,Er.disabled,jr.disabled,le.colorModeForRenderPass(),kr.disabled,Fp(le,_e,0,1),null,null,_e.id,le.viewportBuffer,le.quadTriangleIndexBuffer,le.viewportSegments,_e.paint,le.transform.zoom))})(I,z)})(o,d,_,x,C):s.cp(_)?(function(I,D,z,$,H){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=H,G=z.paint.get("line-opacity"),ne=z.paint.get("line-width");if(G.constantOr(1)===0||ne.constantOr(1)===0)return;const le=I.getDepthModeForSublayer(0,Er.ReadOnly),_e=I.colorModeForRenderPass(),xe=z.paint.get("line-dasharray"),be=xe.constantOr(1),Ae=z.paint.get("line-pattern"),ke=Ae.constantOr(1),Se=z.paint.get("line-gradient"),De=z.getCrossfadeParameters();let ze;ze=ke?"linePattern":be&&Se?"lineGradientSDF":be?"lineSDF":Se?"lineGradient":"line";const Re=I.context,Ve=Re.gl,ct=I.transform;let nt=!0;for(const at of $){const ot=D.getTile(at);if(ke&&!ot.patternsLoaded())continue;const Ft=ot.getBucket(z);if(!Ft)continue;const Ut=Ft.programConfigurations.get(z.id),Pt=I.context.program.get(),$t=I.useProgram(ze,Ut),xr=nt||$t.program!==Pt,Qr=I.style.map.terrain&&I.style.map.terrain.getTerrainData(at),_n=Ae.constantOr(null),fn=xe&&xe.constantOr(null);if(_n&&ot.imageAtlas){const Ci=ot.imageAtlas,Zn=Ci.patternPositions[_n.to.toString()],Yn=Ci.patternPositions[_n.from.toString()];Zn&&Yn&&Ut.setConstantPatternPositions(Zn,Yn)}else if(fn){const Ci=z.layout.get("line-cap")==="round",Zn=I.lineAtlas.getDash(fn.to,Ci),Yn=I.lineAtlas.getDash(fn.from,Ci);Ut.setConstantDashPositions(Zn,Yn)}const Tn=ct.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),an=ct.getPixelScale();let Fn;ke?(Fn=jp(I,ot,z,an,De),ta(Re,Ve,ot,Ut,De)):be&&Se?(Fn=$l(I,ot,z,an,De,Ft.lineClipsArray.length),Ps(I,D,Re,Ve,z,Ft,at,Ut,De)):be?(Fn=Ss(I,ot,z,an,De),zn(I,Re,Ve,Ut,xr,De)):Se?(Fn=Hm(I,ot,z,an,Ft.lineClipsArray.length),Es(I,D,Re,Ve,z,Ft,at)):Fn=sf(I,ot,z,an);const Sn=I.stencilModeForClipping(at);$t.draw(Re,Ve.TRIANGLES,le,Sn,_e,kr.disabled,Fn,Qr,Tn,z.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,z.paint,I.transform.zoom,Ut,Ft.layoutVertexBuffer2),nt=!1}})(o,d,_,x,C):s.cq(_)?(function(I,D,z,$,H){const Z=z.paint.get("fill-color"),G=z.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:ne}=H,le=I.colorModeForRenderPass(),_e=z.paint.get("fill-pattern"),xe=I.opaquePassEnabledForLayer()&&!_e.constantOr(1)&&Z.constantOr(s.bp.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===xe){const be=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?Er.ReadWrite:Er.ReadOnly);Io(I,D,z,$,be,le,!1,ne)}if(I.renderPass==="translucent"&&z.paint.get("fill-antialias")){const be=I.getDepthModeForSublayer(z.getPaintProperty("fill-outline-color")?2:0,Er.ReadOnly);Io(I,D,z,$,be,le,!0,ne)}})(o,d,_,x,C):s.cr(_)?(function(I,D,z,$,H){const Z=z.paint.get("fill-extrusion-opacity");if(Z===0)return;const{isRenderingToTexture:G}=H;if(I.renderPass==="translucent"){const ne=new Er(I.context.gl.LEQUAL,Er.ReadWrite,I.depthRangeFor3D);if(Z!==1||z.paint.get("fill-extrusion-pattern").constantOr(1))Ro(I,D,z,$,ne,jr.disabled,sn.disabled,G),Ro(I,D,z,$,ne,I.stencilModeFor3D(),I.colorModeForRenderPass(),G);else{const le=I.colorModeForRenderPass();Ro(I,D,z,$,ne,jr.disabled,le,G)}}})(o,d,_,x,C):s.cs(_)?(function(I,D,z,$,H){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=H,G=I.context,ne=I.style.projection.useSubdivision,le=I.getDepthModeForSublayer(0,Er.ReadOnly),_e=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(xe,be,Ae,ke,Se,De,ze){const Re=xe.context,Ve=Re.gl;for(const ct of Ae){const nt=be.getTile(ct),at=nt.dem;if(!at||!at.data||!nt.needsHillshadePrepare)continue;const ot=at.dim,Ft=at.stride,Ut=at.getPixels();if(Re.activeTexture.set(Ve.TEXTURE1),Re.pixelStoreUnpackPremultiplyAlpha.set(!1),nt.demTexture=nt.demTexture||xe.getTileTexture(Ft),nt.demTexture){const $t=nt.demTexture;$t.update(Ut,{premultiply:!1}),$t.bind(Ve.NEAREST,Ve.CLAMP_TO_EDGE)}else nt.demTexture=new s.T(Re,Ut,Ve.RGBA,{premultiply:!1}),nt.demTexture.bind(Ve.NEAREST,Ve.CLAMP_TO_EDGE);Re.activeTexture.set(Ve.TEXTURE0);let Pt=nt.fbo;if(!Pt){const $t=new s.T(Re,{width:ot,height:ot,data:null},Ve.RGBA);$t.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),Pt=nt.fbo=Re.createFramebuffer(ot,ot,!0,!1),Pt.colorAttachment.set($t.texture)}Re.bindFramebuffer.set(Pt.framebuffer),Re.viewport.set([0,0,ot,ot]),xe.useProgram("hillshadePrepare").draw(Re,Ve.TRIANGLES,Se,De,ze,kr.disabled,$m(nt.tileID,at),null,null,ke.id,xe.rasterBoundsBuffer,xe.quadTriangleIndexBuffer,xe.rasterBoundsSegments),nt.needsHillshadePrepare=!1}})(I,D,$,z,le,jr.disabled,_e),G.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(ne){const[xe,be,Ae]=I.stencilConfigForOverlapTwoPass($);Oo(I,D,z,Ae,xe,le,_e,!1,Z),Oo(I,D,z,Ae,be,le,_e,!0,Z)}else{const[xe,be]=I.getStencilConfigForOverlapAndUpdateStencilID($);Oo(I,D,z,be,xe,le,_e,!1,Z)}})(o,d,_,x,C):s.ct(_)?(function(I,D,z,$,H){if(I.renderPass!=="translucent"||!$.length)return;const{isRenderingToTexture:Z}=H,G=I.style.projection.useSubdivision,ne=I.getDepthModeForSublayer(0,Er.ReadOnly),le=I.colorModeForRenderPass();if(G){const[_e,xe,be]=I.stencilConfigForOverlapTwoPass($);il(I,D,z,be,_e,ne,le,!1,Z),il(I,D,z,be,xe,ne,le,!0,Z)}else{const[_e,xe]=I.getStencilConfigForOverlapAndUpdateStencilID($);il(I,D,z,xe,_e,ne,le,!1,Z)}})(o,d,_,x,C):s.bU(_)?(function(I,D,z,$,H){if(I.renderPass!=="translucent"||z.paint.get("raster-opacity")===0||!$.length)return;const{isRenderingToTexture:Z}=H,G=D.getSource(),ne=I.style.projection.useSubdivision;if(G instanceof Xs)Ma(I,D,z,$,null,!1,!1,G.tileCoords,G.flippedWindingOrder,Z);else if(ne){const[le,_e,xe]=I.stencilConfigForOverlapTwoPass($);Ma(I,D,z,xe,le,!1,!0,sl,!1,Z),Ma(I,D,z,xe,_e,!0,!0,sl,!1,Z)}else{const[le,_e]=I.getStencilConfigForOverlapAndUpdateStencilID($);Ma(I,D,z,_e,le,!1,!0,sl,!1,Z)}})(o,d,_,x,C):s.cu(_)?(function(I,D,z,$,H){const Z=z.paint.get("background-color"),G=z.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:ne}=H,le=I.context,_e=le.gl,xe=I.style.projection,be=I.transform,Ae=be.tileSize,ke=z.paint.get("background-pattern");if(I.isPatternMissing(ke))return;const Se=!ke&&Z.a===1&&G===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Se)return;const De=jr.disabled,ze=I.getDepthModeForSublayer(0,Se==="opaque"?Er.ReadWrite:Er.ReadOnly),Re=I.colorModeForRenderPass(),Ve=I.useProgram(ke?"backgroundPattern":"background"),ct=$||En(be,{tileSize:Ae,terrain:I.style.map.terrain});ke&&(le.activeTexture.set(_e.TEXTURE0),I.imageManager.bind(I.context));const nt=z.getCrossfadeParameters();for(const at of ct){const ot=be.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),Ft=ke?cf(G,I,ke,{tileID:at,tileSize:Ae},nt):lf(G,Z),Ut=I.style.map.terrain&&I.style.map.terrain.getTerrainData(at),Pt=xe.getMeshFromTileID(le,at.canonical,!1,!0,"raster");Ve.draw(le,_e.TRIANGLES,ze,De,Re,kr.backCCW,Ft,Ut,ot,z.id,Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}})(o,0,_,x,C):s.cv(_)&&(function(I,D,z,$){const{isRenderingGlobe:H}=$,Z=I.context,G=z.implementation,ne=I.style.projection,le=I.transform,_e=le.getProjectionDataForCustomLayer(H),xe={farZ:le.farZ,nearZ:le.nearZ,fov:le.fov*Math.PI/180,modelViewProjectionMatrix:le.modelViewProjectionMatrix,projectionMatrix:le.projectionMatrix,shaderData:{variantName:ne.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ne.shaderPreludeCode.vertexSource}`,define:ne.shaderDefine},defaultProjectionData:_e},be=G.renderingMode?G.renderingMode:"2d";if(I.renderPass==="offscreen"){const Ae=G.prerender;Ae&&(I.setCustomLayerDefaults(),Z.setColorMode(I.colorModeForRenderPass()),Ae.call(G,Z.gl,xe),Z.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),Z.setColorMode(I.colorModeForRenderPass()),Z.setStencilMode(jr.disabled);const Ae=be==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,Er.ReadOnly);Z.setDepthMode(Ae),G.render(Z.gl,xe),Z.setDirty(),I.setBaseState(),Z.bindFramebuffer.set(null)}})(o,0,_,C))}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!d||!_}useProgram(o,d,_=!1,x=[]){this.cache=this.cache||{};const C=!!this.style.map.terrain,I=this.style.projection,D=_?Cn.projectionMercator:I.shaderPreludeCode,z=_?qn:I.shaderDefine,$=o+(d?d.cacheKey:"")+`/${_?as:I.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(C?"/terrain":"")+(x?`/${x.join("/")}`:"");return this.cache[$]||(this.cache[$]=new jm(this.context,Cn[o],d,qm[o],this._showOverdrawInspector,C,D,z,x)),this.cache[$]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var o,d;if(this._tileTextures){for(const _ in this._tileTextures){const x=this._tileTextures[_];if(x)for(const C of x)C.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((o=this.tileExtentMesh.vertexBuffer)===null||o===void 0||o.destroy()),this.tileExtentMesh&&((d=this.tileExtentMesh.indexBuffer)===null||d===void 0||d.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const _ in this.cache){const x=this.cache[_];x&&x.program&&this.context.gl.deleteProgram(x.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}function Gp(A,o){let d,_=!1,x=null,C=null;const I=()=>{x=null,_&&(A.apply(C,d),x=setTimeout(I,o),_=!1)};return(...D)=>(_=!0,C=this,d=D,x||I(),x)}class ti{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(_=x)})),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const _=d.join("/");let x=_;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${_}`);let C=window.location.hash.replace(x,"");C.startsWith("#&")?C=C.slice(0,1)+C.slice(2):C==="#"&&(C="");let I=window.location.href.replace(/(#.+)?$/,C);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Gp(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),I=Math.round(d.lng*C)/C,D=Math.round(d.lat*C)/C,z=this._map.getBearing(),$=this._map.getPitch();let H="";if(H+=o?`/${I}/${D}/${_}`:`${_}/${D}/${I}`,(z||$)&&(H+="/"+Math.round(10*z)/10),$&&(H+=`/${Math.round($)}`),this._hashName){const Z=this._hashName;let G=!1;const ne=window.location.hash.slice(1).split("&").map((le=>{const _e=le.split("=")[0];return _e===Z?(G=!0,`${_e}=${H}`):le})).filter((le=>le));return G||ne.push(`${Z}=${H}`),`#${ne.join("&")}`}return`#${H}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new s.V(+o[2],+o[1])}catch{return!1}const d=+o[0],_=+(o[3]||0),x=+(o[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&_>=-180&&_<=180&&x>=this._map.getMinPitch()&&x<=this._map.getMaxPitch()}}const Lo={linearity:.3,easing:s.cw(0,0,.3,1)},Ju=s.e({deceleration:2500,maxSpeed:1400},Lo),Gi=s.e({deceleration:20,maxSpeed:1400},Lo),na=s.e({deceleration:1e3,maxSpeed:360},Lo),Wc=s.e({deceleration:1e3,maxSpeed:90},Lo),Zi=s.e({deceleration:1e3,maxSpeed:360},Lo);class ov{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:W(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=W();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,d.roll+=C.rollDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){const C=mf(d.pan.mag(),_,s.e({},Ju,o||{})),I=d.pan.mult(C.amount/d.pan.mag()),D=this._map.cameraHelper.handlePanInertia(I,this._map.transform);x.center=D.easingCenter,x.offset=D.easingOffset,eh(x,C)}if(d.zoom){const C=mf(d.zoom,_,Gi),I=s.cx(this._map.transform.zoom+C.amount,this._map.getZoomSnap(),C.amount);x.zoom=I,eh(x,C)}if(d.bearing){const C=mf(d.bearing,_,na);x.bearing=this._map.transform.bearing+s.an(C.amount,-179,179),eh(x,C)}if(d.pitch){const C=mf(d.pitch,_,Wc);x.pitch=this._map.transform.pitch+C.amount,eh(x,C)}if(d.roll){const C=mf(d.roll,_,Zi);x.roll=this._map.transform.roll+s.an(C.amount,-179,179),eh(x,C)}if(x.zoom||x.bearing){const C=d.pinchAround===void 0?d.around:d.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),s.e(x,{noMoveStart:!0})}}function eh(A,o){(!A.duration||A.duration<o.duration)&&(A.duration=o.duration,A.easing=o.easing)}function mf(A,o,d){const{maxSpeed:_,linearity:x,deceleration:C}=d,I=s.an(A*x/(o/1e3),-_,_),D=Math.abs(I)/(C*x);return{easing:d.easing,duration:1e3*D,amount:I*(D/2)}}class Ti extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_,x={}){_=_ instanceof MouseEvent?_:new MouseEvent(o,_);const C=j.mousePos(d.getCanvas(),_),I=d.unproject(C);super(o,s.e({point:C,lngLat:I,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}}class Ja extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){const x=o==="touchend"?_.changedTouches:_.touches,C=j.touchPos(d.getCanvasContainer(),x),I=C.map((z=>d.unproject(z))),D=C.reduce(((z,$,H,Z)=>z.add($.div(Z.length))),new s.P(0,0));super(o,{points:C,point:D,lngLats:I,lngLat:d.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class kd extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class Ld{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new kd(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Ti(o.type,this._map,o))}mouseup(o){this._map.fire(new Ti(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ti(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Ti(o.type,this._map,o))}mouseover(o){this._map.fire(new Ti(o.type,this._map,o))}mouseout(o){this._map.fire(new Ti(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Ja(o.type,this._map,o))}touchmove(o){this._map.fire(new Ja(o.type,this._map,o))}touchend(o){this._map.fire(new Ja(o.type,this._map,o))}touchcancel(o){this._map.fire(new Ja(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zm{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Ti(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ti("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Ti(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class eo{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(s.P.convert(o),this._map.terrain)}}class Yl{constructor(o,d){this._map=o,this._tr=new eo(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(j.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=j.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const C=Math.min(x.x,_.x),I=Math.max(x.x,_.x),D=Math.min(x.y,_.y),z=Math.max(x.y,_.y);j.setTransform(this._box,`translate(${C}px,${D}px)`),this._box.style.width=I-C+"px",this._box.style.height=z-D+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const _=this._startPos,x=d;if(this.reset(),j.suppressClick(),_.x!==x.x||_.y!==x.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:o})),{cameraAnimation:C=>C.fitScreenCoordinates(_,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new s.l(o,{originalEvent:d}))}}function Cs(A,o){if(A.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${A.length}, points ${o.length}`);const d={};for(let _=0;_<A.length;_++)d[A[_].identifier]=o[_];return d}class Ht{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=(function(x){const C=new s.P(0,0);for(const I of x)C._add(I);return C.div(x.length)})(d),this.touches=Cs(_,d)))}touchmove(o,d,_){if(this.aborted||!this.centroid)return;const x=Cs(_,d);for(const C in this.touches){const I=x[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(o,d,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class _f{constructor(o){this.singleTap=new Ht(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,_){this.singleTap.touchstart(o,d,_)}touchmove(o,d,_){this.singleTap.touchmove(o,d,_)}touchend(o,d,_){const x=this.singleTap.touchend(o,d,_);if(x){const C=o.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(x)<30;if(C&&I||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Nd{constructor(o){this._tr=new eo(o),this._zoomIn=new _f({numTouches:1,numTaps:2}),this._zoomOut=new _f({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,_){this._zoomIn.touchstart(o,d,_),this._zoomOut.touchstart(o,d,_)}touchmove(o,d,_){this._zoomIn.touchmove(o,d,_),this._zoomOut.touchmove(o,d,_)}touchend(o,d,_){const x=this._zoomIn.touchend(o,d,_),C=this._zoomOut.touchend(o,d,_),I=this._tr;return x?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:s.cx(I.zoom+1,D.getZoomSnap()),around:I.unproject(x)},{originalEvent:o})}):C?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:s.cx(I.zoom-1,D.getZoomSnap()),around:I.unproject(C)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const x=Array.isArray(d)?d[0]:d;return!this._moved&&x.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(_,x))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&j.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const to=0,th=2,zd={[to]:1,[th]:2};class No{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=j.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!(function(d,_){const x=zd[_];return d.buttons===void 0||(d.buttons&x)!==x})(o,this._eventButton)}isValidEndEvent(o){return j.mouseButton(o)===this._eventButton}}class Hc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class yf{constructor(o=new No({checkCorrectEvent:()=>!0}),d=new Hc){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(o,d,_){return o instanceof MouseEvent?d(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?_(o):void 0}startMove(o){this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(o){this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const zo=A=>{A.mousedown=A.dragStart,A.mousemoveWindow=A.dragMove,A.mouseup=A.dragEnd,A.contextmenu=o=>{o.preventDefault()}};class Bd{constructor(o,d){this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,d,_){return this._calculateTransform(o,d,_)}touchmove(o,d,_){if(this._active){if(!this._shouldBePrevented(_.length))return o.preventDefault(),this._calculateTransform(o,d,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,d,_){this._calculateTransform(o,d,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,_){_.length>0&&(this._active=!0);const x=Cs(_,d),C=new s.P(0,0),I=new s.P(0,0);let D=0;for(const $ in x){const H=x[$],Z=this._touches[$];Z&&(C._add(H),I._add(H.sub(Z)),D++,x[$]=H)}if(this._touches=x,this._shouldBePrevented(D)||!I.mag())return;const z=I.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vf{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,_){if(!this._firstTwoTouches)return;o.preventDefault();const[x,C]=this._firstTwoTouches,I=Bo(_,d,x),D=Bo(_,d,C);if(!I||!D)return;const z=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],z,o)}touchend(o,d,_){if(!this._firstTwoTouches)return;const[x,C]=this._firstTwoTouches,I=Bo(_,d,x),D=Bo(_,d,C);I&&D||(this._active&&j.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Bo(A,o,d){for(let _=0;_<A.length;_++)if(A[_].identifier===d)return o[_]}function Zp(A,o){return Math.log(A/o)/Math.LN2}class Fo extends vf{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Zp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zp(this._distance,_),pinchAround:d}}}function Fd(A,o){return 180*A.angleWith(o)/Math.PI}class bf extends vf{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d,_){const x=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fd(this._vector,x),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,_=Fd(o,this._startVector);return Math.abs(_)<d}}function jo(A){return Math.abs(A.y)>Math.abs(A.x)}class ll extends vf{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,_){super.touchstart(o,d,_),this._currentTouchCount=_.length}_start(o){this._lastPoints=o,jo(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=o[0].sub(this._lastPoints[0]),C=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,C,_.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,_){if(this._valid!==void 0)return this._valid;const x=o.mag()>=2,C=d.mag()>=2;if(!x&&!C)return;if(!x||!C)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=o.y>0==d.y>0;return jo(o)&&jo(d)&&I}}const Ra={panStep:100,bearingStep:15,pitchStep:10};class tn{constructor(o){this._tr=new eo(o);const d=Ra;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,_=0,x=0,C=0,I=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),C=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),C=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),I=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:Yp,zoom:d?s.cx(z.zoom+d*(o.shiftKey?2:1),D.getZoomSnap()):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+x*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:z.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yp(A){return A*(2-A)}const cl=4.000244140625,Kl=1/450;class xf{constructor(o,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=o,this._tr=new eo(o),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Kl}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=W(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%cl==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=j.mousePos(this._map.getCanvas(),o),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(s.V.convert(_.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const D=o.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=D),typeof this._targetZoom=="number"&&(this._targetZoom+=D)}if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>cl?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&z!==0&&(z=1/z);const $=typeof this._targetZoom!="number"?o.scale:s.aq(this._targetZoom),H=o.applyConstrain(o.getCameraLngLat(),s.at($*z)).zoom,Z=this._map.getZoomSnap();if(this._type==="wheel"&&Z>0){const G=s.cx(o.zoom,Z);this._targetZoom=s.cx(H,Z,H-G)}else this._targetZoom=H;this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?o.zoom:this._targetZoom,_=this._startZoom,x=this._easing;let C,I=!1;if(this._type==="wheel"&&_&&x){const D=W()-this._lastWheelEventTime,z=Math.min((D+5)/200,1),$=x(z);C=s.G.number(_,d,$),z<1?this._frameId||(this._frameId=!0):I=!0}else C=d,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=C,{noInertia:!0,needsRenderFrame:!I,zoomDelta:C-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=s.cz;if(this._prevEase){const _=this._prevEase,x=(W()-_.start)/_.duration,C=_.easing(x+.01)-_.easing(x),I=.27/Math.sqrt(C*C+1e-4)*.01,D=Math.sqrt(.0729-I*I);d=s.cw(I,D,.25,1)}return this._prevEase={start:W(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class jd{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qc{constructor(o){this._tr=new eo(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:s.cx(this._tr.zoom+(o.shiftKey?-1:1),_.getZoomSnap()),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(){this._tap=new _f({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,_){if(!this._swipePoint)if(this._tapTime){const x=d[0],C=o.timeStamp-this._tapTime<500,I=this._tapPoint.dist(x)<30;C&&I?_.length>0&&(this._swipePoint=x,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(o,d,_)}touchmove(o,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=d[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(o,d,_)}touchend(o,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const x=this._tap.touchend(o,d,_);x&&(this._tapTime=o.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kp{constructor(o,d,_){this._el=o,this._mousePan=d,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ia{constructor(o,d,_,x){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=d,this._mousePitch=_,this._mouseRoll=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xc{constructor(o,d,_,x){this._el=o,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qt{constructor(o,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=j.create("div","maplibregl-cooperative-gesture-screen",o);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=d,this._container.appendChild(x);const C=document.createElement("div");C.className="maplibregl-mobile-message",C.textContent=_,this._container.appendChild(C),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(j.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,d){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:o,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const er=A=>A.zoom||A.drag||A.roll||A.pitch||A.rotate;class Oa extends s.l{}function rh(A){return A.panDelta&&A.panDelta.mag()||A.zoomDelta||A.bearingDelta||A.pitchDelta||A.rollDelta}class Tf{get _ownerDocument(){var o;return((o=this._el)===null||o===void 0?void 0:o.ownerDocument)||document}get _ownerWindow(){var o,d;return((d=(o=this._el)===null||o===void 0?void 0:o.ownerDocument)===null||d===void 0?void 0:d.defaultView)||window}constructor(o,d){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,C)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=x.type==="renderFrame"?void 0:x,D={needsRenderFrame:!1},z={},$={};for(const{handlerName:G,handler:ne,allowed:le}of this._handlers){if(!ne.isEnabled())continue;let _e;if(this._blockedByActive($,le,G))ne.reset();else if(ne[C||x.type]){if(s.cA(x,C||x.type)){const xe=j.mousePos(this._map.getCanvas(),x);_e=ne[C||x.type](x,xe)}else if(s.cB(x,C||x.type)){const xe=this._getMapTouches(x.touches),be=j.touchPos(this._map.getCanvas(),xe);_e=ne[C||x.type](x,be,xe)}else s.cC(C||x.type)||(_e=ne[C||x.type](x));this.mergeHandlerResult(D,z,_e,G,I),_e&&_e.needsRenderFrame&&this._triggerRenderFrame()}(_e||ne.isActive())&&($[G]=ne)}const H={};for(const G in this._previousActiveHandlers)$[G]||(H[G]=I);this._previousActiveHandlers=$,(Object.keys(H).length||rh(D))&&(this._changes.push([D,z,H]),this._triggerRenderFrame()),(Object.keys($).length||rh(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=D;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ov(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[x,C,I]of this._listeners)j.addEventListener(x,C,x===this._ownerDocument?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[o,d,_]of this._listeners)j.removeEventListener(o,d,o===this._ownerDocument?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Ld(d,o));const x=d.boxZoom=new Yl(d,o);this._add("boxZoom",x),o.interactive&&o.boxZoom&&x.enable();const C=d.cooperativeGestures=new qt(d,o.cooperativeGestures);this._add("cooperativeGestures",C),o.cooperativeGestures&&C.enable();const I=new Nd(d),D=new qc(d);d.doubleClickZoom=new jd(D,I),this._add("tapZoom",I),this._add("clickZoom",D),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const z=new wf;this._add("tapDragZoom",z);const $=d.touchPitch=new ll(d);this._add("touchPitch",$),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const H=()=>d.project(d.getCenter()),Z=(function({enable:Se,clickTolerance:De,aroundCenter:ze=!0,minPixelCenterThreshold:Re=100,rotateDegreesPerPixelMoved:Ve=.8},ct){const nt=new No({checkCorrectEvent:at=>j.mouseButton(at)===0&&at.ctrlKey||j.mouseButton(at)===2&&!at.ctrlKey});return new Ia({clickTolerance:De,move:(at,ot)=>{const Ft=ct();if(ze&&Math.abs(Ft.y-at.y)>Re)return{bearingDelta:s.cy(new s.P(at.x,ot.y),ot,Ft)};let Ut=(ot.x-at.x)*Ve;return ze&&ot.y<Ft.y&&(Ut=-Ut),{bearingDelta:Ut}},moveStateManager:nt,enable:Se,assignEvents:zo})})(o,H),G=(function({enable:Se,clickTolerance:De,pitchDegreesPerPixelMoved:ze=-.5}){const Re=new No({checkCorrectEvent:Ve=>j.mouseButton(Ve)===0&&Ve.ctrlKey||j.mouseButton(Ve)===2});return new Ia({clickTolerance:De,move:(Ve,ct)=>({pitchDelta:(ct.y-Ve.y)*ze}),moveStateManager:Re,enable:Se,assignEvents:zo})})(o),ne=(function({enable:Se,clickTolerance:De,rollDegreesPerPixelMoved:ze=.3},Re){const Ve=new No({checkCorrectEvent:ct=>j.mouseButton(ct)===2&&ct.ctrlKey});return new Ia({clickTolerance:De,move:(ct,nt)=>{const at=Re();let ot=(nt.x-ct.x)*ze;return nt.y<at.y&&(ot=-ot),{rollDelta:ot}},moveStateManager:Ve,enable:Se,assignEvents:zo})})(o,H);d.dragRotate=new ia(o,Z,G,ne),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ne,["mousePitch"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const le=(function({enable:Se,clickTolerance:De}){const ze=new No({checkCorrectEvent:Re=>j.mouseButton(Re)===0&&!Re.ctrlKey});return new Ia({clickTolerance:De,move:(Re,Ve)=>({around:Ve,panDelta:Ve.sub(Re)}),activateOnStart:!0,moveStateManager:ze,enable:Se,assignEvents:zo})})(o),_e=new Bd(o,d);d.dragPan=new Kp(_,le,_e),this._add("mousePan",le),this._add("touchPan",_e,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const xe=new bf,be=new Fo;d.touchZoomRotate=new Xc(_,be,xe,z),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate),this._add("blockableMapEvent",new Zm(d));const Ae=d.scrollZoom=new xf(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Ae,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const ke=d.keyboard=new tn(d);this._add("keyboard",ke),o.interactive&&o.keyboard&&d.keyboard.enable()}_add(o,d,_){this._handlers.push({handlerName:o,handler:d,allowed:_}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!er(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,_){for(const x in o)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const _ of o)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(o,d,_,x,C){if(!_)return;s.e(o,_);const I={handlerName:x,originalEvent:_.originalEvent||C};_.zoomDelta!==void 0&&(d.zoom=I),_.panDelta!==void 0&&(d.drag=I),_.rollDelta!==void 0&&(d.roll=I),_.pitchDelta!==void 0&&(d.pitch=I),_.bearingDelta!==void 0&&(d.rotate=I)}_applyChanges(){const o={},d={},_={};for(const[x,C,I]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),x.rollDelta&&(o.rollDelta=(o.rollDelta||0)+x.rollDelta),x.around!==void 0&&(o.around=x.around),x.pinchAround!==void 0&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),s.e(d,C),s.e(_,I);this._updateMapTransform(o,d,_),this._changes=[]}_updateMapTransform(o,d,_){const x=this._map,C=x._getTransformForUpdate(),I=x.terrain;if(!(rh(o)||I&&this._terrainMovement))return this._fireEvents(d,_,!0);x._stop(!0);let{panDelta:D,zoomDelta:z,bearingDelta:$,pitchDelta:H,rollDelta:Z,around:G,pinchAround:ne}=o;ne!==void 0&&(G=ne),G=G||x.transform.centerPoint,I&&!C.isPointOnMapSurface(G)&&(G=C.centerPoint);const le={panDelta:D,zoomDelta:z,rollDelta:Z,pitchDelta:H,bearingDelta:$,around:G};this._map.cameraHelper.useGlobeControls&&!C.isPointOnMapSurface(G)&&(G=C.centerPoint);const _e=G.distSqr(C.centerPoint)<.01?C.center:C.screenPointToLocation(D?G.sub(D):G);this._handleMapControls({terrain:I,tr:C,deltasForHelper:le,preZoomAroundLoc:_e,combinedEventsInProgress:d,panDelta:D}),x._applyUpdatedTransform(C),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,_,!0)}_handleMapControls({terrain:o,tr:d,deltasForHelper:_,preZoomAroundLoc:x,combinedEventsInProgress:C,panDelta:I}){const D=this._map.cameraHelper;if(D.handleMapControlsRollPitchBearingZoom(_,d),o)return D.useGlobeControls?(this._terrainMovement||!C.drag&&!C.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void D.handleMapControlsPan(_,d,x)):this._terrainMovement||!C.drag&&!C.zoom?void(C.drag&&this._terrainMovement&&I?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(I))):D.handleMapControlsPan(_,d,x)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void D.handleMapControlsPan(_,d,x));D.handleMapControlsPan(_,d,x)}_fireEvents(o,d,_){const x=er(this._eventsInProgress),C=er(o),I={};for(const Z in o){const{originalEvent:G}=o[Z];this._eventsInProgress[Z]||(I[`${Z}start`]=G),this._eventsInProgress[Z]=o[Z]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(const Z in I)this._fireEvent(Z,I[Z]);C&&this._fireEvent("move",C.originalEvent);for(const Z in o){const{originalEvent:G}=o[Z];this._fireEvent(Z,G)}const D={};let z;for(const Z in this._eventsInProgress){const{handlerName:G,originalEvent:ne}=this._eventsInProgress[Z];this._handlersById[G].isActive()||(delete this._eventsInProgress[Z],z=d[G]||ne,D[`${Z}end`]=z)}for(const Z in D)this._fireEvent(Z,D[Z]);const $=er(this._eventsInProgress),H=(x||C)&&!$;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(_&&H){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;!Z||!Z.essential&&N.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:z})),G(this._map.getBearing())&&this._map.resetNorth()):(G(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new s.l(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((o=>{delete this._frameId,this.handleEvent(new Oa("renderFrame",{timeStamp:o})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ri extends s.E{constructor(o,d,_){super(),this._renderFrameCallback=()=>{const x=Math.min((W()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=_.bearingSnap,this._zoomSnap=_.zoomSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(o,d){o.apply(this.transform,!0),this.transform=o,this.cameraHelper=d}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,d){return this.jumpTo({elevation:o},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,d,_){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.e({offset:o},d),_)}panTo(o,d,_){return this.easeTo(s.e({center:o},d),_)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,_){return this.easeTo(s.e({zoom:o},d),_)}zoomIn(o,d){return this.zoomTo(s.cx(this.getZoom()+1,this._zoomSnap),o,d),this}zoomOut(o,d){return this.zoomTo(s.cx(this.getZoom()-1,this._zoomSnap),o,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,d){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)).fire(new s.l("moveend",d))),this}getBearing(){return this.transform.bearing}setZoomSnap(o){return this._zoomSnap=o,this}getZoomSnap(){return this._zoomSnap}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,_){return this.easeTo(s.e({bearing:o},d),_)}resetNorth(o,d){return this.rotateTo(0,s.e({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}getRoll(){return this.transform.roll}setRoll(o,d){return this.jumpTo({roll:o},d),this}cameraForBounds(o,d){o=Yr.convert(o).adjustAntiMeridian();const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,d)}_cameraForBoxAndBearing(o,d,_,x){const C={top:0,bottom:0,right:0,left:0};if(typeof(x=s.e({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const $=x.padding;x.padding={top:$,bottom:$,right:$,left:$}}const I=s.e(C,x.padding);x.padding=I;const D=this.transform,z=new Yr(o,d);return this.cameraHelper.cameraForBoxAndBearing(x,I,z,_,D)}fitBounds(o,d,_){return this._fitInternal(this.cameraForBounds(o,d),d,_)}fitScreenCoordinates(o,d,_,x,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(o)),this.transform.screenPointToLocation(s.P.convert(d)),_,x),x,C)}_fitInternal(o,d,_){return o?(delete(d=s.e(o,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(o,d){this.stop();const _=this._getTransformForUpdate();let x=!1,C=!1,I=!1;const D=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,o);const z=_.zoom!==D;return"elevation"in o&&_.elevation!==+o.elevation&&_.setElevation(+o.elevation),"bearing"in o&&_.bearing!==+o.bearing&&(x=!0,_.setBearing(+o.bearing)),"pitch"in o&&_.pitch!==+o.pitch&&(C=!0,_.setPitch(+o.pitch)),"roll"in o&&_.roll!==+o.roll&&(I=!0,_.setRoll(+o.roll)),o.padding==null||_.isPaddingEqual(o.padding)||_.setPadding(o.padding),this._applyUpdatedTransform(_),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)),z&&this.fire(new s.l("zoomstart",d)).fire(new s.l("zoom",d)).fire(new s.l("zoomend",d)),x&&this.fire(new s.l("rotatestart",d)).fire(new s.l("rotate",d)).fire(new s.l("rotateend",d)),C&&this.fire(new s.l("pitchstart",d)).fire(new s.l("pitch",d)).fire(new s.l("pitchend",d)),I&&this.fire(new s.l("rollstart",d)).fire(new s.l("roll",d)).fire(new s.l("rollend",d)),this.fire(new s.l("moveend",d))}calculateCameraOptionsFromTo(o,d,_,x=0){const C=s.a9.fromLngLat(o,d),I=s.a9.fromLngLat(_,x),D=I.x-C.x,z=I.y-C.y,$=I.z-C.z,H=Math.hypot(D,z,$);if(H===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(D,z),G=s.at(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ne=180*Math.atan2(D,-z)/Math.PI;let le=180*Math.acos(Z/H)/Math.PI;return le=$<0?90-le:90+le,{center:I.toLngLat(),elevation:x,zoom:G,pitch:le,bearing:ne}}calculateCameraOptionsFromCameraLngLatAltRotation(o,d,_,x,C){const I=this.transform.calculateCenterFromCameraLngLatAlt(o,d,_,x);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:_,pitch:x,roll:C}}easeTo(o,d){this._stop(!1,o.easeId),((o=s.e({offset:[0,0],duration:500,easing:s.cz},o)).animate===!1||!o.essential&&N.prefersReducedMotion)&&(o.duration=0);const _=this._getTransformForUpdate(),x=this.getBearing(),C=_.pitch,I=_.roll,D="bearing"in o?this._normalizeBearing(o.bearing,x):x,z="pitch"in o?+o.pitch:C,$="roll"in o?this._normalizeBearing(o.roll,I):I,H="padding"in o?o.padding:_.padding,Z=s.P.convert(o.offset);let G,ne;o.around&&(G=s.V.convert(o.around),ne=_.locationToScreenPoint(G));const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},_e=this.cameraHelper.handleEaseTo(_,{bearing:D,pitch:z,roll:$,padding:H,around:G,aroundPoint:ne,offsetAsPoint:Z,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||x!==D,this._pitching=this._pitching||z!==C,this._rolling=this._rolling||$!==I,this._padding=!_.isPaddingEqual(H),this._zooming=this._zooming||_e.isZooming,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,le),this.terrain&&this._prepareElevation(_e.elevationCenter),this._ease((xe=>{_e.easeFunc(xe),this.terrain&&!o.freezeElevation&&this._updateElevation(xe),this._applyUpdatedTransform(_),this._fireMoveEvents(d)}),(xe=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d,xe)}),o),this}_prepareEase(o,d,_={}){this._moving=!0,d||_.moving||this.fire(new s.l("movestart",o)),this._zooming&&!_.zooming&&this.fire(new s.l("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new s.l("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new s.l("pitchstart",o)),this._rolling&&!_.rolling&&this.fire(new s.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(_-(d-(_*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};const d=o.getCameraLngLat(),_=o.getCameraAltitude(),x=this.terrain?this.terrain.getElevationForLngLatZoom(d,o.zoom):0;if(_<x){const C=this.calculateCameraOptionsFromTo(d,x,o.center,o.elevation);return{pitch:C.pitch,zoom:C.zoom}}return{}}_applyUpdatedTransform(o){const d=[];if(d.push((x=>this._elevateCameraIfInsideTerrain(x))),this.transformCameraUpdate&&d.push((x=>this.transformCameraUpdate(x))),!d.length)return;const _=o.clone();for(const x of d){const C=_.clone(),{center:I,zoom:D,roll:z,pitch:$,bearing:H,elevation:Z}=x(C);I&&C.setCenter(I),Z!==void 0&&C.setElevation(Z),D!==void 0&&C.setZoom(D),z!==void 0&&C.setRoll(z),$!==void 0&&C.setPitch($),H!==void 0&&C.setBearing(H),_.apply(C,!1)}this.transform.apply(_,!1)}_fireMoveEvents(o){this.fire(new s.l("move",o)),this._zooming&&this.fire(new s.l("zoom",o)),this._rotating&&this.fire(new s.l("rotate",o)),this._pitching&&this.fire(new s.l("pitch",o)),this._rolling&&this.fire(new s.l("roll",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,x=this._rotating,C=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new s.l("zoomend",o)),x&&this.fire(new s.l("rotateend",o)),C&&this.fire(new s.l("pitchend",o)),I&&this.fire(new s.l("rollend",o)),this.fire(new s.l("moveend",o))}flyTo(o,d){if(!o.essential&&N.prefersReducedMotion){const ot=s.U(o,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(ot,d)}this.stop(),o=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cz},o);const _=this._getTransformForUpdate(),x=_.bearing,C=_.pitch,I=_.roll,D=_.padding,z="bearing"in o?this._normalizeBearing(o.bearing,x):x,$="pitch"in o?+o.pitch:C,H="roll"in o?this._normalizeBearing(o.roll,I):I,Z="padding"in o?o.padding:_.padding,G=s.P.convert(o.offset);let ne=_.centerPoint.add(G);const le=_.screenPointToLocation(ne),_e=this.cameraHelper.handleFlyTo(_,{bearing:z,pitch:$,roll:H,padding:Z,locationAtOffset:le,offsetAsPoint:G,center:o.center,minZoom:o.minZoom,zoom:o.zoom});let xe=o.curve;const be=Math.max(_.width,_.height),Ae=be/_e.scaleOfZoom,ke=_e.pixelPathLength;typeof _e.scaleOfMinZoom=="number"&&(xe=Math.sqrt(be/_e.scaleOfMinZoom/ke*2));const Se=xe*xe;function De(ot){const Ft=(Ae*Ae-be*be+(ot?-1:1)*Se*Se*ke*ke)/(2*(ot?Ae:be)*Se*ke);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function ze(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function Re(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const Ve=De(!1);let ct=function(ot){return Re(Ve)/Re(Ve+xe*ot)},nt=function(ot){return be*((Re(Ve)*(ze(Ft=Ve+xe*ot)/Re(Ft))-ze(Ve))/Se)/ke;var Ft},at=(De(!0)-Ve)/xe;if(Math.abs(ke)<2e-6||!isFinite(at)){if(Math.abs(be-Ae)<1e-6)return this.easeTo(o,d);const ot=Ae<be?-1:1;at=Math.abs(Math.log(Ae/be))/xe,nt=()=>0,ct=Ft=>Math.exp(ot*xe*Ft)}return o.duration="duration"in o?+o.duration:1e3*at/("screenSpeed"in o?+o.screenSpeed/xe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==z,this._pitching=$!==C,this._rolling=H!==I,this._padding=!_.isPaddingEqual(Z),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(_e.targetCenter),this._ease((ot=>{const Ft=ot*at,Ut=1/ct(Ft),Pt=nt(Ft);this._rotating&&_.setBearing(s.G.number(x,z,ot)),this._pitching&&_.setPitch(s.G.number(C,$,ot)),this._rolling&&_.setRoll(s.G.number(I,H,ot)),this._padding&&(_.interpolatePadding(D,Z,ot),ne=_.centerPoint.add(G)),_e.easeFunc(ot,Ut,Pt,ne),this.terrain&&!o.freezeElevation&&this._updateElevation(ot),this._applyUpdatedTransform(_),this._fireMoveEvents(d)}),(()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,d)}return o||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(o,d,_){_.animate===!1||_.duration===0?(o(1),d()):(this._easeStart=W(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=s.W(o,-180,180);const _=Math.abs(o-d);return Math.abs(o-360-d)<_&&(o-=360),Math.abs(o+360-d)<_&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(o),this.transform):null}}const Bn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Gn{constructor(o=Bn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=j.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=j.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const _=this._map._getUIString(`AttributionControl.${d}`);o.title=_,o.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map((x=>typeof x!="string"?"":x))):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const d=this._map.style.tileManagers;for(const x in d){const C=d[x];if(C.used||C.usedForTerrain){const I=C.getSource();I.attribution&&o.indexOf(I.attribution)<0&&o.push(I.attribution)}}o=o.filter((x=>String(x).trim())),o.sort(((x,C)=>x.length-C.length)),o=o.filter(((x,C)=>{for(let I=C+1;I<o.length;I++)if(o[I].indexOf(x)>=0)return!1;return!0}));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=j.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Sf{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=j.create("div","maplibregl-ctrl");const d=j.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){j.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ul{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const x of _)if(x.id===o)return void(x.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Dr=s.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Kr extends s.E{constructor(o){super(),this._lastTilesetChange=W(),this.tileManager=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(o,d){this.tileManager.update(o,d),this._renderableTilesKeys=[];const _={};for(const x of En(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.tileManager._source.calculateTileZoom}))_[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.terrainRttPosMatrix32f=new Float64Array(16),s.c7(x.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[x.key]=new Ne(x,this.tileSize),this._lastTilesetChange=W());for(const x in this._tiles)_[x]||delete this._tiles[x]}freeRtt(o){for(const d in this._tiles){const _=this._tiles[d];(!o||_.tileID.equals(o)||_.tileID.isChildOf(o)||o.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((o=>this.getTileByID(o)))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,d){return d?this._getTerrainCoordsForTileRanges(o,d):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){const d={};for(const _ of this._renderableTilesKeys){const x=this._tiles[_].tileID,C=o.clone(),I=s.bk();if(x.canonical.equals(o.canonical))s.c7(I,0,s.a5,s.a5,0,0,1);else if(x.canonical.isChildOf(o.canonical)){const D=x.canonical.z-o.canonical.z,z=x.canonical.x-(x.canonical.x>>D<<D),$=x.canonical.y-(x.canonical.y>>D<<D),H=s.a5>>D;s.c7(I,0,H,H,0,0,1),s.O(I,I,[-z*H,-$*H,0])}else{if(!o.canonical.isChildOf(x.canonical))continue;{const D=o.canonical.z-x.canonical.z,z=o.canonical.x-(o.canonical.x>>D<<D),$=o.canonical.y-(o.canonical.y>>D<<D),H=s.a5>>D;s.c7(I,0,s.a5,s.a5,0,0,1),s.O(I,I,[z*H,$*H,0]),s.Q(I,I,[1/2**D,1/2**D,0])}}C.terrainRttPosMatrix32f=new Float32Array(I),d[_]=C}return d}_getTerrainCoordsForTileRanges(o,d){const _={};for(const x of this._renderableTilesKeys){const C=this._tiles[x].tileID;if(!this._isWithinTileRanges(C,d))continue;const I=o.clone(),D=s.bk();if(C.canonical.z===o.canonical.z){const z=o.canonical.x-C.canonical.x+o.wrap*(1<<o.canonical.z),$=o.canonical.y-C.canonical.y;s.c7(D,0,s.a5,s.a5,0,0,1),s.O(D,D,[z*s.a5,$*s.a5,0])}else if(C.canonical.z>o.canonical.z){const z=C.canonical.z-o.canonical.z,$=C.canonical.x-(C.canonical.x>>z<<z)+o.wrap*(1<<C.canonical.z),H=C.canonical.y-(C.canonical.y>>z<<z),Z=o.canonical.x-(C.canonical.x>>z),G=o.canonical.y-(C.canonical.y>>z),ne=s.a5>>z;s.c7(D,0,ne,ne,0,0,1),s.O(D,D,[-$*ne+Z*s.a5,-H*ne+G*s.a5,0])}else{const z=o.canonical.z-C.canonical.z,$=o.canonical.x-(o.canonical.x>>z<<z)+o.wrap*(1<<o.canonical.z),H=o.canonical.y-(o.canonical.y>>z<<z),Z=(o.canonical.x>>z)-C.canonical.x,G=(o.canonical.y>>z)-C.canonical.y,ne=s.a5<<z;s.c7(D,0,ne,ne,0,0,1),s.O(D,D,[$*s.a5+Z*ne,H*s.a5+G*ne,0])}I.terrainRttPosMatrix32f=new Float32Array(D),_[x]=I}return _}getSourceTile(o,d){const _=this.tileManager._source;let x=o.overscaledZ-this.deltaZoom;if(x>_.maxzoom&&(x=_.maxzoom),x<_.minzoom)return;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(x).key);let C=this.findTileInCaches(this._sourceTileCache[o.key]);if(!C?.dem&&d)for(;x>=_.minzoom&&!C?.dem;)C=this.findTileInCaches(o.scaledTo(x--).key);return C}findTileInCaches(o){let d=this.tileManager.getTileByID(o);return d||(d=this.tileManager._outOfViewCache.getByKey(o),d)}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,d){const _=d[o.canonical.z];return!!_&&(o.wrap>_.minWrap||o.wrap<_.maxWrap||o.canonical.x>=_.minTileXWrapped&&o.canonical.x<=_.maxTileXWrapped&&o.canonical.y>=_.minTileY&&o.canonical.y<=_.maxTileY)}}class Rr{constructor(o,d,_){this._meshCache={},this.painter=o,this.tileManager=new Kr(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,_,x=s.a5){var C;const I=o.normalizeCoordinates(d,_,x);if(!I)return 0;const D=this.getTerrainData(I.tileID),z=(C=D.tile)===null||C===void 0?void 0:C.dem;if(!z)return 0;const $=s.cD([],[I.x/x*s.a5,I.y/x*s.a5],D.u_terrain_matrix),H=[$[0]*z.dim,$[1]*z.dim],Z=Math.floor(H[0]),G=Math.floor(H[1]),ne=H[0]-Z,le=H[1]-G;return z.get(Z,G)*(1-ne)*(1-le)+z.get(Z+1,G)*ne*(1-le)+z.get(Z,G+1)*(1-ne)*le+z.get(Z+1,G+1)*ne*le}getElevationForLngLatZoom(o,d){if(!s.cE(d,o.wrap()))return 0;const{tileID:_,mercatorX:x,mercatorY:C}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(_,x%s.a5,C%s.a5,s.a5)}getElevationForLngLat(o,d){const _=En(d,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let x=0;for(const C of _)C.canonical.z>x&&(x=Math.min(C.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(o,x)}getElevation(o,d,_,x=s.a5){return this.getDEMElevation(o,d,_,x)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const x=this.painter.context,C=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(x,C,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(x,new s.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ar([])}const d=this.tileManager.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const x=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new s.T(x,d.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),d.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d.toString()+d.tileID.key+o.key;if(_&&!this._demMatrixCache[_]){const x=this.tileManager.getSource().maxzoom;let C=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=x?C=o.canonical.z-x:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=o.canonical.x-(o.canonical.x>>C<<C),D=o.canonical.y-(o.canonical.y>>C<<C),z=s.cF(new Float64Array(16),[1/(s.a5<<C),1/(s.a5<<C),0]);s.O(z,z,[I*s.a5,D*s.a5,0]),this._demMatrixCache[o.key]={matrix:z,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,_=d.width/devicePixelRatio,x=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(d.context,{width:_,height:x,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(d.context,{width:_,height:x,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,x,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,x))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,I=0;C<this._coordsTextureSize;C++)for(let D=0;D<this._coordsTextureSize;D++,I+=4)d[I+0]=255&D,d[I+1]=255&C,d[I+2]=D>>8<<4|C>>8,d[I+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),x=new s.T(o,_,o.gl.RGBA,{premultiply:!1});return x.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),_=this.painter.context,x=_.gl,C=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(C,D-I-1,1,1,x.RGBA,x.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const z=d[0]+(d[2]>>4<<8),$=d[1]+((15&d[2])<<8),H=this.coordsIndex[255-d[3]],Z=H&&this.tileManager.getTileByID(H);if(!Z)return null;const G=this._coordsTextureSize,ne=(1<<Z.tileID.canonical.z)*G;return new s.a9((Z.tileID.canonical.x*G+z)/ne+Z.tileID.wrap,(Z.tileID.canonical.y*G+$)/ne,this.getElevation(Z.tileID,z,$,G))}depthAtPoint(o){const d=new Uint8Array(4),_=this.painter.context,x=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(o){var d;const _=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,x=_&&o.canonical.y===0,C=_&&o.canonical.y===(1<<o.canonical.z)-1,I=`m_${x?"n":""}_${C?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const D=this.painter.context,z=new s.cG,$=new s.aY,H=this.meshSize,Z=s.a5/H,G=H*H;for(let Re=0;Re<=H;Re++)for(let Ve=0;Ve<=H;Ve++)z.emplaceBack(Ve*Z,Re*Z,0);for(let Re=0;Re<G;Re+=H+1)for(let Ve=0;Ve<H;Ve++)$.emplaceBack(Ve+Re,H+Ve+Re+1,H+Ve+Re+2),$.emplaceBack(Ve+Re,H+Ve+Re+2,Ve+Re+1);const ne=z.length,le=ne+(H+1),_e=(H+1)*H,xe=x?s.br:0,be=x?0:1,Ae=C?s.bs:s.a5,ke=C?0:1;for(let Re=0;Re<=H;Re++)z.emplaceBack(Re*Z,xe,be);for(let Re=0;Re<=H;Re++)z.emplaceBack(Re*Z,Ae,ke);for(let Re=0;Re<H;Re++)$.emplaceBack(_e+Re,le+Re,le+Re+1),$.emplaceBack(_e+Re,le+Re+1,_e+Re+1),$.emplaceBack(0+Re,ne+Re+1,ne+Re),$.emplaceBack(0+Re,0+Re+1,ne+Re+1);const Se=z.length,De=Se+2*(H+1);for(const Re of[0,1])for(let Ve=0;Ve<=H;Ve++)for(const ct of[0,1])z.emplaceBack(Re*s.a5,Ve*Z,ct);for(let Re=0;Re<2*H;Re+=2)$.emplaceBack(Se+Re,Se+Re+1,Se+Re+3),$.emplaceBack(Se+Re,Se+Re+3,Se+Re+2),$.emplaceBack(De+Re,De+Re+3,De+Re+1),$.emplaceBack(De+Re,De+Re+2,De+Re+3);const ze=new un(D.createVertexBuffer(z,Dr.members),D.createIndexBuffer($),s.aX.simpleSegment(0,0,z.length,$.length));return this._meshCache[I]=ze,ze}getMeshFrameDelta(o){return 2*Math.PI*s.bE/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,d){var _;if(!s.cE(d,o.wrap()))return 0;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(_=this.getMinMaxElevation(x).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(o,d){const _=s.a9.fromLngLat(o.wrap()),x=(1<<d)*s.a5,C=_.x*x,I=_.y*x,D=Math.floor(C/s.a5),z=Math.floor(I/s.a5);return{tileID:new s.a2(d,0,d,D,z),mercatorX:C,mercatorY:I}}}class Rn{constructor(o,d,_){this._context=o,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:o,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>o.id!==d)),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((o=>!o.inUse))===!1}}const Da={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ro{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new Rn(o.context,30,d.tileManager.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){var _,x;this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=o._order.filter((C=>!o._layers[C].isHidden(d))),this._coordsAscending={};for(const C in o.tileManagers){this._coordsAscending[C]={};const I=o.tileManagers[C].getVisibleCoordinates(),D=o.tileManagers[C].getSource(),z=D instanceof Xs?D.terrainTileRanges:null;for(const $ of I){const H=this.terrain.tileManager.getTerrainCoords($,z);for(const Z in H)this._coordsAscending[C][Z]||(this._coordsAscending[C][Z]=[]),this._coordsAscending[C][Z].push(H[Z])}}this._rttFingerprints={};for(const C of o._order){const I=o._layers[C],D=I.source;if(Da[I.type]&&!this._rttFingerprints[D]){this._rttFingerprints[D]={};const z=(x=(_=o.tileManagers[D])===null||_===void 0?void 0:_.getState().revision)!==null&&x!==void 0?x:0;for(const $ in this._coordsAscending[D])this._rttFingerprints[D][$]=`${this._coordsAscending[D][$].map((H=>H.key)).sort().join()}#${z}`}}for(const C of this._renderableTiles)for(const I in this._rttFingerprints){const D=this._rttFingerprints[I][C.tileID.key];D&&D!==C.rttFingerprint[I]&&(C.rtt=[])}}renderLayer(o,d){if(o.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),x=o.type,C=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Da[x]&&(this._prevType&&Da[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(o.id),!I))return!0;if(Da[this._prevType]||Da[x]&&I){this._prevType=x;const D=this._stacks.length-1,z=this._stacks[D]||[];for(const $ of this._renderableTiles){if(this.pool.isFull()&&(Dd(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push($),$.rtt[D]){const Z=this.pool.getObjectForId($.rtt[D].id);if(Z.stamp===$.rtt[D].stamp){this.pool.useObject(Z);continue}}const H=this.pool.getOrCreateFreeObject();this.pool.useObject(H),this.pool.stampObject(H),$.rtt[D]={id:H.id,stamp:H.stamp},C.context.bindFramebuffer.set(H.fbo.framebuffer),C.context.clear({color:s.bp.transparent,stencil:0}),C.currentStencilSource=void 0;for(let Z=0;Z<z.length;Z++){const G=C.style._layers[z[Z]],ne=G.source?this._coordsAscending[G.source][$.tileID.key]:[$.tileID];C.context.viewport.set([0,0,H.fbo.width,H.fbo.height]),C._renderTileClippingMasks(G,ne,!0),C.renderLayer(C,C.style.tileManagers[G.source],G,ne,_),G.source&&($.rttFingerprint[G.source]=this._rttFingerprints[G.source][$.tileID.key])}}return Dd(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Da[x]}return!1}}const Gc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Drag to rotate map, click to reset north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Zc=m,hl={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Bn,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Qp={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class wn{constructor(o,d,_=!1){this.mousedown=C=>{this.startMove(C,j.mousePos(this.element,C)),j.addEventListener(window,"mousemove",this.mousemove),j.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.move(C,j.mousePos(this.element,C))},this.mouseup=C=>{this._rotatePitchHandler.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,C.targetTouches)[0],this.startMove(C,this._startPos),j.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),j.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,C.targetTouches)[0],this.move(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const x=new yf;this._rotatePitchHandler=new Ia({clickTolerance:3,move:(C,I)=>{const D=d.getBoundingClientRect(),z=new s.P((D.bottom-D.top)/2,(D.right-D.left)/2);return{bearingDelta:s.cy(new s.P(C.x,I.y),I,z),pitchDelta:_?-.5*(I.y-C.y):void 0}},moveStateManager:x,enable:!0,assignEvents:()=>{}}),this.map=o,j.addEventListener(d,"mousedown",this.mousedown),j.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(d,"touchcancel",this.reset)}startMove(o,d){this._rotatePitchHandler.dragStart(o,d),j.disableDrag()}move(o,d){const _=this.map,{bearingDelta:x,pitchDelta:C}=this._rotatePitchHandler.dragMove(o,d)||{};x&&_.setBearing(_.getBearing()+x),C&&_.setPitch(_.getPitch()+C)}off(){const o=this.element;j.removeEventListener(o,"mousedown",this.mousedown),j.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),j.removeEventListener(window,"touchend",this.touchend),j.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){j.enableDrag(),j.removeEventListener(window,"mousemove",this.mousemove),j.removeEventListener(window,"mouseup",this.mouseup),j.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),j.removeEventListener(window,"touchend",this.touchend)}}let no;function nh(A,o,d,_=!1){if(_||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return A?.wrap();const x=new s.V(A.lng,A.lat);if(A=new s.V(A.lng,A.lat),o){const C=new s.V(A.lng-360,A.lat),I=new s.V(A.lng+360,A.lat),D=d.locationToScreenPoint(A).distSqr(o);d.locationToScreenPoint(C).distSqr(o)<D?A=C:d.locationToScreenPoint(I).distSqr(o)<D&&(A=I)}for(;Math.abs(A.lng-d.center.lng)>180;){const C=d.locationToScreenPoint(A);if(C.x>=0&&C.y>=0&&C.x<=d.width&&C.y<=d.height)break;A.lng>d.center.lng?A.lng-=360:A.lng+=360}return A.lng!==x.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(A))?A:x}const ih={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Af(A,o,d){const _=A.classList;for(const x in ih)_.remove(`maplibregl-${d}-anchor-${x}`);_.add(`maplibregl-${d}-anchor-${o}`)}class Ef extends s.E{constructor(o){if(super(),this._onClick=d=>{this.fire(new s.l("click",{originalEvent:d}))},this._onKeyPress=d=>{const _=d.code,x=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,x=this._element;this._popup&&(_===x||x.contains(_))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=nh(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,`${ih[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${x}`),N.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div");const d=j.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${x}px`),d.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const C=j.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const I=j.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const D=j.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const be of z){const Ae=j.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",be.rx),Ae.setAttributeNS(null,"ry",be.ry),D.appendChild(Ae)}const $=j.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"fill",this._color);const H=j.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),$.appendChild(H);const Z=j.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const G=j.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(G);const ne=j.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const le=j.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=j.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const xe=j.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#FFFFFF"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962"),le.appendChild(_e),le.appendChild(xe),I.appendChild(D),I.appendChild($),I.appendChild(Z),I.appendChild(ne),I.appendChild(le),d.appendChild(I),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),Af(this._element,this._anchor,"marker"),this._element.addEventListener("click",this._onClick),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.V.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const x=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var d,_;const x=(d=this._map)===null||d===void 0?void 0:d.terrain,C=this._map.transform.isLocationOccluded(this._lngLat);if(!x||C){const ne=C?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ne&&(this._element.style.opacity=ne))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const I=this._map,D=I.terrain.depthAtPoint(this._pos),z=I.terrain.getElevationForLngLat(this._lngLat,I.transform);if(I.transform.lngLatToCameraDepth(this._lngLat,z)-D<.006)return void(this._element.style.opacity=this._opacity);const $=-this._offset.y/I.transform.pixelsPerMeter,H=Math.sin(I.getPitch()*Math.PI/180)*$,Z=I.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),G=I.transform.lngLatToCameraDepth(this._lngLat,z+H)-Z>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,d){return(this._opacity===void 0||o===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Pf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ql=0,fl=!1;const $i={maxWidth:100,unit:"metric"};function On(A,o,d){const _=d&&d.maxWidth||100,x=A._container.clientHeight/2,C=A._container.clientWidth/2,I=A.unproject([C-_/2,x]),D=A.unproject([C+_/2,x]),z=Math.round(A.project(D).x-A.project(I).x),$=Math.min(_,z,A._container.clientWidth),H=I.distanceTo(D);if(d&&d.unit==="imperial"){const Z=3.2808*H;Z>5280?Uo(o,$,Z/5280,A._getUIString("ScaleControl.Miles")):Uo(o,$,Z,A._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Uo(o,$,H/1852,A._getUIString("ScaleControl.NauticalMiles")):H>=1e3?Uo(o,$,H/1e3,A._getUIString("ScaleControl.Kilometers")):Uo(o,$,H,A._getUIString("ScaleControl.Meters"))}function Uo(A,o,d,_){const x=(function(C){const I=Math.pow(10,`${Math.floor(C)}`.length-1);let D=C/I;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:(function(z){const $=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*$)/$})(D),I*D})(d);A.style.width=o*(x/d)+"px",A.innerHTML=`${x}&nbsp;${_}`}const Yc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Kc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sh(A){if(A){if(typeof A=="number"){const o=Math.round(Math.abs(A)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,A),"top-left":new s.P(o,o),"top-right":new s.P(-o,o),bottom:new s.P(0,-A),"bottom-left":new s.P(o,-o),"bottom-right":new s.P(-o,-o),left:new s.P(A,0),right:new s.P(-A,0)}}if(A instanceof s.P||Array.isArray(A)){const o=s.P.convert(A);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:s.P.convert(A.center||[0,0]),top:s.P.convert(A.top||[0,0]),"top-left":s.P.convert(A["top-left"]||[0,0]),"top-right":s.P.convert(A["top-right"]||[0,0]),bottom:s.P.convert(A.bottom||[0,0]),"bottom-left":s.P.convert(A["bottom-left"]||[0,0]),"bottom-right":s.P.convert(A["bottom-right"]||[0,0]),left:s.P.convert(A.left||[0,0]),right:s.P.convert(A.right||[0,0])}}return sh(new s.P(0,0))}const io=m;c.AJAXError=s.cJ,c.EXTENT=s.a5,c.Event=s.l,c.Evented=s.E,c.LngLat=s.V,c.MercatorCoordinate=s.a9,c.Point=s.P,c.addProtocol=s.cK,c.config=s.c,c.removeProtocol=s.cL,c.AttributionControl=Gn,c.BoxZoomHandler=Yl,c.CanvasSource=Yo,c.CooperativeGesturesHandler=qt,c.DoubleClickZoomHandler=jd,c.DragPanHandler=Kp,c.DragRotateHandler=ia,c.EdgeInsets=Zs,c.FullscreenControl=class extends s.E{constructor(A={}){var o;super(),this._onFullscreenChange=()=>{var d;let _=window.document.fullscreenElement||window.document.webkitFullscreenElement;for(;!((d=_?.shadowRoot)===null||d===void 0)&&d.fullscreenElement;)_=_.shadowRoot.fullscreenElement;_===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,this._pseudo=(o=A.pseudo)!==null&&o!==void 0&&o,A&&A.container&&(A.container instanceof HTMLElement?this._container=A.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(A){return this._map=A,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){j.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const A=this._fullscreenButton=j.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);j.create("span","maplibregl-ctrl-icon",A).setAttribute("aria-hidden","true"),A.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const A=this._getTitle();this._fullscreenButton.setAttribute("aria-label",A),this._fullscreenButton.title=A}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){this._pseudo?this._togglePseudoFullScreen():window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._pseudo?this._togglePseudoFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=vi,c.GeolocateControl=class extends s.E{constructor(A){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new s.V(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,x=this._map.getBearing(),C=s.e({bearing:x},this.options.fitBoundsOptions),I=Yr.fromLngLat(d,_);this._map.fitBounds(I,C,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new s.V(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=o=>{if(this._map){if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&fl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this._geolocateButton=j.create("button","maplibregl-ctrl-geolocate",this._container),j.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ef({element:this._dotElement}),this._circleElement=j.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ef({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const _=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},Pf,A)}onAdd(A){return this._map=A,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(o=!1){if(no!==void 0&&!o)return no;if(window.navigator.permissions===void 0)return no=!!window.navigator.geolocation,no;try{no=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{no=!!window.navigator.geolocation}return no}))})().then((o=>this._finishSetupUI(o))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ql=0,fl=!1}_isOutOfMapMaxBounds(A){const o=this._map.getMaxBounds(),d=A.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const A=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&A))return;const o=this._map.project(A),d=this._map.unproject([o.x+100,o.y]),_=A.distanceTo(d)/100,x=2*this._accuracy/_;this._circleElement.style.width=`${x.toFixed(2)}px`,this._circleElement.style.height=`${x.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ql--,fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let A;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ql++,Ql>1?(A={maximumAge:6e5,timeout:0},fl=!0):(A=this.options.positionOptions,fl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,A)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var A;const o=(A=this._map.getProjection())===null||A===void 0?void 0:A.type;this._map.setProjection(o!=="mercator"&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var A;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((A=this._map.getProjection())===null||A===void 0?void 0:A.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(A){return this._map=A,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=j.create("button","maplibregl-ctrl-globe",this._container),j.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._map.on("projectiontransition",this._updateGlobeIcon),this._container}onRemove(){j.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._map.off("projectiontransition",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=ti,c.ImageSource=Xs,c.KeyboardHandler=tn,c.LngLatBounds=Yr,c.LogoControl=Sf,c.Map=class extends ri{get _ownerWindow(){var A,o;return((o=(A=this._container)===null||A===void 0?void 0:A.ownerDocument)===null||o===void 0?void 0:o.defaultView)||window}constructor(A){var o,d;s.cH.mark(s.cI.create);const _=Object.assign(Object.assign(Object.assign({},hl),A),{canvasContextAttributes:Object.assign(Object.assign({},hl.canvasContextAttributes),A.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const x=new di,C=new Dc;_.minZoom!==void 0&&x.setMinZoom(_.minZoom),_.maxZoom!==void 0&&x.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&x.setMinPitch(_.minPitch),_.maxPitch!==void 0&&x.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&x.setRenderWorldCopies(_.renderWorldCopies),_.transformConstrain!==null&&x.setConstrainOverride(_.transformConstrain),super(x,C,{bearingSnap:_.bearingSnap,zoomSnap:_.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ul,this._controls=[],this._mapId=s.af(),this._lostContextStyle={style:null,images:null},this._contextLost=D=>{if(D.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy(),this._lostContextStyle=this._getStyleAndImages(),this.style){for(const z of Object.values(this.style._layers))if(z.type==="custom"&&console.warn(`Custom layer with id '${z.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),z._listeners)for(const[$]of Object.entries(z._listeners))console.warn(`Custom layer with id '${z.id}' had event listeners for event '${$}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:D}))}else this.fire(new s.l("webglcontextlost",{originalEvent:D}))},this._contextRestored=D=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new s.l("webglcontextrestored",{originalEvent:D}))},this._onMapScroll=D=>{if(D.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._zoomSnap=_.zoomSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Gc),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this._zoomLevelsToOverscale=_.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=_.transformCameraUpdate,this.transformConstrain=_.transformConstrain,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,_.reduceMotion!==void 0&&(N.prefersReducedMotion=_.reduceMotion),this._imageQueueHandle=Ce.addThrottleControl((()=>this.isMoving())),this._requestManager=new We(_.transformRequest),this._container=this._resolveContainer(_.container),_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Tf(this,_),this._hash=_.hash&&new ti(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,s.e({},_.fitBoundsOptions,{duration:0}))));const I=typeof _.style=="string"||((d=(o=_.style)===null||o===void 0?void 0:o.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Gn(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Sf,_.logoPosition),this.on("style.load",(()=>{if(I||this._resizeTransform(),this.transform.unmodified){const D=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(D)}})),this.on("data",(D=>{this._update(D.dataType==="style"),this.fire(new s.l(`${D.dataType}data`,D))})),this.on("dataloading",(D=>{this.fire(new s.l(`${D.dataType}dataloading`,D))})),this.on("dataabort",(D=>{this.fire(new s.l("sourcedataabort",D))}))}_getMapId(){return this._mapId}setGlobalStateProperty(A,o){return this.style.setGlobalStateProperty(A,o),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(A,o){if(o===void 0&&(o=A.getDefaultPosition?A.getDefaultPosition():"top-right"),!A||!A.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=A.onAdd(this);this._controls.push(A);const _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(A){if(!A||!A.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(A);return o>-1&&this._controls.splice(o,1),A.onRemove(this),this}hasControl(A){return this._controls.indexOf(A)>-1}coveringTiles(A){return En(this.transform,A)}calculateCameraOptionsFromTo(A,o,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLat(d,this.transform)),super.calculateCameraOptionsFromTo(A,o,d,_)}resize(A,o=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(o);const d=!this._moving;return d&&(this.stop(),this.fire(new s.l("movestart",A)).fire(new s.l("move",A))),this.fire(new s.l("resize",A)),d&&this.fire(new s.l("moveend",A)),this}_resizeInternal(A=!0){const[o,d]=this._containerDimensions(),_=this._getClampedPixelRatio(o,d);if(this._resizeCanvas(o,d,_),this.painter.resize(o,d,_),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const C=this._getClampedPixelRatio(o,d);this._resizeCanvas(o,d,C),this.painter.resize(o,d,C)}this._resizeTransform(A)}_resizeTransform(A=!0){var o;const[d,_]=this._containerDimensions();this.transform.resize(d,_,A),(o=this._requestedCameraState)===null||o===void 0||o.resize(d,_,A)}_getClampedPixelRatio(A,o){const{0:d,1:_}=this._maxCanvasSize,x=this.getPixelRatio(),C=A*x,I=o*x;return Math.min(C>d?d/C:1,I>_?_/I:1)*x}getPixelRatio(){var A;return(A=this._overridePixelRatio)!==null&&A!==void 0?A:devicePixelRatio}setPixelRatio(A){this._overridePixelRatio=A,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(A){return this.transform.setMaxBounds(Yr.convert(A)),this._update()}setMinZoom(A){if((A=A??-2)>=-2&&A<=this.transform.maxZoom){const o=this.transform.zoom,d=this._getTransformForUpdate();return d.setMinZoom(A),this._applyUpdatedTransform(d),this._update(),o!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(A){if((A=A??22)>=this.transform.minZoom){const o=this.transform.zoom,d=this._getTransformForUpdate();return d.setMaxZoom(A),this._applyUpdatedTransform(d),this._update(),o!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(A){if((A=A??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(A>=0&&A<=this.transform.maxPitch){const o=this.transform.pitch,d=this._getTransformForUpdate();return d.setMinPitch(A),this._applyUpdatedTransform(d),this._update(),o!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(A){if((A=A??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(A>=this.transform.minPitch){const o=this.transform.pitch,d=this._getTransformForUpdate();return d.setMaxPitch(A),this._applyUpdatedTransform(d),this._update(),o!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(A){return this.transform.setRenderWorldCopies(A),this._update()}setTransformConstrain(A){return this.transform.setConstrainOverride(A),this._update()}project(A){return this.transform.locationToScreenPoint(s.V.convert(A),this.style&&this.terrain)}unproject(A){return this.transform.screenPointToLocation(s.P.convert(A),this.terrain)}isMoving(){var A;return this._moving||((A=this.handlers)===null||A===void 0?void 0:A.isMoving())}isZooming(){var A;return this._zooming||((A=this.handlers)===null||A===void 0?void 0:A.isZooming())}isRotating(){var A;return this._rotating||((A=this.handlers)===null||A===void 0?void 0:A.isRotating())}_createDelegatedListener(A,o,d){if(A==="mouseenter"||A==="mouseover"){let _=!1;return{layers:o,listener:d,delegates:{mousemove:C=>{const I=o.filter((z=>this.getLayer(z))),D=I.length!==0?this.queryRenderedFeatures(C.point,{layers:I}):[];D.length?_||(_=!0,d.call(this,new Ti(A,this,C.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(A==="mouseleave"||A==="mouseout"){let _=!1;return{layers:o,listener:d,delegates:{mousemove:I=>{const D=o.filter((z=>this.getLayer(z)));(D.length!==0?this.queryRenderedFeatures(I.point,{layers:D}):[]).length?_=!0:_&&(_=!1,d.call(this,new Ti(A,this,I.originalEvent)))},mouseout:I=>{_&&(_=!1,d.call(this,new Ti(A,this,I.originalEvent)))}}}}{const _=x=>{const C=o.filter((D=>this.getLayer(D))),I=C.length!==0?this.queryRenderedFeatures(x.point,{layers:C}):[];I.length&&(x.features=I,d.call(this,x),delete x.features)};return{layers:o,listener:d,delegates:{[A]:_}}}}_saveDelegatedListener(A,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[A]=this._delegatedListeners[A]||[],this._delegatedListeners[A].push(o)}_removeDelegatedListener(A,o,d){if(!this._delegatedListeners||!this._delegatedListeners[A])return;const _=this._delegatedListeners[A];for(let x=0;x<_.length;x++){const C=_[x];if(C.listener===d&&C.layers.length===o.length&&C.layers.every((I=>o.includes(I)))){for(const I in C.delegates)this.off(I,C.delegates[I]);return void _.splice(x,1)}}}on(A,o,d){if(d===void 0)return super.on(A,o);const _=typeof o=="string"?[o]:o,x=this._createDelegatedListener(A,_,d);this._saveDelegatedListener(A,x);for(const C in x.delegates)this.on(C,x.delegates[C]);return{unsubscribe:()=>{this._removeDelegatedListener(A,_,d)}}}once(A,o,d){if(d===void 0)return super.once(A,o);const _=typeof o=="string"?[o]:o,x=this._createDelegatedListener(A,_,d);for(const C in x.delegates){const I=x.delegates[C];x.delegates[C]=(...D)=>{this._removeDelegatedListener(A,_,d),I(...D)}}this._saveDelegatedListener(A,x);for(const C in x.delegates)this.once(C,x.delegates[C]);return this}off(A,o,d){return d===void 0?super.off(A,o):(this._removeDelegatedListener(A,typeof o=="string"?[o]:o,d),this)}queryRenderedFeatures(A,o){if(!this.style)return[];let d;const _=A instanceof s.P||Array.isArray(A),x=_?A:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(_?{}:A)||{},x instanceof s.P||typeof x[0]=="number")d=[s.P.convert(x)];else{const C=s.P.convert(x[0]),I=s.P.convert(x[1]);d=[C,new s.P(I.x,C.y),I,new s.P(C.x,I.y),C]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(A,o){return this.style.querySourceFeatures(A,o)}setStyle(A,o){return(o=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&A?(this._diffStyle(A,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(A,o))}setTransformRequest(A){return this._requestManager.setTransformRequest(A),this}_getUIString(A){const o=this._locale[A];if(o==null)throw new Error(`Missing UI string '${A}'`);return o}_updateStyle(A,o){var d,_;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(A,o)));const x=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!A)),A?(this.style=new jl(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof A=="string"?this.style.loadURL(A,o,x):this.style.loadJSON(A,o,x),this):((_=(d=this.style)===null||d===void 0?void 0:d.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new jl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(A,o){if(typeof A=="string"){const d=this._requestManager.transformRequest(A,"Style");s.j(d,new AbortController).then((_=>{this._updateDiff(_.data,o)})).catch((_=>{_&&this.fire(new s.k(_))}))}else typeof A=="object"&&this._updateDiff(A,o)}_updateDiff(A,o){try{this.style.setState(A,o)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(A,o)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(A,o){return this._lazyInitEmptyStyle(),this.style.addSource(A,o),this._update(!0)}isSourceLoaded(A){const o=this.style&&this.style.tileManagers[A];if(o!==void 0)return o.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${A}'`)))}setTerrain(A){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),A){const o=this.style.tileManagers[A.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${A.source}`);this.terrain===null&&o.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===A.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),_.type==="color-relief"&&_.source===A.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Rr(this.painter,o,A),this.painter.renderToTexture=new ro(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var _;d.dataType==="style"?this.terrain.tileManager.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==A.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=d.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:A})),this}getTerrain(){var A,o;return(o=(A=this.terrain)===null||A===void 0?void 0:A.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const A=this.style&&this.style.tileManagers;for(const o of Object.values(A))if(!o.areTilesLoaded())return!1;return!0}removeSource(A){return this.style.removeSource(A),this._update(!0)}getSource(A){return this.style.getSource(A)}setSourceTileLodParams(A,o,d){if(d){const _=this.getSource(d);if(!_)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);_.calculateTileZoom=fr(Math.max(1,A),Math.max(1,o))}else for(const _ in this.style.tileManagers)this.style.tileManagers[_].getSource().calculateTileZoom=fr(Math.max(1,A),Math.max(1,o));return this._update(!0),this}refreshTiles(A,o){const d=this.style.tileManagers[A];if(!d)throw new Error(`There is no tile manager with ID "${A}", cannot refresh tile`);o===void 0?d.reload(!0):d.refreshTiles(o.map((_=>new s.ac(_.z,_.x,_.y))))}addImage(A,o,d={}){const{pixelRatio:_=1,sdf:x=!1,stretchX:C,stretchY:I,content:D,textFitWidth:z,textFitHeight:$}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||s.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:Z,data:G}=o,ne=o;return this.style.addImage(A,{data:new s.R({width:H,height:Z},new Uint8Array(G)),pixelRatio:_,stretchX:C,stretchY:I,content:D,textFitWidth:z,textFitHeight:$,sdf:x,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,A),this}}{const{width:H,height:Z,data:G}=N.getImageData(o);this.style.addImage(A,{data:new s.R({width:H,height:Z},G),pixelRatio:_,stretchX:C,stretchY:I,content:D,textFitWidth:z,textFitHeight:$,sdf:x,version:0})}}updateImage(A,o){const d=this.style.getImage(A);if(!d)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=o instanceof HTMLImageElement||s.b(o)?N.getImageData(o):o,{width:x,height:C,data:I}=_;if(x===void 0||C===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==d.data.width||C!==d.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(o instanceof HTMLImageElement||s.b(o));return d.data.replace(I,D),this.style.updateImage(A,d),this}getImage(A){return this.style.getImage(A)}hasImage(A){return A?!!this.style.getImage(A):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(A){this.style.removeImage(A)}loadImage(A){return Ce.getImage(this._requestManager.transformRequest(A,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(A,o){return this._lazyInitEmptyStyle(),this.style.addLayer(A,o),this._update(!0)}moveLayer(A,o){return this.style.moveLayer(A,o),this._update(!0)}removeLayer(A){return this.style.removeLayer(A),this._update(!0)}getLayer(A){return this.style.getLayer(A)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(A,o,d){return this.style.setLayerZoomRange(A,o,d),this._update(!0)}setFilter(A,o,d={}){return this.style.setFilter(A,o,d),this._update(!0)}getFilter(A){return this.style.getFilter(A)}setPaintProperty(A,o,d,_={}){return this.style.setPaintProperty(A,o,d,_),this._update(!0)}getPaintProperty(A,o){return this.style.getPaintProperty(A,o)}setLayoutProperty(A,o,d,_={}){return this.style.setLayoutProperty(A,o,d,_),this._update(!0)}getLayoutProperty(A,o){return this.style.getLayoutProperty(A,o)}setGlyphs(A,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(A,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(A,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(A,o,d,(_=>{_||this._update(!0)})),this}removeSprite(A){return this._lazyInitEmptyStyle(),this.style.removeSprite(A),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(A,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(A,o,(d=>{d||this._update(!0)})),this}setLight(A,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(A,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(A,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(A,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(A,o){return this.style.setFeatureState(A,o),this._update()}removeFeatureState(A,o){return this.style.removeFeatureState(A,o),this._update()}getFeatureState(A){return this.style.getFeatureState(A)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let A=0,o=0;return this._container&&(A=this._container.clientWidth||400,o=this._container.clientHeight||300),[A,o]}_setupResizeObserver(){var A;let o=!1;const d=Gp((x=>{this._trackResize&&!this._removed&&(this.resize(x),this.redraw())}),50),_=(A=this._ownerWindow.ResizeObserver)!==null&&A!==void 0?A:ResizeObserver;this._resizeObserver=new _((x=>{o?d(x):o=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(A){if(typeof A=="string"){const o=document.getElementById(A);if(!o)throw new Error(`Container '${A}' not found.`);return o}if(A instanceof HTMLElement||A&&typeof A=="object"&&A.nodeType===1)return A;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const A=this._container;A.classList.add("maplibregl-map");const o=this._canvasContainer=j.create("div","maplibregl-canvas-container",A);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=j.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const x=this._controlContainer=j.create("div","maplibregl-control-container",A),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((I=>{C[I]=j.create("div",`maplibregl-ctrl-${I} `,x)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(A,o,d){this._canvas.width=Math.floor(d*A),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${A}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const A=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let o=null;this._canvas.addEventListener("webglcontextcreationerror",(_=>{o={requestedAttributes:A},_&&(o.statusMessage=_.statusMessage,o.type=_.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,A):this._canvas.getContext("webgl2",A)||this._canvas.getContext("webgl",A),!d){const _="Failed to initialize WebGL";throw o?(o.message=_,new Error(JSON.stringify(o))):new Error(_)}this.painter=new Gm(d,this.transform),Y.testSupport(d)}migrateProjection(A,o){super.migrateProjection(A,o),this.painter.transform=A,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(A){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||A,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(A){return this._update(),this._renderTaskQueue.add(A)}_cancelRenderFrame(A){this._renderTaskQueue.remove(A)}_render(A){var o,d,_,x,C;const I=this._idleTriggered?this._fadeDuration:0,D=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(A),this._removed)return;let z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,G=W();this.style.zoomHistory.update(Z,G);const ne=new s.H(Z,{now:G,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=ne.crossFadingFactor();le===1&&le===this._crossFadingFactor||(z=!0,this._crossFadingFactor=le),this.style.update(ne)}const $=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==D;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((x=this.style.projection)===null||x===void 0?void 0:x.transitionState,(C=this.style.projection)===null||C===void 0?void 0:C.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||$)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,$),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cH.mark(s.cI.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const H=this._sourcesDirty||this._styleDirty||this._placementDirty;return H||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||H||(this._fullyLoaded=!0,s.cH.mark(s.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var A;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),Ce.removeThrottleControl(this._imageQueueHandle),(A=this._resizeObserver)===null||A===void 0||A.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),j.remove(this._canvasContainer),j.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cH.remove(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frame(this._frameRequest,(A=>{s.cH.recordStartOfFrameAt(A),this._frameRequest=null;try{this._render(A)}catch(o){if(!s.Z(o)&&!(function(d){return d.message===Gl})(o))throw o}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(A){this._showTileBoundaries!==A&&(this._showTileBoundaries=A,this._update())}get showPadding(){return!!this._showPadding}set showPadding(A){this._showPadding!==A&&(this._showPadding=A,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(A){this._showCollisionBoxes!==A&&(this._showCollisionBoxes=A,A?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(A){this._showOverdrawInspector!==A&&(this._showOverdrawInspector=A,this._update())}get repaint(){return!!this._repaint}set repaint(A){this._repaint!==A&&(this._repaint=A,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(A){this._vertices=A,this._update()}get version(){return Zc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(A){return this._lazyInitEmptyStyle(),this.style.setProjection(A),this._update(!0)}},c.MapMouseEvent=Ti,c.MapTouchEvent=Ja,c.MapWheelEvent=kd,c.Marker=Ef,c.NavigationControl=class{constructor(A){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),_=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);o.title=_,o.setAttribute("aria-label",_)},this.options=s.e({},Qp,A),this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(o=>this._map.zoomIn({},{originalEvent:o}))),j.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(o=>this._map.zoomOut({},{originalEvent:o}))),j.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})})),this._compassIcon=j.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(A){return this._map=A,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(A,o){const d=j.create("button",A,this._container);return d.type="button",d.addEventListener("click",o),d}},c.Popup=class extends s.E{constructor(A){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=j.create("div","maplibregl-popup",this._map.getContainer()),this._tip=j.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=nh(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!o)return;const d=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const x=sh(this.options.offset);if(!_){const I=this._container.offsetWidth,D=this._container.offsetHeight,z=(function(H){var Z,G,ne,le;return H?{top:(Z=H.top)!==null&&Z!==void 0?Z:0,right:(G=H.right)!==null&&G!==void 0?G:0,bottom:(ne=H.bottom)!==null&&ne!==void 0?ne:0,left:(le=H.left)!==null&&le!==void 0?le:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let $;$=d.y+x.bottom.y<D+z.top?["top"]:d.y>this._map.transform.height-D-z.bottom?["bottom"]:[],d.x<I/2+z.left?$.push("left"):d.x>this._map.transform.width-I/2-z.right&&$.push("right"),_=$.length===0?"bottom":$.join("-")}let C=d.add(x[_]);this.options.subpixelPositioning||(C=C.round()),j.setTransform(this._container,`${ih[_]} translate(${C.x}px,${C.y}px)`),Af(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Yc),A)}addTo(A){return this._map&&this.remove(),this._map=A,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.V.convert(A),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(A){return this.setDOMContent(document.createTextNode(A))}setHTML(A){const o=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=A;_=d.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){var A;return(A=this._container)===null||A===void 0?void 0:A.style.maxWidth}setMaxWidth(A){return this.options.maxWidth=A,this._update(),this}setDOMContent(A){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(A),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(A){return this._container&&this._container.classList.add(A),this}removeClassName(A){return this._container&&this._container.classList.remove(A),this}setOffset(A){return this.options.offset=A,this._update(),this}toggleClassName(A){if(this._container)return this._container.classList.toggle(A)}setSubpixelPositioning(A){this.options.subpixelPositioning=A}setPadding(A){this.options.padding=A,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=j.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const A=this._container.querySelector(Kc);A&&A.focus()}},c.RasterDEMTileSource=yo,c.RasterTileSource=Zo,c.ScaleControl=class{constructor(A){this._onMove=()=>{On(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,On(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},$i),A)}getDefaultPosition(){return"bottom-left"}onAdd(A){return this._map=A,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-scale",A.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=xf,c.Style=jl,c.TerrainControl=class{constructor(A){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=A}onAdd(A){return this._map=A,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=j.create("button","maplibregl-ctrl-terrain",this._container),j.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){j.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=ll,c.TwoFingersTouchRotateHandler=bf,c.TwoFingersTouchZoomHandler=Fo,c.TwoFingersTouchZoomRotateHandler=Xc,c.VectorTileSource=Rl,c.VideoSource=ku,c.addSourceType=(A,o)=>s._(void 0,void 0,void 0,(function*(){if(Vh(A))throw new Error(`A source type called "${A}" already exists.`);((d,_)=>{Ko[d]=_})(A,o)})),c.clearPrewarmedResources=function(){const A=Wt;A&&(A.isPreloaded()&&A.numActive()===1?(A.release(Tt),Wt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=Lm,c.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ie().getRTLTextPluginStatus()},c.getVersion=function(){return io},c.getWorkerCount=function(){return zt.workerCount},c.getWorkerUrl=function(){return s.c.WORKER_URL},c.importScriptInWorkers=function(A){return Tr().broadcast("IS",A)},c.isTimeFrozen=function(){return V.isFrozen()},c.now=W,c.prewarm=function(){_t().acquire(Tt)},c.restoreNow=function(){V.restoreNow()},c.setMaxParallelImageRequests=function(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A},c.setNow=function(A){V.setNow(A)},c.setRTLTextPlugin=function(A,o){return ie().setRTLTextPlugin(A,o)},c.setWorkerCount=function(A){zt.workerCount=A},c.setWorkerUrl=function(A){s.c.WORKER_URL=A}}));var l=r;return l}))})(E1)),E1.exports}var F8=B8();function Z1(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const WP=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),rI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rI&&parseFloat(rI[1]);const nI=globalThis,iI=globalThis.process||{},j8=globalThis.navigator||{};function I4(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function Sm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||I4()}function U8(t){return Sm()?I4()?"Electron":(j8.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const R4="4.1.0";function V8(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class $8{constructor(e,r,n="sessionStorage"){this.storage=V8(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function W8(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function H8(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var Y1;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Y1||(Y1={}));const q8=10;function sI(t){return typeof t!="string"?t:(t=t.toUpperCase(),Y1[t]||Y1.WHITE)}function X8(t,e,r){return!Sm&&typeof t=="string"&&(e&&(t=`\x1B[${sI(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${sI(r)+q8}m${t}\x1B[49m`)),t}function G8(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const l of n){const c=i[l];typeof c=="function"&&(e.find(s=>l===s)||(i[l]=c.bind(t)))}}function HP(t,e){if(!t)throw new Error("Assertion failed")}function ty(){let t;if(Sm()&&nI.performance)t=nI?.performance?.now?.();else if("hrtime"in iI){const e=iI?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const ry={debug:Sm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Z8={enabled:!0,level:0};function ny(){}const aI={},oI={once:!0};class gb{constructor({id:e}={id:""}){this.VERSION=R4,this._startTs=ty(),this._deltaTs=ty(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new $8(`__probe-${this.id}__`,Z8),this.timeStamp(`${this.id} started`),G8(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ty()-this._startTs).toPrecision(10))}getDelta(){return Number((ty()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ry.warn,arguments,oI)}error(e){return this._getLogFunction(0,e,ry.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,ry.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,ry.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,ry.debug||ry.info,arguments,oI)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||ny,n&&[n],{tag:K8(r)}):ny}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||ny)}group(e,r,n={collapsed:!1}){const i=lI({logLevel:e,message:r,opts:n}),{collapsed:l}=n;return i.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ny)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=O4(e)}_getLogFunction(e,r,n,i,l){if(this._shouldLog(e)){l=lI({logLevel:e,message:r,args:i,opts:l}),n=n||l.method,HP(n),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=ty();const c=l.tag||l.message;if(l.once&&c)if(!aI[c])aI[c]=ty();else return ny;return r=Y8(this.id,l.message,l),n.bind(console,r,...l.args)}return ny}}gb.VERSION=R4;function O4(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return HP(Number.isFinite(e)&&e>=0),e}function lI(t){const{logLevel:e,message:r}=t;t.logLevel=O4(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return HP(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function Y8(t,e,r){if(typeof e=="string"){const n=r.time?H8(W8(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=X8(e,r.color,r.background)}return e}function K8(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const U2="4.3.3",Q8=U2[0]>="0"&&U2[0]<="9"?`v${U2}`:"";function J8(){const t=new gb({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=Q8,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const eV=J8();function tV(t,e){return D4(t||{},e)}function D4(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?n[i]=D4(n[i]||{},e[i],r+1):n[i]=e[i];return n}const rV="latest";function nV(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const iV=nV();function Ep(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const rm=typeof process!="object"||String(process)!=="[object process]"||process.browser,sV=typeof window<"u"&&typeof window.orientation<"u",cI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);cI&&parseFloat(cI[1]);class aV{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Ep(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ep(this.isRunning),this.isRunning=!1,this._reject(e)}}class V2{terminate(){}}const $2=new Map;function oV(t){Ep(t.source&&!t.url||!t.source&&t.url);let e=$2.get(t.source||t.url);return e||(t.url&&(e=lV(t.url),$2.set(t.url,e)),t.source&&(e=k4(t.source),$2.set(t.source,e))),Ep(e),e}function lV(t){if(!t.startsWith("http"))return t;const e=cV(t);return k4(e)}function k4(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function cV(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function L4(t,e=!0,r){const n=r||new Set;if(t){if(uI(t))n.add(t);else if(uI(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)L4(t[i],e,n)}}return r===void 0?Array.from(n):[]}function uI(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const W2=()=>{};class fE{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&rm||typeof V2<"u"&&!rm}constructor(e){const{name:r,source:n,url:i}=e;Ep(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=W2,this.onError=l=>console.log(l),this.worker=rm?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=W2,this.onError=W2,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||L4(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=oV({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new V2(n,{eval:!1})}else if(this.source)e=new V2(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class uV{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return fE.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,l,c)=>i.done(c),n=(i,l)=>i.error(l)){const i=new Promise(l=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:l}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new aV(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!rm||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new fE({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return sV?this.maxMobileConcurrency:this.maxConcurrency}}const hV={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class mp{props;workerPools=new Map;static _workerFarm;static isSupported(){return fE.isSupported()}static getWorkerFarm(e={}){return mp._workerFarm=mp._workerFarm||new mp({}),mp._workerFarm.setProps(e),mp._workerFarm}constructor(e){this.props={...hV},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let l=this.workerPools.get(r);return l||(l=new uV({name:r,source:n,url:i}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function fV(t,e={}){const r=e[t.id]||{},n=rm?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(rm?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let l=t.version;l==="latest"&&(l=rV);const c=l?`@${l}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${n}`}return Ep(i),i}function dV(t,e=iV){Ep(t,"no worker provided");const r=t.version;return!(!e||!r)}function pV(t,e){return!mp.isSupported()||!rm&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function gV(t,e,r,n,i){const l=t.id,c=fV(t,r),m=mp.getWorkerFarm(r).getWorkerPool({name:l,url:c});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const b=await m.startJob("process-on-worker",mV.bind(null,i));return b.postMessage("process",{input:e,options:r,context:n}),await(await b.result).result}async function mV(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:l,options:c}=n;try{const s=await t(l,c);e.postMessage("done",{id:i,result:s})}catch(s){const m=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:i,error:m})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function _V(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let l=0;l<n.length;++l)if(n[l]!==i[l])return!1;return!0}function yV(...t){return vV(t)}function vV(t){const e=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),r=e.reduce((l,c)=>l+c.byteLength,0),n=new Uint8Array(r);let i=0;for(const l of e)n.set(l,i),i+=l.byteLength;return n.buffer}async function bV(t){const e=[];for await(const r of t)e.push(r);return yV(...e)}function hI(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class fI{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=hI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(hI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class gT{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof fI?i=e:i=new fI(r,n),this.stats[r]=i),i}}let xV="";const dI={};function wV(t){for(const e in dI)if(t.startsWith(e)){const r=dI[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${xV}${t}`),t}function TV(t){return t&&typeof t=="object"&&t.isBuffer}function N4(t){if(TV(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function z4(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function SV(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const AV=t=>typeof t=="boolean",M0=t=>typeof t=="function",mb=t=>t!==null&&typeof t=="object",pI=t=>mb(t)&&t.constructor==={}.constructor,EV=t=>!!t&&typeof t[Symbol.iterator]=="function",PV=t=>t&&typeof t[Symbol.asyncIterator]=="function",Am=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Em=t=>typeof Blob<"u"&&t instanceof Blob,CV=t=>t&&typeof t=="object"&&t.isBuffer,MV=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||mb(t)&&M0(t.tee)&&M0(t.cancel)&&M0(t.getReader),IV=t=>mb(t)&&M0(t.read)&&M0(t.pipe)&&AV(t.readable),B4=t=>MV(t)||IV(t);class RV extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const OV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,DV=/^([-\w.]+\/[-\w.+]+)/;function gI(t,e){return t.toLowerCase()===e.toLowerCase()}function kV(t){const e=DV.exec(t);return e?e[1]:t}function mI(t){const e=OV.exec(t);return e?e[1]:""}const F4=/\?.*/;function LV(t){const e=t.match(F4);return e&&e[0]}function qP(t){return t.replace(F4,"")}function NV(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function mT(t){return Am(t)?t.url:Em(t)?t.name||"":typeof t=="string"?t:""}function XP(t){if(Am(t)){const e=t,r=e.headers.get("content-type")||"",n=qP(e.url);return kV(r)||mI(n)}return Em(t)?t.type||"":typeof t=="string"?mI(t):""}function zV(t){return Am(t)?t.headers["content-length"]||-1:Em(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function j4(t){if(Am(t))return t;const e={},r=zV(t);r>=0&&(e["content-length"]=String(r));const n=mT(t),i=XP(t);i&&(e["content-type"]=i);const l=await jV(t);l&&(e["x-first-bytes"]=l),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:n}),c}async function BV(t){if(!t.ok)throw await FV(t)}async function FV(t){const e=NV(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&i?.includes("application/json")?await t.json():await t.text()}catch{}return new RV(r,n)}async function jV(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=l=>n(l?.target?.result),i.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${UV(r)}`}return null}function UV(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function VV(t){return!$V(t)&&!WV(t)}function $V(t){return t.startsWith("http:")||t.startsWith("https:")}function WV(t){return t.startsWith("data:")}async function _I(t,e){if(typeof t=="string"){const r=wV(t);return VV(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await j4(t)}const yI=new gb({id:"loaders.gl"});class HV{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class qV{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const U4={fetch:null,mimeType:void 0,nothrow:!1,log:new qV,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:WP,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},XV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function V4(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function $4(){const t=V4();return t.globalOptions=t.globalOptions||{...U4},t.globalOptions}function GV(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],ZV(t,r),KV(e,t,n)}function ZV(t,e){vI(t,null,U4,XV,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},l=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};vI(n,r.id,i,l,e)}}function vI(t,e,r,n,i){const l=e||"Top level",c=e?`${e}.`:"";for(const s in t){const m=!e&&mb(t[s]),b=s==="baseUri"&&!e,w=s==="workerUrl"&&e;if(!(s in r)&&!b&&!w){if(s in n)yI.warn(`${l} loader option '${c}${s}' no longer supported, use '${n[s]}'`)();else if(!m){const E=YV(s,i);yI.warn(`${l} loader option '${c}${s}' not recognized. ${E}`)()}}}}function YV(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const l in i.options){if(t===l)return`Did you mean '${i.id}.${l}'?`;const c=l.toLowerCase();(r.startsWith(c)||c.startsWith(r))&&(n=n||`Did you mean '${i.id}.${l}'?`)}return n}function KV(t,e,r){const i={...t.options||{}};return QV(i,r),i.log===null&&(i.log=new HV),bI(i,$4()),bI(i,e),i}function bI(t,e){for(const r in e)if(r in e){const n=e[r];pI(n)&&pI(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function QV(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function GP(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function ZP(t){Z1(t,"null loader"),Z1(GP(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const W4=()=>{const t=V4();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function JV(t){const e=W4();t=Array.isArray(t)?t:[t];for(const r of t){const n=ZP(r);e.find(i=>n===i)||e.unshift(n)}}function e$(){return W4()}const t$=/\.([^.]+)$/;async function r$(t,e=[],r,n){if(!H4(t))return null;let i=xI(t,e,{...r,nothrow:!0},n);if(i)return i;if(Em(t)&&(t=await t.slice(0,10).arrayBuffer(),i=xI(t,e,r,n)),!i&&!r?.nothrow)throw new Error(q4(t));return i}function xI(t,e=[],r,n){if(!H4(t))return null;if(e&&!Array.isArray(e))return ZP(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...e$()),i$(i);const l=n$(t,i,r,n);if(!l&&!r?.nothrow)throw new Error(q4(t));return l}function n$(t,e,r,n){const i=mT(t),l=XP(t),c=qP(i)||n?.url;let s=null,m="";return r?.mimeType&&(s=H2(e,r?.mimeType),m=`match forced by supplied MIME type ${r?.mimeType}`),s=s||s$(e,c),m=m||(s?`matched url ${c}`:""),s=s||H2(e,l),m=m||(s?`matched MIME type ${l}`:""),s=s||o$(e,t),m=m||(s?`matched initial data ${X4(t)}`:""),r?.fallbackMimeType&&(s=s||H2(e,r?.fallbackMimeType),m=m||(s?`matched fallback MIME type ${l}`:"")),m&&eV.log(1,`selectLoader selected ${s?.name}: ${m}.`),s}function H4(t){return!(t instanceof Response&&t.status===204)}function q4(t){const e=mT(t),r=XP(t);let n="No valid loader found (";n+=e?`${z4(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?X4(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function i$(t){for(const e of t)ZP(e)}function s$(t,e){const r=e&&t$.exec(e),n=r&&r[1];return n?a$(t,n):null}function a$(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function H2(t,e){for(const r of t)if(r.mimeTypes?.some(n=>gI(e,n))||gI(e,`application/x.${r.id}`))return r;return null}function o$(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(l$(e,r))return r}else if(ArrayBuffer.isView(e)){if(wI(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&wI(e,0,r))return r;return null}function l$(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function wI(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>c$(t,e,r,i))}function c$(t,e,r,n){if(n instanceof ArrayBuffer)return _V(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=dE(t,e,n.length);return n===i;default:return!1}}function X4(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?dE(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?dE(t,0,e):""}function dE(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let l=0;l<r;l++)i+=String.fromCharCode(n.getUint8(e+l));return i}const u$=256*1024;function*h$(t,e){const r=e?.chunkSize||u$;let n=0;const i=new TextEncoder;for(;n<t.length;){const l=Math.min(t.length-n,r),c=t.slice(n,n+l);n+=l,yield i.encode(c)}}const f$=256*1024;function*d$(t,e={}){const{chunkSize:r=f$}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),l=new ArrayBuffer(i),c=new Uint8Array(t,n,i);new Uint8Array(l).set(c),n+=i,yield l}}const p$=1024*1024;async function*g$(t,e){const r=e?.chunkSize||p$;let n=0;for(;n<t.size;){const i=n+r,l=await t.slice(n,i).arrayBuffer();n=i,yield l}}function TI(t,e){return WP?m$(t,e):_$(t)}async function*m$(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:l,value:c}=await i;if(l)return;yield N4(c)}}catch{r.releaseLock()}}async function*_$(t,e){for await(const r of t)yield N4(r)}function y$(t,e){if(typeof t=="string")return h$(t,e);if(t instanceof ArrayBuffer)return d$(t,e);if(Em(t))return g$(t,e);if(B4(t))return TI(t,e);if(Am(t))return TI(t.body,e);throw new Error("makeIterator")}const G4="Cannot convert supplied data type";function v$(t,e,r){if(e.text&&typeof t=="string")return t;if(CV(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(G4)}async function b$(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return v$(t,e);if(Em(t)&&(t=await j4(t)),Am(t)){const i=t;return await BV(i),e.binary?await i.arrayBuffer():await i.text()}if(B4(t)&&(t=y$(t,r)),EV(t)||PV(t))return bV(t);throw new Error(G4)}function Z4(t,e){const r=$4(),n=t||r;return typeof n.fetch=="function"?n.fetch:mb(n.fetch)?i=>_I(i,n.fetch):e?.fetch?e?.fetch:_I}function x$(t,e,r){if(r)return r;const n={fetch:Z4(e,t),...t};if(n.url){const i=qP(n.url);n.baseUrl=i,n.queryString=LV(n.url),n.filename=z4(i),n.baseUrl=SV(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function w$(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function K1(t,e,r,n){e&&!Array.isArray(e)&&!GP(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=mT(t),c=w$(e,n),s=await r$(t,c,r);return s?(r=GV(r,s,c,i),n=x$({url:i,_parse:K1,loaders:c},r,n||null),await T$(s,t,r,n)):null}async function T$(t,e,r,n){if(dV(t),r=tV(t.options,r),Am(e)){const l=e,{ok:c,redirected:s,status:m,statusText:b,type:w,url:E}=l,O=Object.fromEntries(l.headers.entries());n.response={headers:O,ok:c,redirected:s,status:m,statusText:b,type:w,url:E}}e=await b$(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(pV(t,r))return await gV(t,e,r,n,K1);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw Ep(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Q1(t,e,r,n){let i,l;!Array.isArray(e)&&!GP(e)?(i=[],l=e):(i=e,l=r);const c=Z4(l);let s=t;return typeof t=="string"&&(s=await c(t)),Em(t)&&(s=await c(t)),Array.isArray(i)?await K1(s,i,l):await K1(s,i,l)}const S$="4.3.3",A$=globalThis.loaders?.parseImageNode,pE=typeof Image<"u",gE=typeof ImageBitmap<"u",E$=!!A$,mE=WP?!0:E$;function P$(t){switch(t){case"auto":return gE||pE||mE;case"imagebitmap":return gE;case"image":return pE;case"data":return mE;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function C$(){if(gE)return"imagebitmap";if(pE)return"image";if(mE)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function M$(t){const e=R$(t);if(!e)throw new Error("Not an image");return e}function I$(t){switch(M$(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function R$(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const O$=/^data:image\/svg\+xml/,D$=/\.svg((\?|#).*)?$/;function YP(t){return t&&(O$.test(t)||D$.test(t))}function k$(t,e){if(YP(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(l){throw new Error(l.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return Y4(t,e)}function Y4(t,e){if(YP(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function K4(t,e,r){const n=k$(t,r),i=self.URL||self.webkitURL,l=typeof n!="string"&&i.createObjectURL(n);try{return await L$(l||n,e)}finally{l&&i.revokeObjectURL(l)}}async function L$(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=l=>{const c=l instanceof Error?l.message:"error";i(new Error(c))}}catch(l){i(l)}})}const N$={};let SI=!0;async function z$(t,e,r){let n;YP(r)?n=await K4(t,e,r):n=Y4(t,r);const i=e&&e.imagebitmap;return await B$(n,i)}async function B$(t,e=null){if((F$(e)||!SI)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),SI=!1}return await createImageBitmap(t)}function F$(t){for(const e in t||N$)return!1;return!0}function j$(t){return!W$(t,"ftyp",4)||(t[8]&96)===0?null:U$(t)}function U$(t){switch(V$(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function V$(t,e,r){return String.fromCharCode(...t.slice(e,r))}function $$(t){return[...t].map(e=>e.charCodeAt(0))}function W$(t,e,r=0){const n=$$(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const Ch=!1,I0=!0;function Q4(t){const e=_b(t);return q$(e)||Z$(e)||X$(e)||G$(e)||H$(e)}function H$(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=j$(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function q$(t){const e=_b(t);return e.byteLength>=24&&e.getUint32(0,Ch)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ch),height:e.getUint32(20,Ch)}:null}function X$(t){const e=_b(t);return e.byteLength>=10&&e.getUint32(0,Ch)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,I0),height:e.getUint16(8,I0)}:null}function G$(t){const e=_b(t);return e.byteLength>=14&&e.getUint16(0,Ch)===16973&&e.getUint32(2,I0)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,I0),height:e.getUint32(22,I0)}:null}function Z$(t){const e=_b(t);if(!(e.byteLength>=3&&e.getUint16(0,Ch)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=Y$();let l=2;for(;l+9<e.byteLength;){const c=e.getUint16(l,Ch);if(i.has(c))return{mimeType:"image/jpeg",height:e.getUint16(l+5,Ch),width:e.getUint16(l+7,Ch)};if(!n.has(c))return null;l+=2,l+=e.getUint16(l,Ch)}return null}function Y$(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function _b(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function K$(t,e){const{mimeType:r}=Q4(t)||{},n=globalThis.loaders?.parseImageNode;return Z1(n),await n(t,r)}async function Q$(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:l}=r||{},c=J$(i);let s;switch(c){case"imagebitmap":s=await z$(t,e,l);break;case"image":s=await K4(t,e,l);break;case"data":s=await K$(t);break;default:Z1(!1)}return i==="data"&&(s=I$(s)),s}function J$(t){switch(t){case"auto":case"data":return C$();default:return P$(t),t}}const e7=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],t7=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],r7={image:{type:"auto",decode:!0}},n7={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:S$,mimeTypes:t7,extensions:e7,parse:Q$,tests:[t=>!!Q4(new DataView(t))],options:r7},Wr=new gb({id:"deck"});let _E={};function i7(t){_E=t}function Xa(t,e,r,n){Wr.level>0&&_E[t]&&_E[t].call(null,e,r,n)}function s7(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const a7={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:s7,parseTextSync:JSON.parse};function o7(){const t="9.2.7",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Wr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Wr,_registerLoggers:i7},JV([a7,[n7,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const l7=o7();function KP(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const q2={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function c7(t){const e={};for(const[r,n]of Object.entries(t))e[r]=u7(n);return e}function u7(t){let e=AI(t);if(e!=="object")return{value:t,...q2[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...q2[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=AI(t.value),{...t,...q2[e],type:e}):{type:"object",value:null};throw new Error("props")}function AI(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const h7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,f7=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,d7={vertex:h7,fragment:f7},EI=/void\s+main\s*\([^)]*\)\s*\{\n?/,PI=/}\n?[^{}]*$/,X2=[],P1="__LUMA_INJECT_DECLARATIONS__";function p7(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const i=g7(r);typeof n=="string"&&(n={order:0,injection:n}),e[i][r]=n}return e}function g7(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function J1(t,e,r,n=!1){const i=e==="vertex";for(const l in r){const c=r[l];c.sort((m,b)=>m.order-b.order),X2.length=c.length;for(let m=0,b=c.length;m<b;++m)X2[m]=c[m].injection;const s=`${X2.join(`
`)}
`;switch(l){case"vs:#decl":i&&(t=t.replace(P1,s));break;case"vs:#main-start":i&&(t=t.replace(EI,m=>m+s));break;case"vs:#main-end":i&&(t=t.replace(PI,m=>s+m));break;case"fs:#decl":i||(t=t.replace(P1,s));break;case"fs:#main-start":i||(t=t.replace(EI,m=>m+s));break;case"fs:#main-end":i||(t=t.replace(PI,m=>s+m));break;default:t=t.replace(l,m=>m+s)}}return t=t.replace(P1,""),n&&(t=t.replace(/\}\s*$/,l=>l+d7[e])),t}function ew(t){t.map(e=>m7(e))}function m7(t){if(t.instance)return;ew(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,i={normalizedInjections:p7(n),parsedDeprecations:_7(r)};e&&(i.propValidators=c7(e)),t.instance=i;let l={};e&&(l=Object.entries(e).reduce((c,[s,m])=>{const b=m?.value;return b&&(c[s]=b),c},{})),t.defaultUniforms={...t.defaultUniforms,...l}}function J4(t,e,r){t.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function _7(t){return t.forEach(e=>{e.type==="function"?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),t}function QP(t){ew(t);const e={},r={};ez({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((i,l)=>r[l]-r[i]).map(i=>e[i]);return ew(n),n}function ez(t){const{modules:e,level:r,moduleMap:n,moduleDepth:i}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)n[l.name]=l,(i[l.name]===void 0||i[l.name]<r)&&(i[l.name]=r);for(const l of e)l.dependencies&&ez({modules:l.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function y7(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function v7(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=CI(t,b7),t;case"fragment":return t=CI(t,x7),t;default:throw new Error(e)}}const tz=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],b7=[...tz,[yE("attribute"),"in $1"],[yE("varying"),"out $1"]],x7=[...tz,[yE("varying"),"in $1"]];function CI(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function yE(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function rz(t,e){let r="";for(const n in t){const i=t[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),e[n]){const l=e[n];l.sort((c,s)=>c.order-s.order);for(const c of l)r+=`  ${c.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function nz(t){const e={vertex:{},fragment:{}};for(const r of t){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();const[l,c]=i.split(":"),s=i.replace(/\(.+/,""),m=Object.assign(n,{signature:c});switch(l){case"vs":e.vertex[s]=m;break;case"fs":e.fragment[s]=m;break;default:throw new Error(l)}}return e}function w7(t,e){return{name:T7(t,e),language:"glsl",version:S7(t)}}function T7(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function S7(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const iz=`

${P1}
`,A7=`precision highp float;
`;function E7(t){const e=QP(t.modules||[]);return{source:C7(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:sz(e)}}function P7(t){const{vs:e,fs:r}=t,n=QP(t.modules||[]);return{vs:MI(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:MI(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:sz(n)}}function C7(t,e){const{source:r,stage:n,modules:i,hookFunctions:l=[],inject:c={},log:s}=e;KP(typeof r=="string","shader source must be a string");const m=r;let b="";const w=nz(l),E={},O={},N={};for(const W in c){const j=typeof c[W]=="string"?{injection:c[W],order:0}:c[W],Y=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(Y){const ce=Y[2],re=Y[3];ce?re==="decl"?O[W]=[j]:N[W]=[j]:E[W]=[j]}else N[W]=[j]}const V=i;for(const W of V){s&&J4(W,m,s);const j=az(W,"wgsl");b+=j;const Y=W.injections?.[n]||{};for(const ce in Y){const re=/^(v|f)s:#([\w-]+)$/.exec(ce);if(re){const me=re[2]==="decl"?O:N;me[ce]=me[ce]||[],me[ce].push(Y[ce])}else E[ce]=E[ce]||[],E[ce].push(Y[ce])}}return b+=iz,b=J1(b,n,O),b+=rz(w[n],E),b+=m,b=J1(b,n,N),b}function MI(t,e){const{source:r,stage:n,language:i="glsl",modules:l,defines:c={},hookFunctions:s=[],inject:m={},prologue:b=!0,log:w}=e;KP(typeof r=="string","shader source must be a string");const E=i==="glsl"?w7(r).version:-1,O=t.shaderLanguageVersion,N=E===100?"#version 100":"#version 300 es",W=r.split(`
`).slice(1).join(`
`),j={};l.forEach(ge=>{Object.assign(j,ge.defines)}),Object.assign(j,c);let Y="";switch(i){case"wgsl":break;case"glsl":Y=b?`${N}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${y7(t)}
${n==="fragment"?A7:""}

// ----- APPLICATION DEFINES -------------------------

${M7(j)}

`:`${N}
`;break}const ce=nz(s),re={},ue={},me={};for(const ge in m){const Ce=typeof m[ge]=="string"?{injection:m[ge],order:0}:m[ge],We=/^(v|f)s:(#)?([\w-]+)$/.exec(ge);if(We){const Xe=We[2],Et=We[3];Xe?Et==="decl"?ue[ge]=[Ce]:me[ge]=[Ce]:re[ge]=[Ce]}else me[ge]=[Ce]}for(const ge of l){w&&J4(ge,W,w);const Ce=az(ge,n);Y+=Ce;const We=ge.instance?.normalizedInjections[n]||{};for(const Xe in We){const Et=/^(v|f)s:#([\w-]+)$/.exec(Xe);if(Et){const Ye=Et[2]==="decl"?ue:me;Ye[Xe]=Ye[Xe]||[],Ye[Xe].push(We[Xe])}else re[Xe]=re[Xe]||[],re[Xe].push(We[Xe])}}return Y+="// ----- MAIN SHADER SOURCE -------------------------",Y+=iz,Y=J1(Y,n,ue),Y+=rz(ce[n],re),Y+=W,Y=J1(Y,n,me),i==="glsl"&&E!==O&&(Y=v7(Y,n)),Y.trim()}function sz(t){return function(r){const n={};for(const i of t){const l=i.getUniforms?.(r,n);Object.assign(n,l)}return n}}function M7(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function az(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:KP(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}const I7=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,R7=/^\s*\#\s*endif\s*$/;function O7(t,e){const r=t.split(`
`),n=[];let i=!0,l=null;for(const c of r){const s=c.match(I7),m=c.match(R7);s?(l=s[1],i=!!e?.defines?.[l]):m?i=!0:i&&n.push(c)}return n.join(`
`)}class Zg{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Zg.defaultShaderAssembler=Zg.defaultShaderAssembler||new Zg,Zg.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:l}=E7({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?O7(i):i,getUniforms:l,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...P7({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let l=0,c=this._defaultModules.length;l<c;++l){const s=this._defaultModules[l],m=s.name;r[i++]=s,n[m]=!0}for(let l=0,c=e.length;l<c;++l){const s=e[l],m=s.name;n[m]||(r[i++]=s,n[m]=!0)}return r.length=i,ew(r),r}}const D7=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,k7=`#version 300 es
${D7}`;function L7(t){const{input:e,inputChannels:r,output:n}={};if(!e)return k7;if(!r)throw new Error("inputChannels");const i=N7(r),l=z7(e,r);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${l};
}`}function N7(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function z7(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class B7{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new gT({id:e})),this.stats.get(e)}}const oz=new B7,Bt=new gb({id:"luma.gl"}),G2={};function _T(t="id"){G2[t]=G2[t]||1;const e=G2[t]++;return`${t}-${e}`}let Vn=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,n){if(!e)throw new Error("no device");this._device=e,this.props=F7(r,n);const i=this.props.id!=="undefined"?this.props.id:_T(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function F7(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}let Ai=class C1 extends Vn{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const n={...r};(r.usage||0)&C1.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array?n.indexType="uint16":r.data instanceof Uint8Array&&(n.indexType="uint8")),delete n.data,super(e,n,C1.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,n){const i=ArrayBuffer.isView(e)?e.buffer:e,l=Math.min(e?e.byteLength:n,C1.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(l):r===0&&n===i.byteLength?this.debugData=i.slice(0,l):this.debugData=i.slice(r,r+l)}static defaultProps={...Vn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}};function lz(t){const[e,r,n]=tC[t],i=t.includes("norm"),l=!i&&!t.startsWith("float"),c=t.startsWith("s");return{signedType:e,primitiveType:r,byteLength:n,normalized:i,integer:l,signed:c}}function j7(t){const e=t;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function U7(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}function JP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;if(e===Uint8ClampedArray)return"uint8";const r=Object.values(tC).find(n=>e===n[4]);if(!r)throw new Error(e.name);return r[0]}function eC(t){const[,,,,e]=tC[t];return e}const tC={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function rC(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),i=r,l=n?parseInt(n):1,c=lz(i),s={type:i,components:l,byteLength:c.byteLength*l,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(s.webglOnly=!0),s}function V7(t,e,r){const n=r?j7(t):t;switch(n){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${n}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${n}x${e}`;default:return e===1?n:`${n}x${e}`}}function $7(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e,i=JP(t);return V7(i,n,r)}function W7(t){let e;switch(t.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return t.components<=2?"float16x2":"float16x4"}return t.components===1?e:`${e}x${t.components}`}const $a="texture-compression-bc",Un="texture-compression-astc",xh="texture-compression-etc2",H7="texture-compression-etc1-webgl",$x="texture-compression-pvrtc-webgl",Z2="texture-compression-atc-webgl",Wx="float32-renderable-webgl",Y2="float16-renderable-webgl",q7="rgb9e5ufloat-renderable-webgl",K2="snorm8-renderable-webgl",a0="norm16-renderable-webgl",Q2="snorm16-renderable-webgl",Hx="float32-filterable",II="float16-filterable-webgl";function cz(t){const e=Z7[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const X7={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:K2},rg8snorm:{render:K2},"rgb8snorm-webgl":{},rgba8snorm:{render:K2},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:a0},rg16unorm:{render:a0},"rgb16unorm-webgl":{f:a0},rgba16unorm:{render:a0},r16snorm:{f:Q2},rg16snorm:{render:Q2},"rgb16snorm-webgl":{f:a0},rgba16snorm:{render:Q2},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Y2,filter:"float16-filterable-webgl"},rg16float:{render:Y2,filter:II},rgba16float:{render:Y2,filter:II},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Wx,filter:Hx},rg32float:{render:!1,filter:Hx},"rgb32float-webgl":{render:Wx,filter:Hx},rgba32float:{render:Wx,filter:Hx},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:q7},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Wx},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},G7={"bc1-rgb-unorm-webgl":{f:$a},"bc1-rgb-unorm-srgb-webgl":{f:$a},"bc1-rgba-unorm":{f:$a},"bc1-rgba-unorm-srgb":{f:$a},"bc2-rgba-unorm":{f:$a},"bc2-rgba-unorm-srgb":{f:$a},"bc3-rgba-unorm":{f:$a},"bc3-rgba-unorm-srgb":{f:$a},"bc4-r-unorm":{f:$a},"bc4-r-snorm":{f:$a},"bc5-rg-unorm":{f:$a},"bc5-rg-snorm":{f:$a},"bc6h-rgb-ufloat":{f:$a},"bc6h-rgb-float":{f:$a},"bc7-rgba-unorm":{f:$a},"bc7-rgba-unorm-srgb":{f:$a},"etc2-rgb8unorm":{f:xh},"etc2-rgb8unorm-srgb":{f:xh},"etc2-rgb8a1unorm":{f:xh},"etc2-rgb8a1unorm-srgb":{f:xh},"etc2-rgba8unorm":{f:xh},"etc2-rgba8unorm-srgb":{f:xh},"eac-r11unorm":{f:xh},"eac-r11snorm":{f:xh},"eac-rg11unorm":{f:xh},"eac-rg11snorm":{f:xh},"astc-4x4-unorm":{f:Un},"astc-4x4-unorm-srgb":{f:Un},"astc-5x4-unorm":{f:Un},"astc-5x4-unorm-srgb":{f:Un},"astc-5x5-unorm":{f:Un},"astc-5x5-unorm-srgb":{f:Un},"astc-6x5-unorm":{f:Un},"astc-6x5-unorm-srgb":{f:Un},"astc-6x6-unorm":{f:Un},"astc-6x6-unorm-srgb":{f:Un},"astc-8x5-unorm":{f:Un},"astc-8x5-unorm-srgb":{f:Un},"astc-8x6-unorm":{f:Un},"astc-8x6-unorm-srgb":{f:Un},"astc-8x8-unorm":{f:Un},"astc-8x8-unorm-srgb":{f:Un},"astc-10x5-unorm":{f:Un},"astc-10x5-unorm-srgb":{f:Un},"astc-10x6-unorm":{f:Un},"astc-10x6-unorm-srgb":{f:Un},"astc-10x8-unorm":{f:Un},"astc-10x8-unorm-srgb":{f:Un},"astc-10x10-unorm":{f:Un},"astc-10x10-unorm-srgb":{f:Un},"astc-12x10-unorm":{f:Un},"astc-12x10-unorm-srgb":{f:Un},"astc-12x12-unorm":{f:Un},"astc-12x12-unorm-srgb":{f:Un},"pvrtc-rgb4unorm-webgl":{f:$x},"pvrtc-rgba4unorm-webgl":{f:$x},"pvrtc-rbg2unorm-webgl":{f:$x},"pvrtc-rgba2unorm-webgl":{f:$x},"etc1-rbg-unorm-webgl":{f:H7},"atc-rgb-unorm-webgl":{f:Z2},"atc-rgba-unorm-webgl":{f:Z2},"atc-rgbai-unorm-webgl":{f:Z2}},Z7={...X7,...G7},Y7=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],K7=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class Q7{getInfo(e){return RI(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return Y7.some(r=>e.startsWith(r))}getCapabilities(e){const r=cz(e),n={format:e,create:r.f??!0,render:r.render??!0,filter:r.filter??!0,blend:r.blend??!0,store:r.store??!0},i=RI(e),l=e.startsWith("depth")||e.startsWith("stencil"),c=i?.signed,s=i?.integer,m=i?.webgl;return n.render&&=!c,n.filter&&=!l&&!c&&!s&&!m,n}}const Ty=new Q7;function RI(t){let e=J7(t);if(Ty.isCompressed(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=eW(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=K7.exec(t);if(r){const[,n,i,l,c,s]=r,m=`${l}${i}`,b=lz(m),w=b.byteLength*8,E=n.length,O=[w,E>=2?w:0,E>=3?w:0,E>=4?w:0];e={format:t,attachment:e.attachment,dataType:b.signedType,components:E,channels:n,integer:b.integer,signed:b.signed,normalized:b.normalized,bitsPerChannel:O,bytesPerPixel:b.byteLength*n.length,packed:e.packed,srgb:e.srgb},s==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function J7(t){const e=cz(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function eW(t){const r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){const[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function tW(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}function rW(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}class nW{}class iW{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class hm{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,r)=>{},onResize:(e,r)=>{const[n,i]=e.getDevicePixelSize();Bt.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,r)=>{const[n,i]=e.getPosition();Bt.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>Bt.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,r)=>Bt.log(1,`${e} DPR changed ${r.oldRatio} => ${e.devicePixelRatio}`)(),debug:Bt.get("debug")||void 0,debugShaders:Bt.get("debug-shaders")||void 0,debugFramebuffers:!!Bt.get("debug-framebuffers"),debugFactories:!!Bt.get("debug-factories"),debugWebGL:!!Bt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=oz;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...hm.defaultProps,...e},this.id=this.props.id||_T(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return rC(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Ty.getInfo(e)}getTextureFormatCapabilities(e){let r=this._textureCaps[e];if(!r){const n=this._getDeviceTextureFormatCapabilities(e);r=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=r}return r}getMipLevelCount(e,r,n=1){const i=Math.max(e,r,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return tW(e)}getExternalImageSize(e){return rW(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Ty.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,r,...n){return this.props.onError(e,r)?()=>{}:Bt.error(e.message,r,...n)}debug(){if(this.props.debug)debugger;else Bt.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const r=Ty.getCapabilities(e),n=l=>(typeof l=="string"?this.features.has(l):l)??!0,i=n(r.create);return{format:e,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};if((e.usage||0)&Ai.INDEX&&(e.indexType||(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":e.data instanceof Uint8Array&&(r.data=new Uint16Array(e.data),r.indexType="uint16")),!r.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return r}}const sW="set luma.log.level=1 (or higher) to trace rendering",OI="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class tw{static defaultProps={...hm.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=oz;log=Bt;VERSION="9.2.6";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Bt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Bt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Bt.error("This version of luma.gl has already been initialized")()}Bt.log(1,`${this.VERSION} - ${sW}`)(),globalThis.luma=this}async createDevice(e={}){const r={...tw.defaultProps,...e},n=this.selectAdapter(r.type,r.adapters);if(!n)throw new Error(OI);return r.waitForPageLoad&&await n.pageLoaded,await n.create(r)}async attachDevice(e,r){const n=this._getTypeFromHandle(e,r.adapters),i=n&&this.selectAdapter(n,r.adapters);if(!i)throw new Error(OI);return await i?.attach?.(e,r)}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this._getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(e=[]){const r=["webgpu","webgl","null"],n=this._getAdapterMap(e);for(const i of r)if(n.get(i)?.isSupported?.())return i;return null}selectAdapter(e,r=[]){let n=e;e==="best-available"&&(n=this.getBestAvailableAdapterType(r));const i=this._getAdapterMap(r);return n&&i.get(n)||null}enforceWebGL2(e=!0,r=[]){const i=this._getAdapterMap(r).get("webgl");i||Bt.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(tw.defaultProps,e)}_getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}_getTypeFromHandle(e,r=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?Bt.warn("WebGL1 is not supported",e)():Bt.warn("Unknown handle type",e)(),null)}}const vE=new tw;class aW{get pageLoaded(){return cW()}}const oW=Sm()&&typeof document<"u",lW=()=>oW&&document.readyState==="complete";let qx=null;function cW(){return qx||(lW()||typeof window>"u"?qx=Promise.resolve():qx=new Promise(t=>window.addEventListener("load",()=>t()))),qx}function uW(){let t,e;return{promise:new Promise((n,i)=>{t=n,e=i}),resolve:t,reject:e}}class Yg{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=uW();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Yg.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Sm()?e.canvas?typeof e.canvas=="string"?this.canvas=fW(e.canvas):this.canvas=e.canvas:this.canvas=dW(e):this.canvas={width:e.width||1,height:e.height||1},Yg.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Yg.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Yg.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(r=>this._handleIntersection(r)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(r=>this._handleResize(r));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,r){this.canvas.width=e,this.canvas.height=r,this.drawingBufferWidth=e,this.drawingBufferHeight=r}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[i,l]=this.getDrawingBufferSize();return pW(e,n,i,l,r)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,r]=this.getDevicePixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[r]=this.getCSSSize();return r?e/r:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const r=e.find(i=>i.target===this.canvas);if(!r)return;const n=r.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){const r=e.find(m=>m.target===this.canvas);if(!r)return;this.cssWidth=r.contentBoxSize[0].inlineSize,this.cssHeight=r.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),i=r.devicePixelContentBoxSize?.[0].inlineSize||r.contentBoxSize[0].inlineSize*devicePixelRatio,l=r.devicePixelContentBoxSize?.[0].blockSize||r.contentBoxSize[0].blockSize*devicePixelRatio,[c,s]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,c)),this.devicePixelHeight=Math.max(1,Math.min(l,s)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const r=setInterval(()=>{this.destroyed?clearInterval(r):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const r=[e.left,e.top];if(this._position??=r,r[0]!==this._position[0]||r[1]!==this._position[1]){const i=this._position;this._position=r,this.device.props.onPositionChange?.(this,{oldPosition:i})}}}}function hW(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}return t||document.body}function fW(t){const e=document.getElementById(t);if(!Yg.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function dW(t){const{width:e,height:r}=t,n=document.createElement("canvas");n.id=_T("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",t?.visible||(n.style.visibility="hidden");const i=hW(t?.container||null);return i.insertBefore(n,i.firstChild),n}function pW(t,e,r,n,i){const l=t,c=DI(l[0],e,r);let s=kI(l[1],e,n,i),m=DI(l[0]+1,e,r);const b=m===r-1?m:m-1;m=kI(l[1]+1,e,n,i);let w;return i?(m=m===0?m:m+1,w=s,s=m):w=m===n-1?m:m-1,{x:c,y:s,width:Math.max(b-c+1,1),height:Math.max(w-s+1,1)}}function DI(t,e,r){return Math.min(Math.round(t*e),r-1)}function kI(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class fm extends Vn{static defaultProps={...Vn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=fm.normalizeProps(e,r),super(e,r,fm.defaultProps)}static normalizeProps(e,r){return r}}const gW={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class ys extends Vn{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,r){if(r=ys.normalizeProps(e,r),super(e,r,ys.defaultProps),this.dimension=this.props.dimension,this.baseDimension=gW[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(r.data)){const n=e.getExternalImageSize(r.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Bt.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof fm?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,r){const n={...r},{width:i,height:l}=n;return typeof i=="number"&&(n.width=Math.max(1,Math.ceil(i))),typeof l=="number"&&(n.height=Math.max(1,Math.ceil(l))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:r,height:n,depth:i}=this,l={...ys.defaultCopyDataOptions,width:r,height:n,depth:i,...e},c=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!c.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return l.bytesPerRow=e.bytesPerRow||r*(c.bytesPerPixel||4),l.rowsPerImage=e.rowsPerImage||n,l}_normalizeCopyExternalImageOptions(e){const r=this.device.getExternalImageSize(e.image),n={...ys.defaultCopyExternalImageOptions,...r,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Vn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:ys.TEXTURE|ys.RENDER_ATTACHMENT|ys.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class yT extends Vn{get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,yT.defaultProps)}static defaultProps={...Vn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function mW(t,e,r){let n="";const i=e.split(/\r?\n/),l=t.slice().sort((c,s)=>c.lineNum-s.lineNum);switch(r?.showSourceCode||"no"){case"all":let c=0;for(let s=1;s<=i.length;s++)for(n+=uz(i[s-1],s,r);l.length>c&&l[c].lineNum===s;){const m=l[c++];n+=J2(m,i,m.lineNum,{...r,inlineSource:!1})}for(;l.length>c;){const s=l[c++];n+=J2(s,[],0,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const s of t)n+=J2(s,i,s.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function J2(t,e,r,n){if(n?.inlineSource){const l=_W(e,r),c=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${l}${c}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function _W(t,e,r){let n="";for(let i=e-2;i<=e;i++){const l=t[i-1];l!==void 0&&(n+=uz(l,e,r))}return n}function uz(t,e,r){const n=r?.html?vW(t):t;return`${yW(String(e),4)}: ${n}${r?.html?"<br/>":`
`}`}function yW(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function vW(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class vT extends Vn{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:bW(r),...r},vT.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r,this.id)}_displayShaderLog(e,r){if(typeof document>"u"||!document?.createElement)return;const n=r,i=`${this.stage} shader "${n}"`;let l=mW(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(l+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const s=document.createElement("Button");s.innerHTML=`
<h1>Compilation error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${l}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),s.onclick=()=>{const b=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(b)}}static defaultProps={...Vn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function bW(t){return xW(t.source)||t.id||_T(`unnamed ${t.stage}-shader`)}function xW(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}class bT extends Vn{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,bT.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const r=this.colorAttachments.map(i=>i.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(e){let r=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Bt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){const i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof ys?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof ys?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:ys.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ys.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Vn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class nm extends Vn{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,nm.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Vn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Gg extends Vn{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=Gg.normalizeProps(e,r),super(e,r,Gg.defaultProps)}static normalizeProps(e,r){return r}static defaultProps={...Vn.defaultProps,framebuffer:null,parameters:void 0,clearColor:Gg.defaultClearColor,clearColors:void 0,clearDepth:Gg.defaultClearDepth,clearStencil:Gg.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class rw extends Vn{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,rw.defaultProps),this.shaderLayout=r.shaderLayout}static defaultProps={...Vn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class nC extends Vn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,nC.defaultProps)}static defaultProps={...Vn.defaultProps,measureExecutionTime:void 0}}class iC extends Vn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,iC.defaultProps)}static defaultProps={...Vn.defaultProps}}function hz(t){return AW[t]}function wW(t){const[e,r]=SW[t],n=e==="i32"||e==="u32",i=e!=="u32",l=TW[e]*r;return{primitiveType:e,components:r,byteLength:l,integer:n,signed:i}}const TW={f32:4,f16:2,i32:4,u32:4},SW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},AW={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function fz(t,e){const r={};for(const n of t.attributes){const i=PW(t,e,n.name);i&&(r[n.name]=i)}return r}function EW(t,e,r=16){const n=fz(t,e),i=new Array(r).fill(null);for(const l of Object.values(n))i[l.location]=l;return i}function PW(t,e,r){const n=CW(t,r),i=MW(e,r);if(!n)return null;const l=wW(n.type),c=W7(l),s=i?.vertexFormat||c,m=rC(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:l.primitiveType,shaderComponents:l.components,vertexFormat:s,bufferDataType:m.type,bufferComponents:m.components,normalized:m.normalized,integer:l.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function CW(t,e){const r=t.attributes.find(n=>n.name===e);return r||Bt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function MW(t,e){IW(t);let r=RW(t,e);return r||(r=OW(t,e),r)?r:(Bt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function IW(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Bt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function RW(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function OW(t,e){for(const r of t){let n=r.byteStride;if(typeof r.byteStride!="number")for(const l of r.attributes||[]){const c=rC(l.format);n+=c.byteLength}const i=r.attributes?.find(l=>l.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}class sC extends Vn{static defaultProps={...Vn.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,sC.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=EW(r.shaderLayout,r.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"),this)()}}class aC extends Vn{static defaultProps={...Vn.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,aC.defaultProps)}}class oC extends Vn{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,oC.defaultProps)}static defaultProps={...Vn.defaultProps,type:void 0,count:void 0}}let Xx;function dz(t){return(!Xx||Xx.byteLength<t)&&(Xx=new ArrayBuffer(t)),Xx}function DW(t,e){const r=dz(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function kW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nw(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":kW(t)}const LW=1024;class NW{layout={};byteLength;constructor(e,r={}){let n=0;for(const[l,c]of Object.entries(e)){const s=hz(c),{type:m,components:b}=s,w=b*(r?.[l]??1);n=U7(n,w);const E=n;n+=w,this.layout[l]={type:m,size:w,offset:E}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,LW)}getData(e){const r=dz(this.byteLength),n={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[i,l]of Object.entries(e)){const c=this.layout[i];if(!c){Bt.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:s,size:m,offset:b}=c,w=n[s];if(m===1){if(typeof l!="number"&&typeof l!="boolean"){Bt.warn(`Supplied value for single component uniform ${i} is not a number: ${l}`)();continue}w[b]=Number(l)}else{if(!nw(l)){Bt.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${l}`)();continue}w.set(l,b)}}return new Uint8Array(r,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function zW(t,e,r=16){if(t!==e)return!1;const n=t,i=e;if(!nw(n))return!1;if(nw(i)&&n.length===i.length){for(let l=0;l<n.length;++l)if(i[l]!==n[l])return!1}return!0}function BW(t){return nw(t)?t.slice():t}class FW{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!r)throw new Error(e?.name);const n=r;for(const i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){zW(this.uniforms[e],r)||(this.uniforms[e]=BW(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class jW{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,n]of Object.entries(e)){const i=r,l=new NW(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(i,l);const c=new FW({name:r});c.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,n]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(r),l=e.createBuffer({usage:Ai.UNIFORM|Ai.COPY_DST,byteLength:i}),c=this.getUniformBufferData(r);return l.write(c),l}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),i=e.createBuffer({usage:Ai.UNIFORM|Ai.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||=n}return e&&Bt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;const l=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(l);const c=this.uniformBlocks.get(e)?.getAllUniforms();Bt.log(4,`Writing to uniform buffer ${String(e)}`,l,c)()}return i}}class _c{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class LI{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class yp extends _c{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}let wp=class extends _c{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},bE=class extends _c{constructor(e,r,n){super(e,n),this.format=r}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},dm=class extends _c{constructor(e,r,n,i){super(e,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};var dp;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(dp||(dp={}));class Gx{constructor(e,r,n,i,l,c,s){this.name=e,this.type=r,this.group=n,this.binding=i,this.attributes=l,this.resourceType=c,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let UW=class{constructor(e,r){this.name=e,this.type=r}};class VW{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}}class NI{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i}}class $W{constructor(e,r,n,i){this.name=e,this.type=r,this.attributes=n,this.id=i}}class WW{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n}}class HW{constructor(e,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=n}}class qW{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function XW(t){var e=(32768&t)>>15,r=(31744&t)>>10,n=1023&t;return r==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}const pz=new Float32Array(1),GW=new Int32Array(pz.buffer),Wa=new Uint16Array(1);function ZW(t){pz[0]=t;const e=GW[0],r=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return Wa[0]=r<<15|31744|(i!==0?512:0),Wa[0];if(n===0){if(i===0)return Wa[0]=r<<15,Wa[0];i|=8388608;let l=113;for(;!(8388608&i);)i<<=1,l--;return n=127-l,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),Wa[0]=r<<15|n<<10|i>>13,Wa[0]):(Wa[0]=r<<15,Wa[0])}return n=n-127+15,n>=31?(Wa[0]=r<<15|31744,Wa[0]):n<=0?n<-10?(Wa[0]=r<<15,Wa[0]):(i=(8388608|i)>>1-n,Wa[0]=r<<15|i>>13,Wa[0]):(i>>=13,Wa[0]=r<<15|n<<10|i,Wa[0])}const lC=new Uint32Array(1),gz=new Float32Array(lC.buffer,0,1);function zI(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return lC[0]=e,gz[0]}function YW(t,e,r,n,i,l,c,s,m){const b=n*(c>>=i)*(l>>=i)+r*c+e*s;switch(m){case"r8unorm":return[xn(t,b,"8unorm",1)[0]];case"r8snorm":return[xn(t,b,"8snorm",1)[0]];case"r8uint":return[xn(t,b,"8uint",1)[0]];case"r8sint":return[xn(t,b,"8sint",1)[0]];case"rg8unorm":{const w=xn(t,b,"8unorm",2);return[w[0],w[1]]}case"rg8snorm":{const w=xn(t,b,"8snorm",2);return[w[0],w[1]]}case"rg8uint":{const w=xn(t,b,"8uint",2);return[w[0],w[1]]}case"rg8sint":{const w=xn(t,b,"8sint",2);return[w[0],w[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const w=xn(t,b,"8unorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8snorm":{const w=xn(t,b,"8snorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8uint":{const w=xn(t,b,"8uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba8sint":{const w=xn(t,b,"8sint",4);return[w[0],w[1],w[2],w[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const w=xn(t,b,"8unorm",4);return[w[2],w[1],w[0],w[3]]}case"r16uint":return[xn(t,b,"16uint",1)[0]];case"r16sint":return[xn(t,b,"16sint",1)[0]];case"r16float":return[xn(t,b,"16float",1)[0]];case"rg16uint":{const w=xn(t,b,"16uint",2);return[w[0],w[1]]}case"rg16sint":{const w=xn(t,b,"16sint",2);return[w[0],w[1]]}case"rg16float":{const w=xn(t,b,"16float",2);return[w[0],w[1]]}case"rgba16uint":{const w=xn(t,b,"16uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16sint":{const w=xn(t,b,"16sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16float":{const w=xn(t,b,"16float",4);return[w[0],w[1],w[2],w[3]]}case"r32uint":return[xn(t,b,"32uint",1)[0]];case"r32sint":return[xn(t,b,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[xn(t,b,"32float",1)[0]];case"rg32uint":{const w=xn(t,b,"32uint",2);return[w[0],w[1]]}case"rg32sint":{const w=xn(t,b,"32sint",2);return[w[0],w[1]]}case"rg32float":{const w=xn(t,b,"32float",2);return[w[0],w[1]]}case"rgba32uint":{const w=xn(t,b,"32uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32sint":{const w=xn(t,b,"32sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32float":{const w=xn(t,b,"32float",4);return[w[0],w[1],w[2],w[3]]}case"rg11b10ufloat":{const w=new Uint32Array(t.buffer,b,1)[0],E=(4192256&w)>>11,O=(4290772992&w)>>22;return[zI(2047&w),zI(E),(function(N){const V=112+(N>>5&31)<<23|(31&N)<<18;return lC[0]=V,gz[0]})(O),1]}}return null}function xn(t,e,r,n){const i=[0,0,0,0];for(let l=0;l<n;++l)switch(r){case"8unorm":i[l]=t[e]/255,e++;break;case"8snorm":i[l]=t[e]/255*2-1,e++;break;case"8uint":i[l]=t[e],e++;break;case"8sint":i[l]=t[e]-127,e++;break;case"16uint":i[l]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[l]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[l]=XW(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[l]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[l]=new Float32Array(t.buffer,e,1)[0],e+=4}return i}function An(t,e,r,n,i){for(let l=0;l<n;++l)switch(r){case"8unorm":t[e]=255*i[l],e++;break;case"8snorm":t[e]=.5*(i[l]+1)*255,e++;break;case"8uint":t[e]=i[l],e++;break;case"8sint":t[e]=i[l]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[l],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[l],e+=2;break;case"16float":{const c=ZW(i[l]);new Uint16Array(t.buffer,e,1)[0]=c,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[l],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[l],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[l],e+=4}return i}const eS={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ac{constructor(){this.id=Ac._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(iw.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(sw.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ac._id=0;class iw extends Ac{}iw.instance=new iw;class sw extends Ac{}sw.instance=new sw;const mz=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class yi extends Ac{constructor(){super()}}class U0 extends yi{constructor(e,r,n,i,l,c){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=i,this.startLine=l,this.endLine=c}get astNodeType(){return"function"}search(e){if(this.attributes)for(const r of this.attributes)e(r);e(this);for(const r of this.args)e(r);this.searchBlock(this.body,e)}}class KW extends yi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class _z extends yi{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}let xE=class extends yi{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}};class yz extends yi{constructor(e,r,n,i){super(),this.init=e,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var r,n,i;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Gf extends yi{constructor(e,r,n,i,l){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class cC extends yi{constructor(e,r,n){super(),this.attributes=null,this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class R0 extends yi{constructor(e,r,n,i,l){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}let M1=class extends yi{constructor(e,r,n,i,l){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}};var dy,b0,ut,Ze;(t=>{t.increment="++",t.decrement="--"})(dy||(dy={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(dy||(dy={}));class vz extends yi{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(b0||(b0={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(b0||(b0={}));class bz extends yi{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class uC extends yi{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return mz.has(this.name)}search(e){for(const r of this.args)r.search(e);e(this)}}class xz extends yi{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}search(e){var r;this.searchBlock(this.body,e),(r=this.continuing)===null||r===void 0||r.search(e)}}class wz extends yi{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}search(e){e(this);for(const r of this.cases)r.search(e)}}class Tz extends yi{constructor(e,r,n,i){super(),this.condition=e,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Sz extends yi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class QW extends yi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class JW extends yi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Az extends yi{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class hC extends yi{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class e9 extends yi{constructor(){super()}get astNodeType(){return"discard"}}class Ez extends yi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let Pz=class extends yi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}};class Lt extends yi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Lt._priority.get(r.name);Lt._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?Lt.i32:r}getTypeName(){return this.name}}Lt.x32=new Lt("x32"),Lt.f32=new Lt("f32"),Lt.i32=new Lt("i32"),Lt.u32=new Lt("u32"),Lt.f16=new Lt("f16"),Lt.bool=new Lt("bool"),Lt.void=new Lt("void"),Lt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class BI extends Lt{constructor(e){super(e)}}class Hf extends Lt{constructor(e,r,n,i){super(e),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(const r of this.members)e(r)}}class rt extends Lt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}rt.vec2f=new rt("vec2",Lt.f32,null),rt.vec3f=new rt("vec3",Lt.f32,null),rt.vec4f=new rt("vec4",Lt.f32,null),rt.vec2i=new rt("vec2",Lt.i32,null),rt.vec3i=new rt("vec3",Lt.i32,null),rt.vec4i=new rt("vec4",Lt.i32,null),rt.vec2u=new rt("vec2",Lt.u32,null),rt.vec3u=new rt("vec3",Lt.u32,null),rt.vec4u=new rt("vec4",Lt.u32,null),rt.vec2h=new rt("vec2",Lt.f16,null),rt.vec3h=new rt("vec3",Lt.f16,null),rt.vec4h=new rt("vec4",Lt.f16,null),rt.vec2b=new rt("vec2",Lt.bool,null),rt.vec3b=new rt("vec3",Lt.bool,null),rt.vec4b=new rt("vec4",Lt.bool,null),rt.mat2x2f=new rt("mat2x2",Lt.f32,null),rt.mat2x3f=new rt("mat2x3",Lt.f32,null),rt.mat2x4f=new rt("mat2x4",Lt.f32,null),rt.mat3x2f=new rt("mat3x2",Lt.f32,null),rt.mat3x3f=new rt("mat3x3",Lt.f32,null),rt.mat3x4f=new rt("mat3x4",Lt.f32,null),rt.mat4x2f=new rt("mat4x2",Lt.f32,null),rt.mat4x3f=new rt("mat4x3",Lt.f32,null),rt.mat4x4f=new rt("mat4x4",Lt.f32,null),rt.mat2x2h=new rt("mat2x2",Lt.f16,null),rt.mat2x3h=new rt("mat2x3",Lt.f16,null),rt.mat2x4h=new rt("mat2x4",Lt.f16,null),rt.mat3x2h=new rt("mat3x2",Lt.f16,null),rt.mat3x3h=new rt("mat3x3",Lt.f16,null),rt.mat3x4h=new rt("mat3x4",Lt.f16,null),rt.mat4x2h=new rt("mat4x2",Lt.f16,null),rt.mat4x3h=new rt("mat4x3",Lt.f16,null),rt.mat4x4h=new rt("mat4x4",Lt.f16,null),rt.mat2x2i=new rt("mat2x2",Lt.i32,null),rt.mat2x3i=new rt("mat2x3",Lt.i32,null),rt.mat2x4i=new rt("mat2x4",Lt.i32,null),rt.mat3x2i=new rt("mat3x2",Lt.i32,null),rt.mat3x3i=new rt("mat3x3",Lt.i32,null),rt.mat3x4i=new rt("mat3x4",Lt.i32,null),rt.mat4x2i=new rt("mat4x2",Lt.i32,null),rt.mat4x3i=new rt("mat4x3",Lt.i32,null),rt.mat4x4i=new rt("mat4x4",Lt.i32,null),rt.mat2x2u=new rt("mat2x2",Lt.u32,null),rt.mat2x3u=new rt("mat2x3",Lt.u32,null),rt.mat2x4u=new rt("mat2x4",Lt.u32,null),rt.mat3x2u=new rt("mat3x2",Lt.u32,null),rt.mat3x3u=new rt("mat3x3",Lt.u32,null),rt.mat3x4u=new rt("mat3x4",Lt.u32,null),rt.mat4x2u=new rt("mat4x2",Lt.u32,null),rt.mat4x3u=new rt("mat4x3",Lt.u32,null),rt.mat4x4u=new rt("mat4x4",Lt.u32,null);class I1 extends Lt{constructor(e,r,n,i){super(e),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class O0 extends Lt{constructor(e,r,n,i){super(e),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class x0 extends Lt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class Mu extends Ac{constructor(){super(),this.postfix=null}}class pm extends Mu{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Eh extends Mu{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}}class fC extends Mu{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return mz.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(const r of this.args)r.search(e);e(this)}}class Sl extends Mu{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}}class Cz extends Mu{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class gs extends Mu{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof Ge}get isVector(){return this.value instanceof Ie||this.value instanceof Mr}get scalarValue(){return this.value instanceof Ge?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ie||this.value instanceof Mr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Mz extends Mu{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class My extends Mu{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Iz extends Mu{constructor(){super()}}class ts extends Iz{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class vu extends Iz{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Lt.f32:e.name==="u32"||r.name==="u32"?Lt.u32:Lt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Rz extends Ac{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class R1 extends Mu{constructor(){super()}get astNodeType(){return"default"}}class Oz extends Rz{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Dz extends Rz{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class FI extends Ac{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class t9 extends Ac{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class jI extends Ac{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class kz extends Ac{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}class bc{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=bc._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}bc._id=0;class wE extends bc{constructor(){super(new _c("void",null),null)}toString(){return"void"}}wE.void=new wE;class iy extends bc{constructor(e){super(new bE("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,r,n,i){this.reference.setDataValue(e,r,n,i)}getSubData(e,r,n){return r?this.reference.getSubData(e,r,n):this}toString(){return`&${this.reference.toString()}`}}class Ge extends bc{constructor(e,r,n=null){super(r,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new Ge(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ge(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ge(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof Ge))return void console.error("SetDataValue: Invalid value",r);let l=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?l=Math.floor(l):this.typeInfo.name==="bool"&&(l=l?1:0),this.data[0]=l}getSubData(e,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}}function r9(t,e,r){const n=e.length;return n===2?r==="f32"?new Ie(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new Ie(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new Ie(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new Ie(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new Ie(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new Ie(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new Ie(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new Ie(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new Ie(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new Ie(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new Ie(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new Ie(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Ie extends bc{constructor(e,r,n=null){if(super(r,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new Ie(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ie(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ie(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,n,i){n instanceof pm?console.error("TODO: Set vector postfix"):r instanceof Ie?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof dm)i=this.typeInfo.format||i;else{const c=this.typeInfo.name;c==="vec2f"||c==="vec3f"||c==="vec4f"?i=e.getTypeInfo("f32"):c==="vec2i"||c==="vec3i"||c==="vec4i"?i=e.getTypeInfo("i32"):c==="vec2b"||c==="vec3b"||c==="vec4b"?i=e.getTypeInfo("bool"):c==="vec2u"||c==="vec3u"||c==="vec4u"?i=e.getTypeInfo("u32"):c==="vec2h"||c==="vec3h"||c==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${c}`)}let l=this;for(;r!==null&&l!==null;){if(r instanceof My){const c=r.index;let s=-1;if(c instanceof gs){if(!(c.value instanceof Ge))return console.error(`GetSubData: Invalid array index ${c.value}`),null;s=c.value.value}else{const m=e.evalExpression(c,n);if(!(m instanceof Ge))return console.error("GetSubData: Unknown index type",c),null;s=m.value}if(s<0||s>=l.data.length)return console.error("GetSubData: Index out of range",s),null;if(l.data instanceof Float32Array){const m=new Float32Array(l.data.buffer,l.data.byteOffset+4*s,1);return new Ge(m,i)}if(l.data instanceof Int32Array){const m=new Int32Array(l.data.buffer,l.data.byteOffset+4*s,1);return new Ge(m,i)}if(l.data instanceof Uint32Array){const m=new Uint32Array(l.data.buffer,l.data.byteOffset+4*s,1);return new Ge(m,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof pm))return console.error("GetSubData: Unknown postfix",r),null;{const c=r.value.toLowerCase();if(c.length===1){let m=0;if(c==="x"||c==="r")m=0;else if(c==="y"||c==="g")m=1;else if(c==="z"||c==="b")m=2;else{if(c!=="w"&&c!=="a")return console.error(`GetSubData: Unknown member ${c}`),null;m=3}if(this.data instanceof Float32Array){let b=new Float32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new Ge(b,i,this)}if(this.data instanceof Int32Array){let b=new Int32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new Ge(b,i,this)}if(this.data instanceof Uint32Array){let b=new Uint32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new Ge(b,i,this)}}const s=[];for(const m of c)m==="x"||m==="r"?s.push(this.data[0]):m==="y"||m==="g"?s.push(this.data[1]):m==="z"||m==="b"?s.push(this.data[2]):m==="w"||m==="a"?s.push(this.data[3]):console.error(`GetDataValue: Unknown member ${m}`);l=r9(e,s,i.name)}r=r.postfix}return l}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Mr extends bc{constructor(e,r,n=null){super(r,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Mr(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,n,i){n instanceof pm?console.error("TODO: Set matrix postfix"):r instanceof Mr?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof dm)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(r instanceof My){const l=r.index;let c=-1;if(l instanceof gs){if(!(l.value instanceof Ge))return console.error(`GetDataValue: Invalid array index ${l.value}`),null;c=l.value.value}else{const b=e.evalExpression(l,n);if(!(b instanceof Ge))return console.error("GetDataValue: Unknown index type",l),null;c=b.value}if(c<0||c>=this.data.length)return console.error("GetDataValue: Index out of range",c),null;const s=i.endsWith("h")?"h":"f";let m;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")m=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+2*c*4,2),e.getTypeInfo(`vec2${s}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")m=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+3*c*4,3),e.getTypeInfo(`vec3${s}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;m=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+4*c*4,4),e.getTypeInfo(`vec4${s}`))}return r.postfix?m.getSubData(e,r.postfix,n):m}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Fi extends bc{constructor(e,r,n=0,i=null){super(r,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Fi(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let l=this.offset,c=this.typeInfo;for(;n;){if(n instanceof My)if(c instanceof wp){const s=n.index;if(s instanceof gs){if(!(s.value instanceof Ge))return void console.error(`SetDataValue: Invalid index type ${s.value}`);l+=s.value.value*c.stride}else{const m=e.evalExpression(s,i);if(!(m instanceof Ge))return void console.error("SetDataValue: Unknown index type",s);l+=m.value*c.stride}c=c.format}else console.error(`SetDataValue: Type ${c.getTypeName()} is not an array`);else{if(!(n instanceof pm))return void console.error("SetDataValue: Unknown postfix type",n);{const s=n.value;if(c instanceof yp){let m=!1;for(const b of c.members)if(b.name===s){l+=b.offset,c=b.type,m=!0;break}if(!m)return void console.error(`SetDataValue: Member ${s} not found`)}else if(c instanceof _c){const m=c.getTypeName();let b=0;if(s==="x"||s==="r")b=0;else if(s==="y"||s==="g")b=1;else if(s==="z"||s==="b")b=2;else{if(s!=="w"&&s!=="a")return void console.error(`SetDataValue: Unknown member ${s}`);b=3}if(!(r instanceof Ge))return void console.error("SetDataValue: Invalid value",r);const w=r.value;return m==="vec2f"?void(new Float32Array(this.buffer,l,2)[b]=w):m==="vec3f"?void(new Float32Array(this.buffer,l,3)[b]=w):m==="vec4f"?void(new Float32Array(this.buffer,l,4)[b]=w):m==="vec2i"?void(new Int32Array(this.buffer,l,2)[b]=w):m==="vec3i"?void(new Int32Array(this.buffer,l,3)[b]=w):m==="vec4i"?void(new Int32Array(this.buffer,l,4)[b]=w):m==="vec2u"?void(new Uint32Array(this.buffer,l,2)[b]=w):m==="vec3u"?void(new Uint32Array(this.buffer,l,3)[b]=w):m==="vec4u"?void(new Uint32Array(this.buffer,l,4)[b]=w):void console.error(`SetDataValue: Type ${m} is not a struct`)}}}n=n.postfix}this.setData(e,r,c,l,i)}setData(e,r,n,i,l){const c=n.getTypeName();if(c!=="f32"&&c!=="f16")if(c!=="i32"&&c!=="atomic<i32>"&&c!=="x32")if(c!=="u32"&&c!=="atomic<u32>")if(c!=="bool"){if(c==="vec2f"||c==="vec2h"){const s=new Float32Array(this.buffer,i,2);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3f"||c==="vec3h"){const s=new Float32Array(this.buffer,i,3);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4f"||c==="vec4h"){const s=new Float32Array(this.buffer,i,4);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2i"){const s=new Int32Array(this.buffer,i,2);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3i"){const s=new Int32Array(this.buffer,i,3);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4i"){const s=new Int32Array(this.buffer,i,4);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2u"){const s=new Uint32Array(this.buffer,i,2);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3u"){const s=new Uint32Array(this.buffer,i,3);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4u"){const s=new Uint32Array(this.buffer,i,4);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2b"){const s=new Uint32Array(this.buffer,i,2);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3b"){const s=new Uint32Array(this.buffer,i,3);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4b"){const s=new Uint32Array(this.buffer,i,4);return void(r instanceof Ie?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="mat2x2f"||c==="mat2x2h"){const s=new Float32Array(this.buffer,i,4);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="mat2x3f"||c==="mat2x3h"){const s=new Float32Array(this.buffer,i,6);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5]))}if(c==="mat2x4f"||c==="mat2x4h"){const s=new Float32Array(this.buffer,i,8);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7]))}if(c==="mat3x2f"||c==="mat3x2h"){const s=new Float32Array(this.buffer,i,6);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5]))}if(c==="mat3x3f"||c==="mat3x3h"){const s=new Float32Array(this.buffer,i,9);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8]))}if(c==="mat3x4f"||c==="mat3x4h"){const s=new Float32Array(this.buffer,i,12);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11]))}if(c==="mat4x2f"||c==="mat4x2h"){const s=new Float32Array(this.buffer,i,8);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7]))}if(c==="mat4x3f"||c==="mat4x3h"){const s=new Float32Array(this.buffer,i,12);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11]))}if(c==="mat4x4f"||c==="mat4x4h"){const s=new Float32Array(this.buffer,i,16);return void(r instanceof Mr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11],s[12]=r.data[12],s[13]=r.data[13],s[14]=r.data[14],s[15]=r.data[15]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]))}if(r instanceof Fi){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",c,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${c}`)}else r instanceof Ge&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(e,r,n){var i,l,c;if(r===null)return this;let s=this.offset,m=this.typeInfo;for(;r;){if(r instanceof My){const w=r.index,E=w instanceof Mu?e.evalExpression(w,n):w;let O=0;if(E instanceof Ge?O=E.value:typeof E=="number"?O=E:console.error("GetDataValue: Invalid index type",w),m instanceof wp)s+=O*m.stride,m=m.format;else{const N=m.getTypeName();N==="mat4x4"||N==="mat4x4f"||N==="mat4x4h"?(s+=16*O,m=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${m.getTypeName()} is not an array`)}}else{if(!(r instanceof pm))return console.error("GetDataValue: Unknown postfix type",r),null;{const w=r.value;if(m instanceof yp){let E=!1;for(const O of m.members)if(O.name===w){s+=O.offset,m=O.type,E=!0;break}if(!E)return console.error(`GetDataValue: Member ${w} not found`),null}else if(m instanceof _c){const E=m.getTypeName();if(E==="vec2f"||E==="vec3f"||E==="vec4f"||E==="vec2i"||E==="vec3i"||E==="vec4i"||E==="vec2u"||E==="vec3u"||E==="vec4u"||E==="vec2b"||E==="vec3b"||E==="vec4b"||E==="vec2h"||E==="vec3h"||E==="vec4h"||E==="vec2"||E==="vec3"||E==="vec4"){if(w.length>0&&w.length<5){let O="f";const N=[];for(let V=0;V<w.length;++V){const W=w[V].toLowerCase();let j=0;if(W==="x"||W==="r")j=0;else if(W==="y"||W==="g")j=1;else if(W==="z"||W==="b")j=2;else{if(W!=="w"&&W!=="a")return console.error(`Unknown member ${w}`),null;j=3}if(w.length===1){if(E.endsWith("f"))return this.buffer.byteLength<s+4*j+4?(console.log("Insufficient buffer data"),null):new Ge(new Float32Array(this.buffer,s+4*j,1),e.getTypeInfo("f32"),this);if(E.endsWith("h"))return new Ge(new Float32Array(this.buffer,s+4*j,1),e.getTypeInfo("f16"),this);if(E.endsWith("i"))return new Ge(new Int32Array(this.buffer,s+4*j,1),e.getTypeInfo("i32"),this);if(E.endsWith("b"))return new Ge(new Int32Array(this.buffer,s+4*j,1),e.getTypeInfo("bool"),this);if(E.endsWith("u"))return new Ge(new Uint32Array(this.buffer,s+4*j,1),e.getTypeInfo("i32"),this)}if(E==="vec2f")N.push(new Float32Array(this.buffer,s,2)[j]);else if(E==="vec3f"){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Y=new Float32Array(this.buffer,s,3);N.push(Y[j])}else if(E==="vec4f")N.push(new Float32Array(this.buffer,s,4)[j]);else if(E==="vec2i")O="i",N.push(new Int32Array(this.buffer,s,2)[j]);else if(E==="vec3i")O="i",N.push(new Int32Array(this.buffer,s,3)[j]);else if(E==="vec4i")O="i",N.push(new Int32Array(this.buffer,s,4)[j]);else if(E==="vec2u"){O="u";const Y=new Uint32Array(this.buffer,s,2);N.push(Y[j])}else E==="vec3u"?(O="u",N.push(new Uint32Array(this.buffer,s,3)[j])):E==="vec4u"&&(O="u",N.push(new Uint32Array(this.buffer,s,4)[j]))}return N.length===2?m=e.getTypeInfo(`vec2${O}`):N.length===3?m=e.getTypeInfo(`vec3${O}`):N.length===4?m=e.getTypeInfo(`vec4${O}`):console.error(`GetDataValue: Invalid vector length ${N.length}`),new Ie(N,m,null)}return console.error(`GetDataValue: Unknown member ${w}`),null}return console.error(`GetDataValue: Type ${E} is not a struct`),null}}}r=r.postfix}const b=m.getTypeName();return b==="f32"?new Ge(new Float32Array(this.buffer,s,1),m,this):b==="i32"?new Ge(new Int32Array(this.buffer,s,1),m,this):b==="u32"?new Ge(new Uint32Array(this.buffer,s,1),m,this):b==="vec2f"?new Ie(new Float32Array(this.buffer,s,2),m,this):b==="vec3f"?new Ie(new Float32Array(this.buffer,s,3),m,this):b==="vec4f"?new Ie(new Float32Array(this.buffer,s,4),m,this):b==="vec2i"?new Ie(new Int32Array(this.buffer,s,2),m,this):b==="vec3i"?new Ie(new Int32Array(this.buffer,s,3),m,this):b==="vec4i"?new Ie(new Int32Array(this.buffer,s,4),m,this):b==="vec2u"?new Ie(new Uint32Array(this.buffer,s,2),m,this):b==="vec3u"?new Ie(new Uint32Array(this.buffer,s,3),m,this):b==="vec4u"?new Ie(new Uint32Array(this.buffer,s,4),m,this):m instanceof dm&&m.name==="atomic"?((i=m.format)===null||i===void 0?void 0:i.name)==="u32"?new Ge(new Uint32Array(this.buffer,s,1)[0],m.format,this):((l=m.format)===null||l===void 0?void 0:l.name)==="i32"?new Ge(new Int32Array(this.buffer,s,1)[0],m.format,this):(console.error(`GetDataValue: Invalid atomic format ${(c=m.format)===null||c===void 0?void 0:c.name}`),null):new Fi(this.buffer,m,s,this)}toString(){let e="";if(this.typeInfo instanceof wp)if(this.typeInfo.format.name==="f32"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){const r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){const r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)e+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else e="[...]";else this.typeInfo instanceof yp?e+="{...}":e="[...]";return e}}class qf extends bc{constructor(e,r,n,i){super(r,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new qf(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>e);return r}get texelByteSize(){const e=this.format,r=eS[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,r=eS[e];return!!r&&r.isDepthStencil}getGpuSize(){const e=this.format,r=eS[e],n=this.width;if(!e||n<=0||!r)return-1;const i=this.height,l=this.depthOrArrayLayers,c=this.dimension;return n/r.blockWidth*(c==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*l}getPixel(e,r,n=0,i=0){const l=this.texelByteSize,c=this.bytesPerRow,s=this.height,m=this.data[i];return YW(new Uint8Array(m),e,r,n,i,s,c,l,this.format)}setPixel(e,r,n,i,l){const c=this.texelByteSize,s=this.bytesPerRow,m=this.height,b=this.data[i];(function(w,E,O,N,V,W,j,Y,ce,re){const ue=N*(j>>=V)*(W>>=V)+O*j+E*Y;switch(ce){case"r8unorm":return void An(w,ue,"8unorm",1,re);case"r8snorm":return void An(w,ue,"8snorm",1,re);case"r8uint":return void An(w,ue,"8uint",1,re);case"r8sint":return void An(w,ue,"8sint",1,re);case"rg8unorm":return void An(w,ue,"8unorm",2,re);case"rg8snorm":return void An(w,ue,"8snorm",2,re);case"rg8uint":return void An(w,ue,"8uint",2,re);case"rg8sint":return void An(w,ue,"8sint",2,re);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void An(w,ue,"8unorm",4,re);case"rgba8snorm":return void An(w,ue,"8snorm",4,re);case"rgba8uint":return void An(w,ue,"8uint",4,re);case"rgba8sint":return void An(w,ue,"8sint",4,re);case"r16uint":return void An(w,ue,"16uint",1,re);case"r16sint":return void An(w,ue,"16sint",1,re);case"r16float":return void An(w,ue,"16float",1,re);case"rg16uint":return void An(w,ue,"16uint",2,re);case"rg16sint":return void An(w,ue,"16sint",2,re);case"rg16float":return void An(w,ue,"16float",2,re);case"rgba16uint":return void An(w,ue,"16uint",4,re);case"rgba16sint":return void An(w,ue,"16sint",4,re);case"rgba16float":return void An(w,ue,"16float",4,re);case"r32uint":return void An(w,ue,"32uint",1,re);case"r32sint":return void An(w,ue,"32sint",1,re);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void An(w,ue,"32float",1,re);case"rg32uint":return void An(w,ue,"32uint",2,re);case"rg32sint":return void An(w,ue,"32sint",2,re);case"rg32float":return void An(w,ue,"32float",2,re);case"rgba32uint":return void An(w,ue,"32uint",4,re);case"rgba32sint":return void An(w,ue,"32sint",4,re);case"rgba32float":return void An(w,ue,"32float",4,re);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(b),e,r,n,i,m,s,c,this.format,l)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Ze||(Ze={}));class Ke{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class we{}ut=we,we.none=new Ke("",Ze.reserved,""),we.eof=new Ke("EOF",Ze.token,""),we.reserved={asm:new Ke("asm",Ze.reserved,"asm"),bf16:new Ke("bf16",Ze.reserved,"bf16"),do:new Ke("do",Ze.reserved,"do"),enum:new Ke("enum",Ze.reserved,"enum"),f16:new Ke("f16",Ze.reserved,"f16"),f64:new Ke("f64",Ze.reserved,"f64"),handle:new Ke("handle",Ze.reserved,"handle"),i8:new Ke("i8",Ze.reserved,"i8"),i16:new Ke("i16",Ze.reserved,"i16"),i64:new Ke("i64",Ze.reserved,"i64"),mat:new Ke("mat",Ze.reserved,"mat"),premerge:new Ke("premerge",Ze.reserved,"premerge"),regardless:new Ke("regardless",Ze.reserved,"regardless"),typedef:new Ke("typedef",Ze.reserved,"typedef"),u8:new Ke("u8",Ze.reserved,"u8"),u16:new Ke("u16",Ze.reserved,"u16"),u64:new Ke("u64",Ze.reserved,"u64"),unless:new Ke("unless",Ze.reserved,"unless"),using:new Ke("using",Ze.reserved,"using"),vec:new Ke("vec",Ze.reserved,"vec"),void:new Ke("void",Ze.reserved,"void")},we.keywords={array:new Ke("array",Ze.keyword,"array"),atomic:new Ke("atomic",Ze.keyword,"atomic"),bool:new Ke("bool",Ze.keyword,"bool"),f32:new Ke("f32",Ze.keyword,"f32"),i32:new Ke("i32",Ze.keyword,"i32"),mat2x2:new Ke("mat2x2",Ze.keyword,"mat2x2"),mat2x3:new Ke("mat2x3",Ze.keyword,"mat2x3"),mat2x4:new Ke("mat2x4",Ze.keyword,"mat2x4"),mat3x2:new Ke("mat3x2",Ze.keyword,"mat3x2"),mat3x3:new Ke("mat3x3",Ze.keyword,"mat3x3"),mat3x4:new Ke("mat3x4",Ze.keyword,"mat3x4"),mat4x2:new Ke("mat4x2",Ze.keyword,"mat4x2"),mat4x3:new Ke("mat4x3",Ze.keyword,"mat4x3"),mat4x4:new Ke("mat4x4",Ze.keyword,"mat4x4"),ptr:new Ke("ptr",Ze.keyword,"ptr"),sampler:new Ke("sampler",Ze.keyword,"sampler"),sampler_comparison:new Ke("sampler_comparison",Ze.keyword,"sampler_comparison"),struct:new Ke("struct",Ze.keyword,"struct"),texture_1d:new Ke("texture_1d",Ze.keyword,"texture_1d"),texture_2d:new Ke("texture_2d",Ze.keyword,"texture_2d"),texture_2d_array:new Ke("texture_2d_array",Ze.keyword,"texture_2d_array"),texture_3d:new Ke("texture_3d",Ze.keyword,"texture_3d"),texture_cube:new Ke("texture_cube",Ze.keyword,"texture_cube"),texture_cube_array:new Ke("texture_cube_array",Ze.keyword,"texture_cube_array"),texture_multisampled_2d:new Ke("texture_multisampled_2d",Ze.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ke("texture_storage_1d",Ze.keyword,"texture_storage_1d"),texture_storage_2d:new Ke("texture_storage_2d",Ze.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ke("texture_storage_2d_array",Ze.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ke("texture_storage_3d",Ze.keyword,"texture_storage_3d"),texture_depth_2d:new Ke("texture_depth_2d",Ze.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ke("texture_depth_2d_array",Ze.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ke("texture_depth_cube",Ze.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ke("texture_depth_cube_array",Ze.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ke("texture_depth_multisampled_2d",Ze.keyword,"texture_depth_multisampled_2d"),texture_external:new Ke("texture_external",Ze.keyword,"texture_external"),u32:new Ke("u32",Ze.keyword,"u32"),vec2:new Ke("vec2",Ze.keyword,"vec2"),vec3:new Ke("vec3",Ze.keyword,"vec3"),vec4:new Ke("vec4",Ze.keyword,"vec4"),bitcast:new Ke("bitcast",Ze.keyword,"bitcast"),block:new Ke("block",Ze.keyword,"block"),break:new Ke("break",Ze.keyword,"break"),case:new Ke("case",Ze.keyword,"case"),continue:new Ke("continue",Ze.keyword,"continue"),continuing:new Ke("continuing",Ze.keyword,"continuing"),default:new Ke("default",Ze.keyword,"default"),diagnostic:new Ke("diagnostic",Ze.keyword,"diagnostic"),discard:new Ke("discard",Ze.keyword,"discard"),else:new Ke("else",Ze.keyword,"else"),enable:new Ke("enable",Ze.keyword,"enable"),fallthrough:new Ke("fallthrough",Ze.keyword,"fallthrough"),false:new Ke("false",Ze.keyword,"false"),fn:new Ke("fn",Ze.keyword,"fn"),for:new Ke("for",Ze.keyword,"for"),function:new Ke("function",Ze.keyword,"function"),if:new Ke("if",Ze.keyword,"if"),let:new Ke("let",Ze.keyword,"let"),const:new Ke("const",Ze.keyword,"const"),loop:new Ke("loop",Ze.keyword,"loop"),while:new Ke("while",Ze.keyword,"while"),private:new Ke("private",Ze.keyword,"private"),read:new Ke("read",Ze.keyword,"read"),read_write:new Ke("read_write",Ze.keyword,"read_write"),return:new Ke("return",Ze.keyword,"return"),requires:new Ke("requires",Ze.keyword,"requires"),storage:new Ke("storage",Ze.keyword,"storage"),switch:new Ke("switch",Ze.keyword,"switch"),true:new Ke("true",Ze.keyword,"true"),alias:new Ke("alias",Ze.keyword,"alias"),type:new Ke("type",Ze.keyword,"type"),uniform:new Ke("uniform",Ze.keyword,"uniform"),var:new Ke("var",Ze.keyword,"var"),override:new Ke("override",Ze.keyword,"override"),workgroup:new Ke("workgroup",Ze.keyword,"workgroup"),write:new Ke("write",Ze.keyword,"write"),r8unorm:new Ke("r8unorm",Ze.keyword,"r8unorm"),r8snorm:new Ke("r8snorm",Ze.keyword,"r8snorm"),r8uint:new Ke("r8uint",Ze.keyword,"r8uint"),r8sint:new Ke("r8sint",Ze.keyword,"r8sint"),r16uint:new Ke("r16uint",Ze.keyword,"r16uint"),r16sint:new Ke("r16sint",Ze.keyword,"r16sint"),r16float:new Ke("r16float",Ze.keyword,"r16float"),rg8unorm:new Ke("rg8unorm",Ze.keyword,"rg8unorm"),rg8snorm:new Ke("rg8snorm",Ze.keyword,"rg8snorm"),rg8uint:new Ke("rg8uint",Ze.keyword,"rg8uint"),rg8sint:new Ke("rg8sint",Ze.keyword,"rg8sint"),r32uint:new Ke("r32uint",Ze.keyword,"r32uint"),r32sint:new Ke("r32sint",Ze.keyword,"r32sint"),r32float:new Ke("r32float",Ze.keyword,"r32float"),rg16uint:new Ke("rg16uint",Ze.keyword,"rg16uint"),rg16sint:new Ke("rg16sint",Ze.keyword,"rg16sint"),rg16float:new Ke("rg16float",Ze.keyword,"rg16float"),rgba8unorm:new Ke("rgba8unorm",Ze.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ke("rgba8unorm_srgb",Ze.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ke("rgba8snorm",Ze.keyword,"rgba8snorm"),rgba8uint:new Ke("rgba8uint",Ze.keyword,"rgba8uint"),rgba8sint:new Ke("rgba8sint",Ze.keyword,"rgba8sint"),bgra8unorm:new Ke("bgra8unorm",Ze.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ke("bgra8unorm_srgb",Ze.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ke("rgb10a2unorm",Ze.keyword,"rgb10a2unorm"),rg11b10float:new Ke("rg11b10float",Ze.keyword,"rg11b10float"),rg32uint:new Ke("rg32uint",Ze.keyword,"rg32uint"),rg32sint:new Ke("rg32sint",Ze.keyword,"rg32sint"),rg32float:new Ke("rg32float",Ze.keyword,"rg32float"),rgba16uint:new Ke("rgba16uint",Ze.keyword,"rgba16uint"),rgba16sint:new Ke("rgba16sint",Ze.keyword,"rgba16sint"),rgba16float:new Ke("rgba16float",Ze.keyword,"rgba16float"),rgba32uint:new Ke("rgba32uint",Ze.keyword,"rgba32uint"),rgba32sint:new Ke("rgba32sint",Ze.keyword,"rgba32sint"),rgba32float:new Ke("rgba32float",Ze.keyword,"rgba32float"),static_assert:new Ke("static_assert",Ze.keyword,"static_assert")},we.tokens={decimal_float_literal:new Ke("decimal_float_literal",Ze.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ke("hex_float_literal",Ze.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ke("int_literal",Ze.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ke("uint_literal",Ze.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ke("name",Ze.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ke("ident",Ze.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ke("and",Ze.token,"&"),and_and:new Ke("and_and",Ze.token,"&&"),arrow:new Ke("arrow ",Ze.token,"->"),attr:new Ke("attr",Ze.token,"@"),forward_slash:new Ke("forward_slash",Ze.token,"/"),bang:new Ke("bang",Ze.token,"!"),bracket_left:new Ke("bracket_left",Ze.token,"["),bracket_right:new Ke("bracket_right",Ze.token,"]"),brace_left:new Ke("brace_left",Ze.token,"{"),brace_right:new Ke("brace_right",Ze.token,"}"),colon:new Ke("colon",Ze.token,":"),comma:new Ke("comma",Ze.token,","),equal:new Ke("equal",Ze.token,"="),equal_equal:new Ke("equal_equal",Ze.token,"=="),not_equal:new Ke("not_equal",Ze.token,"!="),greater_than:new Ke("greater_than",Ze.token,">"),greater_than_equal:new Ke("greater_than_equal",Ze.token,">="),shift_right:new Ke("shift_right",Ze.token,">>"),less_than:new Ke("less_than",Ze.token,"<"),less_than_equal:new Ke("less_than_equal",Ze.token,"<="),shift_left:new Ke("shift_left",Ze.token,"<<"),modulo:new Ke("modulo",Ze.token,"%"),minus:new Ke("minus",Ze.token,"-"),minus_minus:new Ke("minus_minus",Ze.token,"--"),period:new Ke("period",Ze.token,"."),plus:new Ke("plus",Ze.token,"+"),plus_plus:new Ke("plus_plus",Ze.token,"++"),or:new Ke("or",Ze.token,"|"),or_or:new Ke("or_or",Ze.token,"||"),paren_left:new Ke("paren_left",Ze.token,"("),paren_right:new Ke("paren_right",Ze.token,")"),semicolon:new Ke("semicolon",Ze.token,";"),star:new Ke("star",Ze.token,"*"),tilde:new Ke("tilde",Ze.token,"~"),underscore:new Ke("underscore",Ze.token,"_"),xor:new Ke("xor",Ze.token,"^"),plus_equal:new Ke("plus_equal",Ze.token,"+="),minus_equal:new Ke("minus_equal",Ze.token,"-="),times_equal:new Ke("times_equal",Ze.token,"*="),division_equal:new Ke("division_equal",Ze.token,"/="),modulo_equal:new Ke("modulo_equal",Ze.token,"%="),and_equal:new Ke("and_equal",Ze.token,"&="),or_equal:new Ke("or_equal",Ze.token,"|="),xor_equal:new Ke("xor_equal",Ze.token,"^="),shift_right_equal:new Ke("shift_right_equal",Ze.token,">>="),shift_left_equal:new Ke("shift_left_equal",Ze.token,"<<=")},we.simpleTokens={"@":ut.tokens.attr,"{":ut.tokens.brace_left,"}":ut.tokens.brace_right,":":ut.tokens.colon,",":ut.tokens.comma,"(":ut.tokens.paren_left,")":ut.tokens.paren_right,";":ut.tokens.semicolon},we.literalTokens={"&":ut.tokens.and,"&&":ut.tokens.and_and,"->":ut.tokens.arrow,"/":ut.tokens.forward_slash,"!":ut.tokens.bang,"[":ut.tokens.bracket_left,"]":ut.tokens.bracket_right,"=":ut.tokens.equal,"==":ut.tokens.equal_equal,"!=":ut.tokens.not_equal,">":ut.tokens.greater_than,">=":ut.tokens.greater_than_equal,">>":ut.tokens.shift_right,"<":ut.tokens.less_than,"<=":ut.tokens.less_than_equal,"<<":ut.tokens.shift_left,"%":ut.tokens.modulo,"-":ut.tokens.minus,"--":ut.tokens.minus_minus,".":ut.tokens.period,"+":ut.tokens.plus,"++":ut.tokens.plus_plus,"|":ut.tokens.or,"||":ut.tokens.or_or,"*":ut.tokens.star,"~":ut.tokens.tilde,_:ut.tokens.underscore,"^":ut.tokens.xor,"+=":ut.tokens.plus_equal,"-=":ut.tokens.minus_equal,"*=":ut.tokens.times_equal,"/=":ut.tokens.division_equal,"%=":ut.tokens.modulo_equal,"&=":ut.tokens.and_equal,"|=":ut.tokens.or_equal,"^=":ut.tokens.xor_equal,">>=":ut.tokens.shift_right_equal,"<<=":ut.tokens.shift_left_equal},we.regexTokens={decimal_float_literal:ut.tokens.decimal_float_literal,hex_float_literal:ut.tokens.hex_float_literal,int_literal:ut.tokens.int_literal,uint_literal:ut.tokens.uint_literal,ident:ut.tokens.ident},we.storage_class=[ut.keywords.function,ut.keywords.private,ut.keywords.workgroup,ut.keywords.uniform,ut.keywords.storage],we.access_mode=[ut.keywords.read,ut.keywords.write,ut.keywords.read_write],we.sampler_type=[ut.keywords.sampler,ut.keywords.sampler_comparison],we.sampled_texture_type=[ut.keywords.texture_1d,ut.keywords.texture_2d,ut.keywords.texture_2d_array,ut.keywords.texture_3d,ut.keywords.texture_cube,ut.keywords.texture_cube_array],we.multisampled_texture_type=[ut.keywords.texture_multisampled_2d],we.storage_texture_type=[ut.keywords.texture_storage_1d,ut.keywords.texture_storage_2d,ut.keywords.texture_storage_2d_array,ut.keywords.texture_storage_3d],we.depth_texture_type=[ut.keywords.texture_depth_2d,ut.keywords.texture_depth_2d_array,ut.keywords.texture_depth_cube,ut.keywords.texture_depth_cube_array,ut.keywords.texture_depth_multisampled_2d],we.texture_external_type=[ut.keywords.texture_external],we.any_texture_type=[...ut.sampled_texture_type,...ut.multisampled_texture_type,...ut.storage_texture_type,...ut.depth_texture_type,...ut.texture_external_type],we.texel_format=[ut.keywords.r8unorm,ut.keywords.r8snorm,ut.keywords.r8uint,ut.keywords.r8sint,ut.keywords.r16uint,ut.keywords.r16sint,ut.keywords.r16float,ut.keywords.rg8unorm,ut.keywords.rg8snorm,ut.keywords.rg8uint,ut.keywords.rg8sint,ut.keywords.r32uint,ut.keywords.r32sint,ut.keywords.r32float,ut.keywords.rg16uint,ut.keywords.rg16sint,ut.keywords.rg16float,ut.keywords.rgba8unorm,ut.keywords.rgba8unorm_srgb,ut.keywords.rgba8snorm,ut.keywords.rgba8uint,ut.keywords.rgba8sint,ut.keywords.bgra8unorm,ut.keywords.bgra8unorm_srgb,ut.keywords.rgb10a2unorm,ut.keywords.rg11b10float,ut.keywords.rg32uint,ut.keywords.rg32sint,ut.keywords.rg32float,ut.keywords.rgba16uint,ut.keywords.rgba16sint,ut.keywords.rgba16float,ut.keywords.rgba32uint,ut.keywords.rgba32sint,ut.keywords.rgba32float],we.const_literal=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.keywords.true,ut.keywords.false],we.literal_or_ident=[ut.tokens.ident,ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.tokens.name],we.element_count_expression=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.ident],we.template_types=[ut.keywords.vec2,ut.keywords.vec3,ut.keywords.vec4,ut.keywords.mat2x2,ut.keywords.mat2x3,ut.keywords.mat2x4,ut.keywords.mat3x2,ut.keywords.mat3x3,ut.keywords.mat3x4,ut.keywords.mat4x2,ut.keywords.mat4x3,ut.keywords.mat4x4,ut.keywords.atomic,ut.keywords.bitcast,...ut.any_texture_type],we.attribute_name=[ut.tokens.ident,ut.keywords.block,ut.keywords.diagnostic],we.assignment_operators=[ut.tokens.equal,ut.tokens.plus_equal,ut.tokens.minus_equal,ut.tokens.times_equal,ut.tokens.division_equal,ut.tokens.modulo_equal,ut.tokens.and_equal,ut.tokens.or_equal,ut.tokens.xor_equal,ut.tokens.shift_right_equal,ut.tokens.shift_left_equal],we.increment_operators=[ut.tokens.plus_plus,ut.tokens.minus_minus];class UI{constructor(e,r,n,i,l){this.type=e,this.lexeme=r,this.line=n,this.start=i,this.end=l}toString(){return this.lexeme}isTemplateType(){return we.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==we.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class n9{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new UI(we.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const r=we.simpleTokens[e];if(r)return this._addToken(r),!0;let n=we.none;const i=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(i){const c=we.keywords[e];if(c)return this._addToken(c),!0}if(i||l)return this._addToken(we.tokens.ident),!0;for(;;){let c=this._findType(e);const s=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(s=="=")return this._current++,e+=s,this._addToken(we.tokens.minus_equal),!0;if(s=="-")return this._current++,e+=s,this._addToken(we.tokens.minus_minus),!0;const m=this._tokens.length-1;if((we.literal_or_ident.indexOf(this._tokens[m].type)!=-1||this._tokens[m].type==we.tokens.paren_right)&&s!=">")return this._addToken(c),!0}if(e==">"&&(s==">"||s=="=")){let m=!1,b=this._tokens.length-1;for(let w=0;w<5&&b>=0&&we.assignment_operators.indexOf(this._tokens[b].type)===-1;++w,--b)if(this._tokens[b].type===we.tokens.less_than){b>0&&this._tokens[b-1].isArrayOrTemplateType()&&(m=!0);break}if(m)return this._addToken(c),!0}if(c===we.none){let m=e,b=0;const w=2;for(let E=0;E<w;++E)if(m+=this._peekAhead(E),c=this._findType(m),c!==we.none){b=E;break}if(c===we.none)return n!==we.none&&(this._current--,this._addToken(n),!0);e=m,this._current+=b+1}if(n=c,this._isAtEnd())break;e+=this._advance()}return n!==we.none&&(this._addToken(n),!0)}_findType(e){for(const n in we.regexTokens){const i=we.regexTokens[n];if(this._match(e,i.rule))return i}return we.literalTokens[e]||we.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new UI(e,r,this._line,this._start,this._current))}}function Kt(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}const aw=new Float32Array(1),i9=new Uint32Array(aw.buffer),s9=new Uint32Array(aw.buffer),ow=new Int32Array(1),a9=new Float32Array(ow.buffer),o9=new Uint32Array(ow.buffer),lw=new Uint32Array(1),l9=new Float32Array(lw.buffer),c9=new Int32Array(lw.buffer);function VI(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return aw[0]=t,i9[0];if(r==="u32")return aw[0]=t,s9[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return ow[0]=t,a9[0];if(r==="u32")return ow[0]=t,o9[0]}else if(e==="u32"){if(r==="f32")return lw[0]=t,l9[0];if(r==="i32"||r==="x32")return lw[0]=t,c9[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}class u9{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Zx{constructor(e,r){this.align=e,this.size=r}}class Mh{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new qW,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const r of e)r instanceof U0&&this._functions.set(r.name,new u9(r));for(const r of e)if(r instanceof Hf){const n=this.getTypeInfo(r,null);n instanceof yp&&this.structs.push(n)}for(const r of e)if(r instanceof hC)this.aliases.push(this._getAliasInfo(r));else{if(r instanceof cC){const n=r,i=this._getAttributeNum(n.attributes,"id",0),l=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new $W(n.name,l,n.attributes,i));continue}if(this._isUniformVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new Gx(n.name,c,i,l,n.attributes,dp.Uniform,n.access);s.access||(s.access="read"),this.uniforms.push(s);continue}if(this._isStorageVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),m=new Gx(n.name,c,i,l,n.attributes,s?dp.StorageTexture:dp.Storage,n.access);m.access||(m.access="read"),this.storage.push(m);continue}if(this._isTextureVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),m=new Gx(n.name,c,i,l,n.attributes,s?dp.StorageTexture:dp.Texture,n.access);m.access||(m.access="read"),s?this.storage.push(m):this.textures.push(m);continue}if(this._isSamplerVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new Gx(n.name,c,i,l,n.attributes,dp.Sampler,n.access);this.samplers.push(s);continue}}for(const r of e)if(r instanceof U0){const n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),l=this._getAttribute(r,"compute"),c=n||i||l,s=new HW(r.name,c?.name,r.attributes);s.attributes=r.attributes,s.startLine=r.startLine,s.endLine=r.endLine,this.functions.push(s),this._functions.get(r.name).info=s,c&&(this._functions.get(r.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(r,!!c),s.inputs=this._getInputs(r.args),s.outputs=this._getOutputs(r.returnType),this.entry[c.name].push(s)),s.arguments=r.args.map(m=>new WW(m.name,this.getTypeInfo(m.type,m.attributes),m.attributes)),s.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null;continue}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var i,l,c;if(n instanceof kz){if(n.value)if(Kt(n.value))for(const s of n.value)for(const m of this.overrides)s===m.name&&((i=r.info)===null||i===void 0||i.overrides.push(m));else for(const s of this.overrides)n.value===s.name&&((l=r.info)===null||l===void 0||l.overrides.push(s))}else if(n instanceof Sl)for(const s of this.overrides)n.name===s.name&&((c=r.info)===null||c===void 0||c.overrides.push(s))});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}getFunctionInfo(e){for(const r of this.functions)if(r.name==e)return r;return null}getStructInfo(e){for(const r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(const r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const i of e.calls){const l=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;l&&r.add(l)}}findResource(e,r,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==r)return l}for(const i of this.entry.vertex)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==r)return l}for(const i of this.entry.fragment)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==r)return l}}for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],i=this,l=[];return e.search(c=>{if(c instanceof iw)l.push({});else if(c instanceof sw)l.pop();else if(c instanceof Gf){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),l.length>0&&(l[l.length-1][s.name]=s)}else if(c instanceof Eh){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type)}else if(c instanceof R0){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),l.length>0&&(l[l.length-1][s.name]=s)}else if(c instanceof Sl){const s=c;if(l.length>0&&l[l.length-1][s.name])return;const m=i._findResource(s.name);m&&n.push(m)}else if(c instanceof fC){const s=c,m=i._functions.get(s.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=i._findResources(m.node,r)),n.push(...m.resources))}else if(c instanceof uC){const s=c,m=i._functions.get(s.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=i._findResources(m.node,r)),n.push(...m.resources))}}),[...new Map(n.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function r(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)r(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Hf)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Hf)this._getStructOutputs(n.type,r);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const l=this.getTypeInfo(n.type,n.type.attributes),c=this._parseInt(i.value),s=new NI(n.name,l,i.name,c);r.push(s)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(r.value);return new NI("",n,r.name,i)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Hf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Hf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),l=this._parseInt(r.value),c=new VW(e.name,i,r.name,l);return n!==null&&(c.interpolation=this._parseString(n.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new UW(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const r of this.structs)if(r.name==e)return r;for(const r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof I1){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,l=new bE(e.name,i,r);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof O0){const i=e,l=i.format?this.getTypeInfo(i.format,i.attributes):null,c=new wp(i.name,r);return c.format=l,c.count=i.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Hf){const i=e,l=new yp(i.name,r);l.startLine=i.startLine,l.endLine=i.endLine;for(const c of i.members){const s=this.getTypeInfo(c.type,c.attributes);l.members.push(new LI(c.name,s,c.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof x0){const i=e,l=i.format instanceof Lt,c=i.format?l?this.getTypeInfo(i.format,null):new _c(i.format,null):null,s=new dm(i.name,c,r,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof rt){const i=e,l=i.format?this.getTypeInfo(i.format,null):null,c=new dm(i.name,l,r,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const n=new _c(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n,i;const l=this._getTypeSize(e);if(e.size=(r=l?.size)!==null&&r!==void 0?r:0,e instanceof wp&&e.format){const c=this._getTypeSize(e.format);e.stride=Math.max((n=c?.size)!==null&&n!==void 0?n:0,(i=c?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof bE&&this._updateTypeInfo(e.format),e instanceof yp&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,i=0,l=0,c=0;for(let s=0,m=e.members.length;s<m;++s){const b=e.members[s],w=this._getTypeSize(b);if(!w)continue;(r=this._getAlias(b.type.name))!==null&&r!==void 0||b.type;const E=w.align,O=w.size;n=this._roundUp(E,n+i),i=O,l=n,c=Math.max(c,E),b.offset=n,b.size=O,this._updateTypeInfo(b.type)}e.size=this._roundUp(c,l+i),e.align=c}_getTypeSize(e){var r,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof LI&&(e=e.type),e instanceof _c){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=Mh._typeInfo[e.name];if(c!==void 0){const s=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Zx(Math.max(l,c.align/s),Math.max(i,c.size/s))}}{const c=Mh._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const s=e.name[e.name.length-1]==="h"?2:1;return new Zx(Math.max(l,c.align/s),Math.max(i,c.size/s))}}if(e instanceof wp){let c=e,s=8,m=8;const b=this._getTypeSize(c.format);return b!==null&&(m=b.size,s=b.align),m=c.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(s,m)),i&&(m=i),new Zx(Math.max(l,s),Math.max(i,m))}if(e instanceof yp){let c=0,s=0,m=0,b=0,w=0;for(const E of e.members){const O=this._getTypeSize(E.type);O!==null&&(c=Math.max(O.align,c),m=this._roundUp(O.align,m+b),b=O.size,w=m)}return s=this._roundUp(c,w+b),new Zx(Math.max(l,c),Math.max(i,s))}return null}_isUniformVar(e){return e instanceof Gf&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Gf&&e.storage=="storage"}_isTextureVar(e){return e instanceof Gf&&e.type!==null&&Mh._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Gf&&e.type!==null&&Mh._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let l of i)if(l.name==r)return l;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let i of e)if(i.name==r){let l=i!==null&&i.value!==null?i.value:n;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}Mh._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Mh._textureTypes=we.any_texture_type.map(t=>t.name),Mh._samplerTypes=we.sampler_type.map(t=>t.name);let dC=0;class pC{constructor(e,r,n){this.id=dC++,this.name=e,this.value=r,this.node=n}clone(){return new pC(this.name,this.value,this.node)}}class gC{constructor(e){this.id=dC++,this.name=e.name,this.node=e}clone(){return new gC(this.node)}}class mC{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=dC++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,n){this.variables.set(e,new pC(e,r,n??null))}setVariable(e,r,n){const i=this.getVariable(e);i!==null?i.value=r:this.createVariable(e,r,n)}getVariableValue(e){var r;const n=this.getVariable(e);return(r=n?.value)!==null&&r!==void 0?r:null}clone(){return new mC(this)}}class h9{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}}class f9{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){const n=this.exec.evalExpression(e.args[0],r);let i=!0;if(n instanceof Ie)return n.data.forEach(l=>{l||(i=!1)}),new Ge(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie){const i=n.data.some(l=>l);return new Ge(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){const n=this.exec.evalExpression(e.args[2],r);if(!(n instanceof Ge))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.evalExpression(n,r);if(i instanceof Fi&&i.typeInfo.size===0){const l=i.typeInfo,c=i.buffer.byteLength/l.stride;return new Ge(c,this.getTypeInfo("u32"))}return new Ge(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.abs(l)),n.typeInfo);const i=n;return new Ge(Math.abs(i.value),i.typeInfo)}Acos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.acos(l)),n.typeInfo);const i=n;return new Ge(Math.acos(i.value),n.typeInfo)}Acosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.acosh(l)),n.typeInfo);const i=n;return new Ge(Math.acosh(i.value),n.typeInfo)}Asin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.asin(l)),n.typeInfo);const i=n;return new Ge(Math.asin(i.value),n.typeInfo)}Asinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.asinh(l)),n.typeInfo);const i=n;return new Ge(Math.asinh(i.value),n.typeInfo)}Atan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.atan(l)),n.typeInfo);const i=n;return new Ge(Math.atan(i.value),n.typeInfo)}Atanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.atanh(l)),n.typeInfo);const i=n;return new Ge(Math.atanh(i.value),n.typeInfo)}Atan2(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((s,m)=>Math.atan2(s,i.data[m])),n.typeInfo);const l=n,c=i;return new Ge(Math.atan2(l.value,c.value),n.typeInfo)}Ceil(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.ceil(l)),n.typeInfo);const i=n;return new Ge(Math.ceil(i.value),n.typeInfo)}_clamp(e,r,n){return Math.min(Math.max(e,r),n)}Clamp(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(n instanceof Ie&&i instanceof Ie&&l instanceof Ie)return new Ie(n.data.map((b,w)=>this._clamp(b,i.data[w],l.data[w])),n.typeInfo);const c=n,s=i,m=l;return new Ge(this._clamp(c.value,s.value,m.value),n.typeInfo)}Cos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.cos(l)),n.typeInfo);const i=n;return new Ge(Math.cos(i.value),n.typeInfo)}Cosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.cosh(l)),n.typeInfo);const i=n;return new Ge(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.clz32(l)),n.typeInfo);const i=n;return new Ge(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>this._countOneBits(l)),n.typeInfo);const i=n;return new Ge(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>this._countTrailingZeros(l)),n.typeInfo);const i=n;return new Ge(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const l=n.data,c=i.data;return new Ie([l[1]*c[2]-c[1]*l[2],l[2]*c[0]-c[2]*l[0],l[0]*c[1]-c[0]*l[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){const n=this.exec.evalExpression(e.args[0],r),i=180/Math.PI;return n instanceof Ie?new Ie(n.data.map(l=>l*i),n.typeInfo):new Ge(n.value*i,this.getTypeInfo("f32"))}Determinant(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Mr){const i=n.data,l=n.typeInfo.getTypeName(),c=l.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(l==="mat2x2"||l==="mat2x2f"||l==="mat2x2h")return new Ge(i[0]*i[3]-i[1]*i[2],c);if(l==="mat2x3"||l==="mat2x3f"||l==="mat2x3h")return new Ge(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);if(l==="mat2x4"||l==="mat2x4f"||l==="mat2x4h")console.error(`TODO: Determinant for ${l}`);else if(l==="mat3x2"||l==="mat3x2f"||l==="mat3x2h")console.error(`TODO: Determinant for ${l}`);else{if(l==="mat3x3"||l==="mat3x3f"||l==="mat3x3h")return new Ge(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);l==="mat3x4"||l==="mat3x4f"||l==="mat3x4h"||l==="mat4x2"||l==="mat4x2f"||l==="mat4x2h"||l==="mat4x3"||l==="mat4x3f"||l==="mat4x3h"?console.error(`TODO: Determinant for ${l}`):l!=="mat4x4"&&l!=="mat4x4f"&&l!=="mat4x4h"||console.error(`TODO: Determinant for ${l}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie){let s=0;for(let m=0;m<n.data.length;++m)s+=(n.data[m]-i.data[m])*(n.data[m]-i.data[m]);return new Ge(Math.sqrt(s),this.getTypeInfo("f32"))}const l=n,c=i;return new Ge(Math.abs(l.value-c.value),n.typeInfo)}_dot(e,r){let n=0;for(let i=0;i<e.length;++i)n+=r[i]*e[i];return n}Dot(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);return n instanceof Ie&&i instanceof Ie?new Ge(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.exp(l)),n.typeInfo);const i=n;return new Ge(Math.exp(i.value),n.typeInfo)}Exp2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.pow(2,l)),n.typeInfo);const i=n;return new Ge(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const c=i.value,s=l.value;if(n instanceof Ie)return new Ie(n.data.map(b=>b>>c&(1<<s)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const m=n.value;return new Ge(m>>c&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(n instanceof Ie&&i instanceof Ie&&l instanceof Ie){const c=this._dot(i.data,l.data);return new Ie(c<0?Array.from(n.data):n.data.map(s=>-s),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>this._firstLeadingBit(l)),n.typeInfo);const i=n;return new Ge(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>this._firstTrailingBit(l)),n.typeInfo);const i=n;return new Ge(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.floor(l)),n.typeInfo);const i=n;return new Ge(Math.floor(i.value),n.typeInfo)}Fma(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(n instanceof Ie&&i instanceof Ie&&l instanceof Ie)return n.data.length!==i.data.length||n.data.length!==l.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ie(n.data.map((b,w)=>b*i.data[w]+l.data[w]),n.typeInfo);const c=n,s=i,m=l;return new Ge(c.value*s.value+m.value,c.typeInfo)}Fract(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>l-Math.floor(l)),n.typeInfo);const i=n;return new Ge(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r),c=this.exec.evalExpression(e.args[3],r);if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=l.value,m=(1<<c.value)-1<<s,b=~m;if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((O,N)=>O&b|i.data[N]<<s&m),n.typeInfo);const w=n.value,E=i.value;return new Ge(w&b|E<<s&m,n.typeInfo)}InverseSqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>1/Math.sqrt(l)),n.typeInfo);const i=n;return new Ge(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie){let l=0;return n.data.forEach(c=>{l+=c*c}),new Ge(Math.sqrt(l),this.getTypeInfo("f32"))}const i=n;return new Ge(Math.abs(i.value),n.typeInfo)}Log(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.log(l)),n.typeInfo);const i=n;return new Ge(Math.log(i.value),n.typeInfo)}Log2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.log2(l)),n.typeInfo);const i=n;return new Ge(Math.log2(i.value),n.typeInfo)}Max(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((s,m)=>Math.max(s,i.data[m])),n.typeInfo);const l=n,c=i;return new Ge(Math.max(l.value,c.value),n.typeInfo)}Min(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((s,m)=>Math.min(s,i.data[m])),n.typeInfo);const l=n,c=i;return new Ge(Math.min(l.value,c.value),n.typeInfo)}Mix(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(n instanceof Ie&&i instanceof Ie&&l instanceof Ie)return new Ie(n.data.map((m,b)=>n.data[b]*(1-l.data[b])+i.data[b]*l.data[b]),n.typeInfo);const c=i,s=l;return new Ge(n.value*(1-s.value)+c.value*s.value,n.typeInfo)}Modf(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((c,s)=>c%i.data[s]),n.typeInfo);const l=i;return new Ge(n.value%l.value,n.typeInfo)}Normalize(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie){const i=this.Length(e,r).value;return new Ie(n.data.map(l=>l/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie)return new Ie(n.data.map((s,m)=>Math.pow(s,i.data[m])),n.typeInfo);const l=n,c=i;return new Ge(Math.pow(l.value,c.value),n.typeInfo)}QuantizeToF16(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ie?new Ie(n.data.map(i=>i),n.typeInfo):new Ge(n.value,n.typeInfo)}Radians(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ie?new Ie(n.data.map(i=>i*Math.PI/180),n.typeInfo):new Ge(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ie&&i instanceof Ie){const l=this._dot(n.data,i.data);return new Ie(n.data.map((c,s)=>c-2*l*i.data[s]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(n instanceof Ie&&i instanceof Ie&&l instanceof Ge){const c=this._dot(i.data,n.data);return new Ie(n.data.map((s,m)=>{const b=1-l.value*l.value*(1-c*c);if(b<0)return 0;const w=Math.sqrt(b);return l.value*s-(l.value*c+w)*i.data[m]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.round(l)),n.typeInfo);const i=n;return new Ge(Math.round(i.value),n.typeInfo)}Saturate(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.min(Math.max(l,0),1)),n.typeInfo);const i=n;return new Ge(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sign(l)),n.typeInfo);const i=n;return new Ge(Math.sign(i.value),n.typeInfo)}Sin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sin(l)),n.typeInfo);const i=n;return new Ge(Math.sin(i.value),n.typeInfo)}Sinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sinh(l)),n.typeInfo);const i=n;return new Ge(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,r,n){const i=Math.min(Math.max((n-e)/(r-e),0),1);return i*i*(3-2*i)}SmoothStep(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),l=this.exec.evalExpression(e.args[2],r);if(l instanceof Ie&&n instanceof Ie&&i instanceof Ie)return new Ie(l.data.map((b,w)=>this._smoothstep(n.data[w],i.data[w],b)),l.typeInfo);const c=n,s=i,m=l;return new Ge(this._smoothstep(c.value,s.value,m.value),l.typeInfo)}Sqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sqrt(l)),n.typeInfo);const i=n;return new Ge(Math.sqrt(i.value),n.typeInfo)}Step(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(i instanceof Ie&&n instanceof Ie)return new Ie(i.data.map((c,s)=>c<n.data[s]?0:1),i.typeInfo);const l=n;return new Ge(i.value<l.value?0:1,l.typeInfo)}Tan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.tan(l)),n.typeInfo);const i=n;return new Ge(Math.tan(i.value),n.typeInfo)}Tanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.tanh(l)),n.typeInfo);const i=n;return new Ge(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){const n=this.exec.evalExpression(e.args[0],r);if(!(n instanceof Mr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const l=n.data;return new Mr([l[0],l[2],l[1],l[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const l=n.data;return new Mr([l[0],l[3],l[6],l[1],l[4],l[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const l=n.data;return new Mr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const l=n.data;return new Mr([l[0],l[3],l[1],l[4],l[2],l[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const l=n.data;return new Mr([l[0],l[3],l[6],l[1],l[4],l[7],l[2],l[5],l[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const l=n.data;return new Mr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const l=n.data;return new Mr([l[0],l[4],l[1],l[5],l[2],l[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const l=n.data;return new Mr([l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const l=n.data;return new Mr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14],l[3],l[7],l[11],l[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.trunc(l)),n.typeInfo);const i=n;return new Ge(Math.trunc(i.value),n.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(n instanceof Sl){const l=n.name,c=r.getVariableValue(l);if(c instanceof qf){if(i<0||i>=c.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const s=c.getMipLevelSize(i),m=c.dimension;return m==="1d"?new Ge(s[0],this.getTypeInfo("u32")):m==="3d"?new Ie(s,this.getTypeInfo("vec3u")):m==="2d"?new Ie(s.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${m} not found. Line ${e.line}`),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),l=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(i instanceof Ie)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Sl){const c=n.name,s=r.getVariableValue(c);if(s instanceof qf){const m=Math.floor(i.data[0]),b=Math.floor(i.data[1]);if(m<0||m>=s.width||b<0||b>=s.height)return console.error(`Texture ${c} out of bounds. Line ${e.line}`),null;const w=s.getPixel(m,b,0,l);return w===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ie(w,this.getTypeInfo("vec4f"))}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){const n=e.args[0];if(n instanceof Sl){const i=n.name,l=r.getVariableValue(i);return l instanceof qf?new Ge(l.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){const n=e.args[0];if(n instanceof Sl){const i=n.name,l=r.getVariableValue(i);return l instanceof qf?new Ge(l.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){const n=e.args[0];if(n instanceof Sl){const i=n.name,l=r.getVariableValue(i);return l instanceof qf?new Ge(l.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),l=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,c=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(c.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Ie)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Sl){const s=n.name,m=r.getVariableValue(s);if(m instanceof qf){const b=m.getMipLevelSize(0),w=Math.floor(i.data[0]),E=Math.floor(i.data[1]);return w<0||w>=b[0]||E<0||E>=b[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(m.setPixel(w,E,0,l,Array.from(c)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r);return m instanceof Ge&&s instanceof Ge&&(m.value=s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),null}AtomicAdd(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value+=s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicSub(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value-=s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicMax(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=Math.max(m.value,s.value)),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicMin(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=Math.min(m.value,s.value)),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicAnd(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=m.value&s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicOr(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=m.value|s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicXor(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=m.value^s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicExchange(e,r){let n=e.args[0];n instanceof ts&&(n=n.right);const i=this.exec.getVariableName(n,r),l=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=l.value.getSubData(this.exec,n.postfix,r),b=new Ge(m.value,m.typeInfo);return m instanceof Ge&&s instanceof Ge&&(m.value=s.value),l.value instanceof Fi&&l.value.setDataValue(this.exec,m,n.postfix,r),b}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}}const tS={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},po={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ha extends h9{constructor(e,r){var n;super(),this.ast=e??[],this.reflection=new Mh,this.reflection.updateAST(this.ast),this.context=(n=r?.clone())!==null&&n!==void 0?n:new mC,this.builtins=new f9(this),this.typeInfo={bool:this.getTypeInfo(Lt.bool),i32:this.getTypeInfo(Lt.i32),u32:this.getTypeInfo(Lt.u32),f32:this.getTypeInfo(Lt.f32),f16:this.getTypeInfo(Lt.f16),vec2f:this.getTypeInfo(rt.vec2f),vec2u:this.getTypeInfo(rt.vec2u),vec2i:this.getTypeInfo(rt.vec2i),vec2h:this.getTypeInfo(rt.vec2h),vec3f:this.getTypeInfo(rt.vec3f),vec3u:this.getTypeInfo(rt.vec3u),vec3i:this.getTypeInfo(rt.vec3i),vec3h:this.getTypeInfo(rt.vec3h),vec4f:this.getTypeInfo(rt.vec4f),vec4u:this.getTypeInfo(rt.vec4u),vec4i:this.getTypeInfo(rt.vec4i),vec4h:this.getTypeInfo(rt.vec4h),mat2x2f:this.getTypeInfo(rt.mat2x2f),mat2x3f:this.getTypeInfo(rt.mat2x3f),mat2x4f:this.getTypeInfo(rt.mat2x4f),mat3x2f:this.getTypeInfo(rt.mat3x2f),mat3x3f:this.getTypeInfo(rt.mat3x3f),mat3x4f:this.getTypeInfo(rt.mat3x4f),mat4x2f:this.getTypeInfo(rt.mat4x2f),mat4x3f:this.getTypeInfo(rt.mat4x3f),mat4x4f:this.getTypeInfo(rt.mat4x4f)}}getVariableValue(e){var r,n;const i=(n=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof Ge)return i.value;if(i instanceof Ie||i instanceof Mr)return Array.from(i.data);if(i instanceof Fi&&i.typeInfo instanceof wp){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,n,i){const l=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,l),this._execStatements(this.ast,l);const c=l.getFunction(e);if(!c)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}const s=r[0],m=r[1],b=r[2],w=this.getTypeInfo("vec3u");l.setVariable("@num_workgroups",new Ie(r,w));const E=this.reflection.getFunctionInfo(e);E===null&&console.error(`Function ${e} not found in reflection data`);for(const O in n)for(const N in n[O]){const V=n[O][N];l.variables.forEach(W=>{var j;const Y=W.node;if(Y?.attributes){let ce=null,re=null;for(const ue of Y.attributes)ue.name==="binding"?ce=ue.value:ue.name==="group"&&(re=ue.value);if(N==ce&&O==re){let ue=!1;for(const me of E.resources)if(me.name===W.name&&me.group===parseInt(O)&&me.binding===parseInt(N)){ue=!0;break}if(ue)if(V.texture!==void 0&&V.descriptor!==void 0){const me=new qf(V.texture,this.getTypeInfo(Y.type),V.descriptor,(j=V.texture.view)!==null&&j!==void 0?j:null);W.value=me}else V.uniform!==void 0?W.value=new Fi(V.uniform,this.getTypeInfo(Y.type)):W.value=new Fi(V,this.getTypeInfo(Y.type))}}})}for(let O=0;O<b;++O)for(let N=0;N<m;++N)for(let V=0;V<s;++V)l.setVariable("@workgroup_id",new Ie([V,N,O],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(c,[V,N,O],l)}execStatement(e,r){if(e instanceof Sz)return this.evalExpression(e.value,r);if(e instanceof Ez){if(e.condition){const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))throw new Error("Invalid break-if condition");if(!n.value)return null}return Ha._breakObj}if(e instanceof Pz)return Ha._continueObj;if(e instanceof R0)this._let(e,r);else if(e instanceof Gf)this._var(e,r);else if(e instanceof M1)this._const(e,r);else if(e instanceof U0)this._function(e,r);else{if(e instanceof Tz)return this._if(e,r);if(e instanceof wz)return this._switch(e,r);if(e instanceof yz)return this._for(e,r);if(e instanceof _z)return this._while(e,r);if(e instanceof xz)return this._loop(e,r);if(e instanceof xE){const n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof bz)this._assign(e,r);else if(e instanceof vz)this._increment(e,r);else{if(e instanceof Hf)return null;if(e instanceof cC){const n=e.name;r.getVariable(n)===null&&r.setVariable(n,new Ge(0,this.getTypeInfo("u32")))}else if(e instanceof uC)this._call(e,r);else{if(e instanceof Az||e instanceof hC)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof vu?this._evalBinaryOp(e,r):e instanceof gs?this._evalLiteral(e,r):e instanceof Sl?this._evalVariable(e,r):e instanceof fC?this._evalCall(e,r):e instanceof Eh?this._evalCreate(e,r):e instanceof Cz?this._evalConst(e,r):e instanceof Mz?this._evalBitcast(e,r):e instanceof ts?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Lt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,r){for(const n in e){const i=e[n],l=this.reflection.getOverrideInfo(n);l!==null?(l.type===null&&(l.type=this.getTypeInfo("u32")),l.type.name==="u32"||l.type.name==="i32"||l.type.name==="f32"||l.type.name==="f16"?r.setVariable(n,new Ge(i,l.type)):l.type.name==="bool"?r.setVariable(n,new Ge(i?1:0,l.type)):l.type.name==="vec2"||l.type.name==="vec3"||l.type.name==="vec4"||l.type.name==="vec2f"||l.type.name==="vec3f"||l.type.name==="vec4f"||l.type.name==="vec2i"||l.type.name==="vec3i"||l.type.name==="vec4i"||l.type.name==="vec2u"||l.type.name==="vec3u"||l.type.name==="vec4u"||l.type.name==="vec2h"||l.type.name==="vec3h"||l.type.name==="vec4h"?r.setVariable(n,new Ie(i,l.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,n){const i=[1,1,1];for(const w of e.node.attributes)if(w.name==="workgroup_size"){if(w.value.length>0){const E=n.getVariableValue(w.value[0]);i[0]=E instanceof Ge?E.value:parseInt(w.value[0])}if(w.value.length>1){const E=n.getVariableValue(w.value[1]);i[1]=E instanceof Ge?E.value:parseInt(w.value[1])}if(w.value.length>2){const E=n.getVariableValue(w.value[2]);i[2]=E instanceof Ge?E.value:parseInt(w.value[2])}}const l=this.getTypeInfo("vec3u"),c=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ie(i,l));const s=i[0],m=i[1],b=i[2];for(let w=0,E=0;w<b;++w)for(let O=0;O<m;++O)for(let N=0;N<s;++N,++E){const V=[N,O,w],W=[N+r[0]*i[0],O+r[1]*i[1],w+r[2]*i[2]];n.setVariable("@local_invocation_id",new Ie(V,l)),n.setVariable("@global_invocation_id",new Ie(W,l)),n.setVariable("@local_invocation_index",new Ge(E,c)),this._dispatchExec(e,n)}}_dispatchExec(e,r){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const l=`@${i.value}`,c=r.getVariable(l);c!==void 0&&r.variables.set(n.name,c)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof ts;)e=e.right;return e instanceof Sl?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(const n of e){if(n instanceof Array){const l=r.clone(),c=this._execStatements(n,l);if(c)return c;continue}const i=this.execStatement(n,r);if(i)return i}return null}_call(e,r){const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(i){for(let l=0;l<i.node.args.length;++l){const c=i.node.args[l],s=this.evalExpression(e.args[l],n);n.setVariable(c.name,s,c)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){const n=this.getVariableName(e.variable,r),i=r.getVariable(n);i?e.operator==="++"?i.value instanceof Ge?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof Ge?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof Sl){const n=this.getVariableName(e,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,r)}if(e instanceof ts){if(e.operator==="*"){const n=this._getVariableData(e.right,r);return n instanceof iy?n.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,r);return new iy(n)}}return null}_assign(e,r){let n=null,i="<var>",l=null;if(e.variable instanceof ts){const m=this._getVariableData(e.variable,r),b=this.evalExpression(e.value,r),w=e.operator;if(w==="="){if(m instanceof Ge||m instanceof Ie||m instanceof Mr){if(b instanceof Ge||b instanceof Ie||b instanceof Mr&&m.data.length===b.data.length)return void m.data.set(b.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(m instanceof Fi&&b instanceof Fi&&m.buffer.byteLength-m.offset>=b.buffer.byteLength-b.offset)return void(m.buffer.byteLength%4==0?new Uint32Array(m.buffer,m.offset,m.typeInfo.size/4).set(new Uint32Array(b.buffer,b.offset,b.typeInfo.size/4)):new Uint8Array(m.buffer,m.offset,m.typeInfo.size).set(new Uint8Array(b.buffer,b.offset,b.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(w==="+=")return m instanceof Ge||m instanceof Ie||m instanceof Mr?b instanceof Ge||b instanceof Ie||b instanceof Mr?void m.data.set(b.data.map((E,O)=>m.data[O]+E)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(w==="-=")return(m instanceof Ge||m instanceof Ie||m instanceof Mr)&&(b instanceof Ge||b instanceof Ie||b instanceof Mr)?void m.data.set(b.data.map((E,O)=>m.data[O]-E)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ts){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,r);const m=r.getVariable(i);if(!(m&&m.value instanceof iy))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=m.value.reference;let b=e.variable.postfix;if(!b){let w=e.variable.right;for(;w instanceof ts;){if(w.postfix){b=w.postfix;break}w=w.right}}b&&(n=n.getSubData(this,b,r))}}else{l=e.variable.postfix,i=this.getVariableName(e.variable,r);const m=r.getVariable(i);if(m===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=m.value}if(n instanceof iy&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const c=this.evalExpression(e.value,r),s=e.operator;if(s!=="="){const m=n.getSubData(this,l,r);if(m instanceof Ie&&c instanceof Ge){const b=m.data,w=c.value;if(s==="+=")for(let E=0;E<b.length;++E)b[E]+=w;else if(s==="-=")for(let E=0;E<b.length;++E)b[E]-=w;else if(s==="*=")for(let E=0;E<b.length;++E)b[E]*=w;else if(s==="/=")for(let E=0;E<b.length;++E)b[E]/=w;else if(s==="%=")for(let E=0;E<b.length;++E)b[E]%=w;else if(s==="&=")for(let E=0;E<b.length;++E)b[E]&=w;else if(s==="|=")for(let E=0;E<b.length;++E)b[E]|=w;else if(s==="^=")for(let E=0;E<b.length;++E)b[E]^=w;else if(s==="<<=")for(let E=0;E<b.length;++E)b[E]<<=w;else if(s===">>=")for(let E=0;E<b.length;++E)b[E]>>=w;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(m instanceof Ie&&c instanceof Ie){const b=m.data,w=c.data;if(b.length!==w.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(s==="+=")for(let E=0;E<b.length;++E)b[E]+=w[E];else if(s==="-=")for(let E=0;E<b.length;++E)b[E]-=w[E];else if(s==="*=")for(let E=0;E<b.length;++E)b[E]*=w[E];else if(s==="/=")for(let E=0;E<b.length;++E)b[E]/=w[E];else if(s==="%=")for(let E=0;E<b.length;++E)b[E]%=w[E];else if(s==="&=")for(let E=0;E<b.length;++E)b[E]&=w[E];else if(s==="|=")for(let E=0;E<b.length;++E)b[E]|=w[E];else if(s==="^=")for(let E=0;E<b.length;++E)b[E]^=w[E];else if(s==="<<=")for(let E=0;E<b.length;++E)b[E]<<=w[E];else if(s===">>=")for(let E=0;E<b.length;++E)b[E]>>=w[E];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(m instanceof Ge&&c instanceof Ge))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);s==="+="?m.value+=c.value:s==="-="?m.value-=c.value:s==="*="?m.value*=c.value:s==="/="?m.value/=c.value:s==="%="?m.value%=c.value:s==="&="?m.value&=c.value:s==="|="?m.value|=c.value:s==="^="?m.value^=c.value:s==="<<="?m.value<<=c.value:s===">>="?m.value>>=c.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}return void(n instanceof Fi&&n.setDataValue(this,m,l,r))}if(n instanceof Fi)n.setDataValue(this,c,l,r);else if(l){if(!(n instanceof Ie||n instanceof Mr))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(l instanceof My){const m=this.evalExpression(l.index,r).value;if(n instanceof Ie){if(!(c instanceof Ge))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[m]=c.value}else{if(!(n instanceof Mr))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const b=this.evalExpression(l.index,r).value;if(b<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(c instanceof Ie))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const w=n.typeInfo.getTypeName();if(w==="mat2x2"||w==="mat2x2f"||w==="mat2x2h"){if(!(b<2&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*b]=c.data[0],n.data[2*b+1]=c.data[1]}else if(w==="mat2x3"||w==="mat2x3f"||w==="mat2x3h"){if(!(b<2&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*b]=c.data[0],n.data[3*b+1]=c.data[1],n.data[3*b+2]=c.data[2]}else if(w==="mat2x4"||w==="mat2x4f"||w==="mat2x4h"){if(!(b<2&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*b]=c.data[0],n.data[4*b+1]=c.data[1],n.data[4*b+2]=c.data[2],n.data[4*b+3]=c.data[3]}else if(w==="mat3x2"||w==="mat3x2f"||w==="mat3x2h"){if(!(b<3&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*b]=c.data[0],n.data[2*b+1]=c.data[1]}else if(w==="mat3x3"||w==="mat3x3f"||w==="mat3x3h"){if(!(b<3&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*b]=c.data[0],n.data[3*b+1]=c.data[1],n.data[3*b+2]=c.data[2]}else if(w==="mat3x4"||w==="mat3x4f"||w==="mat3x4h"){if(!(b<3&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*b]=c.data[0],n.data[4*b+1]=c.data[1],n.data[4*b+2]=c.data[2],n.data[4*b+3]=c.data[3]}else if(w==="mat4x2"||w==="mat4x2f"||w==="mat4x2h"){if(!(b<4&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*b]=c.data[0],n.data[2*b+1]=c.data[1]}else if(w==="mat4x3"||w==="mat4x3f"||w==="mat4x3h"){if(!(b<4&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*b]=c.data[0],n.data[3*b+1]=c.data[1],n.data[3*b+2]=c.data[2]}else{if(w!=="mat4x4"&&w!=="mat4x4f"&&w!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(b<4&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*b]=c.data[0],n.data[4*b+1]=c.data[1],n.data[4*b+2]=c.data[2],n.data[4*b+3]=c.data[3]}}}}}else if(l instanceof pm){const m=l.value;if(!(n instanceof Ie))return void console.error(`Invalid assignment to ${m}. Variable ${i} is not a vector. Line ${e.line}`);if(c instanceof Ge){if(m.length>1)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);if(m==="x")n.data[0]=c.value;else if(m==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[1]=c.value}else if(m==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[2]=c.value}else if(m==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[3]=c.value}}else{if(!(c instanceof Ie))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(m.length!==c.data.length)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);for(let b=0;b<m.length;++b){const w=m[b];if(w==="x"||w==="r")n.data[0]=c.data[b];else if(w==="y"||w==="g"){if(c.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[1]=c.data[b]}else if(w==="z"||w==="b"){if(c.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[2]=c.data[b]}else{if(w!=="w"&&w!=="a")return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);if(c.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[3]=c.data[b]}}}}}else n instanceof Ge&&c instanceof Ge?n.value=c.value:n instanceof Ie&&c instanceof Ie||n instanceof Mr&&c instanceof Mr?n.data.set(c.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,r){const n=new gC(e);r.functions.set(e.name,n)}_const(e,r){let n=null;e.value!==null&&(n=this.evalExpression(e.value,r)),r.createVariable(e.name,n,e)}_let(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ts||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const l=new Eh(e.type,[]);n=this._evalCreate(l,r)}}r.createVariable(e.name,n,e)}_var(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ts||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof O0||e.type instanceof Hf||e.type instanceof rt){const l=new Eh(e.type,[]);n=this._evalCreate(l,r)}}r.createVariable(e.name,n,e)}_switch(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const l of e.cases)if(l instanceof Oz)for(const c of l.selectors){if(c instanceof R1){i=l;continue}const s=this.evalExpression(c,r);if(!(s instanceof Ge))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(l.body,r)}else l instanceof Dz&&(i=l);return i?this._execStatements(i.body,r):null}_if(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,r);for(const i of e.elseif){const l=this.evalExpression(i.condition,r);if(!(l instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;if(l.value)return this._execStatements(i.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof Ge?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ha._breakObj)break;if(n!==null&&n!==Ha._continueObj)return n;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){const n=this._execStatements(e.body,r);if(n===Ha._breakObj)break;if(n===Ha._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===Ha._breakObj)break}else if(n!==null)return n}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ha._breakObj)break;if(n!==Ha._continueObj&&n!==null)return n}return null}_evalBitcast(e,r){const n=this.evalExpression(e.value,r),i=e.type;if(n instanceof Ge){const l=VI(n.value,n.typeInfo.name,i.name);return new Ge(l,this.getTypeInfo(i))}if(n instanceof Ie){const l=n.typeInfo.getTypeName();let c="";if(l.endsWith("f"))c="f32";else if(l.endsWith("i"))c="i32";else if(l.endsWith("u"))c="u32";else if(l.endsWith("b"))c="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;c="f16"}const s=i.getTypeName();let m="";if(s.endsWith("f"))m="f32";else if(s.endsWith("i"))m="i32";else if(s.endsWith("u"))m="u32";else if(s.endsWith("b"))m="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${m}. Line ${e.line}`),null;m="f16"}const b=(function(w,E,O){if(E===O)return w;const N=new Array(w.length);for(let V=0;V<w.length;V++)N[V]=VI(w[V],E,O);return N})(Array.from(n.data),c,m);return new Ie(b,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var n;if(e instanceof Eh){if(e.type===null)return wE.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}const i=e instanceof Eh?e.type.name:e.name,l=e instanceof Eh?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(l===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(l.size===0)return null;const c=new Fi(new ArrayBuffer(l.size),l,0);if(l instanceof yp){if(e.args)for(let s=0;s<e.args.length;++s){const m=l.members[s],b=e.args[s],w=this.evalExpression(b,r);c.setData(this,w,m.type,m.offset,r)}}else if(l instanceof wp){let s=0;if(e.args)for(let m=0;m<e.args.length;++m){const b=e.args[m],w=this.evalExpression(b,r);l.format===null&&(((n=w.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?l.format=this.getTypeInfo("i32"):l.format=w.typeInfo),c.setData(this,w,l.format,s,r),s+=l.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Eh?c.getSubData(this,e.postfix,r):c}_evalLiteral(e,r){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new Ge(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){const n=r.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Ha._priority.get(r.name);Ha._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){const n=this.evalExpression(e.right,r);if(e.operator==="&")return new iy(n);if(e.operator==="*")return n instanceof iy?n.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof Ge?n.value:n instanceof Ie?Array.from(n.data):null;switch(e.operator){case"+":{if(Kt(i)){const s=i.map((m,b)=>+m);return new Ie(s,n.typeInfo)}const l=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(+l,c)}case"-":{if(Kt(i)){const s=i.map((m,b)=>-m);return new Ie(s,n.typeInfo)}const l=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(-l,c)}case"!":{if(Kt(i)){const s=i.map((m,b)=>m?0:1);return new Ie(s,n.typeInfo)}const l=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(l?0:1,c)}case"~":{if(Kt(i)){const s=i.map((m,b)=>~m);return new Ie(s,n.typeInfo)}const l=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(~l,c)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){const n=this.evalExpression(e.left,r),i=this.evalExpression(e.right,r),l=n instanceof Ge?n.value:n instanceof Ie||n instanceof Mr?Array.from(n.data):null,c=i instanceof Ge?i.value:i instanceof Ie||i instanceof Mr?Array.from(i.data):null;switch(e.operator){case"+":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N+E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O+w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w+O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s+m,b)}case"-":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N-E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O-w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w-O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s-m,b)}case"*":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(n instanceof Mr&&i instanceof Mr){const O=(function(j,Y,ce,re){if(po[Y.name]===void 0||po[re.name]===void 0)return null;const ue=po[Y.name][0],me=po[Y.name][1],ge=po[re.name][0];if(ue!==po[re.name][1])return null;const Ce=new Array(ge*me);for(let We=0;We<me;We++)for(let Xe=0;Xe<ge;Xe++){let Et=0;for(let gt=0;gt<ue;gt++)Et+=j[gt*me+We]*ce[Xe*ue+gt];Ce[We*ge+Xe]=Et}return Ce})(w,n.typeInfo,E,i.typeInfo);if(O===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const N=po[i.typeInfo.name][0],V=po[n.typeInfo.name][1],W=this.getTypeInfo(`mat${N}x${V}f`);return new Mr(O,W)}if(n instanceof Mr&&i instanceof Ie){const O=(function(N,V,W,j){if(po[V.name]===void 0||tS[j.name]===void 0)return null;const Y=po[V.name][0],ce=po[V.name][1];if(Y!==W.length)return null;const re=new Array(ce);for(let ue=0;ue<ce;ue++){let me=0;for(let ge=0;ge<Y;ge++)me+=N[ge*ce+ue]*W[ge];re[ue]=me}return re})(w,n.typeInfo,E,i.typeInfo);return O===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ie(O,i.typeInfo)}if(n instanceof Ie&&i instanceof Mr){const O=(function(N,V,W,j){if(tS[V.name]===void 0||po[j.name]===void 0)return null;const Y=po[j.name][0],ce=po[j.name][1];if(ce!==N.length)return null;const re=[];for(let ue=0;ue<Y;ue++){let me=0;for(let ge=0;ge<ce;ge++)me+=N[ge]*W[ge*Y+ue];re[ue]=me}return re})(w,n.typeInfo,E,i.typeInfo);return O===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ie(O,n.typeInfo)}{if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N*E[V]);return new Ie(O,n.typeInfo)}}if(Kt(l)){const w=c,E=l.map((O,N)=>O*w);return n instanceof Mr?new Mr(E,n.typeInfo):new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w*O);return i instanceof Mr?new Mr(E,i.typeInfo):new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s*m,b)}case"%":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N%E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O%w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w%O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s%m,b)}case"/":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N/E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O/w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w/O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s/m,b)}case"&":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N&E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O&w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w&O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s&m,b)}case"|":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N|E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O|w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w|O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s|m,b)}case"^":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N^E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O^w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w^O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s^m,b)}case"<<":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N<<E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O<<w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w<<O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s<<m,b)}case">>":{if(Kt(l)&&Kt(c)){const w=l,E=c;if(w.length!==E.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=w.map((N,V)=>N>>E[V]);return new Ie(O,n.typeInfo)}if(Kt(l)){const w=c,E=l.map((O,N)=>O>>w);return new Ie(E,n.typeInfo)}if(Kt(c)){const w=l,E=c.map((O,N)=>w>>O);return new Ie(E,i.typeInfo)}const s=l,m=c,b=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s>>m,b)}case">":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w>m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b>s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s>b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l>c?1:0,this.getTypeInfo("bool"));case"<":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w<m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b<s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s<b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l<c?1:0,this.getTypeInfo("bool"));case"==":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w===m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b==s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s==b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l===c?1:0,this.getTypeInfo("bool"));case"!=":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w!==m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b!==s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s!==b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l!==c?1:0,this.getTypeInfo("bool"));case">=":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w>=m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b>=s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s>=b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l>=c?1:0,this.getTypeInfo("bool"));case"<=":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w<=m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b<=s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s<=b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l<=c?1:0,this.getTypeInfo("bool"));case"&&":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w&&m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b&&s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s&&b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l&&c?1:0,this.getTypeInfo("bool"));case"||":if(Kt(l)&&Kt(c)){const s=l,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const b=s.map((w,E)=>w||m[E]?1:0);return new Ie(b,n.typeInfo)}if(Kt(l)){const s=c,m=l.map((b,w)=>b||s?1:0);return new Ie(m,n.typeInfo)}if(Kt(c)){const s=l,m=c.map((b,w)=>s||b?1:0);return new Ie(m,i.typeInfo)}return new Ge(l||c?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let l=0;l<i.node.args.length;++l){const c=i.node.args[l],s=this.evalExpression(e.args[l],n);n.createVariable(c.name,s,c)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothstep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}const n=r.getFunction(e.name);if(n){const i=r.clone();for(let l=0;l<n.node.args.length;++l){const c=n.node.args[l],s=this.evalExpression(e.args[l],i);i.setVariable(c.name,s,c)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new Ge(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],r);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),l=tS[i];if(l===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof gs)if(e.isVector){const s=e.vectorValue;for(const m of s)c.push(m)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const m=this.evalExpression(s,r);if(m instanceof Ie){const b=m.data;for(let w=0;w<b.length;++w){let E=b[w];c.push(E)}}else if(m instanceof Ge){let b=m.value;c.push(b)}}if(e.type instanceof rt&&e.type.format===null&&(e.type.format=rt.f32),c.length===0){const s=new Array(l).fill(0);return new Ie(s,n).getSubData(this,e.postfix,r)}if(c.length===1)for(;c.length<l;)c.push(c[0]);return c.length<l?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ie(c.length>l?c.slice(0,l):c,n).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),l=po[i];if(l===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof gs)if(e.isVector){const s=e.vectorValue;for(const m of s)c.push(m)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const m=this.evalExpression(s,r);m instanceof Ie?c.push(...m.data):m instanceof Ge?c.push(m.value):m instanceof Mr&&c.push(...m.data)}if(n instanceof dm&&n.format===null&&(n.format=this.getTypeInfo("f32")),c.length===0){const s=new Array(l[2]).fill(0);return new Mr(s,n).getSubData(this,e.postfix,r)}return c.length!==l[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Mr(c,n).getSubData(this,e.postfix,r)}}Ha._breakObj=new bc(new _c("BREAK",null),null),Ha._continueObj=new bc(new _c("CONTINUE",null),null),Ha._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class d9{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class p9{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new d9,this._exec=new Ha,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,l=n.countNode;if(l instanceof Sl){const c=l.name,s=this._context.constants.get(c);if(s)try{const m=s.constEvaluate(this._exec);i.count=m}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of r)n.search(i=>{i instanceof jI||i instanceof I1?i.type=this._forwardType(i.type):i instanceof O0?i.format=this._forwardType(i.format):i instanceof Gf||i instanceof R0||i instanceof M1?i.type=this._forwardType(i.type):i instanceof U0?i.returnType=this._forwardType(i.returnType):i instanceof FI&&(i.type=this._forwardType(i.type))});return r}_forwardType(e){if(e instanceof BI){const r=this._getType(e.name);if(r)return r}else e instanceof I1?e.type=this._forwardType(e.type):e instanceof O0&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const r=new n9(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==we.eof}_match(e){if(e instanceof Ke)return!!this._check(e)&&(this._advance(),!0);for(let r=0,n=e.length;r<n;++r){const i=e[r];if(this._check(i))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;let i=!1;for(const l of e){if(n===l)return!0;l===we.tokens.name&&(i=!0)}if(i){const l=we.tokens.name.rule.exec(r.lexeme);if(l&&l.index==0&&l[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===we.tokens.name){const n=we.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(we.tokens.semicolon)&&!this._isAtEnd(););if(this._match(we.keywords.alias)){const r=this._type_alias();return this._consume(we.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(we.keywords.diagnostic)){const r=this._diagnostic();return this._consume(we.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(we.keywords.requires)){const r=this._requires_directive();return this._consume(we.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(we.keywords.enable)){const r=this._enable_directive();return this._consume(we.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}const e=this._attribute();if(this._check(we.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(we.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(we.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(we.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(we.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(we.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(we.keywords.fn))return null;const e=this._currentLine,r=this._consume(we.tokens.ident,"Expected function name.").toString();this._consume(we.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(we.tokens.paren_right))do{if(this._check(we.tokens.paren_right))break;const s=this._attribute(),m=this._consume(we.tokens.name,"Expected argument name.").toString();this._consume(we.tokens.colon,"Expected ':' for argument type.");const b=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=b,n.push(this._updateNode(new FI(m,w,s))))}while(this._match(we.tokens.comma));this._consume(we.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(we.tokens.arrow)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}const l=this._compound_statement(),c=this._currentLine;return this._updateNode(new U0(r,n,i,l,e,c),e)}_compound_statement(){const e=[];for(this._consume(we.tokens.brace_left,"Expected '{' for block.");!this._check(we.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(we.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(we.tokens.semicolon)&&!this._isAtEnd(););if(this._check(we.tokens.attr)&&this._attribute(),this._check(we.keywords.if))return this._if_statement();if(this._check(we.keywords.switch))return this._switch_statement();if(this._check(we.keywords.loop))return this._loop_statement();if(this._check(we.keywords.for))return this._for_statement();if(this._check(we.keywords.while))return this._while_statement();if(this._check(we.keywords.continuing))return this._continuing_statement();if(this._check(we.keywords.static_assert))return this._static_assert_statement();if(this._check(we.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(we.keywords.return))e=this._return_statement();else if(this._check([we.keywords.var,we.keywords.let,we.keywords.const]))e=this._variable_statement();else if(this._match(we.keywords.discard))e=this._updateNode(new e9);else if(this._match(we.keywords.break)){const r=this._updateNode(new Ez);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r,this._check(we.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(we.keywords.continue)){const r=this._updateNode(new Pz);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(we.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(we.keywords.static_assert))return null;const e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new KW(r),e)}_while_statement(){if(!this._match(we.keywords.while))return null;const e=this._updateNode(new _z(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(we.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(we.keywords.continuing))return null;const r=this._currentLine,n=this._compound_statement();return this._updateNode(new xE(n,e),r)}_for_statement(){if(!this._match(we.keywords.for))return null;this._consume(we.tokens.paren_left,"Expected '('.");const e=this._updateNode(new yz(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(we.tokens.semicolon)?null:this._for_init(),this._consume(we.tokens.semicolon,"Expected ';'."),e.condition=this._check(we.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(we.tokens.semicolon,"Expected ';'."),e.increment=this._check(we.tokens.paren_right)?null:this._for_increment(),this._consume(we.tokens.paren_right,"Expected ')'."),this._check(we.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(we.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(we.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Gf(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(we.keywords.let)){const e=this._currentLine,r=this._consume(we.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(we.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(we.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new R0(r,n,null,null,i),e)}if(this._match(we.keywords.const)){const e=this._currentLine,r=this._consume(we.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(we.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(we.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof gs&&(n=i.type),this._updateNode(new M1(r,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(we.increment_operators))return this._current=e,null;const n=this._consume(we.increment_operators,"Expected increment operator");return this._updateNode(new vz(n.type===we.tokens.plus_plus?dy.increment:dy.decrement,r))}_assignment_statement(){let e=null;const r=this._currentLine;if(this._check(we.tokens.brace_right))return null;let n=this._match(we.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(we.assignment_operators,"Expected assignment operator."),l=this._short_circuit_or_expression();return this._updateNode(new bz(b0.parse(i.lexeme),e,l),r)}_func_call_statement(){if(!this._check(we.tokens.ident))return null;const e=this._currentLine,r=this._current,n=this._consume(we.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new uC(n.lexeme,i),e)}_loop_statement(){if(!this._match(we.keywords.loop))return null;this._check(we.tokens.attr)&&this._attribute(),this._consume(we.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new xz([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.body.push(n);else e.body.push(r);if(r instanceof xE){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(we.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(we.keywords.switch))return null;const e=this._updateNode(new wz(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(we.tokens.attr)&&this._attribute(),this._consume(we.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(we.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let r=!1;for(;this._check([we.keywords.default,we.keywords.case]);){if(this._match(we.keywords.case)){const n=this._case_selectors();for(const l of n)if(l instanceof R1){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(we.tokens.colon),this._check(we.tokens.attr)&&this._attribute(),this._consume(we.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(we.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Oz(n,i)))}if(this._match(we.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(we.tokens.colon),this._check(we.tokens.attr)&&this._attribute(),this._consume(we.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(we.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Dz(n)))}}return e}_case_selectors(){const e=[];for(this._match(we.keywords.default)?e.push(this._updateNode(new R1)):e.push(this._shift_expression());this._match(we.tokens.comma);)this._match(we.keywords.default)?e.push(this._updateNode(new R1)):e.push(this._shift_expression());return e}_case_body(){if(this._match(we.keywords.fallthrough))return this._consume(we.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(we.keywords.if))return null;const e=this._currentLine,r=this._optional_paren_expression();this._check(we.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(we.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let l=null;return this._match(we.keywords.else)&&(this._check(we.tokens.attr)&&this._attribute(),l=this._compound_statement()),this._updateNode(new Tz(r,n,i,l),e)}_match_elseif(){return this._tokens[this._current].type===we.keywords.else&&this._tokens[this._current+1].type===we.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new t9(r,n))),this._match_elseif()&&(this._check(we.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(we.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Sz(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(we.tokens.or_or);)e=this._updateNode(new vu(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(we.tokens.and_and);)e=this._updateNode(new vu(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(we.tokens.or);)e=this._updateNode(new vu(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(we.tokens.xor);)e=this._updateNode(new vu(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(we.tokens.and);)e=this._updateNode(new vu(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([we.tokens.equal_equal,we.tokens.not_equal])?this._updateNode(new vu(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([we.tokens.less_than,we.tokens.greater_than,we.tokens.less_than_equal,we.tokens.greater_than_equal]);)e=this._updateNode(new vu(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([we.tokens.shift_left,we.tokens.shift_right]);)e=this._updateNode(new vu(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([we.tokens.plus,we.tokens.minus]);)e=this._updateNode(new vu(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([we.tokens.star,we.tokens.forward_slash,we.tokens.modulo]);)e=this._updateNode(new vu(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([we.tokens.minus,we.tokens.bang,we.tokens.tilde,we.tokens.star,we.tokens.and])?this._updateNode(new ts(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(we.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(we.tokens.bracket_right,"Expected ']'.");const r=this._updateNode(new My(e)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(we.tokens.period)){const e=this._consume(we.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new pm(e.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Lt.void;case"bool":return Lt.bool;case"i32":return Lt.i32;case"u32":return Lt.u32;case"f32":return Lt.f32;case"f16":return Lt.f16;case"vec2f":return rt.vec2f;case"vec3f":return rt.vec3f;case"vec4f":return rt.vec4f;case"vec2i":return rt.vec2i;case"vec3i":return rt.vec3i;case"vec4i":return rt.vec4i;case"vec2u":return rt.vec2u;case"vec3u":return rt.vec3u;case"vec4u":return rt.vec4u;case"vec2h":return rt.vec2h;case"vec3h":return rt.vec3h;case"vec4h":return rt.vec4h;case"mat2x2f":return rt.mat2x2f;case"mat2x3f":return rt.mat2x3f;case"mat2x4f":return rt.mat2x4f;case"mat3x2f":return rt.mat3x2f;case"mat3x3f":return rt.mat3x3f;case"mat3x4f":return rt.mat3x4f;case"mat4x2f":return rt.mat4x2f;case"mat4x3f":return rt.mat4x3f;case"mat4x4f":return rt.mat4x4f;case"mat2x2h":return rt.mat2x2h;case"mat2x3h":return rt.mat2x3h;case"mat2x4h":return rt.mat2x4h;case"mat3x2h":return rt.mat3x2h;case"mat3x3h":return rt.mat3x3h;case"mat3x4h":return rt.mat3x4h;case"mat4x2h":return rt.mat4x2h;case"mat4x3h":return rt.mat4x3h;case"mat4x4h":return rt.mat4x4h;case"mat2x2i":return rt.mat2x2i;case"mat2x3i":return rt.mat2x3i;case"mat2x4i":return rt.mat2x4i;case"mat3x2i":return rt.mat3x2i;case"mat3x3i":return rt.mat3x3i;case"mat3x4i":return rt.mat3x4i;case"mat4x2i":return rt.mat4x2i;case"mat4x3i":return rt.mat4x3i;case"mat4x4i":return rt.mat4x4i;case"mat2x2u":return rt.mat2x2u;case"mat2x3u":return rt.mat2x3u;case"mat2x4u":return rt.mat2x4u;case"mat3x2u":return rt.mat3x2u;case"mat3x3u":return rt.mat3x3u;case"mat3x4u":return rt.mat3x4u;case"mat4x2u":return rt.mat4x2u;case"mat4x3u":return rt.mat4x3u;case"mat4x4u":return rt.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(we.tokens.ident)){const n=this._previous().toString();if(this._check(we.tokens.paren_left)){const i=this._argument_expression_list(),l=this._getType(n);return l!==null?this._updateNode(new Eh(l,i)):this._updateNode(new fC(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new Cz(n,i.value))}return this._updateNode(new Sl(n))}if(this._match(we.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Lt.i32:n.endsWith("u")||n.endsWith("U")?Lt.u32:Lt.x32;const l=parseInt(n);return this._validateTypeRange(l,i),this._updateNode(new gs(new Ge(l,this._exec.getTypeInfo(i)),i))}if(this._match(we.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Lt.u32),this._updateNode(new gs(new Ge(n,this._exec.getTypeInfo(Lt.u32)),Lt.u32))}if(this._match([we.tokens.decimal_float_literal,we.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const l=parseFloat(n);this._validateTypeRange(l,i?Lt.f16:Lt.f32);const c=i?Lt.f16:Lt.f32;return this._updateNode(new gs(new Ge(l,this._exec.getTypeInfo(c)),c))}if(this._match([we.keywords.true,we.keywords.false])){let n=this._previous().toString()===we.keywords.true.rule;return this._updateNode(new gs(new Ge(n?1:0,this._exec.getTypeInfo(Lt.bool)),Lt.bool))}if(this._check(we.tokens.paren_left))return this._paren_expression();if(this._match(we.keywords.bitcast)){this._consume(we.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(we.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new Mz(n,i))}const e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new Eh(e,r))}_argument_expression_list(){if(!this._match(we.tokens.paren_left))return null;const e=[];do{if(this._check(we.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(we.tokens.comma));return this._consume(we.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(we.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(we.tokens.paren_right),e}_paren_expression(){this._consume(we.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(we.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(we.keywords.struct))return null;const e=this._currentLine,r=this._consume(we.tokens.ident,"Expected name for struct.").toString();this._consume(we.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(we.tokens.brace_right);){const c=this._attribute(),s=this._consume(we.tokens.name,"Expected variable name.").toString();this._consume(we.tokens.colon,"Expected ':' for struct member type.");const m=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=m),this._check(we.tokens.brace_right)?this._match(we.tokens.comma):this._consume(we.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new jI(s,b,c)))}this._consume(we.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,l=this._updateNode(new Hf(r,n,e,i),e);return this._context.structs.set(r,l),l}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(we.tokens.equal)){const r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof gs){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof gs&&(e.type=e.value.type.name==="x32"?Lt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(we.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(we.keywords.const))return null;const r=this._consume(we.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(we.tokens.colon)){const m=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=m)}let l=null;this._consume(we.tokens.equal,"const declarations require an assignment");const c=this._short_circuit_or_expression();try{let m=[Lt.f32],b=c.constEvaluate(this._exec,m);b instanceof Ge&&this._validateTypeRange(b.value,m[0]),m[0]instanceof rt&&m[0].format===null&&b.typeInfo instanceof dm&&b.typeInfo.format!==null&&(b.typeInfo.format.name==="f16"?m[0].format=Lt.f16:b.typeInfo.format.name==="f32"?m[0].format=Lt.f32:b.typeInfo.format.name==="i32"?m[0].format=Lt.i32:b.typeInfo.format.name==="u32"?m[0].format=Lt.u32:b.typeInfo.format.name==="bool"?m[0].format=Lt.bool:console.error(`TODO: impelement template format type ${b.typeInfo.format.name}`)),l=this._updateNode(new gs(b,m[0])),this._exec.context.setVariable(r.toString(),b)}catch{l=c}if(i!==null&&l instanceof gs){if(l.type.name!=="x32"&&i.getTypeName()!==l.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${l.type.name} to ${i.name}. Line:${this._currentLine}`);l.type=i,l.isScalar&&this._validateTypeRange(l.scalarValue,l.type)}else i===null&&l instanceof gs&&(i=(e=l?.type)!==null&&e!==void 0?e:Lt.f32,i===Lt.x32&&(i=Lt.i32));const s=this._updateNode(new M1(r.toString(),i,"","",l),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(we.keywords.let))return null;const e=this._currentLine,r=this._consume(we.tokens.name,"Expected variable name");let n=null;if(this._match(we.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}let i=null;if(this._match(we.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof gs){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof gs&&(n=i.type.name==="x32"?Lt.i32:i.type);return i instanceof gs&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new R0(r.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(we.keywords.var))return null;const e=this._currentLine;let r="",n="";this._match(we.tokens.less_than)&&(r=this._consume(we.storage_class,"Expected storage_class.").toString(),this._match(we.tokens.comma)&&(n=this._consume(we.access_mode,"Expected access_mode.").toString()),this._consume(we.tokens.greater_than,"Expected '>'."));const i=this._consume(we.tokens.name,"Expected variable name");let l=null;if(this._match(we.tokens.colon)){const c=this._attribute();l=this._type_decl(),l!=null&&(l.attributes=c)}return this._updateNode(new Gf(i.toString(),l,r,n,null),e)}_override_decl(){if(!this._match(we.keywords.override))return null;const e=this._consume(we.tokens.name,"Expected variable name");let r=null;if(this._match(we.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new cC(e.toString(),r,null))}_diagnostic(){this._consume(we.tokens.paren_left,"Expected '('");const e=this._consume(we.tokens.ident,"Expected severity control name.");this._consume(we.tokens.comma,"Expected ','");let r=this._consume(we.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(we.tokens.period)&&(r+=`.${this._consume(we.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(we.tokens.paren_right,"Expected ')'"),this._updateNode(new Az(e.toString(),r))}_enable_directive(){const e=this._consume(we.tokens.ident,"identity expected.");return this._updateNode(new QW(e.toString()))}_requires_directive(){const e=[this._consume(we.tokens.ident,"identity expected.").toString()];for(;this._match(we.tokens.comma);){const r=this._consume(we.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new JW(e))}_type_alias(){const e=this._consume(we.tokens.ident,"identity expected.");this._consume(we.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=this._updateNode(new hC(e.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([we.tokens.ident,...we.texel_format,we.keywords.bool,we.keywords.f32,we.keywords.i32,we.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new BI(n));return this._forwardTypeCount++,i}return this._updateNode(new Lt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(we.template_types)){let n=this._advance().toString(),i=null,l=null;return this._match(we.tokens.less_than)&&(i=this._type_decl(),l=null,this._match(we.tokens.comma)&&(l=this._consume(we.access_mode,"Expected access_mode for pointer").toString()),this._consume(we.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new rt(n,i,l))}if(this._match(we.keywords.ptr)){let n=this._previous().toString();this._consume(we.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(we.storage_class,"Expected storage_class for pointer");this._consume(we.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let c=null;return this._match(we.tokens.comma)&&(c=this._consume(we.access_mode,"Expected access_mode for pointer").toString()),this._consume(we.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new I1(n,i.toString(),l,c))}const r=this._attribute();if(this._match(we.keywords.array)){let n=null,i=-1;const l=this._previous();let c=null;if(this._match(we.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let m="";if(this._match(we.tokens.comma)){c=this._shift_expression();try{m=c.constEvaluate(this._exec).toString(),c=null}catch{m="1"}}this._consume(we.tokens.greater_than,"Expected '>' for array."),i=m?parseInt(m):0}const s=this._updateNode(new O0(l.toString(),r,n,i));return c&&this._deferArrayCountEval.push({arrayType:s,countNode:c}),s}return null}_texture_sampler_types(){if(this._match(we.sampler_type))return this._updateNode(new x0(this._previous().toString(),null,null));if(this._match(we.depth_texture_type))return this._updateNode(new x0(this._previous().toString(),null,null));if(this._match(we.sampled_texture_type)||this._match(we.multisampled_texture_type)){const e=this._previous();this._consume(we.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(we.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new x0(e.toString(),r,null))}if(this._match(we.storage_texture_type)){const e=this._previous();this._consume(we.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(we.texel_format,"Invalid texel format.").toString();this._consume(we.tokens.comma,"Expected ',' after texel format.");const n=this._consume(we.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(we.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new x0(e.toString(),r,n))}return null}_attribute(){let e=[];for(;this._match(we.tokens.attr);){const r=this._consume(we.attribute_name,"Expected attribute name"),n=this._updateNode(new kz(r.toString(),null));if(this._match(we.tokens.paren_left)){if(n.value=this._consume(we.literal_or_ident,"Expected attribute value").toString(),this._check(we.tokens.comma)){this._advance();do{const i=this._consume(we.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(we.tokens.comma))}this._consume(we.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class g9 extends Mh{constructor(e){super(),e&&this.update(e)}update(e){const r=new p9().parse(e);this.updateAST(r)}}function m9(t){const e={attributes:[],bindings:[]};let r;try{r=_9(t)}catch(l){return Bt.error(l.message)(),e}for(const l of r.uniforms){const c=[];for(const s of l.type?.members||[])c.push({name:s.name,type:$I(s.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:c})}for(const l of r.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of r.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const n=r.entry.vertex[0],i=n?.inputs.length||0;for(let l=0;l<i;l++){const c=n.inputs[l];if(c.locationType==="location"){const s=$I(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:s})}}return e}function $I(t){return t?.format?`${t.name}<${t.format.name}>`:t.name}function _9(t){try{return new g9(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const y9={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...y9}};const yc=globalThis.mathgl.config;function v9(t,{precision:e=yc.precision}={}){return t=b9(t),`${parseFloat(t.toPrecision(e))}`}function Iy(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ih(t,e,r){return w9(t,n=>Math.max(e,Math.min(r,n)))}function cw(t,e,r){return Iy(t)?t.map((n,i)=>cw(n,e[i],r)):r*e+(1-r)*t}function V0(t,e,r){const n=yc.EPSILON;try{if(t===e)return!0;if(Iy(t)&&Iy(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!V0(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=yc.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{yc.EPSILON=n}}function b9(t){return Math.round(t/yc.EPSILON)*yc.EPSILON}function x9(t){return t.clone?t.clone():new Array(t.length)}function w9(t,e,r){if(Iy(t)){const n=t;r=r||x9(n);for(let i=0;i<r.length&&i<n.length;++i){const l=typeof t=="number"?t:t[i];r[i]=e(l,i,r)}return r}return e(t)}class Lz extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Iy(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(yc)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+v9(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!V0(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let i=0;i<this.ELEMENTS;++i){const l=e[i],c=typeof r=="number"?r:r[i];this[i]=l+n*(c-l)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(yc.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function T9(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function Tl(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function rS(t,e,r=""){if(yc.debug&&!T9(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function WI(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class S9 extends Lz{get x(){return this[0]}set x(e){this[0]=Tl(e)}get y(){return this[1]}set y(e){this[1]=Tl(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];r+=i*i}return Tl(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return Tl(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return WI(e>=0&&e<this.ELEMENTS,"index is out of range"),Tl(this[e])}setComponent(e,r){return WI(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const O1=1e-6;let Ry=typeof Float32Array<"u"?Float32Array:Array;function A9(){const t=new Ry(2);return Ry!=Float32Array&&(t[0]=0,t[1]=0),t}function HI(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function E9(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Nz(t,e,r,n){const i=e[0],l=e[1];return t[0]=i+n*(r[0]-i),t[1]=l+n*(r[1]-l),t}function P9(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(function(){const t=A9();return function(e,r,n,i,l,c){let s,m;for(r||(r=2),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],l(t,t,c),e[s]=t[0],e[s+1]=t[1];return e}})();function C9(t,e,r){const n=e[0],i=e[1],l=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/l,t[1]=(r[1]*n+r[5]*i)/l,t}function zz(t,e,r){const n=e[0],i=e[1],l=e[2],c=r[3]*n+r[7]*i+r[11]*l||1;return t[0]=(r[0]*n+r[4]*i+r[8]*l)/c,t[1]=(r[1]*n+r[5]*i+r[9]*l)/c,t[2]=(r[2]*n+r[6]*i+r[10]*l)/c,t}function M9(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function I9(){const t=new Ry(3);return Ry!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function R9(t){const e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function O9(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function D9(t){const e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function k9(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function L9(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function N9(t,e,r){const n=e[0],i=e[1],l=e[2],c=r[0],s=r[1],m=r[2];return t[0]=i*m-l*s,t[1]=l*c-n*m,t[2]=n*s-i*c,t}function z9(t,e,r,n){const i=e[0],l=e[1],c=e[2];return t[0]=i+n*(r[0]-i),t[1]=l+n*(r[1]-l),t[2]=c+n*(r[2]-c),t}function Bz(t,e,r){const n=e[0],i=e[1],l=e[2];let c=r[3]*n+r[7]*i+r[11]*l+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*i+r[8]*l+r[12])/c,t[1]=(r[1]*n+r[5]*i+r[9]*l+r[13])/c,t[2]=(r[2]*n+r[6]*i+r[10]*l+r[14])/c,t}function B9(t,e,r){const n=e[0],i=e[1],l=e[2];return t[0]=n*r[0]+i*r[3]+l*r[6],t[1]=n*r[1]+i*r[4]+l*r[7],t[2]=n*r[2]+i*r[5]+l*r[8],t}function F9(t,e,r){const n=r[0],i=r[1],l=r[2],c=r[3],s=e[0],m=e[1],b=e[2];let w=i*b-l*m,E=l*s-n*b,O=n*m-i*s,N=i*O-l*E,V=l*w-n*O,W=n*E-i*w;const j=c*2;return w*=j,E*=j,O*=j,N*=2,V*=2,W*=2,t[0]=s+w+N,t[1]=m+E+V,t[2]=b+O+W,t}function j9(t,e,r,n){const i=[],l=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],l[0]=i[0],l[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),l[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function U9(t,e,r,n){const i=[],l=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],l[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),l[1]=i[1],l[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function V9(t,e,r,n){const i=[],l=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],l[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),l[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),l[2]=i[2],t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function $9(t,e){const r=t[0],n=t[1],i=t[2],l=e[0],c=e[1],s=e[2],m=Math.sqrt((r*r+n*n+i*i)*(l*l+c*c+s*s)),b=m&&L9(t,e)/m;return Math.acos(Math.min(Math.max(b,-1),1))}const Fz=O9,W9=R9,nS=D9;(function(){const t=I9();return function(e,r,n,i,l,c){let s,m;for(r||(r=3),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],l(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();const iS=[0,0,0];let Yx;class Lh extends S9{static get ZERO(){return Yx||(Yx=new Lh(0,0,0),Object.freeze(Yx)),Yx}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Iy(e)?this.copy(e):(yc.debug&&(Tl(e),Tl(r),Tl(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return yc.debug&&(Tl(e.x),Tl(e.y),Tl(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Tl(e)}angle(e){return $9(this,e)}cross(e){return N9(this,this,e),this.check()}rotateX({radians:e,origin:r=iS}){return j9(this,this,r,e),this.check()}rotateY({radians:e,origin:r=iS}){return U9(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=iS}){return V9(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Bz(this,this,e),this.check()}transformAsVector(e){return zz(this,this,e),this.check()}transformByMatrix3(e){return B9(this,this,e),this.check()}transformByMatrix2(e){return M9(this,this,e),this.check()}transformByQuaternion(e){return F9(this,this,e),this.check()}}class H9 extends Lz{toString(){let e="[";if(yc.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=Tl(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(e,r){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}}function q9(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function X9(t,e){if(t===e){const r=e[1],n=e[2],i=e[3],l=e[6],c=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=l,t[11]=e[14],t[12]=i,t[13]=c,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function TE(t,e){const r=e[0],n=e[1],i=e[2],l=e[3],c=e[4],s=e[5],m=e[6],b=e[7],w=e[8],E=e[9],O=e[10],N=e[11],V=e[12],W=e[13],j=e[14],Y=e[15],ce=r*s-n*c,re=r*m-i*c,ue=r*b-l*c,me=n*m-i*s,ge=n*b-l*s,Ce=i*b-l*m,We=w*W-E*V,Xe=w*j-O*V,Et=w*Y-N*V,gt=E*j-O*W,Ye=E*Y-N*W,jt=O*Y-N*j;let St=ce*jt-re*Ye+ue*gt+me*Et-ge*Xe+Ce*We;return St?(St=1/St,t[0]=(s*jt-m*Ye+b*gt)*St,t[1]=(i*Ye-n*jt-l*gt)*St,t[2]=(W*Ce-j*ge+Y*me)*St,t[3]=(O*ge-E*Ce-N*me)*St,t[4]=(m*Et-c*jt-b*Xe)*St,t[5]=(r*jt-i*Et+l*Xe)*St,t[6]=(j*ue-V*Ce-Y*re)*St,t[7]=(w*Ce-O*ue+N*re)*St,t[8]=(c*Ye-s*Et+b*We)*St,t[9]=(n*Et-r*Ye-l*We)*St,t[10]=(V*ge-W*ue+Y*ce)*St,t[11]=(E*ue-w*ge-N*ce)*St,t[12]=(s*Xe-c*gt-m*We)*St,t[13]=(r*gt-n*Xe+i*We)*St,t[14]=(W*re-V*me-j*ce)*St,t[15]=(w*me-E*re+O*ce)*St,t):null}function G9(t){const e=t[0],r=t[1],n=t[2],i=t[3],l=t[4],c=t[5],s=t[6],m=t[7],b=t[8],w=t[9],E=t[10],O=t[11],N=t[12],V=t[13],W=t[14],j=t[15],Y=e*c-r*l,ce=e*s-n*l,re=r*s-n*c,ue=b*V-w*N,me=b*W-E*N,ge=w*W-E*V,Ce=e*ge-r*me+n*ue,We=l*ge-c*me+s*ue,Xe=b*re-w*ce+E*Y,Et=N*re-V*ce+W*Y;return m*Ce-i*We+j*Xe-O*Et}function im(t,e,r){const n=e[0],i=e[1],l=e[2],c=e[3],s=e[4],m=e[5],b=e[6],w=e[7],E=e[8],O=e[9],N=e[10],V=e[11],W=e[12],j=e[13],Y=e[14],ce=e[15];let re=r[0],ue=r[1],me=r[2],ge=r[3];return t[0]=re*n+ue*s+me*E+ge*W,t[1]=re*i+ue*m+me*O+ge*j,t[2]=re*l+ue*b+me*N+ge*Y,t[3]=re*c+ue*w+me*V+ge*ce,re=r[4],ue=r[5],me=r[6],ge=r[7],t[4]=re*n+ue*s+me*E+ge*W,t[5]=re*i+ue*m+me*O+ge*j,t[6]=re*l+ue*b+me*N+ge*Y,t[7]=re*c+ue*w+me*V+ge*ce,re=r[8],ue=r[9],me=r[10],ge=r[11],t[8]=re*n+ue*s+me*E+ge*W,t[9]=re*i+ue*m+me*O+ge*j,t[10]=re*l+ue*b+me*N+ge*Y,t[11]=re*c+ue*w+me*V+ge*ce,re=r[12],ue=r[13],me=r[14],ge=r[15],t[12]=re*n+ue*s+me*E+ge*W,t[13]=re*i+ue*m+me*O+ge*j,t[14]=re*l+ue*b+me*N+ge*Y,t[15]=re*c+ue*w+me*V+ge*ce,t}function uw(t,e,r){const n=r[0],i=r[1],l=r[2];let c,s,m,b,w,E,O,N,V,W,j,Y;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*l+e[12],t[13]=e[1]*n+e[5]*i+e[9]*l+e[13],t[14]=e[2]*n+e[6]*i+e[10]*l+e[14],t[15]=e[3]*n+e[7]*i+e[11]*l+e[15]):(c=e[0],s=e[1],m=e[2],b=e[3],w=e[4],E=e[5],O=e[6],N=e[7],V=e[8],W=e[9],j=e[10],Y=e[11],t[0]=c,t[1]=s,t[2]=m,t[3]=b,t[4]=w,t[5]=E,t[6]=O,t[7]=N,t[8]=V,t[9]=W,t[10]=j,t[11]=Y,t[12]=c*n+w*i+V*l+e[12],t[13]=s*n+E*i+W*l+e[13],t[14]=m*n+O*i+j*l+e[14],t[15]=b*n+N*i+Y*l+e[15]),t}function _C(t,e,r){const n=r[0],i=r[1],l=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Z9(t,e,r,n){let i=n[0],l=n[1],c=n[2],s=Math.sqrt(i*i+l*l+c*c),m,b,w,E,O,N,V,W,j,Y,ce,re,ue,me,ge,Ce,We,Xe,Et,gt,Ye,jt,St,Zt;return s<O1?null:(s=1/s,i*=s,l*=s,c*=s,b=Math.sin(r),m=Math.cos(r),w=1-m,E=e[0],O=e[1],N=e[2],V=e[3],W=e[4],j=e[5],Y=e[6],ce=e[7],re=e[8],ue=e[9],me=e[10],ge=e[11],Ce=i*i*w+m,We=l*i*w+c*b,Xe=c*i*w-l*b,Et=i*l*w-c*b,gt=l*l*w+m,Ye=c*l*w+i*b,jt=i*c*w+l*b,St=l*c*w-i*b,Zt=c*c*w+m,t[0]=E*Ce+W*We+re*Xe,t[1]=O*Ce+j*We+ue*Xe,t[2]=N*Ce+Y*We+me*Xe,t[3]=V*Ce+ce*We+ge*Xe,t[4]=E*Et+W*gt+re*Ye,t[5]=O*Et+j*gt+ue*Ye,t[6]=N*Et+Y*gt+me*Ye,t[7]=V*Et+ce*gt+ge*Ye,t[8]=E*jt+W*St+re*Zt,t[9]=O*jt+j*St+ue*Zt,t[10]=N*jt+Y*St+me*Zt,t[11]=V*jt+ce*St+ge*Zt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function jz(t,e,r){const n=Math.sin(r),i=Math.cos(r),l=e[4],c=e[5],s=e[6],m=e[7],b=e[8],w=e[9],E=e[10],O=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*i+b*n,t[5]=c*i+w*n,t[6]=s*i+E*n,t[7]=m*i+O*n,t[8]=b*i-l*n,t[9]=w*i-c*n,t[10]=E*i-s*n,t[11]=O*i-m*n,t}function Y9(t,e,r){const n=Math.sin(r),i=Math.cos(r),l=e[0],c=e[1],s=e[2],m=e[3],b=e[8],w=e[9],E=e[10],O=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*i-b*n,t[1]=c*i-w*n,t[2]=s*i-E*n,t[3]=m*i-O*n,t[8]=l*n+b*i,t[9]=c*n+w*i,t[10]=s*n+E*i,t[11]=m*n+O*i,t}function Uz(t,e,r){const n=Math.sin(r),i=Math.cos(r),l=e[0],c=e[1],s=e[2],m=e[3],b=e[4],w=e[5],E=e[6],O=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*i+b*n,t[1]=c*i+w*n,t[2]=s*i+E*n,t[3]=m*i+O*n,t[4]=b*i-l*n,t[5]=w*i-c*n,t[6]=E*i-s*n,t[7]=O*i-m*n,t}function K9(t,e){const r=e[0],n=e[1],i=e[2],l=e[3],c=r+r,s=n+n,m=i+i,b=r*c,w=n*c,E=n*s,O=i*c,N=i*s,V=i*m,W=l*c,j=l*s,Y=l*m;return t[0]=1-E-V,t[1]=w+Y,t[2]=O-j,t[3]=0,t[4]=w-Y,t[5]=1-b-V,t[6]=N+W,t[7]=0,t[8]=O+j,t[9]=N-W,t[10]=1-b-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q9(t,e,r,n,i,l,c){const s=1/(r-e),m=1/(i-n),b=1/(l-c);return t[0]=l*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l*2*m,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*m,t[10]=(c+l)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*l*2*b,t[15]=0,t}function J9(t,e,r,n,i){const l=1/Math.tan(e/2);if(t[0]=l/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const c=1/(n-i);t[10]=(i+n)*c,t[14]=2*i*n*c}else t[10]=-1,t[14]=-2*n;return t}const eH=J9;function tH(t,e,r,n,i,l,c){const s=1/(e-r),m=1/(n-i),b=1/(l-c);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*m,t[14]=(c+l)*b,t[15]=1,t}const rH=tH;function nH(t,e,r,n){let i,l,c,s,m,b,w,E,O,N;const V=e[0],W=e[1],j=e[2],Y=n[0],ce=n[1],re=n[2],ue=r[0],me=r[1],ge=r[2];return Math.abs(V-ue)<O1&&Math.abs(W-me)<O1&&Math.abs(j-ge)<O1?q9(t):(E=V-ue,O=W-me,N=j-ge,i=1/Math.sqrt(E*E+O*O+N*N),E*=i,O*=i,N*=i,l=ce*N-re*O,c=re*E-Y*N,s=Y*O-ce*E,i=Math.sqrt(l*l+c*c+s*s),i?(i=1/i,l*=i,c*=i,s*=i):(l=0,c=0,s=0),m=O*s-N*c,b=N*l-E*s,w=E*c-O*l,i=Math.sqrt(m*m+b*b+w*w),i?(i=1/i,m*=i,b*=i,w*=i):(m=0,b=0,w=0),t[0]=l,t[1]=m,t[2]=E,t[3]=0,t[4]=c,t[5]=b,t[6]=O,t[7]=0,t[8]=s,t[9]=w,t[10]=N,t[11]=0,t[12]=-(l*V+c*W+s*j),t[13]=-(m*V+b*W+w*j),t[14]=-(E*V+O*W+N*j),t[15]=1,t)}function iH(){const t=new Ry(4);return Ry!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Vz(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function qy(t,e,r){const n=e[0],i=e[1],l=e[2],c=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*l+r[12]*c,t[1]=r[1]*n+r[5]*i+r[9]*l+r[13]*c,t[2]=r[2]*n+r[6]*i+r[10]*l+r[14]*c,t[3]=r[3]*n+r[7]*i+r[11]*l+r[15]*c,t}(function(){const t=iH();return function(e,r,n,i,l,c){let s,m;for(r||(r=4),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],l(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();var SE;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(SE||(SE={}));const sH=45*Math.PI/180,aH=1,sS=.1,aS=500,oH=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Pu extends H9{static get IDENTITY(){return cH()}static get ZERO(){return lH()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return SE}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,i,l,c,s,m,b,w,E,O,N,V,W,j){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=l,this[5]=c,this[6]=s,this[7]=m,this[8]=b,this[9]=w,this[10]=E,this[11]=O,this[12]=N,this[13]=V,this[14]=W,this[15]=j,this.check()}setRowMajor(e,r,n,i,l,c,s,m,b,w,E,O,N,V,W,j){return this[0]=e,this[1]=l,this[2]=b,this[3]=N,this[4]=r,this[5]=c,this[6]=w,this[7]=V,this[8]=n,this[9]=s,this[10]=E,this[11]=W,this[12]=i,this[13]=m,this[14]=O,this[15]=j,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(oH)}fromObject(e){return this.check()}fromQuaternion(e){return K9(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:i,top:l,near:c=sS,far:s=aS}=e;return s===1/0?uH(this,r,n,i,l,c):Q9(this,r,n,i,l,c,s),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=e;return nH(this,r,n,i),this.check()}ortho(e){const{left:r,right:n,bottom:i,top:l,near:c=sS,far:s=aS}=e;return rH(this,r,n,i,l,c,s),this.check()}orthographic(e){const{fovy:r=sH,aspect:n=aH,focalDistance:i=1,near:l=sS,far:c=aS}=e;qI(r);const s=r/2,m=i*Math.tan(s),b=m*n;return this.ortho({left:-b,right:b,bottom:-m,top:m,near:l,far:c})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:l=500}=e;return qI(r),eH(this,r,n,i,l),this.check()}determinant(){return G9(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],l=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*l,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*l,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],l=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=this[4]*i,e[4]=this[5]*l,e[5]=this[6]*c,e[6]=this[8]*i,e[7]=this[9]*l,e[8]=this[10]*c,e}transpose(){return X9(this,this),this.check()}invert(){return TE(this,this),this.check()}multiplyLeft(e){return im(this,e,this),this.check()}multiplyRight(e){return im(this,this,e),this.check()}rotateX(e){return jz(this,this,e),this.check()}rotateY(e){return Y9(this,this,e),this.check()}rotateZ(e){return Uz(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return Z9(this,this,e,r),this.check()}scale(e){return _C(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return uw(this,this,e),this.check()}transform(e,r){return e.length===4?(r=qy(r||[-0,-0,-0,-0],e,this),rS(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let i;switch(n){case 2:i=P9(r||[-0,-0],e,this);break;case 3:i=Bz(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rS(i,e.length),i}transformAsVector(e,r){let n;switch(e.length){case 2:n=C9(r||[-0,-0],e,this);break;case 3:n=zz(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rS(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let Kx,Qx;function lH(){return Kx||(Kx=new Pu([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Kx)),Kx}function cH(){return Qx||(Qx=new Pu,Object.freeze(Qx)),Qx}function qI(t){if(t>Math.PI*2)throw Error("expected radians")}function uH(t,e,r,n,i,l){const c=2*l/(r-e),s=2*l/(i-n),m=(r+e)/(r-e),b=(i+n)/(i-n),w=-1,E=-1,O=-2*l;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=m,t[9]=b,t[10]=w,t[11]=E,t[12]=0,t[13]=0,t[14]=O,t[15]=0,t}function $z(t,e=[],r=0){const n=Math.fround(t),i=t-n;return e[r]=n,e[r+1]=i,e}function hH(t){return t-Math.fround(t)}function fH(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const i=r*4+n;$z(t[n*4+r],e,i*2)}return e}const dH=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,pH={name:"fp32",vs:dH},gH=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,mH={ONE:1},_H={name:"fp64arithmetic",vs:gH,defaultUniforms:mH,uniformTypes:{ONE:"f32"},fp64ify:$z,fp64LowPart:hH,fp64ifyMatrix4:fH},yH=[0,1,1,1],vH=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,bH=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,XI={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:yH},vs:vH,fs:bH,getUniforms:xH};function xH(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const GI=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,wH=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,TH=5,SH=255;var $0;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})($0||($0={}));const D1={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:$0.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:wH,vs:GI,fs:GI,getUniforms:AH};function AH(t,e={}){if(t=t&&{...t},!t)return{...D1.defaultUniforms};t.lights&&(t={...t,...PH(t.lights),lights:void 0});const{ambientLight:r,pointLights:n,directionalLights:i}=t||{};if(!(r||n&&n.length>0||i&&i.length>0))return{...D1.defaultUniforms,enabled:0};const c={...D1.defaultUniforms,...e,...EH({ambientLight:r,pointLights:n,directionalLights:i})};return t.enabled!==void 0&&(c.enabled=t.enabled?1:0),c}function EH({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const n={};n.ambientColor=oS(t);let i=0;for(const l of e){n.lightType=$0.POINT;const c=i;n[`lightColor${c}`]=oS(l),n[`lightPosition${c}`]=l.position,n[`lightAttenuation${c}`]=l.attenuation||[1,0,0],i++}for(const l of r){n.lightType=$0.DIRECTIONAL;const c=i;n[`lightColor${c}`]=oS(l),n[`lightDirection${c}`]=l.direction,i++}return i>TH&&Bt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=e.length,n}function PH(t){const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return e}function oS(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(n=>n*r/SH)}const CH=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,MH=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,IH=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Wz={props:{},name:"gouraudMaterial",vs:MH.replace("phongMaterial","gouraudMaterial"),fs:CH.replace("phongMaterial","gouraudMaterial"),source:IH.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[D1],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...Wz.defaultUniforms,...e}}},ZI=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,RH={name:"layer",vs:ZI,fs:ZI,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},OH=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,DH={name:"color",dependencies:[],source:OH,getUniforms:t=>({}),uniformTypes:{opacity:"f32"}},kH=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Hz="#define SMOOTH_EDGE_RADIUS 0.5",LH=`${Hz}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,NH=`${Hz}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,qz={name:"geometry",source:kH,vs:LH,fs:NH},zH=25;var ns;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(ns||(ns={}));var ms;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ms||(ms={}));var Nr;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Nr||(Nr={}));const BH="compute",FH="auto",AE="manipulation",k1="none",EE="pan-x",PE="pan-y";function jH(t){if(t.includes(k1))return k1;const e=t.includes(EE),r=t.includes(PE);return e&&r?k1:e||r?e?EE:PE:t.includes(AE)?AE:FH}class UH{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===BH&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return jH(e.join(" "))}}function hw(t){return t.trim().split(/\s+/g)}function lS(t,e,r){if(t)for(const n of hw(e))t.addEventListener(n,r,!1)}function cS(t,e,r){if(t)for(const n of hw(e))t.removeEventListener(n,r,!1)}function YI(t){return(t.ownerDocument||t).defaultView}function VH(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function Xz(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,i=0;for(;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:Math.round(r/e),y:Math.round(n/e)}}function KI(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:Xz(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Gz(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function QI(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function $H(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function JI(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function Zz(t,e){return t===e?ms.None:Math.abs(t)>=Math.abs(e)?t<0?ms.Left:ms.Right:e<0?ms.Up:ms.Down}function WH(t,e){const r=e.center;let n=t.offsetDelta,i=t.prevDelta;const l=t.prevInput;return(e.eventType===ns.Start||l?.eventType===ns.End)&&(i=t.prevDelta={x:l?.deltaX||0,y:l?.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function Yz(t,e,r){return{x:e/t||0,y:r/t||0}}function HH(t,e){return QI(e[0],e[1])/QI(t[0],t[1])}function qH(t,e){return JI(e[1],e[0])-JI(t[1],t[0])}function XH(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let i,l,c,s;if(e.eventType!==ns.Cancel&&(n>zH||r.velocity===void 0)){const m=e.deltaX-r.deltaX,b=e.deltaY-r.deltaY,w=Yz(n,m,b);l=w.x,c=w.y,i=Math.abs(w.x)>Math.abs(w.y)?w.x:w.y,s=Zz(m,b),t.lastInterval=e}else i=r.velocity,l=r.velocityX,c=r.velocityY,s=r.direction;e.velocity=i,e.velocityX=l,e.velocityY=c,e.direction=s}function GH(t,e){const{session:r}=t,{pointers:n}=e,{length:i}=n;r.firstInput||(r.firstInput=KI(e)),i>1&&!r.firstMultiple?r.firstMultiple=KI(e):i===1&&(r.firstMultiple=!1);const{firstInput:l,firstMultiple:c}=r,s=c?c.center:l.center,m=e.center=Xz(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-l.timeStamp,e.angle=$H(s,m),e.distance=Gz(s,m);const{deltaX:b,deltaY:w}=WH(r,e);e.deltaX=b,e.deltaY=w,e.offsetDirection=Zz(e.deltaX,e.deltaY);const E=Yz(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=E.x,e.overallVelocityY=E.y,e.overallVelocity=Math.abs(E.x)>Math.abs(E.y)?E.x:E.y,e.scale=c?HH(c.pointers,n):1,e.rotation=c?qH(c.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let O=t.element;return VH(e.srcEvent.target,O)&&(O=e.srcEvent.target),e.target=O,XH(r,e),e}function ZH(t,e,r){const n=r.pointers.length,i=r.changedPointers.length,l=e&ns.Start&&n-i===0,c=e&(ns.End|ns.Cancel)&&n-i===0;r.isFirst=!!l,r.isFinal=!!c,l&&(t.session={}),r.eventType=e;const s=GH(t,r);t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}let YH=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){ZH(this.manager,e,r)}init(){lS(this.element,this.evEl,this.domHandler),lS(this.target,this.evTarget,this.domHandler),lS(YI(this.element),this.evWin,this.domHandler)}destroy(){cS(this.element,this.evEl,this.domHandler),cS(this.target,this.evTarget,this.domHandler),cS(YI(this.element),this.evWin,this.domHandler)}};const KH={pointerdown:ns.Start,pointermove:ns.Move,pointerup:ns.End,pointercancel:ns.Cancel,pointerout:ns.Cancel},QH="pointerdown",JH="pointermove pointerup pointercancel";class eq extends YH{constructor(e){super(e),this.evEl=QH,this.evWin=JH,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const i=KH[e.type],l=e.pointerType,c=l==="touch";let s=r.findIndex(m=>m.pointerId===e.pointerId);i&ns.Start&&(e.buttons||c)?s<0&&(r.push(e),s=r.length-1):i&(ns.End|ns.Cancel)&&(n=!0),!(s<0)&&(r[s]=e,this.callback(i,{pointers:r,changedPointers:[e],eventType:i,pointerType:l,srcEvent:e}),n&&r.splice(s,1))}}const tq=["","webkit","Moz","MS","ms","o"];function rq(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of tq){const i=n?n+r:e;if(i in t)return i}}const nq=1,eR=2,tR={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class iq{constructor(e,r){this.options={...tR,...r,cssProps:{...tR.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new eq(this),this.touchAction=new UH(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?eR:nq}recognize(e){const{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:l}=r;(!l||l&&l.state&Nr.Recognized)&&(l=r.curRecognizer=null);let c=0;for(;c<i.length;)n=i[c],r.stopped!==eR&&(!l||n===l||n.canRecognizeWith(l))?n.recognize(e):n.reset(),!l&&n.state&(Nr.Began|Nr.Changed|Nr.Ended)&&(l=r.curRecognizer=n),c++}get(e){const{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===e)return r[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const r=typeof e=="string"?this.get(e):e;if(r){const{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;const{handlers:n}=this;for(const i of hw(e))n[i]=n[i]||[],n[i].push(r)}off(e,r){if(!e)return;const{handlers:n}=this;for(const i of hw(e))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(e,r){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=r;i.type=e,i.preventDefault=function(){r.srcEvent.preventDefault()};let l=0;for(;l<n.length;)n[l](i),l++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:r}=this;if(r){for(const[n,i]of Object.entries(this.options.cssProps)){const l=rq(r.style,n);e?(this.oldCssProps[l]=r.style[l],r.style[l]=i):r.style[l]=this.oldCssProps[l]||""}e||(this.oldCssProps={})}}}let sq=1;function aq(){return sq++}function rR(t){return t&Nr.Cancelled?"cancel":t&Nr.Ended?"end":t&Nr.Changed?"move":t&Nr.Began?"start":""}class Kz{constructor(e){this.options=e,this.id=aq(),this.state=Nr.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<Nr.Ended&&this.manager.emit(this.options.event+rR(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=Nr.Ended&&this.manager.emit(this.options.event+rR(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Nr.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Nr.Failed|Nr.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=Nr.Failed;return}this.state&(Nr.Recognized|Nr.Cancelled|Nr.Failed)&&(this.state=Nr.Possible),this.state=this.process(r),this.state&(Nr.Began|Nr.Changed|Nr.Ended|Nr.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class Qz extends Kz{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,i=r&(Nr.Began|Nr.Changed),l=this.attrTest(e);return i&&(n&ns.Cancel||!l)?r|Nr.Cancelled:i||l?n&ns.End?r|Nr.Ended:r&Nr.Began?r|Nr.Changed:Nr.Began:Nr.Failed}}class nR extends Kz{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[AE]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,i=e.distance<r.threshold,l=e.deltaTime<r.time;if(this.reset(),e.eventType&ns.Start&&this.count===0)return this.failTimeout();if(i&&l&&n){if(e.eventType!==ns.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<r.interval:!0,s=!this.pCenter||Gz(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!s||!c?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Nr.Recognized,this.tryEmit(this._input)},r.interval),Nr.Began):Nr.Recognized}return Nr.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Nr.Failed},this.options.interval),Nr.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Nr.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const oq=["","start","move","end","cancel","up","down","left","right"];class iR extends Qz{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ms.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&ms.Horizontal&&r.push(PE),e&ms.Vertical&&r.push(EE),r}getEventNames(){return oq.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:i}=e,{direction:l}=e;const c=e.deltaX,s=e.deltaY;return l&r.direction||(r.direction&ms.Horizontal?(l=c===0?ms.None:c<0?ms.Left:ms.Right,n=c!==this.pX,i=Math.abs(e.deltaX)):(l=s===0?ms.None:s<0?ms.Up:ms.Down,n=s!==this.pY,i=Math.abs(e.deltaY))),e.direction=l,n&&i>r.threshold&&!!(l&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Nr.Began)||!(this.state&Nr.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=ms[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const lq=["","start","move","end","cancel","in","out"];class cq extends Qz{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[k1]}getEventNames(){return lq.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Nr.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}class xT{constructor(e,r,n){this.element=e,this.callback=r,this.options=n}}const uq=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",hq=uq.indexOf("firefox")!==-1,sR=4.000244140625,fq=40,dq=.25;class pq extends xT{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let l=i.deltaY;globalThis.WheelEvent&&(hq&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(l/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(l*=fq)),l!==0&&l%sR===0&&(l=Math.floor(l/sR)),i.shiftKey&&l&&(l=l*dq),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-l,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}}const aR=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class gq extends xT{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,aR.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){aR.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const oR=["keydown","keyup"];class mq extends xT{constructor(e,r,n){super(e,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const l=i.target||i.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",oR.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){oR.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}}class _q extends xT{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}}const lR=1,CE=2,cR=4,yq={pointerdown:lR,pointermove:CE,pointerup:cR,mousedown:lR,mousemove:CE,mouseup:cR},vq=0,bq=1,xq=2,wq=1,Tq=2,Sq=4;function Aq(t){const e=yq[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,l=!1,c=!1;return e===CE?(i=!!(r&wq),l=!!(r&Sq),c=!!(r&Tq)):(i=n===vq,l=n===bq,c=n===xq),{leftButton:i,middleButton:l,rightButton:c}}function Eq(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,l=n.height/e.offsetHeight||1,c={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/l};return{center:r,offsetCenter:c}}const Pq={srcElement:"root",priority:0};class Cq{constructor(e,r){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let l=n.srcEvent.target;for(;l&&l!==i.rootElement;){if(this._emit(i,l),i.handled)return;l=l.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,l=!1){const{handlers:c,handlersByElement:s}=this,m={...Pq,...n};let b=s.get(m.srcElement);b||(b=[],s.set(m.srcElement,b));const w={type:e,handler:r,srcElement:m.srcElement,priority:m.priority};i&&(w.once=!0),l&&(w.passive=!0),c.push(w),this._active=this._active||!w.passive;let E=b.length-1;for(;E>=0&&!(b[E].priority>=w.priority);)E--;b.splice(E+1,0,w)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let l=n.length-1;l>=0;l--){const c=n[l];if(c.type===e&&c.handler===r){n.splice(l,1);const s=i.get(c.srcElement);s.splice(s.indexOf(c),1),s.length===0&&i.delete(c.srcElement)}}this._active=n.some(l=>!l.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const l=()=>{e.handled=!0},c=()=>{e.handled=!0,i=!0},s=[];for(let m=0;m<n.length;m++){const{type:b,handler:w,once:E}=n[m];if(w({...e,type:b,stopPropagation:l,stopImmediatePropagation:c}),E&&s.push(n[m]),i)break}for(let m=0;m<s.length;m++){const{type:b,handler:w}=s[m];this.remove(b,w)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...Aq(e),...Eq(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}function Mq(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),i=r.shift()||{};e=new n(i)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}class Iq{constructor(e=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new iq(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:l,requireFailure:c}=Mq(n);this.manager.add(i),l&&i.recognizeWith(l),c&&i.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new pq(e,this._onOtherEvent,{enable:!1}),this.moveInput=new gq(e,this._onOtherEvent,{enable:!1}),this.keyInput=new mq(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new _q(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,n,i,l){if(typeof e!="string"){n=r;for(const[b,w]of Object.entries(e))this._addEventHandler(b,w,n,i,l);return}const{manager:c,events:s}=this;if(!c)return;let m=s.get(e);if(!m){const b=this._getRecognizerName(e)||e;m=new Cq(this,b),s.set(e,m),c&&c.on(e,m.handleEvent)}m.add(e,r,n,i,l),m.isEmpty()||this._toggleRecognizer(m.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const[l,c]of Object.entries(e))this._removeEventHandler(l,c);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,r),i.isEmpty())){const{recognizerName:l}=i;let c=!1;for(const s of n.values())if(s.recognizerName===l&&!s.isEmpty()){c=!0;break}c||this._toggleRecognizer(l,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}}const cn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(cn,"IDENTITY",{get:()=>(Wr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const El={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ed={common:0,meters:1,pixels:2},ME={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},uR={multipan:[iR,{threshold:10,direction:ms.Vertical,pointers:2}],pinch:[cq,{},null,["multipan"]],pan:[iR,{threshold:1},["pinch"],["multipan"]],dblclick:[nR,{event:"dblclick",taps:2}],click:[nR,{event:"click"},null,["dblclick"]]};function Rq(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function yb(t){let e={},r;return n=>{for(const i in n)if(!Rq(n[i],e[i])){r=t(n),e=n;break}return r}}const hR=[0,0,0,0],Oq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Jz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Dq=[0,0,0],eB=[0,0,0],kq=yb(zq);function tB(t,e,r=eB){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,l=!0;switch(e===cn.LNGLAT_OFFSETS||e===cn.METER_OFFSETS?i=r:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case El.WEB_MERCATOR:(e===cn.LNGLAT||e===cn.CARTESIAN)&&(i=[0,0,0],l=!1);break;case El.WEB_MERCATOR_AUTO_OFFSET:e===cn.LNGLAT?n=i:e===cn.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case El.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case El.GLOBE:l=!1,i=null;break;default:l=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:l}}function Lq(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:i}=t;let{viewMatrix:l,viewProjectionMatrix:c}=t,s=hR,m=hR,b=t.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:E,offsetMode:O}=tB(t,e,r);return O&&(m=t.projectPosition(w||E),b=[b[0]-m[0],b[1]-m[1],b[2]-m[2]],m[3]=1,s=qy([],m,c),l=n||l,c=im([],i,l),c=im([],c,Oq)),{viewMatrix:l,viewProjectionMatrix:c,projectionCenter:s,originCommon:m,cameraPosCommon:b,shaderCoordinateOrigin:E,geospatialOrigin:w}}function Nq({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=cn.DEFAULT,coordinateOrigin:i=eB,autoWrapLongitude:l=!1}){n===cn.DEFAULT&&(n=t.isGeospatial?cn.LNGLAT:cn.CARTESIAN);const c=kq({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return c.wrapLongitude=l,c.modelMatrix=r||Jz,c}function zq({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:l,originCommon:c,cameraPosCommon:s,shaderCoordinateOrigin:m,geospatialOrigin:b}=Lq(t,r,n),w=t.getDistanceScales(),E=[t.width*e,t.height*e],O=qy([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:m,commonOrigin:c.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:E,devicePixelRatio:e,focalDistance:O,commonUnitsPerMeter:w.unitsPerMeter,commonUnitsPerWorldUnit:w.unitsPerMeter,commonUnitsPerWorldUnit2:Dq,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:l,modelMatrix:Jz,cameraPosition:s};if(b){const V=t.getDistanceScales(b);switch(r){case cn.METER_OFFSETS:N.commonUnitsPerWorldUnit=V.unitsPerMeter,N.commonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case cn.LNGLAT:case cn.LNGLAT_OFFSETS:t._pseudoMeters||(N.commonUnitsPerMeter=V.unitsPerMeter),N.commonUnitsPerWorldUnit=V.unitsPerDegree,N.commonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case cn.CARTESIAN:N.commonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],N.commonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]];break}}return N}const Bq=Object.keys(cn).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${cn[t]};`).join(""),Fq=Object.keys(El).map(t=>`const PROJECTION_MODE_${t}: i32 = ${El[t]};`).join(""),jq=Object.keys(ed).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${ed[t]};`).join(""),Uq=`${Bq}
${Fq}
${jq}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Vq=`${Uq}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,$q=Object.keys(cn).map(t=>`const int COORDINATE_SYSTEM_${t} = ${cn[t]};`).join(""),Wq=Object.keys(El).map(t=>`const int PROJECTION_MODE_${t} = ${El[t]};`).join(""),Hq=Object.keys(ed).map(t=>`const int UNIT_${t.toUpperCase()} = ${ed[t]};`).join(""),qq=`${$q}
${Wq}
${Hq}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,Xq={};function Gq(t=Xq){return"viewport"in t?Nq(t):{}}const yC={name:"project",dependencies:[pH,qz],source:Vq,vs:qq,getUniforms:Gq,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Zq=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Yq=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,vb={name:"project32",dependencies:[yC],source:Zq,vs:Yq};function Kq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Sy(t,e){const r=qy([],e,t);return Vz(r,r,1/r[3]),r}function fR(t,e){const r=t%e;return r<0?e+r:r}function IE(t,e,r){return t<e?e:t>r?r:t}function Qq(t){return Math.log(t)*Math.LOG2E}const vC=Math.log2||Qq;function td(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Tu=Math.PI,rB=Tu/4,vc=Tu/180,RE=180/Tu,Oy=512,fw=4003e4,Rh=85.051129,Jq=1.5;function eX(t){return vC(t)}function W0(t){const[e,r]=t;td(Number.isFinite(e)),td(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*vc,i=r*vc,l=Oy*(n+Tu)/(2*Tu),c=Oy*(Tu+Math.log(Math.tan(rB+i*.5)))/(2*Tu);return[l,c]}function Dy(t){const[e,r]=t,n=e/Oy*(2*Tu)-Tu,i=2*(Math.atan(Math.exp(r/Oy*(2*Tu)-Tu))-rB);return[n*RE,i*RE]}function tX(t){const{latitude:e}=t;td(Number.isFinite(e));const r=Math.cos(e*vc);return eX(fw*r)-9}function L1(t){const e=Math.cos(t*vc);return Oy/fw/e}function OE(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;td(Number.isFinite(e)&&Number.isFinite(r));const i=Oy,l=Math.cos(e*vc),c=i/360,s=c/l,m=i/fw/l,b={unitsPerMeter:[m,m,m],metersPerUnit:[1/m,1/m,1/m],unitsPerDegree:[c,s,m],degreesPerUnit:[1/c,1/s,1/m]};if(n){const w=vc*Math.tan(e*vc)/l,E=c*w/2,O=i/fw*w,N=O/s*m;b.unitsPerDegree2=[0,E,O],b.unitsPerMeter2=[N,0,N]}return b}function nB(t,e){const[r,n,i]=t,[l,c,s]=e,{unitsPerMeter:m,unitsPerMeter2:b}=OE({longitude:r,latitude:n,highPrecision:!0}),w=W0(t);w[0]+=l*(m[0]+b[0]*c),w[1]+=c*(m[1]+b[1]*c);const E=Dy(w),O=(i||0)+(s||0);return Number.isFinite(i)||Number.isFinite(s)?[E[0],E[1],O]:E}function rX(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:l,center:c}=t,s=Kq();uw(s,s,[0,0,-i]),jz(s,s,-r*vc),Uz(s,s,n*vc);const m=l/e;return _C(s,s,[m,m,m]),c&&uw(s,s,k9([],c)),s}function nX(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:l,center:c,scale:s,nearZMultiplier:m=1,farZMultiplier:b=1}=t;let{fovy:w=H0(Jq)}=t;n!==void 0&&(w=H0(n));const E=w*vc,O=i*vc,N=bC(w);let V=N;c&&(V+=c[2]*s/Math.cos(O)/r);const W=E*(.5+(l?l[1]:0)/r),j=Math.sin(W)*V/Math.sin(IE(Math.PI/2-O-W,.01,Math.PI-.01)),Y=Math.sin(O)*j+V,ce=V*10,re=Math.min(Y*b,ce);return{fov:E,aspect:e/r,focalDistance:N,near:m,far:re}}function H0(t){return 2*Math.atan(.5/t)*RE}function bC(t){return .5/Math.tan(.5*t*vc)}function iB(t,e){const[r,n,i=0]=t;return td(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),Sy(e,[r,n,i,1])}function xC(t,e,r=0){const[n,i,l]=t;if(td(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(l))return Sy(e,[n,i,l,1]);const c=Sy(e,[n,i,0,1]),s=Sy(e,[n,i,1,1]),m=c[2],b=s[2],w=m===b?0:((r||0)-m)/(b-m);return Nz([],c,s,w)}function iX(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:l=24,offset:c=[0,0]}=t,[[s,m],[b,w]]=n,E=sX(t.padding),O=W0([s,IE(w,-Rh,Rh)]),N=W0([b,IE(m,-Rh,Rh)]),V=[Math.max(Math.abs(N[0]-O[0]),i),Math.max(Math.abs(N[1]-O[1]),i)],W=[e-E.left-E.right-Math.abs(c[0])*2,r-E.top-E.bottom-Math.abs(c[1])*2];td(W[0]>0&&W[1]>0);const j=W[0]/V[0],Y=W[1]/V[1],ce=(E.right-E.left)/2/j,re=(E.top-E.bottom)/2/Y,ue=[(N[0]+O[0])/2+ce,(N[1]+O[1])/2+re],me=Dy(ue),ge=Math.min(l,vC(Math.abs(Math.min(j,Y))));return td(Number.isFinite(ge)),{longitude:me[0],latitude:me[1],zoom:ge}}function sX(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(td(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const dR=Math.PI/180;function aX(t,e=0){const{width:r,height:n,unproject:i}=t,l={targetZ:e},c=i([0,n],l),s=i([r,n],l);let m,b;const w=t.fovy?.5*t.fovy*dR:Math.atan(.5/t.altitude),E=(90-t.pitch)*dR;return w>E-.01?(m=pR(t,0,e),b=pR(t,r,e)):(m=i([0,0],l),b=i([r,0],l)),[c,s,b,m]}function pR(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=Sy(n,[e,0,1,1]),l=Sy(n,[e,t.height,1,1]),s=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(l[2]-i[2]),m=Nz([],i,l,s),b=Dy(m);return b.push(r),b}const gR=512;function oX(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:l,zoom:c,bearing:s=0}=t;(i<-180||i>180)&&(i=fR(i+180,360)-180),(s<-180||s>180)&&(s=fR(s+180,360)-180);const m=vC(r/gR);if(c<=m)c=m,l=0;else{const b=r/2/Math.pow(2,c),w=Dy([0,b])[1];if(l<w)l=w;else{const E=Dy([0,gR-b])[1];l>E&&(l=E)}}return{width:e,height:r,longitude:i,latitude:l,zoom:c,pitch:n,bearing:s}}const sB=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,lX=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,cX=`
${sB}
${lX}
`,uX=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,hX=`
${sB}
${uX}
`,fX=yb(_X),dX=yb(yX),pX=[0,0,0,1],gX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function mX(t,e){const[r,n,i]=t,l=xC([r,n,i],e);return Number.isFinite(i)?l:[l[0],l[1],0]}function _X({viewport:t,center:e}){return new Pu(t.viewProjectionMatrix).invert().transform(e)}function yX({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,l=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>mX(c,n));for(const c of e){const s=c.clone().translate(new Lh(t.center).negate()),m=l.map(w=>s.transform(w)),b=new Pu().ortho({left:Math.min(...m.map(w=>w[0])),right:Math.max(...m.map(w=>w[0])),bottom:Math.min(...m.map(w=>w[1])),top:Math.max(...m.map(w=>w[1])),near:Math.min(...m.map(w=>-w[2])),far:Math.max(...m.map(w=>-w[2]))});r.push(b.multiplyRight(c))}return r}function vX(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=yC.getUniforms(r),i=fX({viewport:r.viewport,center:n.center}),l=[],c=dX({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let m=0;m<t.shadowMatrices.length;m++){const b=c[m],w=b.clone().translate(new Lh(r.viewport.center).negate());n.coordinateSystem===cn.LNGLAT&&n.projectionMode===El.WEB_MERCATOR?(c[m]=w,l[m]=i):(c[m]=b.clone().multiplyRight(gX),l[m]=w.transform(i))}const s={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||pX,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let m=0;m<c.length;m++)s[`viewProjectionMatrix${m}`]=c[m],s[`projectCenter${m}`]=l[m];for(let m=0;m<2;m++)s[`shadow_uShadowMap${m}`]=t.shadowMaps&&t.shadowMaps[m]||t.dummyShadowMap;return s}const mR={name:"shadow",dependencies:[yC],vs:cX,fs:hX,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:vX,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},bb={...XI,defaultUniforms:{...XI.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},bX=[qz],xX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],wX=[];function TX(t){const e=Zg.getDefaultShaderAssembler();for(const n of bX)e.addDefaultModule(n);e._hookFunctions.length=0;const r=t==="glsl"?xX:wX;for(const n of r)e.addShaderHook(n);return e}const SX=[255,255,255],AX=1;let EX=0;class PX{constructor(e={}){this.type="ambient";const{color:r=SX}=e,{intensity:n=AX}=e;this.id=e.id||`ambient-${EX++}`,this.color=r,this.intensity=n}}const CX=[255,255,255],MX=1,IX=[0,0,-1];let RX=0;class _R{constructor(e={}){this.type="directional";const{color:r=CX}=e,{intensity:n=MX}=e,{direction:i=IX}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${RX++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Lh(i).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class OX{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class wC extends OX{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,l=e.clearColor??(i?[0,0,0,0]:!1),c=i?1:!1,s=i?0:!1,m=e.colorMask??15,b={viewport:[0,0,r,n]};e.colorMask&&(b.colorMask=m),e.scissorRect&&(b.scissorRect=e.scissorRect);const w=this.device.beginRenderPass({framebuffer:e.target,parameters:b,clearColor:l,clearDepth:c,clearStencil:s});try{return this._drawLayers(w,e)}finally{w.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:i,viewports:l,views:c,onViewportActive:s,clearStack:m=!0}=r;r.pass=r.pass||"unknown",m&&(this._lastRenderIndex=-1);const b=[];for(const w of l){const E=c&&c[w.id];s?.(w);const O=this._getDrawLayerParams(w,r),N=w.subViewports||[w];for(const V of N){const W=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:V,view:E,pass:r.pass,layers:r.layers},O);b.push(W)}}return b}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:i=!1,layerFilter:l,cullRect:c,effects:s,shaderModuleProps:m},b=!1){const w=[],E=aB(this._lastRenderIndex+1),O={layer:r[0],viewport:e,isPicking:i,renderPass:n,cullRect:c},N={};for(let V=0;V<r.length;V++){const W=r[V],j=this._shouldDrawLayer(W,O,l,N),Y={shouldDrawLayer:j};j&&!b&&(Y.shouldDrawLayer=!0,Y.layerRenderIndex=E(W,j),Y.shaderModuleProps=this._getShaderModuleProps(W,s,n,m),Y.layerParameters={...W.context.deck?.props.parameters,...this.getLayerParameters(W,V,e)}),w[V]=Y}return w}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:i,target:l,viewport:c,view:s},m){const b=DX(this.device,{shaderModuleProps:n,target:l,viewport:c});if(s){const{clear:E,clearColor:O,clearDepth:N,clearStencil:V}=s.props;if(E){let W=[0,0,0,0],j=1,Y=0;Array.isArray(O)?W=[...O.slice(0,3),O[3]||255].map(re=>re/255):O===!1&&(W=!1),N!==void 0&&(j=N),V!==void 0&&(Y=V),this.device.beginRenderPass({framebuffer:l,parameters:{viewport:b,scissorRect:b},clearColor:W,clearDepth:j,clearStencil:Y}).end()}}const w={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:b});for(let E=0;E<r.length;E++){const O=r[E],N=m[E],{shouldDrawLayer:V}=N;if(V&&O.props.pickable&&w.pickableCount++,O.isComposite&&w.compositeCount++,O.isDrawable&&N.shouldDrawLayer){const{layerRenderIndex:W,shaderModuleProps:j,layerParameters:Y}=N;w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,W),j.project&&(j.project.viewport=c),O.context.renderPass=e;try{O._drawLayer({renderPass:e,shaderModuleProps:j,uniforms:{layerIndex:W},parameters:Y})}catch(ce){O.raiseError(ce,`drawing ${O} to ${i}`)}}}return w}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(r))return!1;r.layer=c,c=c.parent}if(n){const s=r.layer.id;if(s in i||(i[s]=n(r)),!i[s])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,i){const l=this.device.canvasContext.cssToDeviceRatio(),c=e.internalState?.propsInTransition||e.props,s={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:l,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const m of r)yR(s,m.getShaderModuleProps?.(e,s));return yR(s,this.getShaderModuleProps(e,r,s),i)}}function aB(t=0,e={}){const r={},n=(i,l)=>{const c=i.props._offset,s=i.id,m=i.parent&&i.parent.id;let b;if(m&&!(m in e)&&n(i.parent,!1),m in r){const w=r[m]=r[m]||aB(e[m],e);b=w(i,l),r[s]=w}else Number.isFinite(c)?(b=c+(e[m]||0),r[s]=null):b=t;return l&&b>=t&&(t=b+1),e[s]=b,b};return n}function DX(t,{shaderModuleProps:e,target:r,viewport:n}){const i=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,l]=t.canvasContext.getDrawingBufferSize(),c=r?r.height:l,s=n;return[s.x*i,c-(s.y+s.height)*i,s.width*i,s.height*i]}function yR(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class kX extends wC{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],l=i.width*n,c=i.height*n,s=[1,1,1,1];(l!==r.width||c!==r.height)&&r.resize({width:l,height:c}),super.render({...e,clearColor:s,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const LX={color:[255,255,255],intensity:1},vR=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],NX=[0,0,0,200/255];class oB{constructor(e={}){this.id="lighting-effect",this.shadowColor=NX,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(mR),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:l,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},l=e.props.material;return{shadow:n,lighting:i,phongMaterial:l,gouraudMaterial:l}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(mR))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new Pu().lookAt({eye:new Lh(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new kX(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new PX(LX),this.directionalLights.push(new _R(vR[0]),new _R(vR[1])))}}class zX{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:i,padding:l=0,copy:c=!1,initialize:s=!1,maxCount:m}){const b=i||e&&e.constructor||Float32Array,w=r*n+l;if(ArrayBuffer.isView(e)){if(w<=e.length)return e;if(w*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new b(e.buffer,0,w)}let E=1/0;m&&(E=m*n+l);const O=this._allocate(b,w,s,E);return e&&c?O.set(e):s||O.fill(0,0,4),this._release(e),O}release(e){this._release(e)}_allocate(e,r,n,i){let l=Math.max(Math.ceil(r*this.opts.overAlloc),1);l>i&&(l=i);const c=this._pool,s=e.BYTES_PER_ELEMENT*l,m=c.findIndex(b=>b.byteLength>=s);if(m>=0){const b=new e(c.splice(m,1)[0],0,l);return n&&b.fill(0),b}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:i}=n,l=r.findIndex(c=>c.byteLength>=i);l<0?r.push(n):(l>0||r.length<this.opts.poolSize)&&r.splice(l,0,n),r.length>this.opts.poolSize&&r.shift()}}const ky=new zX;function w0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function BX(t,e){const r=t%e;return r<0?e+r:r}function FX(t){return[t[12],t[13],t[14]]}function jX(t){return{left:sy(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:sy(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:sy(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:sy(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:sy(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:sy(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const bR=new Lh;function sy(t,e,r,n){bR.set(t,e,r);const i=bR.len();return{distance:n/i,normal:new Lh(-t/i,-e/i,-r/i)}}function UX(t){return t-Math.fround(t)}let o0;function uS(t,e){const{size:r=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,l=(i-n)/r;o0=ky.allocate(o0,l,{type:Float32Array,size:r*2});let c=n,s=0;for(;c<i;){for(let m=0;m<r;m++){const b=t[c++];o0[s+m]=b,o0[s+m+r]=UX(b)}s+=r*2}return o0.subarray(0,l*r*2)}function VX(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const $X=Math.PI/180,WX=w0(),xR=[0,0,0],HX={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function qX({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:i,padding:l,near:c,far:s}){const m=t/e,b=r?new Pu().orthographic({fovy:n,aspect:m,focalDistance:i,near:c,far:s}):new Pu().perspective({fovy:n,aspect:m,near:c,far:s});if(l){const{left:w=0,right:E=0,top:O=0,bottom:N=0}=l,V=Ih((w+t-E)/2,0,t)-t/2,W=Ih((O+e-N)/2,0,e)-e/2;b[8]-=V*2/t,b[9]+=W*2/e}return b}class Xy{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||HX,this.focalDistance=e.focalDistance||1,this.position=e.position||xR,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?El.WEB_MERCATOR:El.WEB_MERCATOR_AUTO_OFFSET:El.IDENTITY}equals(e){return e instanceof Xy?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&V0(e.projectionMatrix,this.projectionMatrix)&&V0(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),i=iB(n,this.pixelProjectionMatrix),[l,c]=i,s=r?c:this.height-c;return e.length===2?[l,s]:[l,s,i[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,l,c]=e,s=r?l:this.height-l,m=n&&n*this.distanceScales.unitsPerMeter[2],b=xC([i,s,c],this.pixelUnprojectionMatrix,m),[w,E,O]=this.unprojectPosition(b);return Number.isFinite(c)?[w,E,O]:Number.isFinite(n)?[w,E,n]:[w,E]}projectPosition(e){const[r,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(e){if(this.isGeospatial){const r=W0(e);return r[1]=Ih(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Dy(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),l=this.unproject([0,this.height],r),c=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],l[0],c[0]),Math.min(n[1],i[1],l[1],c[1]),Math.max(n[0],i[0],l[0],c[0]),Math.max(n[1],i[1],l[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?OE({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,jX(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r,n){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=tX({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||OE({latitude:n,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:l,modelMatrix:c}=e;let s=xR;if(l&&(s=c?new Pu(c).transformAsVector(l,[]):l),this.isGeospatial){const m=this.projectPosition([r,n,0]);this.center=new Lh(s).scale(this.distanceScales.unitsPerMeter).add(m)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:r=WX,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:l,fovy:c=75,near:s=.1,far:m=1e3,padding:b=null,focalDistance:w=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Pu().multiplyRight(r).translate(new Lh(this.center).negate()),this.projectionMatrix=n||qX({width:this.width,height:this.height,orthographic:i,fovyRadians:l||c*$X,focalDistance:w,padding:b,near:s,far:m});const E=w0();im(E,E,this.projectionMatrix),im(E,E,this.viewMatrix),this.viewProjectionMatrix=E,this.viewMatrixInverse=TE([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=FX(this.viewMatrixInverse);const O=w0(),N=w0();_C(O,O,[this.width/2,-this.height/2,1]),uw(O,O,[1,-1,0]),im(N,O,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=TE(w0(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wr.warn("Pixel project matrix not invertible")()}}Xy.displayName="Viewport";class gm extends Xy{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:i=0,pitch:l=0,bearing:c=0,nearZMultiplier:s=.1,farZMultiplier:m=1.01,nearZ:b,farZ:w,orthographic:E=!1,projectionMatrix:O,repeat:N=!1,worldOffset:V=0,position:W,padding:j,legacyMeterSizes:Y=!1}=e;let{width:ce,height:re,altitude:ue=1.5}=e;const me=Math.pow(2,i);ce=ce||1,re=re||1;let ge,Ce=null;if(O)ue=O[5]/2,ge=H0(ue);else{e.fovy?(ge=e.fovy,ue=bC(ge)):ge=H0(ue);let Xe;if(j){const{top:Et=0,bottom:gt=0}=j;Xe=[0,Ih((Et+re-gt)/2,0,re)-re/2]}Ce=nX({width:ce,height:re,scale:me,center:W&&[0,0,W[2]*L1(r)],offset:Xe,pitch:l,fovy:ge,nearZMultiplier:s,farZMultiplier:m}),Number.isFinite(b)&&(Ce.near=b),Number.isFinite(w)&&(Ce.far=w)}let We=rX({height:re,pitch:l,bearing:c,scale:me,altitude:ue});V&&(We=new Pu().translate([512*V,0,0]).multiplyLeft(We)),super({...e,width:ce,height:re,viewMatrix:We,longitude:n,latitude:r,zoom:i,...Ce,fovy:ge,focalDistance:ue}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=l,this.bearing=c,this.altitude=ue,this.fovy=ge,this.orthographic=E,this._subViewports=N?[]:null,this._pseudoMeters=Y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=r;i<=n;i++){const l=i?new gm({...this,worldOffset:i}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),i=(e[2]||0)*L1(e[1]);return[r,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),i=(e[2]||0)/L1(n);return[r,n,i]}addMetersToLngLat(e,r){return nB(e,r)}panByPosition(e,r,n){const i=xC(r,this.pixelUnprojectionMatrix),l=this.projectFlat(e),c=HI([],l,E9([],i)),s=HI([],this.center,c),[m,b]=this.unprojectFlat(s);return{longitude:m,latitude:b}}getBounds(e={}){const r=aX(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:l,latitude:c,zoom:s}=iX({width:n,height:i,bounds:e,...r});return new gm({width:n,height:i,longitude:l,latitude:c,zoom:s})}}gm.displayName="WebMercatorViewport";const wR=[0,0,0];function hS(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof gm){const[i,l,c=0]=t,s=e.getDistanceScales([i,l]);n[2]=c*s.unitsPerMeter[2]}return n}function XX(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:i,fromCoordinateSystem:l,fromCoordinateOrigin:c}=t;return i===cn.DEFAULT&&(i=e.isGeospatial?cn.LNGLAT:cn.CARTESIAN),l===void 0&&(l=i),c===void 0&&(c=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:l,fromCoordinateOrigin:c}}function lB(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:l}){let[c,s,m=0]=t;switch(r&&([c,s,m]=qy([],[c,s,m,1],r)),n){case cn.LNGLAT:return hS([c,s,m],e,l);case cn.LNGLAT_OFFSETS:return hS([c+i[0],s+i[1],m+(i[2]||0)],e,l);case cn.METER_OFFSETS:return hS(nB(i,[c,s,m]),e,l);case cn.CARTESIAN:default:return e.isGeospatial?[c+i[0],s+i[1],m+i[2]]:e.projectPosition([c,s,m])}}function GX(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:l,fromCoordinateSystem:c,fromCoordinateOrigin:s}=XX(e),{autoOffset:m=!0}=e,{geospatialOrigin:b=wR,shaderCoordinateOrigin:w=wR,offsetMode:E=!1}=m?tB(r,n,i):{},O=lB(t,{viewport:r,modelMatrix:l,coordinateSystem:c,coordinateOrigin:s,offsetMode:E});if(E){const N=r.projectPosition(b||w);Fz(O,O,N)}return O}let ZX=1,YX=1;class cB{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:l=1}=e,c=ZX++,s={time:0,delay:r,duration:n,rate:i,repeat:l};return this._setChannelTime(s,this.time),this.channels.set(c,s),c}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const i of r)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:l,channel:c}=i;l.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=YX++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function KX(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function QX(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let JX=0;class TC{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:vE.stats.get(`animation-loop-${JX++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...TC.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new gT({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=KX(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(QX(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const r=e?.canvas,n=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:r,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const fS={};function xb(t="id"){fS[t]=fS[t]||1;const e=fS[t]++;return`${t}-${e}`}class TR{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||xb("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ai.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function eG(t,e){if(e instanceof TR)return e;const r=tG(t,e),{attributes:n,bufferLayout:i}=rG(t,e);return new TR({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:r,attributes:n})}function tG(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Ai.INDEX,data:r})}function rG(t,e){const r=[],n={};for(const[l,c]of Object.entries(e.attributes)){let s=l;switch(l){case"POSITION":s="positions";break;case"NORMAL":s="normals";break;case"TEXCOORD_0":s="texCoords";break;case"COLOR_0":s="colors";break}if(c){n[s]=t.createBuffer({data:c.value,id:`${l}-buffer`});const{value:m,size:b,normalized:w}=c;r.push({name:s,format:$7(m,b,w)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}class SC{static defaultProps={...nm.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new SC(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const r={...nm.defaultProps,...e},n=this._renderPipelineCache,i=this._hashRenderPipeline(r);let l=n[i]?.pipeline;return l?(n[i].useCount++,this.debug&&Bt.log(3,`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(l=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:xb("unnamed-cached")}),l.hash=i,n[i]={pipeline:l,useCount:1},this.debug&&Bt.log(3,`${this}: ${l} created, count=${n[i].useCount}`)()),l}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const r={...rw.defaultProps,...e},n=this._computePipelineCache,i=this._hashComputePipeline(r);let l=n[i]?.pipeline;return l?(n[i].useCount++,this.debug&&Bt.log(3,`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(l=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0}),l.hash=i,n[i]={pipeline:l,useCount:1},this.debug&&Bt.log(3,`${this}: ${l} created, count=${n[i].useCount}`)()),l}release(e){if(!this.cachingEnabled){e.destroy();return}const r=this._getCache(e),n=e.hash;r[n].useCount--,r[n].useCount===0?(this._destroyPipeline(e),this.debug&&Bt.log(3,`${this}: ${e} released and destroyed`)()):r[n].useCount<0?(Bt.error(`${this}: ${e} released, useCount < 0, resetting`)(),r[n].useCount=0):this.debug&&Bt.log(3,`${this}: ${e} released, count=${r[n].useCount}`)()}_destroyPipeline(e){const r=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete r[e.hash],e.destroy(),!0}}_getCache(e){let r;if(e instanceof rw&&(r=this._computePipelineCache),e instanceof nm&&(r=this._renderPipelineCache),!r)throw new Error(`${this}`);if(!r[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return r}_hashComputePipeline(e){const{type:r}=this.device,n=this._getHash(e.shader.source);return`${r}/C/${n}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",l=this._getHash(JSON.stringify(e.bufferLayout)),{type:c}=this.device;if(c==="webgl")return`${c}/R/${r}/${n}V${i}BL${l}`;{const s=this._getHash(JSON.stringify(e.parameters));return`${c}/R/${r}/${n}V${i}T${e.topology}P${s}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class AC{static defaultProps={...vT.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new AC(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const r=this._hashShader(e);let n=this._cache[r];if(n)n.useCount++,this.debug&&Bt.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:1},this.debug&&Bt.log(3,`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const r=this._hashShader(e),n=this._cache[r];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy(),this.debug&&Bt.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Bt.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function nG(t,e){const r={},n="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of t.attributes)if(i){const l=`${i.location} ${i.name}: ${i.type}`;r[`in ${l}`]={[n]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const l=`${i.location} ${i.name}`;r[`out ${l}`]={[n]:JSON.stringify(i)}}return r}let Bs=null,dS=null;function iG(t,{id:e,minimap:r,opaque:n,top:i="0",left:l="0",rgbaScale:c=1}){Bs||(Bs=document.createElement("canvas"),Bs.id=e,Bs.title=e,Bs.style.zIndex="100",Bs.style.position="absolute",Bs.style.top=i,Bs.style.left=l,Bs.style.border="blue 5px solid",Bs.style.transform="scaleY(-1)",document.body.appendChild(Bs),dS=Bs.getContext("2d")),(Bs.width!==t.width||Bs.height!==t.height)&&(Bs.width=t.width/2,Bs.height=t.height/2,Bs.style.width="400px",Bs.style.height="400px");const s=t.device.readPixelsToArrayWebGL(t),m=dS?.createImageData(t.width,t.height);if(m){for(let w=0;w<s.length;w+=4)m.data[0+w+0]=s[w+0]*c,m.data[0+w+1]=s[w+1]*c,m.data[0+w+2]=s[w+2]*c,m.data[0+w+3]=n?255:s[w+3]*c;dS?.putImageData(m,0,0)}}function DE(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!DE(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!DE(t[l],e[l],r-1))return!1;return!0}return!1}class pS{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const i of r){const l=n.findIndex(c=>c.name===i.name);l<0?n.push(i):n[l]=i}return n}getBufferIndex(e){const r=this.bufferLayouts.findIndex(n=>n.name===e);return r===-1&&Bt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}}function sG(t,e){const r=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),n=e.slice();return n.sort((i,l)=>{const c=i.attributes?i.attributes.map(w=>w.attribute):[i.name],s=l.attributes?l.attributes.map(w=>w.attribute):[l.name],m=Math.min(...c.map(w=>r[w])),b=Math.min(...s.map(w=>r[w]));return m-b}),n}function aG(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function oG(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function lG(t){return aG(t)||oG(t)}function cG(t){return lG(t)||typeof t=="number"||typeof t=="boolean"}function uG(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];cG(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class hG{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);const n=QP(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Bt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,l]of Object.entries(e))this._addModule(l),l.name&&i!==l.name&&!this.options.disableWarnings&&Bt.warn(`Module name: ${i} vs ${l.name}`)()}destroy(){}setProps(e){for(const r of Object.keys(e)){const n=r,i=e[n]||{},l=this.modules[n];if(!l){this.options.disableWarnings||Bt.warn(`Module ${r} not found`)();continue}const c=this.moduleUniforms[n],s=this.moduleBindings[n],m=l.getUniforms?.(i,c)||i,{uniforms:b,bindings:w}=uG(m);this.moduleUniforms[n]={...c,...b},this.moduleBindings[n]={...s,...w}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[i,l]of Object.entries(n))e[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(l)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let fG="";async function dG(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:fG+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}const pG=["+X","-X","+Y","-Y","+Z","-Z"],gG=["+X","-X","+Y","-Y","+Z","-Z"];class D0{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e;const n=xb("async-texture");this.props={...D0.defaultProps,id:n,...r},this.id=this.props.id,r={...r},typeof r?.data=="string"&&r.dimension==="2d"&&(r.data=dG(r.data)),r.mipmaps&&(r.mipLevels="auto"),this.ready=new Promise((i,l)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=l}),this.initAsync(r)}async initAsync(e){const r=e.data,n=await uB(r).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const l={...i,...e,data:void 0,mipLevels:1},c=this.device.getMipLevelCount(l.width,l.height);if(l.mipLevels=this.props.mipLevels==="auto"?c:Math.min(c,this.props.mipLevels),this.texture=this.device.createTexture(l),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Bt.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof fm?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}isTextureLevelData(e){const r=e?.data;return ArrayBuffer.isView(r)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const n=Object.values(e)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,r){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,r=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&this.props.mipmaps!==!1&&Bt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const l=n[i];this.device.isExternalImage(l)?this.texture.copyExternalImage({image:l,depth:r,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:l.data,mipLevel:i})}}_setTexture3DData(e,r){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeData(e,r){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,i]of Object.entries(r)){const l=gG.indexOf(n);this._setTexture2DData(i,l)}}_setTextureArrayData(e,r){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeArrayData(e,r){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,r,n,i=0){Array.isArray(r)&&r.length>1&&this.props.mipmaps!==!1&&Bt.warn(`${this.id} has mipmap and multiple LODs.`)();const l=pG.indexOf(n);this._setTexture2DData(r,l)}_normalizeTextureData(e){const r=this.texture;let n;return ArrayBuffer.isView(e)?n=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?n=e:n=[e],n}static defaultProps={...ys.defaultProps,data:null,mipmaps:!1}}async function uB(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(uB));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let l=0;l<n.length;l++)i[n[l]]=r[l];return i}return t}const Ug=2,mG=1e4;class Au{static defaultProps={...nm.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Zg.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...Au.defaultProps,...r},r=this.props,this.id=r.id||xb("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(this.props.modules?.map(m=>[m.name,m])||[]),i=r.shaderInputs||new hG(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const l=yG(e),c=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:m,getUniforms:b}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:l,...this.props,modules:c});this.source=m,this._getModuleUniforms=b,this.props.shaderLayout||=m9(this.source)}else{const{vs:m,fs:b,getUniforms:w}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:l,...this.props,modules:c});this.vs=m,this.fs=b,this._getModuleUniforms=w}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||SC.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||AC.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return Bt.info(Ug,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});const{indexBuffer:l}=this.vertexArray,c=l?l.byteLength/(l.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&eG(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const n=new pS(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new pS(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){DE(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new jW(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(_G(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=r?.disableWarnings??this.props.disableWarnings;e.indices&&Bt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=sG(this.pipeline.shaderLayout,this.bufferLayout);const i=new pS(this.bufferLayout);for(const[l,c]of Object.entries(e)){const s=i.getBufferLayout(l);if(!s){n||Bt.warn(`Model(${this.id}): Missing layout for buffer "${l}".`)();continue}const m=i.getAttributeNamesForBuffer(s);let b=!1;for(const w of m){const E=this._attributeInfos[w];if(E){const O=this.device.type==="webgpu"?i.getBufferIndex(E.bufferName):E.location;this.vertexArray.setBuffer(O,c),b=!0}}!b&&!n&&Bt.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${l}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,i]of Object.entries(e)){const l=this._attributeInfos[n];l?this.vertexArray.setConstantWebGL(l.location,i):(r?.disableWarnings??this.props.disableWarnings)||Bt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof D0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof D0?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof yT?e=Math.max(e,r.texture.updateTimestamp):r instanceof Ai||r instanceof ys?e=Math.max(e,r.updateTimestamp):r instanceof D0?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof fm||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Bt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=fz(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Bt.level>3?0:mG;Bt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Bt.group(Ug,`>>> DRAWING MODEL ${this.id}`,{collapsed:Bt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=nG(this.pipeline.shaderLayout,this.id);Bt.table(Ug,e)();const r=this.shaderInputs.getDebugTable();Bt.table(Ug,r)();const n=this._getAttributeDebugTable();Bt.table(Ug,this._attributeInfos)(),Bt.table(Ug,n)(),Bt.groupEnd(Ug)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&iG(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=eC(r);return(e instanceof Ai?new n(e.debugData):e).toString()}}function _G(t){return!!(t.uniformTypes&&!vG(t.uniformTypes))}function yG(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function vG(t){for(const e in t)return!1;return!0}class Ly{device;model;transformFeedback;static defaultProps={...Au.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=Ly.defaultProps){if(!Ly.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Au(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||L7(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof Ai)return r.readAsync();const{buffer:n,byteOffset:i=0,byteLength:l=n.byteLength}=r;return n.readAsync(i,l)}}class Ny{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||xb("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[l,c]of Object.entries(r)){const s=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(s.value))throw new Error(`${this._print(l)}: must be typed array or object with value as typed array`);if((l==="POSITION"||l==="positions")&&!s.size&&(s.size=3),l==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=s}else this.attributes[l]=s}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const i of Object.values(e)){const{value:l,size:c,constant:s}=i;!s&&l&&c!==void 0&&c>=1&&(n=Math.min(n,l.length/c))}return n}}const bG={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class hB extends wC{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:l,pickingFBO:c,deviceRect:{x:s,y:m,width:b,height:w},cullRect:E,effects:O,pass:N="picking",pickZ:V,shaderModuleProps:W}){this.pickZ=V;const j=this._resetColorEncoder(V),Y=[s,m,b,w],ce=super.render({target:c,layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:l,cullRect:E,effects:O?.filter(ue=>ue.useInPicking),pass:N,isPicking:!0,shaderModuleProps:W,clearColor:[0,0,0,0],colorMask:15,scissorRect:Y});return this._colorEncoderState=null,{decodePickingColor:j&&wG.bind(null,j),stats:ce}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const i={...e.props.parameters},{pickable:l,operation:c}=e.props;return this._colorEncoderState?l&&c.includes("draw")?(Object.assign(i,bG),i.blend=!0,i.blendColor=xG(this._colorEncoderState,e,n)):c.includes("terrain")&&(i.blend=!1):i.blend=!1,i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function xG(t,e,r){const{byLayer:n,byAlpha:i}=t;let l,c=n.get(e);return c?(c.viewports.push(r),l=c.a):(l=n.size+1,l<=255?(c={a:l,layer:e,viewports:[r]},n.set(e,c),i[l]=c):(Wr.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function wG(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const hy={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},dw=Symbol.for("component"),Tp=Symbol.for("propTypes"),gS=Symbol.for("deprecatedProps"),Ay=Symbol.for("asyncPropDefaults"),mm=Symbol.for("asyncPropOriginal"),vp=Symbol.for("asyncPropResolved");function Pp(t,e=()=>!0){return Array.isArray(t)?fB(t,e,[]):e(t)?[t]:[]}function fB(t,e,r){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?fB(i,e,r):e(i)&&r.push(i)}return r}function TG({target:t,source:e,start:r=0,count:n=1}){const i=e.length,l=n*i;let c=0;for(let s=r;c<i;c++)t[s++]=e[c];for(;c<l;)c<l-c?(t.copyWithin(r+c,r,r+c),c*=2):(t.copyWithin(r+c,r,r+l-c),c=l);return t}class SG{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=Q1(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class AG{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:i=!0}){let l=this._resources[e];l?l.setData(r,n):(l=new SG(e,r,this._context),this._resources[e]=l),l.persistent=i}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const i=r[n],l=this._resources[i.resourceId];l&&l.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:i="default"}){const{_resources:l,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const s=l[e];if(this._track(n,i,s,r),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,i){const l=this._consumers,c=l[e]=l[e]||{};let s=c[r];const m=s&&s.resourceId&&this._resources[s.resourceId];m&&(m.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},c[r]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const EG="layerManager.setLayers",PG="layerManager.activateViewport";class CG{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=s=>{Xa(PG,this,s),s&&(this.context.viewport=s)};const{deck:n,stats:i,viewport:l,timeline:c}=r||{};this.layers=[],this.resourceManager=new AG({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:TX(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[RH],renderPass:void 0,stats:i||new gT({id:"deck.gl"}),viewport:l||new Xy({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new cB,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){Xa(EG,this,r,e),this._lastRenderedLayers=e;const n=Pp(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const c of e)n[c.id]?Wr.warn(`Multiple old layers with same id ${c.id}`)():n[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let l=!1;for(const c of i)if(c.hasUniformTransition()){l=`Uniform transition in ${c}`;break}this._needsUpdate=l,this.layers=i}_updateSublayersRecursively(e,r,n){for(const i of e){i.context=this.context;const l=r[i.id];l===null&&Wr.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let c=null;try{this._debug&&l!==i&&i.validateProps(),l?(this._transferLayerState(l,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),c=i.isComposite?i.getSubLayers():null}catch(s){this._handleError("matching",s,i)}c&&this._updateSublayersRecursively(c,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=hy.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=hy.MATCHED,r!==e&&(e.lifecycle=hy.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=hy.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=hy.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function pc(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!pc(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!pc(t[l],e[l],r-1))return!1;return!0}return!1}class MG{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let l=n.length-1;l>=0;--l){const c=n[l];if(c.containsPixel(i)){const s=e.slice();return s[0]-=c.x,s[1]-=c.y,c.unproject(s,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Pp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!pc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Wr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>this.getView(e.id)?.makeViewport({viewState:l,width:this.width,height:this.height})})}_updateController(e,r,n,i){const l=e.controller;if(l&&n){const c={...r,...l,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==l.type)&&(i=this._createController(e,c)),i&&i.setProps(c),i}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const l=e[i],c=this.getViewState(l),s=l.makeViewport({viewState:c,width:this.width,height:this.height});let m=r[l.id];const b=!!l.controller;b&&!m&&(n=!0),(n||!b)&&m&&(m.finalize(),m=null),this.controllers[l.id]=this._updateController(l,c,s,m),s&&this._viewports.unshift(s)}for(const i in r){const l=r[i];l&&!this.controllers[i]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,i)=>!e[i].equals(r[i]))}}const IG=/([0-9]+\.?[0-9]*)(%|px)/;function up(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=IG.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function hp(t,e){return t.relative?Math.round(t.position*e):t.position}class dB{constructor(e){const{id:r,x:n=0,y:i=0,width:l="100%",height:c="100%",padding:s=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=up(n),this._y=up(i),this._width=up(l),this._height=up(c),this._padding=s&&{left:up(s.left||0),right:up(s.right||0),top:up(s.top||0),bottom:up(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&pc(this.props,e.props,2)}clone(e){const r=this.constructor;return new r({...this.props,...e})}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:r});if(!i.height||!i.width)return null;const l=this.getViewportType(n);return new l({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:hp(this._x,e),y:hp(this._y,r),width:hp(this._width,e),height:hp(this._height,r)};return this._padding&&(n.padding={left:hp(this._padding.left,e),top:hp(this._padding.top,r),right:hp(this._padding.right,e),bottom:hp(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class wT{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const SR=()=>{},kE={BREAK:1,SNAP_TO_END:2,IGNORE:3},RG=t=>t,OG=kE.BREAK;class DG{constructor(e){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:i,startProps:l,endProps:c,duration:s,easing:m}}=r,b=m(n/s),w=i.interpolateProps(l,c,b);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new wT(e.timeline),this.onViewStateChange=e.onViewStateChange||SR,this.onStateChange=e.onStateChange||SR}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:l,endProps:c}=this.transition.settings;i={...n,...l===kE.SNAP_TO_END?c:this.propsInTransition||n}}this._triggerTransition(i,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:n}=e;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===kE.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const n=this.getControllerState(e),i=this.getControllerState(r).shortestPathFrom(n),l=r.transitionInterpolator,c=l.getDuration?l.getDuration(e,r):r.transitionDuration;if(c===0)return;const s=l.initializeProps(e,i);this.propsInTransition={};const m={duration:c,easing:r.transitionEasing||RG,interpolator:l,interruption:r.transitionInterruption||OG,startProps:s.start,endProps:s.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(m),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}}function Ui(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class kG{constructor(e){const{compare:r,extract:n,required:i}=e;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(e,r){for(const n of this._propsToCompare)if(!(n in e)||!(n in r)||!V0(e[n],r[n]))return!1;return!0}initializeProps(e,r){const n={},i={};for(const l of this._propsToExtract)(l in e||l in r)&&(n[l]=e[l],i[l]=r[l]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const n=e[r];Ui(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}}const Jx=Math.PI/180,AR=180/Math.PI,N1=6370972,py=256;function LG(){const t=py/N1,e=Math.PI/180*py;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class EC extends Xy{constructor(e={}){const{longitude:r=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:l=1,resolution:c=10}=e;let{latitude:s=0,height:m,altitude:b=1.5,fovy:w}=e;s=Math.max(Math.min(s,Rh),-Rh),m=m||1,w?b=bC(w):w=H0(b);const E=Math.pow(2,n-gy(s)),O=e.nearZ??i,N=e.farZ??(b+py*2*E/m)*l,V=new Pu().lookAt({eye:[0,-b,0],up:[0,0,1]});V.rotateX(s*Jx),V.rotateZ(-r*Jx),V.scale(E/m),super({...e,height:m,viewMatrix:V,longitude:r,latitude:s,zoom:n,distanceScales:LG(),fovy:w,focalDistance:b,near:O,far:N}),this.scale=E,this.latitude=s,this.longitude=r,this.fovy=w,this.resolution=c}get projectionMode(){return El.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,this.height/2],r),i=this.unproject([this.width/2,0],r),l=this.unproject([this.width,this.height/2],r),c=this.unproject([this.width/2,this.height],r);return l[0]<this.longitude&&(l[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],l[0],i[0],c[0]),Math.min(n[1],l[1],i[1],c[1]),Math.max(n[0],l[0],i[0],c[0]),Math.max(n[1],l[1],i[1],c[1])]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,l,c]=e,s=r?l:this.height-l,{pixelUnprojectionMatrix:m}=this;let b;if(Number.isFinite(c))b=mS(m,[i,s,c,1]);else{const N=mS(m,[i,s,-1,1]),V=mS(m,[i,s,1,1]),W=((n||0)/N1+1)*py,j=nS(Fz([],N,V)),Y=nS(N),ce=nS(V),ue=4*((4*Y*ce-(j-Y-ce)**2)/16)/j,me=Math.sqrt(Y-ue),ge=Math.sqrt(Math.max(0,W*W-ue)),Ce=(me-ge)/Math.sqrt(j);b=z9([],N,V,Ce)}const[w,E,O]=this.unprojectPosition(b);return Number.isFinite(c)?[w,E,O]:Number.isFinite(n)?[w,E,n]:[w,E]}projectPosition(e){const[r,n,i=0]=e,l=r*Jx,c=n*Jx,s=Math.cos(c),m=(i/N1+1)*py;return[Math.sin(l)*s*m,-Math.cos(l)*s*m,Math.sin(c)*m]}unprojectPosition(e){const[r,n,i]=e,l=W9(e),c=Math.asin(i/l),m=Math.atan2(r,-n)*AR,b=c*AR,w=(l/py-1)*N1;return[m,b,w]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition([e,r,n],i,l){const s=.25/Math.pow(2,this.zoom-gy(this.latitude)),m=e+s*(l[0]-i[0]);let b=r-s*(l[1]-i[1]);b=Math.max(Math.min(b,Rh),-Rh);const w={longitude:m,latitude:b,zoom:n-gy(r)};return w.zoom+=gy(w.latitude),w}}EC.displayName="GlobeViewport";function gy(t){const e=Math.PI*Math.cos(t*Math.PI/180);return Math.log2(e)}function mS(t,e){const r=qy([],e,t);return Vz(r,r,1/r[3]),r}const NG=["longitude","latitude","zoom","bearing","pitch"],zG=["longitude","latitude","zoom"];class PC extends kG{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:NG,required:zG},super(n.transitionProps),this.opts=n}initializeProps(e,r){const n=super.initializeProps(e,r),{makeViewport:i,around:l}=this.opts;if(i&&l)if(i(e)instanceof EC)Wr.warn("around not supported in GlobeView")();else{const s=i(e),m=i(r),b=s.unproject(l);n.start.around=l,Object.assign(n.end,{around:m.project(b),aroundPosition:b,width:r.width,height:r.height})}return n}interpolateProps(e,r,n){const i={};for(const l of this._propsToExtract)i[l]=cw(e[l]||0,r[l]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...r,...i});Object.assign(i,l.panByPosition(r.aroundPosition,cw(e.around,r.around,n)))}return i}}const Wf={transitionDuration:0},BG=300,e1=t=>1-(1-t)*(1-t),ay={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Vg={};class pB{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new DG({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:i}=e;return[i.x-r,i.y-n]}isPointInBounds(e,r){const{width:n,height:i}=this.props;if(r&&r.handled)return!1;const l=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return l&&r&&r.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?BG:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:l=!0,doubleClickZoom:c=!0,touchZoom:s=!0,touchRotate:m=!1,keyboard:b=!0}=e,w=!!this.onViewStateChange;this.toggleEvents(ay.WHEEL,w&&n),this.toggleEvents(ay.PAN,w),this.toggleEvents(ay.PINCH,w&&(s||m)),this.toggleEvents(ay.MULTI_PAN,w&&m),this.toggleEvents(ay.DOUBLE_CLICK,w&&c),this.toggleEvents(ay.KEYBOARD,w&&b),this.scrollZoom=n,this.dragPan=i,this.dragRotate=l,this.doubleClickZoom=c,this.touchZoom=s,this.touchRotate=m,this.keyboard=b}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const i={...e.getViewportProps(),...r},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),l){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,Wf,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,Wf,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],l=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:e1},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,Wf,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],l=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:e1},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let c=2/(1+Math.exp(-Math.abs(l*n)));l<0&&c!==0&&(c=1/c);const s=i?{...this._getTransitionProps({around:r}),transitionDuration:250}:Wf,m=this.controllerState.zoom({pos:r,scale:c});return this.updateViewport(m,s,{isZooming:!0,isPanning:!0}),i||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,Wf,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,Wf,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*r/2],l=this.controllerState.rotate({pos:i});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:e1},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Vg._startPinchRotation=e.rotation,Vg._lastPinchEvent=e,this.updateViewport(n,Wf,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:Vg._startPinchRotation-n})}return this.updateViewport(r,Wf,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Vg._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=Vg;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const i=this.getCenter(e);let l=this.controllerState.rotateEnd();const c=Math.log2(e.scale),s=(c-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),m=Math.pow(2,c+s*r/2);l=l.zoom({pos:i,scale:m}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:e1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Vg._startPinchRotation=null,Vg._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:l,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let m;const b={};switch(e.srcEvent.code){case"Minus":m=r?s.zoomOut(n).zoomOut(n):s.zoomOut(n),b.isZooming=!0;break;case"Equal":m=r?s.zoomIn(n).zoomIn(n):s.zoomIn(n),b.isZooming=!0;break;case"ArrowLeft":r?(m=s.rotateLeft(l),b.isRotating=!0):(m=s.moveLeft(i),b.isPanning=!0);break;case"ArrowRight":r?(m=s.rotateRight(l),b.isRotating=!0):(m=s.moveRight(i),b.isPanning=!0);break;case"ArrowUp":r?(m=s.rotateUp(c),b.isRotating=!0):(m=s.moveUp(i),b.isPanning=!0);break;case"ArrowDown":r?(m=s.rotateDown(c),b.isRotating=!0):(m=s.moveDown(i),b.isPanning=!0);break;default:return!1}return this.updateViewport(m,this._getTransitionProps(),b),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?Wf:e?{...r,transitionInterpolator:new PC({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class FG{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const ER=5,jG=1.2;class gB extends FG{constructor(e){const{width:r,height:n,latitude:i,longitude:l,zoom:c,bearing:s=0,pitch:m=0,altitude:b=1.5,position:w=[0,0,0],maxZoom:E=20,minZoom:O=0,maxPitch:N=60,minPitch:V=0,startPanLngLat:W,startZoomLngLat:j,startRotatePos:Y,startBearing:ce,startPitch:re,startZoom:ue,normalize:me=!0}=e;Ui(Number.isFinite(l)),Ui(Number.isFinite(i)),Ui(Number.isFinite(c)),super({width:r,height:n,latitude:i,longitude:l,zoom:c,bearing:s,pitch:m,altitude:b,maxZoom:E,minZoom:O,maxPitch:N,minPitch:V,normalize:me,position:w},{startPanLngLat:W,startZoomLngLat:j,startRotatePos:Y,startBearing:ce,startPitch:re,startZoom:ue}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:l,startPitch:c}=this.getState();if(!i||l===void 0||c===void 0)return this;let s;return e?s=this._getNewRotation(e,i,c,l):s={bearing:l+r,pitch:c+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:l}=this.getState();if(l||(i=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(e)),!l)return this;const{maxZoom:c,minZoom:s}=this.getViewportProps();let m=i+Math.log2(n);m=Ih(m,s,c);const b=this.makeViewport({...this.getViewportProps(),zoom:m});return this._getUpdatedState({zoom:m,...b.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:l}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(l-r.longitude)>180&&(n.longitude=l<0?l+360:l-360),n}applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:i}=e;e.zoom=Ih(i,n,r);const{maxPitch:l,minPitch:c,pitch:s}=e;e.pitch=Ih(s,c,l);const{normalize:m=!0}=e;return m&&Object.assign(e,oX(e)),e}_zoomFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:e})}_panFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,n,i){const l=e[0]-r[0],c=e[1]-r[1],s=e[1],m=r[1],{width:b,height:w}=this.getViewportProps(),E=l/b;let O=0;c>0?Math.abs(w-m)>ER&&(O=c/(m-w)*jG):c<0&&m>ER&&(O=1-s/m),O=Ih(O,-1,1);const{minPitch:N,maxPitch:V}=this.getViewportProps(),W=i+180*E;let j=n;return O>0?j=n+O*(V-n):O<0&&(j=n-O*(N-n)),{pitch:j,bearing:W}}}class UG extends pB{constructor(){super(...arguments),this.ControllerState=gB,this.transition={transitionDuration:300,transitionInterpolator:new PC({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let CC=class extends dB{constructor(e={}){super(e)}getViewportType(){return gm}get ControllerType(){return UG}};CC.displayName="MapView";const VG=new oB;function $G(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class WG{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(i=>$G(i,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(pc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const i of this.effects)r[i.id]=i;const n=[];for(const i of e){const l=r[i.id];let c=i;l&&l!==i?l.setProps?(l.setProps(i.props),c=l):l.cleanup(this._context):l||i.setup(this._context),n.push(c),delete r[i.id]}for(const i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof oB)||this._resolvedEffects.push(VG),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class HG extends wC{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const qG="deckRenderer.renderLayers";class XG{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new HG(e),this.pickLayersPass=new hB(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const l=r.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Xa(qG,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize(),[n,i]=r;e.length===0&&[0,1].map(l=>{const c=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${l}`,colorAttachments:[c]}))});for(const l of e)l.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const l of e)if(l.postRender){i.target=l.id===this.lastPostProcessEffect?r.target:void 0;const c=l.postRender(i);i.inputBuffer=c,i.swapBuffer=c===n[0]?n[1]:n[0]}}}const GG={pickedColor:null,pickedObjectIndex:-1};function PR({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:l}){const{x:c,y:s,width:m,height:b}=l;let w=i*i,E=-1,O=0;for(let N=0;N<b;N++){const V=N+s-n,W=V*V;if(W>w)O+=4*m;else for(let j=0;j<m;j++){if(t[O+3]-1>=0){const ce=j+c-r,re=ce*ce+W;re<=w&&(w=re,E=O)}O+=4}}if(E>=0){const N=t.slice(E,E+4),V=e(N);if(V){const W=Math.floor(E/4/m),j=E/4-W*m;return{...V,pickedColor:N,pickedX:c+j,pickedY:s+W}}Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return GG}function CR({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const l=t.slice(n,n+4),c=l.join(",");if(!r.has(c)){const s=e(l);s?r.set(c,{...s,color:l}):Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function LE({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:i,z:l}){let c=e[0];e.length>1&&(c=ZG(t?.pickedViewports||e,{x:n,y:i}));let s;if(c){const m=[n-c.x,i-c.y];l!==void 0&&(m[2]=l),s=c.unproject(m)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:s,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function MR(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:i}=t,{pickedColor:l,pickedLayer:c,pickedObjectIndex:s}=e,m=c?[c]:[];if(n==="hover"){const E=r.index,O=r.layerId,N=c?c.props.id:null;if(N!==O||s!==E){if(N!==O){const V=i.find(W=>W.props.id===O);V&&m.unshift(V)}r.layerId=N,r.index=s,r.info=null}}const b=LE(t),w=new Map;return w.set(null,b),m.forEach(E=>{let O={...b};E===c&&(O.color=l,O.index=s,O.picked=!0),O=NE({layer:E,info:O,mode:n});const N=O.layer;E===c&&n==="hover"&&(r.info=O),w.set(N.id,O),n==="hover"&&N.updateAutoHighlight(O)}),w}function NE({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function ZG(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class YG{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new hB(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:i},l=this.lastPickedInfo.info){const c=l&&l.layer&&l.layer.id,s=l&&l.viewport&&l.viewport.id,m=c?n.find(O=>O.id===c):null,b=s&&i.find(O=>O.id===s)||i[0],w=b&&b.unproject([e-b.x,r-b.y]);return{...l,...{x:e,y:r,viewport:b,coordinate:w,layer:m}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}async _pickClosestObjectAsync({layers:e,views:r,viewports:n,x:i,y:l,radius:c=0,depth:s=1,mode:m="query",unproject3D:b,onViewportActive:w,effects:E}){const O=this.device.canvasContext.cssToDeviceRatio(),N=this._getPickable(e);if(!N||n.length===0)return{result:[],emptyInfo:LE({viewports:n,x:i,y:l,pixelRatio:O})};this._resizeBuffer();const V=this.device.canvasContext.cssToDevicePixels([i,l],!0),W=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],j=Math.round(c*O),{width:Y,height:ce}=this.pickingFBO,re=this._getPickingRect({deviceX:W[0],deviceY:W[1],deviceRadius:j,deviceWidth:Y,deviceHeight:ce}),ue={x:i-c,y:l-c,width:c*2+1,height:c*2+1};let me;const ge=[],Ce=new Set;for(let We=0;We<s;We++){let Xe;if(re){const gt=this._drawAndSample({layers:N,views:r,viewports:n,onViewportActive:w,deviceRect:re,cullRect:ue,effects:E,pass:`picking:${m}`});Xe=PR({...gt,deviceX:W[0],deviceY:W[1],deviceRadius:j,deviceRect:re})}else Xe={pickedColor:null,pickedObjectIndex:-1};let Et;if(Xe.pickedLayer&&b&&this.depthFBO){const{pickedColors:gt}=this._drawAndSample({layers:[Xe.pickedLayer],views:r,viewports:n,onViewportActive:w,deviceRect:{x:Xe.pickedX,y:Xe.pickedY,width:1,height:1},cullRect:ue,effects:E,pass:`picking:${m}:z`},!0);gt[3]&&(Et=gt[0])}Xe.pickedLayer&&We+1<s&&(Ce.add(Xe.pickedLayer),Xe.pickedLayer.disablePickingIndex(Xe.pickedObjectIndex)),me=MR({pickInfo:Xe,lastPickedInfo:this.lastPickedInfo,mode:m,layers:N,viewports:n,x:i,y:l,z:Et,pixelRatio:O});for(const gt of me.values())gt.layer&&ge.push(gt);if(!Xe.pickedColor)break}for(const We of Ce)We.restorePickingColors();return{result:ge,emptyInfo:me.get(null)}}_pickClosestObject({layers:e,views:r,viewports:n,x:i,y:l,radius:c=0,depth:s=1,mode:m="query",unproject3D:b,onViewportActive:w,effects:E}){const O=this.device.canvasContext.cssToDeviceRatio(),N=this._getPickable(e);if(!N||n.length===0)return{result:[],emptyInfo:LE({viewports:n,x:i,y:l,pixelRatio:O})};this._resizeBuffer();const V=this.device.canvasContext.cssToDevicePixels([i,l],!0),W=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],j=Math.round(c*O),{width:Y,height:ce}=this.pickingFBO,re=this._getPickingRect({deviceX:W[0],deviceY:W[1],deviceRadius:j,deviceWidth:Y,deviceHeight:ce}),ue={x:i-c,y:l-c,width:c*2+1,height:c*2+1};let me;const ge=[],Ce=new Set;for(let We=0;We<s;We++){let Xe;if(re){const gt=this._drawAndSample({layers:N,views:r,viewports:n,onViewportActive:w,deviceRect:re,cullRect:ue,effects:E,pass:`picking:${m}`});Xe=PR({...gt,deviceX:W[0],deviceY:W[1],deviceRadius:j,deviceRect:re})}else Xe={pickedColor:null,pickedObjectIndex:-1};let Et;if(Xe.pickedLayer&&b&&this.depthFBO){const{pickedColors:gt}=this._drawAndSample({layers:[Xe.pickedLayer],views:r,viewports:n,onViewportActive:w,deviceRect:{x:Xe.pickedX,y:Xe.pickedY,width:1,height:1},cullRect:ue,effects:E,pass:`picking:${m}:z`},!0);gt[3]&&(Et=gt[0])}Xe.pickedLayer&&We+1<s&&(Ce.add(Xe.pickedLayer),Xe.pickedLayer.disablePickingIndex(Xe.pickedObjectIndex)),me=MR({pickInfo:Xe,lastPickedInfo:this.lastPickedInfo,mode:m,layers:N,viewports:n,x:i,y:l,z:Et,pixelRatio:O});for(const gt of me.values())gt.layer&&ge.push(gt);if(!Xe.pickedColor)break}for(const We of Ce)We.restorePickingColors();return{result:ge,emptyInfo:me.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:r,viewports:n,x:i,y:l,width:c=1,height:s=1,mode:m="query",maxObjects:b=null,onViewportActive:w,effects:E}){const O=this._getPickable(e);if(!O||n.length===0)return[];this._resizeBuffer();const N=this.device.canvasContext.cssToDeviceRatio(),V=this.device.canvasContext.cssToDevicePixels([i,l],!0),W=V.x,j=V.y+V.height,Y=this.device.canvasContext.cssToDevicePixels([i+c,l+s],!0),ce=Y.x+Y.width,re=Y.y,ue={x:W,y:re,width:ce-W,height:j-re},me=this._drawAndSample({layers:O,views:r,viewports:n,onViewportActive:w,deviceRect:ue,cullRect:{x:i,y:l,width:c,height:s},effects:E,pass:`picking:${m}`}),ge=CR(me),Ce=new Map,We=[],Xe=Number.isFinite(b);for(let Et=0;Et<ge.length&&!(Xe&&We.length>=b);Et++){const gt=ge[Et];let Ye={color:gt.pickedColor,layer:null,index:gt.pickedObjectIndex,picked:!0,x:i,y:l,pixelRatio:N};Ye=NE({layer:gt.pickedLayer,info:Ye,mode:m});const jt=Ye.layer.id;Ce.has(jt)||Ce.set(jt,new Set);const St=Ce.get(jt),Zt=Ye.object??Ye.index;St.has(Zt)||(St.add(Zt),We.push(Ye))}return We}_pickVisibleObjects({layers:e,views:r,viewports:n,x:i,y:l,width:c=1,height:s=1,mode:m="query",maxObjects:b=null,onViewportActive:w,effects:E}){const O=this._getPickable(e);if(!O||n.length===0)return[];this._resizeBuffer();const N=this.device.canvasContext.cssToDeviceRatio(),V=this.device.canvasContext.cssToDevicePixels([i,l],!0),W=V.x,j=V.y+V.height,Y=this.device.canvasContext.cssToDevicePixels([i+c,l+s],!0),ce=Y.x+Y.width,re=Y.y,ue={x:W,y:re,width:ce-W,height:j-re},me=this._drawAndSample({layers:O,views:r,viewports:n,onViewportActive:w,deviceRect:ue,cullRect:{x:i,y:l,width:c,height:s},effects:E,pass:`picking:${m}`}),ge=CR(me),Ce=new Map,We=[],Xe=Number.isFinite(b);for(let Et=0;Et<ge.length&&!(Xe&&We.length>=b);Et++){const gt=ge[Et];let Ye={color:gt.pickedColor,layer:null,index:gt.pickedObjectIndex,picked:!0,x:i,y:l,pixelRatio:N};Ye=NE({layer:gt.pickedLayer,info:Ye,mode:m});const jt=Ye.layer.id;Ce.has(jt)||Ce.set(jt,new Set);const St=Ce.get(jt),Zt=Ye.object??Ye.index;St.has(Zt)||(St.add(Zt),We.push(Ye))}return We}async _drawAndSampleAsync({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:l,cullRect:c,effects:s,pass:m},b=!1){const w=b?this.depthFBO:this.pickingFBO,E={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:w,deviceRect:l,cullRect:c,effects:s,pass:m,pickZ:b,preRenderStats:{},isPicking:!0};for(const ce of s)ce.useInPicking&&(E.preRenderStats[ce.id]=ce.preRender(E));const{decodePickingColor:O}=this.pickLayersPass.render(E),{x:N,y:V,width:W,height:j}=l,Y=new(b?Float32Array:Uint8Array)(W*j*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:N,sourceY:V,sourceWidth:W,sourceHeight:j,target:Y}),{pickedColors:Y,decodePickingColor:O}}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:l,cullRect:c,effects:s,pass:m},b=!1){const w=b?this.depthFBO:this.pickingFBO,E={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:w,deviceRect:l,cullRect:c,effects:s,pass:m,pickZ:b,preRenderStats:{},isPicking:!0};for(const ce of s)ce.useInPicking&&(E.preRenderStats[ce.id]=ce.preRender(E));const{decodePickingColor:O}=this.pickLayersPass.render(E),{x:N,y:V,width:W,height:j}=l,Y=new(b?Float32Array:Uint8Array)(W*j*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:N,sourceY:V,sourceWidth:W,sourceHeight:j,target:Y}),{pickedColors:Y,decodePickingColor:O}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:l}){const c=Math.max(0,e-n),s=Math.max(0,r-n),m=Math.min(i,e+n+1)-c,b=Math.min(l,r+n+1)-s;return m<=0||b<=0?null:{x:c,y:s,width:m,height:b}}}const KG={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},QG="top-left",IR="root";class JG{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,r?.classList.add("deck-widget-container"),this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!pc(e.widgets,this.widgets,1)){const r=e.widgets.filter(Boolean);this._setWidgets(r)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:r}){const n=e.reduce((i,l)=>(i[l.id]=l,i),{});for(const i of this.getWidgets()){const{viewId:l}=i;if(l){const c=n[l];c&&(i.onViewportChange&&i.onViewportChange(c),i.onRedraw?.({viewports:[c],layers:r}))}else{if(i.onViewportChange)for(const c of e)i.onViewportChange(c);i.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){for(const n of this.getWidgets()){const{viewId:i}=n;(!i||i===e.viewport?.id)&&n.onHover?.(e,r)}}onEvent(e,r){const n=ME[r.type];if(n)for(const i of this.getWidgets()){const{viewId:l}=i;(!l||l===e.viewport?.id)&&i[n]?.(e,r)}}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._removeWidget(i),this._addWidget(n)):n!==i&&(i.setProps(n.props),n=i):this._addWidget(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const i=r[n];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){const{viewId:r=null,placement:n=QG}=e,i=e.props._container??r;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:r}),e.rootElement&&this._getContainer(i,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,r){if(e&&typeof e!="string")return e;const n=e||IR;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let l=i.querySelector(`.${r}`);return l||(l=globalThis.document.createElement("div"),l.className=r,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,KG[r]),i.append(l)),l}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,l=n===IR||i,c=this.containers[n];l?(c.style.display="block",c.style.left=`${i?i.x:0}px`,c.style.top=`${i?i.y:0}px`,c.style.width=`${i?i.width:e}px`,c.style.height=`${i?i.height:r}px`):c.style.display="none"}}}function RR(t,e){e&&Object.entries(e).map(([r,n])=>{r.startsWith("--")?t.style.setProperty(r,n):t.style[r]=n})}function eZ(t,e){e&&Object.keys(e).map(r=>{r.startsWith("--")?t.style.removeProperty(r):t.style[r]=""})}class MC{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const r=this.props,n=this.rootElement;n&&r.className!==e.className&&(r.className&&n.classList.remove(r.className),e.className&&n.classList.add(e.className)),n&&!pc(r.style,e.style,1)&&(eZ(n,r.style),RR(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],r=document.createElement("div");return e.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>r.classList.add(n)),RR(r,this.props.style),r}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,r){}onClick(e,r){}onDrag(e,r){}onDragStart(e,r){}onDragEnd(e,r){}}MC.defaultProps={id:"widget",style:{},_container:null,className:""};const tZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class mB extends MC{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,tZ),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const i=n(e);this.setTooltip(i,e.x,e.y)}setTooltip(e,r,n){const i=this.rootElement;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}mB.defaultProps={...MC.defaultProps};const rZ="modulepreload",nZ=function(t){return"/urban-renewal-cooling-DID/"+t},OR={},DR=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let b=function(w){return Promise.all(w.map(E=>Promise.resolve(E).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};var c=b;document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),m=s?.nonce||s?.getAttribute("nonce");i=b(r.map(w=>{if(w=nZ(w),w in OR)return;OR[w]=!0;const E=w.endsWith(".css"),O=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${O}`))return;const N=document.createElement("link");if(N.rel=E?"stylesheet":rZ,E||(N.as="script"),N.crossOrigin="",N.href=w,m&&N.setAttribute("nonce",m),document.head.appendChild(N),E)return new Promise((V,W)=>{N.addEventListener("load",V),N.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${w}`)))})}))}function l(s){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=s,window.dispatchEvent(m),!m.defaultPrevented)throw s}return i.then(s=>{for(const m of s||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})};var my;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(my||(my={}));const iZ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},sZ=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),aZ=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),oZ=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function lZ(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&cZ(i),i}return this.originalGetContext(r,n)}}function cZ(t){t.getExtension("EXT_color_buffer_float");const e={...iZ,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:sZ(t),OES_vertex_array_object:aZ(t),ANGLE_instanced_arrays:oZ(t)},r=t.getExtension;t.getExtension=function(i){const l=r.call(t,i);return l||(i in e?e[i]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(n.apply(t)||[])?.concat(Object.keys(e))}}async function _B(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((i,l)=>{n.onload=i,n.onerror=c=>l(new Error(`Unable to load script '${t}': ${c}`)),r.appendChild(n)})}const uZ=1;let xl=null,kR=!1;const IC={debugSpectorJS:Bt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function hZ(t){if(!globalThis.SPECTOR)try{await _B(t.debugSpectorJSUrl||IC.debugSpectorJSUrl)}catch(e){Bt.warn(String(e))}}function fZ(t){if(t={...IC,...t},!t.debugSpectorJS)return null;if(!xl&&globalThis.SPECTOR&&!globalThis.luma?.spector){Bt.probe(uZ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;xl=new e,globalThis.luma&&(globalThis.luma.spector=xl)}if(!xl)return null;if(kR||(kR=!0,xl.spyCanvases(),xl?.onCaptureStarted.add(e=>Bt.info("Spector capture started:",e)()),xl?.onCapture.add(e=>{Bt.info("Spector capture complete:",e)(),xl?.getResultUI(),xl?.resultView.display(),xl?.resultView.addCapture(e)})),t.gl){const e=t.gl,r=e.device;xl?.startCapture(t.gl,500),e.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Bt.info("Spector capture stopped after 2 seconds")(),xl?.stopCapture()})}return xl}const dZ="https://unpkg.com/webgl-debug@2.0.1/index.js";function yB(t){return t.luma=t.luma||{},t.luma}async function pZ(){Sm()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await _B(dZ))}function gZ(t,e={}){return e.debugWebGL||e.traceWebGL?_Z(t,e):mZ(t)}function mZ(t){const e=yB(t);return e.realContext?e.realContext:t}function _Z(t,e){if(!globalThis.WebGLDebugUtils)return Bt.warn("webgl-debug not loaded")(),t;const r=yB(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...my,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,yZ.bind(null,e),vZ.bind(null,e));for(const c in my)!(c in n)&&typeof my[c]=="number"&&(n[c]=my[c]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,n);const l=Object.create(i);return r.realContext=t,r.debugContext=l,l.debug=!0,l}function LR(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function yZ(t,e,r,n){n=Array.from(n).map(s=>s===void 0?"undefined":s);const i=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),c=`${i} in gl.${r}(${l})`;Bt.error(c)();debugger}function vZ(t,e,r){let n="";Bt.level>=1&&(n=LR(e,r),t.traceWebGL&&Bt.log(1,n)());for(const i of r)if(i===void 0){n=n||LR(e,r);debugger}}const t1=1;class bZ extends aW{type="webgl";constructor(){super(),hm.defaultProps={...hm.defaultProps,...IC}}enforceWebGL2(e){lZ(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&Bt.warn("WebGL1 is not supported",e)(),!1)}async attach(e,r={}){const{WebGLDevice:n}=await DR(async()=>{const{WebGLDevice:l}=await Promise.resolve().then(()=>KR);return{WebGLDevice:l}},void 0);if(e instanceof n)return e;if(e?.device instanceof n)return e.device;if(!xZ(e))throw new Error("Invalid WebGL2RenderingContext");const i=r.createCanvasContext===!0?{}:r.createCanvasContext;return new n({...r,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:r}=await DR(async()=>{const{WebGLDevice:n}=await Promise.resolve().then(()=>KR);return{WebGLDevice:n}},void 0);Bt.groupCollapsed(t1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(pZ()),e.debugSpectorJS&&n.push(hZ(e));const i=await Promise.allSettled(n);for(const s of i)s.status==="rejected"&&Bt.error(`Failed to initialize debug libraries ${s.reason}`)();const l=new r(e),c=`${l._reused?"Reusing":"Created"} device with WebGL2 ${l.props.debug?"debug ":""}context: ${l.info.vendor}, ${l.info.renderer} for canvas: ${l.canvasContext.id}`;return Bt.probe(t1,c)(),Bt.table(t1,l.info)(),l}finally{Bt.groupEnd(t1)()}}}function xZ(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const _S=new bZ,RC={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},es=(t,e,r)=>e?t.enable(r):t.disable(r),NR=(t,e,r)=>t.hint(r,e),wl=(t,e,r)=>t.pixelStorei(r,e),zR=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},l0=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function yS(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const wZ={3042:es,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:es,2885:(t,e)=>t.cullFace(e),2929:es,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:es,35723:NR,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:zR,36010:zR,34964:l0,36662:l0,36663:l0,35053:l0,35055:l0,2886:(t,e)=>t.frontFace(e),33170:NR,2849:(t,e)=>t.lineWidth(e),32823:es,32824:"polygonOffset",10752:"polygonOffset",35977:es,32926:es,32928:es,32938:"sampleCoverage",32939:"sampleCoverage",3089:es,3088:(t,e)=>t.scissor(...e),2960:es,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:es,10754:es,12288:es,12289:es,12290:es,12291:es,12292:es,12293:es,12294:es,12295:es,3333:wl,3317:wl,37440:wl,37441:wl,37443:wl,3330:wl,3332:wl,3331:wl,3314:wl,32878:wl,3316:wl,3315:wl,32877:wl,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=yS(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=yS(e)&&e.length===3?[...e,...e]:e;const[r,n,i,l,c,s]=e;t.stencilFuncSeparate(1028,r,n,i),t.stencilFuncSeparate(1029,l,c,s)},stencilOp:(t,e)=>{e=yS(e)&&e.length===3?[...e,...e]:e;const[r,n,i,l,c,s]=e;t.stencilOpSeparate(1028,r,n,i),t.stencilOpSeparate(1029,l,c,s)},viewport:(t,e)=>t.viewport(...e)};function zi(t,e,r){return e[t]!==void 0?e[t]:r[t]}const TZ={blendEquation:(t,e,r)=>t.blendEquationSeparate(zi(32777,e,r),zi(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(zi(32969,e,r),zi(32968,e,r),zi(32971,e,r),zi(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(zi(32824,e,r),zi(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(zi(32938,e,r),zi(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,zi(2962,e,r),zi(2967,e,r),zi(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,zi(34816,e,r),zi(36003,e,r),zi(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,zi(2964,e,r),zi(2965,e,r),zi(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,zi(34817,e,r),zi(34818,e,r),zi(34819,e,r))},BR={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,i)=>t({32773:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,i)=>t({32969:e,32968:r,32971:n,32970:i}),clearColor:(t,e,r,n,i)=>t({3106:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,i)=>t({3107:[e,r,n,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,i)=>t({3088:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(t,e,r,n,i)=>t({2978:[e,r,n,i]})},wh=(t,e)=>t.isEnabled(e),FR={3042:wh,2884:wh,2929:wh,3024:wh,32823:wh,32926:wh,32928:wh,3089:wh,2960:wh,35977:wh},SZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Gy(t,e){if(EZ(e))return;const r={};for(const i in e){const l=Number(i),c=wZ[i];c&&(typeof c=="string"?r[c]=!0:c(t,e[i],l))}const n=t.state&&t.state.cache;if(n)for(const i in r){const l=TZ[i];l(t,e,n)}}function vB(t,e=RC){if(typeof e=="number"){const i=e,l=FR[i];return l?l(t,i):t.getParameter(i)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const i of r){const l=FR[i];n[i]=l?l(t,Number(i)):t.getParameter(Number(i))}return n}function AZ(t){Gy(t,RC)}function EZ(t){for(const e in t)return!1;return!0}function PZ(t,e){if(t===e)return!0;if(jR(t)&&jR(e)&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function jR(t){return Array.isArray(t)||ArrayBuffer.isView(t)}class sm{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Gy(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r?.copyState?vB(e):Object.assign({},RC),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,MZ(e);for(const n in BR){const i=BR[n];CZ(e,n,i)}UR(e,"getParameter"),UR(e,"isEnabled")}_updateCache(e){let r=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){const c=e[l],s=this.cache[l];PZ(c,s)||(r=!0,n=s,i&&!(l in i)&&(i[l]=s),this.cache[l]=c)}return{valueChanged:r,oldValue:n}}}function UR(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||SZ.has(i))return r(i);const l=sm.get(t);return i in l.cache||(l.cache[i]=r(i)),l.enable?l.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function CZ(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...l){const c=sm.get(t),{valueChanged:s,oldValue:m}=r(c._updateCache,...l);return s&&n(...l),m},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function MZ(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const i=sm.get(t);i.program!==n&&(e(n),i.program=n)}}function IZ(t,e,r){let n="";const i={preserveDrawingBuffer:!0,...r};let l=null;if(l||=t.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!l&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,l=t.getContext("webgl2",i),l.luma||={},l.luma.softwareRenderer=!0),l||(l=t.getContext("webgl",{}),l&&(l=null,n||="Your browser only supports WebGL1")),!l)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:c,onContextRestored:s}=e;return t.addEventListener("webglcontextlost",m=>c(m),!1),t.addEventListener("webglcontextrestored",m=>s(m),!1),l.luma||={},l}function zy(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function RZ(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);zy(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,l=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),s=l||r,m=c||n,b=t.getParameter(7938),w=bB(s,m),E=OZ(s,m),O=DZ(s,m);return{type:"webgl",gpu:w,gpuType:O,gpuBackend:E,vendor:s,renderer:m,version:b,shadingLanguage:"glsl",shadingLanguageVersion:300}}function bB(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function OZ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function DZ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(bB(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function xB(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const T0="WEBGL_compressed_texture_s3tc",S0="WEBGL_compressed_texture_s3tc_srgb",_y="EXT_texture_compression_rgtc",yy="EXT_texture_compression_bptc",kZ="WEBGL_compressed_texture_etc",LZ="WEBGL_compressed_texture_astc",NZ="WEBGL_compressed_texture_etc1",zZ="WEBGL_compressed_texture_pvrtc",BZ="WEBGL_compressed_texture_atc",VR="EXT_texture_norm16",$R="EXT_render_snorm",FZ="EXT_color_buffer_float",OC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[$R],"norm16-renderable-webgl":[VR],"snorm16-renderable-webgl":[VR,$R],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[T0,S0,_y,yy],"texture-compression-bc5-webgl":[_y],"texture-compression-bc7-webgl":[yy],"texture-compression-etc2":[kZ],"texture-compression-astc":[LZ],"texture-compression-etc1-webgl":[NZ],"texture-compression-pvrtc-webgl":[zZ],"texture-compression-atc-webgl":[BZ]};function jZ(t){return t in OC}function UZ(t,e,r){return(OC[e]||[]).every(i=>zy(t,i,r))}const DC={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:FZ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:T0},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:S0},"bc1-rgba-unorm":{gl:33777,x:T0},"bc1-rgba-unorm-srgb":{gl:35916,x:S0},"bc2-rgba-unorm":{gl:33778,x:T0},"bc2-rgba-unorm-srgb":{gl:35918,x:S0},"bc3-rgba-unorm":{gl:33779,x:T0},"bc3-rgba-unorm-srgb":{gl:35919,x:S0},"bc4-r-unorm":{gl:36283,x:_y},"bc4-r-snorm":{gl:36284,x:_y},"bc5-rg-unorm":{gl:36285,x:_y},"bc5-rg-snorm":{gl:36286,x:_y},"bc6h-rgb-ufloat":{gl:36495,x:yy},"bc6h-rgb-float":{gl:36494,x:yy},"bc7-rgba-unorm":{gl:36492,x:yy},"bc7-rgba-unorm-srgb":{gl:36493,x:yy},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function VZ(t,e,r){let n=e.create;const i=DC[e.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!zy(t,i.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function wB(t){const e=DC[t],r=HZ(t),n=Ty.getInfo(t);return n.compressed&&(e.dataFormat=r),{internalFormat:r,format:e?.dataFormat||WZ(n.channels,n.integer,n.normalized,r),type:n.dataType?xB(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function $Z(t){switch(Ty.getInfo(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function WZ(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function HZ(t){const r=DC[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}const WR={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class qZ extends iW{gl;extensions;testedFeatures=new Set;constructor(e,r,n){super([],n),this.gl=e,this.extensions=r,zy(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),jZ(e)&&UZ(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(WR),...Object.keys(OC)]}getWebGLFeature(e){const r=WR[e];return typeof r=="string"?!!zy(this.gl,r,this.extensions):!!r}}class XZ extends nW{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class k0 extends bT{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);const n=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const n=this.colorAttachments[r];if(n){const i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){const r=$Z(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${ZZ(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){const{gl:n}=this.device,{texture:i}=r,l=r.props.baseMipLevel,c=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,l,c);break;case 34067:const s=GZ(c);n.framebufferTexture2D(36160,e,s,i.handle,l);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,l);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}function GZ(t){return t<34069?t+34069:t}function ZZ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class YZ extends Yg{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new k0(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const vS={};function KZ(t="id"){vS[t]=vS[t]||1;const e=vS[t]++;return`${t}-${e}`}class L0 extends Ai{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=QZ(this.props.usage),this.glUsage=JZ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,r=0,n=e.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,r=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,r,n),this.gl.bindBuffer(i,null),this._setDebugData(e,r,e.byteLength)}async mapAndWriteAsync(e,r=0,n=this.byteLength-r){const i=new ArrayBuffer(n);await e(i,"copied"),this.write(i,r)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}async mapAndReadAsync(e,r=0,n){const i=await this.readAsync(r,n);return await e(i.buffer,"copied")}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,r),n}}function QZ(t){return t&Ai.INDEX?34963:t&Ai.VERTEX?34962:t&Ai.UNIFORM?35345:34962}function JZ(t){return t&Ai.INDEX||t&Ai.VERTEX?35044:t&Ai.UNIFORM?35048:35044}function eY(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[E,O]=i;r.push({message:O.trim(),type:HR(E),lineNum:0,linePos:0});continue}const[l,c,s,...m]=i;let b=parseInt(s,10);isNaN(b)&&(b=0);let w=parseInt(c,10);isNaN(w)&&(w=0),r.push({message:m.join(":").trim(),type:HR(l),lineNum:b,linePos:w})}return r}function HR(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class tY extends vT{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?eY(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Bt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Bt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(l=>setTimeout(l,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function rY(t,e,r,n){if(aY(e))return n(t);const i=t;i.pushState();try{return nY(t,e),Gy(i.gl,r),n(t)}finally{i.popState()}}function nY(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(am("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const l=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=am("provokingVertex",e.provokingVertex,{first:36429,last:36430});l?.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const l=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=am("polygonMode",e.polygonMode,{fill:6914,line:6913});l?.polygonModeWEBGL(1028,c),l?.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(sY("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(zE("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Bt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,l=zE("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,l,0,i),n.stencilFuncSeparate(1029,l,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=bS("stencilPassOperation",e.stencilPassOperation),l=bS("stencilFailOperation",e.stencilFailOperation),c=bS("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,l,c,i),n.stencilOpSeparate(1029,l,c,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=qR("blendColorOperation",e.blendColorOperation||"add"),l=qR("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,l);const c=r1("blendColorSrcFactor",e.blendColorSrcFactor||"one"),s=r1("blendColorDstFactor",e.blendColorDstFactor||"zero"),m=r1("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),b=r1("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(c,s,m,b)}}function zE(t,e){return am(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function bS(t,e){return am(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function qR(t,e){return am(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function r1(t,e,r="color"){return am(t,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:r==="color"?32769:32771,"one-minus-constant":r==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function iY(t,e){return`Illegal parameter ${e} for ${t}`}function am(t,e,r){if(!(e in r))throw new Error(iY(t,e));return r[e]}function sY(t,e){return e}function aY(t){let e=!0;for(const r in t){e=!1;break}return e}function TB(t){const e={};return t.addressModeU&&(e[10242]=xS(t.addressModeU)),t.addressModeV&&(e[10243]=xS(t.addressModeV)),t.addressModeW&&(e[32882]=xS(t.addressModeW)),t.magFilter&&(e[10240]=BE(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=oY(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=zE("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function xS(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function BE(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function oY(t,e="none"){if(!e)return BE(t);switch(e){case"none":return BE(t);case"nearest":switch(t){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(t){case"nearest":return 9986;case"linear":return 9987}}}class lY extends fm{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=TB(r),this.handle=r.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,n]of Object.entries(e)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}function q0(t,e,r){if(cY(e))return r(t);const{nocatch:n=!0}=e,i=sm.get(t);i.push(),Gy(t,e);let l;if(n)l=r(t),i.pop();else try{l=r(t)}finally{i.pop()}return l}function cY(t){for(const e in t)return!1;return!0}class vy extends yT{device;gl;handle;texture;constructor(e,r){super(e,{...ys.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}class N0 extends ys{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,r){super(e,r),this.device=e,this.gl=this.device.gl;const n=wB(this.props.format);this.glTarget=uY(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:i,width:l,height:c,depth:s,mipLevels:m,glTarget:b,glInternalFormat:w}=this;switch(i){case"2d":case"cube":this.gl.texStorage2D(b,m,w,l,c);break;case"2d-array":case"3d":this.gl.texStorage3D(b,m,w,l,c,s);break;default:throw new Error(i)}this.gl.bindTexture(this.glTarget,null),this._initializeData(r.data),this.setSampler(this.props.sampler),this.view=new vy(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new vy(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const r=TB(this.sampler.props);this._setSamplerParameters(r)}copyImageData(e){const r=this._normalizeCopyImageDataOptions(e),n=r.data,{width:i,height:l,depth:c}=this,{mipLevel:s=0,byteOffset:m=0,x:b=0,y:w=0,z:E=0}=r,{glFormat:O,glType:N,compressed:V}=this,W=XR(this.glTarget,this.dimension,E);let j;if(!this.compressed){const{bytesPerPixel:ce}=this.device.getTextureFormatInfo(this.format);if(ce){if(r.bytesPerRow%ce!==0)throw new Error(`bytesPerRow (${r.bytesPerRow}) must be a multiple of bytesPerPixel (${ce}) for ${this.format}`);j=r.bytesPerRow/ce}}const Y=this.compressed?{}:{...j!==void 0?{3314:j}:{},32878:r.rowsPerImage};this.gl.bindTexture(W,this.handle),q0(this.gl,Y,()=>{switch(this.dimension){case"2d":case"cube":V?this.gl.compressedTexSubImage2D(W,s,b,w,i,l,O,n,m):this.gl.texSubImage2D(W,s,b,w,i,l,O,N,n,m);break;case"2d-array":case"3d":V?this.gl.compressedTexSubImage3D(W,s,b,w,E,i,l,c,O,n,m):this.gl.texSubImage3D(W,s,b,w,E,i,l,c,O,N,n,m);break;default:}}),this.gl.bindTexture(W,null)}copyExternalImage(e){const r=this._normalizeCopyExternalImageOptions(e);if(r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:i}=this,{image:l,depth:c,mipLevel:s,x:m,y:b,z:w,width:E,height:O}=r,N=XR(this.glTarget,this.dimension,c),V=r.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),q0(this.gl,V,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(N,s,m,b,E,O,n,i,l);break;case"2d-array":case"3d":this.gl.texSubImage3D(N,s,m,b,w,E,O,c,n,i,l);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:r.width,height:r.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Bt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Bt.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Bt.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,n]of Object.entries(e)){const i=Number(r),l=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,l);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,i,l);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,i,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,l);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,i,l);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:r}=this;return e!==void 0&&(this._textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:r}=this;return e!==void 0&&(this._textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}}function uY(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function XR(t,e,r){return e==="cube"?34069+r:t}function hY(t){return gY[t]}function kC(t){return pY[t]}function fY(t){return!!SB[t]}function dY(t){return SB[t]}const pY={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},SB={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},gY={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function mY(t,e){const r={attributes:[],bindings:[]};r.attributes=_Y(t,e);const n=bY(t,e);for(const s of n){const m=s.uniforms.map(b=>({name:b.name,format:b.format,byteOffset:b.byteOffset,byteStride:b.byteStride,arrayLength:b.arrayLength}));r.bindings.push({type:"uniform",name:s.name,group:0,location:s.location,visibility:(s.vertex?1:0)&(s.fragment?2:0),minBindingSize:s.byteLength,uniforms:m})}const i=vY(t,e);let l=0;for(const s of i)if(fY(s.type)){const{viewDimension:m,sampleType:b}=dY(s.type);r.bindings.push({type:"texture",name:s.name,group:0,location:l,viewDimension:m,sampleType:b}),s.textureUnit=l,l+=1}i.length&&(r.uniforms=i);const c=yY(t,e);return c?.length&&(r.varyings=c),r}function _Y(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const l=t.getActiveAttrib(e,i);if(!l)throw new Error("activeInfo");const{name:c,type:s}=l,m=t.getAttribLocation(e,c);if(m>=0){const b=kC(s),w=/instance/i.test(c)?"instance":"vertex";r.push({name:c,location:m,stepMode:w,type:b})}}return r.sort((i,l)=>i.location-l.location),r}function yY(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let i=0;i<n;i++){const l=t.getTransformFeedbackVarying(e,i);if(!l)throw new Error("activeInfo");const{name:c,type:s,size:m}=l,b=kC(s),{type:w,components:E}=hz(b);r.push({location:i,name:c,type:w,size:m*E})}return r.sort((i,l)=>i.location-l.location),r}function vY(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let i=0;i<n;i++){const l=t.getActiveUniform(e,i);if(!l)throw new Error("activeInfo");const{name:c,size:s,type:m}=l,{name:b,isArray:w}=xY(c);let E=t.getUniformLocation(e,b);const O={location:E,name:b,size:s,type:m,isArray:w};if(r.push(O),O.size>1)for(let N=0;N<O.size;N++){const V=`${b}[${N}]`;E=t.getUniformLocation(e,V);const W={...O,name:V,location:E};r.push(W)}}return r}function bY(t,e){const r=(l,c)=>t.getActiveUniformBlockParameter(e,l,c),n=[],i=t.getProgramParameter(e,35382);for(let l=0;l<i;l++){const c={name:t.getActiveUniformBlockName(e,l)||"",location:r(l,35391),byteLength:r(l,35392),vertex:r(l,35396),fragment:r(l,35398),uniformCount:r(l,35394),uniforms:[]},s=r(l,35395)||[],m=t.getActiveUniforms(e,s,35383),b=t.getActiveUniforms(e,s,35384),w=t.getActiveUniforms(e,s,35387),E=t.getActiveUniforms(e,s,35388);for(let O=0;O<c.uniformCount;++O){const N=t.getActiveUniform(e,s[O]);if(!N)throw new Error("activeInfo");const V=kC(m[O]);c.uniforms.push({name:N.name,format:V,type:m[O],arrayLength:b[O],byteOffset:w[O],byteStride:E[O]})}n.push(c)}return n.sort((l,c)=>l.location-c.location),n}function xY(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function wY(t,e,r,n){const i=t;let l=n;l===!0&&(l=1),l===!1&&(l=0);const c=typeof l=="number"?[l]:l;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return i.uniform1uiv(e,c,1);case 36294:return i.uniform2uiv(e,c,2);case 36295:return i.uniform3uiv(e,c,3);case 36296:return i.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return i.uniformMatrix2x3fv(e,!1,c);case 35686:return i.uniformMatrix2x4fv(e,!1,c);case 35687:return i.uniformMatrix3x2fv(e,!1,c);case 35688:return i.uniformMatrix3x4fv(e,!1,c);case 35689:return i.uniformMatrix4x2fv(e,!1,c);case 35690:return i.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function TY(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function SY(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const GR=4;class AY extends nm{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Bt.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=mY(this.device.gl,this.handle),Bt.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=r.shaderLayout?EY(this.introspectedLayout,r.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,r){for(const[n,i]of Object.entries(e)){const l=this.shaderLayout.bindings.find(c=>c.name===n)||this.shaderLayout.bindings.find(c=>c.name===`${n}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(s=>`"${s.name}"`).join(", ");r?.disableWarnings||Bt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${c}`,i)();continue}switch(i||Bt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(i instanceof L0)&&!(i.buffer instanceof L0))throw new Error("buffer value");break;case"texture":if(!(i instanceof vy||i instanceof N0||i instanceof k0))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Bt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(l.type)}this.bindings[n]=i}}draw(e){const{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:s,isInstanced:m=!1,firstVertex:b=0,transformFeedback:w}=e,E=TY(i),O=!!l.indexBuffer,N=l.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Bt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Bt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(r),w&&w.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const V=r;return rY(this.device,n,V.glParameters,()=>{O&&m?this.device.gl.drawElementsInstanced(E,c||0,N,b,s||0):O?this.device.gl.drawElements(E,c||0,N,b):m?this.device.gl.drawArraysInstanced(E,b,c||0,s||0):this.device.gl.drawArrays(E,b,c||0),w&&w.end()}),l.unbindAfterRender(r),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Bt.time(GR,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Bt.timeEnd(GR,`linkProgram for ${this.id}`)(),Bt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Bt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Bt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:const r=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${r} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${r} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${r} during ${e}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async i=>await new Promise(l=>setTimeout(l,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Bt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,n=0;for(const i of this.shaderLayout.bindings){const l=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:c}=i,s=e.getUniformBlockIndex(this.handle,c);if(s===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,n,s),l instanceof L0?e.bindBufferBase(35345,n,l.handle):e.bindBufferRange(35345,n,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),n+=1;break;case"texture":if(!(l instanceof vy||l instanceof N0||l instanceof k0))throw new Error("texture");let m;if(l instanceof vy)m=l.texture;else if(l instanceof N0)m=l;else if(l instanceof k0&&l.colorAttachments[0]instanceof vy)Bt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),m=l.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(m.glTarget,m.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:i,textureUnit:l}=e,c=this.uniforms[r]??l;c!==void 0&&wY(this.device.gl,n,i,c)}}}function EY(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const i=r.attributes.find(l=>l.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Bt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class PY extends iC{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":CY(this.device,r.options);break;case"copy-buffer-to-texture":MY(this.device,r.options);break;case"copy-texture-to-buffer":IY(this.device,r.options);break;case"copy-texture-to-texture":RY(this.device,r.options);break;default:throw new Error(r.name)}}}function CY(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function MY(t,e){throw new Error("Not implemented")}function IY(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:l=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:s=0,origin:m=[0,0],destinationBuffer:b,byteOffset:w=0,bytesPerRow:E,rowsPerImage:O}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||s!==0||E||O)throw new Error("not implemented");const{framebuffer:N,destroyFramebuffer:V}=AB(r);let W;try{const j=b,Y=l||N.width,ce=c||N.height,re=wB(N.colorAttachments[0].texture.props.format),ue=re.format,me=re.type;t.gl.bindBuffer(35051,j.handle),W=t.gl.bindFramebuffer(36160,N.handle),t.gl.readPixels(m[0],m[1],Y,ce,ue,me,w)}finally{t.gl.bindBuffer(35051,null),W!==void 0&&t.gl.bindFramebuffer(36160,W),V&&N.destroy()}}function RY(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:l=[0,0],destinationTexture:c}=e;let{width:s=e.destinationTexture.width,height:m=e.destinationTexture.height}=e;const{framebuffer:b,destroyFramebuffer:w}=AB(r),[E,O]=i,[N,V,W]=l,j=t.gl.bindFramebuffer(36160,b.handle);let Y,ce;if(c instanceof N0)Y=c,s=Number.isFinite(s)?s:Y.width,m=Number.isFinite(m)?m:Y.height,Y._bind(0),ce=Y.glTarget;else throw new Error("invalid destination");switch(ce){case 3553:case 34067:t.gl.copyTexSubImage2D(ce,n,N,V,E,O,s,m);break;case 35866:case 32879:t.gl.copyTexSubImage3D(ce,n,N,V,W,E,O,s,m);break}Y&&Y._unbind(),t.gl.bindFramebuffer(36160,j),w&&b.destroy()}function AB(t){if(t instanceof ys){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}const OY=[1,2,4,8];class DY extends Gg{device;handle=null;glParameters={};constructor(e,r){super(e,r),this.device=e;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:l,height:c}=r.framebuffer;n=[0,0,l,c]}else{const[l,c]=e.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,l,c]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const i=this.props.framebuffer;if(this.props.framebuffer&&i?.handle){const l=this.props.framebuffer.colorAttachments.map((c,s)=>36064+s);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=e.stencilReference),"colorMask"in e&&(r.colorMask=OY.map(n=>!!(n&e.colorMask))),this.glParameters=r,Gy(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&q0(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){q0(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class ZR extends nC{device;handle=null;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new PY(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new DY(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,n){}}function kY(t){const{target:e,source:r,start:n=0,count:i=1}=t,l=r.length,c=i*l;let s=0;for(let m=n;s<l;s++)e[m++]=r[s];for(;s<c;)s<c-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+c-s),s=c);return t.target}class LC extends sC{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return U8()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:l,stride:c,offset:s,normalized:m,integer:b,divisor:w}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),b?this.device.gl.vertexAttribIPointer(e,i,l,c,s):this.device.gl.vertexAttribPointer(e,i,l,m,c,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,w||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const n=xB(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const i=LC.isConstantAttributeZeroSupported(this.device)||e!==0;(r||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const n=LY(r),i=n.byteLength*e,l=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),c||=!NY(n,this.bufferValue),c){const s=DW(r.constructor,l);kY({target:s,source:n,start:0,count:l}),this.buffer.write(s),this.bufferValue=r}return this.buffer}}function LY(t){return Array.isArray(t)?new Float32Array(t):t}function NY(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class zY extends aC{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(SY(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const n=this._getVaryingIndex(e),{buffer:i,byteLength:l,byteOffset:c}=this._getBufferRange(r);if(n<0){this.unusedBuffers[e]=i,Bt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:i,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(n,i,c,l)}getBuffer(e){if(YR(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof L0)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(YR(e))return Number(e);for(const r of this.layout.varyings||[])if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,n=0,i){const l=r&&r.handle;!l||i===void 0?this.gl.bindBufferBase(35982,e,l):this.gl.bindBufferRange(35982,e,l,n,i)}}function YR(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class BY extends oC{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{const l=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}function EB(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function FY(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function jY(t){return UY[t]}const UY={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function VY(t,e){const{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:l=null,sourceWidth:c,sourceHeight:s,sourceDepth:m,sourceFormat:b,sourceType:w}=e||{};const{framebuffer:E,deleteFramebuffer:O}=PB(t),{gl:N,handle:V}=E;c||=E.width,s||=E.height;const W=E.colorAttachments[i]?.texture;if(!W)throw new Error(`Invalid framebuffer attachment ${i}`);m=W?.depth||1,b||=W?.glFormat||6408,w||=W?.glType||5121,l=HY(l,w,b,c,s);const j=JP(l);w=w||hY(j);const Y=N.bindFramebuffer(36160,V);return N.readBuffer(36064+i),N.readPixels(r,n,c,s,b,w,l),N.readBuffer(36064),N.bindFramebuffer(36160,Y||null),O&&E.destroy(),l}function $Y(t,e){const{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:l=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:s,sourceHeight:m,sourceType:b}=e||{};const{framebuffer:w,deleteFramebuffer:E}=PB(t);s=s||w.width,m=m||w.height;const O=w;b=b||5121;let N=r;if(!N){const W=EB(l),j=FY(b),Y=c+s*m*W*j;N=O.device.createBuffer({byteLength:Y})}const V=t.device.createCommandEncoder();return V.copyTextureToBuffer({sourceTexture:t,width:s,height:m,origin:[n,i],destinationBuffer:N,byteOffset:c}),V.destroy(),E&&w.destroy(),N}function PB(t){return t instanceof bT?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:WY(t),deleteFramebuffer:!0}}function WY(t,e){const{device:r,width:n,height:i,id:l}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:n,height:i,colorAttachments:[t]})}function HY(t,e,r,n,i,l){if(t)return t;e||=5121;const c=jY(e),s=eC(c),m=EB(r);return new s(n*i*m)}class FE extends hm{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return e!=="unorm8x4-bgra"}constructor(e){super({...e,id:e.id||KZ("webgl-device")});const r=hm._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new YZ(this,r),this.lost=new Promise(w=>{this._resolveContextLost=w});const i={...e.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const c=this.props._handle||IZ(this.canvasContext.canvas,{onContextLost:w=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:w=>console.log("WebGL context restored")},i);if(!c)throw new Error("WebGL context creation failed");if(n=c.device,n){if(e._reuseDevices)return Bt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=c,this.gl=c,this.spectorJS=fZ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=RZ(this.gl,this._extensions),this.limits=new XZ(this.gl),this.features=new qZ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new sm(this.gl,{log:(...w)=>Bt.log(1,...w)()}).trackState(this.gl,{copyState:!1});const m=e.debugWebGL||e.debug,b=e.debugWebGL;m&&(this.gl=gZ(this.gl,{debugWebGL:m,traceWebGL:b}),Bt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Bt.level=Math.max(Bt.level,1))),this.commandEncoder=new ZR(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._normalizeBufferProps(e);return new L0(this,r)}createTexture(e){return new N0(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new lY(this,e)}createShader(e){return new tY(this,e)}createFramebuffer(e){return new k0(this,e)}createVertexArray(e){return new LC(this,e)}createTransformFeedback(e){return new zY(this,e)}createQuerySet(e){return new BY(this,e)}createRenderPipeline(e){return new AY(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new ZR(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,r){return VY(e,r)}readPixelsToBufferWebGL(e,r){return $Y(e,r)}setParametersWebGL(e){Gy(this.gl,e)}getParametersWebGL(e){return vB(this.gl,e)}withParametersWebGL(e,r){return q0(this.gl,e,r)}resetWebGL(){Bt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),AZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return VZ(this.gl,e,this._extensions)}loseDevice(){let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){sm.get(this.gl).push()}popState(){sm.get(this.gl).pop()}getGLKey(e,r){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){const r={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[i,l])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${l}:${this.getGLKey(l,r)}`,n),{})}setConstantAttributeWebGL(e,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&ZY(i,r)&&Bt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:qY(this,e,r);break;case Int32Array:XY(this,e,r);break;case Uint32Array:GY(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return zy(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,r,n){e.luma=r;const i={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=i}}function qY(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function XY(t,e,r){t.gl.vertexAttribI4iv(e,r)}function GY(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function ZY(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const KR=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:FE},Symbol.toStringTag,{value:"Module"}));function fp(){}const YY=({isDragging:t})=>t?"grabbing":"grab",CB={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:fp,onWebGLInitialized:fp,onResize:fp,onViewStateChange:fp,onInteractionStateChange:fp,onBeforeRender:fp,onAfterRender:fp,onLoad:fp,onError:t=>Wr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:YY,getTooltip:null,debug:!1,drawPickingColors:!1};class pw{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new gT({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null,unproject3D:!1},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const l=n.offsetCenter;if(!l)return;i.x=l.x,i.y=l.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=ME[n.type],l=n.offsetCenter;if(!i||!l||!this.layerManager)return;let c;const s=this.layerManager.getLayers(),m=s.some(N=>N.props.pickable==="3d");if(n.type==="click"&&m){const N=this._pick("pickObject","pickObject Time",{x:l.x,y:l.y,radius:this.props.pickingRadius,unproject3D:!0});c=N.result[0]||N.emptyInfo}else c=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:s,viewports:this.getViewports(l)},this._lastPointerDownInfo);const{layer:b}=c,w=b&&(b[i]||b.props[i]),E=this.props[i];let O=!1;w&&(O=w.call(b,c,n)),O||(E?.(c,n),this.widgetManager.onEvent(c,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const i=n.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...CB,...e},e=this.props,e.viewState&&e.initialViewState&&Wr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;if(!r&&e.gl){e.gl instanceof WebGLRenderingContext&&Wr.error("WebGL1 context not supported.")();const n=this.props.deviceProps?.onResize;r=_S.attach(e.gl,{_cacheShaders:!0,_cachePipelines:!0,...this.props.deviceProps,onResize:(i,l)=>{const{width:c,height:s}=i.canvas;i.drawingBufferWidth=c,i.drawingBufferHeight=s,this._needsRedraw="Canvas resized",n?.(i,l)}})}r||(r=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&ky.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Wr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Wr.removed("onLayerClick","onClick")(),e.initialViewState&&!pc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Wr.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(r),e.useDevicePixels!==void 0&&this.device?.canvasContext?.setProps&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return r=r||n||i||l||c,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Ui(this.viewManager),this.viewManager.views}getView(e){return Ui(this.viewManager),this.viewManager.getView(e)}getViewports(e){return Ui(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,n){Ui(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),l}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Ui(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(r.width=e.width),e.height&&typeof e.height=="number"&&(r.height=e.height),(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:i}=r;return new TC({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){const r=this.props.deviceProps?.createCanvasContext,n=typeof r=="object"?r:void 0,i={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};i.adapters.includes(_S)||i.adapters.push(_S);const l={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},c=this.props.deviceProps?.onResize;return vE.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...l,...n,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(s,m)=>{this._needsRedraw="Canvas resized",c?.(s,m)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new CC({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const n=(this.layerManager?.getLayers()||[]).some(m=>m.props.pickable==="3d");e.unproject3D=n;const{result:i,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let c=l,s=!1;for(const m of i)c=m,s=m.layer?.onHover(m,e.event)||s;s||(this.props.onHover?.(c,e.event),this.widgetManager.onHover(c,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new cB;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Iq(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(uR).map(i=>{const[l,c,s,m]=uR[i],b=this.props.eventRecognizerOptions?.[i],w={...c,...b,event:i};return{recognizer:new l(w),recognizeWith:s,requestFailure:m}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in ME)this.eventManager.on(i,this._onEvent);this.viewManager=new MG({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new CG(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new WG({deck:this,device:this.device}),this.deckRenderer=new XG(this.device),this.deckPicker=new YG(this.device),this.widgetManager=new JG({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new mB),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=vE.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}pw.defaultProps=CB;pw.VERSION=l7;function KY(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return eC(t)}}const QY=JP;function n1(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Kg(t){return t.stride||t.size*t.bytesPerElement}function JY(t,e){return t.type===e.type&&t.size===e.size&&Kg(t)===Kg(e)&&(t.offset||0)===(e.offset||0)}function jE(t,e){e.offset&&Wr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Kg(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,l=n*r+i*t.bytesPerElement+(t.offset||0);return{...e,offset:l,stride:r}}function eK(t,e){const r=jE(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class tK{constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const i=r.logicalType||r.type,l=i==="float64";let{defaultValue:c}=r;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let s;l?s="float32":!i&&r.isIndexed?s="uint32":s=i||"float32";let m=KY(i||s);this.doublePrecision=l,l&&r.fp64===!1&&(m=Float32Array),this.value=null,this.settings={...r,defaultType:m,defaultValue:c,logicalType:i,type:s,normalized:s.includes("norm"),size:this.size,bytesPerElement:m.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Kg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ky.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const i=this.value;if(r){const l=jE(this.getAccessor(),r),c=l.offset/i.BYTES_PER_ELEMENT,s=l.size||this.size;n[e]=i.subarray(c,c+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),i=[],l={name:this.id,byteStride:Kg(n),attributes:i};if(this.doublePrecision){const c=eK(n,r||{});i.push(n1(e,{...n,...c.high},this.device.type),n1(`${e}64Low`,{...n,...c.low},this.device.type))}else if(r){const c=jE(n,r);i.push(n1(e,{...n,...c},this.device.type))}else i.push(n1(e,n,this.device.type));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:i}=this,l=n*i;if(r&&l&&r.length>=l){const c=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let m=0;m<l;)for(let b=0;b<i;b++){const w=r[m++];w<c[b]&&(c[b]=w),w>s[b]&&(s[b]=w)}e=[c,s]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ai?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const c=QY(n.value);i.type=i.normalized?c.replace("int","norm"):c}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Kg(i)}if(r.bounds=null,n.constant){let l=n.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!r.constant||!this._areValuesEqual(l,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(n.buffer){const l=n.buffer;r.externalBuffer=l,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let l=n.value;r.externalBuffer=null,r.constant=!1,this.value=l;let{buffer:c}=this;const s=Kg(i),m=(i.vertexOffset||0)*s;if(this.doublePrecision&&l instanceof Float64Array&&(l=uS(l,i)),this.settings.isIndexed){const w=this.settings.defaultType;l.constructor!==w&&(l=new w(l))}const b=l.byteLength+m+s*2;(!c||c.byteLength<b)&&(c=this._createBuffer(b)),c.write(l,m)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?uS(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,i=n.allocatedValue,l=ky.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=l;const{byteOffset:c}=this;let{buffer:s}=this;return(!s||s.byteLength<l.byteLength+c)&&(s=this._createBuffer(l.byteLength+c),r&&i&&s.write(i instanceof Float64Array?uS(i,this):i,c)),n.allocatedValue=l,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Wr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:i,size:l}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let c=l;for(;--c>=0;)r[n+c]=i[c];return r}switch(l){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let c=l;for(;--c>=0;)r[n+c]=Number.isFinite(e[c])?e[c]:i[c]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==r[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?Ai.INDEX:Ai.VERTEX)|Ai.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const QR=[],JR=[];function TT(t,e=0,r=1/0){let n=QR;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(JR.length=t.length,n=JR):n=QR,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),i.index=e-1),{iterable:n,objectInfo:i}}function MB(t){return t&&t[Symbol.asyncIterator]}function IB(t,e){const{size:r,stride:n,offset:i,startIndices:l,nested:c}=e,s=t.BYTES_PER_ELEMENT,m=n?n/s:r,b=i?i/s:0,w=Math.floor((t.length-b)/m);return(E,{index:O,target:N})=>{if(!l){const Y=O*m+b;for(let ce=0;ce<r;ce++)N[ce]=t[Y+ce];return N}const V=l[O],W=l[O+1]||w;let j;if(c){j=new Array(W-V);for(let Y=V;Y<W;Y++){const ce=Y*m+b;N=new Array(r);for(let re=0;re<r;re++)N[re]=t[ce+re];j[Y-V]=N}}else if(m===r)j=t.subarray(V*r+b,W*r+b);else{j=new t.constructor((W-V)*r);let Y=0;for(let ce=V;ce<W;ce++){const re=ce*m+b;for(let ue=0;ue<r;ue++)j[Y++]=t[re+ue]}}return j}}const rK=[],z1=[[0,1/0]];function nK(t,e){if(t===z1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let i=0;for(let l=0;l<n;l++){const c=t[l];c[1]<e[0]?(r.push(c),i=l+1):c[0]>e[1]?r.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return r.splice(i,0,e),r}const iK={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function RB(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...iK[r],...e,...t,type:r}}class OB extends tK{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:z1}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!JY(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?e[r.find(l=>e[l])]:e[r];return RB(i,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=nK(this.state.updateRanges,[n,i])}else this.state.updateRanges=z1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=rK}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==z1),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:c,noAlloc:s}}=this;let m=!0;if(c){for(const[b,w]of l)c.call(i,this,{data:r,startRow:b,endRow:w,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[b,w]of l){const E=Number.isFinite(b)?this.getVertexOffset(b):0,O=Number.isFinite(w)?this.getVertexOffset(w):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:E,endOffset:O})}this._checkAttributeArray()}else m=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),m}setConstantValue(e,r){const n=this.device.type==="webgpu";if(n||r===void 0||typeof r=="function"){if(n&&typeof r!="function"){const c=this._normalizeValue(r,[],0);this._areValuesEqual(c,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,r):r;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;Ui(ArrayBuffer.isView(c.value),`invalid ${i.accessor}`);const s=!!c.size&&c.size!==this.size;return n.binaryAccessor=IB(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:r,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(const l in r){const c=super._getBufferLayout(l,r[l]);n.attributes.push(...c.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:i,props:l,numInstances:c}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:s,state:m,value:b,size:w,startIndices:E}=e,{accessor:O,transform:N}=s;let V=m.binaryAccessor||(typeof O=="function"?O:l[O]);typeof V!="function"&&typeof O=="string"&&(V=()=>l[O]),Ui(typeof V=="function",`accessor "${O}" is not a function`);let W=e.getVertexOffset(n);const{iterable:j,objectInfo:Y}=TT(r,n,i);for(const ce of j){Y.index++;let re=V(ce,Y);if(N&&(re=N.call(this,re)),E){const ue=(Y.index<E.length-1?E[Y.index+1]:c)-E[Y.index];if(re&&Array.isArray(re[0])){let me=W;for(const ge of re)e._normalizeValue(ge,b,me),me+=w}else re&&re.length>w?b.set(re,W):(e._normalizeValue(re,Y.target,0),TG({target:b,source:Y.target,start:W,count:ue}));W+=ue*w}else e._normalizeValue(re,b,W),W+=w}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function wS(t){const{source:e,target:r,start:n=0,size:i,getData:l}=t,c=t.end||r.length,s=e.length,m=c-n;if(s>m){r.set(e.subarray(0,m),n);return}if(r.set(e,n),!l)return;let b=s;for(;b<m;){const w=l(b,e);for(let E=0;E<i;E++)r[n+b]=w[E]||0,b++}}function sK({source:t,target:e,size:r,getData:n,sourceStartIndices:i,targetStartIndices:l}){if(!i||!l)return wS({source:t,target:e,size:r,getData:n}),e;let c=0,s=0;const m=n&&((w,E)=>n(w+s,E)),b=Math.min(i.length,l.length);for(let w=1;w<b;w++){const E=i[w]*r,O=l[w]*r;wS({source:t.subarray(c,E),target:e,start:s,end:O,size:r,getData:m}),c=E,s=O}return s<e.length&&wS({source:[],target:e,start:s,size:r,getData:m}),e}function aK(t){const{device:e,settings:r,value:n}=t,i=new OB(e,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function DB(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function kB(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function LB(t){t.push(t.shift())}function oK(t,e){const{doublePrecision:r,settings:n,value:i,size:l}=t,c=r&&i instanceof Float64Array?2:1;let s=0;const{shaderAttributes:m}=t.settings;if(m)for(const b of Object.values(m))s=Math.max(s,b.vertexOffset??0);return(n.noAlloc?i.length:(e+s)*l)*c}function NB({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function zB({device:t,buffer:e,attribute:r,fromLength:n,toLength:i,fromStartIndices:l,getData:c=s=>s}){const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,m=r.size*s,b=r.byteOffset,w=r.settings.bytesPerElement<4?b/r.settings.bytesPerElement*4:b,E=r.startIndices,O=l&&E,N=r.isConstant;if(!O&&e&&n>=i)return e;const V=r.value instanceof Float64Array?Float32Array:r.value.constructor,W=N?r.value:new V(r.getBuffer().readSyncWebGL(b,i*V.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!N){const re=c;c=(ue,me)=>r.normalizeConstant(re(ue,me))}const j=N?(re,ue)=>c(W,ue):(re,ue)=>c(W.subarray(re+b,re+b+m),ue),Y=e?new Float32Array(e.readSyncWebGL(w,n*4).buffer):new Float32Array(0),ce=new Float32Array(i);return sK({source:Y,target:ce,sourceStartIndices:l,targetStartIndices:E,size:m,getData:j}),(!e||e.byteLength<ce.byteLength+w)&&(e?.destroy(),e=t.createBuffer({byteLength:ce.byteLength+w,usage:35050})),e.write(ce,w),e}class BB{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new wT(n),this.attribute=r,this.attributeInTransition=aK(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=oK(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class lK extends BB{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=fK(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:c}=this;LB(l),l[0]=zB({device:this.device,buffer:l[0],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),l[1]=NB({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:s}=this,m=s.model;let b=Math.floor(this.currentLength/c.size);FB(c)&&(b/=2),m.setVertexCount(b),c.isConstant?(m.setAttributes({aFrom:l[0]}),m.setConstantAttributes({aTo:c.value})):m.setAttributes({aFrom:l[0],aTo:c.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let i=n/e;r&&(i=r(i));const{model:l}=this.transform,c={time:i};l.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const cK=`uniform interpolationUniforms {
  float time;
} interpolation;
`,eO={name:"interpolation",vs:cK,uniformTypes:{time:"f32"}},uK=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,hK=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function FB(t){return t.doublePrecision&&t.value instanceof Float64Array}function fK(t,e){const r=e.size,n=DB(r),i=kB(r),l=e.getBufferLayout();return FB(e)?new Ly(t,{vs:hK,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[_H,eO],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ly(t,{vs:uK,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:l.attributes[0].format}],modules:[eO],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class dK extends BB{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=vK(e),this.framebuffer=bK(e,this.texture),this.transform=yK(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;super.start(e,r);const{buffers:l,attribute:c}=this;for(let m=0;m<2;m++)l[m]=zB({device:this.device,buffer:l[m],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});l[2]=NB({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?s.setConstantAttributes({aTo:c.value}):s.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:i}=this,l=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:l.stiffness,damping:l.damping};r.model.shaderInputs.setProps({spring:c}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),LB(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const pK=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,gK={name:"spring",vs:pK,uniformTypes:{damping:"f32",stiffness:"f32"}},mK=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,_K=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function yK(t,e){const r=DB(e.size),n=kB(e.size);return new Ly(t,{vs:mK,fs:_K,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[gK],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function vK(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function bK(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const xK={interpolation:lK,spring:dK};class wK{constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const i in e){const l=e[i],c=l.getTransitionSetting(r);c&&this._updateAttribute(i,l,c)}for(const i in this.transitions){const l=e[i];(!l||!l.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const i=this.transitions[e];let l=!i||i.type!==n.type;if(l){i&&this._removeTransition(e);const c=xK[n.type];c?this.transitions[e]=new c({attribute:r,timeline:this.timeline,device:this.device}):(Wr.error(`unsupported transition type '${n.type}'`)(),l=!1)}(l||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const tO="attributeManager.invalidate",TK="attributeManager.updateStart",SK="attributeManager.updateEnd",AK="attribute.updateStart",EK="attribute.allocate",PK="attribute.updateEnd";class CK{constructor(e,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=yb(VX),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new wK(e,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);Xa(tO,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);Xa(tO,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:i,props:l={},buffers:c={},context:s={}}){let m=!1;Xa(TK,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const b in this.attributes){const w=this.attributes[b],E=w.settings.accessor;w.startIndices=n,w.numInstances=r,l[b]&&Wr.removed(`props.${b}`,`data.attributes.${b}`)(),w.setExternalBuffer(c[b])||w.setBinaryValue(typeof E=="string"?c[E]:void 0,e.startIndices)||typeof E=="string"&&!c[E]&&w.setConstantValue(s,l[E])||w.needsUpdate()&&(m=!0,this._updateAttribute({attribute:w,numInstances:r,data:e,props:l,context:s})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}m&&Xa(SK,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const l in r){const c=r[l];c.needsRedraw(e)&&!n.hasAttribute(l)&&(i[l]=c)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const i=e[n],l={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new OB(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:i}=this,l=i[e];return l&&l.forEach(c=>{const s=n[c];s&&s.setNeedsUpdate(s.id,r)}),l}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(Xa(AK,r),r.constant){r.setConstantValue(e.context,r.value);return}r.allocate(n)&&Xa(EK,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,Xa(PK,r,n))}}class MK extends wT{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:i,easing:l}}=this,c=l(e/i);this._value=cw(r,n,c)}}const rO=1e-5;function nO(t,e,r,n,i){const l=e-t,s=(r-e)*i,m=-l*n;return s+m+l+e}function IK(t,e,r,n,i){if(Array.isArray(r)){const l=[];for(let c=0;c<r.length;c++)l[c]=nO(t[c],e[c],r[c],n,i);return l}return nO(t,e,r,n,i)}function iO(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}class RK extends wT{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:l=e,_currValue:c=e}=this;let s=IK(l,c,r,n,i);const m=iO(s,r),b=iO(s,c);m<rO&&b<rO&&(s=r,this.end()),this._prevValue=c,this._currValue=s}}const OK={interpolation:MK,spring:RK};class DK{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,i){const{transitions:l}=this;if(l.has(e)){const m=l.get(e),{value:b=m.settings.fromValue}=m;r=b,this.remove(e)}if(i=RB(i),!i)return;const c=OK[i.type];if(!c){Wr.error(`unsupported transition type '${i.type}'`)();return}const s=new c(this.timeline);s.start({...i,fromValue:r,toValue:n}),l.set(e,s)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function kK(t){const e=t[Tp];for(const r in e){const n=e[r],{validate:i}=n;if(i&&!i(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function LK(t,e){const r=jB({newProps:t,oldProps:e,propTypes:t[Tp],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=zK(t,e);let i=!1;return n||(i=BK(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:FK(t,e),transitionsChanged:NK(t,e)}}function NK(t,e){if(!t.transitions)return!1;const r={},n=t[Tp];let i=!1;for(const l in t.transitions){const c=n[l],s=c&&c.type;(s==="number"||s==="color"||s==="array")&&UE(t[l],e[l],c)&&(r[l]=!0,i=!0)}return i?r:!1}function jB({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return`${i}.${l} added`;const c=UE(t[l],e[l],n[l]);if(c)return`${i}.${l} ${c}`}for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return`${i}.${l} dropped`;if(!Object.hasOwnProperty.call(t,l)){const c=UE(t[l],e[l],n[l]);if(c)return`${i}.${l} ${c}`}}return!1}function UE(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function zK(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:i}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}function BK(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&sO(t,e,"all"))return{all:!0};const r={};let n=!1;for(const i in t.updateTriggers)i!=="all"&&sO(t,e,i)&&(r[i]=!0,n=!0);return n?r:!1}function FK(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function sO(t,e,r){let n=t.updateTriggers[r];n=n??{};let i=e.updateTriggers[r];return i=i??{},jB({oldProps:i,newProps:n,triggerName:r})}const jK="count(): argument not an object",UK="count(): argument not a container";function VK(t){if(!WK(t))throw new Error(jK);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if($K(t))return Object.keys(t).length;throw new Error(UK)}function $K(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function WK(t){return t!==null&&typeof t=="object"}function aO(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];r.inject=n}return r}const HK={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},VE={};function qK(t,e,r,n){if(r instanceof ys)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const{width:l,height:c}=r.data,s=e.createTexture({...r,sampler:{...HK,...i,...n},mipLevels:e.getMipLevelCount(l,c)});return s.generateMipmapsWebGL(),VE[s.id]=t,s}function XK(t,e){!e||!(e instanceof ys)||VE[e.id]===t&&(e.delete(),delete VE[e.id])}const GK={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||$E(t)&&(t.length===3||t.length===4)},equal(t,e,r){return pc(t,e,1)}},accessor:{validate(t,e){const r=gw(t);return r==="function"||r===gw(e.value)},equal(t,e,r){return typeof e=="function"?!0:pc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||$E(t)},equal(t,e,r){const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?pc(t,e,i):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?pc(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:qK(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{XK(r.id,t)}}};function ZK(t){const e={},r={},n={};for(const[i,l]of Object.entries(t)){const c=l?.deprecatedFor;if(c)n[i]=Array.isArray(c)?c:[c];else{const s=YK(i,l);e[i]=s,r[i]=s.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function YK(t,e){switch(gw(e)){case"object":return c0(t,e);case"array":return c0(t,{type:"array",value:e,compare:!1});case"boolean":return c0(t,{type:"boolean",value:e});case"number":return c0(t,{type:"number",value:e});case"function":return c0(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function c0(t,e){return"type"in e?{name:t,...GK[e.type],...e}:"value"in e?{name:t,type:gw(e.value),...e}:{name:t,type:"object",value:e}}function $E(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function gw(t){return $E(t)?"array":t===null?"null":typeof t}function KK(t,e){let r;for(let l=e.length-1;l>=0;l--){const c=e[l];"extensions"in c&&(r=c.extensions)}const n=WE(t.constructor,r),i=Object.create(n);i[dw]=t,i[mm]={},i[vp]={};for(let l=0;l<e.length;++l){const c=e[l];for(const s in c)i[s]=c[s]}return Object.freeze(i),i}const QK="_mergedDefaultProps";function WE(t,e){if(!(t instanceof ST.constructor))return{};let r=QK;if(e)for(const i of e){const l=i.constructor;l&&(r+=`:${l.extensionName||l.name}`)}const n=UB(t,r);return n||(t[r]=JK(t,e||[]))}function JK(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),i=WE(n),l=UB(t,"defaultProps")||{},c=ZK(l),s=Object.assign(Object.create(null),i,c.defaultProps),m=Object.assign(Object.create(null),i?.[Tp],c.propTypes),b=Object.assign(Object.create(null),i?.[gS],c.deprecatedProps);for(const w of e){const E=WE(w.constructor);E&&(Object.assign(s,E),Object.assign(m,E[Tp]),Object.assign(b,E[gS]))}return eQ(s,t),rQ(s,m),tQ(s,b),s[Tp]=m,s[gS]=b,e.length===0&&!NC(t,"_propTypes")&&(t._propTypes=m),s}function eQ(t,e){const r=iQ(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function tQ(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const i=`${this.id}: ${r}`;for(const l of e[r])NC(this,l)||(this[l]=n);Wr.deprecated(i,e[r].join("/"))()}})}function rQ(t,e){const r={},n={};for(const i in e){const l=e[i],{name:c,value:s}=l;l.async&&(r[c]=s,n[c]=nQ(c))}t[Ay]=r,t[mm]={},Object.defineProperties(t,n)}function nQ(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||MB(e)?this[mm][t]=e:this[vp][t]=e},get(){if(this[vp]){if(t in this[vp])return this[vp][t]||this[Ay][t];if(t in this[mm]){const e=this[dw]&&this[dw].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Ay][t]}}return this[Ay][t]}}}function NC(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function UB(t,e){return NC(t,e)&&t[e]}function iQ(t){const e=t.componentName;return e||Wr.warn(`${t.name}.componentName not specified`)(),e||t.name}let sQ=0;class ST{constructor(...e){this.props=KK(this,e),this.id=this.props.id,this.count=sQ++}clone(e){const{props:r}=this,n={};for(const i in r[Ay])i in r[vp]?n[i]=r[vp][i]:i in r[mm]&&(n[i]=r[mm][i]);return new this.constructor({...r,...n,...e})}}ST.componentName="Component";ST.defaultProps={};const aQ=Object.freeze({});class oQ{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||aQ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[dw]||this.component;const r=e[vp]||{},n=e[mm]||e,i=e[Ay]||{};for(const l in r){const c=r[l];this._createAsyncPropData(l,i[l]),this._updateAsyncProp(l,c),r[l]=this.getAsyncProp(l)}for(const l in n){const c=n[l];this._createAsyncPropData(l,i[l]),this._updateAsyncProp(l,c)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(MB(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;r.then(l=>{this.component&&(l=this._postProcessValue(n,l),this._setAsyncPropValue(e,l,i),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let l=[],c=0;for await(const s of r){if(!this.component)return;const{dataTransform:m}=this.component.props;m?l=m(s,l):l=l.concat(s),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:c,endRow:l.length}]}),c=l.length,this._setAsyncPropValue(e,l,i)}this._onResolve(e,l)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Tp];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class lQ extends oQ{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,i=n?.props.fetch;return i?i(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const cQ="layer.changeFlag",uQ="layer.initialize",hQ="layer.update",fQ="layer.finalize",dQ="layer.matched",oO=2**24-1,pQ=Object.freeze([]),gQ=yb(({oldViewport:t,viewport:e})=>t.equals(e));let yu=new Uint8ClampedArray(0);const mQ={data:{type:"data",value:pQ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:i,signal:l})=>{const{resourceManager:c}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,l&&(i={...i,fetch:{...i?.fetch,signal:l}});let s=c.contains(t);return!s&&!i&&(c.add({resourceId:t,data:Q1(t,n),persistent:!1}),s=!0),s?c.subscribe({resourceId:t,onChange:m=>r.internalState?.reloadAsyncProp(e,m),consumerId:r.id,requestId:e}):Q1(t,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:cn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let Mp=class extends ST{constructor(){super(...arguments),this.internalState=null,this.lifecycle=hy.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ui(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=lB(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,l,c]=iB(n,r.pixelProjectionMatrix);return e.length===2?[i,l]:[i,l,c]}unproject(e){return Ui(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Ui(this.internalState);const n=this.internalState.viewport||this.context.viewport;return GX(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===cn.DEFAULT||e===cn.LNGLAT||e===cn.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Ui(e instanceof Uint8Array);const[r,n,i]=e;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:VK(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=aO(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=aO(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const i of n)r.invalidateAll(i);else r.invalidateAll();if(r){const{props:i}=e,l=this.internalState.hasPickingBuffer,c=Number.isInteger(i.highlightedObjectIndex)||!!i.pickable||i.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(l!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:s,instancePickingColors:m}=r.attributes,b=s||m;b&&(c&&b.constant&&(b.constant=!1,r.invalidate(b.id)),!b.value&&!c&&(b.constant=!0,b.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!gQ({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor(yu.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>oO&&Wr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),yu=ky.allocate(yu,r,{size:4,copy:!0,maxCount:Math.max(r,oO)});const i=Math.floor(yu.length/4),l=[0,0,0];for(let c=n;c<i;c++)this.encodePickingColor(c,l),yu[c*4+0]=l[0],yu[c*4+1]=l[1],yu[c*4+2]=l[2],yu[c*4+3]=0}e.value=yu.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){if(!Object.keys(r).length)return;if(n){const s=this.getAttributeManager();e.setBufferLayout(s.getBufferLayouts(e)),r=s.getAttributes()}const i=e.userData?.excludeAttributes||{},l={},c={};for(const s in r){if(i[s])continue;const m=r[s].getValue();for(const b in m){const w=m[b];w instanceof Ai?r[s].settings.isIndexed?e.setIndexBuffer(w):l[b]=w:w&&(c[b]=w)}}e.setAttributes(l),e.setConstantAttributes(c)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,l=n||i,c=l&&r.attributes&&r.attributes[l.id];if(c&&c.value){const s=c.value,m=this.encodePickingColor(e);for(let b=0;b<r.length;b++){const w=l.getVertexOffset(b);s[w]===m[0]&&s[w+1]===m[1]&&s[w+2]===m[2]&&this._disablePickingIndex(b)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;const l=i.getVertexOffset(e),c=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(c-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==yu.buffer&&(n.value=yu.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ui(!this.internalState),Ui(Number.isFinite(this.props.coordinateSystem)),Xa(uQ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new lQ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new DK(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Xa(dQ,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Xa(hQ,this,e),!e)return;const r=this.props,n=this.context,i=this.internalState,l=n.viewport,c=this._updateUniformTransition();i.propsInTransition=c,n.viewport=i.viewport||l,this.props=c;try{const s=this._getUpdateParams(),m=this.getModels();if(n.device)this.updateState(s);else try{this.updateState(s)}catch{}for(const w of this.props.extensions)w.updateState.call(this,s,w);this.setNeedsRedraw(),this._updateAttributes();const b=this.getModels()[0]!==m[0];this._postUpdate(s,b)}finally{n.viewport=l,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Xa(fQ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const l=this.props,c=this.context;this.props=this.internalState.propsInTransition||l;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:s}=this.props,m=s&&s(n)||[0,0];c.device instanceof FE&&c.device.setParametersWebGL({polygonOffset:m});for(const b of this.getModels())b.device.type==="webgpu"?b.setParameters({...b.parameters,...i}):b.setParameters(i);if(c.device instanceof FE)c.device.withParametersWebGL(i,()=>{const b={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const w of this.props.extensions)w.draw.call(this,b,w);this.draw(b)});else{const b={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const w of this.props.extensions)w.draw.call(this,b,w);this.draw(b)}}finally{this.props=l}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const i in e)if(e[i]){let l=!1;switch(i){case"dataChanged":const c=e[i],s=r[i];c&&Array.isArray(s)&&(r.dataChanged=Array.isArray(c)?s.concat(c):c,l=!0);default:r[i]||(r[i]=e[i],l=!0)}l&&Xa(cQ,this,i,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const n=LK(e,r);if(n.updateTriggersChanged)for(const i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){kK(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new CK(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:i}=e,l=this.state.model;l?.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:s,highlightColor:m}=n;if(r||i.autoHighlight!==c||i.highlightedObjectIndex!==s||i.highlightColor!==m){const b={};Array.isArray(m)&&(b.highlightColor=m),(r||i.autoHighlight!==c||s!==i.highlightedObjectIndex)&&(b.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:b})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(r=r||i,r)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Mp.defaultProps=mQ;Mp.layerName="Layer";const _Q="compositeLayer.renderLayers";class zC extends Mp{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||r}getSubLayerRow(e,r,n){return e.__source={parent:this,object:r,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,e(n.__source.object,r)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:n,visible:i,parameters:l,getPolygonOffset:c,highlightedObjectIndex:s,autoHighlight:m,highlightColor:b,coordinateSystem:w,coordinateOrigin:E,wrapLongitude:O,positionFormat:N,modelMatrix:V,extensions:W,fetch:j,operation:Y,_subLayerProps:ce}=this.props,re={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:l,getPolygonOffset:c,highlightedObjectIndex:s,autoHighlight:m,highlightColor:b,coordinateSystem:w,coordinateOrigin:E,wrapLongitude:O,positionFormat:N,modelMatrix:V,extensions:W,fetch:j,operation:Y},ue=ce&&e.id&&ce[e.id],me=ue&&ue.updateTriggers,ge=e.id||"sublayer";if(ue){const Ce=this.props[Tp],We=e.type?e.type._propTypes:{};for(const Xe in ue){const Et=We[Xe]||Ce[Xe];Et&&Et.type==="accessor"&&(ue[Xe]=this.getSubLayerAccessor(ue[Xe]))}}Object.assign(re,e,ue),re.id=`${this.props.id}-${ge}`,re.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...me};for(const Ce of W){const We=Ce.getSubLayerProps.call(this,Ce);We&&Object.assign(re,We,{updateTriggers:Object.assign(re.updateTriggers,We.updateTriggers)})}return re}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const l=this.renderLayers();n=Pp(l,Boolean),this.internalState.subLayers=n}Xa(_Q,this,i,n);for(const l of n)l.parent=this}}zC.layerName="CompositeLayer";class yQ extends gB{constructor(e){const{startPanPos:r,...n}=e;super(n),r!==void 0&&(this._state.startPanPos=r)}panStart({pos:e}){const{latitude:r,longitude:n,zoom:i}=this.getViewportProps();return this._getUpdatedState({startPanLngLat:[n,r],startPanPos:e,startZoom:i})}pan({pos:e,startPos:r}){const n=this.getState(),i=n.startPanLngLat||this._unproject(r);if(!i)return this;const l=n.startZoom??this.getViewportProps().zoom,c=n.startPanPos||r,s=[i[0],i[1],l],b=this.makeViewport(this.getViewportProps()).panByPosition(s,e,c);return this._getUpdatedState(b)}panEnd(){return this._getUpdatedState({startPanLngLat:null,startPanPos:null,startZoom:null})}zoom({scale:e}){const n=(this.getState().startZoom||this.getViewportProps().zoom)+Math.log2(e);return this._getUpdatedState({zoom:n})}applyConstraints(e){const{longitude:r,latitude:n,maxZoom:i,minZoom:l,zoom:c}=e,s=gy(0),m=gy(n)-s;return e.zoom=Ih(c,l+m,i+m),(r<-180||r>180)&&(e.longitude=BX(r+180,360)-180),e.latitude=Ih(n,-Rh,Rh),e}}class vQ extends pB{constructor(){super(...arguments),this.ControllerState=yQ,this.transition={transitionDuration:300,transitionInterpolator:new PC(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class VB extends dB{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?gm:EC}get ControllerType(){return vQ}}VB.displayName="GlobeView";class $B{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=ky,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:n={},getGeometry:i,geometryBuffer:l,positionFormat:c,dataChanged:s,normalize:m=!0}=this.opts;if(this.data=r,this.getGeometry=i,this.positionSize=l&&l.size||(c==="XY"?2:3),this.buffers=n,this.normalize=m,l&&(Ui(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(l),m||(n.vertexPositions=l)),this.geometryBuffer=n.vertexPositions,Array.isArray(s))for(const b of s)this._rebuildGeometry(b);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?IB(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:n,buffers:i,_attributeDefs:l,typedArrayManager:c}=this;for(const s in l)if(s in i)c.release(n[s]),n[s]=null;else{const m=l[s];m.copy=r,n[s]=c.allocate(n[s],e,m)}}_forEachGeometry(e,r,n){const{data:i,getGeometry:l}=this,{iterable:c,objectInfo:s}=TT(i,r,n);for(const m of c){s.index++;const b=l?l(m,s):null;e(b,s.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:i}=this;const{data:l,geometryBuffer:c}=this,{startRow:s=0,endRow:m=1/0}=e||{},b={};if(e||(r=[0],n=[0]),this.normalize||!c)this._forEachGeometry((E,O)=>{const N=E&&this.normalizeGeometry(E);b[O]=N,n[O+1]=n[O]+(N?this.getGeometrySize(N):0)},s,m),i=n[n.length-1];else if(n=l.startIndices,i=n[l.length]||0,ArrayBuffer.isView(c))i=i||c.length/this.positionSize;else if(c instanceof Ai){const E=this.positionSize*4;i=i||c.byteLength/E}else if(c.buffer){const E=c.stride||this.positionSize*4;i=i||c.buffer.byteLength/E}else if(c.value){const E=c.value,O=c.stride/E.BYTES_PER_ELEMENT||this.positionSize;i=i||E.length/O}this._allocate(i,!!e),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;const w={};this._forEachGeometry((E,O)=>{const N=b[O]||E;w.vertexStart=n[O],w.indexStart=r[O];const V=O<n.length-1?n[O+1]:i;w.geometrySize=V-n[O],w.geometryIndex=O,this.updateGeometryAttributes(N,w)},s,m),this.vertexCount=r[r.length-1]}}const lO=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,bQ={name:"icon",vs:lO,fs:lO,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},xQ=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,wQ=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,TQ=1024,SQ=4,cO=()=>{},uO={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},AQ={x:0,y:0,width:0,height:0};function EQ(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function PQ(t,e,r,n){const i=Math.min(r/e.width,n/e.height),l=Math.floor(e.width*i),c=Math.floor(e.height*i);return i===1?{image:e,width:l,height:c}:(t.canvas.height=c,t.canvas.width=l,t.clearRect(0,0,l,c),t.drawImage(e,0,0,e.width,e.height,0,0,l,c),{image:t.canvas,width:l,height:c})}function X0(t){return t&&(t.id||t.url)}function CQ(t,e,r,n){const{width:i,height:l,device:c}=t,s=c.createTexture({format:"rgba8unorm",width:e,height:r,sampler:n,mipLevels:c.getMipLevelCount(e,r)}),m=c.createCommandEncoder();return m.copyTextureToTexture({sourceTexture:t,destinationTexture:s,width:i,height:l}),m.finish(),s.generateMipmapsWebGL(),t.destroy(),s}function hO(t,e,r){for(let n=0;n<e.length;n++){const{icon:i,xOffset:l}=e[n],c=X0(i);t[c]={...i,x:l,y:r}}}function MQ({icons:t,buffer:e,mapping:r={},xOffset:n=0,yOffset:i=0,rowHeight:l=0,canvasWidth:c}){let s=[];for(let m=0;m<t.length;m++){const b=t[m],w=X0(b);if(!r[w]){const{height:E,width:O}=b;n+O+e>c&&(hO(r,s,i),n=0,i=l+i+e,l=0,s=[]),s.push({icon:b,xOffset:n}),n=n+O+e,l=Math.max(l,E)}}return s.length>0&&hO(r,s,i),{mapping:r,rowHeight:l,xOffset:n,yOffset:i,canvasWidth:c,canvasHeight:EQ(l+i+e)}}function IQ(t,e,r){if(!t||!e)return null;r=r||{};const n={},{iterable:i,objectInfo:l}=TT(t);for(const c of i){l.index++;const s=e(c,l),m=X0(s);if(!s)throw new Error("Icon is missing.");if(!s.url)throw new Error("Icon url is missing.");!n[m]&&(!r[m]||s.url!==r[m].url)&&(n[m]={...s,source:c,sourceIndex:l.index})}return n}class RQ{constructor(e,{onUpdate:r=cO,onError:n=cO}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=SQ,this._canvasWidth=TQ,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const r=this._autoPacking?X0(e):e;return this._mapping[r]||AQ}setProps({loadOptions:e,autoPacking:r,iconAtlas:n,iconMapping:i,textureParameters:l}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),l&&(this._samplerParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(IQ(e,r,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:l,yOffset:c,rowHeight:s,canvasHeight:m}=MQ({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=s,this._mapping=i,this._xOffset=l,this._yOffset=c,this._canvasHeight=m,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||uO,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=CQ(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||uO)),this.onUpdate(!0),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const r=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Q1(n.url,this._loadOptions).then(i=>{const l=X0(n),c=this._mapping[l],{x:s,y:m,width:b,height:w}=c,{image:E,width:O,height:N}=PQ(r,i,b,w),V=s+(b-O)/2,W=m+(w-N)/2;this._texture?.copyExternalImage({image:E,x:V,y:W,width:O,height:N}),c.x=V,c.y=W,c.width=O,c.height=N,this._texture?.generateMipmapsWebGL(),this.onUpdate(O!==b||N!==w)}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const WB=[0,0,0,255],OQ={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:WB},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class AT extends Mp{getShaders(){return super.getShaders({vs:xQ,fs:wQ,modules:[vb,bb,bQ]})}initializeState(){this.state={iconManager:new RQ(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:WB},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,l=this.getAttributeManager(),{iconAtlas:c,iconMapping:s,data:m,getIcon:b,textureParameters:w}=r,{iconManager:E}=this.state;if(typeof c=="string")return;const O=c||this.internalState.isAsyncPropLoading("iconAtlas");E.setProps({loadOptions:r.loadOptions,autoPacking:!O,iconAtlas:c,iconMapping:O?s:null,textureParameters:w}),O?n.iconMapping!==r.iconMapping&&l.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&E.packIcons(m,b),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),l.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:r,sizeBasis:n,sizeMinPixels:i,sizeMaxPixels:l,sizeUnits:c,billboard:s,alphaCutoff:m}=this.props,{iconManager:b}=this.state,w=b.getTexture();if(w){const E=this.state.model,O={iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:ed[c],sizeScale:r,sizeBasis:n==="height"?1:0,sizeMinPixels:i,sizeMaxPixels:l,billboard:s,alphaCutoff:m};E.shaderInputs.setProps({icon:O}),E.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ny({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(e){e?(this.getAttributeManager()?.invalidate("getIcon"),this.setNeedsUpdate()):this.setNeedsRedraw()}_onError(e){const r=this.getCurrentLayer()?.props.onIconError;r?r(e):Wr.error(e.error.message)()}getInstanceOffset(e){const{width:r,height:n,anchorX:i=r/2,anchorY:l=n/2}=this.state.iconManager.getIconMapping(e);return[r/2-i,n/2-l]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:r,y:n,width:i,height:l}=this.state.iconManager.getIconMapping(e);return[r,n,i,l]}}AT.defaultProps=OQ;AT.layerName="IconLayer";const fO=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,DQ={name:"scatterplot",vs:fO,fs:fO,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},kQ=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,LQ=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NQ=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,dO=[0,0,0,255],zQ={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:dO},getLineColor:{type:"accessor",value:dO},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class BC extends Mp{getShaders(){return super.getShaders({vs:kQ,fs:LQ,source:NQ,modules:[vb,DH,bb,DQ]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:l,stroked:c,filled:s,billboard:m,antialiasing:b,lineWidthUnits:w,lineWidthScale:E,lineWidthMinPixels:O,lineWidthMaxPixels:N}=this.props,V={stroked:c,filled:s,billboard:m,antialiasing:b,radiusUnits:ed[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:l,lineWidthUnits:ed[w],lineWidthScale:E,lineWidthMinPixels:O,lineWidthMaxPixels:N},W=this.state.model;W.shaderInputs.setProps({scatterplot:V}),this.context.device.type==="webgpu"&&(W.instanceCount=this.props.data.length),W.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,r=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ny({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(r)}}}),isInstanced:!0,parameters:e})}}BC.defaultProps=zQ;BC.layerName="ScatterplotLayer";const HB={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function qB(t,e,r={}){return BQ(t,r)!==e?(jQ(t,r),!0):!1}function BQ(t,e={}){return Math.sign(FQ(t,e))}const pO={x:0,y:1,z:2};function FQ(t,e={}){const{start:r=0,end:n=t.length,plane:i="xy"}=e,l=e.size||2;let c=0;const s=pO[i[0]],m=pO[i[1]];for(let b=r,w=n-l;b<n;b+=l)c+=(t[b+s]-t[w+s])*(t[b+m]+t[w+m]),w=b;return c/2}function jQ(t,e){const{start:r=0,end:n=t.length,size:i=2}=e,l=(n-r)/i,c=Math.floor(l/2);for(let s=0;s<c;++s){const m=r+s*i,b=r+(l-1-s)*i;for(let w=0;w<i;++w){const E=t[m+w];t[m+w]=t[b+w],t[b+w]=E}}}function Su(t,e){const r=e.length,n=t.length;if(n>0){let i=!0;for(let l=0;l<r;l++)if(t[n-r+l]!==e[l]){i=!1;break}if(i)return!1}for(let i=0;i<r;i++)t[n+i]=e[i];return!0}function HE(t,e){const r=e.length;for(let n=0;n<r;n++)t[n]=e[n]}function G0(t,e,r,n,i=[]){const l=n+e*r;for(let c=0;c<r;c++)i[c]=t[l+c];return i}function qE(t,e,r,n,i=[]){let l,c;if(r&8)l=(n[3]-t[1])/(e[1]-t[1]),c=3;else if(r&4)l=(n[1]-t[1])/(e[1]-t[1]),c=1;else if(r&2)l=(n[2]-t[0])/(e[0]-t[0]),c=2;else if(r&1)l=(n[0]-t[0])/(e[0]-t[0]),c=0;else return null;for(let s=0;s<t.length;s++)i[s]=(c&1)===s?n[c]:l*(e[s]-t[s])+t[s];return i}function B1(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function XB(t,e){const{size:r=2,broken:n=!1,gridResolution:i=10,gridOffset:l=[0,0],startIndex:c=0,endIndex:s=t.length}=e||{},m=(s-c)/r;let b=[];const w=[b],E=G0(t,0,r,c);let O,N;const V=ZB(E,i,l,[]),W=[];Su(b,E);for(let j=1;j<m;j++){for(O=G0(t,j,r,c,O),N=B1(O,V);N;){qE(E,O,N,V,W);const Y=B1(W,V);Y&&(qE(E,W,Y,V,W),N=Y),Su(b,W),HE(E,W),VQ(V,i,N),n&&b.length>r&&(b=[],w.push(b),Su(b,E)),N=B1(O,V)}Su(b,O),HE(E,O)}return n?w:w[0]}const gO=0,UQ=1;function GB(t,e=null,r){if(!t.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:l=[0,0],edgeTypes:c=!1}=r||{},s=[],m=[{pos:t,types:c?new Array(t.length/n).fill(UQ):null,holes:e||[]}],b=[[],[]];let w=[];for(;m.length;){const{pos:E,types:O,holes:N}=m.shift();$Q(E,n,N[0]||E.length,b),w=ZB(b[0],i,l,w);const V=B1(b[1],w);if(V){let W=mO(E,O,n,0,N[0]||E.length,w,V);const j={pos:W[0].pos,types:W[0].types,holes:[]},Y={pos:W[1].pos,types:W[1].types,holes:[]};m.push(j,Y);for(let ce=0;ce<N.length;ce++)W=mO(E,O,n,N[ce],N[ce+1]||E.length,w,V),W[0]&&(j.holes.push(j.pos.length),j.pos=i1(j.pos,W[0].pos),c&&(j.types=i1(j.types,W[0].types))),W[1]&&(Y.holes.push(Y.pos.length),Y.pos=i1(Y.pos,W[1].pos),c&&(Y.types=i1(Y.types,W[1].types)))}else{const W={positions:E};c&&(W.edgeTypes=O),N.length&&(W.holeIndices=N),s.push(W)}}return s}function mO(t,e,r,n,i,l,c){const s=(i-n)/r,m=[],b=[],w=[],E=[],O=[];let N,V,W;const j=G0(t,s-1,r,n);let Y=Math.sign(c&8?j[1]-l[3]:j[0]-l[2]),ce=e&&e[s-1],re=0,ue=0;for(let me=0;me<s;me++)N=G0(t,me,r,n,N),V=Math.sign(c&8?N[1]-l[3]:N[0]-l[2]),W=e&&e[n/r+me],V&&Y&&Y!==V&&(qE(j,N,c,l,O),Su(m,O)&&w.push(ce),Su(b,O)&&E.push(ce)),V<=0?(Su(m,N)&&w.push(W),re-=V):w.length&&(w[w.length-1]=gO),V>=0?(Su(b,N)&&E.push(W),ue+=V):E.length&&(E[E.length-1]=gO),HE(j,N),Y=V,ce=W;return[re?{pos:m,types:e&&w}:null,ue?{pos:b,types:e&&E}:null]}function ZB(t,e,r,n){const i=Math.floor((t[0]-r[0])/e)*e+r[0],l=Math.floor((t[1]-r[1])/e)*e+r[1];return n[0]=i,n[1]=l,n[2]=i+e,n[3]=l+e,n}function VQ(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function $Q(t,e,r,n){let i=1/0,l=-1/0,c=1/0,s=-1/0;for(let m=0;m<r;m+=e){const b=t[m],w=t[m+1];i=b<i?b:i,l=b>l?b:l,c=w<c?w:c,s=w>s?w:s}return n[0][0]=i,n[0][1]=c,n[1][0]=l,n[1][1]=s,n}function i1(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}const WQ=85.051129;function HQ(t,e){const{size:r=2,startIndex:n=0,endIndex:i=t.length,normalize:l=!0}=e||{},c=t.slice(n,i);YB(c,r,0,i-n);const s=XB(c,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(l)for(const m of s)KB(m,r);return s}function qQ(t,e=null,r){const{size:n=2,normalize:i=!0,edgeTypes:l=!1}=r||{};e=e||[];const c=[],s=[];let m=0,b=0;for(let E=0;E<=e.length;E++){const O=e[E]||t.length,N=b,V=XQ(t,n,m,O);for(let W=V;W<O;W++)c[b++]=t[W];for(let W=m;W<V;W++)c[b++]=t[W];YB(c,n,N,b),GQ(c,n,N,b,r?.maxLatitude),m=O,s[E]=b}s.pop();const w=GB(c,s,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:l});if(i)for(const E of w)KB(E.positions,n);return w}function XQ(t,e,r,n){let i=-1,l=-1;for(let c=r+1;c<n;c+=e){const s=Math.abs(t[c]);s>i&&(i=s,l=c-1)}return l}function GQ(t,e,r,n,i=WQ){const l=t[r],c=t[n-e];if(Math.abs(l-c)>180){const s=G0(t,0,e,r);s[0]+=Math.round((c-l)/360)*360,Su(t,s),s[1]=Math.sign(s[1])*i,Su(t,s),s[0]=l,Su(t,s)}}function YB(t,e,r,n){let i=t[0],l;for(let c=r;c<n;c+=e){l=t[c];const s=l-i;(s>180||s<-180)&&(l-=Math.round(s/360)*360),t[c]=i=l}}function KB(t,e){let r;const n=t.length/e;for(let l=0;l<n&&(r=t[l*e],(r+180)%360===0);l++);const i=-Math.round(r/360)*360;if(i!==0)for(let l=0;l<n;l++)t[l*e]+=i}function ZQ(t,e,r,n){let i;if(Array.isArray(t[0])){const l=t.length*e;i=new Array(l);for(let c=0;c<t.length;c++)for(let s=0;s<e;s++)i[c*e+s]=t[c][s]||0}else i=t;return r?XB(i,{size:e,gridResolution:r}):n?HQ(i,{size:e}):i}const YQ=1,KQ=2,TS=4;class QQ extends $B{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?ZQ(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(_O(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&_O(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:l,geometrySize:c}=r;n.fill(0,l,l+c),i?(n[l]=TS,n[l+c-2]=TS):(n[l]+=YQ,n[l+c-2]+=KQ),n[l+c-1]=TS}_updatePositions(e,r){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:l}=r,c=new Array(3);for(let s=i,m=0;m<l;s++,m++)this.getPointOnPath(e,m,c),n[s*3]=c[0],n[s*3+1]=c[1],n[s*3+2]=c[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,n=[]){const{positionSize:i}=this;r*i>=e.length&&(r+=1-e.length/i);const l=r*i;return n[0]=e[l],n[1]=e[l+1],n[2]=i===3&&e[l+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:r}=this,n=e.length-r;return e[0]===e[n]&&e[1]===e[n+1]&&(r===2||e[2]===e[n+2])}}function _O(t){return Array.isArray(t[0])}const yO=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,JQ={name:"path",vs:yO,fs:yO,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},eJ=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tJ=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,QB=[0,0,0,255],rJ={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:QB},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},SS={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class FC extends Mp{getShaders(){return super.getShaders({vs:eJ,fs:tJ,modules:[vb,bb,JQ]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:SS,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:SS,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:SS,defaultValue:QB},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:i,target:l})=>this.encodePickingColor(n&&n.__source?n.__source.index:i,l)}}),this.setState({pathTesselator:new QQ({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:r,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,s=r.data.attributes||{};c.updateGeometry({data:r.data,geometryBuffer:s.getPath,buffers:s,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(l=>l.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:r,capRounded:n,billboard:i,miterLimit:l,widthUnits:c,widthScale:s,widthMinPixels:m,widthMaxPixels:b}=this.props,w=this.state.model,E={jointType:Number(r),capType:Number(n),billboard:i,widthUnits:ed[c],widthScale:s,miterLimit:l,widthMinPixels:m,widthMaxPixels:b};w.shaderInputs.setProps({path:E}),w.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ny({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}}FC.defaultProps=rJ;FC.layerName="PathLayer";var s1={exports:{}},vO;function nJ(){if(vO)return s1.exports;vO=1,s1.exports=t,s1.exports.default=t;function t(fe,Me,Ee){Ee=Ee||2;var Ue=Me&&Me.length,st=Ue?Me[0]*Ee:fe.length,ye=e(fe,0,st,Ee,!0),Be=[];if(!ye||ye.next===ye.prev)return Be;var lt,Tt,zt,Xt,Wt,nr,_t;if(Ue&&(ye=m(fe,Me,ye,Ee)),fe.length>80*Ee){lt=zt=fe[0],Tt=Xt=fe[1];for(var Yt=Ee;Yt<st;Yt+=Ee)Wt=fe[Yt],nr=fe[Yt+1],Wt<lt&&(lt=Wt),nr<Tt&&(Tt=nr),Wt>zt&&(zt=Wt),nr>Xt&&(Xt=nr);_t=Math.max(zt-lt,Xt-Tt),_t=_t!==0?32767/_t:0}return n(ye,Be,Ee,lt,Tt,_t,0),Be}function e(fe,Me,Ee,Ue,st){var ye,Be;if(st===Zt(fe,Me,Ee,Ue)>0)for(ye=Me;ye<Ee;ye+=Ue)Be=Ye(ye,fe[ye],fe[ye+1],Be);else for(ye=Ee-Ue;ye>=Me;ye-=Ue)Be=Ye(ye,fe[ye],fe[ye+1],Be);return Be&&ue(Be,Be.next)&&(jt(Be),Be=Be.next),Be}function r(fe,Me){if(!fe)return fe;Me||(Me=fe);var Ee=fe,Ue;do if(Ue=!1,!Ee.steiner&&(ue(Ee,Ee.next)||re(Ee.prev,Ee,Ee.next)===0)){if(jt(Ee),Ee=Me=Ee.prev,Ee===Ee.next)break;Ue=!0}else Ee=Ee.next;while(Ue||Ee!==Me);return Me}function n(fe,Me,Ee,Ue,st,ye,Be){if(fe){!Be&&ye&&N(fe,Ue,st,ye);for(var lt=fe,Tt,zt;fe.prev!==fe.next;){if(Tt=fe.prev,zt=fe.next,ye?l(fe,Ue,st,ye):i(fe)){Me.push(Tt.i/Ee|0),Me.push(fe.i/Ee|0),Me.push(zt.i/Ee|0),jt(fe),fe=zt.next,lt=zt.next;continue}if(fe=zt,fe===lt){Be?Be===1?(fe=c(r(fe),Me,Ee),n(fe,Me,Ee,Ue,st,ye,2)):Be===2&&s(fe,Me,Ee,Ue,st,ye):n(r(fe),Me,Ee,Ue,st,ye,1);break}}}}function i(fe){var Me=fe.prev,Ee=fe,Ue=fe.next;if(re(Me,Ee,Ue)>=0)return!1;for(var st=Me.x,ye=Ee.x,Be=Ue.x,lt=Me.y,Tt=Ee.y,zt=Ue.y,Xt=st<ye?st<Be?st:Be:ye<Be?ye:Be,Wt=lt<Tt?lt<zt?lt:zt:Tt<zt?Tt:zt,nr=st>ye?st>Be?st:Be:ye>Be?ye:Be,_t=lt>Tt?lt>zt?lt:zt:Tt>zt?Tt:zt,Yt=Ue.next;Yt!==Me;){if(Yt.x>=Xt&&Yt.x<=nr&&Yt.y>=Wt&&Yt.y<=_t&&Y(st,lt,ye,Tt,Be,zt,Yt.x,Yt.y)&&re(Yt.prev,Yt,Yt.next)>=0)return!1;Yt=Yt.next}return!0}function l(fe,Me,Ee,Ue){var st=fe.prev,ye=fe,Be=fe.next;if(re(st,ye,Be)>=0)return!1;for(var lt=st.x,Tt=ye.x,zt=Be.x,Xt=st.y,Wt=ye.y,nr=Be.y,_t=lt<Tt?lt<zt?lt:zt:Tt<zt?Tt:zt,Yt=Xt<Wt?Xt<nr?Xt:nr:Wt<nr?Wt:nr,Tr=lt>Tt?lt>zt?lt:zt:Tt>zt?Tt:zt,Rt=Xt>Wt?Xt>nr?Xt:nr:Wt>nr?Wt:nr,$n=W(_t,Yt,Me,Ee,Ue),_r=W(Tr,Rt,Me,Ee,Ue),sr=fe.prevZ,ur=fe.nextZ;sr&&sr.z>=$n&&ur&&ur.z<=_r;){if(sr.x>=_t&&sr.x<=Tr&&sr.y>=Yt&&sr.y<=Rt&&sr!==st&&sr!==Be&&Y(lt,Xt,Tt,Wt,zt,nr,sr.x,sr.y)&&re(sr.prev,sr,sr.next)>=0||(sr=sr.prevZ,ur.x>=_t&&ur.x<=Tr&&ur.y>=Yt&&ur.y<=Rt&&ur!==st&&ur!==Be&&Y(lt,Xt,Tt,Wt,zt,nr,ur.x,ur.y)&&re(ur.prev,ur,ur.next)>=0))return!1;ur=ur.nextZ}for(;sr&&sr.z>=$n;){if(sr.x>=_t&&sr.x<=Tr&&sr.y>=Yt&&sr.y<=Rt&&sr!==st&&sr!==Be&&Y(lt,Xt,Tt,Wt,zt,nr,sr.x,sr.y)&&re(sr.prev,sr,sr.next)>=0)return!1;sr=sr.prevZ}for(;ur&&ur.z<=_r;){if(ur.x>=_t&&ur.x<=Tr&&ur.y>=Yt&&ur.y<=Rt&&ur!==st&&ur!==Be&&Y(lt,Xt,Tt,Wt,zt,nr,ur.x,ur.y)&&re(ur.prev,ur,ur.next)>=0)return!1;ur=ur.nextZ}return!0}function c(fe,Me,Ee){var Ue=fe;do{var st=Ue.prev,ye=Ue.next.next;!ue(st,ye)&&me(st,Ue,Ue.next,ye)&&Xe(st,ye)&&Xe(ye,st)&&(Me.push(st.i/Ee|0),Me.push(Ue.i/Ee|0),Me.push(ye.i/Ee|0),jt(Ue),jt(Ue.next),Ue=fe=ye),Ue=Ue.next}while(Ue!==fe);return r(Ue)}function s(fe,Me,Ee,Ue,st,ye){var Be=fe;do{for(var lt=Be.next.next;lt!==Be.prev;){if(Be.i!==lt.i&&ce(Be,lt)){var Tt=gt(Be,lt);Be=r(Be,Be.next),Tt=r(Tt,Tt.next),n(Be,Me,Ee,Ue,st,ye,0),n(Tt,Me,Ee,Ue,st,ye,0);return}lt=lt.next}Be=Be.next}while(Be!==fe)}function m(fe,Me,Ee,Ue){var st=[],ye,Be,lt,Tt,zt;for(ye=0,Be=Me.length;ye<Be;ye++)lt=Me[ye]*Ue,Tt=ye<Be-1?Me[ye+1]*Ue:fe.length,zt=e(fe,lt,Tt,Ue,!1),zt===zt.next&&(zt.steiner=!0),st.push(j(zt));for(st.sort(b),ye=0;ye<st.length;ye++)Ee=w(st[ye],Ee);return Ee}function b(fe,Me){return fe.x-Me.x}function w(fe,Me){var Ee=E(fe,Me);if(!Ee)return Me;var Ue=gt(Ee,fe);return r(Ue,Ue.next),r(Ee,Ee.next)}function E(fe,Me){var Ee=Me,Ue=fe.x,st=fe.y,ye=-1/0,Be;do{if(st<=Ee.y&&st>=Ee.next.y&&Ee.next.y!==Ee.y){var lt=Ee.x+(st-Ee.y)*(Ee.next.x-Ee.x)/(Ee.next.y-Ee.y);if(lt<=Ue&&lt>ye&&(ye=lt,Be=Ee.x<Ee.next.x?Ee:Ee.next,lt===Ue))return Be}Ee=Ee.next}while(Ee!==Me);if(!Be)return null;var Tt=Be,zt=Be.x,Xt=Be.y,Wt=1/0,nr;Ee=Be;do Ue>=Ee.x&&Ee.x>=zt&&Ue!==Ee.x&&Y(st<Xt?Ue:ye,st,zt,Xt,st<Xt?ye:Ue,st,Ee.x,Ee.y)&&(nr=Math.abs(st-Ee.y)/(Ue-Ee.x),Xe(Ee,fe)&&(nr<Wt||nr===Wt&&(Ee.x>Be.x||Ee.x===Be.x&&O(Be,Ee)))&&(Be=Ee,Wt=nr)),Ee=Ee.next;while(Ee!==Tt);return Be}function O(fe,Me){return re(fe.prev,fe,Me.prev)<0&&re(Me.next,fe,fe.next)<0}function N(fe,Me,Ee,Ue){var st=fe;do st.z===0&&(st.z=W(st.x,st.y,Me,Ee,Ue)),st.prevZ=st.prev,st.nextZ=st.next,st=st.next;while(st!==fe);st.prevZ.nextZ=null,st.prevZ=null,V(st)}function V(fe){var Me,Ee,Ue,st,ye,Be,lt,Tt,zt=1;do{for(Ee=fe,fe=null,ye=null,Be=0;Ee;){for(Be++,Ue=Ee,lt=0,Me=0;Me<zt&&(lt++,Ue=Ue.nextZ,!!Ue);Me++);for(Tt=zt;lt>0||Tt>0&&Ue;)lt!==0&&(Tt===0||!Ue||Ee.z<=Ue.z)?(st=Ee,Ee=Ee.nextZ,lt--):(st=Ue,Ue=Ue.nextZ,Tt--),ye?ye.nextZ=st:fe=st,st.prevZ=ye,ye=st;Ee=Ue}ye.nextZ=null,zt*=2}while(Be>1);return fe}function W(fe,Me,Ee,Ue,st){return fe=(fe-Ee)*st|0,Me=(Me-Ue)*st|0,fe=(fe|fe<<8)&16711935,fe=(fe|fe<<4)&252645135,fe=(fe|fe<<2)&858993459,fe=(fe|fe<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,fe|Me<<1}function j(fe){var Me=fe,Ee=fe;do(Me.x<Ee.x||Me.x===Ee.x&&Me.y<Ee.y)&&(Ee=Me),Me=Me.next;while(Me!==fe);return Ee}function Y(fe,Me,Ee,Ue,st,ye,Be,lt){return(st-Be)*(Me-lt)>=(fe-Be)*(ye-lt)&&(fe-Be)*(Ue-lt)>=(Ee-Be)*(Me-lt)&&(Ee-Be)*(ye-lt)>=(st-Be)*(Ue-lt)}function ce(fe,Me){return fe.next.i!==Me.i&&fe.prev.i!==Me.i&&!We(fe,Me)&&(Xe(fe,Me)&&Xe(Me,fe)&&Et(fe,Me)&&(re(fe.prev,fe,Me.prev)||re(fe,Me.prev,Me))||ue(fe,Me)&&re(fe.prev,fe,fe.next)>0&&re(Me.prev,Me,Me.next)>0)}function re(fe,Me,Ee){return(Me.y-fe.y)*(Ee.x-Me.x)-(Me.x-fe.x)*(Ee.y-Me.y)}function ue(fe,Me){return fe.x===Me.x&&fe.y===Me.y}function me(fe,Me,Ee,Ue){var st=Ce(re(fe,Me,Ee)),ye=Ce(re(fe,Me,Ue)),Be=Ce(re(Ee,Ue,fe)),lt=Ce(re(Ee,Ue,Me));return!!(st!==ye&&Be!==lt||st===0&&ge(fe,Ee,Me)||ye===0&&ge(fe,Ue,Me)||Be===0&&ge(Ee,fe,Ue)||lt===0&&ge(Ee,Me,Ue))}function ge(fe,Me,Ee){return Me.x<=Math.max(fe.x,Ee.x)&&Me.x>=Math.min(fe.x,Ee.x)&&Me.y<=Math.max(fe.y,Ee.y)&&Me.y>=Math.min(fe.y,Ee.y)}function Ce(fe){return fe>0?1:fe<0?-1:0}function We(fe,Me){var Ee=fe;do{if(Ee.i!==fe.i&&Ee.next.i!==fe.i&&Ee.i!==Me.i&&Ee.next.i!==Me.i&&me(Ee,Ee.next,fe,Me))return!0;Ee=Ee.next}while(Ee!==fe);return!1}function Xe(fe,Me){return re(fe.prev,fe,fe.next)<0?re(fe,Me,fe.next)>=0&&re(fe,fe.prev,Me)>=0:re(fe,Me,fe.prev)<0||re(fe,fe.next,Me)<0}function Et(fe,Me){var Ee=fe,Ue=!1,st=(fe.x+Me.x)/2,ye=(fe.y+Me.y)/2;do Ee.y>ye!=Ee.next.y>ye&&Ee.next.y!==Ee.y&&st<(Ee.next.x-Ee.x)*(ye-Ee.y)/(Ee.next.y-Ee.y)+Ee.x&&(Ue=!Ue),Ee=Ee.next;while(Ee!==fe);return Ue}function gt(fe,Me){var Ee=new St(fe.i,fe.x,fe.y),Ue=new St(Me.i,Me.x,Me.y),st=fe.next,ye=Me.prev;return fe.next=Me,Me.prev=fe,Ee.next=st,st.prev=Ee,Ue.next=Ee,Ee.prev=Ue,ye.next=Ue,Ue.prev=ye,Ue}function Ye(fe,Me,Ee,Ue){var st=new St(fe,Me,Ee);return Ue?(st.next=Ue.next,st.prev=Ue,Ue.next.prev=st,Ue.next=st):(st.prev=st,st.next=st),st}function jt(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function St(fe,Me,Ee){this.i=fe,this.x=Me,this.y=Ee,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(fe,Me,Ee,Ue){var st=Me&&Me.length,ye=st?Me[0]*Ee:fe.length,Be=Math.abs(Zt(fe,0,ye,Ee));if(st)for(var lt=0,Tt=Me.length;lt<Tt;lt++){var zt=Me[lt]*Ee,Xt=lt<Tt-1?Me[lt+1]*Ee:fe.length;Be-=Math.abs(Zt(fe,zt,Xt,Ee))}var Wt=0;for(lt=0;lt<Ue.length;lt+=3){var nr=Ue[lt]*Ee,_t=Ue[lt+1]*Ee,Yt=Ue[lt+2]*Ee;Wt+=Math.abs((fe[nr]-fe[Yt])*(fe[_t+1]-fe[nr+1])-(fe[nr]-fe[_t])*(fe[Yt+1]-fe[nr+1]))}return Be===0&&Wt===0?0:Math.abs((Wt-Be)/Be)};function Zt(fe,Me,Ee,Ue){for(var st=0,ye=Me,Be=Ee-Ue;ye<Ee;ye+=Ue)st+=(fe[Be]-fe[ye])*(fe[ye+1]+fe[Be+1]),Be=ye;return st}return t.flatten=function(fe){for(var Me=fe[0][0].length,Ee={vertices:[],holes:[],dimensions:Me},Ue=0,st=0;st<fe.length;st++){for(var ye=0;ye<fe[st].length;ye++)for(var Be=0;Be<Me;Be++)Ee.vertices.push(fe[st][ye][Be]);st>0&&(Ue+=fe[st-1].length,Ee.holes.push(Ue))}return Ee},s1.exports}var iJ=nJ();const sJ=Fh(iJ),a1=HB.CLOCKWISE,bO=HB.COUNTER_CLOCKWISE,bp={};function aJ(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function A0(t){return"positions"in t?t.positions:t}function F1(t){return"holeIndices"in t?t.holeIndices:null}function oJ(t){return Array.isArray(t[0])}function lJ(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function cJ(t){const e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function uJ(t,e,r,n){for(let i=0;i<e;i++)if(t[r+i]!==t[n-e+i])return!1;return!0}function xO(t,e,r,n,i){let l=e;const c=r.length;for(let s=0;s<c;s++)for(let m=0;m<n;m++)t[l++]=r[s][m]||0;if(!cJ(r))for(let s=0;s<n;s++)t[l++]=r[0][s]||0;return bp.start=e,bp.end=l,bp.size=n,qB(t,i,bp),l}function wO(t,e,r,n,i=0,l,c){l=l||r.length;const s=l-i;if(s<=0)return e;let m=e;for(let b=0;b<s;b++)t[m++]=r[i+b];if(!uJ(r,n,i,l))for(let b=0;b<n;b++)t[m++]=r[i+b];return bp.start=e,bp.end=m,bp.size=n,qB(t,c,bp),m}function hJ(t,e){aJ(t);const r=[],n=[];if("positions"in t){const{positions:i,holeIndices:l}=t;if(l){let c=0;for(let s=0;s<=l.length;s++)c=wO(r,c,i,e,l[s-1],l[s],s===0?a1:bO),n.push(c);return n.pop(),{positions:r,holeIndices:n}}t=i}if(!oJ(t))return wO(r,0,t,e,0,r.length,a1),r;if(!lJ(t)){let i=0;for(const[l,c]of t.entries())i=xO(r,i,c,e,l===0?a1:bO),n.push(i);return n.pop(),{positions:r,holeIndices:n}}return xO(r,0,t,e,a1),r}function AS(t,e,r){const n=t.length/3;let i=0;for(let l=0;l<n;l++){const c=(l+1)%n;i+=t[l*3+e]*t[c*3+r],i-=t[c*3+e]*t[l*3+r]}return Math.abs(i/2)}function TO(t,e,r,n){const i=t.length/3;for(let l=0;l<i;l++){const c=l*3,s=t[c+0],m=t[c+1],b=t[c+2];t[c+e]=s,t[c+r]=m,t[c+n]=b}}function fJ(t,e,r,n){let i=F1(t);i&&(i=i.map(s=>s/e));let l=A0(t);const c=n&&e===3;if(r){const s=l.length;l=l.slice();const m=[];for(let b=0;b<s;b+=e){m[0]=l[b],m[1]=l[b+1],c&&(m[2]=l[b+2]);const w=r(m);l[b]=w[0],l[b+1]=w[1],c&&(l[b+2]=w[2])}}if(c){const s=AS(l,0,1),m=AS(l,0,2),b=AS(l,1,2);if(!s&&!m&&!b)return[];s>m&&s>b||(m>b?(r||(l=l.slice()),TO(l,0,2,1)):(r||(l=l.slice()),TO(l,2,0,1)))}return sJ(l,i,e)}class dJ extends $B{constructor(e){const{fp64:r,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);const r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const r=hJ(e,this.positionSize);return this.opts.resolution?GB(A0(r),F1(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?qQ(A0(r),F1(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(SO(e)){let r=0;for(const n of e)r+=this.getGeometrySize(n);return r}return A0(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&SO(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{const n=e;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:n,indexStart:i}){const{attributes:l,indexStarts:c,typedArrayManager:s}=this;let m=l.indices;if(!m||!e)return;let b=i;const w=fJ(e,this.positionSize,this.opts.preproject,this.opts.full3d);m=s.allocate(m,i+w.length,{copy:!0});for(let E=0;E<w.length;E++)m[b++]=w[E]+n;c[r+1]=i+w.length,l.indices=m}_updatePositions(e,{vertexStart:r,geometrySize:n}){const{attributes:{positions:i},positionSize:l}=this;if(!i||!e)return;const c=A0(e);for(let s=r,m=0;m<n;s++,m++){const b=c[m*l],w=c[m*l+1],E=l>2?c[m*l+2]:0;i[s*3]=b,i[s*3+1]=w,i[s*3+2]=E}}_updateVertexValid(e,{vertexStart:r,geometrySize:n}){const{positionSize:i}=this,l=this.attributes.vertexValid,c=e&&F1(e);if(e&&e.edgeTypes?l.set(e.edgeTypes,r):l.fill(1,r,r+n),c)for(let s=0;s<c.length;s++)l[r+c[s]/i-1]=0;l[r+n-1]=0}}function SO(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const AO=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,pJ={name:"solidPolygon",vs:AO,fs:AO,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},JB=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gJ=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${JB}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,mJ=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${JB}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,_J=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,mw=[0,0,0,255],yJ={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:mw},getLineColor:{type:"accessor",value:mw},material:!0},o1={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class jC extends Mp{getShaders(e){return super.getShaders({vs:e==="top"?gJ:mJ,fs:_J,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[vb,Wz,bb,pJ]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&r===cn.DEFAULT&&(r=cn.LNGLAT);let i;r===cn.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new dJ({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const l=this.getAttributeManager(),c=!0;l.remove(["instancePickingColors"]),l.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:c},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:o1,accessor:"getPolygon",update:this.calculatePositions,noAlloc:c,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:c},elevations:{size:1,stepMode:"dynamic",transition:o1,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:o1,accessor:"getFillColor",defaultValue:mw},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:o1,accessor:"getLineColor",defaultValue:mw},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(s,{index:m,target:b})=>this.encodePickingColor(s&&s.__source?s.__source.index:m,b)}})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(l=>l.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:r,filled:n,wireframe:i,elevationScale:l}=this.props,{topModel:c,sideModel:s,wireframeModel:m,polygonTesselator:b}=this.state,w={extruded:!!r,elevationScale:l,isWireframe:!1};m&&i&&(m.setInstanceCount(b.instanceCount-1),m.shaderInputs.setProps({solidPolygon:{...w,isWireframe:!0}}),m.draw(this.context.renderPass)),s&&n&&(s.setInstanceCount(b.instanceCount-1),s.shaderInputs.setProps({solidPolygon:w}),s.draw(this.context.renderPass)),c&&n&&(c.setVertexCount(b.vertexCount),c.shaderInputs.setProps({solidPolygon:w}),c.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:r,oldProps:n,changeFlags:i}=e,l=this.getAttributeManager();(i.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(s=>s.destroy()),this.setState(this._getModels()),l.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:l}=this.state,c=e.data.attributes||{};l.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:c.getPolygon,buffers:c,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:r,extruded:n}=this.props;let i,l,c;if(r){const s=this.getShaders("top");s.defines.NON_INSTANCED_MODEL=1;const m=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Au(this.context.device,{...s,id:`${e}-top`,topology:"triangle-list",bufferLayout:m,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const s=this.getAttributeManager().getBufferLayouts({isInstanced:!0});l=new Au(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:s,geometry:new Ny({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),c=new Au(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:s,geometry:new Ny({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[l,c,i].filter(Boolean),topModel:i,sideModel:l,wireframeModel:c}}calculateIndices(e){const{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){const{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}jC.defaultProps=yJ;jC.layerName="SolidPolygonLayer";function vJ({data:t,getIndex:e,dataRange:r,replace:n}){const{startRow:i=0,endRow:l=1/0}=r,c=t.length;let s=c,m=c;for(let O=0;O<c;O++){const N=e(t[O]);if(s>O&&N>=i&&(s=O),N>=l){m=O;break}}let b=s;const E=m-s!==n.length?t.slice(m):void 0;for(let O=0;O<n.length;O++)t[b++]=n[O];if(E){for(let O=0;O<E.length;O++)t[b++]=E[O];t.length=b}return{startRow:s,endRow:s+n.length}}function bJ(t,e){if(!t)return null;const r="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[r];return r!==-1?xJ(t,n,r):null}function xJ(t,e,r){const n={properties:{...t.properties[e]}};for(const i in t.numericProps)n.properties[i]=t.numericProps[i].value[r];return n}function wJ(t,e){const r={points:null,lines:null,polygons:null};for(const n in r){const i=t[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(i.length*4);const l=[];for(let c=0;c<i.length;c++)e(i[c],l),r[n][c*4+0]=l[0],r[n][c*4+1]=l[1],r[n][c*4+2]=l[2],r[n][c*4+3]=255}return r}const EO=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,TJ={name:"sdf",vs:EO,fs:EO,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},SJ=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ES=192/256,PO=[],AJ={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class UC extends AT{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,TJ],fs:SJ}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;let{outlineColor:i}=r;i!==n.outlineColor&&(i=i.map(l=>l/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!r.sdf&&r.outlineWidth&&Wr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:r,smoothing:n,outlineWidth:i}=this.props,{outlineColor:l}=this.state,c=i?Math.max(n,ES*(1-i)):-1,s=this.state.model,m={buffer:ES,outlineBuffer:c,gamma:n,enabled:!!r,outlineColor:l};if(s.shaderInputs.setProps({sdf:m}),super.draw(e),r&&i){const{iconManager:b}=this.state;b.getTexture()&&(s.shaderInputs.setProps({sdf:{...m,outlineBuffer:ES}}),s.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):PO}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):PO}}UC.defaultProps=AJ;UC.layerName="MultiIconLayer";const z0=1e20;class EJ{constructor({fontSize:e=24,buffer:r=3,radius:n=8,cutoff:i=.25,fontFamily:l="sans-serif",fontWeight:c="normal",fontStyle:s="normal",lang:m=null}={}){this.buffer=r,this.cutoff=i,this.radius=n,this.lang=m;const b=this.size=e+r*4,w=this._createCanvas(b),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${s} ${c} ${e}px ${l}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(e){const r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){const{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:l,actualBoundingBoxRight:c}=this.ctx.measureText(e),s=Math.ceil(n),m=0,b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-l))),w=Math.min(this.size-this.buffer,s+Math.ceil(i)),E=b+2*this.buffer,O=w+2*this.buffer,N=Math.max(E*O,0),V=new Uint8ClampedArray(N),W={data:V,width:E,height:O,glyphWidth:b,glyphHeight:w,glyphTop:s,glyphLeft:m,glyphAdvance:r};if(b===0||w===0)return W;const{ctx:j,buffer:Y,gridInner:ce,gridOuter:re}=this;this.lang&&(j.lang=this.lang),j.clearRect(Y,Y,b,w),j.fillText(e,Y,Y+s);const ue=j.getImageData(Y,Y,b,w);re.fill(z0,0,N),ce.fill(0,0,N);for(let me=0;me<w;me++)for(let ge=0;ge<b;ge++){const Ce=ue.data[4*(me*b+ge)+3]/255;if(Ce===0)continue;const We=(me+Y)*E+ge+Y;if(Ce===1)re[We]=0,ce[We]=z0;else{const Xe=.5-Ce;re[We]=Xe>0?Xe*Xe:0,ce[We]=Xe<0?Xe*Xe:0}}CO(re,0,0,E,O,E,this.f,this.v,this.z),CO(ce,Y,Y,b,w,E,this.f,this.v,this.z);for(let me=0;me<N;me++){const ge=Math.sqrt(re[me])-Math.sqrt(ce[me]);V[me]=Math.round(255-255*(ge/this.radius+this.cutoff))}return W}}function CO(t,e,r,n,i,l,c,s,m){for(let b=e;b<e+n;b++)MO(t,r*l+b,l,i,c,s,m);for(let b=r;b<r+i;b++)MO(t,b*l+e,1,n,c,s,m)}function MO(t,e,r,n,i,l,c){l[0]=0,c[0]=-z0,c[1]=z0,i[0]=t[e];for(let s=1,m=0,b=0;s<n;s++){i[s]=t[e+s*r];const w=s*s;do{const E=l[m];b=(i[s]-i[E]+w-E*E)/(s-E)/2}while(b<=c[m]&&--m>-1);m++,l[m]=s,c[m]=b,c[m+1]=z0}for(let s=0,m=0;s<n;s++){for(;c[m+1]<s;)m++;const b=l[m],w=s-b;t[e+s*r]=i[b]+w*w}}const PJ=32,CJ=[];function MJ(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function IJ({characterSet:t,getFontWidth:e,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:l={},xOffset:c=0,yOffset:s=0}){let m=0,b=c;const w=r+n*2;for(const E of t)if(!l[E]){const O=e(E);b+O+n*2>i&&(b=0,m++),l[E]={x:b+n,y:s+m*w+n,width:O,height:w,layoutWidth:O,layoutHeight:r},b+=O+n*2}return{mapping:l,xOffset:b,yOffset:s+m*w,canvasHeight:MJ(s+(m+1)*w)}}function eF(t,e,r,n){let i=0;for(let l=e;l<r;l++){const c=t[l];i+=n[c]?.layoutWidth||0}return i}function tF(t,e,r,n,i,l){let c=e,s=0;for(let m=e;m<r;m++){const b=eF(t,m,m+1,i);s+b>n&&(c<m&&l.push(m),c=m,s=0),s+=b}return s}function RJ(t,e,r,n,i,l){let c=e,s=e,m=e,b=0;for(let w=e;w<r;w++)if((t[w]===" "||t[w+1]===" "||w+1===r)&&(m=w+1),m>s){let E=eF(t,s,m,i);b+E>n&&(c<s&&(l.push(s),c=s,b=0),E>n&&(E=tF(t,s,m,n,i,l),c=l[l.length-1])),s=m,b+=E}return b}function OJ(t,e,r,n,i=0,l){l===void 0&&(l=t.length);const c=[];return e==="break-all"?tF(t,i,l,r,n,c):RJ(t,i,l,r,n,c),c}function DJ(t,e,r,n,i,l){let c=0,s=0;for(let m=e;m<r;m++){const b=t[m],w=n[b];w?(s||(s=w.layoutHeight),i[m]=c+w.layoutWidth/2,c+=w.layoutWidth):(Wr.warn(`Missing character: ${b} (${b.codePointAt(0)})`)(),i[m]=c,c+=PJ)}l[0]=c,l[1]=s}function kJ(t,e,r,n,i){const l=Array.from(t),c=l.length,s=new Array(c),m=new Array(c),b=new Array(c),w=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,E=[0,0],O=[0,0];let N=0,V=0,W=0;for(let j=0;j<=c;j++){const Y=l[j];if((Y===`
`||j===c)&&(W=j),W>V){const ce=w?OJ(l,r,n,i,V,W):CJ;for(let re=0;re<=ce.length;re++){const ue=re===0?V:ce[re-1],me=re<ce.length?ce[re]:W;DJ(l,ue,me,i,s,O);for(let ge=ue;ge<me;ge++){const Ce=l[ge],We=i[Ce]?.layoutOffsetY||0;m[ge]=N+O[1]/2+We,b[ge]=O[0]}N=N+O[1]*e,E[0]=Math.max(E[0],O[0])}V=W}Y===`
`&&(s[V]=0,m[V]=0,b[V]=0,V++)}return E[1]=N,{x:s,y:m,rowWidth:b,size:E}}function LJ({value:t,length:e,stride:r,offset:n,startIndices:i,characterSet:l}){const c=t.BYTES_PER_ELEMENT,s=r?r/c:1,m=n?n/c:0,b=i[e]||Math.ceil((t.length-m)/s),w=l&&new Set,E=new Array(e);let O=t;if(s>1||m>0){const N=t.constructor;O=new N(b);for(let V=0;V<b;V++)O[V]=t[V*s+m]}for(let N=0;N<e;N++){const V=i[N],W=i[N+1]||b,j=O.subarray(V,W);E[N]=String.fromCodePoint.apply(null,j),w&&j.forEach(w.add,w)}if(w)for(const N of w)l.add(String.fromCodePoint(N));return{texts:E,characterCount:b}}let rF=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}};function NJ(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ey={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:NJ(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},IO=1024,RO=.9,OO=1.2,nF=3;let _w=new rF(nF);function zJ(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);const n=_w.get(t);if(!n)return r;for(const i in n.mapping)r.has(i)&&r.delete(i);return r}function BJ(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function DO(t,e,r,n){t.font=`${n} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function FJ(t){Wr.assert(Number.isFinite(t)&&t>=nF,"Invalid cache limit"),_w=new rF(t)}class jJ{constructor(){this.props={...Ey}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:r}=this.props;return(e*OO+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const r=zJ(this._key,this.props.characterSet),n=_w.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(r,n);this._atlas=i,_w.set(this._key,i)}_generateFontAtlas(e,r){const{fontFamily:n,fontWeight:i,fontSize:l,buffer:c,sdf:s,radius:m,cutoff:b}=this.props;let w=r&&r.data;w||(w=document.createElement("canvas"),w.width=IO);const E=w.getContext("2d",{willReadFrequently:!0});DO(E,n,l,i);const{mapping:O,canvasHeight:N,xOffset:V,yOffset:W}=IJ({getFontWidth:j=>E.measureText(j).width,fontHeight:l*OO,buffer:c,characterSet:e,maxCanvasWidth:IO,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(w.height!==N){const j=E.getImageData(0,0,w.width,w.height);w.height=N,E.putImageData(j,0,0)}if(DO(E,n,l,i),s){const j=new EJ({fontSize:l,buffer:c,radius:m,cutoff:b,fontFamily:n,fontWeight:`${i}`});for(const Y of e){const{data:ce,width:re,height:ue,glyphTop:me}=j.draw(Y);O[Y].width=re,O[Y].layoutOffsetY=l*RO-me;const ge=E.createImageData(re,ue);BJ(ce,ge),E.putImageData(ge,O[Y].x,O[Y].y)}}else for(const j of e)E.fillText(j,O[j].x,O[j].y+c+l*RO);return{xOffset:V,yOffset:W,mapping:O,data:w,width:w.width,height:w.height}}_getKey(){const{fontFamily:e,fontWeight:r,fontSize:n,buffer:i,sdf:l,radius:c,cutoff:s}=this.props;return l?`${e} ${r} ${n} ${i} ${c} ${s}`:`${e} ${r} ${n} ${i}`}}const kO=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,UJ={name:"textBackground",vs:kO,fs:kO,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},VJ=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,$J=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,WJ={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class VC extends Mp{getShaders(){return super.getShaders({vs:VJ,fs:$J,modules:[vb,bb,UJ]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:r,sizeScale:n,sizeUnits:i,sizeMinPixels:l,sizeMaxPixels:c,getLineWidth:s}=this.props;let{padding:m,borderRadius:b}=this.props;m.length<4&&(m=[m[0],m[1],m[0],m[1]]),Array.isArray(b)||(b=[b,b,b,b]);const w=this.state.model,E={billboard:r,stroked:!!s,borderRadius:b,padding:m,sizeUnits:ed[i],sizeScale:n,sizeMinPixels:l,sizeMaxPixels:c};w.shaderInputs.setProps({textBackground:E}),w.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Au(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ny({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}VC.defaultProps=WJ;VC.layerName="TextBackgroundLayer";const LO={start:1,middle:0,end:-1},NO={top:1,center:0,bottom:-1},PS=[0,0,0,255],HJ=1,qJ={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:PS},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ey.characterSet},fontFamily:Ey.fontFamily,fontWeight:Ey.fontWeight,lineHeight:HJ,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:PS},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:PS},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class $C extends zC{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[n,i]}=this.transformParagraph(e,r);const{fontSize:l}=this.state.fontAtlasManager.props;n/=l,i/=l;const{getTextAnchor:c,getAlignmentBaseline:s}=this.props,m=LO[typeof c=="function"?c(e,r):c],b=NO[typeof s=="function"?s(e,r):s];return[(m-1)*n/2,(b-1)*i/2,n,i]},this.getIconOffsets=(e,r)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:l,y:c,rowWidth:s,size:[m,b]}=this.transformParagraph(e,r),w=LO[typeof n=="function"?n(e,r):n],E=NO[typeof i=="function"?i(e,r):i],O=l.length,N=new Array(O*2);let V=0;for(let W=0;W<O;W++){const j=(1-w)*(m-s[W])/2;N[V++]=(w-1)*m/2+j+l[W],N[V++]=(E-1)*b/2+c[W]}return N}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new jJ},this.props.maxWidth>0&&Wr.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:r,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:l}=this.state,c={...e,characterSet:l,fontFamily:r,fontWeight:n};if(!i.mapping)return i.setProps(c),!0;for(const s in c)if(c[s]!==i.props[s])return i.setProps(c),!0;return!1}_updateText(){const{data:e,characterSet:r}=this.props,n=e.attributes?.getText;let{getText:i}=this.props,l=e.startIndices,c;const s=r==="auto"&&new Set;if(n&&l){const{texts:m,characterCount:b}=LJ({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:l,characterSet:s});c=b,i=(w,{index:E})=>m[E]}else{const{iterable:m,objectInfo:b}=TT(e);l=[0],c=0;for(const w of m){b.index++;const E=Array.from(i(w,b)||"");s&&E.forEach(s.add,s),c+=E.length,l.push(c)}}this.setState({getText:i,startIndices:l,numInstances:c,characterSet:s||r})}transformParagraph(e,r){const{fontAtlasManager:n}=this.state,i=n.mapping,l=this.state.getText,{wordBreak:c,lineHeight:s,maxWidth:m}=this.props,b=l(e,r)||"";return kJ(b,s,c,m*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:r,getText:n,fontAtlasManager:{scale:i,atlas:l,mapping:c},styleVersion:s}=this.state,{data:m,_dataDiff:b,getPosition:w,getColor:E,getSize:O,getAngle:N,getPixelOffset:V,getBackgroundColor:W,getBorderColor:j,getBorderWidth:Y,backgroundBorderRadius:ce,backgroundPadding:re,background:ue,billboard:me,fontSettings:ge,outlineWidth:Ce,outlineColor:We,sizeScale:Xe,sizeUnits:Et,sizeMinPixels:gt,sizeMaxPixels:Ye,transitions:jt,updateTriggers:St}=this.props,Zt=this.getSubLayerClass("characters",UC),fe=this.getSubLayerClass("background",VC);return[ue&&new fe({getFillColor:W,getLineColor:j,getLineWidth:Y,borderRadius:ce,padding:re,getPosition:w,getSize:O,getAngle:N,getPixelOffset:V,billboard:me,sizeScale:Xe,sizeUnits:Et,sizeMinPixels:gt,sizeMaxPixels:Ye,transitions:jt&&{getPosition:jt.getPosition,getAngle:jt.getAngle,getSize:jt.getSize,getFillColor:jt.getBackgroundColor,getLineColor:jt.getBorderColor,getLineWidth:jt.getBorderWidth,getPixelOffset:jt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:St.getPosition,getAngle:St.getAngle,getSize:St.getSize,getFillColor:St.getBackgroundColor,getLineColor:St.getBorderColor,getLineWidth:St.getBorderWidth,getPixelOffset:St.getPixelOffset,getBoundingRect:{getText:St.getText,getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:s}}}),{data:m.attributes&&m.attributes.background?{length:m.length,attributes:m.attributes.background}:m,_dataDiff:b,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Zt({sdf:ge.sdf,smoothing:Number.isFinite(ge.smoothing)?ge.smoothing:Ey.smoothing,outlineWidth:Ce/(ge.radius||Ey.radius),outlineColor:We,iconAtlas:l,iconMapping:c,getPosition:w,getColor:E,getSize:O,getAngle:N,getPixelOffset:V,billboard:me,sizeScale:Xe*i,sizeUnits:Et,sizeMinPixels:gt*i,sizeMaxPixels:Ye*i,transitions:jt&&{getPosition:jt.getPosition,getAngle:jt.getAngle,getColor:jt.getColor,getSize:jt.getSize,getPixelOffset:jt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:St.getText,getPosition:St.getPosition,getAngle:St.getAngle,getColor:St.getColor,getSize:St.getSize,getPixelOffset:St.getPixelOffset,getIconOffsets:{getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:s}}}),{data:m,_dataDiff:b,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){FJ(e)}}$C.defaultProps=qJ;$C.layerName="TextLayer";const j1={circle:{type:BC,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:AT,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:$C,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},U1={type:FC,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},XE={type:jC,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function u0({type:t,props:e}){const r={};for(const n in e)r[n]=t.defaultProps[e[n]];return r}function CS(t,e){const{transitions:r,updateTriggers:n}=t.props,i={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(const l in e){const c=e[l];let s=t.props[l];l.startsWith("get")&&(s=t.getSubLayerAccessor(s),i.updateTriggers[c]=n[l],r&&(i.transitions[c]=r[l])),i[c]=s}return i}function XJ(t){if(Array.isArray(t))return t;switch(Wr.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Wr.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function zO(t,e,r={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:l=t.length}=r;for(let c=i;c<l;c++){const s=t[c],{geometry:m}=s;if(m)if(m.type==="GeometryCollection"){Wr.assert(Array.isArray(m.geometries),"GeoJSON does not have geometries array");const{geometries:b}=m;for(let w=0;w<b.length;w++){const E=b[w];BO(E,n,e,s,c)}}else BO(m,n,e,s,c)}return n}function BO(t,e,r,n,i){const{type:l,coordinates:c}=t,{pointFeatures:s,lineFeatures:m,polygonFeatures:b,polygonOutlineFeatures:w}=e;if(!ZJ(l,c)){Wr.warn(`${l} coordinates are malformed`)();return}switch(l){case"Point":s.push(r({geometry:t},n,i));break;case"MultiPoint":c.forEach(E=>{s.push(r({geometry:{type:"Point",coordinates:E}},n,i))});break;case"LineString":m.push(r({geometry:t},n,i));break;case"MultiLineString":c.forEach(E=>{m.push(r({geometry:{type:"LineString",coordinates:E}},n,i))});break;case"Polygon":b.push(r({geometry:t},n,i)),c.forEach(E=>{w.push(r({geometry:{type:"LineString",coordinates:E}},n,i))});break;case"MultiPolygon":c.forEach(E=>{b.push(r({geometry:{type:"Polygon",coordinates:E}},n,i)),E.forEach(O=>{w.push(r({geometry:{type:"LineString",coordinates:O}},n,i))})});break}}const GJ={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function ZJ(t,e){let r=GJ[t];for(Wr.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function iF(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function l1(t){return t.geometry.coordinates}function YJ(t,e){const r=iF(),{pointFeatures:n,lineFeatures:i,polygonFeatures:l,polygonOutlineFeatures:c}=t;return r.points.data=n,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=l1,r.lines.data=i,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=l1,r.polygons.data=l,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=l1,r.polygonsOutline.data=c,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=l1,r}function KJ(t,e){const r=iF(),{points:n,lines:i,polygons:l}=t,c=wJ(t,e);r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:c.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:c.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines._pathType="open";const s=l.positions.value.length/l.positions.size,m=Array(s).fill(1);for(const b of l.primitivePolygonIndices.value)m[b-1]=0;return r.polygons.data={length:l.polygonIndices.value.length-1,startIndices:l.polygonIndices.value,attributes:{...l.attributes,getPolygon:l.positions,instanceVertexValid:{size:1,value:new Uint16Array(m)},pickingColors:{size:4,value:c.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},r.polygons._normalize=!1,l.triangles&&(r.polygons.data.attributes.indices=l.triangles.value),r.polygonsOutline.data={length:l.primitivePolygonIndices.value.length-1,startIndices:l.primitivePolygonIndices.value,attributes:{...l.attributes,getPath:l.positions,instancePickingColors:{size:4,value:c.polygons}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},r.polygonsOutline._pathType="open",r}const QJ=["points","linestrings","polygons"],JJ={...u0(j1.circle),...u0(j1.icon),...u0(j1.text),...u0(U1),...u0(XE),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class WC extends zC{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){const n=KJ(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:r}){const n=XJ(e.data),i=this.getSubLayerRow.bind(this);let l={};const c={};if(Array.isArray(r.dataChanged)){const m=this.state.features;for(const b in m)l[b]=m[b].slice(),c[b]=[];for(const b of r.dataChanged){const w=zO(n,i,b);for(const E in m)c[E].push(vJ({data:l[E],getIndex:O=>O.__source.index,dataRange:b,replace:w[E]}))}}else l=zO(n,i);const s=YJ(l,c);this.setState({features:l,featuresDiff:c,layerProps:s})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n,sourceLayer:i}=r;return r.featureType=QJ.find(l=>i.id.startsWith(`${this.id}-${l}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(e){const r=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(r)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:r}=this.props,{layerProps:n}=this.state,i="polygons-fill",l=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,XE.type);if(l){const c=CS(this,XE.props),s=e&&r;return s||delete c.getLineColor,c.updateTriggers.lineColors=s,new l(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:r}=this.props,{layerProps:n}=this.state,i="polygons-stroke",l="linestrings",c=!e&&r&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,U1.type),s=this.shouldRenderSubLayer(l,n.lines?.data)&&this.getSubLayerClass(l,U1.type);if(c||s){const m=CS(this,U1.props);return[c&&new c(m,this.getSubLayerProps({id:i,updateTriggers:m.updateTriggers}),n.polygonsOutline),s&&new s(m,this.getSubLayerProps({id:l,updateTriggers:m.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:r,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=r.points.data.findIndex(s=>s.__source.index===i));const l=new Set(e.split("+")),c=[];for(const s of l){const m=`points-${s}`,b=j1[s],w=b&&this.shouldRenderSubLayer(m,r.points?.data)&&this.getSubLayerClass(m,b.type);if(w){const E=CS(this,b.props);let O=r.points;if(s==="text"&&n){const{instancePickingColors:N,...V}=O.data.attributes;O={...O,data:{...O.data,attributes:V}}}c.push(new w(E,this.getSubLayerProps({id:m,updateTriggers:E.updateTriggers,highlightedObjectIndex:i}),O))}}return c}renderLayers(){const{extruded:e}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&r,n,i,e&&r]}getSubLayerAccessor(e){const{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:l,index:c}=i,s=bJ(l,c);return e(s,i)}}}WC.layerName="GeoJsonLayer";WC.defaultProps=JJ;const Z0="mapbox",MS=512,eee=Math.PI/180;function tee({map:t,deck:e}){if(t.__deck)return t.__deck;const r=e.props._customRender,n=e.props.onLoad,i={...e.props,_customRender:()=>{t.triggerRepaint(),r?.("")}};return i.views||(i.views=B0(t)),Object.assign(i,{width:null,height:null,touchAction:"unset",viewState:Y0(t)}),e.isInitialized?FO(e,t):i.onLoad=()=>{n?.(),FO(e,t)},e.setProps(i),t.__deck=e,t.on("render",()=>{e.isInitialized&&aee(e,t)}),e}function FO(t,e){const r=()=>{t.isInitialized?oee(t,e):e.off("move",r)};e.on("move",r)}function ree(t){t.__deck?.finalize(),t.__deck=null}function IS(t,e){const r=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return HC(t)==="globe"&&(r.cullMode="back"),r}function nee(t,e,r,n){if(!t.isInitialized)return;let{currentViewport:i}=t.userData,l=!1;i||(i=qC(t,e,n),t.userData.currentViewport=i,l=!0),t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:c=>(!t.props.layerFilter||t.props.layerFilter(c))&&(r.id===c.layer.id||c.layer.props.operation.includes("terrain")),clearStack:l,clearCanvas:!1})}function iee(t,e,r,n){if(!t.isInitialized)return;let{currentViewport:i}=t.userData,l=!1;i||(i=qC(t,e,n),t.userData.currentViewport=i,l=!0),t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:c=>{if(t.props.layerFilter&&!t.props.layerFilter(c))return!1;const s=c.layer;return s.props.beforeId===r.beforeId&&s.props.slot===r.slot},clearStack:l,clearCanvas:!1})}function HC(t){const e=t.getProjection?.(),r=e?.type||e?.name;if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function B0(t){return HC(t)==="globe"?new VB({id:Z0}):new CC({id:Z0})}function Y0(t){const{lng:e,lat:r}=t.getCenter(),n={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&see(t,n),n}function see(t,e){if(t.getFreeCameraOptions){const{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;const n=t.transform.height,{longitude:i,latitude:l,pitch:c}=e,s=r.x*MS,m=(1-r.y)*MS,b=r.z*MS,w=W0([i,l]),E=s-w[0],O=m-w[1],N=Math.sqrt(E*E+O*O),V=c*eee,W=1.5*n,j=V<.001?W*Math.cos(V)/b:W*Math.sin(V)/N;e.zoom=Math.log2(j);const Y=W*Math.cos(V)/j,ce=b-Y;e.position=[0,0,ce/L1(l)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function qC(t,e,r){const n=Y0(e),i=t.getView(Z0)||B0(e);r&&(i.props.nearZMultiplier=.2);const l=r?.nearZ??e.transform._nearZ,c=r?.farZ??e.transform._farZ;return Number.isFinite(l)&&(n.nearZ=l/e.transform.height,n.farZ=c/e.transform.height),i.makeViewport({width:t.width,height:t.height,viewState:n})}function aee(t,e){const n=Pp(t.props.layers,Boolean).some(s=>s&&!e.getLayer(s.id));let i=t.getViewports();const l=i.findIndex(s=>s.id===Z0),c=i.length>1||l<0;(n||c)&&(l>=0&&(i=i.slice(),i[l]=qC(t,e)),t._drawLayers("mapbox-repaint",{viewports:i,layerFilter:s=>(!t.props.layerFilter||t.props.layerFilter(s))&&(s.viewport.id!==Z0||!e.getLayer(s.layer.id)),clearCanvas:!1})),t.userData.currentViewport=null}function oee(t,e){t.setProps({viewState:Y0(e)}),t.needsRedraw({clearRedrawFlags:!0})}class lee{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.props=e}onAdd(e,r){this.map=e}onRemove(){this.map=null}setProps(e){Object.assign(this.props,e,{id:this.id})}render(e,r){this.map&&nee(this.map.__deck,this.map,this,r)}}const RS="__UNDEFINED__";function cee(t,e,r,n){if(!t||!e||!t.style||!t.style._loaded)return;const i=Pp(n,Boolean);if(r!==n){const s=Pp(r,Boolean),m=new Set(s.map(b=>b.id));for(const b of i)m.delete(b.id);for(const b of m)t.getLayer(b)&&t.removeLayer(b)}for(const s of i){const m=t.getLayer(s.id);m?(m.implementation||m).setProps(s.props):t.addLayer(new lee({id:s.id,slot:s.props.slot}),s.props.beforeId)}const l=t.style._order,c={};for(const s of i){let{beforeId:m}=s.props;(!m||!l.includes(m))&&(m=RS),c[m]=c[m]||[],c[m].push(s.id)}for(const s in c){const m=c[s];let b=s===RS?l.length:l.indexOf(s),w=s===RS?void 0:s;for(let E=m.length-1;E>=0;E--){const O=m[E],N=l.indexOf(O);N!==b-1&&(t.moveLayer(O,w),N>b&&b++),b--,w=O}}}class uee{constructor(e){Ui(e.id,"id is required"),this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.beforeId=e.beforeId,this.map=null}onAdd(e,r){this.map=e}render(e,r){this.map&&iee(this.map.__deck,this.map,this,r)}}const OS="__UNDEFINED__";function DS(t){return t.props.beforeId?`deck-layer-group-before:${t.props.beforeId}`:t.props.slot?`deck-layer-group-slot:${t.props.slot}`:"deck-layer-group-last"}function hee(t,e,r){if(!t||!t.style||!t.style._loaded)return;const n=Pp(r,Boolean);if(e!==r){const c=Pp(e,Boolean),s=new Set(c.map(b=>DS(b))),m=new Set(n.map(b=>DS(b)));for(const b of s)m.has(b)||t.getLayer(b)&&t.removeLayer(b)}const i={};for(const c of n){const s=DS(c),m=t.getLayer(s);if(m){const b=m.implementation||m;i[s]=b}else{const b=new uee({id:s,slot:c.props.slot,beforeId:c.props.beforeId});i[s]=b,t.addLayer(b,c.props.beforeId)}}const l=t.style._order;for(const[c,s]of Object.entries(i)){const m=s.beforeId||OS,b=m===OS?l.length:l.indexOf(m);if(l.indexOf(c)!==b-1){const E=m===OS?void 0:m;t.moveLayer(c,E)}}}class fee{constructor(e){this._handleStyleChange=()=>{if(this._resolveLayers(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;HC(this._map)&&!this._props.views&&this._deck?.setProps({views:B0(this._map)})},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:n,clientHeight:i}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${i}px`})}},this._updateViewState=()=>{const n=this._deck,i=this._map;n&&i&&(n.setProps({views:this._props.views||B0(i),viewState:Y0(i)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{const i=this._deck;if(!i||!i.isInitialized)return;const l={type:n.type,offsetCenter:n.point,srcEvent:n},c=this._lastMouseDownPoint;switch(!n.point&&c&&(l.deltaX=n.originalEvent.clientX-c.clientX,l.deltaY=n.originalEvent.clientY-c.clientY,l.offsetCenter={x:c.x+l.deltaX,y:c.y+l.deltaY}),l.type){case"mousedown":i._onPointerDown(l),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":l.type="panstart",i._onEvent(l);break;case"drag":l.type="panmove",i._onEvent(l);break;case"dragend":l.type="panend",i._onEvent(l);break;case"click":l.tapCount=1,i._onEvent(l);break;case"dblclick":l.type="click",l.tapCount=2,i._onEvent(l);break;case"mousemove":l.type="pointermove",i._onPointerMove(l);break;case"mouseout":l.type="pointerleave",i._onPointerMove(l);break;default:return}};const{interleaved:r=!1}=e;this._interleaved=r,this._renderLayersInGroups=e._renderLayersInGroups||!1,this._props=this.filterProps(e)}filterProps(e){const{interleaved:r=!1,useDevicePixels:n,...i}=e;return!r&&n!==void 0&&(i.useDevicePixels=n),i}setProps(e){this._interleaved&&e.layers&&this._resolveLayers(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...IS(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new pw({...this._props,parent:r,parameters:{...IS(e,!1),...this._props.parameters},views:this._props.views||B0(e),viewState:Y0(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){const r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&Wr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=tee({map:e,deck:new pw({...this._props,gl:r,parameters:{...IS(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,[],this._props.layers),document.createElement("div")}_resolveLayers(e,r,n,i){this._renderLayersInGroups?hee(e,n,i):cee(e,r,n,i)}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,this._props.layers,[]),ree(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Ui(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ui(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ui(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}function Sp(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function dee(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function XC(t){let e,r,n;t.length!==2?(e=Sp,r=(s,m)=>Sp(t(s),m),n=(s,m)=>t(s)-m):(e=t===Sp||t===dee?t:pee,r=t,n=t);function i(s,m,b=0,w=s.length){if(b<w){if(e(m,m)!==0)return w;do{const E=b+w>>>1;r(s[E],m)<0?b=E+1:w=E}while(b<w)}return b}function l(s,m,b=0,w=s.length){if(b<w){if(e(m,m)!==0)return w;do{const E=b+w>>>1;r(s[E],m)<=0?b=E+1:w=E}while(b<w)}return b}function c(s,m,b=0,w=s.length){const E=i(s,m,b,w-1);return E>b&&n(s[E-1],m)>-n(s[E],m)?E-1:E}return{left:i,center:c,right:l}}function pee(){return 0}function sF(t){return t===null?NaN:+t}function*gee(t,e){for(let r of t)r!=null&&(r=+r)>=r&&(yield r)}const mee=XC(Sp),wb=mee.right;XC(sF).center;class jO extends Map{constructor(e,r=vee){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(UO(this,e))}has(e){return super.has(UO(this,e))}set(e,r){return super.set(_ee(this,e),r)}delete(e){return super.delete(yee(this,e))}}function UO({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):r}function _ee({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):(t.set(n,r),r)}function yee({_intern:t,_key:e},r){const n=e(r);return t.has(n)&&(r=t.get(n),t.delete(n)),r}function vee(t){return t!==null&&typeof t=="object"?t.valueOf():t}function bee(t=Sp){if(t===Sp)return aF;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,r)=>{const n=t(e,r);return n||n===0?n:(t(r,r)===0)-(t(e,e)===0)}}function aF(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const xee=Math.sqrt(50),wee=Math.sqrt(10),Tee=Math.sqrt(2);function yw(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),l=n/Math.pow(10,i),c=l>=xee?10:l>=wee?5:l>=Tee?2:1;let s,m,b;return i<0?(b=Math.pow(10,-i)/c,s=Math.round(t*b),m=Math.round(e*b),s/b<t&&++s,m/b>e&&--m,b=-b):(b=Math.pow(10,i)*c,s=Math.round(t/b),m=Math.round(e/b),s*b<t&&++s,m*b>e&&--m),m<s&&.5<=r&&r<2?yw(t,e,r*2):[s,m,b]}function GE(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,l,c]=n?yw(e,t,r):yw(t,e,r);if(!(l>=i))return[];const s=l-i+1,m=new Array(s);if(n)if(c<0)for(let b=0;b<s;++b)m[b]=(l-b)/-c;else for(let b=0;b<s;++b)m[b]=(l-b)*c;else if(c<0)for(let b=0;b<s;++b)m[b]=(i+b)/-c;else for(let b=0;b<s;++b)m[b]=(i+b)*c;return m}function ZE(t,e,r){return e=+e,t=+t,r=+r,yw(t,e,r)[2]}function YE(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?ZE(e,t,r):ZE(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function VO(t,e){let r;for(const n of t)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function $O(t,e){let r;for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function oF(t,e,r=0,n=1/0,i){if(e=Math.floor(e),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(t.length-1,n)),!(r<=e&&e<=n))return t;for(i=i===void 0?aF:bee(i);n>r;){if(n-r>600){const m=n-r+1,b=e-r+1,w=Math.log(m),E=.5*Math.exp(2*w/3),O=.5*Math.sqrt(w*E*(m-E)/m)*(b-m/2<0?-1:1),N=Math.max(r,Math.floor(e-b*E/m+O)),V=Math.min(n,Math.floor(e+(m-b)*E/m+O));oF(t,e,N,V,i)}const l=t[e];let c=r,s=n;for(h0(t,r,e),i(t[n],l)>0&&h0(t,r,n);c<s;){for(h0(t,c,s),++c,--s;i(t[c],l)<0;)++c;for(;i(t[s],l)>0;)--s}i(t[r],l)===0?h0(t,r,s):(++s,h0(t,s,n)),s<=e&&(r=s+1),e<=s&&(n=s-1)}return t}function h0(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function See(t,e,r){if(t=Float64Array.from(gee(t)),!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return $O(t);if(e>=1)return VO(t);var n,i=(n-1)*e,l=Math.floor(i),c=VO(oF(t,l).subarray(0,l+1)),s=$O(t.subarray(l+1));return c+(s-c)*(i-l)}}function Aee(t,e,r=sF){if(!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return+r(t[0],0,t);if(e>=1)return+r(t[n-1],n-1,t);var n,i=(n-1)*e,l=Math.floor(i),c=+r(t[l],l,t),s=+r(t[l+1],l+1,t);return c+(s-c)*(i-l)}}function Eee(t,e,r){t=+t,e=+e,r=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((e-t)/r))|0,l=new Array(i);++n<i;)l[n]=t+n*r;return l}function Ec(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ld(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const KE=Symbol("implicit");function GC(){var t=new jO,e=[],r=[],n=KE;function i(l){let c=t.get(l);if(c===void 0){if(n!==KE)return n;t.set(l,c=e.push(l)-1)}return r[c%r.length]}return i.domain=function(l){if(!arguments.length)return e.slice();e=[],t=new jO;for(const c of l)t.has(c)||t.set(c,e.push(c)-1);return i},i.range=function(l){return arguments.length?(r=Array.from(l),i):r.slice()},i.unknown=function(l){return arguments.length?(n=l,i):n},i.copy=function(){return GC(e,r).unknown(n)},Ec.apply(i,arguments),i}function ZC(){var t=GC().unknown(void 0),e=t.domain,r=t.range,n=0,i=1,l,c,s=!1,m=0,b=0,w=.5;delete t.unknown;function E(){var O=e().length,N=i<n,V=N?i:n,W=N?n:i;l=(W-V)/Math.max(1,O-m+b*2),s&&(l=Math.floor(l)),V+=(W-V-l*(O-m))*w,c=l*(1-m),s&&(V=Math.round(V),c=Math.round(c));var j=Eee(O).map(function(Y){return V+l*Y});return r(N?j.reverse():j)}return t.domain=function(O){return arguments.length?(e(O),E()):e()},t.range=function(O){return arguments.length?([n,i]=O,n=+n,i=+i,E()):[n,i]},t.rangeRound=function(O){return[n,i]=O,n=+n,i=+i,s=!0,E()},t.bandwidth=function(){return c},t.step=function(){return l},t.round=function(O){return arguments.length?(s=!!O,E()):s},t.padding=function(O){return arguments.length?(m=Math.min(1,b=+O),E()):m},t.paddingInner=function(O){return arguments.length?(m=Math.min(1,O),E()):m},t.paddingOuter=function(O){return arguments.length?(b=+O,E()):b},t.align=function(O){return arguments.length?(w=Math.max(0,Math.min(1,O)),E()):w},t.copy=function(){return ZC(e(),[n,i]).round(s).paddingInner(m).paddingOuter(b).align(w)},Ec.apply(E(),arguments)}function lF(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return lF(e())},t}function Pee(){return lF(ZC.apply(null,arguments).paddingInner(1))}function YC(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function cF(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function Tb(){}var K0=.7,vw=1/K0,Py="\\s*([+-]?\\d+)\\s*",Q0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",kh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Cee=/^#([0-9a-f]{3,8})$/,Mee=new RegExp(`^rgb\\(${Py},${Py},${Py}\\)$`),Iee=new RegExp(`^rgb\\(${kh},${kh},${kh}\\)$`),Ree=new RegExp(`^rgba\\(${Py},${Py},${Py},${Q0}\\)$`),Oee=new RegExp(`^rgba\\(${kh},${kh},${kh},${Q0}\\)$`),Dee=new RegExp(`^hsl\\(${Q0},${kh},${kh}\\)$`),kee=new RegExp(`^hsla\\(${Q0},${kh},${kh},${Q0}\\)$`),WO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};YC(Tb,J0,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:HO,formatHex:HO,formatHex8:Lee,formatHsl:Nee,formatRgb:qO,toString:qO});function HO(){return this.rgb().formatHex()}function Lee(){return this.rgb().formatHex8()}function Nee(){return uF(this).formatHsl()}function qO(){return this.rgb().formatRgb()}function J0(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Cee.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?XO(e):r===3?new qo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?c1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?c1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Mee.exec(t))?new qo(e[1],e[2],e[3],1):(e=Iee.exec(t))?new qo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ree.exec(t))?c1(e[1],e[2],e[3],e[4]):(e=Oee.exec(t))?c1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Dee.exec(t))?YO(e[1],e[2]/100,e[3]/100,1):(e=kee.exec(t))?YO(e[1],e[2]/100,e[3]/100,e[4]):WO.hasOwnProperty(t)?XO(WO[t]):t==="transparent"?new qo(NaN,NaN,NaN,0):null}function XO(t){return new qo(t>>16&255,t>>8&255,t&255,1)}function c1(t,e,r,n){return n<=0&&(t=e=r=NaN),new qo(t,e,r,n)}function zee(t){return t instanceof Tb||(t=J0(t)),t?(t=t.rgb(),new qo(t.r,t.g,t.b,t.opacity)):new qo}function bw(t,e,r,n){return arguments.length===1?zee(t):new qo(t,e,r,n??1)}function qo(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}YC(qo,bw,cF(Tb,{brighter(t){return t=t==null?vw:Math.pow(vw,t),new qo(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?K0:Math.pow(K0,t),new qo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new qo(om(this.r),om(this.g),om(this.b),xw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:GO,formatHex:GO,formatHex8:Bee,formatRgb:ZO,toString:ZO}));function GO(){return`#${Qg(this.r)}${Qg(this.g)}${Qg(this.b)}`}function Bee(){return`#${Qg(this.r)}${Qg(this.g)}${Qg(this.b)}${Qg((isNaN(this.opacity)?1:this.opacity)*255)}`}function ZO(){const t=xw(this.opacity);return`${t===1?"rgb(":"rgba("}${om(this.r)}, ${om(this.g)}, ${om(this.b)}${t===1?")":`, ${t})`}`}function xw(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function om(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Qg(t){return t=om(t),(t<16?"0":"")+t.toString(16)}function YO(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new bu(t,e,r,n)}function uF(t){if(t instanceof bu)return new bu(t.h,t.s,t.l,t.opacity);if(t instanceof Tb||(t=J0(t)),!t)return new bu;if(t instanceof bu)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),l=Math.max(e,r,n),c=NaN,s=l-i,m=(l+i)/2;return s?(e===l?c=(r-n)/s+(r<n)*6:r===l?c=(n-e)/s+2:c=(e-r)/s+4,s/=m<.5?l+i:2-l-i,c*=60):s=m>0&&m<1?0:c,new bu(c,s,m,t.opacity)}function Fee(t,e,r,n){return arguments.length===1?uF(t):new bu(t,e,r,n??1)}function bu(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}YC(bu,Fee,cF(Tb,{brighter(t){return t=t==null?vw:Math.pow(vw,t),new bu(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?K0:Math.pow(K0,t),new bu(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new qo(kS(t>=240?t-240:t+120,i,n),kS(t,i,n),kS(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new bu(KO(this.h),u1(this.s),u1(this.l),xw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=xw(this.opacity);return`${t===1?"hsl(":"hsla("}${KO(this.h)}, ${u1(this.s)*100}%, ${u1(this.l)*100}%${t===1?")":`, ${t})`}`}}));function KO(t){return t=(t||0)%360,t<0?t+360:t}function u1(t){return Math.max(0,Math.min(1,t||0))}function kS(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}function jee(t,e,r,n,i){var l=t*t,c=l*t;return((1-3*t+3*l-c)*e+(4-6*l+3*c)*r+(1+3*t+3*l-3*c)*n+c*i)/6}function Uee(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),i=t[n],l=t[n+1],c=n>0?t[n-1]:2*i-l,s=n<e-1?t[n+2]:2*l-i;return jee((r-n/e)*e,c,i,l,s)}}const KC=t=>()=>t;function Vee(t,e){return function(r){return t+r*e}}function $ee(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Wee(t){return(t=+t)==1?hF:function(e,r){return r-e?$ee(e,r,t):KC(isNaN(e)?r:e)}}function hF(t,e){var r=e-t;return r?Vee(t,r):KC(isNaN(t)?e:t)}const QO=(function t(e){var r=Wee(e);function n(i,l){var c=r((i=bw(i)).r,(l=bw(l)).r),s=r(i.g,l.g),m=r(i.b,l.b),b=hF(i.opacity,l.opacity);return function(w){return i.r=c(w),i.g=s(w),i.b=m(w),i.opacity=b(w),i+""}}return n.gamma=t,n})(1);function Hee(t){return function(e){var r=e.length,n=new Array(r),i=new Array(r),l=new Array(r),c,s;for(c=0;c<r;++c)s=bw(e[c]),n[c]=s.r||0,i[c]=s.g||0,l[c]=s.b||0;return n=t(n),i=t(i),l=t(l),s.opacity=1,function(m){return s.r=n(m),s.g=i(m),s.b=l(m),s+""}}}var qee=Hee(Uee);function Xee(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(l){for(i=0;i<r;++i)n[i]=t[i]*(1-l)+e[i]*l;return n}}function Gee(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zee(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),l=new Array(r),c;for(c=0;c<n;++c)i[c]=Zy(t[c],e[c]);for(;c<r;++c)l[c]=e[c];return function(s){for(c=0;c<n;++c)l[c]=i[c](s);return l}}function Yee(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function ww(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function Kee(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=Zy(t[i],e[i]):n[i]=e[i];return function(l){for(i in r)n[i]=r[i](l);return n}}var QE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,LS=new RegExp(QE.source,"g");function Qee(t){return function(){return t}}function Jee(t){return function(e){return t(e)+""}}function ete(t,e){var r=QE.lastIndex=LS.lastIndex=0,n,i,l,c=-1,s=[],m=[];for(t=t+"",e=e+"";(n=QE.exec(t))&&(i=LS.exec(e));)(l=i.index)>r&&(l=e.slice(r,l),s[c]?s[c]+=l:s[++c]=l),(n=n[0])===(i=i[0])?s[c]?s[c]+=i:s[++c]=i:(s[++c]=null,m.push({i:c,x:ww(n,i)})),r=LS.lastIndex;return r<e.length&&(l=e.slice(r),s[c]?s[c]+=l:s[++c]=l),s.length<2?m[0]?Jee(m[0].x):Qee(e):(e=m.length,function(b){for(var w=0,E;w<e;++w)s[(E=m[w]).i]=E.x(b);return s.join("")})}function Zy(t,e){var r=typeof e,n;return e==null||r==="boolean"?KC(e):(r==="number"?ww:r==="string"?(n=J0(e))?(e=n,QO):ete:e instanceof J0?QO:e instanceof Date?Yee:Gee(e)?Xee:Array.isArray(e)?Zee:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Kee:ww)(t,e)}function QC(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function tte(t,e){e===void 0&&(e=t,t=Zy);for(var r=0,n=e.length-1,i=e[0],l=new Array(n<0?0:n);r<n;)l[r]=t(i,i=e[++r]);return function(c){var s=Math.max(0,Math.min(n-1,Math.floor(c*=n)));return l[s](c-s)}}function rte(t){return function(){return t}}function Tw(t){return+t}var JO=[0,1];function go(t){return t}function JE(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:rte(isNaN(e)?NaN:.5)}function nte(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function ite(t,e,r){var n=t[0],i=t[1],l=e[0],c=e[1];return i<n?(n=JE(i,n),l=r(c,l)):(n=JE(n,i),l=r(l,c)),function(s){return l(n(s))}}function ste(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),l=new Array(n),c=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++c<n;)i[c]=JE(t[c],t[c+1]),l[c]=r(e[c],e[c+1]);return function(s){var m=wb(t,s,1,n)-1;return l[m](i[m](s))}}function Sb(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ET(){var t=JO,e=JO,r=Zy,n,i,l,c=go,s,m,b;function w(){var O=Math.min(t.length,e.length);return c!==go&&(c=nte(t[0],t[O-1])),s=O>2?ste:ite,m=b=null,E}function E(O){return O==null||isNaN(O=+O)?l:(m||(m=s(t.map(n),e,r)))(n(c(O)))}return E.invert=function(O){return c(i((b||(b=s(e,t.map(n),ww)))(O)))},E.domain=function(O){return arguments.length?(t=Array.from(O,Tw),w()):t.slice()},E.range=function(O){return arguments.length?(e=Array.from(O),w()):e.slice()},E.rangeRound=function(O){return e=Array.from(O),r=QC,w()},E.clamp=function(O){return arguments.length?(c=O?!0:go,w()):c!==go},E.interpolate=function(O){return arguments.length?(r=O,w()):r},E.unknown=function(O){return arguments.length?(l=O,E):l},function(O,N){return n=O,i=N,w()}}function JC(){return ET()(go,go)}function ate(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Sw(t,e){if(!isFinite(t)||t===0)return null;var r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"),n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function By(t){return t=Sw(Math.abs(t)),t?t[1]:NaN}function ote(t,e){return function(r,n){for(var i=r.length,l=[],c=0,s=t[0],m=0;i>0&&s>0&&(m+s+1>n&&(s=Math.max(1,n-m)),l.push(r.substring(i-=s,i+s)),!((m+=s+1)>n));)s=t[c=(c+1)%t.length];return l.reverse().join(e)}}function lte(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var cte=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function eb(t){if(!(e=cte.exec(t)))throw new Error("invalid format: "+t);var e;return new e3({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}eb.prototype=e3.prototype;function e3(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}e3.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ute(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var Aw;function hte(t,e){var r=Sw(t,e);if(!r)return Aw=void 0,t.toPrecision(e);var n=r[0],i=r[1],l=i-(Aw=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,c=n.length;return l===c?n:l>c?n+new Array(l-c+1).join("0"):l>0?n.slice(0,l)+"."+n.slice(l):"0."+new Array(1-l).join("0")+Sw(t,Math.max(0,e+l-1))[0]}function eD(t,e){var r=Sw(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const tD={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:ate,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>eD(t*100,e),r:eD,s:hte,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function rD(t){return t}var nD=Array.prototype.map,iD=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function fte(t){var e=t.grouping===void 0||t.thousands===void 0?rD:ote(nD.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",l=t.numerals===void 0?rD:lte(nD.call(t.numerals,String)),c=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",m=t.nan===void 0?"NaN":t.nan+"";function b(E,O){E=eb(E);var N=E.fill,V=E.align,W=E.sign,j=E.symbol,Y=E.zero,ce=E.width,re=E.comma,ue=E.precision,me=E.trim,ge=E.type;ge==="n"?(re=!0,ge="g"):tD[ge]||(ue===void 0&&(ue=12),me=!0,ge="g"),(Y||N==="0"&&V==="=")&&(Y=!0,N="0",V="=");var Ce=(O&&O.prefix!==void 0?O.prefix:"")+(j==="$"?r:j==="#"&&/[boxX]/.test(ge)?"0"+ge.toLowerCase():""),We=(j==="$"?n:/[%p]/.test(ge)?c:"")+(O&&O.suffix!==void 0?O.suffix:""),Xe=tD[ge],Et=/[defgprs%]/.test(ge);ue=ue===void 0?6:/[gprs]/.test(ge)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function gt(Ye){var jt=Ce,St=We,Zt,fe,Me;if(ge==="c")St=Xe(Ye)+St,Ye="";else{Ye=+Ye;var Ee=Ye<0||1/Ye<0;if(Ye=isNaN(Ye)?m:Xe(Math.abs(Ye),ue),me&&(Ye=ute(Ye)),Ee&&+Ye==0&&W!=="+"&&(Ee=!1),jt=(Ee?W==="("?W:s:W==="-"||W==="("?"":W)+jt,St=(ge==="s"&&!isNaN(Ye)&&Aw!==void 0?iD[8+Aw/3]:"")+St+(Ee&&W==="("?")":""),Et){for(Zt=-1,fe=Ye.length;++Zt<fe;)if(Me=Ye.charCodeAt(Zt),48>Me||Me>57){St=(Me===46?i+Ye.slice(Zt+1):Ye.slice(Zt))+St,Ye=Ye.slice(0,Zt);break}}}re&&!Y&&(Ye=e(Ye,1/0));var Ue=jt.length+Ye.length+St.length,st=Ue<ce?new Array(ce-Ue+1).join(N):"";switch(re&&Y&&(Ye=e(st+Ye,st.length?ce-St.length:1/0),st=""),V){case"<":Ye=jt+Ye+St+st;break;case"=":Ye=jt+st+Ye+St;break;case"^":Ye=st.slice(0,Ue=st.length>>1)+jt+Ye+St+st.slice(Ue);break;default:Ye=st+jt+Ye+St;break}return l(Ye)}return gt.toString=function(){return E+""},gt}function w(E,O){var N=Math.max(-8,Math.min(8,Math.floor(By(O)/3)))*3,V=Math.pow(10,-N),W=b((E=eb(E),E.type="f",E),{suffix:iD[8+N/3]});return function(j){return W(V*j)}}return{format:b,formatPrefix:w}}var h1,t3,fF;dte({thousands:",",grouping:[3],currency:["$",""]});function dte(t){return h1=fte(t),t3=h1.format,fF=h1.formatPrefix,h1}function pte(t){return Math.max(0,-By(Math.abs(t)))}function gte(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(By(e)/3)))*3-By(Math.abs(t)))}function mte(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,By(e)-By(t))+1}function dF(t,e,r,n){var i=YE(t,e,r),l;switch(n=eb(n??",f"),n.type){case"s":{var c=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(l=gte(i,c))&&(n.precision=l),fF(n,c)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(l=mte(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=l-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(l=pte(i))&&(n.precision=l-(n.type==="%")*2);break}}return t3(n)}function Ip(t){var e=t.domain;return t.ticks=function(r){var n=e();return GE(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return dF(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,l=n.length-1,c=n[i],s=n[l],m,b,w=10;for(s<c&&(b=c,c=s,s=b,b=i,i=l,l=b);w-- >0;){if(b=ZE(c,s,r),b===m)return n[i]=c,n[l]=s,e(n);if(b>0)c=Math.floor(c/b)*b,s=Math.ceil(s/b)*b;else if(b<0)c=Math.ceil(c*b)/b,s=Math.floor(s*b)/b;else break;m=b}return t},t}function pF(){var t=JC();return t.copy=function(){return Sb(t,pF())},Ec.apply(t,arguments),Ip(t)}function gF(t){var e;function r(n){return n==null||isNaN(n=+n)?e:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(t=Array.from(n,Tw),r):t.slice()},r.unknown=function(n){return arguments.length?(e=n,r):e},r.copy=function(){return gF(t).unknown(e)},t=arguments.length?Array.from(t,Tw):[0,1],Ip(r)}function mF(t,e){t=t.slice();var r=0,n=t.length-1,i=t[r],l=t[n],c;return l<i&&(c=r,r=n,n=c,c=i,i=l,l=c),t[r]=e.floor(i),t[n]=e.ceil(l),t}function sD(t){return Math.log(t)}function aD(t){return Math.exp(t)}function _te(t){return-Math.log(-t)}function yte(t){return-Math.exp(-t)}function vte(t){return isFinite(t)?+("1e"+t):t<0?0:t}function bte(t){return t===10?vte:t===Math.E?Math.exp:e=>Math.pow(t,e)}function xte(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function oD(t){return(e,r)=>-t(-e,r)}function r3(t){const e=t(sD,aD),r=e.domain;let n=10,i,l;function c(){return i=xte(n),l=bte(n),r()[0]<0?(i=oD(i),l=oD(l),t(_te,yte)):t(sD,aD),e}return e.base=function(s){return arguments.length?(n=+s,c()):n},e.domain=function(s){return arguments.length?(r(s),c()):r()},e.ticks=s=>{const m=r();let b=m[0],w=m[m.length-1];const E=w<b;E&&([b,w]=[w,b]);let O=i(b),N=i(w),V,W;const j=s==null?10:+s;let Y=[];if(!(n%1)&&N-O<j){if(O=Math.floor(O),N=Math.ceil(N),b>0){for(;O<=N;++O)for(V=1;V<n;++V)if(W=O<0?V/l(-O):V*l(O),!(W<b)){if(W>w)break;Y.push(W)}}else for(;O<=N;++O)for(V=n-1;V>=1;--V)if(W=O>0?V/l(-O):V*l(O),!(W<b)){if(W>w)break;Y.push(W)}Y.length*2<j&&(Y=GE(b,w,j))}else Y=GE(O,N,Math.min(N-O,j)).map(l);return E?Y.reverse():Y},e.tickFormat=(s,m)=>{if(s==null&&(s=10),m==null&&(m=n===10?"s":","),typeof m!="function"&&(!(n%1)&&(m=eb(m)).precision==null&&(m.trim=!0),m=t3(m)),s===1/0)return m;const b=Math.max(1,n*s/e.ticks().length);return w=>{let E=w/l(Math.round(i(w)));return E*n<n-.5&&(E*=n),E<=b?m(w):""}},e.nice=()=>r(mF(r(),{floor:s=>l(Math.floor(i(s))),ceil:s=>l(Math.ceil(i(s)))})),e}function _F(){const t=r3(ET()).domain([1,10]);return t.copy=()=>Sb(t,_F()).base(t.base()),Ec.apply(t,arguments),t}function lD(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function cD(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function n3(t){var e=1,r=t(lD(e),cD(e));return r.constant=function(n){return arguments.length?t(lD(e=+n),cD(e)):e},Ip(r)}function yF(){var t=n3(ET());return t.copy=function(){return Sb(t,yF()).constant(t.constant())},Ec.apply(t,arguments)}function uD(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function wte(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Tte(t){return t<0?-t*t:t*t}function i3(t){var e=t(go,go),r=1;function n(){return r===1?t(go,go):r===.5?t(wte,Tte):t(uD(r),uD(1/r))}return e.exponent=function(i){return arguments.length?(r=+i,n()):r},Ip(e)}function s3(){var t=i3(ET());return t.copy=function(){return Sb(t,s3()).exponent(t.exponent())},Ec.apply(t,arguments),t}function Ste(){return s3.apply(null,arguments).exponent(.5)}function hD(t){return Math.sign(t)*t*t}function Ate(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function vF(){var t=JC(),e=[0,1],r=!1,n;function i(l){var c=Ate(t(l));return isNaN(c)?n:r?Math.round(c):c}return i.invert=function(l){return t.invert(hD(l))},i.domain=function(l){return arguments.length?(t.domain(l),i):t.domain()},i.range=function(l){return arguments.length?(t.range((e=Array.from(l,Tw)).map(hD)),i):e.slice()},i.rangeRound=function(l){return i.range(l).round(!0)},i.round=function(l){return arguments.length?(r=!!l,i):r},i.clamp=function(l){return arguments.length?(t.clamp(l),i):t.clamp()},i.unknown=function(l){return arguments.length?(n=l,i):n},i.copy=function(){return vF(t.domain(),e).round(r).clamp(t.clamp()).unknown(n)},Ec.apply(i,arguments),Ip(i)}function bF(){var t=[],e=[],r=[],n;function i(){var c=0,s=Math.max(1,e.length);for(r=new Array(s-1);++c<s;)r[c-1]=Aee(t,c/s);return l}function l(c){return c==null||isNaN(c=+c)?n:e[wb(r,c)]}return l.invertExtent=function(c){var s=e.indexOf(c);return s<0?[NaN,NaN]:[s>0?r[s-1]:t[0],s<r.length?r[s]:t[t.length-1]]},l.domain=function(c){if(!arguments.length)return t.slice();t=[];for(let s of c)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(Sp),i()},l.range=function(c){return arguments.length?(e=Array.from(c),i()):e.slice()},l.unknown=function(c){return arguments.length?(n=c,l):n},l.quantiles=function(){return r.slice()},l.copy=function(){return bF().domain(t).range(e).unknown(n)},Ec.apply(l,arguments)}function xF(){var t=0,e=1,r=1,n=[.5],i=[0,1],l;function c(m){return m!=null&&m<=m?i[wb(n,m,0,r)]:l}function s(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*e-(m-r)*t)/(r+1);return c}return c.domain=function(m){return arguments.length?([t,e]=m,t=+t,e=+e,s()):[t,e]},c.range=function(m){return arguments.length?(r=(i=Array.from(m)).length-1,s()):i.slice()},c.invertExtent=function(m){var b=i.indexOf(m);return b<0?[NaN,NaN]:b<1?[t,n[0]]:b>=r?[n[r-1],e]:[n[b-1],n[b]]},c.unknown=function(m){return arguments.length&&(l=m),c},c.thresholds=function(){return n.slice()},c.copy=function(){return xF().domain([t,e]).range(i).unknown(l)},Ec.apply(Ip(c),arguments)}function wF(){var t=[.5],e=[0,1],r,n=1;function i(l){return l!=null&&l<=l?e[wb(t,l,0,n)]:r}return i.domain=function(l){return arguments.length?(t=Array.from(l),n=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(l){return arguments.length?(e=Array.from(l),n=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(l){var c=e.indexOf(l);return[t[c-1],t[c]]},i.unknown=function(l){return arguments.length?(r=l,i):r},i.copy=function(){return wF().domain(t).range(e).unknown(r)},Ec.apply(i,arguments)}const NS=new Date,zS=new Date;function bs(t,e,r,n){function i(l){return t(l=arguments.length===0?new Date:new Date(+l)),l}return i.floor=l=>(t(l=new Date(+l)),l),i.ceil=l=>(t(l=new Date(l-1)),e(l,1),t(l),l),i.round=l=>{const c=i(l),s=i.ceil(l);return l-c<s-l?c:s},i.offset=(l,c)=>(e(l=new Date(+l),c==null?1:Math.floor(c)),l),i.range=(l,c,s)=>{const m=[];if(l=i.ceil(l),s=s==null?1:Math.floor(s),!(l<c)||!(s>0))return m;let b;do m.push(b=new Date(+l)),e(l,s),t(l);while(b<l&&l<c);return m},i.filter=l=>bs(c=>{if(c>=c)for(;t(c),!l(c);)c.setTime(c-1)},(c,s)=>{if(c>=c)if(s<0)for(;++s<=0;)for(;e(c,-1),!l(c););else for(;--s>=0;)for(;e(c,1),!l(c););}),r&&(i.count=(l,c)=>(NS.setTime(+l),zS.setTime(+c),t(NS),t(zS),Math.floor(r(NS,zS))),i.every=l=>(l=Math.floor(l),!isFinite(l)||!(l>0)?null:l>1?i.filter(n?c=>n(c)%l===0:c=>i.count(0,c)%l===0):i)),i}const Ew=bs(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Ew.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?bs(e=>{e.setTime(Math.floor(e/t)*t)},(e,r)=>{e.setTime(+e+r*t)},(e,r)=>(r-e)/t):Ew);Ew.range;const Yf=1e3,gc=Yf*60,Kf=gc*60,rd=Kf*24,a3=rd*7,fD=rd*30,BS=rd*365,Jg=bs(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Yf)},(t,e)=>(e-t)/Yf,t=>t.getUTCSeconds());Jg.range;const o3=bs(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Yf)},(t,e)=>{t.setTime(+t+e*gc)},(t,e)=>(e-t)/gc,t=>t.getMinutes());o3.range;const l3=bs(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*gc)},(t,e)=>(e-t)/gc,t=>t.getUTCMinutes());l3.range;const c3=bs(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Yf-t.getMinutes()*gc)},(t,e)=>{t.setTime(+t+e*Kf)},(t,e)=>(e-t)/Kf,t=>t.getHours());c3.range;const u3=bs(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*Kf)},(t,e)=>(e-t)/Kf,t=>t.getUTCHours());u3.range;const Ab=bs(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*gc)/rd,t=>t.getDate()-1);Ab.range;const PT=bs(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/rd,t=>t.getUTCDate()-1);PT.range;const TF=bs(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/rd,t=>Math.floor(t/rd));TF.range;function Pm(t){return bs(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,r)=>{e.setDate(e.getDate()+r*7)},(e,r)=>(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*gc)/a3)}const CT=Pm(0),Pw=Pm(1),Ete=Pm(2),Pte=Pm(3),Fy=Pm(4),Cte=Pm(5),Mte=Pm(6);CT.range;Pw.range;Ete.range;Pte.range;Fy.range;Cte.range;Mte.range;function Cm(t){return bs(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCDate(e.getUTCDate()+r*7)},(e,r)=>(r-e)/a3)}const MT=Cm(0),Cw=Cm(1),Ite=Cm(2),Rte=Cm(3),jy=Cm(4),Ote=Cm(5),Dte=Cm(6);MT.range;Cw.range;Ite.range;Rte.range;jy.range;Ote.range;Dte.range;const h3=bs(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());h3.range;const f3=bs(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());f3.range;const nd=bs(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());nd.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:bs(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,r)=>{e.setFullYear(e.getFullYear()+r*t)});nd.range;const id=bs(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());id.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:bs(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCFullYear(e.getUTCFullYear()+r*t)});id.range;function SF(t,e,r,n,i,l){const c=[[Jg,1,Yf],[Jg,5,5*Yf],[Jg,15,15*Yf],[Jg,30,30*Yf],[l,1,gc],[l,5,5*gc],[l,15,15*gc],[l,30,30*gc],[i,1,Kf],[i,3,3*Kf],[i,6,6*Kf],[i,12,12*Kf],[n,1,rd],[n,2,2*rd],[r,1,a3],[e,1,fD],[e,3,3*fD],[t,1,BS]];function s(b,w,E){const O=w<b;O&&([b,w]=[w,b]);const N=E&&typeof E.range=="function"?E:m(b,w,E),V=N?N.range(b,+w+1):[];return O?V.reverse():V}function m(b,w,E){const O=Math.abs(w-b)/E,N=XC(([,,j])=>j).right(c,O);if(N===c.length)return t.every(YE(b/BS,w/BS,E));if(N===0)return Ew.every(Math.max(YE(b,w,E),1));const[V,W]=c[O/c[N-1][2]<c[N][2]/O?N-1:N];return V.every(W)}return[s,m]}const[kte,Lte]=SF(id,f3,MT,TF,u3,l3),[Nte,zte]=SF(nd,h3,CT,Ab,c3,o3);function FS(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function jS(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function f0(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function Bte(t){var e=t.dateTime,r=t.date,n=t.time,i=t.periods,l=t.days,c=t.shortDays,s=t.months,m=t.shortMonths,b=d0(i),w=p0(i),E=d0(l),O=p0(l),N=d0(c),V=p0(c),W=d0(s),j=p0(s),Y=d0(m),ce=p0(m),re={a:Me,A:Ee,b:Ue,B:st,c:null,d:yD,e:yD,f:ore,g:_re,G:vre,H:ire,I:sre,j:are,L:AF,m:lre,M:cre,p:ye,q:Be,Q:xD,s:wD,S:ure,u:hre,U:fre,V:dre,w:pre,W:gre,x:null,X:null,y:mre,Y:yre,Z:bre,"%":bD},ue={a:lt,A:Tt,b:zt,B:Xt,c:null,d:vD,e:vD,f:Sre,g:kre,G:Nre,H:xre,I:wre,j:Tre,L:PF,m:Are,M:Ere,p:Wt,q:nr,Q:xD,s:wD,S:Pre,u:Cre,U:Mre,V:Ire,w:Rre,W:Ore,x:null,X:null,y:Dre,Y:Lre,Z:zre,"%":bD},me={a:Et,A:gt,b:Ye,B:jt,c:St,d:mD,e:mD,f:ere,g:gD,G:pD,H:_D,I:_D,j:Yte,L:Jte,m:Zte,M:Kte,p:Xe,q:Gte,Q:rre,s:nre,S:Qte,u:$te,U:Wte,V:Hte,w:Vte,W:qte,x:Zt,X:fe,y:gD,Y:pD,Z:Xte,"%":tre};re.x=ge(r,re),re.X=ge(n,re),re.c=ge(e,re),ue.x=ge(r,ue),ue.X=ge(n,ue),ue.c=ge(e,ue);function ge(_t,Yt){return function(Tr){var Rt=[],$n=-1,_r=0,sr=_t.length,ur,Yr,qs;for(Tr instanceof Date||(Tr=new Date(+Tr));++$n<sr;)_t.charCodeAt($n)===37&&(Rt.push(_t.slice(_r,$n)),(Yr=dD[ur=_t.charAt(++$n)])!=null?ur=_t.charAt(++$n):Yr=ur==="e"?" ":"0",(qs=Yt[ur])&&(ur=qs(Tr,Yr)),Rt.push(ur),_r=$n+1);return Rt.push(_t.slice(_r,$n)),Rt.join("")}}function Ce(_t,Yt){return function(Tr){var Rt=f0(1900,void 0,1),$n=We(Rt,_t,Tr+="",0),_r,sr;if($n!=Tr.length)return null;if("Q"in Rt)return new Date(Rt.Q);if("s"in Rt)return new Date(Rt.s*1e3+("L"in Rt?Rt.L:0));if(Yt&&!("Z"in Rt)&&(Rt.Z=0),"p"in Rt&&(Rt.H=Rt.H%12+Rt.p*12),Rt.m===void 0&&(Rt.m="q"in Rt?Rt.q:0),"V"in Rt){if(Rt.V<1||Rt.V>53)return null;"w"in Rt||(Rt.w=1),"Z"in Rt?(_r=jS(f0(Rt.y,0,1)),sr=_r.getUTCDay(),_r=sr>4||sr===0?Cw.ceil(_r):Cw(_r),_r=PT.offset(_r,(Rt.V-1)*7),Rt.y=_r.getUTCFullYear(),Rt.m=_r.getUTCMonth(),Rt.d=_r.getUTCDate()+(Rt.w+6)%7):(_r=FS(f0(Rt.y,0,1)),sr=_r.getDay(),_r=sr>4||sr===0?Pw.ceil(_r):Pw(_r),_r=Ab.offset(_r,(Rt.V-1)*7),Rt.y=_r.getFullYear(),Rt.m=_r.getMonth(),Rt.d=_r.getDate()+(Rt.w+6)%7)}else("W"in Rt||"U"in Rt)&&("w"in Rt||(Rt.w="u"in Rt?Rt.u%7:"W"in Rt?1:0),sr="Z"in Rt?jS(f0(Rt.y,0,1)).getUTCDay():FS(f0(Rt.y,0,1)).getDay(),Rt.m=0,Rt.d="W"in Rt?(Rt.w+6)%7+Rt.W*7-(sr+5)%7:Rt.w+Rt.U*7-(sr+6)%7);return"Z"in Rt?(Rt.H+=Rt.Z/100|0,Rt.M+=Rt.Z%100,jS(Rt)):FS(Rt)}}function We(_t,Yt,Tr,Rt){for(var $n=0,_r=Yt.length,sr=Tr.length,ur,Yr;$n<_r;){if(Rt>=sr)return-1;if(ur=Yt.charCodeAt($n++),ur===37){if(ur=Yt.charAt($n++),Yr=me[ur in dD?Yt.charAt($n++):ur],!Yr||(Rt=Yr(_t,Tr,Rt))<0)return-1}else if(ur!=Tr.charCodeAt(Rt++))return-1}return Rt}function Xe(_t,Yt,Tr){var Rt=b.exec(Yt.slice(Tr));return Rt?(_t.p=w.get(Rt[0].toLowerCase()),Tr+Rt[0].length):-1}function Et(_t,Yt,Tr){var Rt=N.exec(Yt.slice(Tr));return Rt?(_t.w=V.get(Rt[0].toLowerCase()),Tr+Rt[0].length):-1}function gt(_t,Yt,Tr){var Rt=E.exec(Yt.slice(Tr));return Rt?(_t.w=O.get(Rt[0].toLowerCase()),Tr+Rt[0].length):-1}function Ye(_t,Yt,Tr){var Rt=Y.exec(Yt.slice(Tr));return Rt?(_t.m=ce.get(Rt[0].toLowerCase()),Tr+Rt[0].length):-1}function jt(_t,Yt,Tr){var Rt=W.exec(Yt.slice(Tr));return Rt?(_t.m=j.get(Rt[0].toLowerCase()),Tr+Rt[0].length):-1}function St(_t,Yt,Tr){return We(_t,e,Yt,Tr)}function Zt(_t,Yt,Tr){return We(_t,r,Yt,Tr)}function fe(_t,Yt,Tr){return We(_t,n,Yt,Tr)}function Me(_t){return c[_t.getDay()]}function Ee(_t){return l[_t.getDay()]}function Ue(_t){return m[_t.getMonth()]}function st(_t){return s[_t.getMonth()]}function ye(_t){return i[+(_t.getHours()>=12)]}function Be(_t){return 1+~~(_t.getMonth()/3)}function lt(_t){return c[_t.getUTCDay()]}function Tt(_t){return l[_t.getUTCDay()]}function zt(_t){return m[_t.getUTCMonth()]}function Xt(_t){return s[_t.getUTCMonth()]}function Wt(_t){return i[+(_t.getUTCHours()>=12)]}function nr(_t){return 1+~~(_t.getUTCMonth()/3)}return{format:function(_t){var Yt=ge(_t+="",re);return Yt.toString=function(){return _t},Yt},parse:function(_t){var Yt=Ce(_t+="",!1);return Yt.toString=function(){return _t},Yt},utcFormat:function(_t){var Yt=ge(_t+="",ue);return Yt.toString=function(){return _t},Yt},utcParse:function(_t){var Yt=Ce(_t+="",!0);return Yt.toString=function(){return _t},Yt}}}var dD={"-":"",_:" ",0:"0"},$s=/^\s*\d+/,Fte=/^%/,jte=/[\\^$*+?|[\]().{}]/g;function yn(t,e,r){var n=t<0?"-":"",i=(n?-t:t)+"",l=i.length;return n+(l<r?new Array(r-l+1).join(e)+i:i)}function Ute(t){return t.replace(jte,"\\$&")}function d0(t){return new RegExp("^(?:"+t.map(Ute).join("|")+")","i")}function p0(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function Vte(t,e,r){var n=$s.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function $te(t,e,r){var n=$s.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function Wte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function Hte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function qte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function pD(t,e,r){var n=$s.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function gD(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Xte(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Gte(t,e,r){var n=$s.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function Zte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function mD(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function Yte(t,e,r){var n=$s.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function _D(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function Kte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function Qte(t,e,r){var n=$s.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function Jte(t,e,r){var n=$s.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function ere(t,e,r){var n=$s.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function tre(t,e,r){var n=Fte.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function rre(t,e,r){var n=$s.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function nre(t,e,r){var n=$s.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function yD(t,e){return yn(t.getDate(),e,2)}function ire(t,e){return yn(t.getHours(),e,2)}function sre(t,e){return yn(t.getHours()%12||12,e,2)}function are(t,e){return yn(1+Ab.count(nd(t),t),e,3)}function AF(t,e){return yn(t.getMilliseconds(),e,3)}function ore(t,e){return AF(t,e)+"000"}function lre(t,e){return yn(t.getMonth()+1,e,2)}function cre(t,e){return yn(t.getMinutes(),e,2)}function ure(t,e){return yn(t.getSeconds(),e,2)}function hre(t){var e=t.getDay();return e===0?7:e}function fre(t,e){return yn(CT.count(nd(t)-1,t),e,2)}function EF(t){var e=t.getDay();return e>=4||e===0?Fy(t):Fy.ceil(t)}function dre(t,e){return t=EF(t),yn(Fy.count(nd(t),t)+(nd(t).getDay()===4),e,2)}function pre(t){return t.getDay()}function gre(t,e){return yn(Pw.count(nd(t)-1,t),e,2)}function mre(t,e){return yn(t.getFullYear()%100,e,2)}function _re(t,e){return t=EF(t),yn(t.getFullYear()%100,e,2)}function yre(t,e){return yn(t.getFullYear()%1e4,e,4)}function vre(t,e){var r=t.getDay();return t=r>=4||r===0?Fy(t):Fy.ceil(t),yn(t.getFullYear()%1e4,e,4)}function bre(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+yn(e/60|0,"0",2)+yn(e%60,"0",2)}function vD(t,e){return yn(t.getUTCDate(),e,2)}function xre(t,e){return yn(t.getUTCHours(),e,2)}function wre(t,e){return yn(t.getUTCHours()%12||12,e,2)}function Tre(t,e){return yn(1+PT.count(id(t),t),e,3)}function PF(t,e){return yn(t.getUTCMilliseconds(),e,3)}function Sre(t,e){return PF(t,e)+"000"}function Are(t,e){return yn(t.getUTCMonth()+1,e,2)}function Ere(t,e){return yn(t.getUTCMinutes(),e,2)}function Pre(t,e){return yn(t.getUTCSeconds(),e,2)}function Cre(t){var e=t.getUTCDay();return e===0?7:e}function Mre(t,e){return yn(MT.count(id(t)-1,t),e,2)}function CF(t){var e=t.getUTCDay();return e>=4||e===0?jy(t):jy.ceil(t)}function Ire(t,e){return t=CF(t),yn(jy.count(id(t),t)+(id(t).getUTCDay()===4),e,2)}function Rre(t){return t.getUTCDay()}function Ore(t,e){return yn(Cw.count(id(t)-1,t),e,2)}function Dre(t,e){return yn(t.getUTCFullYear()%100,e,2)}function kre(t,e){return t=CF(t),yn(t.getUTCFullYear()%100,e,2)}function Lre(t,e){return yn(t.getUTCFullYear()%1e4,e,4)}function Nre(t,e){var r=t.getUTCDay();return t=r>=4||r===0?jy(t):jy.ceil(t),yn(t.getUTCFullYear()%1e4,e,4)}function zre(){return"+0000"}function bD(){return"%"}function xD(t){return+t}function wD(t){return Math.floor(+t/1e3)}var oy,MF,IF;Bre({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Bre(t){return oy=Bte(t),MF=oy.format,oy.parse,IF=oy.utcFormat,oy.utcParse,oy}function Fre(t){return new Date(t)}function jre(t){return t instanceof Date?+t:+new Date(+t)}function d3(t,e,r,n,i,l,c,s,m,b){var w=JC(),E=w.invert,O=w.domain,N=b(".%L"),V=b(":%S"),W=b("%I:%M"),j=b("%I %p"),Y=b("%a %d"),ce=b("%b %d"),re=b("%B"),ue=b("%Y");function me(ge){return(m(ge)<ge?N:s(ge)<ge?V:c(ge)<ge?W:l(ge)<ge?j:n(ge)<ge?i(ge)<ge?Y:ce:r(ge)<ge?re:ue)(ge)}return w.invert=function(ge){return new Date(E(ge))},w.domain=function(ge){return arguments.length?O(Array.from(ge,jre)):O().map(Fre)},w.ticks=function(ge){var Ce=O();return t(Ce[0],Ce[Ce.length-1],ge??10)},w.tickFormat=function(ge,Ce){return Ce==null?me:b(Ce)},w.nice=function(ge){var Ce=O();return(!ge||typeof ge.range!="function")&&(ge=e(Ce[0],Ce[Ce.length-1],ge??10)),ge?O(mF(Ce,ge)):w},w.copy=function(){return Sb(w,d3(t,e,r,n,i,l,c,s,m,b))},w}function Ure(){return Ec.apply(d3(Nte,zte,nd,h3,CT,Ab,c3,o3,Jg,MF).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Vre(){return Ec.apply(d3(kte,Lte,id,f3,MT,PT,u3,l3,Jg,IF).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function IT(){var t=0,e=1,r,n,i,l,c=go,s=!1,m;function b(E){return E==null||isNaN(E=+E)?m:c(i===0?.5:(E=(l(E)-r)*i,s?Math.max(0,Math.min(1,E)):E))}b.domain=function(E){return arguments.length?([t,e]=E,r=l(t=+t),n=l(e=+e),i=r===n?0:1/(n-r),b):[t,e]},b.clamp=function(E){return arguments.length?(s=!!E,b):s},b.interpolator=function(E){return arguments.length?(c=E,b):c};function w(E){return function(O){var N,V;return arguments.length?([N,V]=O,c=E(N,V),b):[c(0),c(1)]}}return b.range=w(Zy),b.rangeRound=w(QC),b.unknown=function(E){return arguments.length?(m=E,b):m},function(E){return l=E,r=E(t),n=E(e),i=r===n?0:1/(n-r),b}}function Rp(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function p3(){var t=Ip(IT()(go));return t.copy=function(){return Rp(t,p3())},ld.apply(t,arguments)}function RF(){var t=r3(IT()).domain([1,10]);return t.copy=function(){return Rp(t,RF()).base(t.base())},ld.apply(t,arguments)}function OF(){var t=n3(IT());return t.copy=function(){return Rp(t,OF()).constant(t.constant())},ld.apply(t,arguments)}function g3(){var t=i3(IT());return t.copy=function(){return Rp(t,g3()).exponent(t.exponent())},ld.apply(t,arguments)}function $re(){return g3.apply(null,arguments).exponent(.5)}function DF(){var t=[],e=go;function r(n){if(n!=null&&!isNaN(n=+n))return e((wb(t,n,1)-1)/(t.length-1))}return r.domain=function(n){if(!arguments.length)return t.slice();t=[];for(let i of n)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(Sp),r},r.interpolator=function(n){return arguments.length?(e=n,r):e},r.range=function(){return t.map((n,i)=>e(i/(t.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(i,l)=>See(t,l/n))},r.copy=function(){return DF(e).domain(t)},ld.apply(r,arguments)}function RT(){var t=0,e=.5,r=1,n=1,i,l,c,s,m,b=go,w,E=!1,O;function N(W){return isNaN(W=+W)?O:(W=.5+((W=+w(W))-l)*(n*W<n*l?s:m),b(E?Math.max(0,Math.min(1,W)):W))}N.domain=function(W){return arguments.length?([t,e,r]=W,i=w(t=+t),l=w(e=+e),c=w(r=+r),s=i===l?0:.5/(l-i),m=l===c?0:.5/(c-l),n=l<i?-1:1,N):[t,e,r]},N.clamp=function(W){return arguments.length?(E=!!W,N):E},N.interpolator=function(W){return arguments.length?(b=W,N):b};function V(W){return function(j){var Y,ce,re;return arguments.length?([Y,ce,re]=j,b=tte(W,[Y,ce,re]),N):[b(0),b(.5),b(1)]}}return N.range=V(Zy),N.rangeRound=V(QC),N.unknown=function(W){return arguments.length?(O=W,N):O},function(W){return w=W,i=W(t),l=W(e),c=W(r),s=i===l?0:.5/(l-i),m=l===c?0:.5/(c-l),n=l<i?-1:1,N}}function kF(){var t=Ip(RT()(go));return t.copy=function(){return Rp(t,kF())},ld.apply(t,arguments)}function LF(){var t=r3(RT()).domain([.1,1,10]);return t.copy=function(){return Rp(t,LF()).base(t.base())},ld.apply(t,arguments)}function NF(){var t=n3(RT());return t.copy=function(){return Rp(t,NF()).constant(t.constant())},ld.apply(t,arguments)}function m3(){var t=i3(RT());return t.copy=function(){return Rp(t,m3()).exponent(t.exponent())},ld.apply(t,arguments)}function Wre(){return m3.apply(null,arguments).exponent(.5)}function Hre(t){for(var e=t.length/6|0,r=new Array(e),n=0;n<e;)r[n]="#"+t.slice(n*6,++n*6);return r}const qre=t=>qee(t[t.length-1]);var Xre=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Hre);const Gre=qre(Xre),$g=[64,224,208,200],_3=2004,y3=2022,Zre=p3(Gre).domain([_3,y3]);function TD(t,e=220){const r=Math.max(_3,Math.min(y3,t)),i=Zre(r).match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);return i?[parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),e]:[255,200,0,e]}function Yre({settlements:t,cities:e,selectedCity:r}){const n=ee.useRef(null),i=ee.useRef(null),l=ee.useRef(null),[c,s]=ee.useState(null),m=ee.useMemo(()=>r==="all"?t.features:t.features.filter(E=>E.properties.city===r),[t,r]),b=ee.useMemo(()=>[new WC({id:"settlements",data:{type:"FeatureCollection",features:m},pickable:!0,stroked:!0,filled:!0,extruded:!1,lineWidthMinPixels:1,getFillColor:E=>{const O=E.properties.id===c,N=O?255:200;return E.properties.demolished&&E.properties.treatment_year?TD(E.properties.treatment_year,N):O?[$g[0],$g[1],$g[2],255]:$g},getLineColor:E=>{if(E.properties.demolished&&E.properties.treatment_year){const O=TD(E.properties.treatment_year,255);return[Math.max(0,O[0]-50),Math.max(0,O[1]-50),Math.max(0,O[2]-50),255]}return[0,128,128,255]},getLineWidth:2,updateTriggers:{getFillColor:[c]},onHover:E=>{E.object?s(E.object.properties.id):s(null)}})],[m,c]);ee.useEffect(()=>{if(!(!n.current||i.current))return i.current=new F8.Map({container:n.current,style:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},layers:[{id:"osm-tiles-layer",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]},center:[116.4,31.2],zoom:4}),l.current=new fee({layers:[]}),i.current.on("load",()=>{i.current&&l.current&&i.current.addControl(l.current)}),()=>{i.current?.remove(),i.current=null}},[]),ee.useEffect(()=>{l.current&&l.current.setProps({layers:b})},[b]),ee.useEffect(()=>{if(i.current)if(r==="all")i.current.flyTo({center:[116.4,31.2],zoom:4,duration:1e3});else{const E=e[r];E&&i.current.flyTo({center:E.center,zoom:E.zoom,duration:1e3})}},[r,e]);const w=ee.useMemo(()=>{if(!c)return null;const E=m.find(Y=>Y.properties.id===c);if(!E)return null;const{name:O,city:N,demolished:V,treatment_year:W,area_km2:j}=E.properties;return{name:O,city:N,status:V?"Demolished (Treatment)":"Informal Settlement (Control)",demolitionYear:W,area:j?`${(j*1e6).toFixed(0)} m`:"N/A"}},[c,m]);return se.jsxs("div",{className:"map-container",children:[se.jsx("div",{ref:n,className:"map"}),se.jsxs("div",{className:"map-legend",children:[se.jsxs("div",{className:"legend-item",children:[se.jsx("span",{className:"legend-color",style:{backgroundColor:`rgb(${$g[0]}, ${$g[1]}, ${$g[2]})`}}),se.jsx("span",{className:"legend-label",children:"Informal Settlements"})]}),se.jsxs("div",{className:"legend-item legend-gradient",children:[se.jsx("div",{className:"gradient-bar"}),se.jsxs("div",{className:"gradient-labels",children:[se.jsx("span",{children:_3}),se.jsx("span",{children:y3})]}),se.jsx("span",{className:"legend-label",children:"Demolished Informal Settlements"})]})]}),w&&se.jsxs("div",{className:"map-tooltip",children:[se.jsx("strong",{children:w.name}),se.jsx("br",{}),se.jsxs("span",{children:["City: ",w.city]}),se.jsx("br",{}),se.jsxs("span",{children:["Status: ",w.status]}),w.demolitionYear&&se.jsxs(se.Fragment,{children:[se.jsx("br",{}),se.jsxs("span",{children:["Demolished: ",w.demolitionYear]})]}),se.jsx("br",{}),se.jsxs("span",{children:["Area: ",w.area]})]})]})}function zF(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=zF(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function Ln(){for(var t,e,r=0,n="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=zF(t))&&(n&&(n+=" "),n+=e);return n}var Kre=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function v3(t){if(typeof t!="string")return!1;var e=Kre;return e.includes(t)}var Qre=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Jre=new Set(Qre);function BF(t){return typeof t!="string"?!1:Jre.has(t)}function FF(t){return typeof t=="string"&&t.startsWith("data-")}function xc(t){if(typeof t!="object"||t===null)return{};var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(BF(r)||FF(r))&&(e[r]=t[r]);return e}function OT(t){if(t==null)return null;if(ee.isValidElement(t)&&typeof t.props=="object"&&t.props!==null){var e=t.props;return xc(e)}return typeof t=="object"&&!Array.isArray(t)?xc(t):null}function va(t){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(BF(r)||FF(r)||v3(r))&&(e[r]=t[r]);return e}function ene(t){return t==null?null:ee.isValidElement(t)?va(t.props):typeof t=="object"&&!Array.isArray(t)?va(t):null}var tne=["children","width","height","viewBox","className","style","title","desc"];function eP(){return eP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},eP.apply(null,arguments)}function rne(t,e){if(t==null)return{};var r,n,i=nne(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function nne(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var jF=ee.forwardRef((t,e)=>{var{children:r,width:n,height:i,viewBox:l,className:c,style:s,title:m,desc:b}=t,w=rne(t,tne),E=l||{width:n,height:i,x:0,y:0},O=Ln("recharts-surface",c);return ee.createElement("svg",eP({},va(w),{className:O,width:n,height:i,style:s,viewBox:"".concat(E.x," ").concat(E.y," ").concat(E.width," ").concat(E.height),ref:e}),ee.createElement("title",null,m),ee.createElement("desc",null,b),r)}),ine=["children","className"];function tP(){return tP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tP.apply(null,arguments)}function sne(t,e){if(t==null)return{};var r,n,i=ane(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ane(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Ml=ee.forwardRef((t,e)=>{var{children:r,className:n}=t,i=sne(t,ine),l=Ln("recharts-layer",n);return ee.createElement("g",tP({className:l},va(i),{ref:e}),r)}),UF=C4(),one=ee.createContext(null);function si(t){return function(){return t}}const VF=Math.cos,Mw=Math.sin,Iu=Math.sqrt,Iw=Math.PI,DT=2*Iw,rP=Math.PI,nP=2*rP,Hg=1e-6,lne=nP-Hg;function $F(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function cne(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return $F;const r=10**e;return function(n){this._+=n[0];for(let i=1,l=n.length;i<l;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}class une{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?$F:cne(e)}moveTo(e,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,r){this._append`L${this._x1=+e},${this._y1=+r}`}quadraticCurveTo(e,r,n,i){this._append`Q${+e},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(e,r,n,i,l,c){this._append`C${+e},${+r},${+n},${+i},${this._x1=+l},${this._y1=+c}`}arcTo(e,r,n,i,l){if(e=+e,r=+r,n=+n,i=+i,l=+l,l<0)throw new Error(`negative radius: ${l}`);let c=this._x1,s=this._y1,m=n-e,b=i-r,w=c-e,E=s-r,O=w*w+E*E;if(this._x1===null)this._append`M${this._x1=e},${this._y1=r}`;else if(O>Hg)if(!(Math.abs(E*m-b*w)>Hg)||!l)this._append`L${this._x1=e},${this._y1=r}`;else{let N=n-c,V=i-s,W=m*m+b*b,j=N*N+V*V,Y=Math.sqrt(W),ce=Math.sqrt(O),re=l*Math.tan((rP-Math.acos((W+O-j)/(2*Y*ce)))/2),ue=re/ce,me=re/Y;Math.abs(ue-1)>Hg&&this._append`L${e+ue*w},${r+ue*E}`,this._append`A${l},${l},0,0,${+(E*N>w*V)},${this._x1=e+me*m},${this._y1=r+me*b}`}}arc(e,r,n,i,l,c){if(e=+e,r=+r,n=+n,c=!!c,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(i),m=n*Math.sin(i),b=e+s,w=r+m,E=1^c,O=c?i-l:l-i;this._x1===null?this._append`M${b},${w}`:(Math.abs(this._x1-b)>Hg||Math.abs(this._y1-w)>Hg)&&this._append`L${b},${w}`,n&&(O<0&&(O=O%nP+nP),O>lne?this._append`A${n},${n},0,1,${E},${e-s},${r-m}A${n},${n},0,1,${E},${this._x1=b},${this._y1=w}`:O>Hg&&this._append`A${n},${n},0,${+(O>=rP)},${E},${this._x1=e+n*Math.cos(l)},${this._y1=r+n*Math.sin(l)}`)}rect(e,r,n,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function b3(t){let e=3;return t.digits=function(r){if(!arguments.length)return e;if(r==null)e=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);e=n}return t},()=>new une(e)}function x3(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function WF(t){this._context=t}WF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function kT(t){return new WF(t)}function HF(t){return t[0]}function qF(t){return t[1]}function XF(t,e){var r=si(!0),n=null,i=kT,l=null,c=b3(s);t=typeof t=="function"?t:t===void 0?HF:si(t),e=typeof e=="function"?e:e===void 0?qF:si(e);function s(m){var b,w=(m=x3(m)).length,E,O=!1,N;for(n==null&&(l=i(N=c())),b=0;b<=w;++b)!(b<w&&r(E=m[b],b,m))===O&&((O=!O)?l.lineStart():l.lineEnd()),O&&l.point(+t(E,b,m),+e(E,b,m));if(N)return l=null,N+""||null}return s.x=function(m){return arguments.length?(t=typeof m=="function"?m:si(+m),s):t},s.y=function(m){return arguments.length?(e=typeof m=="function"?m:si(+m),s):e},s.defined=function(m){return arguments.length?(r=typeof m=="function"?m:si(!!m),s):r},s.curve=function(m){return arguments.length?(i=m,n!=null&&(l=i(n)),s):i},s.context=function(m){return arguments.length?(m==null?n=l=null:l=i(n=m),s):n},s}function f1(t,e,r){var n=null,i=si(!0),l=null,c=kT,s=null,m=b3(b);t=typeof t=="function"?t:t===void 0?HF:si(+t),e=typeof e=="function"?e:si(e===void 0?0:+e),r=typeof r=="function"?r:r===void 0?qF:si(+r);function b(E){var O,N,V,W=(E=x3(E)).length,j,Y=!1,ce,re=new Array(W),ue=new Array(W);for(l==null&&(s=c(ce=m())),O=0;O<=W;++O){if(!(O<W&&i(j=E[O],O,E))===Y)if(Y=!Y)N=O,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),V=O-1;V>=N;--V)s.point(re[V],ue[V]);s.lineEnd(),s.areaEnd()}Y&&(re[O]=+t(j,O,E),ue[O]=+e(j,O,E),s.point(n?+n(j,O,E):re[O],r?+r(j,O,E):ue[O]))}if(ce)return s=null,ce+""||null}function w(){return XF().defined(i).curve(c).context(l)}return b.x=function(E){return arguments.length?(t=typeof E=="function"?E:si(+E),n=null,b):t},b.x0=function(E){return arguments.length?(t=typeof E=="function"?E:si(+E),b):t},b.x1=function(E){return arguments.length?(n=E==null?null:typeof E=="function"?E:si(+E),b):n},b.y=function(E){return arguments.length?(e=typeof E=="function"?E:si(+E),r=null,b):e},b.y0=function(E){return arguments.length?(e=typeof E=="function"?E:si(+E),b):e},b.y1=function(E){return arguments.length?(r=E==null?null:typeof E=="function"?E:si(+E),b):r},b.lineX0=b.lineY0=function(){return w().x(t).y(e)},b.lineY1=function(){return w().x(t).y(r)},b.lineX1=function(){return w().x(n).y(e)},b.defined=function(E){return arguments.length?(i=typeof E=="function"?E:si(!!E),b):i},b.curve=function(E){return arguments.length?(c=E,l!=null&&(s=c(l)),b):c},b.context=function(E){return arguments.length?(E==null?l=s=null:s=c(l=E),b):l},b}class GF{constructor(e,r){this._context=e,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,r){switch(e=+e,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,r):this._context.moveTo(e,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,r,e,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,e,this._y0,e,r);break}}this._x0=e,this._y0=r}}function hne(t){return new GF(t,!0)}function fne(t){return new GF(t,!1)}const w3={draw(t,e){const r=Iu(e/Iw);t.moveTo(r,0),t.arc(0,0,r,0,DT)}},dne={draw(t,e){const r=Iu(e/5)/2;t.moveTo(-3*r,-r),t.lineTo(-r,-r),t.lineTo(-r,-3*r),t.lineTo(r,-3*r),t.lineTo(r,-r),t.lineTo(3*r,-r),t.lineTo(3*r,r),t.lineTo(r,r),t.lineTo(r,3*r),t.lineTo(-r,3*r),t.lineTo(-r,r),t.lineTo(-3*r,r),t.closePath()}},ZF=Iu(1/3),pne=ZF*2,gne={draw(t,e){const r=Iu(e/pne),n=r*ZF;t.moveTo(0,-r),t.lineTo(n,0),t.lineTo(0,r),t.lineTo(-n,0),t.closePath()}},mne={draw(t,e){const r=Iu(e),n=-r/2;t.rect(n,n,r,r)}},_ne=.8908130915292852,YF=Mw(Iw/10)/Mw(7*Iw/10),yne=Mw(DT/10)*YF,vne=-VF(DT/10)*YF,bne={draw(t,e){const r=Iu(e*_ne),n=yne*r,i=vne*r;t.moveTo(0,-r),t.lineTo(n,i);for(let l=1;l<5;++l){const c=DT*l/5,s=VF(c),m=Mw(c);t.lineTo(m*r,-s*r),t.lineTo(s*n-m*i,m*n+s*i)}t.closePath()}},US=Iu(3),xne={draw(t,e){const r=-Iu(e/(US*3));t.moveTo(0,r*2),t.lineTo(-US*r,-r),t.lineTo(US*r,-r),t.closePath()}},hc=-.5,fc=Iu(3)/2,iP=1/Iu(12),wne=(iP/2+1)*3,Tne={draw(t,e){const r=Iu(e/wne),n=r/2,i=r*iP,l=n,c=r*iP+r,s=-l,m=c;t.moveTo(n,i),t.lineTo(l,c),t.lineTo(s,m),t.lineTo(hc*n-fc*i,fc*n+hc*i),t.lineTo(hc*l-fc*c,fc*l+hc*c),t.lineTo(hc*s-fc*m,fc*s+hc*m),t.lineTo(hc*n+fc*i,hc*i-fc*n),t.lineTo(hc*l+fc*c,hc*c-fc*l),t.lineTo(hc*s+fc*m,hc*m-fc*s),t.closePath()}};function Sne(t,e){let r=null,n=b3(i);t=typeof t=="function"?t:si(t||w3),e=typeof e=="function"?e:si(e===void 0?64:+e);function i(){let l;if(r||(r=l=n()),t.apply(this,arguments).draw(r,+e.apply(this,arguments)),l)return r=null,l+""||null}return i.type=function(l){return arguments.length?(t=typeof l=="function"?l:si(l),i):t},i.size=function(l){return arguments.length?(e=typeof l=="function"?l:si(+l),i):e},i.context=function(l){return arguments.length?(r=l??null,i):r},i}function Rw(){}function Ow(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function KF(t){this._context=t}KF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ow(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ow(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Ane(t){return new KF(t)}function QF(t){this._context=t}QF.prototype={areaStart:Rw,areaEnd:Rw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Ow(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Ene(t){return new QF(t)}function JF(t){this._context=t}JF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+t)/6,n=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:Ow(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Pne(t){return new JF(t)}function e6(t){this._context=t}e6.prototype={areaStart:Rw,areaEnd:Rw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function Cne(t){return new e6(t)}function SD(t){return t<0?-1:1}function AD(t,e,r){var n=t._x1-t._x0,i=e-t._x1,l=(t._y1-t._y0)/(n||i<0&&-0),c=(r-t._y1)/(i||n<0&&-0),s=(l*i+c*n)/(n+i);return(SD(l)+SD(c))*Math.min(Math.abs(l),Math.abs(c),.5*Math.abs(s))||0}function ED(t,e){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-e)/2:e}function VS(t,e,r){var n=t._x0,i=t._y0,l=t._x1,c=t._y1,s=(l-n)/3;t._context.bezierCurveTo(n+s,i+s*e,l-s,c-s*r,l,c)}function Dw(t){this._context=t}Dw.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:VS(this,this._t0,ED(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var r=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,VS(this,ED(this,r=AD(this,t,e)),r);break;default:VS(this,this._t0,r=AD(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=r}}};function t6(t){this._context=new r6(t)}(t6.prototype=Object.create(Dw.prototype)).point=function(t,e){Dw.prototype.point.call(this,e,t)};function r6(t){this._context=t}r6.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,r,n,i,l){this._context.bezierCurveTo(e,t,n,r,l,i)}};function Mne(t){return new Dw(t)}function Ine(t){return new t6(t)}function n6(t){this._context=t}n6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),r===2)this._context.lineTo(t[1],e[1]);else for(var n=PD(t),i=PD(e),l=0,c=1;c<r;++l,++c)this._context.bezierCurveTo(n[0][l],i[0][l],n[1][l],i[1][l],t[c],e[c]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function PD(t){var e,r=t.length-1,n,i=new Array(r),l=new Array(r),c=new Array(r);for(i[0]=0,l[0]=2,c[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,l[e]=4,c[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,l[r-1]=7,c[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/l[e-1],l[e]-=n,c[e]-=n*c[e-1];for(i[r-1]=c[r-1]/l[r-1],e=r-2;e>=0;--e)i[e]=(c[e]-i[e+1])/l[e];for(l[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)l[e]=2*t[e+1]-i[e+1];return[i,l]}function Rne(t){return new n6(t)}function LT(t,e){this._context=t,this._t=e}LT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,e)}break}}this._x=t,this._y=e}};function One(t){return new LT(t,.5)}function Dne(t){return new LT(t,0)}function kne(t){return new LT(t,1)}function _m(t,e){if((c=t.length)>1)for(var r=1,n,i,l=t[e[0]],c,s=l.length;r<c;++r)for(i=l,l=t[e[r]],n=0;n<s;++n)l[n][1]+=l[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]}function sP(t){for(var e=t.length,r=new Array(e);--e>=0;)r[e]=e;return r}function Lne(t,e){return t[e]}function Nne(t){const e=[];return e.key=t,e}function zne(){var t=si([]),e=sP,r=_m,n=Lne;function i(l){var c=Array.from(t.apply(this,arguments),Nne),s,m=c.length,b=-1,w;for(const E of l)for(s=0,++b;s<m;++s)(c[s][b]=[0,+n(E,c[s].key,b,l)]).data=E;for(s=0,w=x3(e(c));s<m;++s)c[w[s]].index=s;return r(c,w),c}return i.keys=function(l){return arguments.length?(t=typeof l=="function"?l:si(Array.from(l)),i):t},i.value=function(l){return arguments.length?(n=typeof l=="function"?l:si(+l),i):n},i.order=function(l){return arguments.length?(e=l==null?sP:typeof l=="function"?l:si(Array.from(l)),i):e},i.offset=function(l){return arguments.length?(r=l??_m,i):r},i}function Bne(t,e){if((n=t.length)>0){for(var r,n,i=0,l=t[0].length,c;i<l;++i){for(c=r=0;r<n;++r)c+=t[r][i][1]||0;if(c)for(r=0;r<n;++r)t[r][i][1]/=c}_m(t,e)}}function Fne(t,e){if((i=t.length)>0){for(var r=0,n=t[e[0]],i,l=n.length;r<l;++r){for(var c=0,s=0;c<i;++c)s+=t[c][r][1]||0;n[r][1]+=n[r][0]=-s/2}_m(t,e)}}function jne(t,e){if(!(!((c=t.length)>0)||!((l=(i=t[e[0]]).length)>0))){for(var r=0,n=1,i,l,c;n<l;++n){for(var s=0,m=0,b=0;s<c;++s){for(var w=t[e[s]],E=w[n][1]||0,O=w[n-1][1]||0,N=(E-O)/2,V=0;V<s;++V){var W=t[e[V]],j=W[n][1]||0,Y=W[n-1][1]||0;N+=j-Y}m+=E,b+=N*E}i[n-1][1]+=i[n-1][0]=r,m&&(r-=b/m)}i[n-1][1]+=i[n-1][0]=r,_m(t,e)}}var $S={},WS={},CD;function Une(){return CD||(CD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==="__proto__"}t.isUnsafeProperty=e})(WS)),WS}var HS={},MD;function i6(){return MD||(MD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){switch(typeof r){case"number":case"symbol":return!1;case"string":return r.includes(".")||r.includes("[")||r.includes("]")}}t.isDeepKey=e})(HS)),HS}var qS={},ID;function T3(){return ID||(ID=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="string"||typeof r=="symbol"?r:Object.is(r?.valueOf?.(),-0)?"-0":String(r)}t.toKey=e})(qS)),qS}var XS={},GS={},RD;function Vne(){return RD||(RD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){if(r==null)return"";if(typeof r=="string")return r;if(Array.isArray(r))return r.map(e).join(",");const n=String(r);return n==="0"&&Object.is(Number(r),-0)?"-0":n}t.toString=e})(GS)),GS}var OD;function S3(){return OD||(OD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Vne(),r=T3();function n(i){if(Array.isArray(i))return i.map(r.toKey);if(typeof i=="symbol")return[i];i=e.toString(i);const l=[],c=i.length;if(c===0)return l;let s=0,m="",b="",w=!1;for(i.charCodeAt(0)===46&&(l.push(""),s++);s<c;){const E=i[s];b?E==="\\"&&s+1<c?(s++,m+=i[s]):E===b?b="":m+=E:w?E==='"'||E==="'"?b=E:E==="]"?(w=!1,l.push(m),m=""):m+=E:E==="["?(w=!0,m&&(l.push(m),m="")):E==="."?m&&(l.push(m),m=""):m+=E,s++}return m&&l.push(m),l}t.toPath=n})(XS)),XS}var DD;function A3(){return DD||(DD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Une(),r=i6(),n=T3(),i=S3();function l(s,m,b){if(s==null)return b;switch(typeof m){case"string":{if(e.isUnsafeProperty(m))return b;const w=s[m];return w===void 0?r.isDeepKey(m)?l(s,i.toPath(m),b):b:w}case"number":case"symbol":{typeof m=="number"&&(m=n.toKey(m));const w=s[m];return w===void 0?b:w}default:{if(Array.isArray(m))return c(s,m,b);if(Object.is(m?.valueOf(),-0)?m="-0":m=String(m),e.isUnsafeProperty(m))return b;const w=s[m];return w===void 0?b:w}}}function c(s,m,b){if(m.length===0)return b;let w=s;for(let E=0;E<m.length;E++){if(w==null||e.isUnsafeProperty(m[E]))return b;w=w[m[E]]}return w===void 0?b:w}t.get=l})($S)),$S}var ZS,kD;function $ne(){return kD||(kD=1,ZS=A3().get),ZS}var Wne=$ne();const NT=Fh(Wne);var Hne=4;function xp(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hne,r=10**e,n=Math.round(t*r)/r;return Object.is(n,-0)?0:n}function ji(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return t.reduce((i,l,c)=>{var s=r[c-1];return typeof s=="string"?i+s+l:s!==void 0?i+xp(s)+l:i+l},"")}var mc=t=>t===0?0:t>0?1:-1,Nh=t=>typeof t=="number"&&t!=+t,ym=t=>typeof t=="string"&&t.indexOf("%")===t.length-1,cr=t=>(typeof t=="number"||t instanceof Number)&&!Nh(t),wc=t=>cr(t)||typeof t=="string",qne=0,tb=t=>{var e=++qne;return"".concat(t||"").concat(e)},Cp=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!cr(e)&&typeof e!="string")return n;var l;if(ym(e)){if(r==null)return n;var c=e.indexOf("%");l=r*parseFloat(e.slice(0,c))/100}else l=+e;return Nh(l)&&(l=n),i&&r!=null&&l>r&&(l=r),l},s6=t=>{if(!Array.isArray(t))return!1;for(var e=t.length,r={},n=0;n<e;n++)if(!r[String(t[n])])r[String(t[n])]=!0;else return!0;return!1};function rs(t,e,r){return cr(t)&&cr(e)?xp(t+r*(e-t)):e}function a6(t,e,r){if(!(!t||!t.length))return t.find(n=>n&&(typeof e=="function"?e(n):NT(n,e))===r)}var Vs=t=>t===null||typeof t>"u",Eb=t=>Vs(t)?t:"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));function Xo(t){return t!=null}function Mm(){}var Xne=["type","size","sizeType"];function aP(){return aP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},aP.apply(null,arguments)}function LD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ND(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?LD(Object(r),!0).forEach(function(n){Gne(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Gne(t,e,r){return(e=Zne(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zne(t){var e=Yne(t,"string");return typeof e=="symbol"?e:e+""}function Yne(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Kne(t,e){if(t==null)return{};var r,n,i=Qne(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Qne(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var o6={symbolCircle:w3,symbolCross:dne,symbolDiamond:gne,symbolSquare:mne,symbolStar:bne,symbolTriangle:xne,symbolWye:Tne},Jne=Math.PI/180,eie=t=>{var e="symbol".concat(Eb(t));return o6[e]||w3},tie=(t,e,r)=>{if(e==="area")return t;switch(r){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var n=18*Jne;return 1.25*t*t*(Math.tan(n)-Math.tan(n*2)*Math.tan(n)**2)}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},rie=(t,e)=>{o6["symbol".concat(Eb(t))]=e},l6=t=>{var{type:e="circle",size:r=64,sizeType:n="area"}=t,i=Kne(t,Xne),l=ND(ND({},i),{},{type:e,size:r,sizeType:n}),c="circle";typeof e=="string"&&(c=e);var s=()=>{var O=eie(c),N=Sne().type(O).size(tie(r,n,c)),V=N();if(V!==null)return V},{className:m,cx:b,cy:w}=l,E=va(l);return cr(b)&&cr(w)&&cr(r)?ee.createElement("path",aP({},E,{className:Ln("recharts-symbols",m),transform:"translate(".concat(b,", ").concat(w,")"),d:s()})):null};l6.registerSymbol=rie;var c6=t=>"radius"in t&&"startAngle"in t&&"endAngle"in t,E3=(t,e)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var r=t;if(ee.isValidElement(t)&&(r=t.props),typeof r!="object"&&typeof r!="function")return null;var n={};return Object.keys(r).forEach(i=>{v3(i)&&(n[i]=(l=>r[i](r,l)))}),n},nie=(t,e,r)=>n=>(t(e,r,n),null),iie=(t,e,r)=>{if(t===null||typeof t!="object"&&typeof t!="function")return null;var n=null;return Object.keys(t).forEach(i=>{var l=t[i];v3(i)&&typeof l=="function"&&(n||(n={}),n[i]=nie(l,e,r))}),n};function zD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function sie(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?zD(Object(r),!0).forEach(function(n){aie(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function aie(t,e,r){return(e=oie(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oie(t){var e=lie(t,"string");return typeof e=="symbol"?e:e+""}function lie(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ba(t,e){var r=sie({},t),n=e,i=Object.keys(e),l=i.reduce((c,s)=>(c[s]===void 0&&n[s]!==void 0&&(c[s]=n[s]),c),r);return l}var YS={},KS={},BD;function cie(){return BD||(BD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n){const i=new Map;for(let l=0;l<r.length;l++){const c=r[l],s=n(c,l,r);i.has(s)||i.set(s,c)}return Array.from(i.values())}t.uniqBy=e})(KS)),KS}var QS={},FD;function uie(){return FD||(FD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n){return function(...i){return r.apply(this,i.slice(0,n))}}t.ary=e})(QS)),QS}var JS={},jD;function u6(){return jD||(jD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r}t.identity=e})(JS)),JS}var eA={},tA={},rA={},UD;function hie(){return UD||(UD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Number.isSafeInteger(r)&&r>=0}t.isLength=e})(rA)),rA}var VD;function P3(){return VD||(VD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=hie();function r(n){return n!=null&&typeof n!="function"&&e.isLength(n.length)}t.isArrayLike=r})(tA)),tA}var nA={},$D;function fie(){return $D||($D=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="object"&&r!==null}t.isObjectLike=e})(nA)),nA}var WD;function die(){return WD||(WD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=P3(),r=fie();function n(i){return r.isObjectLike(i)&&e.isArrayLike(i)}t.isArrayLikeObject=n})(eA)),eA}var iA={},sA={},HD;function pie(){return HD||(HD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=A3();function r(n){return function(i){return e.get(i,n)}}t.property=r})(sA)),sA}var aA={},oA={},lA={},cA={},qD;function h6(){return qD||(qD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r!==null&&(typeof r=="object"||typeof r=="function")}t.isObject=e})(cA)),cA}var uA={},XD;function f6(){return XD||(XD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==null||typeof r!="object"&&typeof r!="function"}t.isPrimitive=e})(uA)),uA}var hA={},GD;function d6(){return GD||(GD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n){return r===n||Number.isNaN(r)&&Number.isNaN(n)}t.isEqualsSameValueZero=e})(hA)),hA}var ZD;function gie(){return ZD||(ZD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=h6(),r=f6(),n=d6();function i(w,E,O){return typeof O!="function"?i(w,E,()=>{}):l(w,E,function N(V,W,j,Y,ce,re){const ue=O(V,W,j,Y,ce,re);return ue!==void 0?!!ue:l(V,W,N,re)},new Map)}function l(w,E,O,N){if(E===w)return!0;switch(typeof E){case"object":return c(w,E,O,N);case"function":return Object.keys(E).length>0?l(w,{...E},O,N):n.isEqualsSameValueZero(w,E);default:return e.isObject(w)?typeof E=="string"?E==="":!0:n.isEqualsSameValueZero(w,E)}}function c(w,E,O,N){if(E==null)return!0;if(Array.isArray(E))return m(w,E,O,N);if(E instanceof Map)return s(w,E,O,N);if(E instanceof Set)return b(w,E,O,N);const V=Object.keys(E);if(w==null||r.isPrimitive(w))return V.length===0;if(V.length===0)return!0;if(N?.has(E))return N.get(E)===w;N?.set(E,w);try{for(let W=0;W<V.length;W++){const j=V[W];if(!r.isPrimitive(w)&&!(j in w)||E[j]===void 0&&w[j]!==void 0||E[j]===null&&w[j]!==null||!O(w[j],E[j],j,w,E,N))return!1}return!0}finally{N?.delete(E)}}function s(w,E,O,N){if(E.size===0)return!0;if(!(w instanceof Map))return!1;for(const[V,W]of E.entries()){const j=w.get(V);if(O(j,W,V,w,E,N)===!1)return!1}return!0}function m(w,E,O,N){if(E.length===0)return!0;if(!Array.isArray(w))return!1;const V=new Set;for(let W=0;W<E.length;W++){const j=E[W];let Y=!1;for(let ce=0;ce<w.length;ce++){if(V.has(ce))continue;const re=w[ce];let ue=!1;if(O(re,j,W,w,E,N)&&(ue=!0),ue){V.add(ce),Y=!0;break}}if(!Y)return!1}return!0}function b(w,E,O,N){return E.size===0?!0:w instanceof Set?m([...w],[...E],O,N):!1}t.isMatchWith=i,t.isSetMatch=b})(lA)),lA}var YD;function p6(){return YD||(YD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=gie();function r(n,i){return e.isMatchWith(n,i,()=>{})}t.isMatch=r})(oA)),oA}var fA={},dA={},pA={},KD;function mie(){return KD||(KD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Object.getOwnPropertySymbols(r).filter(n=>Object.prototype.propertyIsEnumerable.call(r,n))}t.getSymbols=e})(pA)),pA}var gA={},QD;function C3(){return QD||(QD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}t.getTag=e})(gA)),gA}var mA={},JD;function g6(){return JD||(JD=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e="[object RegExp]",r="[object String]",n="[object Number]",i="[object Boolean]",l="[object Arguments]",c="[object Symbol]",s="[object Date]",m="[object Map]",b="[object Set]",w="[object Array]",E="[object Function]",O="[object ArrayBuffer]",N="[object Object]",V="[object Error]",W="[object DataView]",j="[object Uint8Array]",Y="[object Uint8ClampedArray]",ce="[object Uint16Array]",re="[object Uint32Array]",ue="[object BigUint64Array]",me="[object Int8Array]",ge="[object Int16Array]",Ce="[object Int32Array]",We="[object BigInt64Array]",Xe="[object Float32Array]",Et="[object Float64Array]";t.argumentsTag=l,t.arrayBufferTag=O,t.arrayTag=w,t.bigInt64ArrayTag=We,t.bigUint64ArrayTag=ue,t.booleanTag=i,t.dataViewTag=W,t.dateTag=s,t.errorTag=V,t.float32ArrayTag=Xe,t.float64ArrayTag=Et,t.functionTag=E,t.int16ArrayTag=ge,t.int32ArrayTag=Ce,t.int8ArrayTag=me,t.mapTag=m,t.numberTag=n,t.objectTag=N,t.regexpTag=e,t.setTag=b,t.stringTag=r,t.symbolTag=c,t.uint16ArrayTag=ce,t.uint32ArrayTag=re,t.uint8ArrayTag=j,t.uint8ClampedArrayTag=Y})(mA)),mA}var _A={},ek;function _ie(){return ek||(ek=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}t.isTypedArray=e})(_A)),_A}var tk;function m6(){return tk||(tk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=mie(),r=C3(),n=g6(),i=f6(),l=_ie();function c(w,E){return s(w,void 0,w,new Map,E)}function s(w,E,O,N=new Map,V=void 0){const W=V?.(w,E,O,N);if(W!==void 0)return W;if(i.isPrimitive(w))return w;if(N.has(w))return N.get(w);if(Array.isArray(w)){const j=new Array(w.length);N.set(w,j);for(let Y=0;Y<w.length;Y++)j[Y]=s(w[Y],Y,O,N,V);return Object.hasOwn(w,"index")&&(j.index=w.index),Object.hasOwn(w,"input")&&(j.input=w.input),j}if(w instanceof Date)return new Date(w.getTime());if(w instanceof RegExp){const j=new RegExp(w.source,w.flags);return j.lastIndex=w.lastIndex,j}if(w instanceof Map){const j=new Map;N.set(w,j);for(const[Y,ce]of w)j.set(Y,s(ce,Y,O,N,V));return j}if(w instanceof Set){const j=new Set;N.set(w,j);for(const Y of w)j.add(s(Y,void 0,O,N,V));return j}if(typeof Buffer<"u"&&Buffer.isBuffer(w))return w.subarray();if(l.isTypedArray(w)){const j=new(Object.getPrototypeOf(w)).constructor(w.length);N.set(w,j);for(let Y=0;Y<w.length;Y++)j[Y]=s(w[Y],Y,O,N,V);return j}if(w instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&w instanceof SharedArrayBuffer)return w.slice(0);if(w instanceof DataView){const j=new DataView(w.buffer.slice(0),w.byteOffset,w.byteLength);return N.set(w,j),m(j,w,O,N,V),j}if(typeof File<"u"&&w instanceof File){const j=new File([w],w.name,{type:w.type});return N.set(w,j),m(j,w,O,N,V),j}if(typeof Blob<"u"&&w instanceof Blob){const j=new Blob([w],{type:w.type});return N.set(w,j),m(j,w,O,N,V),j}if(w instanceof Error){const j=new w.constructor;return N.set(w,j),j.message=w.message,j.name=w.name,j.stack=w.stack,j.cause=w.cause,m(j,w,O,N,V),j}if(w instanceof Boolean){const j=new Boolean(w.valueOf());return N.set(w,j),m(j,w,O,N,V),j}if(w instanceof Number){const j=new Number(w.valueOf());return N.set(w,j),m(j,w,O,N,V),j}if(w instanceof String){const j=new String(w.valueOf());return N.set(w,j),m(j,w,O,N,V),j}if(typeof w=="object"&&b(w)){const j=Object.create(Object.getPrototypeOf(w));return N.set(w,j),m(j,w,O,N,V),j}return w}function m(w,E,O=w,N,V){const W=[...Object.keys(E),...e.getSymbols(E)];for(let j=0;j<W.length;j++){const Y=W[j],ce=Object.getOwnPropertyDescriptor(w,Y);(ce==null||ce.writable)&&(w[Y]=s(E[Y],Y,O,N,V))}}function b(w){switch(r.getTag(w)){case n.argumentsTag:case n.arrayTag:case n.arrayBufferTag:case n.dataViewTag:case n.booleanTag:case n.dateTag:case n.float32ArrayTag:case n.float64ArrayTag:case n.int8ArrayTag:case n.int16ArrayTag:case n.int32ArrayTag:case n.mapTag:case n.numberTag:case n.objectTag:case n.regexpTag:case n.setTag:case n.stringTag:case n.symbolTag:case n.uint8ArrayTag:case n.uint8ClampedArrayTag:case n.uint16ArrayTag:case n.uint32ArrayTag:return!0;default:return!1}}t.cloneDeepWith=c,t.cloneDeepWithImpl=s,t.copyProperties=m})(dA)),dA}var rk;function yie(){return rk||(rk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=m6();function r(n){return e.cloneDeepWithImpl(n,void 0,n,new Map,void 0)}t.cloneDeep=r})(fA)),fA}var nk;function vie(){return nk||(nk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=p6(),r=yie();function n(i){return i=r.cloneDeep(i),l=>e.isMatch(l,i)}t.matches=n})(aA)),aA}var yA={},vA={},bA={},ik;function bie(){return ik||(ik=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=m6(),r=C3(),n=g6();function i(l,c){return e.cloneDeepWith(l,(s,m,b,w)=>{const E=c?.(s,m,b,w);if(E!==void 0)return E;if(typeof l=="object"){if(r.getTag(l)===n.objectTag&&typeof l.constructor!="function"){const O={};return w.set(l,O),e.copyProperties(O,l,b,w),O}switch(Object.prototype.toString.call(l)){case n.numberTag:case n.stringTag:case n.booleanTag:{const O=new l.constructor(l?.valueOf());return e.copyProperties(O,l),O}case n.argumentsTag:{const O={};return e.copyProperties(O,l),O.length=l.length,O[Symbol.iterator]=l[Symbol.iterator],O}default:return}}})}t.cloneDeepWith=i})(bA)),bA}var sk;function xie(){return sk||(sk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=bie();function r(n){return e.cloneDeepWith(n)}t.cloneDeep=r})(vA)),vA}var xA={},wA={},ak;function _6(){return ak||(ak=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=/^(?:0|[1-9]\d*)$/;function r(n,i=Number.MAX_SAFE_INTEGER){switch(typeof n){case"number":return Number.isInteger(n)&&n>=0&&n<i;case"symbol":return!1;case"string":return e.test(n)}}t.isIndex=r})(wA)),wA}var TA={},ok;function wie(){return ok||(ok=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=C3();function r(n){return n!==null&&typeof n=="object"&&e.getTag(n)==="[object Arguments]"}t.isArguments=r})(TA)),TA}var lk;function Tie(){return lk||(lk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=i6(),r=_6(),n=wie(),i=S3();function l(c,s){let m;if(Array.isArray(s)?m=s:typeof s=="string"&&e.isDeepKey(s)&&c?.[s]==null?m=i.toPath(s):m=[s],m.length===0)return!1;let b=c;for(let w=0;w<m.length;w++){const E=m[w];if((b==null||!Object.hasOwn(b,E))&&!((Array.isArray(b)||n.isArguments(b))&&r.isIndex(E)&&E<b.length))return!1;b=b[E]}return!0}t.has=l})(xA)),xA}var ck;function Sie(){return ck||(ck=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=p6(),r=T3(),n=xie(),i=A3(),l=Tie();function c(s,m){switch(typeof s){case"object":{Object.is(s?.valueOf(),-0)&&(s="-0");break}case"number":{s=r.toKey(s);break}}return m=n.cloneDeep(m),function(b){const w=i.get(b,s);return w===void 0?l.has(b,s):m===void 0?w===void 0:e.isMatch(w,m)}}t.matchesProperty=c})(yA)),yA}var uk;function Aie(){return uk||(uk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=u6(),r=pie(),n=vie(),i=Sie();function l(c){if(c==null)return e.identity;switch(typeof c){case"function":return c;case"object":return Array.isArray(c)&&c.length===2?i.matchesProperty(c[0],c[1]):n.matches(c);case"string":case"symbol":case"number":return r.property(c)}}t.iteratee=l})(iA)),iA}var hk;function Eie(){return hk||(hk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=cie(),r=uie(),n=u6(),i=die(),l=Aie();function c(s,m=n.identity){return i.isArrayLikeObject(s)?e.uniqBy(Array.from(s),r.ary(l.iteratee(m),1)):[]}t.uniqBy=c})(YS)),YS}var SA,fk;function Pie(){return fk||(fk=1,SA=Eie().uniqBy),SA}var Cie=Pie();const dk=Fh(Cie);function Mie(t,e,r){return e===!0?dk(t,r):typeof e=="function"?dk(t,e):t}var AA={exports:{}},EA={},PA={exports:{}},CA={};var pk;function Iie(){if(pk)return CA;pk=1;var t=Hy();function e(E,O){return E===O&&(E!==0||1/E===1/O)||E!==E&&O!==O}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,l=t.useLayoutEffect,c=t.useDebugValue;function s(E,O){var N=O(),V=n({inst:{value:N,getSnapshot:O}}),W=V[0].inst,j=V[1];return l(function(){W.value=N,W.getSnapshot=O,m(W)&&j({inst:W})},[E,N,O]),i(function(){return m(W)&&j({inst:W}),E(function(){m(W)&&j({inst:W})})},[E]),c(N),N}function m(E){var O=E.getSnapshot;E=E.value;try{var N=O();return!r(E,N)}catch{return!0}}function b(E,O){return O()}var w=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?b:s;return CA.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:w,CA}var gk;function Rie(){return gk||(gk=1,PA.exports=Iie()),PA.exports}var mk;function Oie(){if(mk)return EA;mk=1;var t=Hy(),e=Rie();function r(b,w){return b===w&&(b!==0||1/b===1/w)||b!==b&&w!==w}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,l=t.useRef,c=t.useEffect,s=t.useMemo,m=t.useDebugValue;return EA.useSyncExternalStoreWithSelector=function(b,w,E,O,N){var V=l(null);if(V.current===null){var W={hasValue:!1,value:null};V.current=W}else W=V.current;V=s(function(){function Y(ge){if(!ce){if(ce=!0,re=ge,ge=O(ge),N!==void 0&&W.hasValue){var Ce=W.value;if(N(Ce,ge))return ue=Ce}return ue=ge}if(Ce=ue,n(re,ge))return Ce;var We=O(ge);return N!==void 0&&N(Ce,We)?(re=ge,Ce):(re=ge,ue=We)}var ce=!1,re,ue,me=E===void 0?null:E;return[function(){return Y(w())},me===null?void 0:function(){return Y(me())}]},[w,E,O,N]);var j=i(b,V[0],V[1]);return c(function(){W.hasValue=!0,W.value=j},[j]),m(j),j},EA}var _k;function Die(){return _k||(_k=1,AA.exports=Oie()),AA.exports}var kie=Die(),M3=ee.createContext(null),Lie=t=>t,xs=()=>{var t=ee.useContext(M3);return t?t.store.dispatch:Lie},V1=()=>{},Nie=()=>V1,zie=(t,e)=>t===e;function mr(t){var e=ee.useContext(M3),r=ee.useMemo(()=>e?n=>{if(n!=null)return t(n)}:V1,[e,t]);return kie.useSyncExternalStoreWithSelector(e?e.subscription.addNestedSub:Nie,e?e.store.getState:V1,e?e.store.getState:V1,r,zie)}function Bie(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Fie(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function jie(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${r}]`)}}var yk=t=>Array.isArray(t)?t:[t];function Uie(t){const e=Array.isArray(t[0])?t[0]:t;return jie(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Vie(t,e){const r=[],{length:n}=t;for(let i=0;i<n;i++)r.push(t[i].apply(null,e));return r}var $ie=class{constructor(t){this.value=t}deref(){return this.value}},Wie=typeof WeakRef<"u"?WeakRef:$ie,Hie=0,vk=1;function d1(){return{s:Hie,v:void 0,o:null,p:null}}function y6(t,e={}){let r=d1();const{resultEqualityCheck:n}=e;let i,l=0;function c(){let s=r;const{length:m}=arguments;for(let E=0,O=m;E<O;E++){const N=arguments[E];if(typeof N=="function"||typeof N=="object"&&N!==null){let V=s.o;V===null&&(s.o=V=new WeakMap);const W=V.get(N);W===void 0?(s=d1(),V.set(N,s)):s=W}else{let V=s.p;V===null&&(s.p=V=new Map);const W=V.get(N);W===void 0?(s=d1(),V.set(N,s)):s=W}}const b=s;let w;if(s.s===vk)w=s.v;else if(w=t.apply(null,arguments),l++,n){const E=i?.deref?.()??i;E!=null&&n(E,w)&&(w=E,l!==0&&l--),i=typeof w=="object"&&w!==null||typeof w=="function"?new Wie(w):w}return b.s=vk,b.v=w,w}return c.clearCache=()=>{r=d1(),c.resetResultsCount()},c.resultsCount=()=>l,c.resetResultsCount=()=>{l=0},c}function qie(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,n=(...i)=>{let l=0,c=0,s,m={},b=i.pop();typeof b=="object"&&(m=b,b=i.pop()),Bie(b,`createSelector expects an output function after the inputs, but received: [${typeof b}]`);const w={...r,...m},{memoize:E,memoizeOptions:O=[],argsMemoize:N=y6,argsMemoizeOptions:V=[]}=w,W=yk(O),j=yk(V),Y=Uie(i),ce=E(function(){return l++,b.apply(null,arguments)},...W),re=N(function(){c++;const me=Vie(Y,arguments);return s=ce.apply(null,me),s},...j);return Object.assign(re,{resultFunc:b,memoizedResultFunc:ce,dependencies:Y,dependencyRecomputations:()=>c,resetDependencyRecomputations:()=>{c=0},lastResult:()=>s,recomputations:()=>l,resetRecomputations:()=>{l=0},memoize:E,argsMemoize:N})};return Object.assign(n,{withTypes:()=>n}),n}var bt=qie(y6),Xie=Object.assign((t,e=bt)=>{Fie(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),n=r.map(l=>t[l]);return e(n,(...l)=>l.reduce((c,s,m)=>(c[r[m]]=s,c),{}))},{withTypes:()=>Xie}),MA={},IA={},RA={},bk;function Gie(){return bk||(bk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="symbol"?1:n===null?2:n===void 0?3:n!==n?4:0}const r=(n,i,l)=>{if(n!==i){const c=e(n),s=e(i);if(c===s&&c===0){if(n<i)return l==="desc"?1:-1;if(n>i)return l==="desc"?-1:1}return l==="desc"?s-c:c-s}return 0};t.compareValues=r})(RA)),RA}var OA={},DA={},xk;function v6(){return xk||(xk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="symbol"||r instanceof Symbol}t.isSymbol=e})(DA)),DA}var wk;function Zie(){return wk||(wk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=v6(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(l,c){return Array.isArray(l)?!1:typeof l=="number"||typeof l=="boolean"||l==null||e.isSymbol(l)?!0:typeof l=="string"&&(n.test(l)||!r.test(l))||c!=null&&Object.hasOwn(c,l)}t.isKey=i})(OA)),OA}var Tk;function Yie(){return Tk||(Tk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Gie(),r=Zie(),n=S3();function i(l,c,s,m){if(l==null)return[];s=m?void 0:s,Array.isArray(l)||(l=Object.values(l)),Array.isArray(c)||(c=c==null?[null]:[c]),c.length===0&&(c=[null]),Array.isArray(s)||(s=s==null?[]:[s]),s=s.map(N=>String(N));const b=(N,V)=>{let W=N;for(let j=0;j<V.length&&W!=null;++j)W=W[V[j]];return W},w=(N,V)=>V==null||N==null?V:typeof N=="object"&&"key"in N?Object.hasOwn(V,N.key)?V[N.key]:b(V,N.path):typeof N=="function"?N(V):Array.isArray(N)?b(V,N):typeof V=="object"?V[N]:V,E=c.map(N=>(Array.isArray(N)&&N.length===1&&(N=N[0]),N==null||typeof N=="function"||Array.isArray(N)||r.isKey(N)?N:{key:N,path:n.toPath(N)}));return l.map(N=>({original:N,criteria:E.map(V=>w(V,N))})).slice().sort((N,V)=>{for(let W=0;W<E.length;W++){const j=e.compareValues(N.criteria[W],V.criteria[W],s[W]);if(j!==0)return j}return 0}).map(N=>N.original)}t.orderBy=i})(IA)),IA}var kA={},Sk;function Kie(){return Sk||(Sk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n=1){const i=[],l=Math.floor(n),c=(s,m)=>{for(let b=0;b<s.length;b++){const w=s[b];Array.isArray(w)&&m<l?c(w,m+1):i.push(w)}};return c(r,0),i}t.flatten=e})(kA)),kA}var LA={},Ak;function b6(){return Ak||(Ak=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=_6(),r=P3(),n=h6(),i=d6();function l(c,s,m){return n.isObject(m)&&(typeof s=="number"&&r.isArrayLike(m)&&e.isIndex(s)&&s<m.length||typeof s=="string"&&s in m)?i.isEqualsSameValueZero(m[s],c):!1}t.isIterateeCall=l})(LA)),LA}var Ek;function Qie(){return Ek||(Ek=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Yie(),r=Kie(),n=b6();function i(l,...c){const s=c.length;return s>1&&n.isIterateeCall(l,c[0],c[1])?c=[]:s>2&&n.isIterateeCall(c[0],c[1],c[2])&&(c=[c[0]]),e.orderBy(l,r.flatten(c),["asc"])}t.sortBy=i})(MA)),MA}var NA,Pk;function Jie(){return Pk||(Pk=1,NA=Qie().sortBy),NA}var ese=Jie();const zT=Fh(ese);var x6=t=>t.legend.settings,tse=t=>t.legend.size,rse=t=>t.legend.payload;bt([rse,x6],(t,e)=>{var{itemSorter:r}=e,n=t.flat(1);return r?zT(n,r):n});var p1=1;function nse(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[e,r]=ee.useState({height:0,left:0,top:0,width:0}),n=ee.useCallback(i=>{if(i!=null){var l=i.getBoundingClientRect(),c={height:l.height,left:l.left,top:l.top,width:l.width};(Math.abs(c.height-e.height)>p1||Math.abs(c.left-e.left)>p1||Math.abs(c.top-e.top)>p1||Math.abs(c.width-e.width)>p1)&&r({height:c.height,left:c.left,top:c.top,width:c.width})}},[e.width,e.height,e.top,e.left,...t]);return[e,n]}function ga(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var ise=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ck=ise,zA=()=>Math.random().toString(36).substring(7).split("").join("."),sse={INIT:`@@redux/INIT${zA()}`,REPLACE:`@@redux/REPLACE${zA()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${zA()}`},kw=sse;function I3(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function w6(t,e,r){if(typeof t!="function")throw new Error(ga(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(ga(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(ga(1));return r(w6)(t,e)}let n=t,i=e,l=new Map,c=l,s=0,m=!1;function b(){c===l&&(c=new Map,l.forEach((j,Y)=>{c.set(Y,j)}))}function w(){if(m)throw new Error(ga(3));return i}function E(j){if(typeof j!="function")throw new Error(ga(4));if(m)throw new Error(ga(5));let Y=!0;b();const ce=s++;return c.set(ce,j),function(){if(Y){if(m)throw new Error(ga(6));Y=!1,b(),c.delete(ce),l=null}}}function O(j){if(!I3(j))throw new Error(ga(7));if(typeof j.type>"u")throw new Error(ga(8));if(typeof j.type!="string")throw new Error(ga(17));if(m)throw new Error(ga(9));try{m=!0,i=n(i,j)}finally{m=!1}return(l=c).forEach(ce=>{ce()}),j}function N(j){if(typeof j!="function")throw new Error(ga(10));n=j,O({type:kw.REPLACE})}function V(){const j=E;return{subscribe(Y){if(typeof Y!="object"||Y===null)throw new Error(ga(11));function ce(){const ue=Y;ue.next&&ue.next(w())}return ce(),{unsubscribe:j(ce)}},[Ck](){return this}}}return O({type:kw.INIT}),{dispatch:O,subscribe:E,getState:w,replaceReducer:N,[Ck]:V}}function ase(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:kw.INIT})>"u")throw new Error(ga(12));if(typeof r(void 0,{type:kw.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ga(13))})}function T6(t){const e=Object.keys(t),r={};for(let l=0;l<e.length;l++){const c=e[l];typeof t[c]=="function"&&(r[c]=t[c])}const n=Object.keys(r);let i;try{ase(r)}catch(l){i=l}return function(c={},s){if(i)throw i;let m=!1;const b={};for(let w=0;w<n.length;w++){const E=n[w],O=r[E],N=c[E],V=O(N,s);if(typeof V>"u")throw s&&s.type,new Error(ga(14));b[E]=V,m=m||V!==N}return m=m||n.length!==Object.keys(c).length,m?b:c}}function Lw(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...n)=>e(r(...n)))}function ose(...t){return e=>(r,n)=>{const i=e(r,n);let l=()=>{throw new Error(ga(15))};const c={getState:i.getState,dispatch:(m,...b)=>l(m,...b)},s=t.map(m=>m(c));return l=Lw(...s)(i.dispatch),{...i,dispatch:l}}}function S6(t){return I3(t)&&"type"in t&&typeof t.type=="string"}var A6=Symbol.for("immer-nothing"),Mk=Symbol.for("immer-draftable"),mo=Symbol.for("immer-state");function xu(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Pl=Object,Uy=Pl.getPrototypeOf,Nw="constructor",BT="prototype",oP="configurable",zw="enumerable",$1="writable",rb="value",sd=t=>!!t&&!!t[mo];function Cu(t){return t?E6(t)||jT(t)||!!t[Mk]||!!t[Nw]?.[Mk]||UT(t)||VT(t):!1}var lse=Pl[BT][Nw].toString(),Ik=new WeakMap;function E6(t){if(!t||!R3(t))return!1;const e=Uy(t);if(e===null||e===Pl[BT])return!0;const r=Pl.hasOwnProperty.call(e,Nw)&&e[Nw];if(r===Object)return!0;if(!fy(r))return!1;let n=Ik.get(r);return n===void 0&&(n=Function.toString.call(r),Ik.set(r,n)),n===lse}function FT(t,e,r=!0){Pb(t)===0?(r?Reflect.ownKeys(t):Pl.keys(t)).forEach(i=>{e(i,t[i],t)}):t.forEach((n,i)=>e(i,n,t))}function Pb(t){const e=t[mo];return e?e.type_:jT(t)?1:UT(t)?2:VT(t)?3:0}var Rk=(t,e,r=Pb(t))=>r===2?t.has(e):Pl[BT].hasOwnProperty.call(t,e),lP=(t,e,r=Pb(t))=>r===2?t.get(e):t[e],Bw=(t,e,r,n=Pb(t))=>{n===2?t.set(e,r):n===3?t.add(r):t[e]=r};function cse(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}var jT=Array.isArray,UT=t=>t instanceof Map,VT=t=>t instanceof Set,R3=t=>typeof t=="object",fy=t=>typeof t=="function",BA=t=>typeof t=="boolean";function use(t){const e=+t;return Number.isInteger(e)&&String(e)===t}var Xf=t=>t.copy_||t.base_,O3=t=>t.modified_?t.copy_:t.base_;function cP(t,e){if(UT(t))return new Map(t);if(VT(t))return new Set(t);if(jT(t))return Array[BT].slice.call(t);const r=E6(t);if(e===!0||e==="class_only"&&!r){const n=Pl.getOwnPropertyDescriptors(t);delete n[mo];let i=Reflect.ownKeys(n);for(let l=0;l<i.length;l++){const c=i[l],s=n[c];s[$1]===!1&&(s[$1]=!0,s[oP]=!0),(s.get||s.set)&&(n[c]={[oP]:!0,[$1]:!0,[zw]:s[zw],[rb]:t[c]})}return Pl.create(Uy(t),n)}else{const n=Uy(t);if(n!==null&&r)return{...t};const i=Pl.create(n);return Pl.assign(i,t)}}function D3(t,e=!1){return $T(t)||sd(t)||!Cu(t)||(Pb(t)>1&&Pl.defineProperties(t,{set:g1,add:g1,clear:g1,delete:g1}),Pl.freeze(t),e&&FT(t,(r,n)=>{D3(n,!0)},!1)),t}function hse(){xu(2)}var g1={[rb]:hse};function $T(t){return t===null||!R3(t)?!0:Pl.isFrozen(t)}var Fw="MapSet",uP="Patches",Ok="ArrayMethods",P6={};function vm(t){const e=P6[t];return e||xu(0,t),e}var Dk=t=>!!P6[t],nb,C6=()=>nb,fse=(t,e)=>({drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Dk(Fw)?vm(Fw):void 0,arrayMethodsPlugin_:Dk(Ok)?vm(Ok):void 0});function kk(t,e){e&&(t.patchPlugin_=vm(uP),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function hP(t){fP(t),t.drafts_.forEach(dse),t.drafts_=null}function fP(t){t===nb&&(nb=t.parent_)}var Lk=t=>nb=fse(nb,t);function dse(t){const e=t[mo];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Nk(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];if(t!==void 0&&t!==r){r[mo].modified_&&(hP(e),xu(4)),Cu(t)&&(t=zk(e,t));const{patchPlugin_:i}=e;i&&i.generateReplacementPatches_(r[mo].base_,t,e)}else t=zk(e,r);return pse(e,t,!0),hP(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==A6?t:void 0}function zk(t,e){if($T(e))return e;const r=e[mo];if(!r)return jw(e,t.handledSet_,t);if(!WT(r,t))return e;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:n}=r;if(n)for(;n.length>0;)n.pop()(t);R6(r,t)}return r.copy_}function pse(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&D3(e,r)}function M6(t){t.finalized_=!0,t.scope_.unfinalizedDrafts_--}var WT=(t,e)=>t.scope_===e,gse=[];function I6(t,e,r,n){const i=Xf(t),l=t.type_;if(n!==void 0&&lP(i,n,l)===e){Bw(i,n,r,l);return}if(!t.draftLocations_){const s=t.draftLocations_=new Map;FT(i,(m,b)=>{if(sd(b)){const w=s.get(b)||[];w.push(m),s.set(b,w)}})}const c=t.draftLocations_.get(e)??gse;for(const s of c)Bw(i,s,r,l)}function mse(t,e,r){t.callbacks_.push(function(i){const l=e;if(!l||!WT(l,i))return;i.mapSetPlugin_?.fixSetContents(l);const c=O3(l);I6(t,l.draft_??l,c,r),R6(l,i)})}function R6(t,e){if(t.modified_&&!t.finalized_&&(t.type_===3||t.type_===1&&t.allIndicesReassigned_||(t.assigned_?.size??0)>0)){const{patchPlugin_:n}=e;if(n){const i=n.getPath(t);i&&n.generatePatches_(t,i,e)}M6(t)}}function _se(t,e,r){const{scope_:n}=t;if(sd(r)){const i=r[mo];WT(i,n)&&i.callbacks_.push(function(){W1(t);const c=O3(i);I6(t,r,c,e)})}else Cu(r)&&t.callbacks_.push(function(){const l=Xf(t);t.type_===3?l.has(r)&&jw(r,n.handledSet_,n):lP(l,e,t.type_)===r&&n.drafts_.length>1&&(t.assigned_.get(e)??!1)===!0&&t.copy_&&jw(lP(t.copy_,e,t.type_),n.handledSet_,n)})}function jw(t,e,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||sd(t)||e.has(t)||!Cu(t)||$T(t)||(e.add(t),FT(t,(n,i)=>{if(sd(i)){const l=i[mo];if(WT(l,r)){const c=O3(l);Bw(t,n,c,t.type_),M6(l)}}else Cu(i)&&jw(i,e,r)})),t}function yse(t,e){const r=jT(t),n={type_:r?1:0,scope_:e?e.scope_:C6(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let i=n,l=Uw;r&&(i=[n],l=ib);const{revoke:c,proxy:s}=Proxy.revocable(i,l);return n.draft_=s,n.revoke_=c,[s,n]}var Uw={get(t,e){if(e===mo)return t;let r=t.scope_.arrayMethodsPlugin_;const n=t.type_===1&&typeof e=="string";if(n&&r?.isArrayOperationMethod(e))return r.createMethodInterceptor(t,e);const i=Xf(t);if(!Rk(i,e,t.type_))return vse(t,i,e);const l=i[e];if(t.finalized_||!Cu(l)||n&&t.operationMethod&&r?.isMutatingArrayMethod(t.operationMethod)&&use(e))return l;if(l===FA(t.base_,e)){W1(t);const c=t.type_===1?+e:e,s=pP(t.scope_,l,t,c);return t.copy_[c]=s}return l},has(t,e){return e in Xf(t)},ownKeys(t){return Reflect.ownKeys(Xf(t))},set(t,e,r){const n=O6(Xf(t),e);if(n?.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const i=FA(Xf(t),e),l=i?.[mo];if(l&&l.base_===r)return t.copy_[e]=r,t.assigned_.set(e,!1),!0;if(cse(r,i)&&(r!==void 0||Rk(t.base_,e,t.type_)))return!0;W1(t),dP(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_.set(e,!0),_se(t,e,r)),!0},deleteProperty(t,e){return W1(t),FA(t.base_,e)!==void 0||e in t.base_?(t.assigned_.set(e,!1),dP(t)):t.assigned_.delete(e),t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=Xf(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{[$1]:!0,[oP]:t.type_!==1||e!=="length",[zw]:n[zw],[rb]:r[e]}},defineProperty(){xu(11)},getPrototypeOf(t){return Uy(t.base_)},setPrototypeOf(){xu(12)}},ib={};for(let t in Uw){let e=Uw[t];ib[t]=function(){const r=arguments;return r[0]=r[0][0],e.apply(this,r)}}ib.deleteProperty=function(t,e){return ib.set.call(this,t,e,void 0)};ib.set=function(t,e,r){return Uw.set.call(this,t[0],e,r,t[0])};function FA(t,e){const r=t[mo];return(r?Xf(r):t)[e]}function vse(t,e,r){const n=O6(e,r);return n?rb in n?n[rb]:n.get?.call(t.draft_):void 0}function O6(t,e){if(!(e in t))return;let r=Uy(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Uy(r)}}function dP(t){t.modified_||(t.modified_=!0,t.parent_&&dP(t.parent_))}function W1(t){t.copy_||(t.assigned_=new Map,t.copy_=cP(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var bse=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(r,n,i)=>{if(fy(r)&&!fy(n)){const c=n;n=r;const s=this;return function(b=c,...w){return s.produce(b,E=>n.call(this,E,...w))}}fy(n)||xu(6),i!==void 0&&!fy(i)&&xu(7);let l;if(Cu(r)){const c=Lk(this),s=pP(c,r,void 0);let m=!0;try{l=n(s),m=!1}finally{m?hP(c):fP(c)}return kk(c,i),Nk(l,c)}else if(!r||!R3(r)){if(l=n(r),l===void 0&&(l=r),l===A6&&(l=void 0),this.autoFreeze_&&D3(l,!0),i){const c=[],s=[];vm(uP).generateReplacementPatches_(r,l,{patches_:c,inversePatches_:s}),i(c,s)}return l}else xu(1,r)},this.produceWithPatches=(r,n)=>{if(fy(r))return(s,...m)=>this.produceWithPatches(s,b=>r(b,...m));let i,l;return[this.produce(r,n,(s,m)=>{i=s,l=m}),i,l]},BA(e?.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),BA(e?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),BA(e?.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){Cu(e)||xu(8),sd(e)&&(e=Eu(e));const r=Lk(this),n=pP(r,e,void 0);return n[mo].isManual_=!0,fP(r),n}finishDraft(e,r){const n=e&&e[mo];(!n||!n.isManual_)&&xu(9);const{scope_:i}=n;return kk(i,r),Nk(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,r){let n;for(n=r.length-1;n>=0;n--){const l=r[n];if(l.path.length===0&&l.op==="replace"){e=l.value;break}}n>-1&&(r=r.slice(n+1));const i=vm(uP).applyPatches_;return sd(e)?i(e,r):this.produce(e,l=>i(l,r))}};function pP(t,e,r,n){const[i,l]=UT(e)?vm(Fw).proxyMap_(e,r):VT(e)?vm(Fw).proxySet_(e,r):yse(e,r);return(r?.scope_??C6()).drafts_.push(i),l.callbacks_=r?.callbacks_??[],l.key_=n,r&&n!==void 0?mse(r,l,n):l.callbacks_.push(function(m){m.mapSetPlugin_?.fixSetContents(l);const{patchPlugin_:b}=m;l.modified_&&b&&b.generatePatches_(l,[],m)}),i}function Eu(t){return sd(t)||xu(10,t),D6(t)}function D6(t){if(!Cu(t)||$T(t))return t;const e=t[mo];let r,n=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=cP(t,e.scope_.immer_.useStrictShallowCopy_),n=e.scope_.immer_.shouldUseStrictIteration()}else r=cP(t,!0);return FT(r,(i,l)=>{Bw(r,i,D6(l))},n),e&&(e.finalized_=!1),r}var xse=new bse,k6=xse.produce;function L6(t){return({dispatch:r,getState:n})=>i=>l=>typeof l=="function"?l(r,n,t):i(l)}var wse=L6(),Tse=L6,Sse=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Lw:Lw.apply(null,arguments)};function Tc(t,e){function r(...n){if(e){let i=e(...n);if(!i)throw new Error(Cl(0));return{type:t,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:t,payload:n[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=n=>S6(n)&&n.type===t,r}var N6=class E0 extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,E0.prototype)}static get[Symbol.species](){return E0}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new E0(...e[0].concat(this)):new E0(...e.concat(this))}};function Bk(t){return Cu(t)?k6(t,()=>{}):t}function m1(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function Ase(t){return typeof t=="boolean"}var Ese=()=>function(e){const{thunk:r=!0,immutableCheck:n=!0,serializableCheck:i=!0,actionCreatorCheck:l=!0}=e??{};let c=new N6;return r&&(Ase(r)?c.push(wse):c.push(Tse(r.extraArgument))),c},z6="RTK_autoBatch",mi=()=>t=>({payload:t,meta:{[z6]:!0}}),Fk=t=>e=>{setTimeout(e,t)},B6=(t={type:"raf"})=>e=>(...r)=>{const n=e(...r);let i=!0,l=!1,c=!1;const s=new Set,m=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Fk(10):t.type==="callback"?t.queueNotification:Fk(t.timeout),b=()=>{c=!1,l&&(l=!1,s.forEach(w=>w()))};return Object.assign({},n,{subscribe(w){const E=()=>i&&w(),O=n.subscribe(E);return s.add(w),()=>{O(),s.delete(w)}},dispatch(w){try{return i=!w?.meta?.[z6],l=!i,l&&(c||(c=!0,m(b))),n.dispatch(w)}finally{i=!0}}})},Pse=t=>function(r){const{autoBatch:n=!0}=r??{};let i=new N6(t);return n&&i.push(B6(typeof n=="object"?n:void 0)),i};function Cse(t){const e=Ese(),{reducer:r=void 0,middleware:n,devTools:i=!0,preloadedState:l=void 0,enhancers:c=void 0}=t||{};let s;if(typeof r=="function")s=r;else if(I3(r))s=T6(r);else throw new Error(Cl(1));let m;typeof n=="function"?m=n(e):m=e();let b=Lw;i&&(b=Sse({trace:!1,...typeof i=="object"&&i}));const w=ose(...m),E=Pse(w);let O=typeof c=="function"?c(E):E();const N=b(...O);return w6(s,l,N)}function F6(t){const e={},r=[];let n;const i={addCase(l,c){const s=typeof l=="string"?l:l.type;if(!s)throw new Error(Cl(28));if(s in e)throw new Error(Cl(29));return e[s]=c,i},addAsyncThunk(l,c){return c.pending&&(e[l.pending.type]=c.pending),c.rejected&&(e[l.rejected.type]=c.rejected),c.fulfilled&&(e[l.fulfilled.type]=c.fulfilled),c.settled&&r.push({matcher:l.settled,reducer:c.settled}),i},addMatcher(l,c){return r.push({matcher:l,reducer:c}),i},addDefaultCase(l){return n=l,i}};return t(i),[e,r,n]}function Mse(t){return typeof t=="function"}function Ise(t,e){let[r,n,i]=F6(e),l;if(Mse(t))l=()=>Bk(t());else{const s=Bk(t);l=()=>s}function c(s=l(),m){let b=[r[m.type],...n.filter(({matcher:w})=>w(m)).map(({reducer:w})=>w)];return b.filter(w=>!!w).length===0&&(b=[i]),b.reduce((w,E)=>{if(E)if(sd(w)){const N=E(w,m);return N===void 0?w:N}else{if(Cu(w))return k6(w,O=>E(O,m));{const O=E(w,m);if(O===void 0){if(w===null)return w;throw Error("A case reducer on a non-draftable value must not return undefined")}return O}}return w},s)}return c.getInitialState=l,c}var Rse="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Ose=(t=21)=>{let e="",r=t;for(;r--;)e+=Rse[Math.random()*64|0];return e},Dse=Symbol.for("rtk-slice-createasyncthunk");function kse(t,e){return`${t}/${e}`}function Lse({creators:t}={}){const e=t?.asyncThunk?.[Dse];return function(n){const{name:i,reducerPath:l=i}=n;if(!i)throw new Error(Cl(11));const c=(typeof n.reducers=="function"?n.reducers(zse()):n.reducers)||{},s=Object.keys(c),m={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},b={addCase(re,ue){const me=typeof re=="string"?re:re.type;if(!me)throw new Error(Cl(12));if(me in m.sliceCaseReducersByType)throw new Error(Cl(13));return m.sliceCaseReducersByType[me]=ue,b},addMatcher(re,ue){return m.sliceMatchers.push({matcher:re,reducer:ue}),b},exposeAction(re,ue){return m.actionCreators[re]=ue,b},exposeCaseReducer(re,ue){return m.sliceCaseReducersByName[re]=ue,b}};s.forEach(re=>{const ue=c[re],me={reducerName:re,type:kse(i,re),createNotation:typeof n.reducers=="function"};Fse(ue)?Use(me,ue,b,e):Bse(me,ue,b)});function w(){const[re={},ue=[],me=void 0]=typeof n.extraReducers=="function"?F6(n.extraReducers):[n.extraReducers],ge={...re,...m.sliceCaseReducersByType};return Ise(n.initialState,Ce=>{for(let We in ge)Ce.addCase(We,ge[We]);for(let We of m.sliceMatchers)Ce.addMatcher(We.matcher,We.reducer);for(let We of ue)Ce.addMatcher(We.matcher,We.reducer);me&&Ce.addDefaultCase(me)})}const E=re=>re,O=new Map,N=new WeakMap;let V;function W(re,ue){return V||(V=w()),V(re,ue)}function j(){return V||(V=w()),V.getInitialState()}function Y(re,ue=!1){function me(Ce){let We=Ce[re];return typeof We>"u"&&ue&&(We=m1(N,me,j)),We}function ge(Ce=E){const We=m1(O,ue,()=>new WeakMap);return m1(We,Ce,()=>{const Xe={};for(const[Et,gt]of Object.entries(n.selectors??{}))Xe[Et]=Nse(gt,Ce,()=>m1(N,Ce,j),ue);return Xe})}return{reducerPath:re,getSelectors:ge,get selectors(){return ge(me)},selectSlice:me}}const ce={name:i,reducer:W,actions:m.actionCreators,caseReducers:m.sliceCaseReducersByName,getInitialState:j,...Y(l),injectInto(re,{reducerPath:ue,...me}={}){const ge=ue??l;return re.inject({reducerPath:ge,reducer:W},me),{...ce,...Y(ge,!0)}}};return ce}}function Nse(t,e,r,n){function i(l,...c){let s=e(l);return typeof s>"u"&&n&&(s=r()),t(s,...c)}return i.unwrapped=t,i}var Go=Lse();function zse(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function Bse({type:t,reducerName:e,createNotation:r},n,i){let l,c;if("reducer"in n){if(r&&!jse(n))throw new Error(Cl(17));l=n.reducer,c=n.prepare}else l=n;i.addCase(t,l).exposeCaseReducer(e,l).exposeAction(e,c?Tc(t,c):Tc(t))}function Fse(t){return t._reducerDefinitionType==="asyncThunk"}function jse(t){return t._reducerDefinitionType==="reducerWithPrepare"}function Use({type:t,reducerName:e},r,n,i){if(!i)throw new Error(Cl(18));const{payloadCreator:l,fulfilled:c,pending:s,rejected:m,settled:b,options:w}=r,E=i(t,l,w);n.exposeAction(e,E),c&&n.addCase(E.fulfilled,c),s&&n.addCase(E.pending,s),m&&n.addCase(E.rejected,m),b&&n.addMatcher(E.settled,b),n.exposeCaseReducer(e,{fulfilled:c||_1,pending:s||_1,rejected:m||_1,settled:b||_1})}function _1(){}var Vse="task",j6="listener",U6="completed",k3="cancelled",$se=`task-${k3}`,Wse=`task-${U6}`,gP=`${j6}-${k3}`,Hse=`${j6}-${U6}`,HT=class{constructor(t){this.code=t,this.message=`${Vse} ${k3} (reason: ${t})`}name="TaskAbortError";message},L3=(t,e)=>{if(typeof t!="function")throw new TypeError(Cl(32))},Vw=()=>{},V6=(t,e=Vw)=>(t.catch(e),t),$6=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),lm=t=>{if(t.aborted)throw new HT(t.reason)};function W6(t,e){let r=Vw;return new Promise((n,i)=>{const l=()=>i(new HT(t.reason));if(t.aborted){l();return}r=$6(t,l),e.finally(()=>r()).then(n,i)}).finally(()=>{r=Vw})}var qse=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(r){return{status:r instanceof HT?"cancelled":"rejected",error:r}}finally{e?.()}},$w=t=>e=>V6(W6(t,e).then(r=>(lm(t),r))),H6=t=>{const e=$w(t);return r=>e(new Promise(n=>setTimeout(n,r)))},{assign:Cy}=Object,jk={},qT="listenerMiddleware",Xse=(t,e)=>{const r=n=>$6(t,()=>n.abort(t.reason));return(n,i)=>{L3(n);const l=new AbortController;r(l);const c=qse(async()=>{lm(t),lm(l.signal);const s=await n({pause:$w(l.signal),delay:H6(l.signal),signal:l.signal});return lm(l.signal),s},()=>l.abort(Wse));return i?.autoJoin&&e.push(c.catch(Vw)),{result:$w(t)(c),cancel(){l.abort($se)}}}},Gse=(t,e)=>{const r=async(n,i)=>{lm(e);let l=()=>{};const s=[new Promise((m,b)=>{let w=t({predicate:n,effect:(E,O)=>{O.unsubscribe(),m([E,O.getState(),O.getOriginalState()])}});l=()=>{w(),b()}})];i!=null&&s.push(new Promise(m=>setTimeout(m,i,null)));try{const m=await W6(e,Promise.race(s));return lm(e),m}finally{l()}};return(n,i)=>V6(r(n,i))},q6=t=>{let{type:e,actionCreator:r,matcher:n,predicate:i,effect:l}=t;if(e)i=Tc(e).match;else if(r)e=r.type,i=r.match;else if(n)i=n;else if(!i)throw new Error(Cl(21));return L3(l),{predicate:i,type:e,effect:l}},X6=Cy(t=>{const{type:e,predicate:r,effect:n}=q6(t);return{id:Ose(),effect:n,type:e,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Cl(22))}}},{withTypes:()=>X6}),Uk=(t,e)=>{const{type:r,effect:n,predicate:i}=q6(e);return Array.from(t.values()).find(l=>(typeof r=="string"?l.type===r:l.predicate===i)&&l.effect===n)},mP=t=>{t.pending.forEach(e=>{e.abort(gP)})},Zse=(t,e)=>()=>{for(const r of e.keys())mP(r);t.clear()},Vk=(t,e,r)=>{try{t(e,r)}catch(n){setTimeout(()=>{throw n},0)}},G6=Cy(Tc(`${qT}/add`),{withTypes:()=>G6}),Yse=Tc(`${qT}/removeAll`),Z6=Cy(Tc(`${qT}/remove`),{withTypes:()=>Z6}),Kse=(...t)=>{console.error(`${qT}/error`,...t)},Cb=(t={})=>{const e=new Map,r=new Map,n=N=>{const V=r.get(N)??0;r.set(N,V+1)},i=N=>{const V=r.get(N)??1;V===1?r.delete(N):r.set(N,V-1)},{extra:l,onError:c=Kse}=t;L3(c);const s=N=>(N.unsubscribe=()=>e.delete(N.id),e.set(N.id,N),V=>{N.unsubscribe(),V?.cancelActive&&mP(N)}),m=N=>{const V=Uk(e,N)??X6(N);return s(V)};Cy(m,{withTypes:()=>m});const b=N=>{const V=Uk(e,N);return V&&(V.unsubscribe(),N.cancelActive&&mP(V)),!!V};Cy(b,{withTypes:()=>b});const w=async(N,V,W,j)=>{const Y=new AbortController,ce=Gse(m,Y.signal),re=[];try{N.pending.add(Y),n(N),await Promise.resolve(N.effect(V,Cy({},W,{getOriginalState:j,condition:(ue,me)=>ce(ue,me).then(Boolean),take:ce,delay:H6(Y.signal),pause:$w(Y.signal),extra:l,signal:Y.signal,fork:Xse(Y.signal,re),unsubscribe:N.unsubscribe,subscribe:()=>{e.set(N.id,N)},cancelActiveListeners:()=>{N.pending.forEach((ue,me,ge)=>{ue!==Y&&(ue.abort(gP),ge.delete(ue))})},cancel:()=>{Y.abort(gP),N.pending.delete(Y)},throwIfCancelled:()=>{lm(Y.signal)}})))}catch(ue){ue instanceof HT||Vk(c,ue,{raisedBy:"effect"})}finally{await Promise.all(re),Y.abort(Hse),i(N),N.pending.delete(Y)}},E=Zse(e,r);return{middleware:N=>V=>W=>{if(!S6(W))return V(W);if(G6.match(W))return m(W.payload);if(Yse.match(W)){E();return}if(Z6.match(W))return b(W.payload);let j=N.getState();const Y=()=>{if(j===jk)throw new Error(Cl(23));return j};let ce;try{if(ce=V(W),e.size>0){const re=N.getState(),ue=Array.from(e.values());for(const me of ue){let ge=!1;try{ge=me.predicate(W,re,j)}catch(Ce){ge=!1,Vk(c,Ce,{raisedBy:"predicate"})}ge&&w(me,W,N,Y)}}}finally{j=jk}return ce},startListening:m,stopListening:b,clearListeners:E}};function Cl(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var Qse={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},Y6=Go({name:"chartLayout",initialState:Qse,reducers:{setLayout(t,e){t.layoutType=e.payload},setChartSize(t,e){t.width=e.payload.width,t.height=e.payload.height},setMargin(t,e){var r,n,i,l;t.margin.top=(r=e.payload.top)!==null&&r!==void 0?r:0,t.margin.right=(n=e.payload.right)!==null&&n!==void 0?n:0,t.margin.bottom=(i=e.payload.bottom)!==null&&i!==void 0?i:0,t.margin.left=(l=e.payload.left)!==null&&l!==void 0?l:0},setScale(t,e){t.scale=e.payload}}}),{setMargin:Jse,setLayout:eae,setChartSize:tae,setScale:rae}=Y6.actions,nae=Y6.reducer;function K6(t,e,r){return Array.isArray(t)&&t&&e+r!==0?t.slice(e,r+1):t}function Br(t){return Number.isFinite(t)}function zh(t){return typeof t=="number"&&t>0&&Number.isFinite(t)}function $k(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function by(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$k(Object(r),!0).forEach(function(n){iae(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$k(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function iae(t,e,r){return(e=sae(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function sae(t){var e=aae(t,"string");return typeof e=="symbol"?e:e+""}function aae(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vs(t,e,r){return Vs(t)||Vs(e)?r:wc(e)?NT(t,e,r):typeof e=="function"?e(t):r}var oae=(t,e,r)=>{if(e&&r){var{width:n,height:i}=r,{align:l,verticalAlign:c,layout:s}=e;if((s==="vertical"||s==="horizontal"&&c==="middle")&&l!=="center"&&cr(t[l]))return by(by({},t),{},{[l]:t[l]+(n||0)});if((s==="horizontal"||s==="vertical"&&l==="center")&&c!=="middle"&&cr(t[c]))return by(by({},t),{},{[c]:t[c]+(i||0)})}return t},Ru=(t,e)=>t==="horizontal"&&e==="xAxis"||t==="vertical"&&e==="yAxis"||t==="centric"&&e==="angleAxis"||t==="radial"&&e==="radiusAxis",Q6=(t,e,r,n)=>{if(n)return t.map(s=>s.coordinate);var i,l,c=t.map(s=>(s.coordinate===e&&(i=!0),s.coordinate===r&&(l=!0),s.coordinate));return i||c.push(e),l||c.push(r),c},J6=(t,e,r)=>{if(!t)return null;var{duplicateDomain:n,type:i,range:l,scale:c,realScaleType:s,isCategorical:m,categoricalDomain:b,tickCount:w,ticks:E,niceTicks:O,axisType:N}=t;if(!c)return null;var V=s==="scaleBand"&&c.bandwidth?c.bandwidth()/2:2,W=i==="category"&&c.bandwidth?c.bandwidth()/V:0;if(W=N==="angleAxis"&&l&&l.length>=2?mc(l[0]-l[1])*2*W:W,E||O){var j=(E||O||[]).map((Y,ce)=>{var re=n?n.indexOf(Y):Y,ue=c.map(re);return Br(ue)?{coordinate:ue+W,value:Y,offset:W,index:ce}:null}).filter(Xo);return j}return m&&b?b.map((Y,ce)=>{var re=c.map(Y);return Br(re)?{coordinate:re+W,value:Y,index:ce,offset:W}:null}).filter(Xo):c.ticks&&w!=null?c.ticks(w).map((Y,ce)=>{var re=c.map(Y);return Br(re)?{coordinate:re+W,value:Y,index:ce,offset:W}:null}).filter(Xo):c.domain().map((Y,ce)=>{var re=c.map(Y);return Br(re)?{coordinate:re+W,value:n?n[Y]:Y,index:ce,offset:W}:null}).filter(Xo)},lae=t=>{var e,r=t.length;if(!(r<=0)){var n=(e=t[0])===null||e===void 0?void 0:e.length;if(!(n==null||n<=0))for(var i=0;i<n;++i)for(var l=0,c=0,s=0;s<r;++s){var m=t[s],b=m?.[i];if(b!=null){var w=b[1],E=b[0],O=Nh(w)?E:w;O>=0?(b[0]=l,l+=O,b[1]=l):(b[0]=c,c+=O,b[1]=c)}}}},cae=t=>{var e,r=t.length;if(!(r<=0)){var n=(e=t[0])===null||e===void 0?void 0:e.length;if(!(n==null||n<=0))for(var i=0;i<n;++i)for(var l=0,c=0;c<r;++c){var s=t[c],m=s?.[i];if(m!=null){var b=Nh(m[1])?m[0]:m[1];b>=0?(m[0]=l,l+=b,m[1]=l):(m[0]=0,m[1]=0)}}}},uae={sign:lae,expand:Bne,none:_m,silhouette:Fne,wiggle:jne,positive:cae},hae=(t,e,r)=>{var n,i=(n=uae[r])!==null&&n!==void 0?n:_m,l=zne().keys(e).value((s,m)=>Number(vs(s,m,0))).order(sP).offset(i),c=l(t);return c.forEach((s,m)=>{s.forEach((b,w)=>{var E=vs(t[w],e[m],0);Array.isArray(E)&&E.length===2&&cr(E[0])&&cr(E[1])&&(b[0]=E[0],b[1]=E[1])})}),c};function fae(t){return t==null?void 0:String(t)}function Ww(t){var{axis:e,ticks:r,bandSize:n,entry:i,index:l,dataKey:c}=t;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!Vs(i[e.dataKey])){var s=a6(r,"value",i[e.dataKey]);if(s)return s.coordinate+n/2}return r!=null&&r[l]?r[l].coordinate+n/2:null}var m=vs(i,Vs(c)?e.dataKey:c),b=e.scale.map(m);return cr(b)?b:null}var dae=t=>{var e=t.flat(2).filter(cr);return[Math.min(...e),Math.max(...e)]},pae=t=>[t[0]===1/0?0:t[0],t[1]===-1/0?0:t[1]],gae=(t,e,r)=>{if(t!=null)return pae(Object.keys(t).reduce((n,i)=>{var l=t[i];if(!l)return n;var{stackedData:c}=l,s=c.reduce((m,b)=>{var w=K6(b,e,r),E=dae(w);return!Br(E[0])||!Br(E[1])?m:[Math.min(m[0],E[0]),Math.max(m[1],E[1])]},[1/0,-1/0]);return[Math.min(s[0],n[0]),Math.max(s[1],n[1])]},[1/0,-1/0]))},Wk=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Hk=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Vy=(t,e,r)=>{if(t&&t.scale&&t.scale.bandwidth){var n=t.scale.bandwidth();if(!r||n>0)return n}if(t&&e&&e.length>=2){for(var i=zT(e,w=>w.coordinate),l=1/0,c=1,s=i.length;c<s;c++){var m=i[c],b=i[c-1];l=Math.min((m?.coordinate||0)-(b?.coordinate||0),l)}return l===1/0?0:l}return r?void 0:0};function qk(t){var{tooltipEntrySettings:e,dataKey:r,payload:n,value:i,name:l}=t;return by(by({},e),{},{dataKey:r,payload:n,value:i,name:l})}function XT(t,e){if(t)return String(t);if(typeof e=="string")return e}var mae=(t,e)=>{if(e==="horizontal")return t.chartX;if(e==="vertical")return t.chartY},_ae=(t,e)=>e==="centric"?t.angle:t.radius,cd=t=>t.layout.width,ud=t=>t.layout.height,yae=t=>t.layout.scale,ej=t=>t.layout.margin,GT=bt(t=>t.cartesianAxis.xAxis,t=>Object.values(t)),ZT=bt(t=>t.cartesianAxis.yAxis,t=>Object.values(t)),vae="data-recharts-item-index",bae="data-recharts-item-id",Mb=60;function Xk(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function y1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Xk(Object(r),!0).forEach(function(n){xae(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xk(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function xae(t,e,r){return(e=wae(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function wae(t){var e=Tae(t,"string");return typeof e=="symbol"?e:e+""}function Tae(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Sae=t=>t.brush.height;function Aae(t){var e=ZT(t);return e.reduce((r,n)=>{if(n.orientation==="left"&&!n.mirror&&!n.hide){var i=typeof n.width=="number"?n.width:Mb;return r+i}return r},0)}function Eae(t){var e=ZT(t);return e.reduce((r,n)=>{if(n.orientation==="right"&&!n.mirror&&!n.hide){var i=typeof n.width=="number"?n.width:Mb;return r+i}return r},0)}function Pae(t){var e=GT(t);return e.reduce((r,n)=>n.orientation==="top"&&!n.mirror&&!n.hide?r+n.height:r,0)}function Cae(t){var e=GT(t);return e.reduce((r,n)=>n.orientation==="bottom"&&!n.mirror&&!n.hide?r+n.height:r,0)}var xa=bt([cd,ud,ej,Sae,Aae,Eae,Pae,Cae,x6,tse],(t,e,r,n,i,l,c,s,m,b)=>{var w={left:(r.left||0)+i,right:(r.right||0)+l},E={top:(r.top||0)+c,bottom:(r.bottom||0)+s},O=y1(y1({},E),w),N=O.bottom;O.bottom+=n,O=oae(O,m,b);var V=t-O.left-O.right,W=e-O.top-O.bottom;return y1(y1({brushBottom:N},O),{},{width:Math.max(V,0),height:Math.max(W,0)})}),Mae=bt(xa,t=>({x:t.left,y:t.top,width:t.width,height:t.height})),tj=bt(cd,ud,(t,e)=>({x:0,y:0,width:t,height:e})),Iae=ee.createContext(null),wa=()=>ee.useContext(Iae)!=null,YT=t=>t.brush,KT=bt([YT,xa,ej],(t,e,r)=>({height:t.height,x:cr(t.x)?t.x:e.left,y:cr(t.y)?t.y:e.top+e.height+e.brushBottom-(r?.bottom||0),width:cr(t.width)?t.width:e.width})),jA={},UA={},VA={},Gk;function Rae(){return Gk||(Gk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n,{signal:i,edges:l}={}){let c,s=null;const m=l!=null&&l.includes("leading"),b=l==null||l.includes("trailing"),w=()=>{s!==null&&(r.apply(c,s),c=void 0,s=null)},E=()=>{b&&w(),W()};let O=null;const N=()=>{O!=null&&clearTimeout(O),O=setTimeout(()=>{O=null,E()},n)},V=()=>{O!==null&&(clearTimeout(O),O=null)},W=()=>{V(),c=void 0,s=null},j=()=>{w()},Y=function(...ce){if(i?.aborted)return;c=this,s=ce;const re=O==null;N(),m&&re&&w()};return Y.schedule=N,Y.cancel=W,Y.flush=j,i?.addEventListener("abort",W,{once:!0}),Y}t.debounce=e})(VA)),VA}var Zk;function Oae(){return Zk||(Zk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Rae();function r(n,i=0,l={}){typeof l!="object"&&(l={});const{leading:c=!1,trailing:s=!0,maxWait:m}=l,b=Array(2);c&&(b[0]="leading"),s&&(b[1]="trailing");let w,E=null;const O=e.debounce(function(...W){w=n.apply(this,W),E=null},i,{edges:b}),N=function(...W){return m!=null&&(E===null&&(E=Date.now()),Date.now()-E>=m)?(w=n.apply(this,W),E=Date.now(),O.cancel(),O.schedule(),w):(O.apply(this,W),w)},V=()=>(O.flush(),w);return N.cancel=O.cancel,N.flush=V,N}t.debounce=r})(UA)),UA}var Yk;function Dae(){return Yk||(Yk=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Oae();function r(n,i=0,l={}){const{leading:c=!0,trailing:s=!0}=l;return e.debounce(n,i,{leading:c,maxWait:i,trailing:s})}t.throttle=r})(jA)),jA}var $A,Kk;function kae(){return Kk||(Kk=1,$A=Dae().throttle),$A}var Lae=kae();const Nae=Fh(Lae);var Hw=function(e,r){for(var n=arguments.length,i=new Array(n>2?n-2:0),l=2;l<n;l++)i[l-2]=arguments[l];if(typeof console<"u"&&console.warn&&(r===void 0&&console.warn("LogUtils requires an error message argument"),!e))if(r===void 0)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=0;console.warn(r.replace(/%s/g,()=>i[c++]))}},Oh={width:"100%",height:"100%",debounce:0,minWidth:0,initialDimension:{width:-1,height:-1}},rj=(t,e,r)=>{var{width:n=Oh.width,height:i=Oh.height,aspect:l,maxHeight:c}=r,s=ym(n)?t:Number(n),m=ym(i)?e:Number(i);return l&&l>0&&(s?m=s/l:m&&(s=m*l),c&&m!=null&&m>c&&(m=c)),{calculatedWidth:s,calculatedHeight:m}},zae={width:0,height:0,overflow:"visible"},Bae={width:0,overflowX:"visible"},Fae={height:0,overflowY:"visible"},jae={},Uae=t=>{var{width:e,height:r}=t,n=ym(e),i=ym(r);return n&&i?zae:n?Bae:i?Fae:jae};function Vae(t){var{width:e,height:r,aspect:n}=t,i=e,l=r;return i===void 0&&l===void 0?(i=Oh.width,l=Oh.height):i===void 0?i=n&&n>0?void 0:Oh.width:l===void 0&&(l=n&&n>0?void 0:Oh.height),{width:i,height:l}}function _P(){return _P=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_P.apply(null,arguments)}function Qk(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Jk(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Qk(Object(r),!0).forEach(function(n){$ae(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qk(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function $ae(t,e,r){return(e=Wae(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Wae(t){var e=Hae(t,"string");return typeof e=="symbol"?e:e+""}function Hae(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var nj=ee.createContext(Oh.initialDimension);function qae(t){return zh(t.width)&&zh(t.height)}function ij(t){var{children:e,width:r,height:n}=t,i=ee.useMemo(()=>({width:r,height:n}),[r,n]);return qae(i)?ee.createElement(nj.Provider,{value:i},e):null}var N3=()=>ee.useContext(nj),Xae=ee.forwardRef((t,e)=>{var{aspect:r,initialDimension:n=Oh.initialDimension,width:i,height:l,minWidth:c=Oh.minWidth,minHeight:s,maxHeight:m,children:b,debounce:w=Oh.debounce,id:E,className:O,onResize:N,style:V={}}=t,W=ee.useRef(null),j=ee.useRef();j.current=N,ee.useImperativeHandle(e,()=>W.current);var[Y,ce]=ee.useState({containerWidth:n.width,containerHeight:n.height}),re=ee.useCallback((We,Xe)=>{ce(Et=>{var gt=Math.round(We),Ye=Math.round(Xe);return Et.containerWidth===gt&&Et.containerHeight===Ye?Et:{containerWidth:gt,containerHeight:Ye}})},[]);ee.useEffect(()=>{if(W.current==null||typeof ResizeObserver>"u")return Mm;var We=Ye=>{var jt,St=Ye[0];if(St!=null){var{width:Zt,height:fe}=St.contentRect;re(Zt,fe),(jt=j.current)===null||jt===void 0||jt.call(j,Zt,fe)}};w>0&&(We=Nae(We,w,{trailing:!0,leading:!1}));var Xe=new ResizeObserver(We),{width:Et,height:gt}=W.current.getBoundingClientRect();return re(Et,gt),Xe.observe(W.current),()=>{Xe.disconnect()}},[re,w]);var{containerWidth:ue,containerHeight:me}=Y;Hw(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:ge,calculatedHeight:Ce}=rj(ue,me,{width:i,height:l,aspect:r,maxHeight:m});return Hw(ge!=null&&ge>0||Ce!=null&&Ce>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ge,Ce,i,l,c,s,r),ee.createElement("div",{id:E?"".concat(E):void 0,className:Ln("recharts-responsive-container",O),style:Jk(Jk({},V),{},{width:i,height:l,minWidth:c,minHeight:s,maxHeight:m}),ref:W},ee.createElement("div",{style:Uae({width:i,height:l})},ee.createElement(ij,{width:ge,height:Ce},b)))}),sj=ee.forwardRef((t,e)=>{var r=N3();if(zh(r.width)&&zh(r.height))return t.children;var{width:n,height:i}=Vae({width:t.width,height:t.height,aspect:t.aspect}),{calculatedWidth:l,calculatedHeight:c}=rj(void 0,void 0,{width:n,height:i,aspect:t.aspect,maxHeight:t.maxHeight});return cr(l)&&cr(c)?ee.createElement(ij,{width:l,height:c},t.children):ee.createElement(Xae,_P({},t,{width:n,height:i,ref:e}))});function z3(t){if(t)return{x:t.x,y:t.y,upperWidth:"upperWidth"in t?t.upperWidth:t.width,lowerWidth:"lowerWidth"in t?t.lowerWidth:t.width,width:t.width,height:t.height}}var Ib=()=>{var t,e=wa(),r=mr(Mae),n=mr(KT),i=(t=mr(YT))===null||t===void 0?void 0:t.padding;return!e||!n||!i?r:{width:n.width-i.left-i.right,height:n.height-i.top-i.bottom,x:i.left,y:i.top}},Gae={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},aj=()=>{var t;return(t=mr(xa))!==null&&t!==void 0?t:Gae},oj=()=>mr(cd),lj=()=>mr(ud),ai=t=>t.layout.layoutType,Im=()=>mr(ai),B3=()=>{var t=Im();if(t==="horizontal"||t==="vertical")return t},cj=t=>{var e=t.layout.layoutType;if(e==="centric"||e==="radial")return e},Zae=()=>{var t=Im();return t!==void 0},Rb=t=>{var e=xs(),r=wa(),{width:n,height:i}=t,l=N3(),c=n,s=i;return l&&(c=l.width>0?l.width:n,s=l.height>0?l.height:i),ee.useEffect(()=>{!r&&zh(c)&&zh(s)&&e(tae({width:c,height:s}))},[e,r,c,s]),null},uj=Symbol.for("immer-nothing"),eL=Symbol.for("immer-draftable"),Il=Symbol.for("immer-state");function wu(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var sb=Object.getPrototypeOf;function $y(t){return!!t&&!!t[Il]}function bm(t){return t?hj(t)||Array.isArray(t)||!!t[eL]||!!t.constructor?.[eL]||Ob(t)||JT(t):!1}var Yae=Object.prototype.constructor.toString(),tL=new WeakMap;function hj(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);if(e===null||e===Object.prototype)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(r===Object)return!0;if(typeof r!="function")return!1;let n=tL.get(r);return n===void 0&&(n=Function.toString.call(r),tL.set(r,n)),n===Yae}function qw(t,e,r=!0){QT(t)===0?(r?Reflect.ownKeys(t):Object.keys(t)).forEach(i=>{e(i,t[i],t)}):t.forEach((n,i)=>e(i,n,t))}function QT(t){const e=t[Il];return e?e.type_:Array.isArray(t)?1:Ob(t)?2:JT(t)?3:0}function yP(t,e){return QT(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function fj(t,e,r){const n=QT(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function Kae(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function Ob(t){return t instanceof Map}function JT(t){return t instanceof Set}function qg(t){return t.copy_||t.base_}function vP(t,e){if(Ob(t))return new Map(t);if(JT(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=hj(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[Il];let i=Reflect.ownKeys(n);for(let l=0;l<i.length;l++){const c=i[l],s=n[c];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(n[c]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[c]})}return Object.create(sb(t),n)}else{const n=sb(t);if(n!==null&&r)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function F3(t,e=!1){return e2(t)||$y(t)||!bm(t)||(QT(t)>1&&Object.defineProperties(t,{set:v1,add:v1,clear:v1,delete:v1}),Object.freeze(t),e&&Object.values(t).forEach(r=>F3(r,!0))),t}function Qae(){wu(2)}var v1={value:Qae};function e2(t){return t===null||typeof t!="object"?!0:Object.isFrozen(t)}var Jae={};function xm(t){const e=Jae[t];return e||wu(0,t),e}var ab;function dj(){return ab}function eoe(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function rL(t,e){e&&(xm("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function bP(t){xP(t),t.drafts_.forEach(toe),t.drafts_=null}function xP(t){t===ab&&(ab=t.parent_)}function nL(t){return ab=eoe(ab,t)}function toe(t){const e=t[Il];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function iL(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[Il].modified_&&(bP(e),wu(4)),bm(t)&&(t=Xw(e,t),e.parent_||Gw(e,t)),e.patches_&&xm("Patches").generateReplacementPatches_(r[Il].base_,t,e.patches_,e.inversePatches_)):t=Xw(e,r,[]),bP(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==uj?t:void 0}function Xw(t,e,r){if(e2(e))return e;const n=t.immer_.shouldUseStrictIteration(),i=e[Il];if(!i)return qw(e,(l,c)=>sL(t,i,e,l,c,r),n),e;if(i.scope_!==t)return e;if(!i.modified_)return Gw(t,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const l=i.copy_;let c=l,s=!1;i.type_===3&&(c=new Set(l),l.clear(),s=!0),qw(c,(m,b)=>sL(t,i,l,m,b,r,s),n),Gw(t,l,!1),r&&t.patches_&&xm("Patches").generatePatches_(i,r,t.patches_,t.inversePatches_)}return i.copy_}function sL(t,e,r,n,i,l,c){if(i==null||typeof i!="object"&&!c)return;const s=e2(i);if(!(s&&!c)){if($y(i)){const m=l&&e&&e.type_!==3&&!yP(e.assigned_,n)?l.concat(n):void 0,b=Xw(t,i,m);if(fj(r,n,b),$y(b))t.canAutoFreeze_=!1;else return}else c&&r.add(i);if(bm(i)&&!s){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1||e&&e.base_&&e.base_[n]===i&&s)return;Xw(t,i),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&(Ob(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))&&Gw(t,i)}}}function Gw(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&F3(e,r)}function roe(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:dj(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,l=j3;r&&(i=[n],l=ob);const{revoke:c,proxy:s}=Proxy.revocable(i,l);return n.draft_=s,n.revoke_=c,s}var j3={get(t,e){if(e===Il)return t;const r=qg(t);if(!yP(r,e))return noe(t,r,e);const n=r[e];return t.finalized_||!bm(n)?n:n===WA(t.base_,e)?(HA(t),t.copy_[e]=TP(n,t)):n},has(t,e){return e in qg(t)},ownKeys(t){return Reflect.ownKeys(qg(t))},set(t,e,r){const n=pj(qg(t),e);if(n?.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const i=WA(qg(t),e),l=i?.[Il];if(l&&l.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(Kae(r,i)&&(r!==void 0||yP(t.base_,e)))return!0;HA(t),wP(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return WA(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,HA(t),wP(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=qg(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){wu(11)},getPrototypeOf(t){return sb(t.base_)},setPrototypeOf(){wu(12)}},ob={};qw(j3,(t,e)=>{ob[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});ob.deleteProperty=function(t,e){return ob.set.call(this,t,e,void 0)};ob.set=function(t,e,r){return j3.set.call(this,t[0],e,r,t[0])};function WA(t,e){const r=t[Il];return(r?qg(r):t)[e]}function noe(t,e,r){const n=pj(e,r);return n?"value"in n?n.value:n.get?.call(t.draft_):void 0}function pj(t,e){if(!(e in t))return;let r=sb(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=sb(r)}}function wP(t){t.modified_||(t.modified_=!0,t.parent_&&wP(t.parent_))}function HA(t){t.copy_||(t.copy_=vP(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var ioe=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const l=r;r=e;const c=this;return function(m=l,...b){return c.produce(m,w=>r.call(this,w,...b))}}typeof r!="function"&&wu(6),n!==void 0&&typeof n!="function"&&wu(7);let i;if(bm(e)){const l=nL(this),c=TP(e,void 0);let s=!0;try{i=r(c),s=!1}finally{s?bP(l):xP(l)}return rL(l,n),iL(i,l)}else if(!e||typeof e!="object"){if(i=r(e),i===void 0&&(i=e),i===uj&&(i=void 0),this.autoFreeze_&&F3(i,!0),n){const l=[],c=[];xm("Patches").generateReplacementPatches_(e,i,l,c),n(l,c)}return i}else wu(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(c,...s)=>this.produceWithPatches(c,m=>e(m,...s));let n,i;return[this.produce(e,r,(c,s)=>{n=c,i=s}),n,i]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),typeof t?.useStrictIteration=="boolean"&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){bm(t)||wu(8),$y(t)&&(t=soe(t));const e=nL(this),r=TP(t,void 0);return r[Il].isManual_=!0,xP(e),r}finishDraft(t,e){const r=t&&t[Il];(!r||!r.isManual_)&&wu(9);const{scope_:n}=r;return rL(n,e),iL(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const i=e[r];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}r>-1&&(e=e.slice(r+1));const n=xm("Patches").applyPatches_;return $y(t)?n(t,e):this.produce(t,i=>n(i,e))}};function TP(t,e){const r=Ob(t)?xm("MapSet").proxyMap_(t,e):JT(t)?xm("MapSet").proxySet_(t,e):roe(t,e);return(e?e.scope_:dj()).drafts_.push(r),r}function soe(t){return $y(t)||wu(10,t),gj(t)}function gj(t){if(!bm(t)||e2(t))return t;const e=t[Il];let r,n=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=vP(t,e.scope_.immer_.useStrictShallowCopy_),n=e.scope_.immer_.shouldUseStrictIteration()}else r=vP(t,!0);return qw(r,(i,l)=>{fj(r,i,gj(l))},n),e&&(e.finalized_=!1),r}var aoe=new ioe;aoe.produce;var ooe={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},mj=Go({name:"legend",initialState:ooe,reducers:{setLegendSize(t,e){t.size.width=e.payload.width,t.size.height=e.payload.height},setLegendSettings(t,e){t.settings.align=e.payload.align,t.settings.layout=e.payload.layout,t.settings.verticalAlign=e.payload.verticalAlign,t.settings.itemSorter=e.payload.itemSorter},addLegendPayload:{reducer(t,e){t.payload.push(e.payload)},prepare:mi()},replaceLegendPayload:{reducer(t,e){var{prev:r,next:n}=e.payload,i=Eu(t).payload.indexOf(r);i>-1&&(t.payload[i]=n)},prepare:mi()},removeLegendPayload:{reducer(t,e){var r=Eu(t).payload.indexOf(e.payload);r>-1&&t.payload.splice(r,1)},prepare:mi()}}}),{setLegendSize:Bye,setLegendSettings:Fye,addLegendPayload:loe,replaceLegendPayload:coe,removeLegendPayload:uoe}=mj.actions,hoe=mj.reducer;function SP(){return SP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},SP.apply(null,arguments)}function aL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function g0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?aL(Object(r),!0).forEach(function(n){foe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):aL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function foe(t,e,r){return(e=doe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function doe(t){var e=poe(t,"string");return typeof e=="symbol"?e:e+""}function poe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function goe(t){return Array.isArray(t)&&wc(t[0])&&wc(t[1])?t.join(" ~ "):t}var ly={separator:" : ",contentStyle:{margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},itemStyle:{display:"block",paddingTop:4,paddingBottom:4,color:"#000"},labelStyle:{},accessibilityLayer:!1},moe=t=>{var{separator:e=ly.separator,contentStyle:r,itemStyle:n,labelStyle:i=ly.labelStyle,payload:l,formatter:c,itemSorter:s,wrapperClassName:m,labelClassName:b,label:w,labelFormatter:E,accessibilityLayer:O=ly.accessibilityLayer}=t,N=()=>{if(l&&l.length){var me={padding:0,margin:0},ge=(s?zT(l,s):l).map((Ce,We)=>{if(Ce.type==="none")return null;var Xe=Ce.formatter||c||goe,{value:Et,name:gt}=Ce,Ye=Et,jt=gt;if(Xe){var St=Xe(Et,gt,Ce,We,l);if(Array.isArray(St))[Ye,jt]=St;else if(St!=null)Ye=St;else return null}var Zt=g0(g0({},ly.itemStyle),{},{color:Ce.color||ly.itemStyle.color},n);return ee.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(We),style:Zt},wc(jt)?ee.createElement("span",{className:"recharts-tooltip-item-name"},jt):null,wc(jt)?ee.createElement("span",{className:"recharts-tooltip-item-separator"},e):null,ee.createElement("span",{className:"recharts-tooltip-item-value"},Ye),ee.createElement("span",{className:"recharts-tooltip-item-unit"},Ce.unit||""))});return ee.createElement("ul",{className:"recharts-tooltip-item-list",style:me},ge)}return null},V=g0(g0({},ly.contentStyle),r),W=g0({margin:0},i),j=!Vs(w),Y=j?w:"",ce=Ln("recharts-default-tooltip",m),re=Ln("recharts-tooltip-label",b);j&&E&&l!==void 0&&l!==null&&(Y=E(w,l));var ue=O?{role:"status","aria-live":"assertive"}:{};return ee.createElement("div",SP({className:ce,style:V},ue),ee.createElement("p",{className:re,style:W},ee.isValidElement(Y)?Y:"".concat(Y)),N())},m0="recharts-tooltip-wrapper",_oe={visibility:"hidden"};function yoe(t){var{coordinate:e,translateX:r,translateY:n}=t;return Ln(m0,{["".concat(m0,"-right")]:cr(r)&&e&&cr(e.x)&&r>=e.x,["".concat(m0,"-left")]:cr(r)&&e&&cr(e.x)&&r<e.x,["".concat(m0,"-bottom")]:cr(n)&&e&&cr(e.y)&&n>=e.y,["".concat(m0,"-top")]:cr(n)&&e&&cr(e.y)&&n<e.y})}function oL(t){var{allowEscapeViewBox:e,coordinate:r,key:n,offset:i,position:l,reverseDirection:c,tooltipDimension:s,viewBox:m,viewBoxDimension:b}=t;if(l&&cr(l[n]))return l[n];var w=r[n]-s-(i>0?i:0),E=r[n]+i;if(e[n])return c[n]?w:E;var O=m[n];if(O==null)return 0;if(c[n]){var N=w,V=O;return N<V?Math.max(E,O):Math.max(w,O)}if(b==null)return 0;var W=E+s,j=O+b;return W>j?Math.max(w,O):Math.max(E,O)}function voe(t){var{translateX:e,translateY:r,useTranslate3d:n}=t;return{transform:n?"translate3d(".concat(e,"px, ").concat(r,"px, 0)"):"translate(".concat(e,"px, ").concat(r,"px)")}}function boe(t){var{allowEscapeViewBox:e,coordinate:r,offsetTop:n,offsetLeft:i,position:l,reverseDirection:c,tooltipBox:s,useTranslate3d:m,viewBox:b}=t,w,E,O;return s.height>0&&s.width>0&&r?(E=oL({allowEscapeViewBox:e,coordinate:r,key:"x",offset:i,position:l,reverseDirection:c,tooltipDimension:s.width,viewBox:b,viewBoxDimension:b.width}),O=oL({allowEscapeViewBox:e,coordinate:r,key:"y",offset:n,position:l,reverseDirection:c,tooltipDimension:s.height,viewBox:b,viewBoxDimension:b.height}),w=voe({translateX:E,translateY:O,useTranslate3d:m})):w=_oe,{cssProperties:w,cssClasses:yoe({translateX:E,translateY:O,coordinate:r})}}function lL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function b1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?lL(Object(r),!0).forEach(function(n){AP(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):lL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function AP(t,e,r){return(e=xoe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function xoe(t){var e=woe(t,"string");return typeof e=="symbol"?e:e+""}function woe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Toe extends ee.PureComponent{constructor(){super(...arguments),AP(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),AP(this,"handleKeyDown",e=>{if(e.key==="Escape"){var r,n,i,l;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(r=(n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==null&&r!==void 0?r:0,y:(i=(l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==null&&i!==void 0?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,r;this.state.dismissed&&(((e=this.props.coordinate)===null||e===void 0?void 0:e.x)!==this.state.dismissedAtCoordinate.x||((r=this.props.coordinate)===null||r===void 0?void 0:r.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:r,animationDuration:n,animationEasing:i,children:l,coordinate:c,hasPayload:s,isAnimationActive:m,offset:b,position:w,reverseDirection:E,useTranslate3d:O,viewBox:N,wrapperStyle:V,lastBoundingBox:W,innerRef:j,hasPortalFromProps:Y}=this.props,ce=typeof b=="number"?b:b.x,re=typeof b=="number"?b:b.y,{cssClasses:ue,cssProperties:me}=boe({allowEscapeViewBox:r,coordinate:c,offsetLeft:ce,offsetTop:re,position:w,reverseDirection:E,tooltipBox:{height:W.height,width:W.width},useTranslate3d:O,viewBox:N}),ge=Y?{}:b1(b1({transition:m&&e?"transform ".concat(n,"ms ").concat(i):void 0},me),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&s?"visible":"hidden",position:"absolute",top:0,left:0}),Ce=b1(b1({},ge),{},{visibility:!this.state.dismissed&&e&&s?"visible":"hidden"},V);return ee.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:ue,style:Ce,ref:j},l)}}var _j=()=>{var t;return(t=mr(e=>e.rootProps.accessibilityLayer))!==null&&t!==void 0?t:!0};function EP(){return EP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},EP.apply(null,arguments)}function cL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function uL(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cL(Object(r),!0).forEach(function(n){Soe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Soe(t,e,r){return(e=Aoe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Aoe(t){var e=Eoe(t,"string");return typeof e=="symbol"?e:e+""}function Eoe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var hL={curveBasisClosed:Ene,curveBasisOpen:Pne,curveBasis:Ane,curveBumpX:hne,curveBumpY:fne,curveLinearClosed:Cne,curveLinear:kT,curveMonotoneX:Mne,curveMonotoneY:Ine,curveNatural:Rne,curveStep:One,curveStepAfter:kne,curveStepBefore:Dne},Zw=t=>Br(t.x)&&Br(t.y),fL=t=>t.base!=null&&Zw(t.base)&&Zw(t),_0=t=>t.x,y0=t=>t.y,Poe=(t,e)=>{if(typeof t=="function")return t;var r="curve".concat(Eb(t));if((r==="curveMonotone"||r==="curveBump")&&e){var n=hL["".concat(r).concat(e==="vertical"?"Y":"X")];if(n)return n}return hL[r]||kT},dL={connectNulls:!1,type:"linear"},Coe=t=>{var{type:e=dL.type,points:r=[],baseLine:n,layout:i,connectNulls:l=dL.connectNulls}=t,c=Poe(e,i),s=l?r.filter(Zw):r;if(Array.isArray(n)){var m,b=r.map((V,W)=>uL(uL({},V),{},{base:n[W]}));i==="vertical"?m=f1().y(y0).x1(_0).x0(V=>V.base.x):m=f1().x(_0).y1(y0).y0(V=>V.base.y);var w=m.defined(fL).curve(c),E=l?b.filter(fL):b;return w(E)}var O;i==="vertical"&&cr(n)?O=f1().y(y0).x1(_0).x0(n):cr(n)?O=f1().x(_0).y1(y0).y0(n):O=XF().x(_0).y(y0);var N=O.defined(Zw).curve(c);return N(s)},F0=t=>{var{className:e,points:r,path:n,pathRef:i}=t,l=Im();if((!r||!r.length)&&!n)return null;var c={type:t.type,points:t.points,baseLine:t.baseLine,layout:t.layout||l,connectNulls:t.connectNulls},s=r&&r.length?Coe(c):n;return ee.createElement("path",EP({},xc(t),E3(t),{className:Ln("recharts-curve",e),d:s===null?void 0:s,ref:i}))},Moe=["x","y","top","left","width","height","className"];function PP(){return PP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},PP.apply(null,arguments)}function pL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ioe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?pL(Object(r),!0).forEach(function(n){Roe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Roe(t,e,r){return(e=Ooe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ooe(t){var e=Doe(t,"string");return typeof e=="symbol"?e:e+""}function Doe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function koe(t,e){if(t==null)return{};var r,n,i=Loe(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Loe(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Noe=(t,e,r,n,i,l)=>"M".concat(t,",").concat(i,"v").concat(n,"M").concat(l,",").concat(e,"h").concat(r),zoe=t=>{var{x:e=0,y:r=0,top:n=0,left:i=0,width:l=0,height:c=0,className:s}=t,m=koe(t,Moe),b=Ioe({x:e,y:r,top:n,left:i,width:l,height:c},m);return!cr(e)||!cr(r)||!cr(l)||!cr(c)||!cr(n)||!cr(i)?null:ee.createElement("path",PP({},va(b),{className:Ln("recharts-cross",s),d:Noe(e,r,l,c,n,i)}))};function Boe(t,e,r,n){var i=n/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-i:r.left+.5,y:t==="horizontal"?r.top+.5:e.y-i,width:t==="horizontal"?n:r.width-1,height:t==="horizontal"?r.height-1:n}}function gL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function mL(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?gL(Object(r),!0).forEach(function(n){Foe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Foe(t,e,r){return(e=joe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function joe(t){var e=Uoe(t,"string");return typeof e=="symbol"?e:e+""}function Uoe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Voe=t=>t.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())),yj=(t,e,r)=>t.map(n=>"".concat(Voe(n)," ").concat(e,"ms ").concat(r)).join(","),$oe=(t,e)=>[Object.keys(t),Object.keys(e)].reduce((r,n)=>r.filter(i=>n.includes(i))),lb=(t,e)=>Object.keys(e).reduce((r,n)=>mL(mL({},r),{},{[n]:t(n,e[n])}),{});function _L(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function _s(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_L(Object(r),!0).forEach(function(n){Woe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_L(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Woe(t,e,r){return(e=Hoe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Hoe(t){var e=qoe(t,"string");return typeof e=="symbol"?e:e+""}function qoe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Yw=(t,e,r)=>t+(e-t)*r,CP=t=>{var{from:e,to:r}=t;return e!==r},vj=(t,e,r)=>{var n=lb((i,l)=>{if(CP(l)){var[c,s]=t(l.from,l.to,l.velocity);return _s(_s({},l),{},{from:c,velocity:s})}return l},e);return r<1?lb((i,l)=>CP(l)&&n[i]!=null?_s(_s({},l),{},{velocity:Yw(l.velocity,n[i].velocity,r),from:Yw(l.from,n[i].from,r)}):l,e):vj(t,n,r-1)};function Xoe(t,e,r,n,i,l){var c,s=n.reduce((O,N)=>_s(_s({},O),{},{[N]:{from:t[N],velocity:0,to:e[N]}}),{}),m=()=>lb((O,N)=>N.from,s),b=()=>!Object.values(s).filter(CP).length,w=null,E=O=>{c||(c=O);var N=O-c,V=N/r.dt;s=vj(r,s,V),i(_s(_s(_s({},t),e),m())),c=O,b()||(w=l.setTimeout(E))};return()=>(w=l.setTimeout(E),()=>{var O;(O=w)===null||O===void 0||O()})}function Goe(t,e,r,n,i,l,c){var s=null,m=i.reduce((E,O)=>{var N=t[O],V=e[O];return N==null||V==null?E:_s(_s({},E),{},{[O]:[N,V]})},{}),b,w=E=>{b||(b=E);var O=(E-b)/n,N=lb((W,j)=>Yw(...j,r(O)),m);if(l(_s(_s(_s({},t),e),N)),O<1)s=c.setTimeout(w);else{var V=lb((W,j)=>Yw(...j,r(1)),m);l(_s(_s(_s({},t),e),V))}};return()=>(s=c.setTimeout(w),()=>{var E;(E=s)===null||E===void 0||E()})}const Zoe=(t,e,r,n,i,l)=>{var c=$oe(t,e);return r==null?()=>(i(_s(_s({},t),e)),()=>{}):r.isStepper===!0?Xoe(t,e,r,c,i,l):Goe(t,e,r,n,c,i,l)};var Kw=1e-4,bj=(t,e)=>[0,3*t,3*e-6*t,3*t-3*e+1],xj=(t,e)=>t.map((r,n)=>r*e**n).reduce((r,n)=>r+n),yL=(t,e)=>r=>{var n=bj(t,e);return xj(n,r)},Yoe=(t,e)=>r=>{var n=bj(t,e),i=[...n.map((l,c)=>l*c).slice(1),0];return xj(i,r)},Koe=t=>{var e,r=t.split("(");if(r.length!==2||r[0]!=="cubic-bezier")return null;var n=(e=r[1])===null||e===void 0||(e=e.split(")")[0])===null||e===void 0?void 0:e.split(",");if(n==null||n.length!==4)return null;var i=n.map(l=>parseFloat(l));return[i[0],i[1],i[2],i[3]]},Qoe=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(r.length===1)switch(r[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:{var i=Koe(r[0]);if(i)return i}}return r.length===4?r:[0,0,1,1]},Joe=(t,e,r,n)=>{var i=yL(t,r),l=yL(e,n),c=Yoe(t,r),s=b=>b>1?1:b<0?0:b,m=b=>{for(var w=b>1?1:b,E=w,O=0;O<8;++O){var N=i(E)-w,V=c(E);if(Math.abs(N-w)<Kw||V<Kw)return l(E);E=s(E-N/V)}return l(E)};return m.isStepper=!1,m},vL=function(){return Joe(...Qoe(...arguments))},ele=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:r=100,damping:n=8,dt:i=17}=e,l=(c,s,m)=>{var b=-(c-s)*r,w=m*n,E=m+(b-w)*i/1e3,O=m*i/1e3+c;return Math.abs(O-s)<Kw&&Math.abs(E)<Kw?[s,0]:[O,E]};return l.isStepper=!0,l.dt=i,l},tle=t=>{if(typeof t=="string")switch(t){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return vL(t);case"spring":return ele();default:if(t.split("(")[0]==="cubic-bezier")return vL(t)}return typeof t=="function"?t:null};function rle(t){var e,r=()=>null,n=!1,i=null,l=c=>{if(!n){if(Array.isArray(c)){if(!c.length)return;var s=c,[m,...b]=s;if(typeof m=="number"){i=t.setTimeout(l.bind(null,b),m);return}l(m),i=t.setTimeout(l.bind(null,b));return}typeof c=="string"&&(e=c,r(e)),typeof c=="object"&&(e=c,r(e)),typeof c=="function"&&c()}};return{stop:()=>{n=!0},start:c=>{n=!1,i&&(i(),i=null),l(c)},subscribe:c=>(r=c,()=>{r=()=>null}),getTimeoutController:()=>t}}class nle{setTimeout(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=performance.now(),i=null,l=c=>{c-n>=r?e(c):typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(l))};return i=requestAnimationFrame(l),()=>{i!=null&&cancelAnimationFrame(i)}}}function ile(){return rle(new nle)}var sle=ee.createContext(ile);function ale(t,e){var r=ee.useContext(sle);return ee.useMemo(()=>e??r(t),[t,e,r])}var ole=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),Db={isSsr:ole()},lle={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},bL={t:0},qA={t:1};function t2(t){var e=ba(t,lle),{isActive:r,canBegin:n,duration:i,easing:l,begin:c,onAnimationEnd:s,onAnimationStart:m,children:b}=e,w=r==="auto"?!Db.isSsr:r,E=ale(e.animationId,e.animationManager),[O,N]=ee.useState(w?bL:qA),V=ee.useRef(null);return ee.useEffect(()=>{w||N(qA)},[w]),ee.useEffect(()=>{if(!w||!n)return Mm;var W=Zoe(bL,qA,tle(l),i,N,E.getTimeoutController()),j=()=>{V.current=W()};return E.start([m,c,j,i,s]),()=>{E.stop(),V.current&&V.current(),s()}},[w,n,i,l,c,m,s,E]),b(O.t)}function r2(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",r=ee.useRef(tb(e)),n=ee.useRef(t);return n.current!==t&&(r.current=tb(e),n.current=t),r.current}var cle=["radius"],ule=["radius"],xL,wL,TL,SL,AL,EL,PL,CL,ML,IL;function RL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function OL(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?RL(Object(r),!0).forEach(function(n){hle(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):RL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function hle(t,e,r){return(e=fle(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fle(t){var e=dle(t,"string");return typeof e=="symbol"?e:e+""}function dle(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Qw(){return Qw=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Qw.apply(null,arguments)}function DL(t,e){if(t==null)return{};var r,n,i=ple(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ple(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function Th(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var kL=(t,e,r,n,i)=>{var l=xp(r),c=xp(n),s=Math.min(Math.abs(l)/2,Math.abs(c)/2),m=c>=0?1:-1,b=l>=0?1:-1,w=c>=0&&l>=0||c<0&&l<0?1:0,E;if(s>0&&Array.isArray(i)){for(var O=[0,0,0,0],N=0,V=4;N<V;N++){var W,j=(W=i[N])!==null&&W!==void 0?W:0;O[N]=j>s?s:j}E=ji(xL||(xL=Th(["M",",",""])),t,e+m*O[0]),O[0]>0&&(E+=ji(wL||(wL=Th(["A ",",",",0,0,",",",",",""])),O[0],O[0],w,t+b*O[0],e)),E+=ji(TL||(TL=Th(["L ",",",""])),t+r-b*O[1],e),O[1]>0&&(E+=ji(SL||(SL=Th(["A ",",",",0,0,",`,
        `,",",""])),O[1],O[1],w,t+r,e+m*O[1])),E+=ji(AL||(AL=Th(["L ",",",""])),t+r,e+n-m*O[2]),O[2]>0&&(E+=ji(EL||(EL=Th(["A ",",",",0,0,",`,
        `,",",""])),O[2],O[2],w,t+r-b*O[2],e+n)),E+=ji(PL||(PL=Th(["L ",",",""])),t+b*O[3],e+n),O[3]>0&&(E+=ji(CL||(CL=Th(["A ",",",",0,0,",`,
        `,",",""])),O[3],O[3],w,t,e+n-m*O[3])),E+="Z"}else if(s>0&&i===+i&&i>0){var Y=Math.min(s,i);E=ji(ML||(ML=Th(["M ",",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",","," Z"])),t,e+m*Y,Y,Y,w,t+b*Y,e,t+r-b*Y,e,Y,Y,w,t+r,e+m*Y,t+r,e+n-m*Y,Y,Y,w,t+r-b*Y,e+n,t+b*Y,e+n,Y,Y,w,t,e+n-m*Y)}else E=ji(IL||(IL=Th(["M ",","," h "," v "," h "," Z"])),t,e,r,n,-r);return E},LL={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},wj=t=>{var e=ba(t,LL),r=ee.useRef(null),[n,i]=ee.useState(-1);ee.useEffect(()=>{if(r.current&&r.current.getTotalLength)try{var Me=r.current.getTotalLength();Me&&i(Me)}catch{}},[]);var{x:l,y:c,width:s,height:m,radius:b,className:w}=e,{animationEasing:E,animationDuration:O,animationBegin:N,isAnimationActive:V,isUpdateAnimationActive:W}=e,j=ee.useRef(s),Y=ee.useRef(m),ce=ee.useRef(l),re=ee.useRef(c),ue=ee.useMemo(()=>({x:l,y:c,width:s,height:m,radius:b}),[l,c,s,m,b]),me=r2(ue,"rectangle-");if(l!==+l||c!==+c||s!==+s||m!==+m||s===0||m===0)return null;var ge=Ln("recharts-rectangle",w);if(!W){var Ce=va(e),{radius:We}=Ce,Xe=DL(Ce,cle);return ee.createElement("path",Qw({},Xe,{x:xp(l),y:xp(c),width:xp(s),height:xp(m),radius:typeof b=="number"?b:void 0,className:ge,d:kL(l,c,s,m,b)}))}var Et=j.current,gt=Y.current,Ye=ce.current,jt=re.current,St="0px ".concat(n===-1?1:n,"px"),Zt="".concat(n,"px 0px"),fe=yj(["strokeDasharray"],O,typeof E=="string"?E:LL.animationEasing);return ee.createElement(t2,{animationId:me,key:me,canBegin:n>0,duration:O,easing:E,isActive:W,begin:N},Me=>{var Ee=rs(Et,s,Me),Ue=rs(gt,m,Me),st=rs(Ye,l,Me),ye=rs(jt,c,Me);r.current&&(j.current=Ee,Y.current=Ue,ce.current=st,re.current=ye);var Be;V?Me>0?Be={transition:fe,strokeDasharray:Zt}:Be={strokeDasharray:St}:Be={strokeDasharray:Zt};var lt=va(e),{radius:Tt}=lt,zt=DL(lt,ule);return ee.createElement("path",Qw({},zt,{radius:typeof b=="number"?b:void 0,className:ge,d:kL(st,ye,Ee,Ue,b),ref:r,style:OL(OL({},Be),e.style)}))})};function NL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zL(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?NL(Object(r),!0).forEach(function(n){gle(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):NL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function gle(t,e,r){return(e=mle(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mle(t){var e=_le(t,"string");return typeof e=="symbol"?e:e+""}function _le(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Jw=Math.PI/180,yle=t=>t*180/Math.PI,_a=(t,e,r,n)=>({x:t+Math.cos(-Jw*n)*r,y:e+Math.sin(-Jw*n)*r}),vle=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},ble=(t,e)=>{var{x:r,y:n}=t,{x:i,y:l}=e;return Math.sqrt((r-i)**2+(n-l)**2)},xle=(t,e)=>{var{x:r,y:n}=t,{cx:i,cy:l}=e,c=ble({x:r,y:n},{x:i,y:l});if(c<=0)return{radius:c,angle:0};var s=(r-i)/c,m=Math.acos(s);return n>l&&(m=2*Math.PI-m),{radius:c,angle:yle(m),angleInRadian:m}},wle=t=>{var{startAngle:e,endAngle:r}=t,n=Math.floor(e/360),i=Math.floor(r/360),l=Math.min(n,i);return{startAngle:e-l*360,endAngle:r-l*360}},Tle=(t,e)=>{var{startAngle:r,endAngle:n}=e,i=Math.floor(r/360),l=Math.floor(n/360),c=Math.min(i,l);return t+c*360},Sle=(t,e)=>{var{chartX:r,chartY:n}=t,{radius:i,angle:l}=xle({x:r,y:n},e),{innerRadius:c,outerRadius:s}=e;if(i<c||i>s||i===0)return null;var{startAngle:m,endAngle:b}=wle(e),w=l,E;if(m<=b){for(;w>b;)w-=360;for(;w<m;)w+=360;E=w>=m&&w<=b}else{for(;w>m;)w-=360;for(;w<b;)w+=360;E=w>=b&&w<=m}return E?zL(zL({},e),{},{radius:i,angle:Tle(w,e)}):null};function Tj(t){var{cx:e,cy:r,radius:n,startAngle:i,endAngle:l}=t,c=_a(e,r,n,i),s=_a(e,r,n,l);return{points:[c,s],cx:e,cy:r,radius:n,startAngle:i,endAngle:l}}var BL,FL,jL,UL,VL,$L,WL;function MP(){return MP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},MP.apply(null,arguments)}function em(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var Ale=(t,e)=>{var r=mc(e-t),n=Math.min(Math.abs(e-t),359.999);return r*n},x1=t=>{var{cx:e,cy:r,radius:n,angle:i,sign:l,isExternal:c,cornerRadius:s,cornerIsExternal:m}=t,b=s*(c?1:-1)+n,w=Math.asin(s/b)/Jw,E=m?i:i+l*w,O=_a(e,r,b,E),N=_a(e,r,n,E),V=m?i-l*w:i,W=_a(e,r,b*Math.cos(w*Jw),V);return{center:O,circleTangency:N,lineTangency:W,theta:w}},Sj=t=>{var{cx:e,cy:r,innerRadius:n,outerRadius:i,startAngle:l,endAngle:c}=t,s=Ale(l,c),m=l+s,b=_a(e,r,i,l),w=_a(e,r,i,m),E=ji(BL||(BL=em(["M ",",",`
    A `,",",`,0,
    `,",",`,
    `,",",`
  `])),b.x,b.y,i,i,+(Math.abs(s)>180),+(l>m),w.x,w.y);if(n>0){var O=_a(e,r,n,l),N=_a(e,r,n,m);E+=ji(FL||(FL=em(["L ",",",`
            A `,",",`,0,
            `,",",`,
            `,","," Z"])),N.x,N.y,n,n,+(Math.abs(s)>180),+(l<=m),O.x,O.y)}else E+=ji(jL||(jL=em(["L ",","," Z"])),e,r);return E},Ele=t=>{var{cx:e,cy:r,innerRadius:n,outerRadius:i,cornerRadius:l,forceCornerRadius:c,cornerIsExternal:s,startAngle:m,endAngle:b}=t,w=mc(b-m),{circleTangency:E,lineTangency:O,theta:N}=x1({cx:e,cy:r,radius:i,angle:m,sign:w,cornerRadius:l,cornerIsExternal:s}),{circleTangency:V,lineTangency:W,theta:j}=x1({cx:e,cy:r,radius:i,angle:b,sign:-w,cornerRadius:l,cornerIsExternal:s}),Y=s?Math.abs(m-b):Math.abs(m-b)-N-j;if(Y<0)return c?ji(UL||(UL=em(["M ",",",`
        a`,",",",0,0,1,",`,0
        a`,",",",0,0,1,",`,0
      `])),O.x,O.y,l,l,l*2,l,l,-l*2):Sj({cx:e,cy:r,innerRadius:n,outerRadius:i,startAngle:m,endAngle:b});var ce=ji(VL||(VL=em(["M ",",",`
    A`,",",",0,0,",",",",",`
    A`,",",",0,",",",",",",",`
    A`,",",",0,0,",",",",",`
  `])),O.x,O.y,l,l,+(w<0),E.x,E.y,i,i,+(Y>180),+(w<0),V.x,V.y,l,l,+(w<0),W.x,W.y);if(n>0){var{circleTangency:re,lineTangency:ue,theta:me}=x1({cx:e,cy:r,radius:n,angle:m,sign:w,isExternal:!0,cornerRadius:l,cornerIsExternal:s}),{circleTangency:ge,lineTangency:Ce,theta:We}=x1({cx:e,cy:r,radius:n,angle:b,sign:-w,isExternal:!0,cornerRadius:l,cornerIsExternal:s}),Xe=s?Math.abs(m-b):Math.abs(m-b)-me-We;if(Xe<0&&l===0)return"".concat(ce,"L").concat(e,",").concat(r,"Z");ce+=ji($L||($L=em(["L",",",`
      A`,",",",0,0,",",",",",`
      A`,",",",0,",",",",",",",`
      A`,",",",0,0,",",",",","Z"])),Ce.x,Ce.y,l,l,+(w<0),ge.x,ge.y,n,n,+(Xe>180),+(w>0),re.x,re.y,l,l,+(w<0),ue.x,ue.y)}else ce+=ji(WL||(WL=em(["L",",","Z"])),e,r);return ce},Ple={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Aj=t=>{var e=ba(t,Ple),{cx:r,cy:n,innerRadius:i,outerRadius:l,cornerRadius:c,forceCornerRadius:s,cornerIsExternal:m,startAngle:b,endAngle:w,className:E}=e;if(l<i||b===w)return null;var O=Ln("recharts-sector",E),N=l-i,V=Cp(c,N,0,!0),W;return V>0&&Math.abs(b-w)<360?W=Ele({cx:r,cy:n,innerRadius:i,outerRadius:l,cornerRadius:Math.min(V,N/2),forceCornerRadius:s,cornerIsExternal:m,startAngle:b,endAngle:w}):W=Sj({cx:r,cy:n,innerRadius:i,outerRadius:l,startAngle:b,endAngle:w}),ee.createElement("path",MP({},va(e),{className:O,d:W}))};function Cle(t,e,r){if(t==="horizontal")return[{x:e.x,y:r.top},{x:e.x,y:r.top+r.height}];if(t==="vertical")return[{x:r.left,y:e.y},{x:r.left+r.width,y:e.y}];if(c6(e)){if(t==="centric"){var{cx:n,cy:i,innerRadius:l,outerRadius:c,angle:s}=e,m=_a(n,i,l,s),b=_a(n,i,c,s);return[{x:m.x,y:m.y},{x:b.x,y:b.y}]}return Tj(e)}}var XA={},GA={},ZA={},HL;function Mle(){return HL||(HL=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=v6();function r(n){return e.isSymbol(n)?NaN:Number(n)}t.toNumber=r})(ZA)),ZA}var qL;function Ile(){return qL||(qL=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Mle();function r(n){return n?(n=e.toNumber(n),n===1/0||n===-1/0?(n<0?-1:1)*Number.MAX_VALUE:n===n?n:0):n===0?n:0}t.toFinite=r})(GA)),GA}var XL;function Rle(){return XL||(XL=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=b6(),r=Ile();function n(i,l,c){c&&typeof c!="number"&&e.isIterateeCall(i,l,c)&&(l=c=void 0),i=r.toFinite(i),l===void 0?(l=i,i=0):l=r.toFinite(l),c=c===void 0?i<l?1:-1:r.toFinite(c);const s=Math.max(Math.ceil((l-i)/(c||1)),0),m=new Array(s);for(let b=0;b<s;b++)m[b]=i,i+=c;return m}t.range=n})(XA)),XA}var YA,GL;function Ole(){return GL||(GL=1,YA=Rle().range),YA}var Dle=Ole();const Ej=Fh(Dle),P0=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:ZC,scaleDiverging:kF,scaleDivergingLog:LF,scaleDivergingPow:m3,scaleDivergingSqrt:Wre,scaleDivergingSymlog:NF,scaleIdentity:gF,scaleImplicit:KE,scaleLinear:pF,scaleLog:_F,scaleOrdinal:GC,scalePoint:Pee,scalePow:s3,scaleQuantile:bF,scaleQuantize:xF,scaleRadial:vF,scaleSequential:p3,scaleSequentialLog:RF,scaleSequentialPow:g3,scaleSequentialQuantile:DF,scaleSequentialSqrt:$re,scaleSequentialSymlog:OF,scaleSqrt:Ste,scaleSymlog:yF,scaleThreshold:wF,scaleTime:Ure,scaleUtc:Vre,tickFormat:dF},Symbol.toStringTag,{value:"Module"}));var hd=t=>t.chartData,Pj=bt([hd],t=>{var e=t.chartData!=null?t.chartData.length-1:0;return{chartData:t.chartData,computedData:t.computedData,dataEndIndex:e,dataStartIndex:0}}),U3=(t,e,r,n)=>n?Pj(t):hd(t),kle=(t,e,r)=>r?Pj(t):hd(t);function ad(t){if(Array.isArray(t)&&t.length===2){var[e,r]=t;if(Br(e)&&Br(r))return!0}return!1}function ZL(t,e,r){return r?t:[Math.min(t[0],e[0]),Math.max(t[1],e[1])]}function Cj(t,e){if(e&&typeof t!="function"&&Array.isArray(t)&&t.length===2){var[r,n]=t,i,l;if(Br(r))i=r;else if(typeof r=="function")return;if(Br(n))l=n;else if(typeof n=="function")return;var c=[i,l];if(ad(c))return c}}function Lle(t,e,r){if(!(!r&&e==null)){if(typeof t=="function"&&e!=null)try{var n=t(e,r);if(ad(n))return ZL(n,e,r)}catch{}if(Array.isArray(t)&&t.length===2){var[i,l]=t,c,s;if(i==="auto")e!=null&&(c=Math.min(...e));else if(cr(i))c=i;else if(typeof i=="function")try{e!=null&&(c=i(e?.[0]))}catch{}else if(typeof i=="string"&&Wk.test(i)){var m=Wk.exec(i);if(m==null||m[1]==null||e==null)c=void 0;else{var b=+m[1];c=e[0]-b}}else c=e?.[0];if(l==="auto")e!=null&&(s=Math.max(...e));else if(cr(l))s=l;else if(typeof l=="function")try{e!=null&&(s=l(e?.[1]))}catch{}else if(typeof l=="string"&&Hk.test(l)){var w=Hk.exec(l);if(w==null||w[1]==null||e==null)s=void 0;else{var E=+w[1];s=e[1]+E}}else s=e?.[1];var O=[c,s];if(ad(O))return e==null?O:ZL(O,e,r)}}}var Yy=1e9,Nle={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},$3,_i=!0,Sc="[DecimalError] ",cm=Sc+"Invalid argument: ",V3=Sc+"Exponent out of range: ",Ky=Math.floor,Xg=Math.pow,zle=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Al,Us=1e7,fi=7,Mj=9007199254740991,eT=Ky(Mj/fi),ir={};ir.absoluteValue=ir.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};ir.comparedTo=ir.cmp=function(t){var e,r,n,i,l=this;if(t=new l.constructor(t),l.s!==t.s)return l.s||-t.s;if(l.e!==t.e)return l.e>t.e^l.s<0?1:-1;for(n=l.d.length,i=t.d.length,e=0,r=n<i?n:i;e<r;++e)if(l.d[e]!==t.d[e])return l.d[e]>t.d[e]^l.s<0?1:-1;return n===i?0:n>i^l.s<0?1:-1};ir.decimalPlaces=ir.dp=function(){var t=this,e=t.d.length-1,r=(e-t.e)*fi;if(e=t.d[e],e)for(;e%10==0;e/=10)r--;return r<0?0:r};ir.dividedBy=ir.div=function(t){return Qf(this,new this.constructor(t))};ir.dividedToIntegerBy=ir.idiv=function(t){var e=this,r=e.constructor;return Jn(Qf(e,new r(t),0,1),r.precision)};ir.equals=ir.eq=function(t){return!this.cmp(t)};ir.exponent=function(){return is(this)};ir.greaterThan=ir.gt=function(t){return this.cmp(t)>0};ir.greaterThanOrEqualTo=ir.gte=function(t){return this.cmp(t)>=0};ir.isInteger=ir.isint=function(){return this.e>this.d.length-2};ir.isNegative=ir.isneg=function(){return this.s<0};ir.isPositive=ir.ispos=function(){return this.s>0};ir.isZero=function(){return this.s===0};ir.lessThan=ir.lt=function(t){return this.cmp(t)<0};ir.lessThanOrEqualTo=ir.lte=function(t){return this.cmp(t)<1};ir.logarithm=ir.log=function(t){var e,r=this,n=r.constructor,i=n.precision,l=i+5;if(t===void 0)t=new n(10);else if(t=new n(t),t.s<1||t.eq(Al))throw Error(Sc+"NaN");if(r.s<1)throw Error(Sc+(r.s?"NaN":"-Infinity"));return r.eq(Al)?new n(0):(_i=!1,e=Qf(cb(r,l),cb(t,l),l),_i=!0,Jn(e,i))};ir.minus=ir.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?Oj(e,t):Ij(e,(t.s=-t.s,t))};ir.modulo=ir.mod=function(t){var e,r=this,n=r.constructor,i=n.precision;if(t=new n(t),!t.s)throw Error(Sc+"NaN");return r.s?(_i=!1,e=Qf(r,t,0,1).times(t),_i=!0,r.minus(e)):Jn(new n(r),i)};ir.naturalExponential=ir.exp=function(){return Rj(this)};ir.naturalLogarithm=ir.ln=function(){return cb(this)};ir.negated=ir.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};ir.plus=ir.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?Ij(e,t):Oj(e,(t.s=-t.s,t))};ir.precision=ir.sd=function(t){var e,r,n,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(cm+t);if(e=is(i)+1,n=i.d.length-1,r=n*fi+1,n=i.d[n],n){for(;n%10==0;n/=10)r--;for(n=i.d[0];n>=10;n/=10)r++}return t&&e>r?e:r};ir.squareRoot=ir.sqrt=function(){var t,e,r,n,i,l,c,s=this,m=s.constructor;if(s.s<1){if(!s.s)return new m(0);throw Error(Sc+"NaN")}for(t=is(s),_i=!1,i=Math.sqrt(+s),i==0||i==1/0?(e=Dh(s.d),(e.length+t)%2==0&&(e+="0"),i=Math.sqrt(e),t=Ky((t+1)/2)-(t<0||t%2),i==1/0?e="5e"+t:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),n=new m(e)):n=new m(i.toString()),r=m.precision,i=c=r+3;;)if(l=n,n=l.plus(Qf(s,l,c+2)).times(.5),Dh(l.d).slice(0,c)===(e=Dh(n.d)).slice(0,c)){if(e=e.slice(c-3,c+1),i==c&&e=="4999"){if(Jn(l,r+1,0),l.times(l).eq(s)){n=l;break}}else if(e!="9999")break;c+=4}return _i=!0,Jn(n,r)};ir.times=ir.mul=function(t){var e,r,n,i,l,c,s,m,b,w=this,E=w.constructor,O=w.d,N=(t=new E(t)).d;if(!w.s||!t.s)return new E(0);for(t.s*=w.s,r=w.e+t.e,m=O.length,b=N.length,m<b&&(l=O,O=N,N=l,c=m,m=b,b=c),l=[],c=m+b,n=c;n--;)l.push(0);for(n=b;--n>=0;){for(e=0,i=m+n;i>n;)s=l[i]+N[n]*O[i-n-1]+e,l[i--]=s%Us|0,e=s/Us|0;l[i]=(l[i]+e)%Us|0}for(;!l[--c];)l.pop();return e?++r:l.shift(),t.d=l,t.e=r,_i?Jn(t,E.precision):t};ir.toDecimalPlaces=ir.todp=function(t,e){var r=this,n=r.constructor;return r=new n(r),t===void 0?r:(Bh(t,0,Yy),e===void 0?e=n.rounding:Bh(e,0,8),Jn(r,t+is(r)+1,e))};ir.toExponential=function(t,e){var r,n=this,i=n.constructor;return t===void 0?r=wm(n,!0):(Bh(t,0,Yy),e===void 0?e=i.rounding:Bh(e,0,8),n=Jn(new i(n),t+1,e),r=wm(n,!0,t+1)),r};ir.toFixed=function(t,e){var r,n,i=this,l=i.constructor;return t===void 0?wm(i):(Bh(t,0,Yy),e===void 0?e=l.rounding:Bh(e,0,8),n=Jn(new l(i),t+is(i)+1,e),r=wm(n.abs(),!1,t+is(n)+1),i.isneg()&&!i.isZero()?"-"+r:r)};ir.toInteger=ir.toint=function(){var t=this,e=t.constructor;return Jn(new e(t),is(t)+1,e.rounding)};ir.toNumber=function(){return+this};ir.toPower=ir.pow=function(t){var e,r,n,i,l,c,s=this,m=s.constructor,b=12,w=+(t=new m(t));if(!t.s)return new m(Al);if(s=new m(s),!s.s){if(t.s<1)throw Error(Sc+"Infinity");return s}if(s.eq(Al))return s;if(n=m.precision,t.eq(Al))return Jn(s,n);if(e=t.e,r=t.d.length-1,c=e>=r,l=s.s,c){if((r=w<0?-w:w)<=Mj){for(i=new m(Al),e=Math.ceil(n/fi+4),_i=!1;r%2&&(i=i.times(s),KL(i.d,e)),r=Ky(r/2),r!==0;)s=s.times(s),KL(s.d,e);return _i=!0,t.s<0?new m(Al).div(i):Jn(i,n)}}else if(l<0)throw Error(Sc+"NaN");return l=l<0&&t.d[Math.max(e,r)]&1?-1:1,s.s=1,_i=!1,i=t.times(cb(s,n+b)),_i=!0,i=Rj(i),i.s=l,i};ir.toPrecision=function(t,e){var r,n,i=this,l=i.constructor;return t===void 0?(r=is(i),n=wm(i,r<=l.toExpNeg||r>=l.toExpPos)):(Bh(t,1,Yy),e===void 0?e=l.rounding:Bh(e,0,8),i=Jn(new l(i),t,e),r=is(i),n=wm(i,t<=r||r<=l.toExpNeg,t)),n};ir.toSignificantDigits=ir.tosd=function(t,e){var r=this,n=r.constructor;return t===void 0?(t=n.precision,e=n.rounding):(Bh(t,1,Yy),e===void 0?e=n.rounding:Bh(e,0,8)),Jn(new n(r),t,e)};ir.toString=ir.valueOf=ir.val=ir.toJSON=ir[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=is(t),r=t.constructor;return wm(t,e<=r.toExpNeg||e>=r.toExpPos)};function Ij(t,e){var r,n,i,l,c,s,m,b,w=t.constructor,E=w.precision;if(!t.s||!e.s)return e.s||(e=new w(t)),_i?Jn(e,E):e;if(m=t.d,b=e.d,c=t.e,i=e.e,m=m.slice(),l=c-i,l){for(l<0?(n=m,l=-l,s=b.length):(n=b,i=c,s=m.length),c=Math.ceil(E/fi),s=c>s?c+1:s+1,l>s&&(l=s,n.length=1),n.reverse();l--;)n.push(0);n.reverse()}for(s=m.length,l=b.length,s-l<0&&(l=s,n=b,b=m,m=n),r=0;l;)r=(m[--l]=m[l]+b[l]+r)/Us|0,m[l]%=Us;for(r&&(m.unshift(r),++i),s=m.length;m[--s]==0;)m.pop();return e.d=m,e.e=i,_i?Jn(e,E):e}function Bh(t,e,r){if(t!==~~t||t<e||t>r)throw Error(cm+t)}function Dh(t){var e,r,n,i=t.length-1,l="",c=t[0];if(i>0){for(l+=c,e=1;e<i;e++)n=t[e]+"",r=fi-n.length,r&&(l+=pp(r)),l+=n;c=t[e],n=c+"",r=fi-n.length,r&&(l+=pp(r))}else if(c===0)return"0";for(;c%10===0;)c/=10;return l+c}var Qf=(function(){function t(n,i){var l,c=0,s=n.length;for(n=n.slice();s--;)l=n[s]*i+c,n[s]=l%Us|0,c=l/Us|0;return c&&n.unshift(c),n}function e(n,i,l,c){var s,m;if(l!=c)m=l>c?1:-1;else for(s=m=0;s<l;s++)if(n[s]!=i[s]){m=n[s]>i[s]?1:-1;break}return m}function r(n,i,l){for(var c=0;l--;)n[l]-=c,c=n[l]<i[l]?1:0,n[l]=c*Us+n[l]-i[l];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,l,c){var s,m,b,w,E,O,N,V,W,j,Y,ce,re,ue,me,ge,Ce,We,Xe=n.constructor,Et=n.s==i.s?1:-1,gt=n.d,Ye=i.d;if(!n.s)return new Xe(n);if(!i.s)throw Error(Sc+"Division by zero");for(m=n.e-i.e,Ce=Ye.length,me=gt.length,N=new Xe(Et),V=N.d=[],b=0;Ye[b]==(gt[b]||0);)++b;if(Ye[b]>(gt[b]||0)&&--m,l==null?ce=l=Xe.precision:c?ce=l+(is(n)-is(i))+1:ce=l,ce<0)return new Xe(0);if(ce=ce/fi+2|0,b=0,Ce==1)for(w=0,Ye=Ye[0],ce++;(b<me||w)&&ce--;b++)re=w*Us+(gt[b]||0),V[b]=re/Ye|0,w=re%Ye|0;else{for(w=Us/(Ye[0]+1)|0,w>1&&(Ye=t(Ye,w),gt=t(gt,w),Ce=Ye.length,me=gt.length),ue=Ce,W=gt.slice(0,Ce),j=W.length;j<Ce;)W[j++]=0;We=Ye.slice(),We.unshift(0),ge=Ye[0],Ye[1]>=Us/2&&++ge;do w=0,s=e(Ye,W,Ce,j),s<0?(Y=W[0],Ce!=j&&(Y=Y*Us+(W[1]||0)),w=Y/ge|0,w>1?(w>=Us&&(w=Us-1),E=t(Ye,w),O=E.length,j=W.length,s=e(E,W,O,j),s==1&&(w--,r(E,Ce<O?We:Ye,O))):(w==0&&(s=w=1),E=Ye.slice()),O=E.length,O<j&&E.unshift(0),r(W,E,j),s==-1&&(j=W.length,s=e(Ye,W,Ce,j),s<1&&(w++,r(W,Ce<j?We:Ye,j))),j=W.length):s===0&&(w++,W=[0]),V[b++]=w,s&&W[0]?W[j++]=gt[ue]||0:(W=[gt[ue]],j=1);while((ue++<me||W[0]!==void 0)&&ce--)}return V[0]||V.shift(),N.e=m,Jn(N,c?l+is(N)+1:l)}})();function Rj(t,e){var r,n,i,l,c,s,m=0,b=0,w=t.constructor,E=w.precision;if(is(t)>16)throw Error(V3+is(t));if(!t.s)return new w(Al);for(_i=!1,s=E,c=new w(.03125);t.abs().gte(.1);)t=t.times(c),b+=5;for(n=Math.log(Xg(2,b))/Math.LN10*2+5|0,s+=n,r=i=l=new w(Al),w.precision=s;;){if(i=Jn(i.times(t),s),r=r.times(++m),c=l.plus(Qf(i,r,s)),Dh(c.d).slice(0,s)===Dh(l.d).slice(0,s)){for(;b--;)l=Jn(l.times(l),s);return w.precision=E,e==null?(_i=!0,Jn(l,E)):l}l=c}}function is(t){for(var e=t.e*fi,r=t.d[0];r>=10;r/=10)e++;return e}function KA(t,e,r){if(e>t.LN10.sd())throw _i=!0,r&&(t.precision=r),Error(Sc+"LN10 precision limit exceeded");return Jn(new t(t.LN10),e)}function pp(t){for(var e="";t--;)e+="0";return e}function cb(t,e){var r,n,i,l,c,s,m,b,w,E=1,O=10,N=t,V=N.d,W=N.constructor,j=W.precision;if(N.s<1)throw Error(Sc+(N.s?"NaN":"-Infinity"));if(N.eq(Al))return new W(0);if(e==null?(_i=!1,b=j):b=e,N.eq(10))return e==null&&(_i=!0),KA(W,b);if(b+=O,W.precision=b,r=Dh(V),n=r.charAt(0),l=is(N),Math.abs(l)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)N=N.times(t),r=Dh(N.d),n=r.charAt(0),E++;l=is(N),n>1?(N=new W("0."+r),l++):N=new W(n+"."+r.slice(1))}else return m=KA(W,b+2,j).times(l+""),N=cb(new W(n+"."+r.slice(1)),b-O).plus(m),W.precision=j,e==null?(_i=!0,Jn(N,j)):N;for(s=c=N=Qf(N.minus(Al),N.plus(Al),b),w=Jn(N.times(N),b),i=3;;){if(c=Jn(c.times(w),b),m=s.plus(Qf(c,new W(i),b)),Dh(m.d).slice(0,b)===Dh(s.d).slice(0,b))return s=s.times(2),l!==0&&(s=s.plus(KA(W,b+2,j).times(l+""))),s=Qf(s,new W(E),b),W.precision=j,e==null?(_i=!0,Jn(s,j)):s;s=m,i+=2}}function YL(t,e){var r,n,i;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;e.charCodeAt(n)===48;)++n;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(n,i),e){if(i-=n,r=r-n-1,t.e=Ky(r/fi),t.d=[],n=(r+1)%fi,r<0&&(n+=fi),n<i){for(n&&t.d.push(+e.slice(0,n)),i-=fi;n<i;)t.d.push(+e.slice(n,n+=fi));e=e.slice(n),n=fi-e.length}else n-=i;for(;n--;)e+="0";if(t.d.push(+e),_i&&(t.e>eT||t.e<-eT))throw Error(V3+r)}else t.s=0,t.e=0,t.d=[0];return t}function Jn(t,e,r){var n,i,l,c,s,m,b,w,E=t.d;for(c=1,l=E[0];l>=10;l/=10)c++;if(n=e-c,n<0)n+=fi,i=e,b=E[w=0];else{if(w=Math.ceil((n+1)/fi),l=E.length,w>=l)return t;for(b=l=E[w],c=1;l>=10;l/=10)c++;n%=fi,i=n-fi+c}if(r!==void 0&&(l=Xg(10,c-i-1),s=b/l%10|0,m=e<0||E[w+1]!==void 0||b%l,m=r<4?(s||m)&&(r==0||r==(t.s<0?3:2)):s>5||s==5&&(r==4||m||r==6&&(n>0?i>0?b/Xg(10,c-i):0:E[w-1])%10&1||r==(t.s<0?8:7))),e<1||!E[0])return m?(l=is(t),E.length=1,e=e-l-1,E[0]=Xg(10,(fi-e%fi)%fi),t.e=Ky(-e/fi)||0):(E.length=1,E[0]=t.e=t.s=0),t;if(n==0?(E.length=w,l=1,w--):(E.length=w+1,l=Xg(10,fi-n),E[w]=i>0?(b/Xg(10,c-i)%Xg(10,i)|0)*l:0),m)for(;;)if(w==0){(E[0]+=l)==Us&&(E[0]=1,++t.e);break}else{if(E[w]+=l,E[w]!=Us)break;E[w--]=0,l=1}for(n=E.length;E[--n]===0;)E.pop();if(_i&&(t.e>eT||t.e<-eT))throw Error(V3+is(t));return t}function Oj(t,e){var r,n,i,l,c,s,m,b,w,E,O=t.constructor,N=O.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new O(t),_i?Jn(e,N):e;if(m=t.d,E=e.d,n=e.e,b=t.e,m=m.slice(),c=b-n,c){for(w=c<0,w?(r=m,c=-c,s=E.length):(r=E,n=b,s=m.length),i=Math.max(Math.ceil(N/fi),s)+2,c>i&&(c=i,r.length=1),r.reverse(),i=c;i--;)r.push(0);r.reverse()}else{for(i=m.length,s=E.length,w=i<s,w&&(s=i),i=0;i<s;i++)if(m[i]!=E[i]){w=m[i]<E[i];break}c=0}for(w&&(r=m,m=E,E=r,e.s=-e.s),s=m.length,i=E.length-s;i>0;--i)m[s++]=0;for(i=E.length;i>c;){if(m[--i]<E[i]){for(l=i;l&&m[--l]===0;)m[l]=Us-1;--m[l],m[i]+=Us}m[i]-=E[i]}for(;m[--s]===0;)m.pop();for(;m[0]===0;m.shift())--n;return m[0]?(e.d=m,e.e=n,_i?Jn(e,N):e):new O(0)}function wm(t,e,r){var n,i=is(t),l=Dh(t.d),c=l.length;return e?(r&&(n=r-c)>0?l=l.charAt(0)+"."+l.slice(1)+pp(n):c>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(i<0?"e":"e+")+i):i<0?(l="0."+pp(-i-1)+l,r&&(n=r-c)>0&&(l+=pp(n))):i>=c?(l+=pp(i+1-c),r&&(n=r-i-1)>0&&(l=l+"."+pp(n))):((n=i+1)<c&&(l=l.slice(0,n)+"."+l.slice(n)),r&&(n=r-c)>0&&(i+1===c&&(l+="."),l+=pp(n))),t.s<0?"-"+l:l}function KL(t,e){if(t.length>e)return t.length=e,!0}function Dj(t){var e,r,n;function i(l){var c=this;if(!(c instanceof i))return new i(l);if(c.constructor=i,l instanceof i){c.s=l.s,c.e=l.e,c.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(cm+l);if(l>0)c.s=1;else if(l<0)l=-l,c.s=-1;else{c.s=0,c.e=0,c.d=[0];return}if(l===~~l&&l<1e7){c.e=0,c.d=[l];return}return YL(c,l.toString())}else if(typeof l!="string")throw Error(cm+l);if(l.charCodeAt(0)===45?(l=l.slice(1),c.s=-1):c.s=1,zle.test(l))YL(c,l);else throw Error(cm+l)}if(i.prototype=ir,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=Dj,i.config=i.set=Ble,t===void 0&&(t={}),t)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<n.length;)t.hasOwnProperty(r=n[e++])||(t[r]=this[r]);return i.config(t),i}function Ble(t){if(!t||typeof t!="object")throw Error(Sc+"Object expected");var e,r,n,i=["precision",1,Yy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((n=t[r=i[e]])!==void 0)if(Ky(n)===n&&n>=i[e+1]&&n<=i[e+2])this[r]=n;else throw Error(cm+r+": "+n);if((n=t[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(cm+r+": "+n);return this}var $3=Dj(Nle);Al=new $3(1);const kn=$3;function kj(t){var e;return t===0?e=1:e=Math.floor(new kn(t).abs().log(10).toNumber())+1,e}function Lj(t,e,r){for(var n=new kn(t),i=0,l=[];n.lt(e)&&i<1e5;)l.push(n.toNumber()),n=n.add(r),i++;return l}var Nj=t=>{var[e,r]=t,[n,i]=[e,r];return e>r&&([n,i]=[r,e]),[n,i]},zj=(t,e,r)=>{if(t.lte(0))return new kn(0);var n=kj(t.toNumber()),i=new kn(10).pow(n),l=t.div(i),c=n!==1?.05:.1,s=new kn(Math.ceil(l.div(c).toNumber())).add(r).mul(c),m=s.mul(i);return e?new kn(m.toNumber()):new kn(Math.ceil(m.toNumber()))},Fle=(t,e,r)=>{var n=new kn(1),i=new kn(t);if(!i.isint()&&r){var l=Math.abs(t);l<1?(n=new kn(10).pow(kj(t)-1),i=new kn(Math.floor(i.div(n).toNumber())).mul(n)):l>1&&(i=new kn(Math.floor(t)))}else t===0?i=new kn(Math.floor((e-1)/2)):r||(i=new kn(Math.floor(t)));for(var c=Math.floor((e-1)/2),s=[],m=0;m<e;m++)s.push(i.add(new kn(m-c).mul(n)).toNumber());return s},Bj=function(e,r,n,i){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((r-e)/(n-1)))return{step:new kn(0),tickMin:new kn(0),tickMax:new kn(0)};var c=zj(new kn(r).sub(e).div(n-1),i,l),s;e<=0&&r>=0?s=new kn(0):(s=new kn(e).add(r).div(2),s=s.sub(new kn(s).mod(c)));var m=Math.ceil(s.sub(e).div(c).toNumber()),b=Math.ceil(new kn(r).sub(s).div(c).toNumber()),w=m+b+1;return w>n?Bj(e,r,n,i,l+1):(w<n&&(b=r>0?b+(n-w):b,m=r>0?m:m+(n-w)),{step:c,tickMin:s.sub(new kn(m).mul(c)),tickMax:s.add(new kn(b).mul(c))})},jle=function(e){var[r,n]=e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,c=Math.max(i,2),[s,m]=Nj([r,n]);if(s===-1/0||m===1/0){var b=m===1/0?[s,...Array(i-1).fill(1/0)]:[...Array(i-1).fill(-1/0),m];return r>n?b.reverse():b}if(s===m)return Fle(s,i,l);var{step:w,tickMin:E,tickMax:O}=Bj(s,m,c,l,0),N=Lj(E,O.add(new kn(.1).mul(w)),w);return r>n?N.reverse():N},Ule=function(e,r){var[n,i]=e,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[c,s]=Nj([n,i]);if(c===-1/0||s===1/0)return[n,i];if(c===s)return[c];var m=Math.max(r,2),b=zj(new kn(s).sub(c).div(m-1),l,0),w=[...Lj(new kn(c),new kn(s),b),s];return l===!1&&(w=w.map(E=>Math.round(E))),n>i?w.reverse():w},Vle=t=>t.rootProps.barCategoryGap,n2=t=>t.rootProps.stackOffset,Fj=t=>t.rootProps.reverseStackOrder,W3=t=>t.options.chartName,H3=t=>t.rootProps.syncId,jj=t=>t.rootProps.syncMethod,q3=t=>t.options.eventEmitter,$le=t=>t.rootProps.baseValue,ya={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},Wg={allowDecimals:!1,allowDataOverflow:!1,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"auto"},Sh={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,includeHidden:!1,radiusAxisId:0,reversed:!1,scale:"auto",tick:!0,tickCount:5,type:"auto"},i2=(t,e)=>{if(!(!t||!e))return t!=null&&t.reversed?[e[1],e[0]]:e};function s2(t,e,r){if(r!=="auto")return r;if(t!=null)return Ru(t,e)?"category":"number"}function QL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function tT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?QL(Object(r),!0).forEach(function(n){Wle(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QL(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Wle(t,e,r){return(e=Hle(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Hle(t){var e=qle(t,"string");return typeof e=="symbol"?e:e+""}function qle(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var JL={allowDataOverflow:Wg.allowDataOverflow,allowDecimals:Wg.allowDecimals,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:Wg.angleAxisId,includeHidden:!1,name:void 0,reversed:Wg.reversed,scale:Wg.scale,tick:Wg.tick,tickCount:void 0,ticks:void 0,type:Wg.type,unit:void 0},eN={allowDataOverflow:Sh.allowDataOverflow,allowDecimals:Sh.allowDecimals,allowDuplicatedCategory:Sh.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Sh.radiusAxisId,includeHidden:Sh.includeHidden,name:void 0,reversed:Sh.reversed,scale:Sh.scale,tick:Sh.tick,tickCount:Sh.tickCount,ticks:void 0,type:Sh.type,unit:void 0},Xle=(t,e)=>{if(e!=null)return t.polarAxis.angleAxis[e]},X3=bt([Xle,cj],(t,e)=>{var r;if(t!=null)return t;var n=(r=s2(e,"angleAxis",JL.type))!==null&&r!==void 0?r:"category";return tT(tT({},JL),{},{type:n})}),Gle=(t,e)=>t.polarAxis.radiusAxis[e],G3=bt([Gle,cj],(t,e)=>{var r;if(t!=null)return t;var n=(r=s2(e,"radiusAxis",eN.type))!==null&&r!==void 0?r:"category";return tT(tT({},eN),{},{type:n})}),a2=t=>t.polarOptions,Z3=bt([cd,ud,xa],vle),Uj=bt([a2,Z3],(t,e)=>{if(t!=null)return Cp(t.innerRadius,e,0)}),Vj=bt([a2,Z3],(t,e)=>{if(t!=null)return Cp(t.outerRadius,e,e*.8)}),Zle=t=>{if(t==null)return[0,0];var{startAngle:e,endAngle:r}=t;return[e,r]},$j=bt([a2],Zle);bt([X3,$j],i2);var Wj=bt([Z3,Uj,Vj],(t,e,r)=>{if(!(t==null||e==null||r==null))return[e,r]});bt([G3,Wj],i2);var Hj=bt([ai,a2,Uj,Vj,cd,ud],(t,e,r,n,i,l)=>{if(!(t!=="centric"&&t!=="radial"||e==null||r==null||n==null)){var{cx:c,cy:s,startAngle:m,endAngle:b}=e;return{cx:Cp(c,i,i/2),cy:Cp(s,l,l/2),innerRadius:r,outerRadius:n,startAngle:m,endAngle:b,clockWise:!1}}}),Ws=(t,e)=>e,o2=(t,e,r)=>r;function Y3(t){return t?.id}function qj(t,e,r){var{chartData:n=[]}=e,{allowDuplicatedCategory:i,dataKey:l}=r,c=new Map;return t.forEach(s=>{var m,b=(m=s.data)!==null&&m!==void 0?m:n;if(!(b==null||b.length===0)){var w=Y3(s);b.forEach((E,O)=>{var N=l==null||i?O:String(vs(E,l,null)),V=vs(E,s.dataKey,0),W;c.has(N)?W=c.get(N):W={},Object.assign(W,{[w]:V}),c.set(N,W)})}}),Array.from(c.values())}function K3(t){return"stackId"in t&&t.stackId!=null&&t.dataKey!=null}var l2=(t,e)=>t===e?!0:t==null||e==null?!1:t[0]===e[0]&&t[1]===e[1];function c2(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===0&&e.length===0?!0:t===e}function Yle(t,e){if(t.length===e.length){for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}var Hs=t=>{var e=ai(t);return e==="horizontal"?"xAxis":e==="vertical"?"yAxis":e==="centric"?"angleAxis":"radiusAxis"},Qy=t=>t.tooltip.settings.axisId;function Kle(t){if(t in P0)return P0[t]();var e="scale".concat(Eb(t));if(e in P0)return P0[e]()}function tN(t){var e=t.ticks,r=t.bandwidth,n=t.range(),i=[Math.min(...n),Math.max(...n)];return{domain:()=>t.domain(),range:(function(l){function c(){return l.apply(this,arguments)}return c.toString=function(){return l.toString()},c})(()=>i),rangeMin:()=>i[0],rangeMax:()=>i[1],isInRange(l){var c=i[0],s=i[1];return c<=s?l>=c&&l<=s:l>=s&&l<=c},bandwidth:r?()=>r.call(t):void 0,ticks:e?l=>e.call(t,l):void 0,map:(l,c)=>{var s=t(l);if(s!=null){if(t.bandwidth&&c!==null&&c!==void 0&&c.position){var m=t.bandwidth();switch(c.position){case"middle":s+=m/2;break;case"end":s+=m;break}}return s}}}}function rN(t,e,r){if(typeof t=="function")return tN(t.copy().domain(e).range(r));if(t!=null){var n=Kle(t);if(n!=null)return n.domain(e).range(r),tN(n)}}var Qle=(t,e)=>{if(e!=null)switch(t){case"linear":{if(!ad(e)){for(var r,n,i=0;i<e.length;i++){var l=e[i];Br(l)&&((r===void 0||l<r)&&(r=l),(n===void 0||l>n)&&(n=l))}return r!==void 0&&n!==void 0?[r,n]:void 0}return e}default:return e}};function nN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function rT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nN(Object(r),!0).forEach(function(n){Jle(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Jle(t,e,r){return(e=ece(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ece(t){var e=tce(t,"string");return typeof e=="symbol"?e:e+""}function tce(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var IP=[0,"auto"],Fs={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},Xj=(t,e)=>t.cartesianAxis.xAxis[e],jh=(t,e)=>{var r=Xj(t,e);return r??Fs},js={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:IP,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Mb},Gj=(t,e)=>t.cartesianAxis.yAxis[e],Uh=(t,e)=>{var r=Gj(t,e);return r??js},rce={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},Q3=(t,e)=>{var r=t.cartesianAxis.zAxis[e];return r??rce},_o=(t,e,r)=>{switch(e){case"xAxis":return jh(t,r);case"yAxis":return Uh(t,r);case"zAxis":return Q3(t,r);case"angleAxis":return X3(t,r);case"radiusAxis":return G3(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},nce=(t,e,r)=>{switch(e){case"xAxis":return jh(t,r);case"yAxis":return Uh(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},kb=(t,e,r)=>{switch(e){case"xAxis":return jh(t,r);case"yAxis":return Uh(t,r);case"angleAxis":return X3(t,r);case"radiusAxis":return G3(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},Zj=t=>t.graphicalItems.cartesianItems.some(e=>e.type==="bar")||t.graphicalItems.polarItems.some(e=>e.type==="radialBar");function Yj(t,e){return r=>{switch(t){case"xAxis":return"xAxisId"in r&&r.xAxisId===e;case"yAxis":return"yAxisId"in r&&r.yAxisId===e;case"zAxis":return"zAxisId"in r&&r.zAxisId===e;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===e;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===e;default:return!1}}}var J3=t=>t.graphicalItems.cartesianItems,ice=bt([Ws,o2],Yj),Kj=(t,e,r)=>t.filter(r).filter(n=>e?.includeHidden===!0?!0:!n.hide),Lb=bt([J3,_o,ice],Kj,{memoizeOptions:{resultEqualityCheck:c2}}),Qj=bt([Lb],t=>t.filter(e=>e.type==="area"||e.type==="bar").filter(K3)),Jj=t=>t.filter(e=>!("stackId"in e)||e.stackId===void 0),sce=bt([Lb],Jj),e5=t=>t.map(e=>e.data).filter(Boolean).flat(1),ace=bt([Lb],e5,{memoizeOptions:{resultEqualityCheck:c2}}),t5=(t,e)=>{var{chartData:r=[],dataStartIndex:n,dataEndIndex:i}=e;return t.length>0?t:r.slice(n,i+1)},eM=bt([ace,U3],t5),r5=(t,e,r)=>e?.dataKey!=null?t.map(n=>({value:vs(n,e.dataKey)})):r.length>0?r.map(n=>n.dataKey).flatMap(n=>t.map(i=>({value:vs(i,n)}))):t.map(n=>({value:n})),u2=bt([eM,_o,Lb],r5);function n5(t,e){switch(t){case"xAxis":return e.direction==="x";case"yAxis":return e.direction==="y";default:return!1}}function H1(t){if(wc(t)||t instanceof Date){var e=Number(t);if(Br(e))return e}}function iN(t){if(Array.isArray(t)){var e=[H1(t[0]),H1(t[1])];return ad(e)?e:void 0}var r=H1(t);if(r!=null)return[r,r]}function od(t){return t.map(H1).filter(Xo)}function oce(t,e,r){return!r||typeof e!="number"||Nh(e)?[]:r.length?od(r.flatMap(n=>{var i=vs(t,n.dataKey),l,c;if(Array.isArray(i)?[l,c]=i:l=c=i,!(!Br(l)||!Br(c)))return[e-l,e+c]})):[]}var ws=t=>{var e=Hs(t),r=Qy(t);return kb(t,e,r)},Nb=bt([ws],t=>t?.dataKey),lce=bt([Qj,U3,ws],qj),i5=(t,e,r,n)=>{var i={},l=e.reduce((c,s)=>{if(s.stackId==null)return c;var m=c[s.stackId];return m==null&&(m=[]),m.push(s),c[s.stackId]=m,c},i);return Object.fromEntries(Object.entries(l).map(c=>{var[s,m]=c,b=n?[...m].reverse():m,w=b.map(Y3);return[s,{stackedData:hae(t,w,r),graphicalItems:b}]}))},s5=bt([lce,Qj,n2,Fj],i5),a5=(t,e,r,n)=>{var{dataStartIndex:i,dataEndIndex:l}=e;if(n==null&&r!=="zAxis"){var c=gae(t,i,l);if(!(c!=null&&c[0]===0&&c[1]===0))return c}},cce=bt([_o],t=>t.allowDataOverflow),tM=t=>{var e;if(t==null||!("domain"in t))return IP;if(t.domain!=null)return t.domain;if("ticks"in t&&t.ticks!=null){if(t.type==="number"){var r=od(t.ticks);return[Math.min(...r),Math.max(...r)]}if(t.type==="category")return t.ticks.map(String)}return(e=t?.domain)!==null&&e!==void 0?e:IP},o5=bt([_o],tM),l5=bt([o5,cce],Cj),uce=bt([s5,hd,Ws,l5],a5,{memoizeOptions:{resultEqualityCheck:l2}}),rM=t=>t.errorBars,hce=(t,e,r)=>t.flatMap(n=>e[n.id]).filter(Boolean).filter(n=>n5(r,n)),nT=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.filter(Boolean);if(i.length!==0){var l=i.flat(),c=Math.min(...l),s=Math.max(...l);return[c,s]}},c5=(t,e,r,n,i)=>{var l,c;if(r.length>0&&t.forEach(s=>{r.forEach(m=>{var b,w,E=(b=n[m.id])===null||b===void 0?void 0:b.filter(Y=>n5(i,Y)),O=vs(s,(w=e.dataKey)!==null&&w!==void 0?w:m.dataKey),N=oce(s,O,E);if(N.length>=2){var V=Math.min(...N),W=Math.max(...N);(l==null||V<l)&&(l=V),(c==null||W>c)&&(c=W)}var j=iN(O);j!=null&&(l=l==null?j[0]:Math.min(l,j[0]),c=c==null?j[1]:Math.max(c,j[1]))})}),e?.dataKey!=null&&t.forEach(s=>{var m=iN(vs(s,e.dataKey));m!=null&&(l=l==null?m[0]:Math.min(l,m[0]),c=c==null?m[1]:Math.max(c,m[1]))}),Br(l)&&Br(c))return[l,c]},fce=bt([eM,_o,sce,rM,Ws],c5,{memoizeOptions:{resultEqualityCheck:l2}});function dce(t){var{value:e}=t;if(wc(e)||e instanceof Date)return e}var pce=(t,e,r)=>{var n=t.map(dce).filter(i=>i!=null);return r&&(e.dataKey==null||e.allowDuplicatedCategory&&s6(n))?Ej(0,t.length):e.allowDuplicatedCategory?n:Array.from(new Set(n))},u5=t=>t.referenceElements.dots,Jy=(t,e,r)=>t.filter(n=>n.ifOverflow==="extendDomain").filter(n=>e==="xAxis"?n.xAxisId===r:n.yAxisId===r),gce=bt([u5,Ws,o2],Jy),h5=t=>t.referenceElements.areas,mce=bt([h5,Ws,o2],Jy),f5=t=>t.referenceElements.lines,_ce=bt([f5,Ws,o2],Jy),d5=(t,e)=>{if(t!=null){var r=od(t.map(n=>e==="xAxis"?n.x:n.y));if(r.length!==0)return[Math.min(...r),Math.max(...r)]}},yce=bt(gce,Ws,d5),p5=(t,e)=>{if(t!=null){var r=od(t.flatMap(n=>[e==="xAxis"?n.x1:n.y1,e==="xAxis"?n.x2:n.y2]));if(r.length!==0)return[Math.min(...r),Math.max(...r)]}},vce=bt([mce,Ws],p5);function bce(t){var e;if(t.x!=null)return od([t.x]);var r=(e=t.segment)===null||e===void 0?void 0:e.map(n=>n.x);return r==null||r.length===0?[]:od(r)}function xce(t){var e;if(t.y!=null)return od([t.y]);var r=(e=t.segment)===null||e===void 0?void 0:e.map(n=>n.y);return r==null||r.length===0?[]:od(r)}var g5=(t,e)=>{if(t!=null){var r=t.flatMap(n=>e==="xAxis"?bce(n):xce(n));if(r.length!==0)return[Math.min(...r),Math.max(...r)]}},wce=bt([_ce,Ws],g5),Tce=bt(yce,wce,vce,(t,e,r)=>nT(t,r,e)),m5=(t,e,r,n,i,l,c,s)=>{if(r!=null)return r;var m=c==="vertical"&&s==="xAxis"||c==="horizontal"&&s==="yAxis",b=m?nT(n,l,i):nT(l,i);return Lle(e,b,t.allowDataOverflow)},Sce=bt([_o,o5,l5,uce,fce,Tce,ai,Ws],m5,{memoizeOptions:{resultEqualityCheck:l2}}),Ace=[0,1],_5=(t,e,r,n,i,l,c)=>{if(!((t==null||r==null||r.length===0)&&c===void 0)){var{dataKey:s,type:m}=t,b=Ru(e,l);if(b&&s==null){var w;return Ej(0,(w=r?.length)!==null&&w!==void 0?w:0)}return m==="category"?pce(n,t,b):i==="expand"?Ace:c}},nM=bt([_o,ai,eM,u2,n2,Ws,Sce],_5);function Ece(t){return t in P0}var y5=(t,e,r)=>{if(t!=null){var{scale:n,type:i}=t;if(n==="auto")return i==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!e)?"point":i==="category"?"band":"linear";if(typeof n=="string"){var l="scale".concat(Eb(n));return Ece(l)?l:"point"}}},ev=bt([_o,Zj,W3],y5);function iM(t,e,r,n){if(!(r==null||n==null))return typeof t.scale=="function"?rN(t.scale,r,n):rN(e,r,n)}var v5=(t,e,r)=>{var n=tM(e);if(!(r!=="auto"&&r!=="linear")){if(e!=null&&e.tickCount&&Array.isArray(n)&&(n[0]==="auto"||n[1]==="auto")&&ad(t))return jle(t,e.tickCount,e.allowDecimals);if(e!=null&&e.tickCount&&e.type==="number"&&ad(t))return Ule(t,e.tickCount,e.allowDecimals)}},sM=bt([nM,kb,ev],v5),b5=(t,e,r,n)=>{if(n!=="angleAxis"&&t?.type==="number"&&ad(e)&&Array.isArray(r)&&r.length>0){var i,l,c=e[0],s=(i=r[0])!==null&&i!==void 0?i:0,m=e[1],b=(l=r[r.length-1])!==null&&l!==void 0?l:0;return[Math.min(c,s),Math.max(m,b)]}return e},Pce=bt([_o,nM,sM,Ws],b5),Cce=bt(u2,_o,(t,e)=>{if(!(!e||e.type!=="number")){var r=1/0,n=Array.from(od(t.map(E=>E.value))).sort((E,O)=>E-O),i=n[0],l=n[n.length-1];if(i==null||l==null)return 1/0;var c=l-i;if(c===0)return 1/0;for(var s=0;s<n.length-1;s++){var m=n[s],b=n[s+1];if(!(m==null||b==null)){var w=b-m;r=Math.min(r,w)}}return r/c}}),x5=bt(Cce,ai,Vle,xa,(t,e,r,n,i)=>i,(t,e,r,n,i)=>{if(!Br(t))return 0;var l=e==="vertical"?n.height:n.width;if(i==="gap")return t*l/2;if(i==="no-gap"){var c=Cp(r,t*l),s=t*l/2;return s-c-(s-c)/l*c}return 0}),Mce=(t,e,r)=>{var n=jh(t,e);return n==null||typeof n.padding!="string"?0:x5(t,"xAxis",e,r,n.padding)},Ice=(t,e,r)=>{var n=Uh(t,e);return n==null||typeof n.padding!="string"?0:x5(t,"yAxis",e,r,n.padding)},Rce=bt(jh,Mce,(t,e)=>{var r,n;if(t==null)return{left:0,right:0};var{padding:i}=t;return typeof i=="string"?{left:e,right:e}:{left:((r=i.left)!==null&&r!==void 0?r:0)+e,right:((n=i.right)!==null&&n!==void 0?n:0)+e}}),Oce=bt(Uh,Ice,(t,e)=>{var r,n;if(t==null)return{top:0,bottom:0};var{padding:i}=t;return typeof i=="string"?{top:e,bottom:e}:{top:((r=i.top)!==null&&r!==void 0?r:0)+e,bottom:((n=i.bottom)!==null&&n!==void 0?n:0)+e}}),Dce=bt([xa,Rce,KT,YT,(t,e,r)=>r],(t,e,r,n,i)=>{var{padding:l}=n;return i?[l.left,r.width-l.right]:[t.left+e.left,t.left+t.width-e.right]}),kce=bt([xa,ai,Oce,KT,YT,(t,e,r)=>r],(t,e,r,n,i,l)=>{var{padding:c}=i;return l?[n.height-c.bottom,c.top]:e==="horizontal"?[t.top+t.height-r.bottom,t.top+r.top]:[t.top+r.top,t.top+t.height-r.bottom]}),zb=(t,e,r,n)=>{var i;switch(e){case"xAxis":return Dce(t,r,n);case"yAxis":return kce(t,r,n);case"zAxis":return(i=Q3(t,r))===null||i===void 0?void 0:i.range;case"angleAxis":return $j(t);case"radiusAxis":return Wj(t,r);default:return}},w5=bt([_o,zb],i2),Lce=bt([ev,Pce],Qle),Wy=bt([_o,ev,Lce,w5],iM);bt([Lb,rM,Ws],hce);function T5(t,e){return t.id<e.id?-1:t.id>e.id?1:0}var h2=(t,e)=>e,f2=(t,e,r)=>r,Nce=bt(GT,h2,f2,(t,e,r)=>t.filter(n=>n.orientation===e).filter(n=>n.mirror===r).sort(T5)),zce=bt(ZT,h2,f2,(t,e,r)=>t.filter(n=>n.orientation===e).filter(n=>n.mirror===r).sort(T5)),S5=(t,e)=>({width:t.width,height:e.height}),Bce=(t,e)=>{var r=typeof e.width=="number"?e.width:Mb;return{width:r,height:t.height}},Fce=bt(xa,jh,S5),jce=(t,e,r)=>{switch(e){case"top":return t.top;case"bottom":return r-t.bottom;default:return 0}},Uce=(t,e,r)=>{switch(e){case"left":return t.left;case"right":return r-t.right;default:return 0}},Vce=bt(ud,xa,Nce,h2,f2,(t,e,r,n,i)=>{var l={},c;return r.forEach(s=>{var m=S5(e,s);c==null&&(c=jce(e,n,t));var b=n==="top"&&!i||n==="bottom"&&i;l[s.id]=c-Number(b)*m.height,c+=(b?-1:1)*m.height}),l}),$ce=bt(cd,xa,zce,h2,f2,(t,e,r,n,i)=>{var l={},c;return r.forEach(s=>{var m=Bce(e,s);c==null&&(c=Uce(e,n,t));var b=n==="left"&&!i||n==="right"&&i;l[s.id]=c-Number(b)*m.width,c+=(b?-1:1)*m.width}),l}),Wce=(t,e)=>{var r=jh(t,e);if(r!=null)return Vce(t,r.orientation,r.mirror)},Hce=bt([xa,jh,Wce,(t,e)=>e],(t,e,r,n)=>{if(e!=null){var i=r?.[n];return i==null?{x:t.left,y:0}:{x:t.left,y:i}}}),qce=(t,e)=>{var r=Uh(t,e);if(r!=null)return $ce(t,r.orientation,r.mirror)},Xce=bt([xa,Uh,qce,(t,e)=>e],(t,e,r,n)=>{if(e!=null){var i=r?.[n];return i==null?{x:0,y:t.top}:{x:i,y:t.top}}}),Gce=bt(xa,Uh,(t,e)=>{var r=typeof e.width=="number"?e.width:Mb;return{width:r,height:t.height}}),A5=(t,e,r,n)=>{if(r!=null){var{allowDuplicatedCategory:i,type:l,dataKey:c}=r,s=Ru(t,n),m=e.map(b=>b.value);if(c&&s&&l==="category"&&i&&s6(m))return m}},aM=bt([ai,u2,_o,Ws],A5),E5=(t,e,r,n)=>{if(!(r==null||r.dataKey==null)){var{type:i,scale:l}=r,c=Ru(t,n);if(c&&(i==="number"||l!=="auto"))return e.map(s=>s.value)}},oM=bt([ai,u2,kb,Ws],E5),sN=bt([ai,nce,ev,Wy,aM,oM,zb,sM,Ws],(t,e,r,n,i,l,c,s,m)=>{if(e!=null){var b=Ru(t,m);return{angle:e.angle,interval:e.interval,minTickGap:e.minTickGap,orientation:e.orientation,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit,axisType:m,categoricalDomain:l,duplicateDomain:i,isCategorical:b,niceTicks:s,range:c,realScaleType:r,scale:n}}}),Zce=(t,e,r,n,i,l,c,s,m)=>{if(!(e==null||n==null)){var b=Ru(t,m),{type:w,ticks:E,tickCount:O}=e,N=r==="scaleBand"&&typeof n.bandwidth=="function"?n.bandwidth()/2:2,V=w==="category"&&n.bandwidth?n.bandwidth()/N:0;V=m==="angleAxis"&&l!=null&&l.length>=2?mc(l[0]-l[1])*2*V:V;var W=E||i;return W?W.map((j,Y)=>{var ce=c?c.indexOf(j):j,re=n.map(ce);return Br(re)?{index:Y,coordinate:re+V,value:j,offset:V}:null}).filter(Xo):b&&s?s.map((j,Y)=>{var ce=n.map(j);return Br(ce)?{coordinate:ce+V,value:j,index:Y,offset:V}:null}).filter(Xo):n.ticks?n.ticks(O).map((j,Y)=>{var ce=n.map(j);return Br(ce)?{coordinate:ce+V,value:j,index:Y,offset:V}:null}).filter(Xo):n.domain().map((j,Y)=>{var ce=n.map(j);return Br(ce)?{coordinate:ce+V,value:c?c[j]:j,index:Y,offset:V}:null}).filter(Xo)}},P5=bt([ai,kb,ev,Wy,sM,zb,aM,oM,Ws],Zce),Yce=(t,e,r,n,i,l,c)=>{if(!(e==null||r==null||n==null||n[0]===n[1])){var s=Ru(t,c),{tickCount:m}=e,b=0;return b=c==="angleAxis"&&n?.length>=2?mc(n[0]-n[1])*2*b:b,s&&l?l.map((w,E)=>{var O=r.map(w);return Br(O)?{coordinate:O+b,value:w,index:E,offset:b}:null}).filter(Xo):r.ticks?r.ticks(m).map((w,E)=>{var O=r.map(w);return Br(O)?{coordinate:O+b,value:w,index:E,offset:b}:null}).filter(Xo):r.domain().map((w,E)=>{var O=r.map(w);return Br(O)?{coordinate:O+b,value:i?i[w]:w,index:E,offset:b}:null}).filter(Xo)}},d2=bt([ai,kb,Wy,zb,aM,oM,Ws],Yce),p2=bt(_o,Wy,(t,e)=>{if(!(t==null||e==null))return rT(rT({},t),{},{scale:e})}),Kce=bt([_o,ev,nM,w5],iM);bt((t,e,r)=>Q3(t,r),Kce,(t,e)=>{if(!(t==null||e==null))return rT(rT({},t),{},{scale:e})});var Qce=bt([ai,GT,ZT],(t,e,r)=>{switch(t){case"horizontal":return e.some(n=>n.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(n=>n.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),C5=t=>t.options.defaultTooltipEventType,M5=t=>t.options.validateTooltipEventTypes;function I5(t,e,r){if(t==null)return e;var n=t?"axis":"item";return r==null?e:r.includes(n)?n:e}function lM(t,e){var r=C5(t),n=M5(t);return I5(e,r,n)}function Jce(t){return mr(e=>lM(e,t))}var R5=(t,e)=>{var r,n=Number(e);if(!(Nh(n)||e==null))return n>=0?t==null||(r=t[n])===null||r===void 0?void 0:r.value:void 0},eue=t=>t.tooltip.settings,_p={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},tue={itemInteraction:{click:_p,hover:_p},axisInteraction:{click:_p,hover:_p},keyboardInteraction:_p,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},O5=Go({name:"tooltip",initialState:tue,reducers:{addTooltipEntrySettings:{reducer(t,e){t.tooltipItemPayloads.push(e.payload)},prepare:mi()},replaceTooltipEntrySettings:{reducer(t,e){var{prev:r,next:n}=e.payload,i=Eu(t).tooltipItemPayloads.indexOf(r);i>-1&&(t.tooltipItemPayloads[i]=n)},prepare:mi()},removeTooltipEntrySettings:{reducer(t,e){var r=Eu(t).tooltipItemPayloads.indexOf(e.payload);r>-1&&t.tooltipItemPayloads.splice(r,1)},prepare:mi()},setTooltipSettingsState(t,e){t.settings=e.payload},setActiveMouseOverItemIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.itemInteraction.hover.active=!0,t.itemInteraction.hover.index=e.payload.activeIndex,t.itemInteraction.hover.dataKey=e.payload.activeDataKey,t.itemInteraction.hover.graphicalItemId=e.payload.activeGraphicalItemId,t.itemInteraction.hover.coordinate=e.payload.activeCoordinate},mouseLeaveChart(t){t.itemInteraction.hover.active=!1,t.axisInteraction.hover.active=!1},mouseLeaveItem(t){t.itemInteraction.hover.active=!1},setActiveClickItemIndex(t,e){t.syncInteraction.active=!1,t.itemInteraction.click.active=!0,t.keyboardInteraction.active=!1,t.itemInteraction.click.index=e.payload.activeIndex,t.itemInteraction.click.dataKey=e.payload.activeDataKey,t.itemInteraction.click.graphicalItemId=e.payload.activeGraphicalItemId,t.itemInteraction.click.coordinate=e.payload.activeCoordinate},setMouseOverAxisIndex(t,e){t.syncInteraction.active=!1,t.axisInteraction.hover.active=!0,t.keyboardInteraction.active=!1,t.axisInteraction.hover.index=e.payload.activeIndex,t.axisInteraction.hover.dataKey=e.payload.activeDataKey,t.axisInteraction.hover.coordinate=e.payload.activeCoordinate},setMouseClickAxisIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.axisInteraction.click.active=!0,t.axisInteraction.click.index=e.payload.activeIndex,t.axisInteraction.click.dataKey=e.payload.activeDataKey,t.axisInteraction.click.coordinate=e.payload.activeCoordinate},setSyncInteraction(t,e){t.syncInteraction=e.payload},setKeyboardInteraction(t,e){t.keyboardInteraction.active=e.payload.active,t.keyboardInteraction.index=e.payload.activeIndex,t.keyboardInteraction.coordinate=e.payload.activeCoordinate}}}),{addTooltipEntrySettings:rue,replaceTooltipEntrySettings:nue,removeTooltipEntrySettings:iue,setTooltipSettingsState:sue,setActiveMouseOverItemIndex:aue,mouseLeaveItem:jye,mouseLeaveChart:D5,setActiveClickItemIndex:Uye,setMouseOverAxisIndex:k5,setMouseClickAxisIndex:oue,setSyncInteraction:RP,setKeyboardInteraction:OP}=O5.actions,lue=O5.reducer;function aN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function w1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?aN(Object(r),!0).forEach(function(n){cue(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):aN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function cue(t,e,r){return(e=uue(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function uue(t){var e=hue(t,"string");return typeof e=="symbol"?e:e+""}function hue(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function fue(t,e,r){return e==="axis"?r==="click"?t.axisInteraction.click:t.axisInteraction.hover:r==="click"?t.itemInteraction.click:t.itemInteraction.hover}function due(t){return t.index!=null}var L5=(t,e,r,n)=>{if(e==null)return _p;var i=fue(t,e,r);if(i==null)return _p;if(i.active)return i;if(t.keyboardInteraction.active)return t.keyboardInteraction;if(t.syncInteraction.active&&t.syncInteraction.index!=null)return t.syncInteraction;var l=t.settings.active===!0;if(due(i)){if(l)return w1(w1({},i),{},{active:!0})}else if(n!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:n,graphicalItemId:void 0};return w1(w1({},_p),{},{coordinate:i.coordinate})};function pue(t){if(typeof t=="number")return Number.isFinite(t)?t:void 0;if(t instanceof Date){var e=t.valueOf();return Number.isFinite(e)?e:void 0}var r=Number(t);return Number.isFinite(r)?r:void 0}function gue(t,e){var r=pue(t),n=e[0],i=e[1];if(r===void 0)return!1;var l=Math.min(n,i),c=Math.max(n,i);return r>=l&&r<=c}function mue(t,e,r){if(r==null||e==null)return!0;var n=vs(t,e);return n==null||!ad(r)?!0:gue(n,r)}var cM=(t,e,r,n)=>{var i=t?.index;if(i==null)return null;var l=Number(i);if(!Br(l))return i;var c=0,s=1/0;e.length>0&&(s=e.length-1);var m=Math.max(c,Math.min(l,s)),b=e[m];return b==null||mue(b,r,n)?String(m):null},N5=(t,e,r,n,i,l,c)=>{if(l!=null){var s=c[0],m=s?.getPosition(l);if(m!=null)return m;var b=i?.[Number(l)];if(b)return r==="horizontal"?{x:b.coordinate,y:(n.top+e)/2}:{x:(n.left+t)/2,y:b.coordinate}}},z5=(t,e,r,n)=>{if(e==="axis")return t.tooltipItemPayloads;if(t.tooltipItemPayloads.length===0)return[];var i;if(r==="hover"?i=t.itemInteraction.hover.graphicalItemId:i=t.itemInteraction.click.graphicalItemId,i==null&&n!=null){var l=t.tooltipItemPayloads[0];return l!=null?[l]:[]}return t.tooltipItemPayloads.filter(c=>{var s;return((s=c.settings)===null||s===void 0?void 0:s.graphicalItemId)===i})},B5=t=>t.options.tooltipPayloadSearcher,tv=t=>t.tooltip;function oN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function lN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?oN(Object(r),!0).forEach(function(n){_ue(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function _ue(t,e,r){return(e=yue(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function yue(t){var e=vue(t,"string");return typeof e=="symbol"?e:e+""}function vue(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bue(t,e){return t??e}var F5=(t,e,r,n,i,l,c)=>{if(!(e==null||l==null)){var{chartData:s,computedData:m,dataStartIndex:b,dataEndIndex:w}=r,E=[];return t.reduce((O,N)=>{var V,{dataDefinedOnItem:W,settings:j}=N,Y=bue(W,s),ce=Array.isArray(Y)?K6(Y,b,w):Y,re=(V=j?.dataKey)!==null&&V!==void 0?V:n,ue=j?.nameKey,me;if(n&&Array.isArray(ce)&&!Array.isArray(ce[0])&&c==="axis"?me=a6(ce,n,i):me=l(ce,e,m,ue),Array.isArray(me))me.forEach(Ce=>{var We=lN(lN({},j),{},{name:Ce.name,unit:Ce.unit,color:void 0,fill:void 0});O.push(qk({tooltipEntrySettings:We,dataKey:Ce.dataKey,payload:Ce.payload,value:vs(Ce.payload,Ce.dataKey),name:Ce.name}))});else{var ge;O.push(qk({tooltipEntrySettings:j,dataKey:re,payload:me,value:vs(me,re),name:(ge=vs(me,ue))!==null&&ge!==void 0?ge:j?.name}))}return O},E)}},uM=bt([ws,Zj,W3],y5),xue=bt([t=>t.graphicalItems.cartesianItems,t=>t.graphicalItems.polarItems],(t,e)=>[...t,...e]),wue=bt([Hs,Qy],Yj),rv=bt([xue,ws,wue],Kj,{memoizeOptions:{resultEqualityCheck:c2}}),Tue=bt([rv],t=>t.filter(K3)),Sue=bt([rv],e5,{memoizeOptions:{resultEqualityCheck:c2}}),nv=bt([Sue,hd],t5),Aue=bt([Tue,hd,ws],qj),hM=bt([nv,ws,rv],r5),j5=bt([ws],tM),Eue=bt([ws],t=>t.allowDataOverflow),U5=bt([j5,Eue],Cj),Pue=bt([rv],t=>t.filter(K3)),Cue=bt([Aue,Pue,n2,Fj],i5),Mue=bt([Cue,hd,Hs,U5],a5),Iue=bt([rv],Jj),Rue=bt([nv,ws,Iue,rM,Hs],c5,{memoizeOptions:{resultEqualityCheck:l2}}),Oue=bt([u5,Hs,Qy],Jy),Due=bt([Oue,Hs],d5),kue=bt([h5,Hs,Qy],Jy),Lue=bt([kue,Hs],p5),Nue=bt([f5,Hs,Qy],Jy),zue=bt([Nue,Hs],g5),Bue=bt([Due,zue,Lue],nT),Fue=bt([ws,j5,U5,Mue,Rue,Bue,ai,Hs],m5),Bb=bt([ws,ai,nv,hM,n2,Hs,Fue],_5),jue=bt([Bb,ws,uM],v5),Uue=bt([ws,Bb,jue,Hs],b5),V5=t=>{var e=Hs(t),r=Qy(t),n=!1;return zb(t,e,r,n)},$5=bt([ws,V5],i2),W5=bt([ws,uM,Uue,$5],iM),Vue=bt([ai,hM,ws,Hs],A5),$ue=bt([ai,hM,ws,Hs],E5),Wue=(t,e,r,n,i,l,c,s)=>{if(e){var{type:m}=e,b=Ru(t,s);if(n){var w=r==="scaleBand"&&n.bandwidth?n.bandwidth()/2:2,E=m==="category"&&n.bandwidth?n.bandwidth()/w:0;return E=s==="angleAxis"&&i!=null&&i?.length>=2?mc(i[0]-i[1])*2*E:E,b&&c?c.map((O,N)=>{var V=n.map(O);return Br(V)?{coordinate:V+E,value:O,index:N,offset:E}:null}).filter(Xo):n.domain().map((O,N)=>{var V=n.map(O);return Br(V)?{coordinate:V+E,value:l?l[O]:O,index:N,offset:E}:null}).filter(Xo)}}},fd=bt([ai,ws,uM,W5,V5,Vue,$ue,Hs],Wue),fM=bt([C5,M5,eue],(t,e,r)=>I5(r.shared,t,e)),H5=t=>t.tooltip.settings.trigger,dM=t=>t.tooltip.settings.defaultIndex,Fb=bt([tv,fM,H5,dM],L5),ub=bt([Fb,nv,Nb,Bb],cM),q5=bt([fd,ub],R5),Hue=bt([Fb],t=>{if(t)return t.dataKey});bt([Fb],t=>{if(t)return t.graphicalItemId});var X5=bt([tv,fM,H5,dM],z5),que=bt([cd,ud,ai,xa,fd,dM,X5],N5),Xue=bt([Fb,que],(t,e)=>t!=null&&t.coordinate?t.coordinate:e),Gue=bt([Fb],t=>{var e;return(e=t?.active)!==null&&e!==void 0?e:!1}),Zue=bt([X5,ub,hd,Nb,q5,B5,fM],F5),Yue=bt([Zue],t=>{if(t!=null){var e=t.map(r=>r.payload).filter(r=>r!=null);return Array.from(new Set(e))}});function cN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function uN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cN(Object(r),!0).forEach(function(n){Kue(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Kue(t,e,r){return(e=Que(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Que(t){var e=Jue(t,"string");return typeof e=="symbol"?e:e+""}function Jue(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var ehe=()=>mr(ws),the=()=>{var t=ehe(),e=mr(fd),r=mr(W5);return Vy(!t||!r?void 0:uN(uN({},t),{},{scale:r}),e)};function hN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function cy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hN(Object(r),!0).forEach(function(n){rhe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function rhe(t,e,r){return(e=nhe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nhe(t){var e=ihe(t,"string");return typeof e=="symbol"?e:e+""}function ihe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var she=(t,e,r,n)=>{var i=e.find(l=>l&&l.index===r);if(i){if(t==="horizontal")return{x:i.coordinate,y:n.chartY};if(t==="vertical")return{x:n.chartX,y:i.coordinate}}return{x:0,y:0}},ahe=(t,e,r,n)=>{var i=e.find(b=>b&&b.index===r);if(i){if(t==="centric"){var l=i.coordinate,{radius:c}=n;return cy(cy(cy({},n),_a(n.cx,n.cy,c,l)),{},{angle:l,radius:c})}var s=i.coordinate,{angle:m}=n;return cy(cy(cy({},n),_a(n.cx,n.cy,s,m)),{},{angle:m,radius:s})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}};function ohe(t,e){var{chartX:r,chartY:n}=t;return r>=e.left&&r<=e.left+e.width&&n>=e.top&&n<=e.top+e.height}var G5=(t,e,r,n,i)=>{var l,c=(l=e?.length)!==null&&l!==void 0?l:0;if(c<=1||t==null)return 0;if(n==="angleAxis"&&i!=null&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var s=0;s<c;s++){var m,b,w,E,O,N=s>0?(m=r[s-1])===null||m===void 0?void 0:m.coordinate:(b=r[c-1])===null||b===void 0?void 0:b.coordinate,V=(w=r[s])===null||w===void 0?void 0:w.coordinate,W=s>=c-1?(E=r[0])===null||E===void 0?void 0:E.coordinate:(O=r[s+1])===null||O===void 0?void 0:O.coordinate,j=void 0;if(!(N==null||V==null||W==null))if(mc(V-N)!==mc(W-V)){var Y=[];if(mc(W-V)===mc(i[1]-i[0])){j=W;var ce=V+i[1]-i[0];Y[0]=Math.min(ce,(ce+N)/2),Y[1]=Math.max(ce,(ce+N)/2)}else{j=N;var re=W+i[1]-i[0];Y[0]=Math.min(V,(re+V)/2),Y[1]=Math.max(V,(re+V)/2)}var ue=[Math.min(V,(j+V)/2),Math.max(V,(j+V)/2)];if(t>ue[0]&&t<=ue[1]||t>=Y[0]&&t<=Y[1]){var me;return(me=r[s])===null||me===void 0?void 0:me.index}}else{var ge=Math.min(N,W),Ce=Math.max(N,W);if(t>(ge+V)/2&&t<=(Ce+V)/2){var We;return(We=r[s])===null||We===void 0?void 0:We.index}}}else if(e)for(var Xe=0;Xe<c;Xe++){var Et=e[Xe];if(Et!=null){var gt=e[Xe+1],Ye=e[Xe-1];if(Xe===0&&gt!=null&&t<=(Et.coordinate+gt.coordinate)/2||Xe===c-1&&Ye!=null&&t>(Et.coordinate+Ye.coordinate)/2||Xe>0&&Xe<c-1&&Ye!=null&&gt!=null&&t>(Et.coordinate+Ye.coordinate)/2&&t<=(Et.coordinate+gt.coordinate)/2)return Et.index}}return-1},Z5=()=>mr(W3),pM=(t,e)=>e,Y5=(t,e,r)=>r,gM=(t,e,r,n)=>n,lhe=bt(fd,t=>zT(t,e=>e.coordinate)),mM=bt([tv,pM,Y5,gM],L5),_M=bt([mM,nv,Nb,Bb],cM),che=(t,e,r)=>{if(e!=null){var n=tv(t);return e==="axis"?r==="hover"?n.axisInteraction.hover.dataKey:n.axisInteraction.click.dataKey:r==="hover"?n.itemInteraction.hover.dataKey:n.itemInteraction.click.dataKey}},K5=bt([tv,pM,Y5,gM],z5),iT=bt([cd,ud,ai,xa,fd,gM,K5],N5),uhe=bt([mM,iT],(t,e)=>{var r;return(r=t.coordinate)!==null&&r!==void 0?r:e}),Q5=bt([fd,_M],R5),hhe=bt([K5,_M,hd,Nb,Q5,B5,pM],F5),fhe=bt([mM,_M],(t,e)=>({isActive:t.active&&e!=null,activeIndex:e})),dhe=(t,e,r,n,i,l,c)=>{if(!(!t||!r||!n||!i)&&ohe(t,c)){var s=mae(t,e),m=G5(s,l,i,r,n),b=she(e,i,m,t);return{activeIndex:String(m),activeCoordinate:b}}},phe=(t,e,r,n,i,l,c)=>{if(!(!t||!n||!i||!l||!r)){var s=Sle(t,r);if(s){var m=_ae(s,e),b=G5(m,c,l,n,i),w=ahe(e,l,b,s);return{activeIndex:String(b),activeCoordinate:w}}}},ghe=(t,e,r,n,i,l,c,s)=>{if(!(!t||!e||!n||!i||!l))return e==="horizontal"||e==="vertical"?dhe(t,e,n,i,l,c,s):phe(t,e,r,n,i,l,c)},mhe=bt(t=>t.zIndex.zIndexMap,(t,e)=>e,(t,e,r)=>r,(t,e,r)=>{if(e!=null){var n=t[e];if(n!=null)return r?n.panoramaElement:n.element}}),_he=bt(t=>t.zIndex.zIndexMap,t=>{var e=Object.keys(t).map(n=>parseInt(n,10)).concat(Object.values(ya)),r=Array.from(new Set(e));return r.sort((n,i)=>n-i)},{memoizeOptions:{resultEqualityCheck:Yle}});function fN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function dN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?fN(Object(r),!0).forEach(function(n){yhe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function yhe(t,e,r){return(e=vhe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vhe(t){var e=bhe(t,"string");return typeof e=="symbol"?e:e+""}function bhe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var xhe={},whe={zIndexMap:Object.values(ya).reduce((t,e)=>dN(dN({},t),{},{[e]:{element:void 0,panoramaElement:void 0,consumers:0}}),xhe)},The=new Set(Object.values(ya));function She(t){return The.has(t)}var J5=Go({name:"zIndex",initialState:whe,reducers:{registerZIndexPortal:{reducer:(t,e)=>{var{zIndex:r}=e.payload;t.zIndexMap[r]?t.zIndexMap[r].consumers+=1:t.zIndexMap[r]={consumers:1,element:void 0,panoramaElement:void 0}},prepare:mi()},unregisterZIndexPortal:{reducer:(t,e)=>{var{zIndex:r}=e.payload;t.zIndexMap[r]&&(t.zIndexMap[r].consumers-=1,t.zIndexMap[r].consumers<=0&&!She(r)&&delete t.zIndexMap[r])},prepare:mi()},registerZIndexPortalElement:{reducer:(t,e)=>{var{zIndex:r,element:n,isPanorama:i}=e.payload;t.zIndexMap[r]?i?t.zIndexMap[r].panoramaElement=n:t.zIndexMap[r].element=n:t.zIndexMap[r]={consumers:0,element:i?void 0:n,panoramaElement:i?n:void 0}},prepare:mi()},unregisterZIndexPortalElement:{reducer:(t,e)=>{var{zIndex:r}=e.payload;t.zIndexMap[r]&&(e.payload.isPanorama?t.zIndexMap[r].panoramaElement=void 0:t.zIndexMap[r].element=void 0)},prepare:mi()}}}),{registerZIndexPortal:Ahe,unregisterZIndexPortal:Ehe,registerZIndexPortalElement:Phe,unregisterZIndexPortalElement:Che}=J5.actions,Mhe=J5.reducer;function Ou(t){var{zIndex:e,children:r}=t,n=Zae(),i=n&&e!==void 0&&e!==0,l=wa(),c=xs();ee.useLayoutEffect(()=>i?(c(Ahe({zIndex:e})),()=>{c(Ehe({zIndex:e}))}):Mm,[c,e,i]);var s=mr(m=>mhe(m,e,l));return i?s?UF.createPortal(r,s):null:r}function DP(){return DP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},DP.apply(null,arguments)}function pN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function T1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?pN(Object(r),!0).forEach(function(n){Ihe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ihe(t,e,r){return(e=Rhe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rhe(t){var e=Ohe(t,"string");return typeof e=="symbol"?e:e+""}function Ohe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dhe(t){var{cursor:e,cursorComp:r,cursorProps:n}=t;return ee.isValidElement(e)?ee.cloneElement(e,n):ee.createElement(r,n)}function khe(t){var e,{coordinate:r,payload:n,index:i,offset:l,tooltipAxisBandSize:c,layout:s,cursor:m,tooltipEventType:b,chartName:w}=t,E=r,O=n,N=i;if(!m||!E||w!=="ScatterChart"&&b!=="axis")return null;var V,W,j;if(w==="ScatterChart")V=E,W=zoe,j=ya.cursorLine;else if(w==="BarChart")V=Boe(s,E,l,c),W=wj,j=ya.cursorRectangle;else if(s==="radial"&&c6(E)){var{cx:Y,cy:ce,radius:re,startAngle:ue,endAngle:me}=Tj(E);V={cx:Y,cy:ce,startAngle:ue,endAngle:me,innerRadius:re,outerRadius:re},W=Aj,j=ya.cursorLine}else V={points:Cle(s,E,l)},W=F0,j=ya.cursorLine;var ge=typeof m=="object"&&"className"in m?m.className:void 0,Ce=T1(T1(T1(T1({stroke:"#ccc",pointerEvents:"none"},l),V),OT(m)),{},{payload:O,payloadIndex:N,className:Ln("recharts-tooltip-cursor",ge)});return ee.createElement(Ou,{zIndex:(e=t.zIndex)!==null&&e!==void 0?e:j},ee.createElement(Dhe,{cursor:m,cursorComp:W,cursorProps:Ce}))}function Lhe(t){var e=the(),r=aj(),n=Im(),i=Z5();return e==null||r==null||n==null||i==null?null:ee.createElement(khe,DP({},t,{offset:r,layout:n,tooltipAxisBandSize:e,chartName:i}))}var eU=ee.createContext(null),Nhe=()=>ee.useContext(eU),QA={exports:{}},gN;function zhe(){return gN||(gN=1,(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(m,b,w){this.fn=m,this.context=b,this.once=w||!1}function l(m,b,w,E,O){if(typeof w!="function")throw new TypeError("The listener must be a function");var N=new i(w,E||m,O),V=r?r+b:b;return m._events[V]?m._events[V].fn?m._events[V]=[m._events[V],N]:m._events[V].push(N):(m._events[V]=N,m._eventsCount++),m}function c(m,b){--m._eventsCount===0?m._events=new n:delete m._events[b]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var b=[],w,E;if(this._eventsCount===0)return b;for(E in w=this._events)e.call(w,E)&&b.push(r?E.slice(1):E);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(w)):b},s.prototype.listeners=function(b){var w=r?r+b:b,E=this._events[w];if(!E)return[];if(E.fn)return[E.fn];for(var O=0,N=E.length,V=new Array(N);O<N;O++)V[O]=E[O].fn;return V},s.prototype.listenerCount=function(b){var w=r?r+b:b,E=this._events[w];return E?E.fn?1:E.length:0},s.prototype.emit=function(b,w,E,O,N,V){var W=r?r+b:b;if(!this._events[W])return!1;var j=this._events[W],Y=arguments.length,ce,re;if(j.fn){switch(j.once&&this.removeListener(b,j.fn,void 0,!0),Y){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,w),!0;case 3:return j.fn.call(j.context,w,E),!0;case 4:return j.fn.call(j.context,w,E,O),!0;case 5:return j.fn.call(j.context,w,E,O,N),!0;case 6:return j.fn.call(j.context,w,E,O,N,V),!0}for(re=1,ce=new Array(Y-1);re<Y;re++)ce[re-1]=arguments[re];j.fn.apply(j.context,ce)}else{var ue=j.length,me;for(re=0;re<ue;re++)switch(j[re].once&&this.removeListener(b,j[re].fn,void 0,!0),Y){case 1:j[re].fn.call(j[re].context);break;case 2:j[re].fn.call(j[re].context,w);break;case 3:j[re].fn.call(j[re].context,w,E);break;case 4:j[re].fn.call(j[re].context,w,E,O);break;default:if(!ce)for(me=1,ce=new Array(Y-1);me<Y;me++)ce[me-1]=arguments[me];j[re].fn.apply(j[re].context,ce)}}return!0},s.prototype.on=function(b,w,E){return l(this,b,w,E,!1)},s.prototype.once=function(b,w,E){return l(this,b,w,E,!0)},s.prototype.removeListener=function(b,w,E,O){var N=r?r+b:b;if(!this._events[N])return this;if(!w)return c(this,N),this;var V=this._events[N];if(V.fn)V.fn===w&&(!O||V.once)&&(!E||V.context===E)&&c(this,N);else{for(var W=0,j=[],Y=V.length;W<Y;W++)(V[W].fn!==w||O&&!V[W].once||E&&V[W].context!==E)&&j.push(V[W]);j.length?this._events[N]=j.length===1?j[0]:j:c(this,N)}return this},s.prototype.removeAllListeners=function(b){var w;return b?(w=r?r+b:b,this._events[w]&&c(this,w)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s})(QA)),QA.exports}var Bhe=zhe();const Fhe=Fh(Bhe);var hb=new Fhe,kP="recharts.syncEvent.tooltip",mN="recharts.syncEvent.brush",tU=(t,e)=>{if(e&&Array.isArray(t)){var r=Number.parseInt(e,10);if(!Nh(r))return t[r]}},jhe={chartName:"",tooltipPayloadSearcher:()=>{},eventEmitter:void 0,defaultTooltipEventType:"axis"},rU=Go({name:"options",initialState:jhe,reducers:{createEventEmitter:t=>{t.eventEmitter==null&&(t.eventEmitter=Symbol("rechartsEventEmitter"))}}}),Uhe=rU.reducer,{createEventEmitter:Vhe}=rU.actions;function $he(t){return t.tooltip.syncInteraction}var Whe={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},nU=Go({name:"chartData",initialState:Whe,reducers:{setChartData(t,e){if(t.chartData=e.payload,e.payload==null){t.dataStartIndex=0,t.dataEndIndex=0;return}e.payload.length>0&&t.dataEndIndex!==e.payload.length-1&&(t.dataEndIndex=e.payload.length-1)},setComputedData(t,e){t.computedData=e.payload},setDataStartEndIndexes(t,e){var{startIndex:r,endIndex:n}=e.payload;r!=null&&(t.dataStartIndex=r),n!=null&&(t.dataEndIndex=n)}}}),{setChartData:_N,setDataStartEndIndexes:Hhe,setComputedData:Vye}=nU.actions,qhe=nU.reducer,Xhe=["x","y"];function yN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function uy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?yN(Object(r),!0).forEach(function(n){Ghe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ghe(t,e,r){return(e=Zhe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zhe(t){var e=Yhe(t,"string");return typeof e=="symbol"?e:e+""}function Yhe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Khe(t,e){if(t==null)return{};var r,n,i=Qhe(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Qhe(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function Jhe(){var t=mr(H3),e=mr(q3),r=xs(),n=mr(jj),i=mr(fd),l=Im(),c=Ib(),s=mr(m=>m.rootProps.className);ee.useEffect(()=>{if(t==null)return Mm;var m=(b,w,E)=>{if(e!==E&&t===b){if(n==="index"){var O;if(c&&w!==null&&w!==void 0&&(O=w.payload)!==null&&O!==void 0&&O.coordinate&&w.payload.sourceViewBox){var N=w.payload.coordinate,{x:V,y:W}=N,j=Khe(N,Xhe),{x:Y,y:ce,width:re,height:ue}=w.payload.sourceViewBox,me=uy(uy({},j),{},{x:c.x+(re?(V-Y)/re:0)*c.width,y:c.y+(ue?(W-ce)/ue:0)*c.height});r(uy(uy({},w),{},{payload:uy(uy({},w.payload),{},{coordinate:me})}))}else r(w);return}if(i!=null){var ge;if(typeof n=="function"){var Ce={activeTooltipIndex:w.payload.index==null?void 0:Number(w.payload.index),isTooltipActive:w.payload.active,activeIndex:w.payload.index==null?void 0:Number(w.payload.index),activeLabel:w.payload.label,activeDataKey:w.payload.dataKey,activeCoordinate:w.payload.coordinate},We=n(i,Ce);ge=i[We]}else n==="value"&&(ge=i.find(fe=>String(fe.value)===w.payload.label));var{coordinate:Xe}=w.payload;if(ge==null||w.payload.active===!1||Xe==null||c==null){r(RP({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}));return}var{x:Et,y:gt}=Xe,Ye=Math.min(Et,c.x+c.width),jt=Math.min(gt,c.y+c.height),St={x:l==="horizontal"?ge.coordinate:Ye,y:l==="horizontal"?jt:ge.coordinate},Zt=RP({active:w.payload.active,coordinate:St,dataKey:w.payload.dataKey,index:String(ge.index),label:w.payload.label,sourceViewBox:w.payload.sourceViewBox,graphicalItemId:w.payload.graphicalItemId});r(Zt)}}};return hb.on(kP,m),()=>{hb.off(kP,m)}},[s,r,e,t,n,i,l,c])}function efe(){var t=mr(H3),e=mr(q3),r=xs();ee.useEffect(()=>{if(t==null)return Mm;var n=(i,l,c)=>{e!==c&&t===i&&r(Hhe(l))};return hb.on(mN,n),()=>{hb.off(mN,n)}},[r,e,t])}function tfe(){var t=xs();ee.useEffect(()=>{t(Vhe())},[t]),Jhe(),efe()}function rfe(t,e,r,n,i,l){var c=mr(N=>che(N,t,e)),s=mr(q3),m=mr(H3),b=mr(jj),w=mr($he),E=w?.active,O=Ib();ee.useEffect(()=>{if(!E&&m!=null&&s!=null){var N=RP({active:l,coordinate:r,dataKey:c,index:i,label:typeof n=="number"?String(n):n,sourceViewBox:O,graphicalItemId:void 0});hb.emit(kP,m,N,s)}},[E,r,c,i,n,s,m,b,l,O])}function vN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function bN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vN(Object(r),!0).forEach(function(n){nfe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function nfe(t,e,r){return(e=ife(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ife(t){var e=sfe(t,"string");return typeof e=="symbol"?e:e+""}function sfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function afe(t){return t.dataKey}function ofe(t,e){return ee.isValidElement(t)?ee.cloneElement(t,e):typeof t=="function"?ee.createElement(t,e):ee.createElement(moe,e)}var xN=[],lfe={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,includeHidden:!1,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function iU(t){var e,r,n=ba(t,lfe),{active:i,allowEscapeViewBox:l,animationDuration:c,animationEasing:s,content:m,filterNull:b,isAnimationActive:w,offset:E,payloadUniqBy:O,position:N,reverseDirection:V,useTranslate3d:W,wrapperStyle:j,cursor:Y,shared:ce,trigger:re,defaultIndex:ue,portal:me,axisId:ge}=n,Ce=xs(),We=typeof ue=="number"?String(ue):ue;ee.useEffect(()=>{Ce(sue({shared:ce,trigger:re,axisId:ge,active:i,defaultIndex:We}))},[Ce,ce,re,ge,i,We]);var Xe=Ib(),Et=_j(),gt=Jce(ce),{activeIndex:Ye,isActive:jt}=(e=mr(Wt=>fhe(Wt,gt,re,We)))!==null&&e!==void 0?e:{},St=mr(Wt=>hhe(Wt,gt,re,We)),Zt=mr(Wt=>Q5(Wt,gt,re,We)),fe=mr(Wt=>uhe(Wt,gt,re,We)),Me=St,Ee=Nhe(),Ue=(r=i??jt)!==null&&r!==void 0?r:!1,[st,ye]=nse([Me,Ue]),Be=gt==="axis"?Zt:void 0;rfe(gt,re,fe,Be,Ye,Ue);var lt=me??Ee;if(lt==null||Xe==null||gt==null)return null;var Tt=Me??xN;Ue||(Tt=xN),b&&Tt.length&&(Tt=Mie(Tt.filter(Wt=>Wt.value!=null&&(Wt.hide!==!0||n.includeHidden)),O,afe));var zt=Tt.length>0,Xt=ee.createElement(Toe,{allowEscapeViewBox:l,animationDuration:c,animationEasing:s,isAnimationActive:w,active:Ue,coordinate:fe,hasPayload:zt,offset:E,position:N,reverseDirection:V,useTranslate3d:W,viewBox:Xe,wrapperStyle:j,lastBoundingBox:st,innerRef:ye,hasPortalFromProps:!!me},ofe(m,bN(bN({},n),{},{payload:Tt,label:Be,active:Ue,activeIndex:Ye,coordinate:fe,accessibilityLayer:Et})));return ee.createElement(ee.Fragment,null,UF.createPortal(Xt,lt),Ue&&ee.createElement(Lhe,{cursor:Y,tooltipEventType:gt,coordinate:fe,payload:Tt,index:Ye}))}function cfe(t,e,r){return(e=ufe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ufe(t){var e=hfe(t,"string");return typeof e=="symbol"?e:e+""}function hfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class ffe{constructor(e){cfe(this,"cache",new Map),this.maxSize=e}get(e){var r=this.cache.get(e);return r!==void 0&&(this.cache.delete(e),this.cache.set(e,r)),r}set(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var n=this.cache.keys().next().value;n!=null&&this.cache.delete(n)}this.cache.set(e,r)}clear(){this.cache.clear()}size(){return this.cache.size}}function wN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function dfe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wN(Object(r),!0).forEach(function(n){pfe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function pfe(t,e,r){return(e=gfe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gfe(t){var e=mfe(t,"string");return typeof e=="symbol"?e:e+""}function mfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var _fe={cacheSize:2e3,enableCache:!0},sU=dfe({},_fe),TN=new ffe(sU.cacheSize),yfe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},SN="recharts_measurement_span";function vfe(t,e){var r=e.fontSize||"",n=e.fontFamily||"",i=e.fontWeight||"",l=e.fontStyle||"",c=e.letterSpacing||"",s=e.textTransform||"";return"".concat(t,"|").concat(r,"|").concat(n,"|").concat(i,"|").concat(l,"|").concat(c,"|").concat(s)}var AN=(t,e)=>{try{var r=document.getElementById(SN);r||(r=document.createElement("span"),r.setAttribute("id",SN),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,yfe,e),r.textContent="".concat(t);var n=r.getBoundingClientRect();return{width:n.width,height:n.height}}catch{return{width:0,height:0}}},j0=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||Db.isSsr)return{width:0,height:0};if(!sU.enableCache)return AN(e,r);var n=vfe(e,r),i=TN.get(n);if(i)return i;var l=AN(e,r);return TN.set(n,l),l},aU;function bfe(t,e,r){return(e=xfe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function xfe(t){var e=wfe(t,"string");return typeof e=="symbol"?e:e+""}function wfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var EN=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,PN=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Tfe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,Sfe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Afe={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Efe=["cm","mm","pt","pc","in","Q","px"];function Pfe(t){return Efe.includes(t)}var xy="NaN";function Cfe(t,e){return t*Afe[e]}class ma{static parse(e){var r,[,n,i]=(r=Sfe.exec(e))!==null&&r!==void 0?r:[];return n==null?ma.NaN:new ma(parseFloat(n),i??"")}constructor(e,r){this.num=e,this.unit=r,this.num=e,this.unit=r,Nh(e)&&(this.unit=""),r!==""&&!Tfe.test(r)&&(this.num=NaN,this.unit=""),Pfe(r)&&(this.num=Cfe(e,r),this.unit="px")}add(e){return this.unit!==e.unit?new ma(NaN,""):new ma(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new ma(NaN,""):new ma(this.num-e.num,this.unit)}multiply(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new ma(NaN,""):new ma(this.num*e.num,this.unit||e.unit)}divide(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new ma(NaN,""):new ma(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return Nh(this.num)}}aU=ma;bfe(ma,"NaN",new aU(NaN,""));function oU(t){if(t==null||t.includes(xy))return xy;for(var e=t;e.includes("*")||e.includes("/");){var r,[,n,i,l]=(r=EN.exec(e))!==null&&r!==void 0?r:[],c=ma.parse(n??""),s=ma.parse(l??""),m=i==="*"?c.multiply(s):c.divide(s);if(m.isNaN())return xy;e=e.replace(EN,m.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var b,[,w,E,O]=(b=PN.exec(e))!==null&&b!==void 0?b:[],N=ma.parse(w??""),V=ma.parse(O??""),W=E==="+"?N.add(V):N.subtract(V);if(W.isNaN())return xy;e=e.replace(PN,W.toString())}return e}var CN=/\(([^()]*)\)/;function Mfe(t){for(var e=t,r;(r=CN.exec(e))!=null;){var[,n]=r;e=e.replace(CN,oU(n))}return e}function Ife(t){var e=t.replace(/\s+/g,"");return e=Mfe(e),e=oU(e),e}function Rfe(t){try{return Ife(t)}catch{return xy}}function JA(t){var e=Rfe(t.slice(5,-1));return e===xy?"":e}var Ofe=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],Dfe=["dx","dy","angle","className","breakAll"];function LP(){return LP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},LP.apply(null,arguments)}function MN(t,e){if(t==null)return{};var r,n,i=kfe(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function kfe(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var lU=/[ \f\n\r\t\v\u2028\u2029]+/,cU=t=>{var{children:e,breakAll:r,style:n}=t;try{var i=[];Vs(e)||(r?i=e.toString().split(""):i=e.toString().split(lU));var l=i.map(s=>({word:s,width:j0(s,n).width})),c=r?0:j0("",n).width;return{wordsWithComputedWidth:l,spaceWidth:c}}catch{return null}};function Lfe(t){return t==="start"||t==="middle"||t==="end"||t==="inherit"}var uU=(t,e,r,n)=>t.reduce((i,l)=>{var{word:c,width:s}=l,m=i[i.length-1];if(m&&s!=null&&(e==null||n||m.width+s+r<Number(e)))m.words.push(c),m.width+=s+r;else{var b={words:[c],width:s};i.push(b)}return i},[]),hU=t=>t.reduce((e,r)=>e.width>r.width?e:r),Nfe="",IN=(t,e,r,n,i,l,c,s)=>{var m=t.slice(0,e),b=cU({breakAll:r,style:n,children:m+Nfe});if(!b)return[!1,[]];var w=uU(b.wordsWithComputedWidth,l,c,s),E=w.length>i||hU(w).width>Number(l);return[E,w]},zfe=(t,e,r,n,i)=>{var{maxLines:l,children:c,style:s,breakAll:m}=t,b=cr(l),w=String(c),E=uU(e,n,r,i);if(!b||i)return E;var O=E.length>l||hU(E).width>Number(n);if(!O)return E;for(var N=0,V=w.length-1,W=0,j;N<=V&&W<=w.length-1;){var Y=Math.floor((N+V)/2),ce=Y-1,[re,ue]=IN(w,ce,m,s,l,n,r,i),[me]=IN(w,Y,m,s,l,n,r,i);if(!re&&!me&&(N=Y+1),re&&me&&(V=Y-1),!re&&me){j=ue;break}W++}return j||E},RN=t=>{var e=Vs(t)?[]:t.toString().split(lU);return[{words:e,width:void 0}]},Bfe=t=>{var{width:e,scaleToFit:r,children:n,style:i,breakAll:l,maxLines:c}=t;if((e||r)&&!Db.isSsr){var s,m,b=cU({breakAll:l,children:n,style:i});if(b){var{wordsWithComputedWidth:w,spaceWidth:E}=b;s=w,m=E}else return RN(n);return zfe({breakAll:l,children:n,maxLines:c,style:i},s,m,e,!!r)}return RN(n)},fU="#808080",Ffe={angle:0,breakAll:!1,capHeight:"0.71em",fill:fU,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},yM=ee.forwardRef((t,e)=>{var r=ba(t,Ffe),{x:n,y:i,lineHeight:l,capHeight:c,fill:s,scaleToFit:m,textAnchor:b,verticalAnchor:w}=r,E=MN(r,Ofe),O=ee.useMemo(()=>Bfe({breakAll:E.breakAll,children:E.children,maxLines:E.maxLines,scaleToFit:m,style:E.style,width:E.width}),[E.breakAll,E.children,E.maxLines,m,E.style,E.width]),{dx:N,dy:V,angle:W,className:j,breakAll:Y}=E,ce=MN(E,Dfe);if(!wc(n)||!wc(i)||O.length===0)return null;var re=Number(n)+(cr(N)?N:0),ue=Number(i)+(cr(V)?V:0);if(!Br(re)||!Br(ue))return null;var me;switch(w){case"start":me=JA("calc(".concat(c,")"));break;case"middle":me=JA("calc(".concat((O.length-1)/2," * -").concat(l," + (").concat(c," / 2))"));break;default:me=JA("calc(".concat(O.length-1," * -").concat(l,")"));break}var ge=[],Ce=O[0];if(m&&Ce!=null){var We=Ce.width,{width:Xe}=E;ge.push("scale(".concat(cr(Xe)&&cr(We)?Xe/We:1,")"))}return W&&ge.push("rotate(".concat(W,", ").concat(re,", ").concat(ue,")")),ge.length&&(ce.transform=ge.join(" ")),ee.createElement("text",LP({},va(ce),{ref:e,x:re,y:ue,className:Ln("recharts-text",j),textAnchor:b,fill:s.includes("url")?fU:s}),O.map((Et,gt)=>{var Ye=Et.words.join(Y?"":" ");return ee.createElement("tspan",{x:re,dy:gt===0?me:l,key:"".concat(Ye,"-").concat(gt)},Ye)}))});yM.displayName="Text";function ON(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ah(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ON(Object(r),!0).forEach(function(n){jfe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ON(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function jfe(t,e,r){return(e=Ufe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ufe(t){var e=Vfe(t,"string");return typeof e=="symbol"?e:e+""}function Vfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $fe=t=>{var{viewBox:e,position:r,offset:n=0,parentViewBox:i}=t,{x:l,y:c,height:s,upperWidth:m,lowerWidth:b}=z3(e),w=l,E=l+(m-b)/2,O=(w+E)/2,N=(m+b)/2,V=w+m/2,W=s>=0?1:-1,j=W*n,Y=W>0?"end":"start",ce=W>0?"start":"end",re=m>=0?1:-1,ue=re*n,me=re>0?"end":"start",ge=re>0?"start":"end",Ce=i;if(r==="top"){var We={x:w+m/2,y:c-j,horizontalAnchor:"middle",verticalAnchor:Y};return Ce&&(We.height=Math.max(c-Ce.y,0),We.width=m),We}if(r==="bottom"){var Xe={x:E+b/2,y:c+s+j,horizontalAnchor:"middle",verticalAnchor:ce};return Ce&&(Xe.height=Math.max(Ce.y+Ce.height-(c+s),0),Xe.width=b),Xe}if(r==="left"){var Et={x:O-ue,y:c+s/2,horizontalAnchor:me,verticalAnchor:"middle"};return Ce&&(Et.width=Math.max(Et.x-Ce.x,0),Et.height=s),Et}if(r==="right"){var gt={x:O+N+ue,y:c+s/2,horizontalAnchor:ge,verticalAnchor:"middle"};return Ce&&(gt.width=Math.max(Ce.x+Ce.width-gt.x,0),gt.height=s),gt}var Ye=Ce?{width:N,height:s}:{};return r==="insideLeft"?Ah({x:O+ue,y:c+s/2,horizontalAnchor:ge,verticalAnchor:"middle"},Ye):r==="insideRight"?Ah({x:O+N-ue,y:c+s/2,horizontalAnchor:me,verticalAnchor:"middle"},Ye):r==="insideTop"?Ah({x:w+m/2,y:c+j,horizontalAnchor:"middle",verticalAnchor:ce},Ye):r==="insideBottom"?Ah({x:E+b/2,y:c+s-j,horizontalAnchor:"middle",verticalAnchor:Y},Ye):r==="insideTopLeft"?Ah({x:w+ue,y:c+j,horizontalAnchor:ge,verticalAnchor:ce},Ye):r==="insideTopRight"?Ah({x:w+m-ue,y:c+j,horizontalAnchor:me,verticalAnchor:ce},Ye):r==="insideBottomLeft"?Ah({x:E+ue,y:c+s-j,horizontalAnchor:ge,verticalAnchor:Y},Ye):r==="insideBottomRight"?Ah({x:E+b-ue,y:c+s-j,horizontalAnchor:me,verticalAnchor:Y},Ye):r&&typeof r=="object"&&(cr(r.x)||ym(r.x))&&(cr(r.y)||ym(r.y))?Ah({x:l+Cp(r.x,N),y:c+Cp(r.y,s),horizontalAnchor:"end",verticalAnchor:"end"},Ye):Ah({x:V,y:c+s/2,horizontalAnchor:"middle",verticalAnchor:"middle"},Ye)},Wfe=["labelRef"],Hfe=["content"];function DN(t,e){if(t==null)return{};var r,n,i=qfe(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function qfe(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function kN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function C0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kN(Object(r),!0).forEach(function(n){Xfe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Xfe(t,e,r){return(e=Gfe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Gfe(t){var e=Zfe(t,"string");return typeof e=="symbol"?e:e+""}function Zfe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Zf(){return Zf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Zf.apply(null,arguments)}var dU=ee.createContext(null),pU=t=>{var{x:e,y:r,upperWidth:n,lowerWidth:i,width:l,height:c,children:s}=t,m=ee.useMemo(()=>({x:e,y:r,upperWidth:n,lowerWidth:i,width:l,height:c}),[e,r,n,i,l,c]);return ee.createElement(dU.Provider,{value:m},s)},gU=()=>{var t=ee.useContext(dU),e=Ib();return t||(e?z3(e):void 0)},Yfe=ee.createContext(null),Kfe=()=>{var t=ee.useContext(Yfe),e=mr(Hj);return t||e},Qfe=t=>{var{value:e,formatter:r}=t,n=Vs(t.children)?e:t.children;return typeof r=="function"?r(n):n},vM=t=>t!=null&&typeof t=="function",Jfe=(t,e)=>{var r=mc(e-t),n=Math.min(Math.abs(e-t),360);return r*n},ede=(t,e,r,n,i)=>{var{offset:l,className:c}=t,{cx:s,cy:m,innerRadius:b,outerRadius:w,startAngle:E,endAngle:O,clockWise:N}=i,V=(b+w)/2,W=Jfe(E,O),j=W>=0?1:-1,Y,ce;switch(e){case"insideStart":Y=E+j*l,ce=N;break;case"insideEnd":Y=O-j*l,ce=!N;break;case"end":Y=O+j*l,ce=N;break;default:throw new Error("Unsupported position ".concat(e))}ce=W<=0?ce:!ce;var re=_a(s,m,V,Y),ue=_a(s,m,V,Y+(ce?1:-1)*359),me="M".concat(re.x,",").concat(re.y,`
    A`).concat(V,",").concat(V,",0,1,").concat(ce?0:1,`,
    `).concat(ue.x,",").concat(ue.y),ge=Vs(t.id)?tb("recharts-radial-line-"):t.id;return ee.createElement("text",Zf({},n,{dominantBaseline:"central",className:Ln("recharts-radial-bar-label",c)}),ee.createElement("defs",null,ee.createElement("path",{id:ge,d:me})),ee.createElement("textPath",{xlinkHref:"#".concat(ge)},r))},tde=(t,e,r)=>{var{cx:n,cy:i,innerRadius:l,outerRadius:c,startAngle:s,endAngle:m}=t,b=(s+m)/2;if(r==="outside"){var{x:w,y:E}=_a(n,i,c+e,b);return{x:w,y:E,textAnchor:w>=n?"start":"end",verticalAnchor:"middle"}}if(r==="center")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(r==="centerTop")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"start"};if(r==="centerBottom")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"end"};var O=(l+c)/2,{x:N,y:V}=_a(n,i,O,b);return{x:N,y:V,textAnchor:"middle",verticalAnchor:"middle"}},q1=t=>t!=null&&"cx"in t&&cr(t.cx),rde={angle:0,offset:5,zIndex:ya.label,position:"middle",textBreakAll:!1};function nde(t){if(!q1(t))return t;var{cx:e,cy:r,outerRadius:n}=t,i=n*2;return{x:e-n,y:r-n,width:i,upperWidth:i,lowerWidth:i,height:i}}function gp(t){var e=ba(t,rde),{viewBox:r,parentViewBox:n,position:i,value:l,children:c,content:s,className:m="",textBreakAll:b,labelRef:w}=e,E=Kfe(),O=gU(),N=i==="center"?O:E??O,V,W,j;r==null?V=N:q1(r)?V=r:V=z3(r);var Y=nde(V);if(!V||Vs(l)&&Vs(c)&&!ee.isValidElement(s)&&typeof s!="function")return null;var ce=C0(C0({},e),{},{viewBox:V});if(ee.isValidElement(s)){var{labelRef:re}=ce,ue=DN(ce,Wfe);return ee.cloneElement(s,ue)}if(typeof s=="function"){var{content:me}=ce,ge=DN(ce,Hfe);if(W=ee.createElement(s,ge),ee.isValidElement(W))return W}else W=Qfe(e);var Ce=va(e);if(q1(V)){if(i==="insideStart"||i==="insideEnd"||i==="end")return ede(e,i,W,Ce,V);j=tde(V,e.offset,e.position)}else{if(!Y)return null;var We=$fe({viewBox:Y,position:i,offset:e.offset,parentViewBox:q1(n)?void 0:n});j=C0(C0({x:We.x,y:We.y,textAnchor:We.horizontalAnchor,verticalAnchor:We.verticalAnchor},We.width!==void 0?{width:We.width}:{}),We.height!==void 0?{height:We.height}:{})}return ee.createElement(Ou,{zIndex:e.zIndex},ee.createElement(yM,Zf({ref:w,className:Ln("recharts-label",m)},Ce,j,{textAnchor:Lfe(Ce.textAnchor)?Ce.textAnchor:j.textAnchor,breakAll:b}),W))}gp.displayName="Label";var ide=(t,e,r)=>{if(!t)return null;var n={viewBox:e,labelRef:r};return t===!0?ee.createElement(gp,Zf({key:"label-implicit"},n)):wc(t)?ee.createElement(gp,Zf({key:"label-implicit",value:t},n)):ee.isValidElement(t)?t.type===gp?ee.cloneElement(t,C0({key:"label-implicit"},n)):ee.createElement(gp,Zf({key:"label-implicit",content:t},n)):vM(t)?ee.createElement(gp,Zf({key:"label-implicit",content:t},n)):t&&typeof t=="object"?ee.createElement(gp,Zf({},t,{key:"label-implicit"},n)):null};function mU(t){var{label:e,labelRef:r}=t,n=gU();return ide(e,n,r)||null}var eE={},tE={},LN;function sde(){return LN||(LN=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r[r.length-1]}t.last=e})(tE)),tE}var rE={},NN;function ade(){return NN||(NN=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Array.isArray(r)?r:Array.from(r)}t.toArray=e})(rE)),rE}var zN;function ode(){return zN||(zN=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=sde(),r=ade(),n=P3();function i(l){if(n.isArrayLike(l))return e.last(r.toArray(l))}t.last=i})(eE)),eE}var nE,BN;function lde(){return BN||(BN=1,nE=ode().last),nE}var cde=lde();const ude=Fh(cde);var hde=["valueAccessor"],fde=["dataKey","clockWise","id","textBreakAll","zIndex"];function sT(){return sT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},sT.apply(null,arguments)}function FN(t,e){if(t==null)return{};var r,n,i=dde(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function dde(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var pde=t=>Array.isArray(t.value)?ude(t.value):t.value,_U=ee.createContext(void 0),yU=_U.Provider,vU=ee.createContext(void 0);vU.Provider;function gde(){return ee.useContext(_U)}function mde(){return ee.useContext(vU)}function X1(t){var{valueAccessor:e=pde}=t,r=FN(t,hde),{dataKey:n,clockWise:i,id:l,textBreakAll:c,zIndex:s}=r,m=FN(r,fde),b=gde(),w=mde(),E=b||w;return!E||!E.length?null:ee.createElement(Ou,{zIndex:s??ya.label},ee.createElement(Ml,{className:"recharts-label-list"},E.map((O,N)=>{var V,W=Vs(n)?e(O,N):vs(O.payload,n),j=Vs(l)?{}:{id:"".concat(l,"-").concat(N)};return ee.createElement(gp,sT({key:"label-".concat(N)},va(O),m,j,{fill:(V=r.fill)!==null&&V!==void 0?V:O.fill,parentViewBox:O.parentViewBox,value:W,textBreakAll:c,viewBox:O.viewBox,index:N,zIndex:0}))})))}X1.displayName="LabelList";function bU(t){var{label:e}=t;return e?e===!0?ee.createElement(X1,{key:"labelList-implicit"}):ee.isValidElement(e)||vM(e)?ee.createElement(X1,{key:"labelList-implicit",content:e}):typeof e=="object"?ee.createElement(X1,sT({key:"labelList-implicit"},e,{type:String(e.type)})):null:null}function NP(){return NP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},NP.apply(null,arguments)}var xU=t=>{var{cx:e,cy:r,r:n,className:i}=t,l=Ln("recharts-dot",i);return cr(e)&&cr(r)&&cr(n)?ee.createElement("circle",NP({},xc(t),E3(t),{className:l,cx:e,cy:r,r:n})):null},_de={radiusAxis:{},angleAxis:{}},wU=Go({name:"polarAxis",initialState:_de,reducers:{addRadiusAxis(t,e){t.radiusAxis[e.payload.id]=e.payload},removeRadiusAxis(t,e){delete t.radiusAxis[e.payload.id]},addAngleAxis(t,e){t.angleAxis[e.payload.id]=e.payload},removeAngleAxis(t,e){delete t.angleAxis[e.payload.id]}}}),{addRadiusAxis:$ye,removeRadiusAxis:Wye,addAngleAxis:Hye,removeAngleAxis:qye}=wU.actions,yde=wU.reducer;function vde(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var bM=t=>t&&typeof t=="object"&&"clipDot"in t?!!t.clipDot:!0,iE={},jN;function bde(){return jN||(jN=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const i=r[Symbol.toStringTag];return i==null||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable?!1:r.toString()===`[object ${i}]`}let n=r;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n}t.isPlainObject=e})(iE)),iE}var sE,UN;function xde(){return UN||(UN=1,sE=bde().isPlainObject),sE}var wde=xde();const Tde=Fh(wde);var VN,$N,WN,HN,qN;function XN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function GN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?XN(Object(r),!0).forEach(function(n){Sde(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):XN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Sde(t,e,r){return(e=Ade(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ade(t){var e=Ede(t,"string");return typeof e=="symbol"?e:e+""}function Ede(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function aT(){return aT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},aT.apply(null,arguments)}function v0(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var ZN=(t,e,r,n,i)=>{var l=r-n,c;return c=ji(VN||(VN=v0(["M ",",",""])),t,e),c+=ji($N||($N=v0(["L ",",",""])),t+r,e),c+=ji(WN||(WN=v0(["L ",",",""])),t+r-l/2,e+i),c+=ji(HN||(HN=v0(["L ",",",""])),t+r-l/2-n,e+i),c+=ji(qN||(qN=v0(["L ",","," Z"])),t,e),c},Pde={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Cde=t=>{var e=ba(t,Pde),{x:r,y:n,upperWidth:i,lowerWidth:l,height:c,className:s}=e,{animationEasing:m,animationDuration:b,animationBegin:w,isUpdateAnimationActive:E}=e,O=ee.useRef(null),[N,V]=ee.useState(-1),W=ee.useRef(i),j=ee.useRef(l),Y=ee.useRef(c),ce=ee.useRef(r),re=ee.useRef(n),ue=r2(t,"trapezoid-");if(ee.useEffect(()=>{if(O.current&&O.current.getTotalLength)try{var St=O.current.getTotalLength();St&&V(St)}catch{}},[]),r!==+r||n!==+n||i!==+i||l!==+l||c!==+c||i===0&&l===0||c===0)return null;var me=Ln("recharts-trapezoid",s);if(!E)return ee.createElement("g",null,ee.createElement("path",aT({},va(e),{className:me,d:ZN(r,n,i,l,c)})));var ge=W.current,Ce=j.current,We=Y.current,Xe=ce.current,Et=re.current,gt="0px ".concat(N===-1?1:N,"px"),Ye="".concat(N,"px 0px"),jt=yj(["strokeDasharray"],b,m);return ee.createElement(t2,{animationId:ue,key:ue,canBegin:N>0,duration:b,easing:m,isActive:E,begin:w},St=>{var Zt=rs(ge,i,St),fe=rs(Ce,l,St),Me=rs(We,c,St),Ee=rs(Xe,r,St),Ue=rs(Et,n,St);O.current&&(W.current=Zt,j.current=fe,Y.current=Me,ce.current=Ee,re.current=Ue);var st=St>0?{transition:jt,strokeDasharray:Ye}:{strokeDasharray:gt};return ee.createElement("path",aT({},va(e),{className:me,d:ZN(Ee,Ue,Zt,fe,Me),ref:O,style:GN(GN({},st),e.style)}))})},Mde=["option","shapeType","activeClassName"];function Ide(t,e){if(t==null)return{};var r,n,i=Rde(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Rde(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function YN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function oT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?YN(Object(r),!0).forEach(function(n){Ode(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):YN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ode(t,e,r){return(e=Dde(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dde(t){var e=kde(t,"string");return typeof e=="symbol"?e:e+""}function kde(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Lde(t,e){return oT(oT({},e),t)}function Nde(t,e){return t==="symbols"}function KN(t){var{shapeType:e,elementProps:r}=t;switch(e){case"rectangle":return ee.createElement(wj,r);case"trapezoid":return ee.createElement(Cde,r);case"sector":return ee.createElement(Aj,r);case"symbols":if(Nde(e))return ee.createElement(l6,r);break;case"curve":return ee.createElement(F0,r);default:return null}}function zde(t){return ee.isValidElement(t)?t.props:t}function Bde(t){var{option:e,shapeType:r,activeClassName:n="recharts-active-shape"}=t,i=Ide(t,Mde),l;if(ee.isValidElement(e))l=ee.cloneElement(e,oT(oT({},i),zde(e)));else if(typeof e=="function")l=e(i,i.index);else if(Tde(e)&&typeof e!="boolean"){var c=Lde(e,i);l=ee.createElement(KN,{shapeType:r,elementProps:c})}else{var s=i;l=ee.createElement(KN,{shapeType:r,elementProps:s})}return i.isActive?ee.createElement(Ml,{className:n},l):l}function TU(t){var{tooltipEntrySettings:e}=t,r=xs(),n=wa(),i=ee.useRef(null);return ee.useLayoutEffect(()=>{n||(i.current===null?r(rue(e)):i.current!==e&&r(nue({prev:i.current,next:e})),i.current=e)},[e,r,n]),ee.useLayoutEffect(()=>()=>{i.current&&(r(iue(i.current)),i.current=null)},[r]),null}function SU(t){var{legendPayload:e}=t,r=xs(),n=wa(),i=ee.useRef(null);return ee.useLayoutEffect(()=>{n||(i.current===null?r(loe(e)):i.current!==e&&r(coe({prev:i.current,next:e})),i.current=e)},[r,n,e]),ee.useLayoutEffect(()=>()=>{i.current&&(r(uoe(i.current)),i.current=null)},[r]),null}var aE,Fde=()=>{var[t]=ee.useState(()=>tb("uid-"));return t},jde=(aE=I8.useId)!==null&&aE!==void 0?aE:Fde;function Ude(t,e){var r=jde();return e||(t?"".concat(t,"-").concat(r):r)}var Vde=ee.createContext(void 0),AU=t=>{var{id:e,type:r,children:n}=t,i=Ude("recharts-".concat(r),e);return ee.createElement(Vde.Provider,{value:i},n(i))},$de={cartesianItems:[],polarItems:[]},EU=Go({name:"graphicalItems",initialState:$de,reducers:{addCartesianGraphicalItem:{reducer(t,e){t.cartesianItems.push(e.payload)},prepare:mi()},replaceCartesianGraphicalItem:{reducer(t,e){var{prev:r,next:n}=e.payload,i=Eu(t).cartesianItems.indexOf(r);i>-1&&(t.cartesianItems[i]=n)},prepare:mi()},removeCartesianGraphicalItem:{reducer(t,e){var r=Eu(t).cartesianItems.indexOf(e.payload);r>-1&&t.cartesianItems.splice(r,1)},prepare:mi()},addPolarGraphicalItem:{reducer(t,e){t.polarItems.push(e.payload)},prepare:mi()},removePolarGraphicalItem:{reducer(t,e){var r=Eu(t).polarItems.indexOf(e.payload);r>-1&&t.polarItems.splice(r,1)},prepare:mi()}}}),{addCartesianGraphicalItem:Wde,replaceCartesianGraphicalItem:Hde,removeCartesianGraphicalItem:qde,addPolarGraphicalItem:Xye,removePolarGraphicalItem:Gye}=EU.actions,Xde=EU.reducer,Gde=t=>{var e=xs(),r=ee.useRef(null);return ee.useLayoutEffect(()=>{r.current===null?e(Wde(t)):r.current!==t&&e(Hde({prev:r.current,next:t})),r.current=t},[e,t]),ee.useLayoutEffect(()=>()=>{r.current&&(e(qde(r.current)),r.current=null)},[e]),null},PU=ee.memo(Gde),Zde=["points"];function QN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function oE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?QN(Object(r),!0).forEach(function(n){Yde(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Yde(t,e,r){return(e=Kde(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Kde(t){var e=Qde(t,"string");return typeof e=="symbol"?e:e+""}function Qde(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function lT(){return lT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},lT.apply(null,arguments)}function Jde(t,e){if(t==null)return{};var r,n,i=epe(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function epe(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function tpe(t){var{option:e,dotProps:r,className:n}=t;if(ee.isValidElement(e))return ee.cloneElement(e,r);if(typeof e=="function")return e(r);var i=Ln(n,typeof e!="boolean"?e.className:""),l=r??{},{points:c}=l,s=Jde(l,Zde);return ee.createElement(xU,lT({},s,{className:i}))}function rpe(t,e){return t==null?!1:e?!0:t.length===1}function CU(t){var{points:e,dot:r,className:n,dotClassName:i,dataKey:l,baseProps:c,needClip:s,clipPathId:m,zIndex:b=ya.scatter}=t;if(!rpe(e,r))return null;var w=bM(r),E=ene(r),O=e.map((V,W)=>{var j,Y,ce=oE(oE(oE({r:3},c),E),{},{index:W,cx:(j=V.x)!==null&&j!==void 0?j:void 0,cy:(Y=V.y)!==null&&Y!==void 0?Y:void 0,dataKey:l,value:V.value,payload:V.payload,points:e});return ee.createElement(tpe,{key:"dot-".concat(W),option:r,dotProps:ce,className:i})}),N={};return s&&m!=null&&(N.clipPath="url(#clipPath-".concat(w?"":"dots-").concat(m,")")),ee.createElement(Ou,{zIndex:b},ee.createElement(Ml,lT({className:n},N),O))}function JN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function e4(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?JN(Object(r),!0).forEach(function(n){npe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):JN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function npe(t,e,r){return(e=ipe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ipe(t){var e=spe(t,"string");return typeof e=="symbol"?e:e+""}function spe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var MU=0,ape={xAxis:{},yAxis:{},zAxis:{}},IU=Go({name:"cartesianAxis",initialState:ape,reducers:{addXAxis:{reducer(t,e){t.xAxis[e.payload.id]=e.payload},prepare:mi()},replaceXAxis:{reducer(t,e){var{prev:r,next:n}=e.payload;t.xAxis[r.id]!==void 0&&(r.id!==n.id&&delete t.xAxis[r.id],t.xAxis[n.id]=n)},prepare:mi()},removeXAxis:{reducer(t,e){delete t.xAxis[e.payload.id]},prepare:mi()},addYAxis:{reducer(t,e){t.yAxis[e.payload.id]=e.payload},prepare:mi()},replaceYAxis:{reducer(t,e){var{prev:r,next:n}=e.payload;t.yAxis[r.id]!==void 0&&(r.id!==n.id&&delete t.yAxis[r.id],t.yAxis[n.id]=n)},prepare:mi()},removeYAxis:{reducer(t,e){delete t.yAxis[e.payload.id]},prepare:mi()},addZAxis:{reducer(t,e){t.zAxis[e.payload.id]=e.payload},prepare:mi()},replaceZAxis:{reducer(t,e){var{prev:r,next:n}=e.payload;t.zAxis[r.id]!==void 0&&(r.id!==n.id&&delete t.zAxis[r.id],t.zAxis[n.id]=n)},prepare:mi()},removeZAxis:{reducer(t,e){delete t.zAxis[e.payload.id]},prepare:mi()},updateYAxisWidth(t,e){var{id:r,width:n}=e.payload,i=t.yAxis[r];if(i){var l,c=i.widthHistory||[];if(c.length===3&&c[0]===c[2]&&n===c[1]&&n!==i.width&&Math.abs(n-((l=c[0])!==null&&l!==void 0?l:0))<=1)return;var s=[...c,n].slice(-3);t.yAxis[r]=e4(e4({},i),{},{width:n,widthHistory:s})}}}}),{addXAxis:ope,replaceXAxis:lpe,removeXAxis:cpe,addYAxis:upe,replaceYAxis:hpe,removeYAxis:fpe,addZAxis:Zye,replaceZAxis:Yye,removeZAxis:Kye,updateYAxisWidth:dpe}=IU.actions,ppe=IU.reducer,gpe=bt([xa],t=>({top:t.top,bottom:t.bottom,left:t.left,right:t.right})),mpe=bt([gpe,cd,ud],(t,e,r)=>{if(!(!t||e==null||r==null))return{x:t.left,y:t.top,width:Math.max(0,e-t.left-t.right),height:Math.max(0,r-t.top-t.bottom)}}),g2=()=>mr(mpe),_pe=()=>mr(Yue);function t4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function lE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?t4(Object(r),!0).forEach(function(n){ype(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):t4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ype(t,e,r){return(e=vpe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vpe(t){var e=bpe(t,"string");return typeof e=="symbol"?e:e+""}function bpe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var xpe=t=>{var{point:e,childIndex:r,mainColor:n,activeDot:i,dataKey:l,clipPath:c}=t;if(i===!1||e.x==null||e.y==null)return null;var s={index:r,dataKey:l,cx:e.x,cy:e.y,r:4,fill:n??"none",strokeWidth:2,stroke:"#fff",payload:e.payload,value:e.value},m=lE(lE(lE({},s),OT(i)),E3(i)),b;return ee.isValidElement(i)?b=ee.cloneElement(i,m):typeof i=="function"?b=i(m):b=ee.createElement(xU,m),ee.createElement(Ml,{className:"recharts-active-dot",clipPath:c},b)};function zP(t){var{points:e,mainColor:r,activeDot:n,itemDataKey:i,clipPath:l,zIndex:c=ya.activeDot}=t,s=mr(ub),m=_pe();if(e==null||m==null)return null;var b=e.find(w=>m.includes(w.payload));return Vs(b)?null:ee.createElement(Ou,{zIndex:c},ee.createElement(xpe,{point:b,childIndex:Number(s),mainColor:r,dataKey:i,activeDot:n,clipPath:l}))}var wpe=t=>{var{chartData:e}=t,r=xs(),n=wa();return ee.useEffect(()=>n?()=>{}:(r(_N(e)),()=>{r(_N(void 0))}),[e,r,n]),null},r4={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},RU=Go({name:"brush",initialState:r4,reducers:{setBrushSettings(t,e){return e.payload==null?r4:e.payload}}}),{setBrushSettings:Qye}=RU.actions,Tpe=RU.reducer,Spe=(t,e)=>{var{x:r,y:n}=t,{x:i,y:l}=e;return{x:Math.min(r,i),y:Math.min(n,l),width:Math.abs(i-r),height:Math.abs(l-n)}},Ape=t=>{var{x1:e,y1:r,x2:n,y2:i}=t;return Spe({x:e,y:r},{x:n,y:i})};function Epe(t){return(t%180+180)%180}var Ppe=function(e){var{width:r,height:n}=e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=Epe(i),c=l*Math.PI/180,s=Math.atan(n/r),m=c>s&&c<Math.PI-s?n/Math.sin(c):r/Math.cos(c);return Math.abs(m)},Cpe={dots:[],areas:[],lines:[]},OU=Go({name:"referenceElements",initialState:Cpe,reducers:{addDot:(t,e)=>{t.dots.push(e.payload)},removeDot:(t,e)=>{var r=Eu(t).dots.findIndex(n=>n===e.payload);r!==-1&&t.dots.splice(r,1)},addArea:(t,e)=>{t.areas.push(e.payload)},removeArea:(t,e)=>{var r=Eu(t).areas.findIndex(n=>n===e.payload);r!==-1&&t.areas.splice(r,1)},addLine:(t,e)=>{t.lines.push(e.payload)},removeLine:(t,e)=>{var r=Eu(t).lines.findIndex(n=>n===e.payload);r!==-1&&t.lines.splice(r,1)}}}),{addDot:Jye,removeDot:eve,addArea:tve,removeArea:rve,addLine:Mpe,removeLine:Ipe}=OU.actions,Rpe=OU.reducer,DU=ee.createContext(void 0),Ope=t=>{var{children:e}=t,[r]=ee.useState("".concat(tb("recharts"),"-clip")),n=g2();if(n==null)return null;var{x:i,y:l,width:c,height:s}=n;return ee.createElement(DU.Provider,{value:r},ee.createElement("defs",null,ee.createElement("clipPath",{id:r},ee.createElement("rect",{x:i,y:l,height:s,width:c}))),e)},Dpe=()=>ee.useContext(DU);class kpe{constructor(e){var{x:r,y:n}=e;this.xAxisScale=r,this.yAxisScale=n}map(e,r){var n,i,{position:l}=r;return{x:(n=this.xAxisScale.map(e.x,{position:l}))!==null&&n!==void 0?n:0,y:(i=this.yAxisScale.map(e.y,{position:l}))!==null&&i!==void 0?i:0}}mapWithFallback(e,r){var n,i,{position:l,fallback:c}=r,s,m;return c==="rangeMin"?s=this.yAxisScale.rangeMin():c==="rangeMax"?s=this.yAxisScale.rangeMax():s=0,c==="rangeMin"?m=this.xAxisScale.rangeMin():c==="rangeMax"?m=this.xAxisScale.rangeMax():m=0,{x:(n=this.xAxisScale.map(e.x,{position:l}))!==null&&n!==void 0?n:m,y:(i=this.yAxisScale.map(e.y,{position:l}))!==null&&i!==void 0?i:s}}isInRange(e){var{x:r,y:n}=e,i=r==null||this.xAxisScale.isInRange(r),l=n==null||this.yAxisScale.isInRange(n);return i&&l}}function n4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function i4(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?n4(Object(r),!0).forEach(function(n){Lpe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Lpe(t,e,r){return(e=Npe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Npe(t){var e=zpe(t,"string");return typeof e=="symbol"?e:e+""}function zpe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cT(){return cT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},cT.apply(null,arguments)}var Bpe=(t,e)=>{var r;if(ee.isValidElement(t))r=ee.cloneElement(t,e);else if(typeof t=="function")r=t(e);else{if(!Br(e.x1)||!Br(e.y1)||!Br(e.x2)||!Br(e.y2))return null;r=ee.createElement("line",cT({},e,{className:"recharts-reference-line-line"}))}return r},Fpe=(t,e,r,n,i,l)=>{var{x:c,width:s}=l,m=i.map(t,{position:r});if(!Br(m)||e==="discard"&&!i.isInRange(m))return null;var b=[{x:c+s,y:m},{x:c,y:m}];return n==="left"?b.reverse():b},jpe=(t,e,r,n,i,l)=>{var{y:c,height:s}=l,m=i.map(t,{position:r});if(!Br(m)||e==="discard"&&!i.isInRange(m))return null;var b=[{x:m,y:c+s},{x:m,y:c}];return n==="top"?b.reverse():b},Upe=(t,e,r,n)=>{var i=[n.mapWithFallback(t[0],{position:r,fallback:"rangeMin"}),n.mapWithFallback(t[1],{position:r,fallback:"rangeMax"})];return e==="discard"&&i.some(l=>!n.isInRange(l))?null:i},Vpe=(t,e,r,n,i,l,c)=>{var{x:s,y:m,segment:b,ifOverflow:w}=c,E=wc(s),O=wc(m);return O?Fpe(m,w,n,l,e,r):E?jpe(s,w,n,i,t,r):b!=null&&b.length===2?Upe(b,w,n,new kpe({x:t,y:e})):null};function $pe(t){var e=xs();return ee.useEffect(()=>(e(Mpe(t)),()=>{e(Ipe(t))})),null}function Wpe(t){var{xAxisId:e,yAxisId:r,shape:n,className:i,ifOverflow:l}=t,c=wa(),s=Dpe(),m=mr(Ce=>jh(Ce,e)),b=mr(Ce=>Uh(Ce,r)),w=mr(Ce=>Wy(Ce,"xAxis",e,c)),E=mr(Ce=>Wy(Ce,"yAxis",r,c)),O=Ib();if(!s||!O||m==null||b==null||w==null||E==null)return null;var N=Vpe(w,E,O,t.position,m.orientation,b.orientation,t);if(!N)return null;var V=N[0],W=N[1];if(V==null||W==null)return null;var{x:j,y:Y}=V,{x:ce,y:re}=W,ue=l==="hidden"?"url(#".concat(s,")"):void 0,me=i4(i4({clipPath:ue},va(t)),{},{x1:j,y1:Y,x2:ce,y2:re}),ge=Ape({x1:j,y1:Y,x2:ce,y2:re});return ee.createElement(Ou,{zIndex:t.zIndex},ee.createElement(Ml,{className:Ln("recharts-reference-line",i)},Bpe(n,me),ee.createElement(pU,cT({},ge,{lowerWidth:ge.width,upperWidth:ge.width}),ee.createElement(mU,{label:t.label}),t.children)))}var Hpe={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",label:!1,stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:ya.line};function fb(t){var e=ba(t,Hpe);return ee.createElement(ee.Fragment,null,ee.createElement($pe,{yAxisId:e.yAxisId,xAxisId:e.xAxisId,ifOverflow:e.ifOverflow,x:e.x,y:e.y,segment:e.segment}),ee.createElement(Wpe,e))}fb.displayName="ReferenceLine";function kU(t,e){if(e<1)return[];if(e===1)return t;for(var r=[],n=0;n<t.length;n+=e){var i=t[n];i!==void 0&&r.push(i)}return r}function qpe(t,e,r){var n={width:t.width+e.width,height:t.height+e.height};return Ppe(n,r)}function Xpe(t,e,r){var n=r==="width",{x:i,y:l,width:c,height:s}=t;return e===1?{start:n?i:l,end:n?i+c:l+s}:{start:n?i+c:l+s,end:n?i:l}}function db(t,e,r,n,i){if(t*e<t*n||t*e>t*i)return!1;var l=r();return t*(e-t*l/2-n)>=0&&t*(e+t*l/2-i)<=0}function Gpe(t,e){return kU(t,e+1)}function Zpe(t,e,r,n,i){for(var l=(n||[]).slice(),{start:c,end:s}=e,m=0,b=1,w=c,E=function(){var V=n?.[m];if(V===void 0)return{v:kU(n,b)};var W=m,j,Y=()=>(j===void 0&&(j=r(V,W)),j),ce=V.coordinate,re=m===0||db(t,ce,Y,w,s);re||(m=0,w=c,b+=1),re&&(w=ce+t*(Y()/2+i),m+=b)},O;b<=l.length;)if(O=E(),O)return O.v;return[]}function Ype(t,e,r,n,i){var l=(n||[]).slice(),c=l.length;if(c===0)return[];for(var{start:s,end:m}=e,b=1;b<=c;b++){for(var w=(c-1)%b,E=s,O=!0,N=function(){var ue=n[W];if(ue==null)return 0;var me=W,ge,Ce=()=>(ge===void 0&&(ge=r(ue,me)),ge),We=ue.coordinate,Xe=W===w||db(t,We,Ce,E,m);if(!Xe)return O=!1,1;Xe&&(E=We+t*(Ce()/2+i))},V,W=w;W<c&&(V=N(),!(V!==0&&V===1));W+=b);if(O){for(var j=[],Y=w;Y<c;Y+=b){var ce=n[Y];ce!=null&&j.push(ce)}return j}}return[]}function s4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function qa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?s4(Object(r),!0).forEach(function(n){Kpe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Kpe(t,e,r){return(e=Qpe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qpe(t){var e=Jpe(t,"string");return typeof e=="symbol"?e:e+""}function Jpe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ege(t,e,r,n,i){for(var l=(n||[]).slice(),c=l.length,{start:s}=e,{end:m}=e,b=function(O){var N=l[O];if(N==null)return 1;var V=N,W,j=()=>(W===void 0&&(W=r(N,O)),W);if(O===c-1){var Y=t*(V.coordinate+t*j()/2-m);l[O]=V=qa(qa({},V),{},{tickCoord:Y>0?V.coordinate-Y*t:V.coordinate})}else l[O]=V=qa(qa({},V),{},{tickCoord:V.coordinate});if(V.tickCoord!=null){var ce=db(t,V.tickCoord,j,s,m);ce&&(m=V.tickCoord-t*(j()/2+i),l[O]=qa(qa({},V),{},{isShow:!0}))}},w=c-1;w>=0;w--)b(w);return l}function tge(t,e,r,n,i,l){var c=(n||[]).slice(),s=c.length,{start:m,end:b}=e;if(l){var w=n[s-1];if(w!=null){var E=r(w,s-1),O=t*(w.coordinate+t*E/2-b);if(c[s-1]=w=qa(qa({},w),{},{tickCoord:O>0?w.coordinate-O*t:w.coordinate}),w.tickCoord!=null){var N=db(t,w.tickCoord,()=>E,m,b);N&&(b=w.tickCoord-t*(E/2+i),c[s-1]=qa(qa({},w),{},{isShow:!0}))}}}for(var V=l?s-1:s,W=function(ce){var re=c[ce];if(re==null)return 1;var ue=re,me,ge=()=>(me===void 0&&(me=r(re,ce)),me);if(ce===0){var Ce=t*(ue.coordinate-t*ge()/2-m);c[ce]=ue=qa(qa({},ue),{},{tickCoord:Ce<0?ue.coordinate-Ce*t:ue.coordinate})}else c[ce]=ue=qa(qa({},ue),{},{tickCoord:ue.coordinate});if(ue.tickCoord!=null){var We=db(t,ue.tickCoord,ge,m,b);We&&(m=ue.tickCoord+t*(ge()/2+i),c[ce]=qa(qa({},ue),{},{isShow:!0}))}},j=0;j<V;j++)W(j);return c}function xM(t,e,r){var{tick:n,ticks:i,viewBox:l,minTickGap:c,orientation:s,interval:m,tickFormatter:b,unit:w,angle:E}=t;if(!i||!i.length||!n)return[];if(cr(m)||Db.isSsr){var O;return(O=Gpe(i,cr(m)?m:0))!==null&&O!==void 0?O:[]}var N=[],V=s==="top"||s==="bottom"?"width":"height",W=w&&V==="width"?j0(w,{fontSize:e,letterSpacing:r}):{width:0,height:0},j=(me,ge)=>{var Ce=typeof b=="function"?b(me.value,ge):me.value;return V==="width"?qpe(j0(Ce,{fontSize:e,letterSpacing:r}),W,E):j0(Ce,{fontSize:e,letterSpacing:r})[V]},Y=i[0],ce=i[1],re=i.length>=2&&Y!=null&&ce!=null?mc(ce.coordinate-Y.coordinate):1,ue=Xpe(l,re,V);return m==="equidistantPreserveStart"?Zpe(re,ue,j,i,c):m==="equidistantPreserveEnd"?Ype(re,ue,j,i,c):(m==="preserveStart"||m==="preserveStartEnd"?N=tge(re,ue,j,i,c,m==="preserveStartEnd"):N=ege(re,ue,j,i,c),N.filter(me=>me.isShow))}var rge=t=>{var{ticks:e,label:r,labelGapWithTick:n=5,tickSize:i=0,tickMargin:l=0}=t,c=0;if(e){Array.from(e).forEach(w=>{if(w){var E=w.getBoundingClientRect();E.width>c&&(c=E.width)}});var s=r?r.getBoundingClientRect().width:0,m=i+l,b=c+m+s+(r?n:0);return Math.round(b)}return 0},nge=["axisLine","width","height","className","hide","ticks","axisType"];function ige(t,e){if(t==null)return{};var r,n,i=sge(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function sge(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function Tm(){return Tm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Tm.apply(null,arguments)}function a4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Bi(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?a4(Object(r),!0).forEach(function(n){age(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function age(t,e,r){return(e=oge(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oge(t){var e=lge(t,"string");return typeof e=="symbol"?e:e+""}function lge(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Jf={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:ya.axis};function cge(t){var{x:e,y:r,width:n,height:i,orientation:l,mirror:c,axisLine:s,otherSvgProps:m}=t;if(!s)return null;var b=Bi(Bi(Bi({},m),xc(s)),{},{fill:"none"});if(l==="top"||l==="bottom"){var w=+(l==="top"&&!c||l==="bottom"&&c);b=Bi(Bi({},b),{},{x1:e,y1:r+w*i,x2:e+n,y2:r+w*i})}else{var E=+(l==="left"&&!c||l==="right"&&c);b=Bi(Bi({},b),{},{x1:e+E*n,y1:r,x2:e+E*n,y2:r+i})}return ee.createElement("line",Tm({},b,{className:Ln("recharts-cartesian-axis-line",NT(s,"className"))}))}function uge(t,e,r,n,i,l,c,s,m){var b,w,E,O,N,V,W=s?-1:1,j=t.tickSize||c,Y=cr(t.tickCoord)?t.tickCoord:t.coordinate;switch(l){case"top":b=w=t.coordinate,O=r+ +!s*i,E=O-W*j,V=E-W*m,N=Y;break;case"left":E=O=t.coordinate,w=e+ +!s*n,b=w-W*j,N=b-W*m,V=Y;break;case"right":E=O=t.coordinate,w=e+ +s*n,b=w+W*j,N=b+W*m,V=Y;break;default:b=w=t.coordinate,O=r+ +s*i,E=O+W*j,V=E+W*m,N=Y;break}return{line:{x1:b,y1:E,x2:w,y2:O},tick:{x:N,y:V}}}function hge(t,e){switch(t){case"left":return e?"start":"end";case"right":return e?"end":"start";default:return"middle"}}function fge(t,e){switch(t){case"left":case"right":return"middle";case"top":return e?"start":"end";default:return e?"end":"start"}}function dge(t){var{option:e,tickProps:r,value:n}=t,i,l=Ln(r.className,"recharts-cartesian-axis-tick-value");if(ee.isValidElement(e))i=ee.cloneElement(e,Bi(Bi({},r),{},{className:l}));else if(typeof e=="function")i=e(Bi(Bi({},r),{},{className:l}));else{var c="recharts-cartesian-axis-tick-value";typeof e!="boolean"&&(c=Ln(c,vde(e))),i=ee.createElement(yM,Tm({},r,{className:c}),n)}return i}var pge=ee.forwardRef((t,e)=>{var{ticks:r=[],tick:n,tickLine:i,stroke:l,tickFormatter:c,unit:s,padding:m,tickTextProps:b,orientation:w,mirror:E,x:O,y:N,width:V,height:W,tickSize:j,tickMargin:Y,fontSize:ce,letterSpacing:re,getTicksConfig:ue,events:me,axisType:ge}=t,Ce=xM(Bi(Bi({},ue),{},{ticks:r}),ce,re),We=hge(w,E),Xe=fge(w,E),Et=xc(ue),gt=OT(n),Ye={};typeof i=="object"&&(Ye=i);var jt=Bi(Bi({},Et),{},{fill:"none"},Ye),St=Ce.map(Me=>Bi({entry:Me},uge(Me,O,N,V,W,w,j,E,Y))),Zt=St.map(Me=>{var{entry:Ee,line:Ue}=Me;return ee.createElement(Ml,{className:"recharts-cartesian-axis-tick",key:"tick-".concat(Ee.value,"-").concat(Ee.coordinate,"-").concat(Ee.tickCoord)},i&&ee.createElement("line",Tm({},jt,Ue,{className:Ln("recharts-cartesian-axis-tick-line",NT(i,"className"))})))}),fe=St.map((Me,Ee)=>{var Ue,st,{entry:ye,tick:Be}=Me,lt=Bi(Bi(Bi(Bi({verticalAnchor:Xe},Et),{},{textAnchor:We,stroke:"none",fill:l},Be),{},{index:Ee,payload:ye,visibleTicksCount:Ce.length,tickFormatter:c,padding:m},b),{},{angle:(Ue=(st=b?.angle)!==null&&st!==void 0?st:Et.angle)!==null&&Ue!==void 0?Ue:0}),Tt=Bi(Bi({},lt),gt);return ee.createElement(Ml,Tm({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(ye.value,"-").concat(ye.coordinate,"-").concat(ye.tickCoord)},iie(me,ye,Ee)),n&&ee.createElement(dge,{option:n,tickProps:Tt,value:"".concat(typeof c=="function"?c(ye.value,Ee):ye.value).concat(s||"")}))});return ee.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(ge,"-ticks")},fe.length>0&&ee.createElement(Ou,{zIndex:ya.label},ee.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(ge,"-tick-labels"),ref:e},fe)),Zt.length>0&&ee.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(ge,"-tick-lines")},Zt))}),gge=ee.forwardRef((t,e)=>{var{axisLine:r,width:n,height:i,className:l,hide:c,ticks:s,axisType:m}=t,b=ige(t,nge),[w,E]=ee.useState(""),[O,N]=ee.useState(""),V=ee.useRef(null);ee.useImperativeHandle(e,()=>({getCalculatedWidth:()=>{var j;return rge({ticks:V.current,label:(j=t.labelRef)===null||j===void 0?void 0:j.current,labelGapWithTick:5,tickSize:t.tickSize,tickMargin:t.tickMargin})}}));var W=ee.useCallback(j=>{if(j){var Y=j.getElementsByClassName("recharts-cartesian-axis-tick-value");V.current=Y;var ce=Y[0];if(ce){var re=window.getComputedStyle(ce),ue=re.fontSize,me=re.letterSpacing;(ue!==w||me!==O)&&(E(ue),N(me))}}},[w,O]);return c||n!=null&&n<=0||i!=null&&i<=0?null:ee.createElement(Ou,{zIndex:t.zIndex},ee.createElement(Ml,{className:Ln("recharts-cartesian-axis",l)},ee.createElement(cge,{x:t.x,y:t.y,width:n,height:i,orientation:t.orientation,mirror:t.mirror,axisLine:r,otherSvgProps:xc(t)}),ee.createElement(pge,{ref:W,axisType:m,events:b,fontSize:w,getTicksConfig:t,height:t.height,letterSpacing:O,mirror:t.mirror,orientation:t.orientation,padding:t.padding,stroke:t.stroke,tick:t.tick,tickFormatter:t.tickFormatter,tickLine:t.tickLine,tickMargin:t.tickMargin,tickSize:t.tickSize,tickTextProps:t.tickTextProps,ticks:s,unit:t.unit,width:t.width,x:t.x,y:t.y}),ee.createElement(pU,{x:t.x,y:t.y,width:t.width,height:t.height,lowerWidth:t.width,upperWidth:t.width},ee.createElement(mU,{label:t.label,labelRef:t.labelRef}),t.children)))}),wM=ee.forwardRef((t,e)=>{var r=ba(t,Jf);return ee.createElement(gge,Tm({},r,{ref:e}))});wM.displayName="CartesianAxis";var mge=["x1","y1","x2","y2","key"],_ge=["offset"],yge=["xAxisId","yAxisId"],vge=["xAxisId","yAxisId"];function o4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ga(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?o4(Object(r),!0).forEach(function(n){bge(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function bge(t,e,r){return(e=xge(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function xge(t){var e=wge(t,"string");return typeof e=="symbol"?e:e+""}function wge(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function tm(){return tm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tm.apply(null,arguments)}function uT(t,e){if(t==null)return{};var r,n,i=Tge(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Tge(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Sge=t=>{var{fill:e}=t;if(!e||e==="none")return null;var{fillOpacity:r,x:n,y:i,width:l,height:c,ry:s}=t;return ee.createElement("rect",{x:n,y:i,ry:s,width:l,height:c,stroke:"none",fill:e,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function LU(t){var{option:e,lineItemProps:r}=t,n;if(ee.isValidElement(e))n=ee.cloneElement(e,r);else if(typeof e=="function")n=e(r);else{var i,{x1:l,y1:c,x2:s,y2:m,key:b}=r,w=uT(r,mge),E=(i=xc(w))!==null&&i!==void 0?i:{},{offset:O}=E,N=uT(E,_ge);n=ee.createElement("line",tm({},N,{x1:l,y1:c,x2:s,y2:m,fill:"none",key:b}))}return n}function Age(t){var{x:e,width:r,horizontal:n=!0,horizontalPoints:i}=t;if(!n||!i||!i.length)return null;var{xAxisId:l,yAxisId:c}=t,s=uT(t,yge),m=i.map((b,w)=>{var E=Ga(Ga({},s),{},{x1:e,y1:b,x2:e+r,y2:b,key:"line-".concat(w),index:w});return ee.createElement(LU,{key:"line-".concat(w),option:n,lineItemProps:E})});return ee.createElement("g",{className:"recharts-cartesian-grid-horizontal"},m)}function Ege(t){var{y:e,height:r,vertical:n=!0,verticalPoints:i}=t;if(!n||!i||!i.length)return null;var{xAxisId:l,yAxisId:c}=t,s=uT(t,vge),m=i.map((b,w)=>{var E=Ga(Ga({},s),{},{x1:b,y1:e,x2:b,y2:e+r,key:"line-".concat(w),index:w});return ee.createElement(LU,{option:n,lineItemProps:E,key:"line-".concat(w)})});return ee.createElement("g",{className:"recharts-cartesian-grid-vertical"},m)}function Pge(t){var{horizontalFill:e,fillOpacity:r,x:n,y:i,width:l,height:c,horizontalPoints:s,horizontal:m=!0}=t;if(!m||!e||!e.length||s==null)return null;var b=s.map(E=>Math.round(E+i-i)).sort((E,O)=>E-O);i!==b[0]&&b.unshift(0);var w=b.map((E,O)=>{var N=b[O+1],V=N==null,W=V?i+c-E:N-E;if(W<=0)return null;var j=O%e.length;return ee.createElement("rect",{key:"react-".concat(O),y:E,x:n,height:W,width:l,stroke:"none",fill:e[j],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return ee.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},w)}function Cge(t){var{vertical:e=!0,verticalFill:r,fillOpacity:n,x:i,y:l,width:c,height:s,verticalPoints:m}=t;if(!e||!r||!r.length)return null;var b=m.map(E=>Math.round(E+i-i)).sort((E,O)=>E-O);i!==b[0]&&b.unshift(0);var w=b.map((E,O)=>{var N=b[O+1],V=N==null,W=V?i+c-E:N-E;if(W<=0)return null;var j=O%r.length;return ee.createElement("rect",{key:"react-".concat(O),x:E,y:l,width:W,height:s,stroke:"none",fill:r[j],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return ee.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},w)}var Mge=(t,e)=>{var{xAxis:r,width:n,height:i,offset:l}=t;return Q6(xM(Ga(Ga(Ga({},Jf),r),{},{ticks:J6(r),viewBox:{x:0,y:0,width:n,height:i}})),l.left,l.left+l.width,e)},Ige=(t,e)=>{var{yAxis:r,width:n,height:i,offset:l}=t;return Q6(xM(Ga(Ga(Ga({},Jf),r),{},{ticks:J6(r),viewBox:{x:0,y:0,width:n,height:i}})),l.top,l.top+l.height,e)},Rge={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0,syncWithTicks:!1,zIndex:ya.grid};function TM(t){var e=oj(),r=lj(),n=aj(),i=Ga(Ga({},ba(t,Rge)),{},{x:cr(t.x)?t.x:n.left,y:cr(t.y)?t.y:n.top,width:cr(t.width)?t.width:n.width,height:cr(t.height)?t.height:n.height}),{xAxisId:l,yAxisId:c,x:s,y:m,width:b,height:w,syncWithTicks:E,horizontalValues:O,verticalValues:N}=i,V=wa(),W=mr(Xe=>sN(Xe,"xAxis",l,V)),j=mr(Xe=>sN(Xe,"yAxis",c,V));if(!zh(b)||!zh(w)||!cr(s)||!cr(m))return null;var Y=i.verticalCoordinatesGenerator||Mge,ce=i.horizontalCoordinatesGenerator||Ige,{horizontalPoints:re,verticalPoints:ue}=i;if((!re||!re.length)&&typeof ce=="function"){var me=O&&O.length,ge=ce({yAxis:j?Ga(Ga({},j),{},{ticks:me?O:j.ticks}):void 0,width:e??b,height:r??w,offset:n},me?!0:E);Hw(Array.isArray(ge),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof ge,"]")),Array.isArray(ge)&&(re=ge)}if((!ue||!ue.length)&&typeof Y=="function"){var Ce=N&&N.length,We=Y({xAxis:W?Ga(Ga({},W),{},{ticks:Ce?N:W.ticks}):void 0,width:e??b,height:r??w,offset:n},Ce?!0:E);Hw(Array.isArray(We),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof We,"]")),Array.isArray(We)&&(ue=We)}return ee.createElement(Ou,{zIndex:i.zIndex},ee.createElement("g",{className:"recharts-cartesian-grid"},ee.createElement(Sge,{fill:i.fill,fillOpacity:i.fillOpacity,x:i.x,y:i.y,width:i.width,height:i.height,ry:i.ry}),ee.createElement(Pge,tm({},i,{horizontalPoints:re})),ee.createElement(Cge,tm({},i,{verticalPoints:ue})),ee.createElement(Age,tm({},i,{offset:n,horizontalPoints:re,xAxis:W,yAxis:j})),ee.createElement(Ege,tm({},i,{offset:n,verticalPoints:ue,xAxis:W,yAxis:j}))))}TM.displayName="CartesianGrid";var Oge={},NU=Go({name:"errorBars",initialState:Oge,reducers:{addErrorBar:(t,e)=>{var{itemId:r,errorBar:n}=e.payload;t[r]||(t[r]=[]),t[r].push(n)},replaceErrorBar:(t,e)=>{var{itemId:r,prev:n,next:i}=e.payload;t[r]&&(t[r]=t[r].map(l=>l.dataKey===n.dataKey&&l.direction===n.direction?i:l))},removeErrorBar:(t,e)=>{var{itemId:r,errorBar:n}=e.payload;t[r]&&(t[r]=t[r].filter(i=>i.dataKey!==n.dataKey||i.direction!==n.direction))}}}),{addErrorBar:nve,replaceErrorBar:ive,removeErrorBar:sve}=NU.actions,Dge=NU.reducer,kge=["children"];function Lge(t,e){if(t==null)return{};var r,n,i=Nge(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Nge(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var zge={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},Bge=ee.createContext(zge);function Fge(t){var{children:e}=t,r=Lge(t,kge);return ee.createElement(Bge.Provider,{value:r},e)}function SM(t,e){var r,n,i=mr(b=>jh(b,t)),l=mr(b=>Uh(b,e)),c=(r=i?.allowDataOverflow)!==null&&r!==void 0?r:Fs.allowDataOverflow,s=(n=l?.allowDataOverflow)!==null&&n!==void 0?n:js.allowDataOverflow,m=c||s;return{needClip:m,needClipX:c,needClipY:s}}function zU(t){var{xAxisId:e,yAxisId:r,clipPathId:n}=t,i=g2(),{needClipX:l,needClipY:c,needClip:s}=SM(e,r);if(!s||!i)return null;var{x:m,y:b,width:w,height:E}=i;return ee.createElement("clipPath",{id:"clipPath-".concat(n)},ee.createElement("rect",{x:l?m:m-w/2,y:c?b:b-E/2,width:l?w:w*2,height:c?E:E*2}))}var BU=(t,e,r,n)=>p2(t,"xAxis",e,n),FU=(t,e,r,n)=>d2(t,"xAxis",e,n),jU=(t,e,r,n)=>p2(t,"yAxis",r,n),UU=(t,e,r,n)=>d2(t,"yAxis",r,n),jge=bt([ai,BU,jU,FU,UU],(t,e,r,n,i)=>Ru(t,"xAxis")?Vy(e,n,!1):Vy(r,i,!1)),Uge=(t,e,r,n,i)=>i;function Vge(t){return t.type==="line"}var $ge=bt([J3,Uge],(t,e)=>t.filter(Vge).find(r=>r.id===e)),Wge=bt([ai,BU,jU,FU,UU,$ge,jge,U3],(t,e,r,n,i,l,c,s)=>{var{chartData:m,dataStartIndex:b,dataEndIndex:w}=s;if(!(l==null||e==null||r==null||n==null||i==null||n.length===0||i.length===0||c==null||t!=="horizontal"&&t!=="vertical")){var{dataKey:E,data:O}=l,N;if(O!=null&&O.length>0?N=O:N=m?.slice(b,w+1),N!=null)return Ime({layout:t,xAxis:e,yAxis:r,xAxisTicks:n,yAxisTicks:i,dataKey:E,bandSize:c,displayedData:N})}});function VU(t){var e=OT(t),r=3,n=2;if(e!=null){var{r:i,strokeWidth:l}=e,c=Number(i),s=Number(l);return(Number.isNaN(c)||c<0)&&(c=r),(Number.isNaN(s)||s<0)&&(s=n),{r:c,strokeWidth:s}}return{r,strokeWidth:n}}var cE={exports:{}},uE={};var l4;function Hge(){if(l4)return uE;l4=1;var t=Hy();function e(m,b){return m===b&&(m!==0||1/m===1/b)||m!==m&&b!==b}var r=typeof Object.is=="function"?Object.is:e,n=t.useSyncExternalStore,i=t.useRef,l=t.useEffect,c=t.useMemo,s=t.useDebugValue;return uE.useSyncExternalStoreWithSelector=function(m,b,w,E,O){var N=i(null);if(N.current===null){var V={hasValue:!1,value:null};N.current=V}else V=N.current;N=c(function(){function j(me){if(!Y){if(Y=!0,ce=me,me=E(me),O!==void 0&&V.hasValue){var ge=V.value;if(O(ge,me))return re=ge}return re=me}if(ge=re,r(ce,me))return ge;var Ce=E(me);return O!==void 0&&O(ge,Ce)?(ce=me,ge):(ce=me,re=Ce)}var Y=!1,ce,re,ue=w===void 0?null:w;return[function(){return j(b())},ue===null?void 0:function(){return j(ue())}]},[b,w,E,O]);var W=n(m,N[0],N[1]);return l(function(){V.hasValue=!0,V.value=W},[W]),s(W),W},uE}var c4;function qge(){return c4||(c4=1,cE.exports=Hge()),cE.exports}qge();function Xge(t){t()}function Gge(){let t=null,e=null;return{clear(){t=null,e=null},notify(){Xge(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let n=t;for(;n;)r.push(n),n=n.next;return r},subscribe(r){let n=!0;const i=e={callback:r,next:null,prev:e};return i.prev?i.prev.next=i:t=i,function(){!n||t===null||(n=!1,i.next?i.next.prev=i.prev:e=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var u4={notify(){},get:()=>[]};function Zge(t,e){let r,n=u4,i=0,l=!1;function c(W){w();const j=n.subscribe(W);let Y=!1;return()=>{Y||(Y=!0,j(),E())}}function s(){n.notify()}function m(){V.onStateChange&&V.onStateChange()}function b(){return l}function w(){i++,r||(r=t.subscribe(m),n=Gge())}function E(){i--,r&&i===0&&(r(),r=void 0,n.clear(),n=u4)}function O(){l||(l=!0,w())}function N(){l&&(l=!1,E())}const V={addNestedSub:c,notifyNestedSubs:s,handleChangeWrapper:m,isSubscribed:b,trySubscribe:O,tryUnsubscribe:N,getListeners:()=>n};return V}var Yge=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Kge=Yge(),Qge=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Jge=Qge(),eme=()=>Kge||Jge?ee.useLayoutEffect:ee.useEffect,tme=eme();function h4(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function rme(t,e){if(h4(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let i=0;i<r.length;i++)if(!Object.prototype.hasOwnProperty.call(e,r[i])||!h4(t[r[i]],e[r[i]]))return!1;return!0}var nme=Symbol.for("react-redux-context"),ime=typeof globalThis<"u"?globalThis:{};function sme(){if(!ee.createContext)return{};const t=ime[nme]??=new Map;let e=t.get(ee.createContext);return e||(e=ee.createContext(null),t.set(ee.createContext,e)),e}var ame=sme();function ome(t){const{children:e,context:r,serverState:n,store:i}=t,l=ee.useMemo(()=>{const m=Zge(i);return{store:i,subscription:m,getServerState:n?()=>n:void 0}},[i,n]),c=ee.useMemo(()=>i.getState(),[i]);tme(()=>{const{subscription:m}=l;return m.onStateChange=m.notifyNestedSubs,m.trySubscribe(),c!==i.getState()&&m.notifyNestedSubs(),()=>{m.tryUnsubscribe(),m.onStateChange=void 0}},[l,c]);const s=r||ame;return ee.createElement(s.Provider,{value:l},e)}var lme=ome,cme=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle","radius"]);function ume(t,e){return t==null&&e==null?!0:typeof t=="number"&&typeof e=="number"?t===e||t!==t&&e!==e:t===e}function m2(t,e){var r=new Set([...Object.keys(t),...Object.keys(e)]);for(var n of r)if(cme.has(n)){if(t[n]==null&&e[n]==null)continue;if(!rme(t[n],e[n]))return!1}else if(!ume(t[n],e[n]))return!1;return!0}var hme=["id"],fme=["type","layout","connectNulls","needClip","shape"],dme=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function pb(){return pb=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},pb.apply(null,arguments)}function f4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ph(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?f4(Object(r),!0).forEach(function(n){pme(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function pme(t,e,r){return(e=gme(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gme(t){var e=mme(t,"string");return typeof e=="symbol"?e:e+""}function mme(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function AM(t,e){if(t==null)return{};var r,n,i=_me(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function _me(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var yme=t=>{var{dataKey:e,name:r,stroke:n,legendType:i,hide:l}=t;return[{inactive:l,dataKey:e,type:i,color:n,value:XT(r,e),payload:t}]},vme=ee.memo(t=>{var{dataKey:e,data:r,stroke:n,strokeWidth:i,fill:l,name:c,hide:s,unit:m,tooltipType:b,id:w}=t,E={dataDefinedOnItem:r,getPosition:Mm,settings:{stroke:n,strokeWidth:i,fill:l,dataKey:e,nameKey:void 0,name:XT(c,e),hide:s,type:b,color:n,unit:m,graphicalItemId:w}};return ee.createElement(TU,{tooltipEntrySettings:E})}),$U=(t,e)=>"".concat(e,"px ").concat(t-e,"px");function bme(t,e){for(var r=t.length%2!==0?[...t,0]:t,n=[],i=0;i<e;++i)n=[...n,...r];return n}var xme=(t,e,r)=>{var n=r.reduce((N,V)=>N+V);if(!n)return $U(e,t);for(var i=Math.floor(t/n),l=t%n,c=e-t,s=[],m=0,b=0;m<r.length;b+=(w=r[m])!==null&&w!==void 0?w:0,++m){var w,E=r[m];if(E!=null&&b+E>l){s=[...r.slice(0,m),l-b];break}}var O=s.length%2===0?[0,c]:[c];return[...bme(r,i),...s,...O].map(N=>"".concat(N,"px")).join(", ")};function wme(t){var{clipPathId:e,points:r,props:n}=t,{dot:i,dataKey:l,needClip:c}=n,{id:s}=n,m=AM(n,hme),b=xc(m);return ee.createElement(CU,{points:r,dot:i,className:"recharts-line-dots",dotClassName:"recharts-line-dot",dataKey:l,baseProps:b,needClip:c,clipPathId:e})}function Tme(t){var{showLabels:e,children:r,points:n}=t,i=ee.useMemo(()=>n?.map(l=>{var c,s,m={x:(c=l.x)!==null&&c!==void 0?c:0,y:(s=l.y)!==null&&s!==void 0?s:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Ph(Ph({},m),{},{value:l.value,payload:l.payload,viewBox:m,parentViewBox:void 0,fill:void 0})}),[n]);return ee.createElement(yU,{value:e?i:void 0},r)}function d4(t){var{clipPathId:e,pathRef:r,points:n,strokeDasharray:i,props:l}=t,{type:c,layout:s,connectNulls:m,needClip:b,shape:w}=l,E=AM(l,fme),O=Ph(Ph({},va(E)),{},{fill:"none",className:"recharts-line-curve",clipPath:b?"url(#clipPath-".concat(e,")"):void 0,points:n,type:c,layout:s,connectNulls:m,strokeDasharray:i??l.strokeDasharray});return ee.createElement(ee.Fragment,null,n?.length>1&&ee.createElement(Bde,pb({shapeType:"curve",option:w},O,{pathRef:r})),ee.createElement(wme,{points:n,clipPathId:e,props:l}))}function Sme(t){try{return t&&t.getTotalLength&&t.getTotalLength()||0}catch{return 0}}function Ame(t){var{clipPathId:e,props:r,pathRef:n,previousPointsRef:i,longestAnimatedLengthRef:l}=t,{points:c,strokeDasharray:s,isAnimationActive:m,animationBegin:b,animationDuration:w,animationEasing:E,animateNewValues:O,width:N,height:V,onAnimationEnd:W,onAnimationStart:j}=r,Y=i.current,ce=r2(c,"recharts-line-"),re=ee.useRef(ce),[ue,me]=ee.useState(!1),ge=!ue,Ce=ee.useCallback(()=>{typeof W=="function"&&W(),me(!1)},[W]),We=ee.useCallback(()=>{typeof j=="function"&&j(),me(!0)},[j]),Xe=Sme(n.current),Et=ee.useRef(0);re.current!==ce&&(Et.current=l.current,re.current=ce);var gt=Et.current;return ee.createElement(Tme,{points:c,showLabels:ge},r.children,ee.createElement(t2,{animationId:ce,begin:b,duration:w,isActive:m,easing:E,onAnimationEnd:Ce,onAnimationStart:We,key:ce},Ye=>{var jt=rs(gt,Xe+gt,Ye),St=Math.min(jt,Xe),Zt;if(m)if(s){var fe="".concat(s).split(/[,\s]+/gim).map(Ue=>parseFloat(Ue));Zt=xme(St,Xe,fe)}else Zt=$U(Xe,St);else Zt=s==null?void 0:String(s);if(Ye>0&&Xe>0&&(i.current=c,l.current=Math.max(l.current,St)),Y){var Me=Y.length/c.length,Ee=Ye===1?c:c.map((Ue,st)=>{var ye=Math.floor(st*Me);if(Y[ye]){var Be=Y[ye];return Ph(Ph({},Ue),{},{x:rs(Be.x,Ue.x,Ye),y:rs(Be.y,Ue.y,Ye)})}return O?Ph(Ph({},Ue),{},{x:rs(N*2,Ue.x,Ye),y:rs(V/2,Ue.y,Ye)}):Ph(Ph({},Ue),{},{x:Ue.x,y:Ue.y})});return i.current=Ee,ee.createElement(d4,{props:r,points:Ee,clipPathId:e,pathRef:n,strokeDasharray:Zt})}return ee.createElement(d4,{props:r,points:c,clipPathId:e,pathRef:n,strokeDasharray:Zt})}),ee.createElement(bU,{label:r.label}))}function Eme(t){var{clipPathId:e,props:r}=t,n=ee.useRef(null),i=ee.useRef(0),l=ee.useRef(null);return ee.createElement(Ame,{props:r,clipPathId:e,previousPointsRef:n,longestAnimatedLengthRef:i,pathRef:l})}var Pme=(t,e)=>{var r,n;return{x:(r=t.x)!==null&&r!==void 0?r:void 0,y:(n=t.y)!==null&&n!==void 0?n:void 0,value:t.value,errorVal:vs(t.payload,e)}};class Cme extends ee.Component{render(){var{hide:e,dot:r,points:n,className:i,xAxisId:l,yAxisId:c,top:s,left:m,width:b,height:w,id:E,needClip:O,zIndex:N}=this.props;if(e)return null;var V=Ln("recharts-line",i),W=E,{r:j,strokeWidth:Y}=VU(r),ce=bM(r),re=j*2+Y,ue=O?"url(#clipPath-".concat(ce?"":"dots-").concat(W,")"):void 0;return ee.createElement(Ou,{zIndex:N},ee.createElement(Ml,{className:V},O&&ee.createElement("defs",null,ee.createElement(zU,{clipPathId:W,xAxisId:l,yAxisId:c}),!ce&&ee.createElement("clipPath",{id:"clipPath-dots-".concat(W)},ee.createElement("rect",{x:m-re/2,y:s-re/2,width:b+re,height:w+re}))),ee.createElement(Fge,{xAxisId:l,yAxisId:c,data:n,dataPointFormatter:Pme,errorBarOffset:0},ee.createElement(Eme,{props:this.props,clipPathId:W}))),ee.createElement(zP,{activeDot:this.props.activeDot,points:n,mainColor:this.props.stroke,itemDataKey:this.props.dataKey,clipPath:ue}))}}var WU={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:"auto",label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0,zIndex:ya.line,type:"linear"};function Mme(t){var e=ba(t,WU),{activeDot:r,animateNewValues:n,animationBegin:i,animationDuration:l,animationEasing:c,connectNulls:s,dot:m,hide:b,isAnimationActive:w,label:E,legendType:O,xAxisId:N,yAxisId:V,id:W}=e,j=AM(e,dme),{needClip:Y}=SM(N,V),ce=g2(),re=Im(),ue=wa(),me=mr(Et=>Wge(Et,N,V,ue,W));if(re!=="horizontal"&&re!=="vertical"||me==null||ce==null)return null;var{height:ge,width:Ce,x:We,y:Xe}=ce;return ee.createElement(Cme,pb({},j,{id:W,connectNulls:s,dot:m,activeDot:r,animateNewValues:n,animationBegin:i,animationDuration:l,animationEasing:c,isAnimationActive:w,hide:b,label:E,legendType:O,xAxisId:N,yAxisId:V,points:me,layout:re,height:ge,width:Ce,left:We,top:Xe,needClip:Y}))}function Ime(t){var{layout:e,xAxis:r,yAxis:n,xAxisTicks:i,yAxisTicks:l,dataKey:c,bandSize:s,displayedData:m}=t;return m.map((b,w)=>{var E=vs(b,c);if(e==="horizontal"){var O=Ww({axis:r,ticks:i,bandSize:s,entry:b,index:w}),N=Vs(E)?null:n.scale.map(E);return{x:O,y:N??null,value:E,payload:b}}var V=Vs(E)?null:r.scale.map(E),W=Ww({axis:n,ticks:l,bandSize:s,entry:b,index:w});return V==null||W==null?null:{x:V,y:W,value:E,payload:b}}).filter(Boolean)}function Rme(t){var e=ba(t,WU),r=wa();return ee.createElement(AU,{id:e.id,type:"line"},n=>ee.createElement(ee.Fragment,null,ee.createElement(SU,{legendPayload:yme(e)}),ee.createElement(vme,{dataKey:e.dataKey,data:e.data,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,unit:e.unit,tooltipType:e.tooltipType,id:n}),ee.createElement(PU,{type:"line",id:n,data:e.data,xAxisId:e.xAxisId,yAxisId:e.yAxisId,zAxisId:0,dataKey:e.dataKey,hide:e.hide,isPanorama:r}),ee.createElement(Mme,pb({},e,{id:n}))))}var G1=ee.memo(Rme,m2);G1.displayName="Line";function EM(t,e){var r,n;return(r=(n=t.graphicalItems.cartesianItems.find(i=>i.id===e))===null||n===void 0?void 0:n.xAxisId)!==null&&r!==void 0?r:MU}function PM(t,e){var r,n;return(r=(n=t.graphicalItems.cartesianItems.find(i=>i.id===e))===null||n===void 0?void 0:n.yAxisId)!==null&&r!==void 0?r:MU}var HU=(t,e,r)=>p2(t,"xAxis",EM(t,e),r),qU=(t,e,r)=>d2(t,"xAxis",EM(t,e),r),XU=(t,e,r)=>p2(t,"yAxis",PM(t,e),r),GU=(t,e,r)=>d2(t,"yAxis",PM(t,e),r),Ome=bt([ai,HU,XU,qU,GU],(t,e,r,n,i)=>Ru(t,"xAxis")?Vy(e,n,!1):Vy(r,i,!1)),Dme=(t,e)=>e,ZU=bt([J3,Dme],(t,e)=>t.filter(r=>r.type==="area").find(r=>r.id===e)),YU=t=>{var e=ai(t),r=Ru(e,"xAxis");return r?"yAxis":"xAxis"},kme=(t,e)=>{var r=YU(t);return r==="yAxis"?PM(t,e):EM(t,e)},Lme=(t,e,r)=>s5(t,YU(t),kme(t,e),r),Nme=bt([ZU,Lme],(t,e)=>{var r;if(!(t==null||e==null)){var{stackId:n}=t,i=Y3(t);if(!(n==null||i==null)){var l=(r=e[n])===null||r===void 0?void 0:r.stackedData,c=l?.find(s=>s.key===i);if(c!=null)return c.map(s=>[s[0],s[1]])}}}),zme=bt([ai,HU,XU,qU,GU,Nme,kle,Ome,ZU,$le],(t,e,r,n,i,l,c,s,m,b)=>{var{chartData:w,dataStartIndex:E,dataEndIndex:O}=c;if(!(m==null||t!=="horizontal"&&t!=="vertical"||e==null||r==null||n==null||i==null||n.length===0||i.length===0||s==null)){var{data:N}=m,V;if(N&&N.length>0?V=N:V=w?.slice(E,O+1),V!=null)return r_e({layout:t,xAxis:e,yAxis:r,xAxisTicks:n,yAxisTicks:i,dataStartIndex:E,areaSettings:m,stackedData:l,displayedData:V,chartBaseValue:b,bandSize:s})}}),Bme=["id"],Fme=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function um(){return um=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},um.apply(null,arguments)}function KU(t,e){if(t==null)return{};var r,n,i=jme(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function jme(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function p4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function wy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?p4(Object(r),!0).forEach(function(n){Ume(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ume(t,e,r){return(e=Vme(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Vme(t){var e=$me(t,"string");return typeof e=="symbol"?e:e+""}function $me(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hT(t,e){return t&&t!=="none"?t:e}var Wme=t=>{var{dataKey:e,name:r,stroke:n,fill:i,legendType:l,hide:c}=t;return[{inactive:c,dataKey:e,type:l,color:hT(n,i),value:XT(r,e),payload:t}]},Hme=ee.memo(t=>{var{dataKey:e,data:r,stroke:n,strokeWidth:i,fill:l,name:c,hide:s,unit:m,tooltipType:b,id:w}=t,E={dataDefinedOnItem:r,getPosition:Mm,settings:{stroke:n,strokeWidth:i,fill:l,dataKey:e,nameKey:void 0,name:XT(c,e),hide:s,type:b,color:hT(n,l),unit:m,graphicalItemId:w}};return ee.createElement(TU,{tooltipEntrySettings:E})});function qme(t){var{clipPathId:e,points:r,props:n}=t,{needClip:i,dot:l,dataKey:c}=n,s=xc(n);return ee.createElement(CU,{points:r,dot:l,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:s,needClip:i,clipPathId:e})}function Xme(t){var{showLabels:e,children:r,points:n}=t,i=n.map(l=>{var c,s,m={x:(c=l.x)!==null&&c!==void 0?c:0,y:(s=l.y)!==null&&s!==void 0?s:0,width:0,lowerWidth:0,upperWidth:0,height:0};return wy(wy({},m),{},{value:l.value,payload:l.payload,parentViewBox:void 0,viewBox:m,fill:void 0})});return ee.createElement(yU,{value:e?i:void 0},r)}function g4(t){var{points:e,baseLine:r,needClip:n,clipPathId:i,props:l}=t,{layout:c,type:s,stroke:m,connectNulls:b,isRange:w}=l,{id:E}=l,O=KU(l,Bme),N=xc(O),V=va(O);return ee.createElement(ee.Fragment,null,e?.length>1&&ee.createElement(Ml,{clipPath:n?"url(#clipPath-".concat(i,")"):void 0},ee.createElement(F0,um({},V,{id:E,points:e,connectNulls:b,type:s,baseLine:r,layout:c,stroke:"none",className:"recharts-area-area"})),m!=="none"&&ee.createElement(F0,um({},N,{className:"recharts-area-curve",layout:c,type:s,connectNulls:b,fill:"none",points:e})),m!=="none"&&w&&ee.createElement(F0,um({},N,{className:"recharts-area-curve",layout:c,type:s,connectNulls:b,fill:"none",points:r}))),ee.createElement(qme,{points:e,props:O,clipPathId:i}))}function Gme(t){var e,r,{alpha:n,baseLine:i,points:l,strokeWidth:c}=t,s=(e=l[0])===null||e===void 0?void 0:e.y,m=(r=l[l.length-1])===null||r===void 0?void 0:r.y;if(!Br(s)||!Br(m))return null;var b=n*Math.abs(s-m),w=Math.max(...l.map(E=>E.x||0));return cr(i)?w=Math.max(i,w):i&&Array.isArray(i)&&i.length&&(w=Math.max(...i.map(E=>E.x||0),w)),cr(w)?ee.createElement("rect",{x:0,y:s<m?s:s-b,width:w+(c?parseInt("".concat(c),10):1),height:Math.floor(b)}):null}function Zme(t){var e,r,{alpha:n,baseLine:i,points:l,strokeWidth:c}=t,s=(e=l[0])===null||e===void 0?void 0:e.x,m=(r=l[l.length-1])===null||r===void 0?void 0:r.x;if(!Br(s)||!Br(m))return null;var b=n*Math.abs(s-m),w=Math.max(...l.map(E=>E.y||0));return cr(i)?w=Math.max(i,w):i&&Array.isArray(i)&&i.length&&(w=Math.max(...i.map(E=>E.y||0),w)),cr(w)?ee.createElement("rect",{x:s<m?s:s-b,y:0,width:b,height:Math.floor(w+(c?parseInt("".concat(c),10):1))}):null}function Yme(t){var{alpha:e,layout:r,points:n,baseLine:i,strokeWidth:l}=t;return r==="vertical"?ee.createElement(Gme,{alpha:e,points:n,baseLine:i,strokeWidth:l}):ee.createElement(Zme,{alpha:e,points:n,baseLine:i,strokeWidth:l})}function Kme(t){var{needClip:e,clipPathId:r,props:n,previousPointsRef:i,previousBaselineRef:l}=t,{points:c,baseLine:s,isAnimationActive:m,animationBegin:b,animationDuration:w,animationEasing:E,onAnimationStart:O,onAnimationEnd:N}=n,V=ee.useMemo(()=>({points:c,baseLine:s}),[c,s]),W=r2(V,"recharts-area-"),j=B3(),[Y,ce]=ee.useState(!1),re=!Y,ue=ee.useCallback(()=>{typeof N=="function"&&N(),ce(!1)},[N]),me=ee.useCallback(()=>{typeof O=="function"&&O(),ce(!0)},[O]);if(j==null)return null;var ge=i.current,Ce=l.current;return ee.createElement(Xme,{showLabels:re,points:c},n.children,ee.createElement(t2,{animationId:W,begin:b,duration:w,isActive:m,easing:E,onAnimationEnd:ue,onAnimationStart:me,key:W},We=>{if(ge){var Xe=ge.length/c.length,Et=We===1?c:c.map((Ye,jt)=>{var St=Math.floor(jt*Xe);if(ge[St]){var Zt=ge[St];return wy(wy({},Ye),{},{x:rs(Zt.x,Ye.x,We),y:rs(Zt.y,Ye.y,We)})}return Ye}),gt;return cr(s)?gt=rs(Ce,s,We):Vs(s)||Nh(s)?gt=rs(Ce,0,We):gt=s.map((Ye,jt)=>{var St=Math.floor(jt*Xe);if(Array.isArray(Ce)&&Ce[St]){var Zt=Ce[St];return wy(wy({},Ye),{},{x:rs(Zt.x,Ye.x,We),y:rs(Zt.y,Ye.y,We)})}return Ye}),We>0&&(i.current=Et,l.current=gt),ee.createElement(g4,{points:Et,baseLine:gt,needClip:e,clipPathId:r,props:n})}return We>0&&(i.current=c,l.current=s),ee.createElement(Ml,null,m&&ee.createElement("defs",null,ee.createElement("clipPath",{id:"animationClipPath-".concat(r)},ee.createElement(Yme,{alpha:We,points:c,baseLine:s,layout:j,strokeWidth:n.strokeWidth}))),ee.createElement(Ml,{clipPath:"url(#animationClipPath-".concat(r,")")},ee.createElement(g4,{points:c,baseLine:s,needClip:e,clipPathId:r,props:n})))}),ee.createElement(bU,{label:n.label}))}function Qme(t){var{needClip:e,clipPathId:r,props:n}=t,i=ee.useRef(null),l=ee.useRef();return ee.createElement(Kme,{needClip:e,clipPathId:r,props:n,previousPointsRef:i,previousBaselineRef:l})}class Jme extends ee.PureComponent{render(){var{hide:e,dot:r,points:n,className:i,top:l,left:c,needClip:s,xAxisId:m,yAxisId:b,width:w,height:E,id:O,baseLine:N,zIndex:V}=this.props;if(e)return null;var W=Ln("recharts-area",i),j=O,{r:Y,strokeWidth:ce}=VU(r),re=bM(r),ue=Y*2+ce,me=s?"url(#clipPath-".concat(re?"":"dots-").concat(j,")"):void 0;return ee.createElement(Ou,{zIndex:V},ee.createElement(Ml,{className:W},s&&ee.createElement("defs",null,ee.createElement(zU,{clipPathId:j,xAxisId:m,yAxisId:b}),!re&&ee.createElement("clipPath",{id:"clipPath-dots-".concat(j)},ee.createElement("rect",{x:c-ue/2,y:l-ue/2,width:w+ue,height:E+ue}))),ee.createElement(Qme,{needClip:s,clipPathId:j,props:this.props})),ee.createElement(zP,{points:n,mainColor:hT(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:me}),this.props.isRange&&Array.isArray(N)&&ee.createElement(zP,{points:N,mainColor:hT(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:me}))}}var QU={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:ya.area};function e_e(t){var e,r=ba(t,QU),{activeDot:n,animationBegin:i,animationDuration:l,animationEasing:c,connectNulls:s,dot:m,fill:b,fillOpacity:w,hide:E,isAnimationActive:O,legendType:N,stroke:V,xAxisId:W,yAxisId:j}=r,Y=KU(r,Fme),ce=Im(),re=Z5(),{needClip:ue}=SM(W,j),me=wa(),{points:ge,isRange:Ce,baseLine:We}=(e=mr(St=>zme(St,t.id,me)))!==null&&e!==void 0?e:{},Xe=g2();if(ce!=="horizontal"&&ce!=="vertical"||Xe==null||re!=="AreaChart"&&re!=="ComposedChart")return null;var{height:Et,width:gt,x:Ye,y:jt}=Xe;return!ge||!ge.length?null:ee.createElement(Jme,um({},Y,{activeDot:n,animationBegin:i,animationDuration:l,animationEasing:c,baseLine:We,connectNulls:s,dot:m,fill:b,fillOpacity:w,height:Et,hide:E,layout:ce,isAnimationActive:O==="auto"?!Db.isSsr:O,isRange:Ce,legendType:N,needClip:ue,points:ge,stroke:V,width:gt,left:Ye,top:jt,xAxisId:W,yAxisId:j}))}var t_e=(t,e,r,n,i)=>{var l=r??e;if(cr(l))return l;var c=t==="horizontal"?i:n,s=c.scale.domain();if(c.type==="number"){var m=Math.max(s[0],s[1]),b=Math.min(s[0],s[1]);return l==="dataMin"?b:l==="dataMax"||m<0?m:Math.max(Math.min(s[0],s[1]),0)}return l==="dataMin"?s[0]:l==="dataMax"?s[1]:s[0]};function r_e(t){var{areaSettings:{connectNulls:e,baseValue:r,dataKey:n},stackedData:i,layout:l,chartBaseValue:c,xAxis:s,yAxis:m,displayedData:b,dataStartIndex:w,xAxisTicks:E,yAxisTicks:O,bandSize:N}=t,V=i&&i.length,W=t_e(l,c,r,s,m),j=l==="horizontal",Y=!1,ce=b.map((ue,me)=>{var ge,Ce,We,Xe;if(V)Xe=i[w+me];else{var Et=vs(ue,n);Array.isArray(Et)?(Xe=Et,Y=!0):Xe=[W,Et]}var gt=(ge=(Ce=Xe)===null||Ce===void 0?void 0:Ce[1])!==null&&ge!==void 0?ge:null,Ye=gt==null||V&&!e&&vs(ue,n)==null;if(j){var jt;return{x:Ww({axis:s,ticks:E,bandSize:N,entry:ue,index:me}),y:Ye?null:(jt=m.scale.map(gt))!==null&&jt!==void 0?jt:null,value:Xe,payload:ue}}return{x:Ye?null:(We=s.scale.map(gt))!==null&&We!==void 0?We:null,y:Ww({axis:m,ticks:O,bandSize:N,entry:ue,index:me}),value:Xe,payload:ue}}),re;return V||Y?re=ce.map(ue=>{var me,ge=Array.isArray(ue.value)?ue.value[0]:null;if(j){var Ce;return{x:ue.x,y:ge!=null&&ue.y!=null&&(Ce=m.scale.map(ge))!==null&&Ce!==void 0?Ce:null,payload:ue.payload}}return{x:ge!=null&&(me=s.scale.map(ge))!==null&&me!==void 0?me:null,y:ue.y,payload:ue.payload}}):re=j?m.scale.map(W):s.scale.map(W),{points:ce,baseLine:re??0,isRange:Y}}function n_e(t){var e=ba(t,QU),r=wa();return ee.createElement(AU,{id:e.id,type:"area"},n=>ee.createElement(ee.Fragment,null,ee.createElement(SU,{legendPayload:Wme(e)}),ee.createElement(Hme,{dataKey:e.dataKey,data:e.data,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,unit:e.unit,tooltipType:e.tooltipType,id:n}),ee.createElement(PU,{type:"area",id:n,data:e.data,dataKey:e.dataKey,xAxisId:e.xAxisId,yAxisId:e.yAxisId,zAxisId:0,stackId:fae(e.stackId),hide:e.hide,barSize:void 0,baseValue:e.baseValue,isPanorama:r,connectNulls:e.connectNulls}),ee.createElement(e_e,um({},e,{id:n}))))}var fT=ee.memo(n_e,m2);fT.displayName="Area";var i_e=["domain","range"],s_e=["domain","range"];function m4(t,e){if(t==null)return{};var r,n,i=a_e(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function a_e(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function _4(t,e){return t===e?!0:Array.isArray(t)&&t.length===2&&Array.isArray(e)&&e.length===2?t[0]===e[0]&&t[1]===e[1]:!1}function JU(t,e){if(t===e)return!0;var{domain:r,range:n}=t,i=m4(t,i_e),{domain:l,range:c}=e,s=m4(e,s_e);return!_4(r,l)||!_4(n,c)?!1:m2(i,s)}var o_e=["type"],l_e=["dangerouslySetInnerHTML","ticks","scale"],c_e=["id","scale"];function BP(){return BP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},BP.apply(null,arguments)}function y4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function v4(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?y4(Object(r),!0).forEach(function(n){u_e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function u_e(t,e,r){return(e=h_e(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h_e(t){var e=f_e(t,"string");return typeof e=="symbol"?e:e+""}function f_e(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function FP(t,e){if(t==null)return{};var r,n,i=d_e(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function d_e(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function p_e(t){var e=xs(),r=ee.useRef(null),n=B3(),{type:i}=t,l=FP(t,o_e),c=s2(n,"xAxis",i),s=ee.useMemo(()=>{if(c!=null)return v4(v4({},l),{},{type:c})},[l,c]);return ee.useLayoutEffect(()=>{s!=null&&(r.current===null?e(ope(s)):r.current!==s&&e(lpe({prev:r.current,next:s})),r.current=s)},[s,e]),ee.useLayoutEffect(()=>()=>{r.current&&(e(cpe(r.current)),r.current=null)},[e]),null}var g_e=t=>{var{xAxisId:e,className:r}=t,n=mr(tj),i=wa(),l="xAxis",c=mr(Y=>P5(Y,l,e,i)),s=mr(Y=>Fce(Y,e)),m=mr(Y=>Hce(Y,e)),b=mr(Y=>Xj(Y,e));if(s==null||m==null||b==null)return null;var{dangerouslySetInnerHTML:w,ticks:E,scale:O}=t,N=FP(t,l_e),{id:V,scale:W}=b,j=FP(b,c_e);return ee.createElement(wM,BP({},N,j,{x:m.x,y:m.y,width:s.width,height:s.height,className:Ln("recharts-".concat(l," ").concat(l),r),viewBox:n,ticks:c,axisType:l}))},m_e={allowDataOverflow:Fs.allowDataOverflow,allowDecimals:Fs.allowDecimals,allowDuplicatedCategory:Fs.allowDuplicatedCategory,angle:Fs.angle,axisLine:Jf.axisLine,height:Fs.height,hide:!1,includeHidden:Fs.includeHidden,interval:Fs.interval,label:!1,minTickGap:Fs.minTickGap,mirror:Fs.mirror,orientation:Fs.orientation,padding:Fs.padding,reversed:Fs.reversed,scale:Fs.scale,tick:Fs.tick,tickCount:Fs.tickCount,tickLine:Jf.tickLine,tickSize:Jf.tickSize,type:Fs.type,xAxisId:0},__e=t=>{var e=ba(t,m_e);return ee.createElement(ee.Fragment,null,ee.createElement(p_e,{allowDataOverflow:e.allowDataOverflow,allowDecimals:e.allowDecimals,allowDuplicatedCategory:e.allowDuplicatedCategory,angle:e.angle,dataKey:e.dataKey,domain:e.domain,height:e.height,hide:e.hide,id:e.xAxisId,includeHidden:e.includeHidden,interval:e.interval,minTickGap:e.minTickGap,mirror:e.mirror,name:e.name,orientation:e.orientation,padding:e.padding,reversed:e.reversed,scale:e.scale,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit}),ee.createElement(g_e,e))},CM=ee.memo(__e,JU);CM.displayName="XAxis";var y_e=["type"],v_e=["dangerouslySetInnerHTML","ticks","scale"],b_e=["id","scale"];function jP(){return jP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},jP.apply(null,arguments)}function b4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function x4(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?b4(Object(r),!0).forEach(function(n){x_e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function x_e(t,e,r){return(e=w_e(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w_e(t){var e=T_e(t,"string");return typeof e=="symbol"?e:e+""}function T_e(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UP(t,e){if(t==null)return{};var r,n,i=S_e(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function S_e(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function A_e(t){var e=xs(),r=ee.useRef(null),n=B3(),{type:i}=t,l=UP(t,y_e),c=s2(n,"yAxis",i),s=ee.useMemo(()=>{if(c!=null)return x4(x4({},l),{},{type:c})},[c,l]);return ee.useLayoutEffect(()=>{s!=null&&(r.current===null?e(upe(s)):r.current!==s&&e(hpe({prev:r.current,next:s})),r.current=s)},[s,e]),ee.useLayoutEffect(()=>()=>{r.current&&(e(fpe(r.current)),r.current=null)},[e]),null}function E_e(t){var{yAxisId:e,className:r,width:n,label:i}=t,l=ee.useRef(null),c=ee.useRef(null),s=mr(tj),m=wa(),b=xs(),w="yAxis",E=mr(ge=>Gce(ge,e)),O=mr(ge=>Xce(ge,e)),N=mr(ge=>P5(ge,w,e,m)),V=mr(ge=>Gj(ge,e));if(ee.useLayoutEffect(()=>{if(!(n!=="auto"||!E||vM(i)||ee.isValidElement(i)||V==null)){var ge=l.current;if(ge){var Ce=ge.getCalculatedWidth();Math.round(E.width)!==Math.round(Ce)&&b(dpe({id:e,width:Ce}))}}},[N,E,b,i,e,n,V]),E==null||O==null||V==null)return null;var{dangerouslySetInnerHTML:W,ticks:j,scale:Y}=t,ce=UP(t,v_e),{id:re,scale:ue}=V,me=UP(V,b_e);return ee.createElement(wM,jP({},ce,me,{ref:l,labelRef:c,x:O.x,y:O.y,tickTextProps:n==="auto"?{width:void 0}:{width:n},width:E.width,height:E.height,className:Ln("recharts-".concat(w," ").concat(w),r),viewBox:s,ticks:N,axisType:w}))}var P_e={allowDataOverflow:js.allowDataOverflow,allowDecimals:js.allowDecimals,allowDuplicatedCategory:js.allowDuplicatedCategory,angle:js.angle,axisLine:Jf.axisLine,hide:!1,includeHidden:js.includeHidden,interval:js.interval,label:!1,minTickGap:js.minTickGap,mirror:js.mirror,orientation:js.orientation,padding:js.padding,reversed:js.reversed,scale:js.scale,tick:js.tick,tickCount:js.tickCount,tickLine:Jf.tickLine,tickSize:Jf.tickSize,type:js.type,width:js.width,yAxisId:0},C_e=t=>{var e=ba(t,P_e);return ee.createElement(ee.Fragment,null,ee.createElement(A_e,{interval:e.interval,id:e.yAxisId,scale:e.scale,type:e.type,domain:e.domain,allowDataOverflow:e.allowDataOverflow,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,padding:e.padding,includeHidden:e.includeHidden,reversed:e.reversed,ticks:e.ticks,width:e.width,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:e.angle,minTickGap:e.minTickGap,tick:e.tick,tickFormatter:e.tickFormatter}),ee.createElement(E_e,e))},MM=ee.memo(C_e,JU);MM.displayName="YAxis";var M_e=(t,e)=>e,IM=bt([M_e,ai,Hj,Hs,$5,fd,lhe,xa],ghe),RM=t=>{var e=t.currentTarget.getBoundingClientRect(),r=e.width/t.currentTarget.offsetWidth,n=e.height/t.currentTarget.offsetHeight;return{chartX:Math.round((t.clientX-e.left)/r),chartY:Math.round((t.clientY-e.top)/n)}},e8=Tc("mouseClick"),t8=Cb();t8.startListening({actionCreator:e8,effect:(t,e)=>{var r=t.payload,n=IM(e.getState(),RM(r));n?.activeIndex!=null&&e.dispatch(oue({activeIndex:n.activeIndex,activeDataKey:void 0,activeCoordinate:n.activeCoordinate}))}});var VP=Tc("mouseMove"),r8=Cb(),S1=null;r8.startListening({actionCreator:VP,effect:(t,e)=>{var r=t.payload;S1!==null&&cancelAnimationFrame(S1);var n=RM(r);S1=requestAnimationFrame(()=>{var i=e.getState(),l=lM(i,i.tooltip.settings.shared);if(l==="axis"){var c=IM(i,n);c?.activeIndex!=null?e.dispatch(k5({activeIndex:c.activeIndex,activeDataKey:void 0,activeCoordinate:c.activeCoordinate})):e.dispatch(D5())}S1=null})}});function I_e(t,e){return e instanceof HTMLElement?"HTMLElement <".concat(e.tagName,' class="').concat(e.className,'">'):e===window?"global.window":t==="children"&&typeof e=="object"&&e!==null?"<<CHILDREN>>":e}var w4={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},n8=Go({name:"rootProps",initialState:w4,reducers:{updateOptions:(t,e)=>{var r;t.accessibilityLayer=e.payload.accessibilityLayer,t.barCategoryGap=e.payload.barCategoryGap,t.barGap=(r=e.payload.barGap)!==null&&r!==void 0?r:w4.barGap,t.barSize=e.payload.barSize,t.maxBarSize=e.payload.maxBarSize,t.stackOffset=e.payload.stackOffset,t.syncId=e.payload.syncId,t.syncMethod=e.payload.syncMethod,t.className=e.payload.className,t.baseValue=e.payload.baseValue,t.reverseStackOrder=e.payload.reverseStackOrder}}}),R_e=n8.reducer,{updateOptions:O_e}=n8.actions,D_e=null,k_e={updatePolarOptions:(t,e)=>e.payload},i8=Go({name:"polarOptions",initialState:D_e,reducers:k_e}),{updatePolarOptions:ave}=i8.actions,L_e=i8.reducer,s8=Tc("keyDown"),a8=Tc("focus"),OM=Cb();OM.startListening({actionCreator:s8,effect:(t,e)=>{var r=e.getState(),n=r.rootProps.accessibilityLayer!==!1;if(n){var{keyboardInteraction:i}=r.tooltip,l=t.payload;if(!(l!=="ArrowRight"&&l!=="ArrowLeft"&&l!=="Enter")){var c=cM(i,nv(r),Nb(r),Bb(r)),s=c==null?-1:Number(c);if(!(!Number.isFinite(s)||s<0)){var m=fd(r);if(l==="Enter"){var b=iT(r,"axis","hover",String(i.index));e.dispatch(OP({active:!i.active,activeIndex:i.index,activeCoordinate:b}));return}var w=Qce(r),E=w==="left-to-right"?1:-1,O=l==="ArrowRight"?1:-1,N=s+O*E;if(!(m==null||N>=m.length||N<0)){var V=iT(r,"axis","hover",String(N));e.dispatch(OP({active:!0,activeIndex:N.toString(),activeCoordinate:V}))}}}}}});OM.startListening({actionCreator:a8,effect:(t,e)=>{var r=e.getState(),n=r.rootProps.accessibilityLayer!==!1;if(n){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&i.index==null){var l="0",c=iT(r,"axis","hover",String(l));e.dispatch(OP({active:!0,activeIndex:l,activeCoordinate:c}))}}}});var dc=Tc("externalEvent"),o8=Cb(),hE=new Map;o8.startListening({actionCreator:dc,effect:(t,e)=>{var{handler:r,reactEvent:n}=t.payload;if(r!=null){n.persist();var i=n.type,l=hE.get(i);l!==void 0&&cancelAnimationFrame(l);var c=requestAnimationFrame(()=>{try{var s=e.getState(),m={activeCoordinate:Xue(s),activeDataKey:Hue(s),activeIndex:ub(s),activeLabel:q5(s),activeTooltipIndex:ub(s),isTooltipActive:Gue(s)};r(m,n)}finally{hE.delete(i)}});hE.set(i,c)}}});var N_e=bt([tv],t=>t.tooltipItemPayloads),z_e=bt([N_e,(t,e)=>e,(t,e,r)=>r],(t,e,r)=>{if(e!=null){var n=t.find(l=>l.settings.graphicalItemId===r);if(n!=null){var{getPosition:i}=n;if(i!=null)return i(e)}}}),l8=Tc("touchMove"),c8=Cb();c8.startListening({actionCreator:l8,effect:(t,e)=>{var r=t.payload;if(!(r.touches==null||r.touches.length===0)){var n=e.getState(),i=lM(n,n.tooltip.settings.shared);if(i==="axis"){var l=r.touches[0];if(l==null)return;var c=IM(n,RM({clientX:l.clientX,clientY:l.clientY,currentTarget:r.currentTarget}));c?.activeIndex!=null&&e.dispatch(k5({activeIndex:c.activeIndex,activeDataKey:void 0,activeCoordinate:c.activeCoordinate}))}else if(i==="item"){var s,m=r.touches[0];if(document.elementFromPoint==null||m==null)return;var b=document.elementFromPoint(m.clientX,m.clientY);if(!b||!b.getAttribute)return;var w=b.getAttribute(vae),E=(s=b.getAttribute(bae))!==null&&s!==void 0?s:void 0,O=rv(n).find(W=>W.id===E);if(w==null||O==null||E==null)return;var{dataKey:N}=O,V=z_e(n,w,E);e.dispatch(aue({activeDataKey:N,activeIndex:w,activeCoordinate:V,activeGraphicalItemId:E}))}}}});var B_e=T6({brush:Tpe,cartesianAxis:ppe,chartData:qhe,errorBars:Dge,graphicalItems:Xde,layout:nae,legend:hoe,options:Uhe,polarAxis:yde,polarOptions:L_e,referenceElements:Rpe,rootProps:R_e,tooltip:lue,zIndex:Mhe}),F_e=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return Cse({reducer:B_e,preloadedState:e,middleware:n=>{var i;return n({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes((i="es6")!==null&&i!==void 0?i:"")}).concat([t8.middleware,r8.middleware,OM.middleware,o8.middleware,c8.middleware])},enhancers:n=>{var i=n;return typeof n=="function"&&(i=n()),i.concat(B6({type:"raf"}))},devTools:{serialize:{replacer:I_e},name:"recharts-".concat(r)}})};function j_e(t){var{preloadedState:e,children:r,reduxStoreName:n}=t,i=wa(),l=ee.useRef(null);if(i)return r;l.current==null&&(l.current=F_e(e,n));var c=M3;return ee.createElement(lme,{context:c,store:l.current},r)}function U_e(t){var{layout:e,margin:r}=t,n=xs(),i=wa();return ee.useEffect(()=>{i||(n(eae(e)),n(Jse(r)))},[n,i,e,r]),null}var V_e=ee.memo(U_e,m2);function $_e(t){var e=xs();return ee.useEffect(()=>{e(O_e(t))},[e,t]),null}function T4(t){var{zIndex:e,isPanorama:r}=t,n=ee.useRef(null),i=xs();return ee.useLayoutEffect(()=>(n.current&&i(Phe({zIndex:e,element:n.current,isPanorama:r})),()=>{i(Che({zIndex:e,isPanorama:r}))}),[i,e,r]),ee.createElement("g",{tabIndex:-1,ref:n})}function S4(t){var{children:e,isPanorama:r}=t,n=mr(_he);if(!n||n.length===0)return e;var i=n.filter(c=>c<0),l=n.filter(c=>c>0);return ee.createElement(ee.Fragment,null,i.map(c=>ee.createElement(T4,{key:c,zIndex:c,isPanorama:r})),e,l.map(c=>ee.createElement(T4,{key:c,zIndex:c,isPanorama:r})))}var W_e=["children"];function H_e(t,e){if(t==null)return{};var r,n,i=q_e(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function q_e(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function dT(){return dT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},dT.apply(null,arguments)}var X_e={width:"100%",height:"100%",display:"block"},G_e=ee.forwardRef((t,e)=>{var r=oj(),n=lj(),i=_j();if(!zh(r)||!zh(n))return null;var{children:l,otherAttributes:c,title:s,desc:m}=t,b,w;return c!=null&&(typeof c.tabIndex=="number"?b=c.tabIndex:b=i?0:void 0,typeof c.role=="string"?w=c.role:w=i?"application":void 0),ee.createElement(jF,dT({},c,{title:s,desc:m,role:w,tabIndex:b,width:r,height:n,style:X_e,ref:e}),l)}),Z_e=t=>{var{children:e}=t,r=mr(KT);if(!r)return null;var{width:n,height:i,y:l,x:c}=r;return ee.createElement(jF,{width:n,height:i,x:c,y:l},e)},A4=ee.forwardRef((t,e)=>{var{children:r}=t,n=H_e(t,W_e),i=wa();return i?ee.createElement(Z_e,null,ee.createElement(S4,{isPanorama:!0},r)):ee.createElement(G_e,dT({ref:e},n),ee.createElement(S4,{isPanorama:!1},r))});function Y_e(){var t=xs(),[e,r]=ee.useState(null),n=mr(yae);return ee.useEffect(()=>{if(e!=null){var i=e.getBoundingClientRect(),l=i.width/e.offsetWidth;Br(l)&&l!==n&&t(rae(l))}},[e,t,n]),r}function E4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function K_e(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?E4(Object(r),!0).forEach(function(n){Q_e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):E4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Q_e(t,e,r){return(e=J_e(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function J_e(t){var e=eye(t,"string");return typeof e=="symbol"?e:e+""}function eye(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ap(){return Ap=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ap.apply(null,arguments)}var tye=()=>(tfe(),null);function pT(t){if(typeof t=="number")return t;if(typeof t=="string"){var e=parseFloat(t);if(!Number.isNaN(e))return e}return 0}var rye=ee.forwardRef((t,e)=>{var r,n,i=ee.useRef(null),[l,c]=ee.useState({containerWidth:pT((r=t.style)===null||r===void 0?void 0:r.width),containerHeight:pT((n=t.style)===null||n===void 0?void 0:n.height)}),s=ee.useCallback((b,w)=>{c(E=>{var O=Math.round(b),N=Math.round(w);return E.containerWidth===O&&E.containerHeight===N?E:{containerWidth:O,containerHeight:N}})},[]),m=ee.useCallback(b=>{if(typeof e=="function"&&e(b),b!=null&&typeof ResizeObserver<"u"){var{width:w,height:E}=b.getBoundingClientRect();s(w,E);var O=V=>{var W=V[0];if(W!=null){var{width:j,height:Y}=W.contentRect;s(j,Y)}},N=new ResizeObserver(O);N.observe(b),i.current=N}},[e,s]);return ee.useEffect(()=>()=>{var b=i.current;b?.disconnect()},[s]),ee.createElement(ee.Fragment,null,ee.createElement(Rb,{width:l.containerWidth,height:l.containerHeight}),ee.createElement("div",Ap({ref:m},t)))}),nye=ee.forwardRef((t,e)=>{var{width:r,height:n}=t,[i,l]=ee.useState({containerWidth:pT(r),containerHeight:pT(n)}),c=ee.useCallback((m,b)=>{l(w=>{var E=Math.round(m),O=Math.round(b);return w.containerWidth===E&&w.containerHeight===O?w:{containerWidth:E,containerHeight:O}})},[]),s=ee.useCallback(m=>{if(typeof e=="function"&&e(m),m!=null){var{width:b,height:w}=m.getBoundingClientRect();c(b,w)}},[e,c]);return ee.createElement(ee.Fragment,null,ee.createElement(Rb,{width:i.containerWidth,height:i.containerHeight}),ee.createElement("div",Ap({ref:s},t)))}),iye=ee.forwardRef((t,e)=>{var{width:r,height:n}=t;return ee.createElement(ee.Fragment,null,ee.createElement(Rb,{width:r,height:n}),ee.createElement("div",Ap({ref:e},t)))}),sye=ee.forwardRef((t,e)=>{var{width:r,height:n}=t;return typeof r=="string"||typeof n=="string"?ee.createElement(nye,Ap({},t,{ref:e})):typeof r=="number"&&typeof n=="number"?ee.createElement(iye,Ap({},t,{width:r,height:n,ref:e})):ee.createElement(ee.Fragment,null,ee.createElement(Rb,{width:r,height:n}),ee.createElement("div",Ap({ref:e},t)))});function aye(t){return t?rye:sye}var oye=ee.forwardRef((t,e)=>{var{children:r,className:n,height:i,onClick:l,onContextMenu:c,onDoubleClick:s,onMouseDown:m,onMouseEnter:b,onMouseLeave:w,onMouseMove:E,onMouseUp:O,onTouchEnd:N,onTouchMove:V,onTouchStart:W,style:j,width:Y,responsive:ce,dispatchTouchEvents:re=!0}=t,ue=ee.useRef(null),me=xs(),[ge,Ce]=ee.useState(null),[We,Xe]=ee.useState(null),Et=Y_e(),gt=N3(),Ye=gt?.width>0?gt.width:Y,jt=gt?.height>0?gt.height:i,St=ee.useCallback(_t=>{Et(_t),typeof e=="function"&&e(_t),Ce(_t),Xe(_t),_t!=null&&(ue.current=_t)},[Et,e,Ce,Xe]),Zt=ee.useCallback(_t=>{me(e8(_t)),me(dc({handler:l,reactEvent:_t}))},[me,l]),fe=ee.useCallback(_t=>{me(VP(_t)),me(dc({handler:b,reactEvent:_t}))},[me,b]),Me=ee.useCallback(_t=>{me(D5()),me(dc({handler:w,reactEvent:_t}))},[me,w]),Ee=ee.useCallback(_t=>{me(VP(_t)),me(dc({handler:E,reactEvent:_t}))},[me,E]),Ue=ee.useCallback(()=>{me(a8())},[me]),st=ee.useCallback(_t=>{me(s8(_t.key))},[me]),ye=ee.useCallback(_t=>{me(dc({handler:c,reactEvent:_t}))},[me,c]),Be=ee.useCallback(_t=>{me(dc({handler:s,reactEvent:_t}))},[me,s]),lt=ee.useCallback(_t=>{me(dc({handler:m,reactEvent:_t}))},[me,m]),Tt=ee.useCallback(_t=>{me(dc({handler:O,reactEvent:_t}))},[me,O]),zt=ee.useCallback(_t=>{me(dc({handler:W,reactEvent:_t}))},[me,W]),Xt=ee.useCallback(_t=>{re&&me(l8(_t)),me(dc({handler:V,reactEvent:_t}))},[me,re,V]),Wt=ee.useCallback(_t=>{me(dc({handler:N,reactEvent:_t}))},[me,N]),nr=aye(ce);return ee.createElement(eU.Provider,{value:ge},ee.createElement(one.Provider,{value:We},ee.createElement(nr,{width:Ye??j?.width,height:jt??j?.height,className:Ln("recharts-wrapper",n),style:K_e({position:"relative",cursor:"default",width:Ye,height:jt},j),onClick:Zt,onContextMenu:ye,onDoubleClick:Be,onFocus:Ue,onKeyDown:st,onMouseDown:lt,onMouseEnter:fe,onMouseLeave:Me,onMouseMove:Ee,onMouseUp:Tt,onTouchEnd:Wt,onTouchMove:Xt,onTouchStart:zt,ref:St},ee.createElement(tye,null),r)))}),lye=["width","height","responsive","children","className","style","compact","title","desc"];function cye(t,e){if(t==null)return{};var r,n,i=uye(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)r=l[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function uye(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var hye=ee.forwardRef((t,e)=>{var{width:r,height:n,responsive:i,children:l,className:c,style:s,compact:m,title:b,desc:w}=t,E=cye(t,lye),O=xc(E);return m?ee.createElement(ee.Fragment,null,ee.createElement(Rb,{width:r,height:n}),ee.createElement(A4,{otherAttributes:O,title:b,desc:w},l)):ee.createElement(oye,{className:c,style:s,width:r,height:n,responsive:i??!1,onClick:t.onClick,onMouseLeave:t.onMouseLeave,onMouseEnter:t.onMouseEnter,onMouseMove:t.onMouseMove,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onContextMenu:t.onContextMenu,onDoubleClick:t.onDoubleClick,onTouchStart:t.onTouchStart,onTouchMove:t.onTouchMove,onTouchEnd:t.onTouchEnd},ee.createElement(A4,{otherAttributes:O,title:b,desc:w,ref:e},ee.createElement(Ope,null,l)))});function $P(){return $P=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},$P.apply(null,arguments)}var fye={top:5,right:5,bottom:5,left:5},dye={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,layout:"horizontal",margin:fye,responsive:!1,reverseStackOrder:!1,stackOffset:"none",syncMethod:"index"},u8=ee.forwardRef(function(e,r){var n,i=ba(e.categoricalChartProps,dye),{chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:s,tooltipPayloadSearcher:m,categoricalChartProps:b}=e,w={chartName:l,defaultTooltipEventType:c,validateTooltipEventTypes:s,tooltipPayloadSearcher:m,eventEmitter:void 0};return ee.createElement(j_e,{preloadedState:{options:w},reduxStoreName:(n=b.id)!==null&&n!==void 0?n:l},ee.createElement(wpe,{chartData:b.data}),ee.createElement(V_e,{layout:i.layout,margin:i.margin}),ee.createElement($_e,{baseValue:i.baseValue,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),ee.createElement(hye,$P({},i,{ref:r})))}),pye=["axis"],gye=ee.forwardRef((t,e)=>ee.createElement(u8,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:pye,tooltipPayloadSearcher:tU,categoricalChartProps:t,ref:e})),mye=["axis"],_ye=ee.forwardRef((t,e)=>ee.createElement(u8,{chartName:"ComposedChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:mye,tooltipPayloadSearcher:tU,categoricalChartProps:t,ref:e}));function yye({regressionResults:t,selectedCity:e}){const r=e==="all"?"all":e,n=ee.useMemo(()=>t.parallel_trends[r],[t,r]),i=ee.useMemo(()=>t.did_coefficients[r],[t,r]),l=e==="all"?"All Cities":e;return se.jsxs("div",{className:"did-chart",children:[se.jsxs("div",{className:"chart-header",children:[se.jsxs("h3",{children:["Parallel Trends Test: ",l]}),se.jsx("p",{className:"chart-description",children:"LST change relative to year -1 (one year before demolition)"})]}),se.jsx("div",{className:"chart-container",children:se.jsx(sj,{width:"100%",height:350,children:se.jsxs(_ye,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[se.jsx(TM,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),se.jsx(CM,{dataKey:"year",label:{value:"Time Since Demolition [Year]",position:"insideBottom",offset:-10},tick:{fontSize:12},tickFormatter:c=>c>=0?`+${c}`:`${c}`}),se.jsx(MM,{label:{value:"LST Change [K]",angle:-90,position:"insideLeft",offset:10},domain:[-6,4],tick:{fontSize:12}}),se.jsx(iU,{formatter:c=>[`${(typeof c=="number"?c:0).toFixed(2)} K`,"Coefficient"],labelFormatter:c=>`Year ${Number(c)>=0?"+":""}${c} (relative to demolition)`}),se.jsx(fb,{y:0,stroke:"#666",strokeWidth:1}),se.jsx(fb,{x:-1,stroke:"#e74c3c",strokeDasharray:"5 5",strokeWidth:2,label:{value:"Reference (t=-1)",position:"top",fill:"#e74c3c",fontSize:11}}),se.jsx(fT,{type:"monotone",dataKey:"ci_upper",stroke:"none",fill:"#3b82f6",fillOpacity:0}),se.jsx(fT,{type:"monotone",dataKey:"ci_lower",stroke:"none",fill:"#3b82f6",fillOpacity:.15}),se.jsx(G1,{type:"monotone",dataKey:"coef",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2,r:4},activeDot:{r:6,fill:"#1d4ed8"}}),se.jsx(G1,{type:"monotone",dataKey:"ci_lower",stroke:"#93c5fd",strokeWidth:1,strokeDasharray:"4 4",dot:!1}),se.jsx(G1,{type:"monotone",dataKey:"ci_upper",stroke:"#93c5fd",strokeWidth:1,strokeDasharray:"4 4",dot:!1})]})})}),se.jsxs("div",{className:"did-summary",children:[se.jsx("h4",{children:"DiD Coefficient Summary"}),se.jsxs("div",{className:"summary-grid",children:[se.jsxs("div",{className:"summary-item",children:[se.jsx("span",{className:"label",children:"Cooling Effect:"}),se.jsxs("span",{className:"value effect",children:[i.effect.toFixed(2)," K"]})]}),se.jsxs("div",{className:"summary-item",children:[se.jsx("span",{className:"label",children:"95% CI:"}),se.jsxs("span",{className:"value",children:["[",i.ci_lower.toFixed(2),", ",i.ci_upper.toFixed(2),"]"]})]}),se.jsxs("div",{className:"summary-item",children:[se.jsx("span",{className:"label",children:"Std. Error:"}),se.jsx("span",{className:"value",children:i.se.toFixed(2)})]}),se.jsxs("div",{className:"summary-item",children:[se.jsx("span",{className:"label",children:"p-value:"}),se.jsxs("span",{className:"value",children:["<",i.p_value.toFixed(2),i.p_value<=.01?"***":i.p_value<=.05?"**":"*"]})]}),se.jsxs("div",{className:"summary-item",children:[se.jsx("span",{className:"label",children:"R:"}),se.jsx("span",{className:"value",children:i.r2.toFixed(2)})]})]}),se.jsx("p",{className:"interpretation",children:e==="all"?se.jsxs(se.Fragment,{children:["Across all three cities, demolishing informal settlements resulted in an average land surface temperature reduction of ",se.jsxs("strong",{children:[Math.abs(i.effect).toFixed(2)," K"]}),"."]}):se.jsxs(se.Fragment,{children:["In ",e,", demolishing informal settlements caused a land surface temperature reduction of ",se.jsxs("strong",{children:[Math.abs(i.effect).toFixed(2)," K"]}),"."]})})]})]})}const vye=[{value:"all",label:"All Cities",emoji:""},{value:"Beijing",label:"Beijing",emoji:""},{value:"Shanghai",label:"Shanghai",emoji:""},{value:"Guangzhou",label:"Guangzhou",emoji:""}];function bye({selectedCity:t,onCityChange:e}){return se.jsxs("div",{className:"city-selector",children:[se.jsx("span",{className:"selector-label",children:"Select City:"}),se.jsx("div",{className:"city-buttons",children:vye.map(r=>se.jsxs("button",{className:`city-button ${t===r.value?"active":""}`,onClick:()=>e(r.value),children:[se.jsx("span",{className:"city-emoji",children:r.emoji}),se.jsx("span",{className:"city-name",children:r.label})]},r.value))})]})}function A1(t,e,r,n,i=100){const l=[],c=(n-r)/i;for(let s=r;s<=n;s+=c){const m=(s-t)/e,b=1/(e*Math.sqrt(2*Math.PI))*Math.exp(-.5*m*m);l.push({x:Math.round(s*100)/100,density:Math.round(b*1e3)/1e3})}return l}const P4={all:{name:"All Cities",actualEffect:-1.268,data:A1(.1,.25,-2,2,120),xDomain:[-2,2],yDomain:[0,2]},beijing:{name:"Beijing",actualEffect:-3.135,data:A1(1.2,.8,-3.5,3.5,120),xDomain:[-3.5,3.5],yDomain:[0,1]},shanghai:{name:"Shanghai",actualEffect:-1.131,data:A1(.3,.45,-2,2,120),xDomain:[-2,2],yDomain:[0,1.5]},guangzhou:{name:"Guangzhou",actualEffect:-1.029,data:A1(.2,.5,-2,2,120),xDomain:[-2,2],yDomain:[0,1]}};function xye(){const[t,e]=ee.useState("all"),r=P4[t];return se.jsxs("div",{className:"placebo-chart-container",children:[se.jsx("div",{className:"placebo-city-selector",children:Object.entries(P4).map(([n,i])=>se.jsx("button",{className:`placebo-city-btn ${t===n?"active":""}`,onClick:()=>e(n),children:i.name},n))}),se.jsx("div",{className:"placebo-chart",children:se.jsx(sj,{width:"100%",height:300,children:se.jsxs(gye,{data:r.data,margin:{top:20,right:30,left:20,bottom:20},children:[se.jsx(TM,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),se.jsx(CM,{dataKey:"x",type:"number",domain:r.xDomain,tickFormatter:n=>n.toFixed(1),label:{value:"Coefficients from placebo regression",position:"insideBottom",offset:-10,style:{fontSize:"0.85rem",fill:"#64748b"}}}),se.jsx(MM,{domain:r.yDomain,tickFormatter:n=>n.toFixed(1),label:{value:"Density",angle:-90,position:"insideLeft",style:{fontSize:"0.85rem",fill:"#64748b"}}}),se.jsx(iU,{formatter:n=>[typeof n=="number"?n.toFixed(3):n,"Density"],labelFormatter:n=>`Coefficient: ${typeof n=="number"?n.toFixed(2):n}`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e2e8f0",borderRadius:"6px"}}),se.jsx(fT,{type:"monotone",dataKey:"density",stroke:"#3b82f6",fill:"#93c5fd",fillOpacity:.6,strokeWidth:2}),se.jsx(fb,{x:0,stroke:"#000",strokeDasharray:"5 5",strokeWidth:1}),se.jsx(fb,{x:r.actualEffect,stroke:"#dc2626",strokeWidth:2,label:{value:`DiD = ${r.actualEffect}`,position:"top",fill:"#dc2626",fontSize:12,fontWeight:600}})]})})}),se.jsx("div",{className:"placebo-interpretation",children:se.jsxs("p",{children:[se.jsx("strong",{children:"Interpretation:"})," The blue curve shows the distribution of 500 placebo coefficients (randomly assigned demolition years). The red line marks the actual DiD estimate (",r.actualEffect," K). The actual effect falls far in the left tail, confirming that the cooling effect is unlikely due to random chance."]})})]})}function wye(){return se.jsxs("div",{className:"page-content",children:[se.jsx("h2",{children:"Methods"}),se.jsxs("section",{className:"method-section",children:[se.jsx("h3",{children:"Difference-in-Differences Framework"}),se.jsx("p",{children:"We assessed the causal impact of informal settlement demolition on Land Surface Temperature (LST) using a difference-in-differences (DiD) framework. This quasi-experimental approach compares LST changes in demolished settlements (treatment group) to those in non-demolished settlements (control group) before and after the intervention, controlling for time-invariant unobserved heterogeneity and observed time-varying covariates."}),se.jsxs("div",{className:"equation-box",children:[se.jsx("h4",{children:"Baseline DiD Model"}),se.jsxs("div",{className:"equation",children:["LST",se.jsx("sub",{children:"it"})," = ",se.jsx("sub",{children:"0"})," + ",se.jsx("sub",{children:"1"}),"DiD",se.jsx("sub",{children:"it"})," + X",se.jsx("sub",{children:"it"})," + ",se.jsx("sub",{children:"i"})," + ",se.jsx("sub",{children:"t"})," + ",se.jsx("sub",{children:"it"})]}),se.jsxs("p",{className:"equation-note",children:["where DiD",se.jsx("sub",{children:"it"})," = group",se.jsx("sub",{children:"i"}),"  time",se.jsx("sub",{children:"t"})]}),se.jsxs("ul",{className:"variable-list",children:[se.jsxs("li",{children:[se.jsxs("strong",{children:["LST",se.jsx("sub",{children:"it"})]}),": Land surface temperature for settlement i in year t"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["group",se.jsx("sub",{children:"i"})]}),": Indicator for demolished (treatment) settlement"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["time",se.jsx("sub",{children:"t"})]}),": Indicator for post-demolition period"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["X",se.jsx("sub",{children:"it"})]}),": Vector of control variables"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["",se.jsx("sub",{children:"i"})]}),": Settlement fixed effects"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["",se.jsx("sub",{children:"t"})]}),": Year fixed effects"]}),se.jsxs("li",{children:[se.jsxs("strong",{children:["",se.jsx("sub",{children:"1"})]}),": Average treatment effect of demolition on LST"]})]})]})]}),se.jsxs("section",{className:"method-section",children:[se.jsx("h3",{children:"Land Surface Temperature Retrieval"}),se.jsx("p",{children:"LST was retrieved using Landsat satellite thermal imagery processed in Google Earth Engine. The retrieval algorithm uses top-of-atmosphere (TOA) radiance and surface reflectance, integrating atmospheric water vapor and surface emissivity data."}),se.jsxs("div",{className:"equation-box",children:[se.jsx("h4",{children:"Fractional Vegetation Cover (FVC)"}),se.jsxs("div",{className:"equation",children:["FVC = ((NDVI - NDVI",se.jsx("sub",{children:"bare"}),") / (NDVI",se.jsx("sub",{children:"veg"})," - NDVI",se.jsx("sub",{children:"bare"}),"))",se.jsx("sup",{children:"2"})]})]}),se.jsxs("div",{className:"equation-box",children:[se.jsx("h4",{children:"Surface Emissivity"}),se.jsxs("div",{className:"equation",children:["",se.jsx("sub",{children:"b"})," = ",se.jsx("sub",{children:"b,veg"}),"  FVC + ",se.jsx("sub",{children:"b,bare"}),"  (1 - FVC)"]})]}),se.jsxs("div",{className:"equation-box",children:[se.jsx("h4",{children:"Statistical Mono-Window (SMW) Algorithm"}),se.jsxs("div",{className:"equation",children:["LST = A",se.jsx("sub",{children:"i"}),"(T",se.jsx("sub",{children:"b"}),"/) + B",se.jsx("sub",{children:"i"}),"(1/) + C",se.jsx("sub",{children:"i"})]}),se.jsxs("p",{className:"equation-note",children:["where T",se.jsx("sub",{children:"b"})," is TOA brightness temperature,  is surface emissivity, and A",se.jsx("sub",{children:"i"}),", B",se.jsx("sub",{children:"i"}),", C",se.jsx("sub",{children:"i"})," are calibration coefficients."]})]})]}),se.jsxs("section",{className:"method-section",children:[se.jsx("h3",{children:"Control Variables"}),se.jsx("p",{children:"Four city-level time-varying covariates were included to isolate the demolition effect:"}),se.jsxs("table",{className:"data-table",children:[se.jsx("thead",{children:se.jsxs("tr",{children:[se.jsx("th",{children:"Variable"}),se.jsx("th",{children:"Purpose"}),se.jsx("th",{children:"Data Source"})]})}),se.jsxs("tbody",{children:[se.jsxs("tr",{children:[se.jsx("td",{children:"Urban Population"}),se.jsx("td",{children:"Controls for agglomeration intensity and anthropogenic heat flux"}),se.jsx("td",{children:"CSMAR Database"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Air Temperature"}),se.jsx("td",{children:"Accounts for background climate variability (e.g., El Nio, heat waves)"}),se.jsx("td",{children:"C3S Climate Data Store"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Urban Construction Land Area"}),se.jsx("td",{children:"Proxy for impervious surface expansion and UHI intensification"}),se.jsx("td",{children:"CSMAR Database"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Nighttime Light Intensity"}),se.jsx("td",{children:"Proxy for economic activity and energy consumption"}),se.jsx("td",{children:"Harmonized NTL Dataset"})]})]})]})]}),se.jsxs("section",{className:"method-section",children:[se.jsx("h3",{children:"Robustness Checks"}),se.jsxs("div",{className:"robustness-item",children:[se.jsx("h4",{children:"1. Parallel Trends Test"}),se.jsx("p",{children:"The DiD design requires that treatment and control groups would have followed parallel temperature trajectories absent the intervention. Pre-intervention coefficients (years -7 to -1) were tightly centered on zero, indicating the groups were on identical thermal paths before demolition."})]}),se.jsxs("div",{className:"robustness-item",children:[se.jsx("h4",{children:"2. Model Specification Tests"}),se.jsx("p",{children:"Stepwise regression was used to test robustness of the core DiD coefficient:"}),se.jsxs("table",{className:"data-table specification-table",children:[se.jsx("thead",{children:se.jsxs("tr",{children:[se.jsx("th",{children:"Variable"}),se.jsx("th",{children:"Model 1"}),se.jsx("th",{children:"Model 2"}),se.jsx("th",{children:"Model 3"}),se.jsx("th",{children:"Model 4"})]})}),se.jsxs("tbody",{children:[se.jsxs("tr",{children:[se.jsx("td",{children:se.jsx("strong",{children:"Urban Renewal Effect"})}),se.jsx("td",{children:"-1.419***"}),se.jsx("td",{children:"-1.429***"}),se.jsx("td",{children:"-1.248***"}),se.jsx("td",{children:"-1.467***"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Urban Population"}),se.jsx("td",{children:"0.003***"}),se.jsx("td",{children:"0.003***"}),se.jsx("td",{children:"0.003***"}),se.jsx("td",{children:"0.001***"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Air Temperature"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"0.637***"}),se.jsx("td",{children:"0.653***"}),se.jsx("td",{children:"0.586***"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Construction Land Area"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"0.001***"}),se.jsx("td",{children:"0.001***"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Nighttime Light"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"-"}),se.jsx("td",{children:"1.52e-5***"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"R"}),se.jsx("td",{children:"0.361"}),se.jsx("td",{children:"0.365"}),se.jsx("td",{children:"0.391"}),se.jsx("td",{children:"0.402"})]})]})]}),se.jsxs("p",{className:"table-note",children:["*** p ","<"," 0.01. Standard errors clustered at settlement level."]})]}),se.jsxs("div",{className:"robustness-item",children:[se.jsx("h4",{children:"3. Placebo Test"}),se.jsx("p",{children:"Demolition years were randomly assigned 500 times to generate a null distribution. The actual DiD estimates fell far in the left tail of all placebo distributions, confirming effects are unlikely due to random chance:"}),se.jsx(xye,{})]}),se.jsxs("div",{className:"robustness-item",children:[se.jsx("h4",{children:"4. Heterogeneity Analysis"}),se.jsx("p",{children:"Spatial heterogeneity was examined through interaction terms:"}),se.jsxs("table",{className:"data-table",children:[se.jsx("thead",{children:se.jsxs("tr",{children:[se.jsx("th",{children:"Factor"}),se.jsx("th",{children:"Relationship"}),se.jsx("th",{children:"R"}),se.jsx("th",{children:"p-value"})]})}),se.jsxs("tbody",{children:[se.jsxs("tr",{children:[se.jsx("td",{children:"Log-distance to city center"}),se.jsx("td",{children:"Negative (stronger cooling in periphery)"}),se.jsx("td",{children:"0.25"}),se.jsxs("td",{children:["<"," 0.01"]})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Log-settlement area"}),se.jsx("td",{children:"No significant relationship"}),se.jsx("td",{children:"0.004"}),se.jsxs("td",{children:[">"," 0.1"]})]})]})]})]})]}),se.jsxs("section",{className:"method-section",children:[se.jsx("h3",{children:"Main Results Summary"}),se.jsxs("table",{className:"data-table results-table",children:[se.jsx("thead",{children:se.jsxs("tr",{children:[se.jsx("th",{children:"City"}),se.jsx("th",{children:"Cooling Effect (K)"}),se.jsx("th",{children:"Std. Error"}),se.jsx("th",{children:"p-value"}),se.jsx("th",{children:"95% CI"}),se.jsx("th",{children:"R"})]})}),se.jsxs("tbody",{children:[se.jsxs("tr",{children:[se.jsx("td",{children:"All Cities"}),se.jsx("td",{children:se.jsx("strong",{children:"-1.47"})}),se.jsx("td",{children:"0.25"}),se.jsxs("td",{children:["<"," 0.01***"]}),se.jsx("td",{children:"[-1.97, -0.97]"}),se.jsx("td",{children:"0.40"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Beijing"}),se.jsx("td",{children:se.jsx("strong",{children:"-3.04"})}),se.jsx("td",{children:"0.37"}),se.jsxs("td",{children:["<"," 0.01***"]}),se.jsx("td",{children:"[-3.77, -2.30]"}),se.jsx("td",{children:"0.87"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Shanghai"}),se.jsx("td",{children:se.jsx("strong",{children:"-1.09"})}),se.jsx("td",{children:"0.27"}),se.jsxs("td",{children:["<"," 0.01***"]}),se.jsx("td",{children:"[-1.62, -0.56]"}),se.jsx("td",{children:"0.75"})]}),se.jsxs("tr",{children:[se.jsx("td",{children:"Guangzhou"}),se.jsx("td",{children:se.jsx("strong",{children:"-1.23"})}),se.jsx("td",{children:"0.36"}),se.jsxs("td",{children:["<"," 0.05**"]}),se.jsx("td",{children:"[-1.95, -0.52]"}),se.jsx("td",{children:"0.61"})]})]})]}),se.jsx("p",{className:"table-note",children:"***, ** denote significance at 1% and 5% levels. Year and settlement fixed effects included."})]})]})}function Tye(){return se.jsxs("div",{className:"page-content",children:[se.jsx("h2",{children:"Policy Implications"}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Key Finding: Causal Cooling Effect"}),se.jsxs("p",{children:["This study provides the ",se.jsx("strong",{children:"first robust causal evidence"})," that demolishing dense informal settlements leads to significant reductions in land surface temperatures. Using a difference-in-differences framework with 77 demolished settlements and 584 controls across Beijing, Shanghai, and Guangzhou (2002-2022), we found:"]}),se.jsxs("ul",{className:"key-points",children:[se.jsxs("li",{children:["Average cooling effect of ",se.jsx("strong",{children:"1.47 K"})," across all cities"]}),se.jsxs("li",{children:["Strongest effect in Beijing (",se.jsx("strong",{children:"3.04 K"}),") due to semi-arid climate enhancing evapotranspiration"]}),se.jsx("li",{children:"Consistent effects in humid cities: Shanghai (1.09 K) and Guangzhou (1.23 K)"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Local vs. City-Wide Effects"}),se.jsx("div",{className:"highlight-box warning",children:se.jsxs("p",{children:["The cooling effects are ",se.jsx("strong",{children:"mostly local"}),". The total demolished area (~7.7 km) represents less than 1% of city landfar below the 15-30% land-cover change threshold needed to shift city-wide temperatures."]})}),se.jsx("p",{children:"City-wide temperature reductions require redevelopment to be orchestrated as part of a coherent greening and ventilation corridor strategy, rather than isolated demolition projects."}),se.jsxs("p",{className:"citation",children:["Related research:"," ",se.jsx("a",{href:"https://doi.org/10.1021/acs.est.3c09108",target:"_blank",rel:"noopener noreferrer",children:"Xu et al. (2024) - Green space coverage vs. spatial distribution"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Urban Renewal as Climate Adaptation"}),se.jsxs("p",{children:["Informal settlement renewal can be reframed not just as land management or aesthetic improvement, but as a ",se.jsx("strong",{children:"concrete strategy for climate adaptation"}),". The observed cooling is consistent with Chinese planning regulations that mandate:"]}),se.jsxs("ul",{className:"regulation-list",children:[se.jsx("li",{children:"Minimum greenspace ratios (25-35%)"}),se.jsx("li",{children:"Building spacing requirements for sunlight and ventilation"}),se.jsx("li",{children:"Upper limits on building density"})]}),se.jsxs("p",{className:"citation",children:["Source:"," ",se.jsx("a",{href:"https://www.mohurd.gov.cn/",target:"_blank",rel:"noopener noreferrer",children:"MHURD Standard for Urban Residential Areas (GB 50180-2018)"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Spatial Heterogeneity"}),se.jsxs("p",{children:["Cooling effects are ",se.jsx("strong",{children:"especially pronounced in peripheral urban areas"}),", where redevelopment more often includes green space or open land. This distance-dependent pattern reflects land economics: lower peripheral land prices enable developers to reduce building coverage ratios, while central redevelopments prioritize higher density."]}),se.jsxs("p",{className:"citation",children:["Economic framework:"," ",se.jsx("a",{href:"https://mitpress.mit.edu/9780262514712/urban-economic-theory/",target:"_blank",rel:"noopener noreferrer",children:"Fujita (1989) - Urban Economic Theory"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Equity Concerns"}),se.jsxs("div",{className:"highlight-box critical",children:[se.jsx("h4",{children:"The Cooling-Displacement Paradox"}),se.jsxs("p",{children:["The thermal benefits of demolition are ",se.jsx("strong",{children:"not automatic nor universally equitable"}),". Without supportive policy frameworks, demolition risks displacing populations most vulnerable to heat, pushing them toward peripheral areas with worse access to jobs, infrastructure, and often more extreme environmental exposure."]})]}),se.jsxs("div",{className:"case-study",children:[se.jsx("h4",{children:"Evidence from Hangzhou"}),se.jsxs("ul",{children:[se.jsx("li",{children:"29.2% of displaced migrant workers spend over 30% of income on rent"}),se.jsx("li",{children:"14.1% plan to return to rural areas due to housing pressures"}),se.jsx("li",{children:"Relocation increases commute distances and durations significantly"})]}),se.jsx("p",{className:"citation",children:se.jsx("a",{href:"https://doi.org/10.1016/j.cities.2019.05.026",target:"_blank",rel:"noopener noreferrer",children:"Zeng et al. (2019) - Urban village demolition and migrant housing in Hangzhou"})})]}),se.jsxs("p",{children:[se.jsx("strong",{children:"Policy solutions"})," to address this paradox include:"]}),se.jsxs("ul",{children:[se.jsx("li",{children:"Inclusionary zoning requirements"}),se.jsx("li",{children:"On-site affordable housing provisions"}),se.jsx("li",{children:"Tenant protections ensuring displaced residents can return or remain nearby"})]}),se.jsxs("p",{className:"citation",children:["Policy frameworks:"," ",se.jsx("a",{href:"https://doi.org/10.1080/14649357.2020.1757891",target:"_blank",rel:"noopener noreferrer",children:"Porter et al. (2020) - Climate justice in a climate changed world"}),";"," ",se.jsx("a",{href:"https://doi.org/10.1080/02697459.2015.1008793",target:"_blank",rel:"noopener noreferrer",children:"Mukhija et al. (2015) - Tradeoffs of inclusionary zoning"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Global South Relevance"}),se.jsx("p",{children:"While this study centers on China, the findings carry broader relevance for the Global South, where cities face similar trade-offs between cooling dense settlements and protecting vulnerable populations. Informal settlements in many cities exhibit similar characteristics:"}),se.jsxs("div",{className:"global-examples",children:[se.jsxs("div",{className:"example",children:[se.jsx("strong",{children:"Nairobi's Kibera"}),se.jsx("span",{children:"Extreme density, poor ventilation"})]}),se.jsxs("div",{className:"example",children:[se.jsx("strong",{children:"Mumbai's Dharavi"}),se.jsx("span",{children:"Impervious materials, high thermal exposure"})]}),se.jsxs("div",{className:"example",children:[se.jsx("strong",{children:"So Paulo's Favelas"}),se.jsx("span",{children:"Limited green space, narrow alleys"})]})]}),se.jsxs("p",{children:["However, many cities lack governance capacity for resettlement or compensation. In these cases,",se.jsx("strong",{children:" in-situ upgrading"}),"through green buffers, cool roofs, or ventilation corridorsmay be more feasible and socially sustainable."]}),se.jsxs("p",{className:"citation",children:["Cool roofs research:"," ",se.jsx("a",{href:"https://doi.org/10.1016/j.rser.2022.112183",target:"_blank",rel:"noopener noreferrer",children:"Nutkiewicz et al. (2022) - Cool roofs for informal settlement dwellers"})]})]}),se.jsxs("section",{className:"implication-section",children:[se.jsx("h3",{children:"Future Research Directions"}),se.jsxs("ol",{className:"future-directions",children:[se.jsxs("li",{children:[se.jsx("strong",{children:"Ground-truth validation:"})," Link LST changes to physiological heat exposure (core body temperature, heat-related morbidity) and behavioral adaptation patterns"]}),se.jsxs("li",{children:[se.jsx("strong",{children:"Health outcomes:"})," Integrate wearable temperature sensors or survey residents about heat-related symptoms"]}),se.jsxs("li",{children:[se.jsx("strong",{children:"Alternative interventions:"})," Apply DiD framework to evaluate cool roofs, tree planting, and green infrastructure programs"]}),se.jsxs("li",{children:[se.jsx("strong",{children:"Policy evolution:"}),' As China shifts toward incremental "micro-renewal" approaches, evaluate which strategies yield greatest thermal relief with least social disruption']})]}),se.jsxs("p",{className:"citation",children:["Health-climate linkages:"," ",se.jsx("a",{href:"https://doi.org/10.1016/S0140-6736(21)01787-6",target:"_blank",rel:"noopener noreferrer",children:"Romanello et al. (2021) - Lancet Countdown on health and climate change"})]})]}),se.jsxs("section",{className:"implication-section conclusion",children:[se.jsx("h3",{children:"Conclusion"}),se.jsxs("p",{children:["Urban climate adaptation strategies should treat informal settlements not just as risks to be managed, but as ",se.jsx("strong",{children:"opportunities for transformative, inclusive change"}),". For cooling benefits to translate into broader urban resilience, demolition must be accompanied by policies that mitigate social displacement and ensure vulnerable populations share in environmental gains."]})]})]})}function Sye(){const[t,e]=ee.useState(null),[r,n]=ee.useState(null),[i,l]=ee.useState(null),[c,s]=ee.useState("all"),[m,b]=ee.useState("home"),[w,E]=ee.useState(!0),[O,N]=ee.useState(null);if(ee.useEffect(()=>{async function W(){try{const[j,Y,ce]=await Promise.all([fetch("/urban-renewal-cooling-DID/data/settlements.geojson"),fetch("/urban-renewal-cooling-DID/data/cities.json"),fetch("/urban-renewal-cooling-DID/data/regression_results.json")]);if(!j.ok||!Y.ok||!ce.ok)throw new Error("Failed to load data files");const[re,ue,me]=await Promise.all([j.json(),Y.json(),ce.json()]);e(re),n(ue),l(me),E(!1)}catch(j){N(j instanceof Error?j.message:"Unknown error"),E(!1)}}W()},[]),w)return se.jsxs("div",{className:"loading",children:[se.jsx("div",{className:"loading-spinner"}),se.jsx("p",{children:"Loading data..."})]});if(O)return se.jsxs("div",{className:"error",children:[se.jsx("h2",{children:"Error loading data"}),se.jsx("p",{children:O})]});const V=()=>{switch(m){case"methods":return se.jsx(wye,{});case"implications":return se.jsx(Tye,{});default:return se.jsxs(se.Fragment,{children:[se.jsx(bye,{selectedCity:c,onCityChange:s}),se.jsxs("main",{className:"main-content",children:[se.jsxs("div",{className:"map-panel",children:[se.jsx("h2",{children:"Settlement Locations"}),t&&r&&se.jsx(Yre,{settlements:t,cities:r,selectedCity:c})]}),se.jsxs("div",{className:"chart-panel",children:[se.jsx("h2",{children:"DiD Regression Results"}),i&&se.jsx(yye,{regressionResults:i,selectedCity:c})]})]})]})}};return se.jsxs("div",{className:"app",children:[se.jsxs("header",{className:"header",children:[se.jsx("h1",{children:"Does Demolishing Informal Settlements Cause Urban Surface Cooling?"}),se.jsx("p",{className:"subtitle",children:"Interactive visualization of difference-in-differences analysis across Beijing, Shanghai, and Guangzhou (2002-2022)"}),se.jsxs("nav",{className:"nav-tabs",children:[se.jsx("button",{className:`nav-tab ${m==="home"?"active":""}`,onClick:()=>b("home"),children:"Results"}),se.jsx("button",{className:`nav-tab ${m==="methods"?"active":""}`,onClick:()=>b("methods"),children:"Methods"}),se.jsx("button",{className:`nav-tab ${m==="implications"?"active":""}`,onClick:()=>b("implications"),children:"Implications"})]})]}),V(),se.jsxs("footer",{className:"footer",children:[se.jsxs("div",{className:"authors",children:[se.jsx("h4",{children:"Authors"}),se.jsxs("div",{className:"author-list",children:[se.jsxs("div",{className:"author",children:[se.jsx("span",{className:"author-name",children:"Yujie Sun"}),se.jsx("span",{className:"author-affiliation",children:"Tongji University"})]}),se.jsxs("div",{className:"author",children:[se.jsx("span",{className:"author-name",children:"Xuyan Gao"}),se.jsx("span",{className:"author-affiliation",children:"Xi'an Jiaotong-Liverpool University"})]}),se.jsxs("div",{className:"author",children:[se.jsx("span",{className:"author-name",children:"Jiayong Liang*"}),se.jsx("span",{className:"author-affiliation",children:"NYU Shanghai"}),se.jsx("a",{href:"mailto:jiayong.liang@nyu.edu",className:"author-email",children:"jiayong.liang@nyu.edu"})]}),se.jsxs("div",{className:"author",children:[se.jsx("a",{href:"https://kangning-huang.github.io/main/",target:"_blank",rel:"noopener noreferrer",className:"author-name author-link",children:"Kangning Huang*"}),se.jsx("span",{className:"author-affiliation",children:"NYU Shanghai"}),se.jsx("a",{href:"mailto:kangning.huang@nyu.edu",className:"author-email",children:"kangning.huang@nyu.edu"})]})]})]}),se.jsxs("div",{className:"citation-info",children:[se.jsxs("p",{children:[se.jsx("strong",{children:"Citation:"})," Sun, Y., Gao, X., Liang, J., & Huang, K. (2025).",se.jsx("em",{children:" Unveiling the causal link between informal settlement demolition and urban cooling."})]}),se.jsx("p",{children:se.jsx("a",{href:"https://doi.org/10.21203/rs.3.rs-7288639/v1",target:"_blank",rel:"noopener noreferrer",children:"DOI: 10.21203/rs.3.rs-7288639/v1"})})]})]})]})}N8.createRoot(document.getElementById("root")).render(se.jsx(ee.StrictMode,{children:se.jsx(Sye,{})}));
//# sourceMappingURL=index-CuueLwab.js.map
